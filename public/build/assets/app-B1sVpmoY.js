var Hi=Object.defineProperty;var $i=(r,e,t)=>e in r?Hi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ge=(r,e,t)=>$i(r,typeof e!="symbol"?e+"":e,t);function Gi(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}function Hr(r,e){return function(){return r.apply(e,arguments)}}const{toString:Vi}=Object.prototype,{getPrototypeOf:Pn}=Object,{iterator:Ut,toStringTag:$r}=Symbol,Bt=(r=>e=>{const t=Vi.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ke=r=>(r=r.toLowerCase(),e=>Bt(e)===r),Ht=r=>e=>typeof e===r,{isArray:nt}=Array,st=Ht("undefined");function zi(r){return r!==null&&!st(r)&&r.constructor!==null&&!st(r.constructor)&&Ee(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Gr=ke("ArrayBuffer");function Wi(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Gr(r.buffer),e}const qi=Ht("string"),Ee=Ht("function"),Vr=Ht("number"),$t=r=>r!==null&&typeof r=="object",Ki=r=>r===!0||r===!1,At=r=>{if(Bt(r)!=="object")return!1;const e=Pn(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!($r in r)&&!(Ut in r)},Ji=ke("Date"),Qi=ke("File"),Yi=ke("Blob"),Xi=ke("FileList"),Zi=r=>$t(r)&&Ee(r.pipe),eo=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Ee(r.append)&&((e=Bt(r))==="formdata"||e==="object"&&Ee(r.toString)&&r.toString()==="[object FormData]"))},to=ke("URLSearchParams"),[no,ro,oo,so]=["ReadableStream","Request","Response","Headers"].map(ke),ao=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ct(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),nt(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{const s=t?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let u;for(n=0;n<o;n++)u=s[n],e.call(null,r[u],u,r)}}function zr(r,e){e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const Ke=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Wr=r=>!st(r)&&r!==Ke;function On(){const{caseless:r}=Wr(this)&&this||{},e={},t=(n,i)=>{const s=r&&zr(e,i)||i;At(e[s])&&At(n)?e[s]=On(e[s],n):At(n)?e[s]=On({},n):nt(n)?e[s]=n.slice():e[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&ct(arguments[n],t);return e}const lo=(r,e,t,{allOwnKeys:n}={})=>(ct(e,(i,s)=>{t&&Ee(i)?r[s]=Hr(i,t):r[s]=i},{allOwnKeys:n}),r),uo=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),co=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},fo=(r,e,t,n)=>{let i,s,o;const u={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,e))&&!u[o]&&(e[o]=r[o],u[o]=!0);r=t!==!1&&Pn(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},ho=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},po=r=>{if(!r)return null;if(nt(r))return r;let e=r.length;if(!Vr(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},go=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&Pn(Uint8Array)),vo=(r,e)=>{const n=(r&&r[Ut]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},mo=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},yo=ke("HTMLFormElement"),bo=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),Bn=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),Oo=ke("RegExp"),qr=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};ct(t,(i,s)=>{let o;(o=e(i,s,r))!==!1&&(n[s]=o||i)}),Object.defineProperties(r,n)},Co=r=>{qr(r,(e,t)=>{if(Ee(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(Ee(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},wo=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return nt(r)?n(r):n(String(r).split(e)),t},Ao=()=>{},So=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function Eo(r){return!!(r&&Ee(r.append)&&r[$r]==="FormData"&&r[Ut])}const Ro=r=>{const e=new Array(10),t=(n,i)=>{if($t(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;const s=nt(n)?[]:{};return ct(n,(o,u)=>{const f=t(o,i+1);!st(f)&&(s[u]=f)}),e[i]=void 0,s}}return n};return t(r,0)},To=ke("AsyncFunction"),Io=r=>r&&($t(r)||Ee(r))&&Ee(r.then)&&Ee(r.catch),Kr=((r,e)=>r?setImmediate:e?((t,n)=>(Ke.addEventListener("message",({source:i,data:s})=>{i===Ke&&s===t&&n.length&&n.shift()()},!1),i=>{n.push(i),Ke.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Ee(Ke.postMessage)),xo=typeof queueMicrotask<"u"?queueMicrotask.bind(Ke):typeof process<"u"&&process.nextTick||Kr,_o=r=>r!=null&&Ee(r[Ut]),W={isArray:nt,isArrayBuffer:Gr,isBuffer:zi,isFormData:eo,isArrayBufferView:Wi,isString:qi,isNumber:Vr,isBoolean:Ki,isObject:$t,isPlainObject:At,isReadableStream:no,isRequest:ro,isResponse:oo,isHeaders:so,isUndefined:st,isDate:Ji,isFile:Qi,isBlob:Yi,isRegExp:Oo,isFunction:Ee,isStream:Zi,isURLSearchParams:to,isTypedArray:go,isFileList:Xi,forEach:ct,merge:On,extend:lo,trim:ao,stripBOM:uo,inherits:co,toFlatObject:fo,kindOf:Bt,kindOfTest:ke,endsWith:ho,toArray:po,forEachEntry:vo,matchAll:mo,isHTMLForm:yo,hasOwnProperty:Bn,hasOwnProp:Bn,reduceDescriptors:qr,freezeMethods:Co,toObjectSet:wo,toCamelCase:bo,noop:Ao,toFiniteNumber:So,findKey:zr,global:Ke,isContextDefined:Wr,isSpecCompliantForm:Eo,toJSONObject:Ro,isAsyncFn:To,isThenable:Io,setImmediate:Kr,asap:xo,isIterable:_o};function te(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}W.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:W.toJSONObject(this.config),code:this.code,status:this.status}}});const Jr=te.prototype,Qr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Qr[r]={value:r}});Object.defineProperties(te,Qr);Object.defineProperty(Jr,"isAxiosError",{value:!0});te.from=(r,e,t,n,i,s)=>{const o=Object.create(Jr);return W.toFlatObject(r,o,function(f){return f!==Error.prototype},u=>u!=="isAxiosError"),te.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const Po=null;function Cn(r){return W.isPlainObject(r)||W.isArray(r)}function Yr(r){return W.endsWith(r,"[]")?r.slice(0,-2):r}function Hn(r,e,t){return r?r.concat(e).map(function(i,s){return i=Yr(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function Mo(r){return W.isArray(r)&&!r.some(Cn)}const Lo=W.toFlatObject(W,{},null,function(e){return/^is[A-Z]/.test(e)});function Gt(r,e,t){if(!W.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=W.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,R){return!W.isUndefined(R[S])});const n=t.metaTokens,i=t.visitor||m,s=t.dots,o=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&W.isSpecCompliantForm(e);if(!W.isFunction(i))throw new TypeError("visitor must be a function");function d(l){if(l===null)return"";if(W.isDate(l))return l.toISOString();if(W.isBoolean(l))return l.toString();if(!f&&W.isBlob(l))throw new te("Blob is not supported. Use a Buffer instead.");return W.isArrayBuffer(l)||W.isTypedArray(l)?f&&typeof Blob=="function"?new Blob([l]):Buffer.from(l):l}function m(l,S,R){let I=l;if(l&&!R&&typeof l=="object"){if(W.endsWith(S,"{}"))S=n?S:S.slice(0,-2),l=JSON.stringify(l);else if(W.isArray(l)&&Mo(l)||(W.isFileList(l)||W.endsWith(S,"[]"))&&(I=W.toArray(l)))return S=Yr(S),I.forEach(function(O,x){!(W.isUndefined(O)||O===null)&&e.append(o===!0?Hn([S],x,s):o===null?S:S+"[]",d(O))}),!1}return Cn(l)?!0:(e.append(Hn(R,S,s),d(l)),!1)}const b=[],C=Object.assign(Lo,{defaultVisitor:m,convertValue:d,isVisitable:Cn});function T(l,S){if(!W.isUndefined(l)){if(b.indexOf(l)!==-1)throw Error("Circular reference detected in "+S.join("."));b.push(l),W.forEach(l,function(I,y){(!(W.isUndefined(I)||I===null)&&i.call(e,I,W.isString(y)?y.trim():y,S,C))===!0&&T(I,S?S.concat(y):[y])}),b.pop()}}if(!W.isObject(r))throw new TypeError("data must be an object");return T(r),e}function $n(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Mn(r,e){this._pairs=[],r&&Gt(r,this,e)}const Xr=Mn.prototype;Xr.append=function(e,t){this._pairs.push([e,t])};Xr.toString=function(e){const t=e?function(n){return e.call(this,n,$n)}:$n;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function ko(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Zr(r,e,t){if(!e)return r;const n=t&&t.encode||ko;W.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let s;if(i?s=i(e,t):s=W.isURLSearchParams(e)?e.toString():new Mn(e,t).toString(n),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class Gn{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){W.forEach(this.handlers,function(n){n!==null&&e(n)})}}const ei={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Do=typeof URLSearchParams<"u"?URLSearchParams:Mn,No=typeof FormData<"u"?FormData:null,Fo=typeof Blob<"u"?Blob:null,jo={isBrowser:!0,classes:{URLSearchParams:Do,FormData:No,Blob:Fo},protocols:["http","https","file","blob","url","data"]},Ln=typeof window<"u"&&typeof document<"u",wn=typeof navigator=="object"&&navigator||void 0,Uo=Ln&&(!wn||["ReactNative","NativeScript","NS"].indexOf(wn.product)<0),Bo=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ho=Ln&&window.location.href||"http://localhost",$o=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ln,hasStandardBrowserEnv:Uo,hasStandardBrowserWebWorkerEnv:Bo,navigator:wn,origin:Ho},Symbol.toStringTag,{value:"Module"})),ye={...$o,...jo};function Go(r,e){return Gt(r,new ye.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,s){return ye.isNode&&W.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Vo(r){return W.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function zo(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function ti(r){function e(t,n,i,s){let o=t[s++];if(o==="__proto__")return!0;const u=Number.isFinite(+o),f=s>=t.length;return o=!o&&W.isArray(i)?i.length:o,f?(W.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!u):((!i[o]||!W.isObject(i[o]))&&(i[o]=[]),e(t,n,i[o],s)&&W.isArray(i[o])&&(i[o]=zo(i[o])),!u)}if(W.isFormData(r)&&W.isFunction(r.entries)){const t={};return W.forEachEntry(r,(n,i)=>{e(Vo(n),i,t,0)}),t}return null}function Wo(r,e,t){if(W.isString(r))try{return(e||JSON.parse)(r),W.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const ft={transitional:ei,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=W.isObject(e);if(s&&W.isHTMLForm(e)&&(e=new FormData(e)),W.isFormData(e))return i?JSON.stringify(ti(e)):e;if(W.isArrayBuffer(e)||W.isBuffer(e)||W.isStream(e)||W.isFile(e)||W.isBlob(e)||W.isReadableStream(e))return e;if(W.isArrayBufferView(e))return e.buffer;if(W.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Go(e,this.formSerializer).toString();if((u=W.isFileList(e))||n.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Gt(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),Wo(e)):e}],transformResponse:[function(e){const t=this.transitional||ft.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(W.isResponse(e)||W.isReadableStream(e))return e;if(e&&W.isString(e)&&(n&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(u){if(o)throw u.name==="SyntaxError"?te.from(u,te.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ye.classes.FormData,Blob:ye.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};W.forEach(["delete","get","head","post","put","patch"],r=>{ft.headers[r]={}});const qo=W.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ko=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!t||e[t]&&qo[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Vn=Symbol("internals");function ot(r){return r&&String(r).trim().toLowerCase()}function St(r){return r===!1||r==null?r:W.isArray(r)?r.map(St):String(r)}function Jo(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const Qo=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function en(r,e,t,n,i){if(W.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!W.isString(e)){if(W.isString(n))return e.indexOf(n)!==-1;if(W.isRegExp(n))return n.test(e)}}function Yo(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Xo(r,e){const t=W.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,o){return this[n].call(this,e,i,s,o)},configurable:!0})})}let Re=class{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(u,f,d){const m=ot(f);if(!m)throw new Error("header name must be a non-empty string");const b=W.findKey(i,m);(!b||i[b]===void 0||d===!0||d===void 0&&i[b]!==!1)&&(i[b||f]=St(u))}const o=(u,f)=>W.forEach(u,(d,m)=>s(d,m,f));if(W.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(W.isString(e)&&(e=e.trim())&&!Qo(e))o(Ko(e),t);else if(W.isObject(e)&&W.isIterable(e)){let u={},f,d;for(const m of e){if(!W.isArray(m))throw TypeError("Object iterator must return a key-value pair");u[d=m[0]]=(f=u[d])?W.isArray(f)?[...f,m[1]]:[f,m[1]]:m[1]}o(u,t)}else e!=null&&s(t,e,n);return this}get(e,t){if(e=ot(e),e){const n=W.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return Jo(i);if(W.isFunction(t))return t.call(this,i,n);if(W.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ot(e),e){const n=W.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||en(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(o){if(o=ot(o),o){const u=W.findKey(n,o);u&&(!t||en(n,n[u],u,t))&&(delete n[u],i=!0)}}return W.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||en(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return W.forEach(this,(i,s)=>{const o=W.findKey(n,s);if(o){t[o]=St(i),delete t[s];return}const u=e?Yo(s):String(s).trim();u!==s&&delete t[s],t[u]=St(i),n[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return W.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&W.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[Vn]=this[Vn]={accessors:{}}).accessors,i=this.prototype;function s(o){const u=ot(o);n[u]||(Xo(i,o),n[u]=!0)}return W.isArray(e)?e.forEach(s):s(e),this}};Re.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);W.reduceDescriptors(Re.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}});W.freezeMethods(Re);function tn(r,e){const t=this||ft,n=e||t,i=Re.from(n.headers);let s=n.data;return W.forEach(r,function(u){s=u.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function ni(r){return!!(r&&r.__CANCEL__)}function rt(r,e,t){te.call(this,r??"canceled",te.ERR_CANCELED,e,t),this.name="CanceledError"}W.inherits(rt,te,{__CANCEL__:!0});function ri(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new te("Request failed with status code "+t.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Zo(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function es(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(f){const d=Date.now(),m=n[s];o||(o=d),t[i]=f,n[i]=d;let b=s,C=0;for(;b!==i;)C+=t[b++],b=b%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),d-o<e)return;const T=m&&d-m;return T?Math.round(C*1e3/T):void 0}}function ts(r,e){let t=0,n=1e3/e,i,s;const o=(d,m=Date.now())=>{t=m,i=null,s&&(clearTimeout(s),s=null),r.apply(null,d)};return[(...d)=>{const m=Date.now(),b=m-t;b>=n?o(d,m):(i=d,s||(s=setTimeout(()=>{s=null,o(i)},n-b)))},()=>i&&o(i)]}const It=(r,e,t=3)=>{let n=0;const i=es(50,250);return ts(s=>{const o=s.loaded,u=s.lengthComputable?s.total:void 0,f=o-n,d=i(f),m=o<=u;n=o;const b={loaded:o,total:u,progress:u?o/u:void 0,bytes:f,rate:d||void 0,estimated:d&&u&&m?(u-o)/d:void 0,event:s,lengthComputable:u!=null,[e?"download":"upload"]:!0};r(b)},t)},zn=(r,e)=>{const t=r!=null;return[n=>e[0]({lengthComputable:t,total:r,loaded:n}),e[1]]},Wn=r=>(...e)=>W.asap(()=>r(...e)),ns=ye.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,ye.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(ye.origin),ye.navigator&&/(msie|trident)/i.test(ye.navigator.userAgent)):()=>!0,rs=ye.hasStandardBrowserEnv?{write(r,e,t,n,i,s){const o=[r+"="+encodeURIComponent(e)];W.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),W.isString(n)&&o.push("path="+n),W.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function is(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function os(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function ii(r,e,t){let n=!is(e);return r&&(n||t==!1)?os(r,e):e}const qn=r=>r instanceof Re?{...r}:r;function Qe(r,e){e=e||{};const t={};function n(d,m,b,C){return W.isPlainObject(d)&&W.isPlainObject(m)?W.merge.call({caseless:C},d,m):W.isPlainObject(m)?W.merge({},m):W.isArray(m)?m.slice():m}function i(d,m,b,C){if(W.isUndefined(m)){if(!W.isUndefined(d))return n(void 0,d,b,C)}else return n(d,m,b,C)}function s(d,m){if(!W.isUndefined(m))return n(void 0,m)}function o(d,m){if(W.isUndefined(m)){if(!W.isUndefined(d))return n(void 0,d)}else return n(void 0,m)}function u(d,m,b){if(b in e)return n(d,m);if(b in r)return n(void 0,d)}const f={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u,headers:(d,m,b)=>i(qn(d),qn(m),b,!0)};return W.forEach(Object.keys(Object.assign({},r,e)),function(m){const b=f[m]||i,C=b(r[m],e[m],m);W.isUndefined(C)&&b!==u||(t[m]=C)}),t}const oi=r=>{const e=Qe({},r);let{data:t,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:u}=e;e.headers=o=Re.from(o),e.url=Zr(ii(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),u&&o.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let f;if(W.isFormData(t)){if(ye.hasStandardBrowserEnv||ye.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((f=o.getContentType())!==!1){const[d,...m]=f?f.split(";").map(b=>b.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...m].join("; "))}}if(ye.hasStandardBrowserEnv&&(n&&W.isFunction(n)&&(n=n(e)),n||n!==!1&&ns(e.url))){const d=i&&s&&rs.read(s);d&&o.set(i,d)}return e},ss=typeof XMLHttpRequest<"u",as=ss&&function(r){return new Promise(function(t,n){const i=oi(r);let s=i.data;const o=Re.from(i.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:d}=i,m,b,C,T,l;function S(){T&&T(),l&&l(),i.cancelToken&&i.cancelToken.unsubscribe(m),i.signal&&i.signal.removeEventListener("abort",m)}let R=new XMLHttpRequest;R.open(i.method.toUpperCase(),i.url,!0),R.timeout=i.timeout;function I(){if(!R)return;const O=Re.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),p={data:!u||u==="text"||u==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:O,config:r,request:R};ri(function(c){t(c),S()},function(c){n(c),S()},p),R=null}"onloadend"in R?R.onloadend=I:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(I)},R.onabort=function(){R&&(n(new te("Request aborted",te.ECONNABORTED,r,R)),R=null)},R.onerror=function(){n(new te("Network Error",te.ERR_NETWORK,r,R)),R=null},R.ontimeout=function(){let x=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const p=i.transitional||ei;i.timeoutErrorMessage&&(x=i.timeoutErrorMessage),n(new te(x,p.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,r,R)),R=null},s===void 0&&o.setContentType(null),"setRequestHeader"in R&&W.forEach(o.toJSON(),function(x,p){R.setRequestHeader(p,x)}),W.isUndefined(i.withCredentials)||(R.withCredentials=!!i.withCredentials),u&&u!=="json"&&(R.responseType=i.responseType),d&&([C,l]=It(d,!0),R.addEventListener("progress",C)),f&&R.upload&&([b,T]=It(f),R.upload.addEventListener("progress",b),R.upload.addEventListener("loadend",T)),(i.cancelToken||i.signal)&&(m=O=>{R&&(n(!O||O.type?new rt(null,r,R):O),R.abort(),R=null)},i.cancelToken&&i.cancelToken.subscribe(m),i.signal&&(i.signal.aborted?m():i.signal.addEventListener("abort",m)));const y=Zo(i.url);if(y&&ye.protocols.indexOf(y)===-1){n(new te("Unsupported protocol "+y+":",te.ERR_BAD_REQUEST,r));return}R.send(s||null)})},ls=(r,e)=>{const{length:t}=r=r?r.filter(Boolean):[];if(e||t){let n=new AbortController,i;const s=function(d){if(!i){i=!0,u();const m=d instanceof Error?d:this.reason;n.abort(m instanceof te?m:new rt(m instanceof Error?m.message:m))}};let o=e&&setTimeout(()=>{o=null,s(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const u=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(d=>{d.unsubscribe?d.unsubscribe(s):d.removeEventListener("abort",s)}),r=null)};r.forEach(d=>d.addEventListener("abort",s));const{signal:f}=n;return f.unsubscribe=()=>W.asap(u),f}},us=function*(r,e){let t=r.byteLength;if(t<e){yield r;return}let n=0,i;for(;n<t;)i=n+e,yield r.slice(n,i),n=i},cs=async function*(r,e){for await(const t of fs(r))yield*us(t,e)},fs=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},Kn=(r,e,t,n)=>{const i=cs(r,e);let s=0,o,u=f=>{o||(o=!0,n&&n(f))};return new ReadableStream({async pull(f){try{const{done:d,value:m}=await i.next();if(d){u(),f.close();return}let b=m.byteLength;if(t){let C=s+=b;t(C)}f.enqueue(new Uint8Array(m))}catch(d){throw u(d),d}},cancel(f){return u(f),i.return()}},{highWaterMark:2})},Vt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",si=Vt&&typeof ReadableStream=="function",ds=Vt&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),ai=(r,...e)=>{try{return!!r(...e)}catch{return!1}},hs=si&&ai(()=>{let r=!1;const e=new Request(ye.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),Jn=64*1024,An=si&&ai(()=>W.isReadableStream(new Response("").body)),xt={stream:An&&(r=>r.body)};Vt&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!xt[e]&&(xt[e]=W.isFunction(r[e])?t=>t[e]():(t,n)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,n)})})})(new Response);const ps=async r=>{if(r==null)return 0;if(W.isBlob(r))return r.size;if(W.isSpecCompliantForm(r))return(await new Request(ye.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(W.isArrayBufferView(r)||W.isArrayBuffer(r))return r.byteLength;if(W.isURLSearchParams(r)&&(r=r+""),W.isString(r))return(await ds(r)).byteLength},gs=async(r,e)=>{const t=W.toFiniteNumber(r.getContentLength());return t??ps(e)},vs=Vt&&(async r=>{let{url:e,method:t,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:u,onUploadProgress:f,responseType:d,headers:m,withCredentials:b="same-origin",fetchOptions:C}=oi(r);d=d?(d+"").toLowerCase():"text";let T=ls([i,s&&s.toAbortSignal()],o),l;const S=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let R;try{if(f&&hs&&t!=="get"&&t!=="head"&&(R=await gs(m,n))!==0){let p=new Request(e,{method:"POST",body:n,duplex:"half"}),h;if(W.isFormData(n)&&(h=p.headers.get("content-type"))&&m.setContentType(h),p.body){const[c,a]=zn(R,It(Wn(f)));n=Kn(p.body,Jn,c,a)}}W.isString(b)||(b=b?"include":"omit");const I="credentials"in Request.prototype;l=new Request(e,{...C,signal:T,method:t.toUpperCase(),headers:m.normalize().toJSON(),body:n,duplex:"half",credentials:I?b:void 0});let y=await fetch(l,C);const O=An&&(d==="stream"||d==="response");if(An&&(u||O&&S)){const p={};["status","statusText","headers"].forEach(v=>{p[v]=y[v]});const h=W.toFiniteNumber(y.headers.get("content-length")),[c,a]=u&&zn(h,It(Wn(u),!0))||[];y=new Response(Kn(y.body,Jn,c,()=>{a&&a(),S&&S()}),p)}d=d||"text";let x=await xt[W.findKey(xt,d)||"text"](y,r);return!O&&S&&S(),await new Promise((p,h)=>{ri(p,h,{data:x,headers:Re.from(y.headers),status:y.status,statusText:y.statusText,config:r,request:l})})}catch(I){throw S&&S(),I&&I.name==="TypeError"&&/Load failed|fetch/i.test(I.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,r,l),{cause:I.cause||I}):te.from(I,I&&I.code,r,l)}}),Sn={http:Po,xhr:as,fetch:vs};W.forEach(Sn,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const Qn=r=>`- ${r}`,ms=r=>W.isFunction(r)||r===null||r===!1,li={getAdapter:r=>{r=W.isArray(r)?r:[r];const{length:e}=r;let t,n;const i={};for(let s=0;s<e;s++){t=r[s];let o;if(n=t,!ms(t)&&(n=Sn[(o=String(t)).toLowerCase()],n===void 0))throw new te(`Unknown adapter '${o}'`);if(n)break;i[o||"#"+s]=n}if(!n){const s=Object.entries(i).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(Qn).join(`
`):" "+Qn(s[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:Sn};function nn(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new rt(null,r)}function Yn(r){return nn(r),r.headers=Re.from(r.headers),r.data=tn.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),li.getAdapter(r.adapter||ft.adapter)(r).then(function(n){return nn(r),n.data=tn.call(r,r.transformResponse,n),n.headers=Re.from(n.headers),n},function(n){return ni(n)||(nn(r),n&&n.response&&(n.response.data=tn.call(r,r.transformResponse,n.response),n.response.headers=Re.from(n.response.headers))),Promise.reject(n)})}const ui="1.10.0",zt={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{zt[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const Xn={};zt.transitional=function(e,t,n){function i(s,o){return"[Axios v"+ui+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,u)=>{if(e===!1)throw new te(i(o," has been removed"+(t?" in "+t:"")),te.ERR_DEPRECATED);return t&&!Xn[o]&&(Xn[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,u):!0}};zt.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function ys(r,e,t){if(typeof r!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],o=e[s];if(o){const u=r[s],f=u===void 0||o(u,s,r);if(f!==!0)throw new te("option "+s+" must be "+f,te.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new te("Unknown option "+s,te.ERR_BAD_OPTION)}}const Et={assertOptions:ys,validators:zt},De=Et.validators;let Je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Gn,response:new Gn}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Qe(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&Et.assertOptions(n,{silentJSONParsing:De.transitional(De.boolean),forcedJSONParsing:De.transitional(De.boolean),clarifyTimeoutError:De.transitional(De.boolean)},!1),i!=null&&(W.isFunction(i)?t.paramsSerializer={serialize:i}:Et.assertOptions(i,{encode:De.function,serialize:De.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Et.assertOptions(t,{baseUrl:De.spelling("baseURL"),withXsrfToken:De.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&W.merge(s.common,s[t.method]);s&&W.forEach(["delete","get","head","post","put","patch","common"],l=>{delete s[l]}),t.headers=Re.concat(o,s);const u=[];let f=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(f=f&&S.synchronous,u.unshift(S.fulfilled,S.rejected))});const d=[];this.interceptors.response.forEach(function(S){d.push(S.fulfilled,S.rejected)});let m,b=0,C;if(!f){const l=[Yn.bind(this),void 0];for(l.unshift.apply(l,u),l.push.apply(l,d),C=l.length,m=Promise.resolve(t);b<C;)m=m.then(l[b++],l[b++]);return m}C=u.length;let T=t;for(b=0;b<C;){const l=u[b++],S=u[b++];try{T=l(T)}catch(R){S.call(this,R);break}}try{m=Yn.call(this,T)}catch(l){return Promise.reject(l)}for(b=0,C=d.length;b<C;)m=m.then(d[b++],d[b++]);return m}getUri(e){e=Qe(this.defaults,e);const t=ii(e.baseURL,e.url,e.allowAbsoluteUrls);return Zr(t,e.params,e.paramsSerializer)}};W.forEach(["delete","get","head","options"],function(e){Je.prototype[e]=function(t,n){return this.request(Qe(n||{},{method:e,url:t,data:(n||{}).data}))}});W.forEach(["post","put","patch"],function(e){function t(n){return function(s,o,u){return this.request(Qe(u||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Je.prototype[e]=t(),Je.prototype[e+"Form"]=t(!0)});let bs=class ci{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(u=>{n.subscribe(u),s=u}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},e(function(s,o,u){n.reason||(n.reason=new rt(s,o,u),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new ci(function(i){e=i}),cancel:e}}};function Os(r){return function(t){return r.apply(null,t)}}function Cs(r){return W.isObject(r)&&r.isAxiosError===!0}const En={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(En).forEach(([r,e])=>{En[e]=r});function fi(r){const e=new Je(r),t=Hr(Je.prototype.request,e);return W.extend(t,Je.prototype,e,{allOwnKeys:!0}),W.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return fi(Qe(r,i))},t}const fe=fi(ft);fe.Axios=Je;fe.CanceledError=rt;fe.CancelToken=bs;fe.isCancel=ni;fe.VERSION=ui;fe.toFormData=Gt;fe.AxiosError=te;fe.Cancel=fe.CanceledError;fe.all=function(e){return Promise.all(e)};fe.spread=Os;fe.isAxiosError=Cs;fe.mergeConfig=Qe;fe.AxiosHeaders=Re;fe.formToJSON=r=>ti(W.isHTMLForm(r)?new FormData(r):r);fe.getAdapter=li.getAdapter;fe.HttpStatusCode=En;fe.default=fe;const{Axios:Xc,AxiosError:Zc,CanceledError:ef,isCancel:tf,CancelToken:nf,VERSION:rf,all:of,Cancel:sf,isAxiosError:af,spread:lf,toFormData:uf,AxiosHeaders:cf,HttpStatusCode:ff,formToJSON:df,getAdapter:hf,mergeConfig:pf}=fe;function ws(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function ve(r,e,t){return e=et(e),Ss(r,di()?Reflect.construct(e,t||[],et(r).constructor):e.apply(r,t))}function ae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function As(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,Is(n.key),n)}}function le(r,e,t){return e&&As(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function _e(){return _e=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_e.apply(null,arguments)}function Rn(){return Rn=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,t){var n=Es(r,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?r:t):i.value}},Rn.apply(null,arguments)}function et(r){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},et(r)}function me(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Tn(r,e)}function di(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(di=function(){return!!r})()}function Ss(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ws(r)}function Ue(){Ue=function(){return e};var r,e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(A,E,L){A[E]=L.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",f=s.toStringTag||"@@toStringTag";function d(A,E,L){return Object.defineProperty(A,E,{value:L,enumerable:!0,configurable:!0,writable:!0}),A[E]}try{d({},"")}catch{d=function(E,L,F){return E[L]=F}}function m(A,E,L,F){var U=E&&E.prototype instanceof I?E:I,G=Object.create(U.prototype),V=new M(F||[]);return i(G,"_invoke",{value:g(A,L,V)}),G}function b(A,E,L){try{return{type:"normal",arg:A.call(E,L)}}catch(F){return{type:"throw",arg:F}}}e.wrap=m;var C="suspendedStart",T="suspendedYield",l="executing",S="completed",R={};function I(){}function y(){}function O(){}var x={};d(x,o,function(){return this});var p=Object.getPrototypeOf,h=p&&p(p(_([])));h&&h!==t&&n.call(h,o)&&(x=h);var c=O.prototype=I.prototype=Object.create(x);function a(A){["next","throw","return"].forEach(function(E){d(A,E,function(L){return this._invoke(E,L)})})}function v(A,E){function L(U,G,V,H){var P=b(A[U],A,G);if(P.type!=="throw"){var N=P.arg,j=N.value;return j&&typeof j=="object"&&n.call(j,"__await")?E.resolve(j.__await).then(function(B){L("next",B,V,H)},function(B){L("throw",B,V,H)}):E.resolve(j).then(function(B){N.value=B,V(N)},function(B){return L("throw",B,V,H)})}H(P.arg)}var F;i(this,"_invoke",{value:function(U,G){function V(){return new E(function(H,P){L(U,G,H,P)})}return F=F?F.then(V,V):V()}})}function g(A,E,L){var F=C;return function(U,G){if(F===l)throw Error("Generator is already running");if(F===S){if(U==="throw")throw G;return{value:r,done:!0}}for(L.method=U,L.arg=G;;){var V=L.delegate;if(V){var H=w(V,L);if(H){if(H===R)continue;return H}}if(L.method==="next")L.sent=L._sent=L.arg;else if(L.method==="throw"){if(F===C)throw F=S,L.arg;L.dispatchException(L.arg)}else L.method==="return"&&L.abrupt("return",L.arg);F=l;var P=b(A,E,L);if(P.type==="normal"){if(F=L.done?S:T,P.arg===R)continue;return{value:P.arg,done:L.done}}P.type==="throw"&&(F=S,L.method="throw",L.arg=P.arg)}}}function w(A,E){var L=E.method,F=A.iterator[L];if(F===r)return E.delegate=null,L==="throw"&&A.iterator.return&&(E.method="return",E.arg=r,w(A,E),E.method==="throw")||L!=="return"&&(E.method="throw",E.arg=new TypeError("The iterator does not provide a '"+L+"' method")),R;var U=b(F,A.iterator,E.arg);if(U.type==="throw")return E.method="throw",E.arg=U.arg,E.delegate=null,R;var G=U.arg;return G?G.done?(E[A.resultName]=G.value,E.next=A.nextLoc,E.method!=="return"&&(E.method="next",E.arg=r),E.delegate=null,R):G:(E.method="throw",E.arg=new TypeError("iterator result is not an object"),E.delegate=null,R)}function D(A){var E={tryLoc:A[0]};1 in A&&(E.catchLoc=A[1]),2 in A&&(E.finallyLoc=A[2],E.afterLoc=A[3]),this.tryEntries.push(E)}function k(A){var E=A.completion||{};E.type="normal",delete E.arg,A.completion=E}function M(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(D,this),this.reset(!0)}function _(A){if(A||A===""){var E=A[o];if(E)return E.call(A);if(typeof A.next=="function")return A;if(!isNaN(A.length)){var L=-1,F=function U(){for(;++L<A.length;)if(n.call(A,L))return U.value=A[L],U.done=!1,U;return U.value=r,U.done=!0,U};return F.next=F}}throw new TypeError(typeof A+" is not iterable")}return y.prototype=O,i(c,"constructor",{value:O,configurable:!0}),i(O,"constructor",{value:y,configurable:!0}),y.displayName=d(O,f,"GeneratorFunction"),e.isGeneratorFunction=function(A){var E=typeof A=="function"&&A.constructor;return!!E&&(E===y||(E.displayName||E.name)==="GeneratorFunction")},e.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,O):(A.__proto__=O,d(A,f,"GeneratorFunction")),A.prototype=Object.create(c),A},e.awrap=function(A){return{__await:A}},a(v.prototype),d(v.prototype,u,function(){return this}),e.AsyncIterator=v,e.async=function(A,E,L,F,U){U===void 0&&(U=Promise);var G=new v(m(A,E,L,F),U);return e.isGeneratorFunction(E)?G:G.next().then(function(V){return V.done?V.value:G.next()})},a(c),d(c,f,"Generator"),d(c,o,function(){return this}),d(c,"toString",function(){return"[object Generator]"}),e.keys=function(A){var E=Object(A),L=[];for(var F in E)L.push(F);return L.reverse(),function U(){for(;L.length;){var G=L.pop();if(G in E)return U.value=G,U.done=!1,U}return U.done=!0,U}},e.values=_,M.prototype={constructor:M,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(k),!A)for(var E in this)E.charAt(0)==="t"&&n.call(this,E)&&!isNaN(+E.slice(1))&&(this[E]=r)},stop:function(){this.done=!0;var A=this.tryEntries[0].completion;if(A.type==="throw")throw A.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var E=this;function L(P,N){return G.type="throw",G.arg=A,E.next=P,N&&(E.method="next",E.arg=r),!!N}for(var F=this.tryEntries.length-1;F>=0;--F){var U=this.tryEntries[F],G=U.completion;if(U.tryLoc==="root")return L("end");if(U.tryLoc<=this.prev){var V=n.call(U,"catchLoc"),H=n.call(U,"finallyLoc");if(V&&H){if(this.prev<U.catchLoc)return L(U.catchLoc,!0);if(this.prev<U.finallyLoc)return L(U.finallyLoc)}else if(V){if(this.prev<U.catchLoc)return L(U.catchLoc,!0)}else{if(!H)throw Error("try statement without catch or finally");if(this.prev<U.finallyLoc)return L(U.finallyLoc)}}}},abrupt:function(A,E){for(var L=this.tryEntries.length-1;L>=0;--L){var F=this.tryEntries[L];if(F.tryLoc<=this.prev&&n.call(F,"finallyLoc")&&this.prev<F.finallyLoc){var U=F;break}}U&&(A==="break"||A==="continue")&&U.tryLoc<=E&&E<=U.finallyLoc&&(U=null);var G=U?U.completion:{};return G.type=A,G.arg=E,U?(this.method="next",this.next=U.finallyLoc,R):this.complete(G)},complete:function(A,E){if(A.type==="throw")throw A.arg;return A.type==="break"||A.type==="continue"?this.next=A.arg:A.type==="return"?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):A.type==="normal"&&E&&(this.next=E),R},finish:function(A){for(var E=this.tryEntries.length-1;E>=0;--E){var L=this.tryEntries[E];if(L.finallyLoc===A)return this.complete(L.completion,L.afterLoc),k(L),R}},catch:function(A){for(var E=this.tryEntries.length-1;E>=0;--E){var L=this.tryEntries[E];if(L.tryLoc===A){var F=L.completion;if(F.type==="throw"){var U=F.arg;k(L)}return U}}throw Error("illegal catch attempt")},delegateYield:function(A,E,L){return this.delegate={iterator:_(A),resultName:E,nextLoc:L},this.method==="next"&&(this.arg=r),R}},e}function Tn(r,e){return Tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Tn(r,e)}function Es(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=et(r))!==null;);return r}function Rs(r,e,t,n){var i=Rn(et(r.prototype),e,t);return typeof i=="function"?function(s){return i.apply(t,s)}:i}function Ts(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Is(r){var e=Ts(r,"string");return typeof e=="symbol"?e:e+""}function at(r){"@babel/helpers - typeof";return at=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(r)}var Wt=function(){function r(){ae(this,r)}return le(r,[{key:"listenForWhisper",value:function(t,n){return this.listen(".client-"+t,n)}},{key:"notification",value:function(t){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",t)}},{key:"stopListeningForWhisper",value:function(t,n){return this.stopListening(".client-"+t,n)}}])}();function _t(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(r);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(r,n[i])&&(t[n[i]]=r[n[i]]);return t}function Pt(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function u(m){try{d(n.next(m))}catch(b){o(b)}}function f(m){try{d(n.throw(m))}catch(b){o(b)}}function d(m){m.done?s(m.value):i(m.value).then(u,f)}d((n=n.apply(r,[])).next())})}var kn=function(){function r(e){ae(this,r),this.namespace=e}return le(r,[{key:"format",value:function(t){return[".","\\"].includes(t.charAt(0))?t.substring(1):(this.namespace&&(t=this.namespace+"."+t),t.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(t){this.namespace=t}}])}(),Dn=function(r){function e(t,n,i){var s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return ae(this,e),s=ve(this,e),s._alertErrorListeners=function(u){u&&s.errorListeners.forEach(function(f){return f(u)})},s.name=n,s.ably=t,s.options=i,s.eventFormatter=new kn(s.options.namespace),s.subscribedListeners=[],s.errorListeners=[],s.channel=t.channels.get(n),s.callbacks=new Map,o&&s.subscribe(),s}return me(e,r),le(e,[{key:"subscribe",value:function(){var n=this;this.channel.on(function(i){var s=i.previous,o=i.current,u=i.reason;s!=="attached"&&o=="attached"?n.subscribedListeners.forEach(function(f){return f()}):u&&n._alertErrorListeners(i)}),this.channel.attach(this._alertErrorListeners)}},{key:"unsubscribe",value:function(){this.channel.unsubscribe(),this.callbacks.clear(),this.unregisterError(),this.unregisterSubscribed(),this.channel.off(),this.channel.detach()}},{key:"listen",value:function(n,i){return this.callbacks.set(i,function(s){var o=s.data,u=_t(s,["data"]);return i(o,u)}),this.channel.subscribe(this.eventFormatter.format(n),this.callbacks.get(i)),this}},{key:"listenToAll",value:function(n){var i=this;return this.callbacks.set(n,function(s){var o=s.name,u=s.data,f=_t(s,["name","data"]),d=i.options.namespace.replace(/\./g,"\\"),m=o.startsWith(d)?o.substring(d.length+1):"."+o;n(m,u,f)}),this.channel.subscribe(this.callbacks.get(n)),this}},{key:"stopListening",value:function(n,i){return i?(this.channel.unsubscribe(this.eventFormatter.format(n),this.callbacks.get(i)),this.callbacks.delete(i)):this.channel.unsubscribe(this.eventFormatter.format(n)),this}},{key:"stopListeningToAll",value:function(n){return n?(this.channel.unsubscribe(this.callbacks.get(n)),this.callbacks.delete(n)):this.channel.unsubscribe(),this}},{key:"subscribed",value:function(n){return this.subscribedListeners.push(n),this}},{key:"error",value:function(n){return this.errorListeners.push(n),this}},{key:"unregisterSubscribed",value:function(n){return n?this.subscribedListeners=this.subscribedListeners.filter(function(i){return i!=n}):this.subscribedListeners=[],this}},{key:"unregisterError",value:function(n){return n?this.errorListeners=this.errorListeners.filter(function(i){return i!=n}):this.errorListeners=[],this}}])}(Wt),xs=function(r){function e(t,n,i,s){var o;return ae(this,e),o=ve(this,e,[t,n,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.subscribe(),o}return me(e,r),le(e,[{key:"whisper",value:function(n,i,s){return s?this.channel.publish("client-".concat(n),i,s):this.channel.publish("client-".concat(n),i),this}}])}(Dn),hi=function(r){function e(t,n,i,s){var o;return ae(this,e),o=ve(this,e,[t,n,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.channel.on("attached",function(){return o.enter(o.presenceData,o._alertErrorListeners)}),o.subscribe(),o}return me(e,r),le(e,[{key:"unsubscribe",value:function(){this.leave(this.presenceData,this._alertErrorListeners),this.channel.presence.unsubscribe(),Rs(e,"unsubscribe",this)([])}},{key:"here",value:function(n){var i=this;return this.channel.presence.subscribe(["enter","update","leave"],function(){return i.channel.presence.get(function(s,o){return n(o.map(function(u){var f=u.data;return f}),s)})}),this}},{key:"joining",value:function(n){return this.channel.presence.subscribe(["enter","update"],function(i){var s=i.data,o=_t(i,["data"]);n(s,o)}),this}},{key:"leaving",value:function(n){return this.channel.presence.subscribe("leave",function(i){var s=i.data,o=_t(i,["data"]);n(s,o)}),this}},{key:"enter",value:function(n,i){return this.channel.presence.enter(n,i),this}},{key:"leave",value:function(n,i){return this.channel.presence.leave(n,i),this}},{key:"update",value:function(n,i){return this.channel.presence.update(n,i),this}},{key:"whisper",value:function(n,i,s){return s?this.channel.publish("client-".concat(n),i,s):this.channel.publish("client-".concat(n),i),this}}])}(Dn),_s=function(e){return e==null||e===void 0},pi=function(e){var t=e.split(".")[0],n=t.replace("-","+").replace("_","/"),i=JSON.parse(Zn(n)),s=e.split(".")[1],o=s.replace("-","+").replace("_","/"),u=JSON.parse(Zn(o));return{header:i,payload:u}},rn=function(e){var t=pi(e),n=t.payload;return{clientId:n["x-ably-clientId"],expires:n.exp*1e3,issued:n.iat*1e3,token:e}},qt=(typeof window>"u"?"undefined":at(window))==="object",Zn=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/"),n=e.length%4===0?"":"=".repeat(4-e.length%4),i=t+n;return qt?atob(i):Buffer.from(i,"base64").toString()},Ps=function(e){var t="";return qt?t=btoa(e):t=Buffer.from(e).toString("base64"),t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},Ms=function(e){return e&&e.indexOf("http://")===0||e.indexOf("https://")===0},Ls=function(e){var t,n,i;if(!Ms(e)&&typeof window<"u"){var s=(t=window==null?void 0:window.location)===null||t===void 0?void 0:t.hostname,o=(n=window==null?void 0:window.location)===null||n===void 0?void 0:n.port,u=(i=window==null?void 0:window.location)===null||i===void 0?void 0:i.protocol.replace(":","");if(s&&o&&u)return u+"://"+s+":"+o+e}return e},on;function ks(r,e){on||(on=new Ably.Rest.Platform.Http),qt?delete r.headers["Content-Length"]:r.method=r.method.toLowerCase(),on.doUri(r.method,null,r.uri,r.headers,r.body,r.paramsIfNoHeaders||{},e)}var Ds=function(e){return new Promise(function(t,n){ks(e,function(i,s){if(i)n(i);else if(typeof s=="string")t(JSON.parse(s));else if(!qt&&Buffer.isBuffer(s))try{t(JSON.parse(s.toString()))}catch{t(s)}else t(s)})})},er=!1,Ns=function(e,t){var n=e.channels.get("dummy");if(n.__proto__.authorizeChannel=t,er)return;var i=n.__proto__._attach;if(_s(i)){console.warn("Failed to enable authorize for pre-attach, please check for right library version");return}function s(o,u,f){var d=this;if(!this.authorizing){this.authorizing=!0;var m=i.bind(this);this.authorizeChannel(this,function(b){if(d.authorizing=!1,b){f?f(b):console.error("channel ".concat(d.name," auth error => ").concat(b));return}else m(o,u,f)})}}n.__proto__._attach=s,er=!0},Fs=le(function r(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;ae(this,r),this.execute=function(i){return new Promise(function(s,o){e.queue.run(function(){return Pt(e,void 0,void 0,Ue().mark(function u(){var f,d,m;return Ue().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.prev=0,C.next=3,i(this.cachedToken);case 3:f=C.sent,d=f.token,m=f.info,this.cachedToken=d,s({token:d,info:m}),C.next=13;break;case 10:C.prev=10,C.t0=C.catch(0),o(C.t0);case 13:case"end":return C.stop()}},u,this,[[0,10]])}))})})},this.request=function(i){return e.execute(function(s){return e.requestTokenFn(i,s)})},this.cachedToken=t,this.requestTokenFn=n,this.queue=new js}),js=le(function r(){var e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;ae(this,r),this.canRunNext=function(){return e.running.length<e.count&&e.todo.length},this.run=function(i){return Pt(e,void 0,void 0,Ue().mark(function s(){var o;return Ue().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:i&&this.todo.push(i);case 1:if(!this.canRunNext()){f.next=9;break}return o=this.todo.shift(),this.running.push(o),f.next=6,o();case 6:this.running.shift(),f.next=1;break;case 9:case"end":return f.stop()}},s,this)}))},this.total=t.length,this.todo=t,this.running=[],this.count=n}),Us=le(function r(e,t){var n=this;ae(this,r),this.expiredAuthChannels=new Set,this.setExpired=function(f){return n.expiredAuthChannels.add(f)},this.isExpired=function(f){return n.expiredAuthChannels.has(f)},this.removeExpired=function(f){return n.expiredAuthChannels.delete(f)},this.options={queryTime:!0,useTokenAuth:!0,authCallback:function(d,m){return Pt(n,void 0,void 0,Ue().mark(function b(){var C,T,l;return Ue().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.prev=0,R.next=3,this.authRequestExecuter.request(null);case 3:C=R.sent,T=C.token,l=rn(T),m(null,l),R.next=12;break;case 9:R.prev=9,R.t0=R.catch(0),m(R.t0,null);case 12:case"end":return R.stop()}},b,this,[[0,9]])}))},echoMessages:!1},this.requestToken=function(f,d){return Pt(n,void 0,void 0,Ue().mark(function m(){var b,C;return Ue().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return b=JSON.stringify({channel_name:f,token:d}),C={uri:this.authEndpoint,method:"POST",headers:_e({Accept:"application/json","Content-Type":"application/json","Content-Length":b.length},this.authHeaders),body:b},l.next=4,Ds(C);case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},m,this)}))},this.ablyClient=function(){return n.ablyConnector.ably},this.existingToken=function(){return n.ablyClient().auth.tokenDetails},this.getChannel=function(f){return n.ablyConnector.channels[f]},this.enableAuthorizeBeforeChannelAttach=function(){var f=n.ablyClient();f.auth.getTimestamp(n.options.queryTime,function(){}),Ns(f,function(d,m){var b=d.name;if(b.startsWith("public:")){m(null);return}var C=n.existingToken();if(C&&!n.isExpired(b)){var T=pi(C.token).payload["x-ably-capability"],l=T.includes("".concat(b,'"'));if(l&&C.expires>f.auth.getTimestampUsingOffset()){m(null);return}}n.authRequestExecuter.request(b).then(function(S){var R=S.token,I=S.info,y=n.getChannel(b);n.setPresenceInfo(y,I),n.tryAuthorizeOnSameConnection(_e(_e({},n.options),{token:rn(R)}),function(O,x){O?m(O):(n.removeExpired(b),m(null))})}).catch(function(S){return m(S)})})},this.allowReconnectOnUserLogin=function(){var f=n.ablyClient().connection,d=function(b){b.reason.code==40102&&(f.off(d),console.warn("User login detected, re-connecting again!"),n.onClientIdChanged())};f.on("failed",d)},this.onClientIdChanged=function(){n.ablyClient().connect();for(var f=0,d=Object.values(n.ablyConnector.channels);f<d.length;f++){var m=d[f];m.channel.attach(m._alertErrorListeners)}},this.tryAuthorizeOnSameConnection=function(f,d){n.ablyClient().auth.authorize(null,f,d)},this.onChannelFailed=function(f){return function(d){var m;((m=d.reason)===null||m===void 0?void 0:m.code)==40160&&n.handleChannelAuthError(f)}},this.handleChannelAuthError=function(f){if(!f.skipAuth){var d=f.name;n.authRequestExecuter.request(d).then(function(m){var b=m.token,C=m.info;n.setPresenceInfo(f,C),n.tryAuthorizeOnSameConnection(_e(_e({},n.options),{token:rn(b)}),function(T,l){T?f._alertErrorListeners(T):(f.skipAuth=!0,f.channel.once("attached",function(){f.skipAuth=!1}),f.channel.attach(f._alertErrorListeners))})}).catch(function(m){return f._alertErrorListeners(m)})}},this.setPresenceInfo=function(f,d){f instanceof hi&&(f.presenceData=d)},this.ablyConnector=e;var i=t.authEndpoint,s=t.auth.headers,o=t.token,u=t.requestTokenFn;this.authEndpoint=Ls(i),this.authHeaders=s,this.authRequestExecuter=new Fs(o,u??this.requestToken)}),Kt=function(r){function e(t,n,i){var s;return ae(this,e),s=ve(this,e),s.name=n,s.pusher=t,s.options=i,s.eventFormatter=new kn(s.options.namespace),s.subscribe(),s}return me(e,r),le(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(n,i){return this.on(this.eventFormatter.format(n),i),this}},{key:"listenToAll",value:function(n){var i=this;return this.subscription.bind_global(function(s,o){if(!s.startsWith("pusher:")){var u=i.options.namespace.replace(/\./g,"\\"),f=s.startsWith(u)?s.substring(u.length+1):"."+s;n(f,o)}}),this}},{key:"stopListening",value:function(n,i){return i?this.subscription.unbind(this.eventFormatter.format(n),i):this.subscription.unbind(this.eventFormatter.format(n)),this}},{key:"stopListeningToAll",value:function(n){return n?this.subscription.unbind_global(n):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(n){return this.on("pusher:subscription_succeeded",function(){n()}),this}},{key:"error",value:function(n){return this.on("pusher:subscription_error",function(i){n(i)}),this}},{key:"on",value:function(n,i){return this.subscription.bind(n,i),this}}])}(Wt),Bs=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"whisper",value:function(n,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(n),i),this}}])}(Kt),Hs=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"whisper",value:function(n,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(n),i),this}}])}(Kt),$s=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"here",value:function(n){return this.on("pusher:subscription_succeeded",function(i){n(Object.keys(i.members).map(function(s){return i.members[s]}))}),this}},{key:"joining",value:function(n){return this.on("pusher:member_added",function(i){n(i.info)}),this}},{key:"whisper",value:function(n,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(n),i),this}},{key:"leaving",value:function(n){return this.on("pusher:member_removed",function(i){n(i.info)}),this}}])}(Kt),gi=function(r){function e(t,n,i){var s;return ae(this,e),s=ve(this,e),s.events={},s.listeners={},s.name=n,s.socket=t,s.options=i,s.eventFormatter=new kn(s.options.namespace),s.subscribe(),s}return me(e,r),le(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(n,i){return this.on(this.eventFormatter.format(n),i),this}},{key:"stopListening",value:function(n,i){return this.unbindEvent(this.eventFormatter.format(n),i),this}},{key:"subscribed",value:function(n){return this.on("connect",function(i){n(i)}),this}},{key:"error",value:function(n){return this}},{key:"on",value:function(n,i){var s=this;return this.listeners[n]=this.listeners[n]||[],this.events[n]||(this.events[n]=function(o,u){s.name===o&&s.listeners[n]&&s.listeners[n].forEach(function(f){return f(u)})},this.socket.on(n,this.events[n])),this.listeners[n].push(i),this}},{key:"unbind",value:function(){var n=this;Object.keys(this.events).forEach(function(i){n.unbindEvent(i)})}},{key:"unbindEvent",value:function(n,i){this.listeners[n]=this.listeners[n]||[],i&&(this.listeners[n]=this.listeners[n].filter(function(s){return s!==i})),(!i||this.listeners[n].length===0)&&(this.events[n]&&(this.socket.removeListener(n,this.events[n]),delete this.events[n]),delete this.listeners[n])}}])}(Wt),vi=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"whisper",value:function(n,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(n),data:i}),this}}])}(gi),Gs=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"here",value:function(n){return this.on("presence:subscribed",function(i){n(i.map(function(s){return s.user_info}))}),this}},{key:"joining",value:function(n){return this.on("presence:joining",function(i){return n(i.user_info)}),this}},{key:"whisper",value:function(n,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(n),data:i}),this}},{key:"leaving",value:function(n){return this.on("presence:leaving",function(i){return n(i.user_info)}),this}}])}(vi),Mt=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(n,i){return this}},{key:"listenToAll",value:function(n){return this}},{key:"stopListening",value:function(n,i){return this}},{key:"subscribed",value:function(n){return this}},{key:"error",value:function(n){return this}},{key:"on",value:function(n,i){return this}}])}(Wt),tr=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"whisper",value:function(n,i){return this}}])}(Mt),Vs=function(r){function e(){return ae(this,e),ve(this,e,arguments)}return me(e,r),le(e,[{key:"here",value:function(n){return this}},{key:"joining",value:function(n){return this}},{key:"whisper",value:function(n,i){return this}},{key:"leaving",value:function(n){return this}}])}(Mt),Jt=function(){function r(e){ae(this,r),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(e),this.connect()}return le(r,[{key:"setOptions",value:function(t){this.options=_e(this._defaultOptions,t);var n=this.csrfToken();return n&&(this.options.auth.headers["X-CSRF-TOKEN"]=n,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=n),n=this.options.bearerToken,n&&(this.options.auth.headers.Authorization="Bearer "+n,this.options.userAuthentication.headers.Authorization="Bearer "+n),t}},{key:"csrfToken",value:function(){var t;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(t=document.querySelector('meta[name="csrf-token"]'))?t.getAttribute("content"):null}}])}(),nr=function(r){function e(){var t;return ae(this,e),t=ve(this,e,arguments),t.channels={},t}return me(e,r),le(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(n,i,s){return this.channel(n).listen(i,s)}},{key:"channel",value:function(n){return this.channels[n]||(this.channels[n]=new Kt(this.pusher,n,this.options)),this.channels[n]}},{key:"privateChannel",value:function(n){return this.channels["private-"+n]||(this.channels["private-"+n]=new Bs(this.pusher,"private-"+n,this.options)),this.channels["private-"+n]}},{key:"encryptedPrivateChannel",value:function(n){return this.channels["private-encrypted-"+n]||(this.channels["private-encrypted-"+n]=new Hs(this.pusher,"private-encrypted-"+n,this.options)),this.channels["private-encrypted-"+n]}},{key:"presenceChannel",value:function(n){return this.channels["presence-"+n]||(this.channels["presence-"+n]=new $s(this.pusher,"presence-"+n,this.options)),this.channels["presence-"+n]}},{key:"leave",value:function(n){var i=this,s=[n,"private-"+n,"private-encrypted-"+n,"presence-"+n];s.forEach(function(o,u){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(n){this.channels[n]&&(this.channels[n].unsubscribe(),delete this.channels[n])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}])}(Jt),zs=function(r){function e(){var t;return ae(this,e),t=ve(this,e,arguments),t.channels={},t}return me(e,r),le(e,[{key:"connect",value:function(){var n=this,i=this.getSocketIO();return this.socket=i(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(n.channels).forEach(function(s){s.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(n,i,s){return this.channel(n).listen(i,s)}},{key:"channel",value:function(n){return this.channels[n]||(this.channels[n]=new gi(this.socket,n,this.options)),this.channels[n]}},{key:"privateChannel",value:function(n){return this.channels["private-"+n]||(this.channels["private-"+n]=new vi(this.socket,"private-"+n,this.options)),this.channels["private-"+n]}},{key:"presenceChannel",value:function(n){return this.channels["presence-"+n]||(this.channels["presence-"+n]=new Gs(this.socket,"presence-"+n,this.options)),this.channels["presence-"+n]}},{key:"leave",value:function(n){var i=this,s=[n,"private-"+n,"presence-"+n];s.forEach(function(o){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(n){this.channels[n]&&(this.channels[n].unsubscribe(),delete this.channels[n])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}])}(Jt),Ws=function(r){function e(){var t;return ae(this,e),t=ve(this,e,arguments),t.channels={},t}return me(e,r),le(e,[{key:"connect",value:function(){}},{key:"listen",value:function(n,i,s){return new Mt}},{key:"channel",value:function(n){return new Mt}},{key:"privateChannel",value:function(n){return new tr}},{key:"encryptedPrivateChannel",value:function(n){return new tr}},{key:"presenceChannel",value:function(n){return new Vs}},{key:"leave",value:function(n){}},{key:"leaveChannel",value:function(n){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}])}(Jt),mi=function(r){function e(){var t;return ae(this,e),t=ve(this,e,arguments),t.channels={},t}return me(e,r),le(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.ably=this.options.client:(this.ablyAuth=new Us(this,this.options),this.options.agents||(this.options.agents={}),this.options.agents["laravel-echo"]=e.LIB_VERSION,this.ably=new Ably.Realtime(_e(_e({},this.ablyAuth.options),this.options)),this.ablyAuth.enableAuthorizeBeforeChannelAttach(),this.ablyAuth.allowReconnectOnUserLogin())}},{key:"listen",value:function(n,i,s){return this.channel(n).listen(i,s)}},{key:"channel",value:function(n){var i="public:".concat(n);return this.channels[i]||(this.channels[i]=new Dn(this.ably,i,this.options)),this.channels[i]}},{key:"privateChannel",value:function(n){var i="private:".concat(n);return this.channels[i]||(this.channels[i]=new xs(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"presenceChannel",value:function(n){var i="presence:".concat(n);return this.channels[i]||(this.channels[i]=new hi(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"leave",value:function(n){var i=this,s=["public:".concat(n),"private:".concat(n),"presence:".concat(n)];s.forEach(function(o,u){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(n){if(n.indexOf("public:")!==0&&n.indexOf("private:")!==0&&n.indexOf("presence:")!==0)throw new Error("Error leaving ".concat(n,', name should be prefixed with either "public:", "private:" or "presence:"'));this.channels[n]&&(this.channels[n].unsubscribe(),this.ablyAuth.setExpired(n),delete this.channels[n])}},{key:"socketId",value:function(){var n,i={connectionKey:this.ably.connection.key,clientId:(n=this.ably.auth.clientId)!==null&&n!==void 0?n:null};return Ps(JSON.stringify(i))}},{key:"disconnect",value:function(){this.ably.close()}}])}(Jt);mi.LIB_VERSION="1.0.6";var qs=function(){function r(e){ae(this,r),this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return le(r,[{key:"channel",value:function(t){return this.connector.channel(t)}},{key:"connect",value:function(){if(this.options.broadcaster=="ably")this.connector=new mi(this.options);else if(this.options.broadcaster=="reverb")this.connector=new nr(_e(_e({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new nr(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new zs(this.options);else if(this.options.broadcaster=="null")this.connector=new Ws(this.options);else if(typeof this.options.broadcaster=="function")this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(at(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(t){return this.connector.presenceChannel(t)}},{key:"leave",value:function(t){this.connector.leave(t)}},{key:"leaveChannel",value:function(t){this.connector.leaveChannel(t)}},{key:"leaveAllChannels",value:function(){for(var t in this.connector.channels)this.leaveChannel(t)}},{key:"listen",value:function(t,n,i){return this.connector.listen(t,n,i)}},{key:"private",value:function(t){return this.connector.privateChannel(t)}},{key:"encryptedPrivate",value:function(t){return this.connector.encryptedPrivateChannel(t)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":at(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var t=this;Vue.http.interceptors.push(function(n,i){t.socketId()&&n.headers.set("X-Socket-ID",t.socketId()),i()})}},{key:"registerAxiosRequestInterceptor",value:function(){var t=this;axios.interceptors.request.use(function(n){return t.socketId()&&(n.headers["X-Socket-Id"]=t.socketId()),n})}},{key:"registerjQueryAjaxSetup",value:function(){var t=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(n,i,s){t.socketId()&&s.setRequestHeader("X-Socket-Id",t.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var t=this;document.addEventListener("turbo:before-fetch-request",function(n){n.detail.fetchOptions.headers["X-Socket-Id"]=t.socketId()})}}])}(),dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nn(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var yi={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(r,e){(function(n,i){r.exports=i()})(window,function(){return function(t){var n={};function i(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=n,i.d=function(s,o,u){i.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:u})},i.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,o){if(o&1&&(s=i(s)),o&8||o&4&&typeof s=="object"&&s&&s.__esModule)return s;var u=Object.create(null);if(i.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:s}),o&2&&typeof s!="string")for(var f in s)i.d(u,f,(function(d){return s[d]}).bind(null,f));return u},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=42)}([function(t,n,i){i.r(n),i.d(n,"__extends",function(){return o}),i.d(n,"__assign",function(){return u}),i.d(n,"__rest",function(){return f}),i.d(n,"__decorate",function(){return d}),i.d(n,"__param",function(){return m}),i.d(n,"__metadata",function(){return b}),i.d(n,"__awaiter",function(){return C}),i.d(n,"__generator",function(){return T}),i.d(n,"__createBinding",function(){return l}),i.d(n,"__exportStar",function(){return S}),i.d(n,"__values",function(){return R}),i.d(n,"__read",function(){return I}),i.d(n,"__spread",function(){return y}),i.d(n,"__spreadArrays",function(){return O}),i.d(n,"__spreadArray",function(){return x}),i.d(n,"__await",function(){return p}),i.d(n,"__asyncGenerator",function(){return h}),i.d(n,"__asyncDelegator",function(){return c}),i.d(n,"__asyncValues",function(){return a}),i.d(n,"__makeTemplateObject",function(){return v}),i.d(n,"__importStar",function(){return w}),i.d(n,"__importDefault",function(){return D}),i.d(n,"__classPrivateFieldGet",function(){return k}),i.d(n,"__classPrivateFieldSet",function(){return M});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var s=function(_,A){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,L){E.__proto__=L}||function(E,L){for(var F in L)Object.prototype.hasOwnProperty.call(L,F)&&(E[F]=L[F])},s(_,A)};function o(_,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");s(_,A);function E(){this.constructor=_}_.prototype=A===null?Object.create(A):(E.prototype=A.prototype,new E)}var u=function(){return u=Object.assign||function(A){for(var E,L=1,F=arguments.length;L<F;L++){E=arguments[L];for(var U in E)Object.prototype.hasOwnProperty.call(E,U)&&(A[U]=E[U])}return A},u.apply(this,arguments)};function f(_,A){var E={};for(var L in _)Object.prototype.hasOwnProperty.call(_,L)&&A.indexOf(L)<0&&(E[L]=_[L]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var F=0,L=Object.getOwnPropertySymbols(_);F<L.length;F++)A.indexOf(L[F])<0&&Object.prototype.propertyIsEnumerable.call(_,L[F])&&(E[L[F]]=_[L[F]]);return E}function d(_,A,E,L){var F=arguments.length,U=F<3?A:L===null?L=Object.getOwnPropertyDescriptor(A,E):L,G;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")U=Reflect.decorate(_,A,E,L);else for(var V=_.length-1;V>=0;V--)(G=_[V])&&(U=(F<3?G(U):F>3?G(A,E,U):G(A,E))||U);return F>3&&U&&Object.defineProperty(A,E,U),U}function m(_,A){return function(E,L){A(E,L,_)}}function b(_,A){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(_,A)}function C(_,A,E,L){function F(U){return U instanceof E?U:new E(function(G){G(U)})}return new(E||(E=Promise))(function(U,G){function V(N){try{P(L.next(N))}catch(j){G(j)}}function H(N){try{P(L.throw(N))}catch(j){G(j)}}function P(N){N.done?U(N.value):F(N.value).then(V,H)}P((L=L.apply(_,A||[])).next())})}function T(_,A){var E={label:0,sent:function(){if(U[0]&1)throw U[1];return U[1]},trys:[],ops:[]},L,F,U,G;return G={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function V(P){return function(N){return H([P,N])}}function H(P){if(L)throw new TypeError("Generator is already executing.");for(;E;)try{if(L=1,F&&(U=P[0]&2?F.return:P[0]?F.throw||((U=F.return)&&U.call(F),0):F.next)&&!(U=U.call(F,P[1])).done)return U;switch(F=0,U&&(P=[P[0]&2,U.value]),P[0]){case 0:case 1:U=P;break;case 4:return E.label++,{value:P[1],done:!1};case 5:E.label++,F=P[1],P=[0];continue;case 7:P=E.ops.pop(),E.trys.pop();continue;default:if(U=E.trys,!(U=U.length>0&&U[U.length-1])&&(P[0]===6||P[0]===2)){E=0;continue}if(P[0]===3&&(!U||P[1]>U[0]&&P[1]<U[3])){E.label=P[1];break}if(P[0]===6&&E.label<U[1]){E.label=U[1],U=P;break}if(U&&E.label<U[2]){E.label=U[2],E.ops.push(P);break}U[2]&&E.ops.pop(),E.trys.pop();continue}P=A.call(_,E)}catch(N){P=[6,N],F=0}finally{L=U=0}if(P[0]&5)throw P[1];return{value:P[0]?P[1]:void 0,done:!0}}}var l=Object.create?function(_,A,E,L){L===void 0&&(L=E),Object.defineProperty(_,L,{enumerable:!0,get:function(){return A[E]}})}:function(_,A,E,L){L===void 0&&(L=E),_[L]=A[E]};function S(_,A){for(var E in _)E!=="default"&&!Object.prototype.hasOwnProperty.call(A,E)&&l(A,_,E)}function R(_){var A=typeof Symbol=="function"&&Symbol.iterator,E=A&&_[A],L=0;if(E)return E.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&L>=_.length&&(_=void 0),{value:_&&_[L++],done:!_}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function I(_,A){var E=typeof Symbol=="function"&&_[Symbol.iterator];if(!E)return _;var L=E.call(_),F,U=[],G;try{for(;(A===void 0||A-- >0)&&!(F=L.next()).done;)U.push(F.value)}catch(V){G={error:V}}finally{try{F&&!F.done&&(E=L.return)&&E.call(L)}finally{if(G)throw G.error}}return U}function y(){for(var _=[],A=0;A<arguments.length;A++)_=_.concat(I(arguments[A]));return _}function O(){for(var _=0,A=0,E=arguments.length;A<E;A++)_+=arguments[A].length;for(var L=Array(_),F=0,A=0;A<E;A++)for(var U=arguments[A],G=0,V=U.length;G<V;G++,F++)L[F]=U[G];return L}function x(_,A,E){if(E||arguments.length===2)for(var L=0,F=A.length,U;L<F;L++)(U||!(L in A))&&(U||(U=Array.prototype.slice.call(A,0,L)),U[L]=A[L]);return _.concat(U||Array.prototype.slice.call(A))}function p(_){return this instanceof p?(this.v=_,this):new p(_)}function h(_,A,E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var L=E.apply(_,A||[]),F,U=[];return F={},G("next"),G("throw"),G("return"),F[Symbol.asyncIterator]=function(){return this},F;function G(B){L[B]&&(F[B]=function(z){return new Promise(function(J,Q){U.push([B,z,J,Q])>1||V(B,z)})})}function V(B,z){try{H(L[B](z))}catch(J){j(U[0][3],J)}}function H(B){B.value instanceof p?Promise.resolve(B.value.v).then(P,N):j(U[0][2],B)}function P(B){V("next",B)}function N(B){V("throw",B)}function j(B,z){B(z),U.shift(),U.length&&V(U[0][0],U[0][1])}}function c(_){var A,E;return A={},L("next"),L("throw",function(F){throw F}),L("return"),A[Symbol.iterator]=function(){return this},A;function L(F,U){A[F]=_[F]?function(G){return(E=!E)?{value:p(_[F](G)),done:F==="return"}:U?U(G):G}:U}}function a(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=_[Symbol.asyncIterator],E;return A?A.call(_):(_=typeof R=="function"?R(_):_[Symbol.iterator](),E={},L("next"),L("throw"),L("return"),E[Symbol.asyncIterator]=function(){return this},E);function L(U){E[U]=_[U]&&function(G){return new Promise(function(V,H){G=_[U](G),F(V,H,G.done,G.value)})}}function F(U,G,V,H){Promise.resolve(H).then(function(P){U({value:P,done:V})},G)}}function v(_,A){return Object.defineProperty?Object.defineProperty(_,"raw",{value:A}):_.raw=A,_}var g=Object.create?function(_,A){Object.defineProperty(_,"default",{enumerable:!0,value:A})}:function(_,A){_.default=A};function w(_){if(_&&_.__esModule)return _;var A={};if(_!=null)for(var E in _)E!=="default"&&Object.prototype.hasOwnProperty.call(_,E)&&l(A,_,E);return g(A,_),A}function D(_){return _&&_.__esModule?_:{default:_}}function k(_,A,E,L){if(E==="a"&&!L)throw new TypeError("Private accessor was defined without a getter");if(typeof A=="function"?_!==A||!L:!A.has(_))throw new TypeError("Cannot read private member from an object whose class did not declare it");return E==="m"?L:E==="a"?L.call(_):L?L.value:A.get(_)}function M(_,A,E,L,F){if(L==="m")throw new TypeError("Private method is not writable");if(L==="a"&&!F)throw new TypeError("Private accessor was defined without a setter");if(typeof A=="function"?_!==A||!F:!A.has(_))throw new TypeError("Cannot write private member to an object whose class did not declare it");return L==="a"?F.call(_,E):F?F.value=E:A.set(_,E),E}},function(t,n,i){(function(s){Object.defineProperty(n,"__esModule",{value:!0}),n.allToUpperCase=n.allToLowerCase=n.encodeBody=n.decodeBody=n.Format=n.promisify=n.trim=n.arrChooseN=n.randomHexString=n.randomString=n.cheapRandStr=n.dataSizeBytes=n.inspectBody=n.inspectError=n.isErrorInfoOrPartialErrorInfo=n.now=n.parseQueryString=n.toQueryString=n.arrPopRandomElement=n.defaultPostHeaders=n.defaultGetHeaders=n.allSame=n.arrEvery=n.arrFilter=n.arrMap=n.safeArrForEach=n.arrForEach=n.forInOwnNonNullProperties=n.valuesArray=n.keysArray=n.arrWithoutValue=n.arrDeleteValue=n.arrIn=n.arrIndexOf=n.arrSubtract=n.arrIntersectOb=n.arrIntersect=n.intersect=n.containsValue=n.inherits=n.prototypicalClone=n.shallowClone=n.isEmptyArg=n.isOnlyPropIn=n.isEmpty=n.isObject=n.ensureArray=n.isArray=n.copy=n.mixin=void 0,n.arrEquals=n.toBase64=n.matchDerivedChannel=n.shallowEquals=n.getGlobalObject=n.getRetryTime=n.getJitterCoefficient=n.getBackoffCoefficient=void 0;var o=i(0),u=o.__importDefault(i(3)),f=o.__importStar(i(8)),d=o.__importDefault(i(4)),m=i(11),b=i(31);function C($){return Math.floor(Math.random()*$.length)}function T($){for(var q=[],K=1;K<arguments.length;K++)q[K-1]=arguments[K];for(var Z=0;Z<q.length;Z++){var ne=q[Z];if(!ne)break;var Se=Object.prototype.hasOwnProperty;for(var it in ne)(!Se||Se.call(ne,it))&&($[it]=ne[it])}return $}n.mixin=T;function l($){return T({},$)}n.copy=l,n.isArray=Array.isArray||function($){return Object.prototype.toString.call($)=="[object Array]"};function S($){return O($)?[]:(0,n.isArray)($)?$:[$]}n.ensureArray=S;function R($){return Object.prototype.toString.call($)=="[object Object]"}n.isObject=R;function I($){for(var q in $)return!1;return!0}n.isEmpty=I;function y($,q){for(var K in $)if(K!==q)return!1;return!0}n.isOnlyPropIn=y;function O($){return $==null}n.isEmptyArg=O;function x($){var q=new Object;for(var K in $)q[K]=$[K];return q}n.shallowClone=x;function p($,q){var K=function(){function ne(){}return ne}();K.prototype=$;var Z=new K;return q&&T(Z,q),Z}n.prototypicalClone=p;var h=function($,q){if(u.default.Config.inherits){u.default.Config.inherits($,q);return}$.super_=q,$.prototype=p(q.prototype,{constructor:$})};n.inherits=h;function c($,q){for(var K in $)if($[K]==q)return!0;return!1}n.containsValue=c;function a($,q){return(0,n.isArray)(q)?v($,q):g($,q)}n.intersect=a;function v($,q){for(var K=[],Z=0;Z<$.length;Z++){var ne=$[Z];(0,n.arrIndexOf)(q,ne)!=-1&&K.push(ne)}return K}n.arrIntersect=v;function g($,q){for(var K=[],Z=0;Z<$.length;Z++){var ne=$[Z];ne in q&&K.push(ne)}return K}n.arrIntersectOb=g;function w($,q){for(var K=[],Z=0;Z<$.length;Z++){var ne=$[Z];(0,n.arrIndexOf)(q,ne)==-1&&K.push(ne)}return K}n.arrSubtract=w,n.arrIndexOf=Array.prototype.indexOf?function($,q,K){return $.indexOf(q,K)}:function($,q,K){K=K||0;for(var Z=$.length;K<Z;K++)if($[K]===q)return K;return-1};function D($,q){return(0,n.arrIndexOf)($,q)!==-1}n.arrIn=D;function k($,q){var K=(0,n.arrIndexOf)($,q),Z=K!=-1;return Z&&$.splice(K,1),Z}n.arrDeleteValue=k;function M($,q){var K=$.slice();return k(K,q),K}n.arrWithoutValue=M;function _($,q){var K=[];for(var Z in $)q&&!Object.prototype.hasOwnProperty.call($,Z)||K.push(Z);return K}n.keysArray=_;function A($,q){var K=[];for(var Z in $)q&&!Object.prototype.hasOwnProperty.call($,Z)||K.push($[Z]);return K}n.valuesArray=A;function E($,q){for(var K in $)Object.prototype.hasOwnProperty.call($,K)&&$[K]&&q(K)}n.forInOwnNonNullProperties=E,n.arrForEach=Array.prototype.forEach?function($,q){$.forEach(q)}:function($,q){for(var K=$.length,Z=0;Z<K;Z++)q($[Z],Z,$)};function L($,q){return(0,n.arrForEach)($.slice(),q)}n.safeArrForEach=L,n.arrMap=Array.prototype.map?function($,q){return $.map(q)}:function($,q){for(var K=[],Z=$.length,ne=0;ne<Z;ne++)K.push(q($[ne],ne,$));return K},n.arrFilter=Array.prototype.filter?function($,q){return $.filter(q)}:function($,q){for(var K=[],Z=$.length,ne=0;ne<Z;ne++)q($[ne])&&K.push($[ne]);return K},n.arrEvery=Array.prototype.every?function($,q){return $.every(q)}:function($,q){for(var K=$.length,Z=0;Z<K;Z++)if(!q($[Z],Z,$))return!1;return!0};function F($,q){if($.length===0)return!0;var K=$[0][q];return(0,n.arrEvery)($,function(Z){return Z[q]===K})}n.allSame=F;var U={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function G($,q){var K=U[q||ie.json];return{accept:K,"X-Ably-Version":f.default.protocolVersion.toString(),"Ably-Agent":(0,f.getAgentString)($)}}n.defaultGetHeaders=G;function V($,q){var K,Z=K=U[q||ie.json];return{accept:Z,"content-type":K,"X-Ably-Version":f.default.protocolVersion.toString(),"Ably-Agent":(0,f.getAgentString)($)}}n.defaultPostHeaders=V;function H($){return $.splice(C($),1)[0]}n.arrPopRandomElement=H;function P($){var q=[];if($)for(var K in $)q.push(encodeURIComponent(K)+"="+encodeURIComponent($[K]));return q.length?"?"+q.join("&"):""}n.toQueryString=P;function N($){for(var q,K=/([^?&=]+)=?([^&]*)/g,Z={};q=K.exec($);)Z[decodeURIComponent(q[1])]=decodeURIComponent(q[2]);return Z}n.parseQueryString=N,n.now=Date.now||function(){return new Date().getTime()};function j($){return typeof $=="object"&&$!==null&&($.constructor.name=="ErrorInfo"||$.constructor.name=="PartialErrorInfo")}n.isErrorInfoOrPartialErrorInfo=j;function B($){var q,K;return $ instanceof Error||((q=$==null?void 0:$.constructor)===null||q===void 0?void 0:q.name)==="ErrorInfo"||((K=$==null?void 0:$.constructor)===null||K===void 0?void 0:K.name)==="PartialErrorInfo"?$.toString():u.default.Config.inspect($)}n.inspectError=B;function z($){return u.default.BufferUtils.isBuffer($)?$.toString():typeof $=="string"?$:u.default.Config.inspect($)}n.inspectBody=z;function J($){if(u.default.BufferUtils.isBuffer($))return u.default.BufferUtils.byteLength($);if(typeof $=="string")return u.default.Config.stringByteSize($);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof $)}n.dataSizeBytes=J;function Q(){return String(Math.random()).substr(2)}n.cheapRandStr=Q;var X=function($){if(u.default.Config.getRandomValues&&typeof Uint8Array<"u"){var q=new Uint8Array($);return u.default.Config.getRandomValues(q),u.default.BufferUtils.base64Encode(q)}for(var K=u.default.BufferUtils.base64CharSet,Z=Math.round($*4/3),ne="",Se=0;Se<Z;Se++)ne+=K[C(K)];return ne};n.randomString=X;var ee=function($){if(u.default.Config.getRandomValues&&typeof Uint8Array<"u"){var q=new Uint8Array($);return u.default.Config.getRandomValues(q),u.default.BufferUtils.hexEncode(q)}for(var K=u.default.BufferUtils.hexCharSet,Z=$*2,ne="",Se=0;Se<Z;Se++)ne+=K[C(K)];return ne};n.randomHexString=ee;function re($,q){for(var K=Math.min(q,$.length),Z=$.slice(),ne=[],Se=0;Se<K;Se++)ne.push(H(Z));return ne}n.arrChooseN=re,n.trim=String.prototype.trim?function($){return $.trim()}:function($){return $.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Y($,q,K){return new Promise(function(Z,ne){$[q].apply($,o.__spreadArray(o.__spreadArray([],K,!1),[function(Se,it){Se?ne(Se):Z(it)}],!1))})}n.promisify=Y;var ie;(function($){$.msgpack="msgpack",$.json="json"})(ie=n.Format||(n.Format={}));function he($,q){return q=="msgpack"?u.default.Config.msgpack.decode($):JSON.parse(String($))}n.decodeBody=he;function be($,q){return q=="msgpack"?u.default.Config.msgpack.encode($,!0):JSON.stringify($)}n.encodeBody=be;function de($){return $.map(function(q){return q&&q.toLowerCase()})}n.allToLowerCase=de;function je($){return $.map(function(q){return q&&q.toUpperCase()})}n.allToUpperCase=je;function ht($){return Math.min(($+2)/3,2)}n.getBackoffCoefficient=ht;function Pe(){return 1-Math.random()*.2}n.getJitterCoefficient=Pe;function pt($,q){return $*ht(q)*Pe()}n.getRetryTime=pt;function Xt(){return s||(typeof window<"u"?window:self)}n.getGlobalObject=Xt;function Zt($,q){return Object.keys($).every(function(K){return $[K]===q[K]})&&Object.keys(q).every(function(K){return q[K]===$[K]})}n.shallowEquals=Zt;function ji($){var q=/^(\[([^?]*)(?:(.*))\])?(.+)$/,K=$.match(q);if(!K||!K.length||K.length<5)throw new d.default("regex match failed",400,40010);if(K[2])throw new d.default("cannot use a derived option with a ".concat(K[2]," channel"),400,40010);return{qualifierParam:K[3]||"",channelName:K[4]}}n.matchDerivedChannel=ji;function Ui($){return u.default.Config.createHmac?Buffer.from($,"ascii").toString("base64"):(0,m.stringify)((0,b.parse)($))}n.toBase64=Ui;function Bi($,q){return $.length===q.length&&(0,n.arrEvery)($,function(K,Z){return K===q[Z]})}n.arrEquals=Bi}).call(this,i(13))},function(t,n,i){(function(s){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),u=o.__importDefault(i(3)),f=s||(typeof window<"u"?window:self),d;(function(l){l[l.None=0]="None",l[l.Error=1]="Error",l[l.Major=2]="Major",l[l.Minor=3]="Minor",l[l.Micro=4]="Micro"})(d||(d={}));function m(l,S){return"".concat(l).padStart(S?3:2,"0")}function b(l){return u.default.Config.logTimestamps?function(S){var R=new Date;l(m(R.getHours())+":"+m(R.getMinutes())+":"+m(R.getSeconds())+"."+m(R.getMilliseconds(),1)+" "+S)}:l}var C=function(){var l,S,R,I;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((S=(l=f==null?void 0:f.console)===null||l===void 0?void 0:l.log)===null||S===void 0?void 0:S.apply)=="function"?(R=function(){for(var y=[],O=0;O<arguments.length;O++)y[O]=arguments[O];console.log.apply(console,y)},I=console.warn?function(){for(var y=[],O=0;O<arguments.length;O++)y[O]=arguments[O];console.warn.apply(console,y)}:R):f!=null&&f.console.log?R=I=function(){Function.prototype.apply.call(console.log,console,arguments)}:R=I=function(){},[R,I].map(b)},T=function(){function l(){l.logLevel=l.LOG_DEFAULT}return l.initLogHandlers=function(){var S=C(),R=S[0],I=S[1];this.logHandler=R,this.logErrorHandler=I},l.renamedClientOption=function(S,R){l.deprecationWarning("The `".concat(S,"` client option has been renamed to `").concat(R,"`. Please update your code to use `").concat(R,"` instead. `").concat(S,"` will be removed in a future version."))},l.renamedMethod=function(S,R,I){l.deprecationWarning("`".concat(S,"`s `").concat(R,"` method has been renamed to `").concat(I,"`. Please update your code to use `").concat(I,"` instead. `").concat(R,"` will be removed in a future version."))},l.deprecationWarning=function(S){l.shouldLog(d.Error)&&l.logErrorHandler("Ably: Deprecation warning - ".concat(S))},l.logLevel=d.Error,l.LOG_NONE=d.None,l.LOG_ERROR=d.Error,l.LOG_MAJOR=d.Major,l.LOG_MINOR=d.Minor,l.LOG_MICRO=d.Micro,l.LOG_DEFAULT=d.Error,l.LOG_DEBUG=d.Micro,l.logAction=function(S,R,I){l.shouldLog(S)&&(S===d.Error?l.logErrorHandler:l.logHandler)("Ably: "+R+": "+I)},l.deprecated=function(S,R){l.deprecationWarning("".concat(S," is deprecated and will be removed in a future version. ").concat(R))},l.shouldLog=function(S){return S<=l.logLevel},l.setLog=function(S,R){S!==void 0&&(l.logLevel=S),R!==void 0&&(l.logHandler=l.logErrorHandler=R)},l}();n.default=T}).call(this,i(13))},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function o(){}return o}();n.default=s},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.PartialErrorInfo=void 0;var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1));function f(b){var C="["+b.constructor.name;return b.message&&(C+=": "+b.message),b.statusCode&&(C+="; statusCode="+b.statusCode),b.code&&(C+="; code="+b.code),b.cause&&(C+="; cause="+u.inspectError(b.cause)),b.href&&!(b.message&&b.message.indexOf("help.ably.io")>-1)&&(C+="; see "+b.href+" "),C+="]",C}var d=function(b){s.__extends(C,b);function C(T,l,S,R){var I=b.call(this,T)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(I,C.prototype),I.code=l,I.statusCode=S,I.cause=R,I}return C.prototype.toString=function(){return f(this)},C.fromValues=function(T){var l=T,S=l.message,R=l.code,I=l.statusCode;if(typeof S!="string"||typeof R!="number"||typeof I!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(T));var y=Object.assign(new C(S,R,I),T);return y.code&&!y.href&&(y.href="https://help.ably.io/error/"+y.code),y},C}(Error);n.default=d;var m=function(b){s.__extends(C,b);function C(T,l,S,R){var I=b.call(this,T)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(I,C.prototype),I.code=l,I.statusCode=S,I.cause=R,I}return C.prototype.toString=function(){return f(this)},C}(Error);n.PartialErrorInfo=m},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var o=s,u=o.lib,f=u.WordArray,d=f.init,m=f.init=function(b){if(b instanceof ArrayBuffer&&(b=new Uint8Array(b)),(b instanceof Int8Array||typeof Uint8ClampedArray<"u"&&b instanceof Uint8ClampedArray||b instanceof Int16Array||b instanceof Uint16Array||b instanceof Int32Array||b instanceof Uint32Array||b instanceof Float32Array||b instanceof Float64Array)&&(b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength)),b instanceof Uint8Array){for(var C=b.byteLength,T=[],l=0;l<C;l++)T[l>>>2]|=b[l]<<24-l%4*8;d.call(this,T,C)}else d.apply(this,arguments)};m.prototype=f}}(),s.lib.WordArray})},function(t,n,i){(function(s){(function(o,u){t.exports=u()})(this,function(){var o=o||function(u,f){var d;if(typeof window<"u"&&window.crypto&&(d=window.crypto),!d&&typeof window<"u"&&window.msCrypto&&(d=window.msCrypto),!d&&typeof s<"u"&&s.crypto&&(d=s.crypto),!d)try{d=i(44)}catch{}var m=function(){if(d){if(typeof d.getRandomValues=="function")try{return d.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof d.randomBytes=="function")try{return d.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},b=Object.create||function(){function h(){}return function(c){var a;return h.prototype=c,a=new h,h.prototype=null,a}}(),C={},T=C.lib={},l=T.Base=function(){return{extend:function(h){var c=b(this);return h&&c.mixIn(h),(!c.hasOwnProperty("init")||this.init===c.init)&&(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var h=this.extend();return h.init.apply(h,arguments),h},init:function(){},mixIn:function(h){for(var c in h)h.hasOwnProperty(c)&&(this[c]=h[c]);h.hasOwnProperty("toString")&&(this.toString=h.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),S=T.WordArray=l.extend({init:function(h,c){h=this.words=h||[],c!=f?this.sigBytes=c:this.sigBytes=h.length*4},toString:function(h){return(h||I).stringify(this)},concat:function(h){var c=this.words,a=h.words,v=this.sigBytes,g=h.sigBytes;if(this.clamp(),v%4)for(var w=0;w<g;w++){var D=a[w>>>2]>>>24-w%4*8&255;c[v+w>>>2]|=D<<24-(v+w)%4*8}else for(var w=0;w<g;w+=4)c[v+w>>>2]=a[w>>>2];return this.sigBytes+=g,this},clamp:function(){var h=this.words,c=this.sigBytes;h[c>>>2]&=4294967295<<32-c%4*8,h.length=u.ceil(c/4)},clone:function(){var h=l.clone.call(this);return h.words=this.words.slice(0),h},random:function(h){for(var c=[],a=0;a<h;a+=4)c.push(m());return new S.init(c,h)}}),R=C.enc={},I=R.Hex={stringify:function(h){for(var c=h.words,a=h.sigBytes,v=[],g=0;g<a;g++){var w=c[g>>>2]>>>24-g%4*8&255;v.push((w>>>4).toString(16)),v.push((w&15).toString(16))}return v.join("")},parse:function(h){for(var c=h.length,a=[],v=0;v<c;v+=2)a[v>>>3]|=parseInt(h.substr(v,2),16)<<24-v%8*4;return new S.init(a,c/2)}},y=R.Latin1={stringify:function(h){for(var c=h.words,a=h.sigBytes,v=[],g=0;g<a;g++){var w=c[g>>>2]>>>24-g%4*8&255;v.push(String.fromCharCode(w))}return v.join("")},parse:function(h){for(var c=h.length,a=[],v=0;v<c;v++)a[v>>>2]|=(h.charCodeAt(v)&255)<<24-v%4*8;return new S.init(a,c)}},O=R.Utf8={stringify:function(h){try{return decodeURIComponent(escape(y.stringify(h)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(h){return y.parse(unescape(encodeURIComponent(h)))}},x=T.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new S.init,this._nDataBytes=0},_append:function(h){typeof h=="string"&&(h=O.parse(h)),this._data.concat(h),this._nDataBytes+=h.sigBytes},_process:function(h){var c,a=this._data,v=a.words,g=a.sigBytes,w=this.blockSize,D=w*4,k=g/D;h?k=u.ceil(k):k=u.max((k|0)-this._minBufferSize,0);var M=k*w,_=u.min(M*4,g);if(M){for(var A=0;A<M;A+=w)this._doProcessBlock(v,A);c=v.splice(0,M),a.sigBytes-=_}return new S.init(c,_)},clone:function(){var h=l.clone.call(this);return h._data=this._data.clone(),h},_minBufferSize:0});T.Hasher=x.extend({cfg:l.extend(),init:function(h){this.cfg=this.cfg.extend(h),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(h){return this._append(h),this._process(),this},finalize:function(h){h&&this._append(h);var c=this._doFinalize();return c},blockSize:16,_createHelper:function(h){return function(c,a){return new h.init(a).finalize(c)}},_createHmacHelper:function(h){return function(c,a){return new p.HMAC.init(h,a).finalize(c)}}});var p=C.algo={};return C}(Math);return o})}).call(this,i(13))},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(2)),f=s.__importDefault(i(3));function d(C,T,l){try{T.apply(C,l)}catch(S){u.default.logAction(u.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+S+"; stack = "+(S&&S.stack))}}function m(C,T,l){for(var S,R,I,y=0;y<C.length;y++)if(S=C[y],l&&(S=S[l]),o.isArray(S)){for(;(R=o.arrIndexOf(S,T))!==-1;)S.splice(R,1);l&&S.length===0&&delete C[y][l]}else if(o.isObject(S))for(I in S)Object.prototype.hasOwnProperty.call(S,I)&&o.isArray(S[I])&&m([S],T,I)}var b=function(){function C(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return C.prototype.on=function(){for(var T=this,l=[],S=0;S<arguments.length;S++)l[S]=arguments[S];if(l.length===1){var R=l[0];if(typeof R=="function")this.any.push(R);else throw new Error("EventListener.on(): Invalid arguments: "+f.default.Config.inspect(l))}if(l.length===2){var I=l[0],y=l[1];if(typeof y!="function")throw new Error("EventListener.on(): Invalid arguments: "+f.default.Config.inspect(l));if(o.isEmptyArg(I))this.any.push(y);else if(o.isArray(I))I.forEach(function(x){T.on(x,y)});else{if(typeof I!="string")throw new Error("EventListener.on(): Invalid arguments: "+f.default.Config.inspect(l));var O=this.events[I]||(this.events[I]=[]);O.push(y)}}},C.prototype.off=function(){for(var T,l=this,S=[],R=0;R<arguments.length;R++)S[R]=arguments[R];if(S.length==0||o.isEmptyArg(S[0])&&o.isEmptyArg(S[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var I=S[0],y=S[1],O=null,x=null;if(S.length===1||!y)typeof I=="function"?O=I:x=I;else{if(typeof y!="function")throw new Error("EventEmitter.off(): invalid arguments:"+f.default.Config.inspect(S));T=[I,y],x=T[0],O=T[1]}if(O&&o.isEmptyArg(x)){m([this.any,this.events,this.anyOnce,this.eventsOnce],O);return}if(o.isArray(x)){x.forEach(function(p){l.off(p,O)});return}if(typeof x!="string")throw new Error("EventEmitter.off(): invalid arguments:"+f.default.Config.inspect(S));O?m([this.events,this.eventsOnce],O,x):(delete this.events[x],delete this.eventsOnce[x])},C.prototype.listeners=function(T){if(T){var l=this.events[T]||[];return this.eventsOnce[T]&&Array.prototype.push.apply(l,this.eventsOnce[T]),l.length?l:null}return this.any.length?this.any:null},C.prototype.emit=function(T){for(var l=[],S=1;S<arguments.length;S++)l[S-1]=arguments[S];var R={event:T},I=[];this.anyOnce.length&&(Array.prototype.push.apply(I,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(I,this.any);var y=this.eventsOnce[T];y&&(Array.prototype.push.apply(I,y),delete this.eventsOnce[T]);var O=this.events[T];O&&Array.prototype.push.apply(I,O),o.arrForEach(I,function(x){d(R,x,l)})},C.prototype.once=function(){for(var T=this,l=[],S=0;S<arguments.length;S++)l[S]=arguments[S];var R=l.length;if((R===0||R===1&&typeof l[0]!="function")&&f.default.Config.Promise){var I=l[0];return new f.default.Config.Promise(function(c){T.once(I,c)})}var y=l[0],O=l[1];if(l.length===1&&typeof y=="function")this.anyOnce.push(y);else if(o.isEmptyArg(y)){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+f.default.Config.inspect(l));this.anyOnce.push(O)}else if(o.isArray(y)){var x=this,p=function(){var c=Array.prototype.slice.call(arguments);if(o.arrForEach(y,function(a){x.off(a,p)}),typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+f.default.Config.inspect(l));O.apply(this,c)};o.arrForEach(y,function(c){x.on(c,p)})}else{if(typeof y!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+f.default.Config.inspect(l));var h=this.eventsOnce[y]||(this.eventsOnce[y]=[]);if(O){if(typeof O!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+f.default.Config.inspect(l));h.push(O)}}},C.prototype.whenState=function(T,l,S){for(var R=this,I=[],y=3;y<arguments.length;y++)I[y-3]=arguments[y];var O={event:T};if(typeof T!="string"||typeof l!="string")throw"whenState requires a valid event String argument";if(typeof S!="function"&&f.default.Config.Promise)return new f.default.Config.Promise(function(x){C.prototype.whenState.apply(R,[T,l,x].concat(I))});T===l?d(O,S,I):this.once(T,S)},C}();n.default=b},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaults=n.normaliseOptions=n.objectifyOptions=n.getAgentString=n.getHosts=n.getFallbackHosts=n.environmentFallbackHosts=n.getHttpScheme=n.getPort=n.getHost=void 0;var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1)),f=s.__importDefault(i(2)),d=s.__importDefault(i(4)),m=i(43),b="ably-js/"+m.version,C={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:m.version,protocolVersion:2,agent:b,getHost:T,getPort:l,getHttpScheme:S,environmentFallbackHosts:R,getFallbackHosts:I,getHosts:y,checkHost:O,objectifyOptions:c,normaliseOptions:a};function T(g,w,D){return D?w=w==g.restHost&&g.realtimeHost||w||g.realtimeHost:w=w||g.restHost,w}n.getHost=T;function l(g,w){return w||g.tls?g.tlsPort:g.port}n.getPort=l;function S(g){return g.tls?"https://":"http://"}n.getHttpScheme=S;function R(g){return[g+"-a-fallback.ably-realtime.com",g+"-b-fallback.ably-realtime.com",g+"-c-fallback.ably-realtime.com",g+"-d-fallback.ably-realtime.com",g+"-e-fallback.ably-realtime.com"]}n.environmentFallbackHosts=R;function I(g){var w=g.fallbackHosts,D=typeof g.httpMaxRetryCount<"u"?g.httpMaxRetryCount:C.httpMaxRetryCount;return w?u.arrChooseN(w,D):[]}n.getFallbackHosts=I;function y(g){return[g.restHost].concat(I(g))}n.getHosts=y;function O(g){if(typeof g!="string")throw new d.default("host must be a string; was a "+typeof g,4e4,400);if(!g.length)throw new d.default("host must not be zero-length",4e4,400)}function x(g,w,D){return g.realtimeHost?g.realtimeHost:g.restHost?(f.default.logAction(f.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+g.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+g.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),g.restHost):w?C.REALTIME_HOST:D+"-"+C.REALTIME_HOST}function p(g){var w={};for(var D in C.TIMEOUTS)w[D]=g[D]||C.TIMEOUTS[D];return w}function h(g){var w=C.agent;if(g.agents)for(var D in g.agents)w+=" "+D+"/"+g.agents[D];return w}n.getAgentString=h;function c(g){return typeof g=="string"?g.indexOf(":")==-1?{token:g}:{key:g}:g}n.objectifyOptions=c;function a(g){if(g.host&&(f.default.renamedClientOption("host","restHost"),g.restHost=g.host),g.wsHost&&(f.default.renamedClientOption("wsHost","realtimeHost"),g.realtimeHost=g.wsHost),g.queueEvents&&(f.default.renamedClientOption("queueEvents","queueMessages"),g.queueMessages=g.queueEvents),g.headers&&f.default.deprecated("the `headers` client option",""),g.fallbackHostsUseDefault){if(g.fallbackHosts){var w="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw f.default.logAction(f.default.LOG_ERROR,"Defaults.normaliseOptions",w),new d.default(w,4e4,400)}if(g.port||g.tlsPort){var w="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw f.default.logAction(f.default.LOG_ERROR,"Defaults.normaliseOptions",w),new d.default(w,4e4,400)}g.environment?f.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):f.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youre not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if youre using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),g.fallbackHosts=C.FALLBACK_HOSTS}g.recover===!0&&(f.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),g.recover=function(H,P){P(!0)}),typeof g.recover=="function"&&g.closeOnUnload===!0&&(f.default.logAction(f.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),g.recover=void 0),"closeOnUnload"in g||(g.closeOnUnload=!g.recover),g.transports&&u.arrIn(g.transports,"xhr")&&(f.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),u.arrDeleteValue(g.transports,"xhr"),g.transports.push("xhr_streaming")),"queueMessages"in g||(g.queueMessages=!0);var D=g.environment&&String(g.environment).toLowerCase()||C.ENVIRONMENT,k=!D||D==="production";!g.fallbackHosts&&!g.restHost&&!g.realtimeHost&&!g.port&&!g.tlsPort&&(g.fallbackHosts=k?C.FALLBACK_HOSTS:R(D));var M=g.restHost||(k?C.REST_HOST:D+"-"+C.REST_HOST),_=x(g,k,D);u.arrForEach((g.fallbackHosts||[]).concat(M,_),O),g.port=g.port||C.PORT,g.tlsPort=g.tlsPort||C.TLS_PORT,"tls"in g||(g.tls=!0);var A=p(g);if("useBinaryProtocol"in g?g.useBinaryProtocol=o.default.Config.supportsBinary&&g.useBinaryProtocol:g.useBinaryProtocol=o.default.Config.preferBinary,g.clientId){var E=g.headers=g.headers||{};E["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(g.clientId))}"idempotentRestPublishing"in g||(g.idempotentRestPublishing=!0),g.promises&&!o.default.Config.Promise&&(f.default.logAction(f.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),g.promises=!1);var L=null,F=g.connectivityCheckUrl;if(g.connectivityCheckUrl){var U=g.connectivityCheckUrl.split("?"),G=U[0],V=U[1];L=V?u.parseQueryString(V):{},G.indexOf("://")===-1&&(G="https://"+G),F=G}return s.__assign(s.__assign({},g),{useBinaryProtocol:"useBinaryProtocol"in g?o.default.Config.supportsBinary&&g.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:_,restHost:M,maxMessageSize:g.maxMessageSize||C.maxMessageSize,timeouts:A,connectivityCheckParams:L,connectivityCheckUrl:F})}n.normaliseOptions=a,n.default=C;function v(g){return Object.assign(C,g)}n.getDefaults=v},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),u=s.__importDefault(i(2)),f=s.__importDefault(i(4)),d=s.__importStar(i(1));function m(l){return!l||!l.channelOptions?{channelOptions:l,plugins:{},baseEncodedPreviousPayload:void 0}:l}function b(l){if(l&&l.cipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var S=o.default.Crypto.getCipher(l.cipher);return{cipher:S.cipherParams,channelCipher:S.cipher}}return l??{}}function C(l){var S=0;return l.name&&(S+=l.name.length),l.clientId&&(S+=l.clientId.length),l.extras&&(S+=JSON.stringify(l.extras).length),l.data&&(S+=d.dataSizeBytes(l.data)),S}var T=function(){function l(){}return l.prototype.toJSON=function(){var S=this.encoding,R=this.data;return R&&o.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(S=S?S+"/base64":"base64",R=o.default.BufferUtils.base64Encode(R)):R=o.default.BufferUtils.toBuffer(R)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:S,data:R}},l.prototype.toString=function(){var S="[Message";return this.name&&(S+="; name="+this.name),this.id&&(S+="; id="+this.id),this.timestamp&&(S+="; timestamp="+this.timestamp),this.clientId&&(S+="; clientId="+this.clientId),this.connectionId&&(S+="; connectionId="+this.connectionId),this.encoding&&(S+="; encoding="+this.encoding),this.extras&&(S+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?S+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?S+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):S+="; data (json)="+JSON.stringify(this.data)),this.extras&&(S+="; extras="+JSON.stringify(this.extras)),S+="]",S},l.encrypt=function(S,R,I){var y=S.data,O=S.encoding,x=R.channelCipher;O=O?O+"/":"",o.default.BufferUtils.isBuffer(y)||(y=o.default.BufferUtils.utf8Encode(String(y)),O=O+"utf-8/"),x.encrypt(y,function(p,h){if(p){I(p);return}S.data=h,S.encoding=O+"cipher+"+x.algorithm,I(null,S)})},l.encode=function(S,R,I){var y=S.data,O=typeof y=="string"||o.default.BufferUtils.isBuffer(y)||y===null||y===void 0;if(!O)if(d.isObject(y)||d.isArray(y))S.data=JSON.stringify(y),S.encoding=S.encoding?S.encoding+"/json":"json";else throw new f.default("Data type is unsupported",40013,400);R!=null&&R.cipher?l.encrypt(S,R,I):I(null,S)},l.encodeArray=function(S,R,I){for(var y=0,O=0;O<S.length;O++)l.encode(S[O],R,function(x){if(x){I(x);return}y++,y==S.length&&I(null,S)})},l.decode=function(S,R){var I=m(R),y=S.data,O=S.encoding;if(O){var x=O.split("/"),p=void 0,h=x.length,c=S.data,a="";try{for(;(p=h)>0;){var v=x[--h].match(/([-\w]+)(\+([\w-]+))?/);if(!v)break;switch(a=v[1],a){case"base64":c=o.default.BufferUtils.base64Decode(String(c)),p==x.length&&(y=c);continue;case"utf-8":c=o.default.BufferUtils.utf8Decode(c);continue;case"json":c=JSON.parse(c);continue;case"cipher":if(I.channelOptions!=null&&I.channelOptions.cipher&&I.channelOptions.channelCipher){var g=v[3],w=I.channelOptions.channelCipher;if(g!=w.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");c=w.decrypt(c);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!I.plugins||!I.plugins.vcdiff)throw new f.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new f.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var D=I.baseEncodedPreviousPayload;typeof D=="string"&&(D=o.default.BufferUtils.utf8Encode(D)),D=o.default.BufferUtils.toBuffer(D),c=o.default.BufferUtils.toBuffer(c),c=o.default.BufferUtils.typedArrayToBuffer(I.plugins.vcdiff.decode(c,D)),y=c}catch(M){throw new f.default("Vcdiff delta decode failed with "+M,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(M){var k=M;throw new f.default("Error processing the "+a+" encoding, decoder returned "+k.message+"",k.code||40013,400)}finally{S.encoding=p<=0?null:x.slice(0,p).join("/"),S.data=c}}I.baseEncodedPreviousPayload=y},l.fromResponseBody=function(S,R,I){I&&(S=d.decodeBody(S,I));for(var y=0;y<S.length;y++){var O=S[y]=l.fromValues(S[y]);try{l.decode(O,R)}catch(x){u.default.logAction(u.default.LOG_ERROR,"Message.fromResponseBody()",x.toString())}}return S},l.fromValues=function(S){return Object.assign(new l,S)},l.fromValuesArray=function(S){for(var R=S.length,I=new Array(R),y=0;y<R;y++)I[y]=l.fromValues(S[y]);return I},l.fromEncoded=function(S,R){var I=l.fromValues(S),y=b(R??null);try{l.decode(I,y)}catch(O){u.default.logAction(u.default.LOG_ERROR,"Message.fromEncoded()",O.toString())}return I},l.fromEncodedArray=function(S,R){return S.map(function(I){return l.fromEncoded(I,R)})},l.getMessagesSize=function(S){for(var R,I=0,y=0;y<S.length;y++)R=S[y],I+=R.size||(R.size=C(R));return I},l.serialize=d.encodeBody,l}();n.default=T},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(4)),f=s.__importDefault(i(9)),d=s.__importDefault(i(16)),m={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},b=[];Object.keys(m).forEach(function(I){b[m[I]]=I});var C={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},T=Object.keys(C);C.MODE_ALL=C.PRESENCE|C.PUBLISH|C.SUBSCRIBE|C.PRESENCE_SUBSCRIBE;function l(I){var y=[];if(I)for(var O=0;O<I.length;O++)y.push(I[O].toString());return"[ "+y.join(", ")+" ]"}var S="id channel channelSerial connectionId count msgSerial timestamp".split(" "),R=function(){function I(){var y=this;this.hasFlag=function(O){return(y.flags&C[O])>0}}return I.prototype.setFlag=function(y){return this.flags=this.flags|C[y]},I.prototype.getMode=function(){return this.flags&&this.flags&C.MODE_ALL},I.prototype.encodeModesToFlags=function(y){var O=this;y.forEach(function(x){return O.setFlag(x)})},I.prototype.decodeModesFromFlags=function(){var y=this,O=[];return I.channelModes.forEach(function(x){y.hasFlag(x)&&O.push(x)}),O.length>0?O:void 0},I.fromValues=function(y){return Object.assign(new I,y)},I.Action=m,I.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],I.ActionName=b,I.serialize=o.encodeBody,I.deserialize=function(y,O){var x=o.decodeBody(y,O);return I.fromDeserialized(x)},I.fromDeserialized=function(y){var O=y.error;O&&(y.error=u.default.fromValues(O));var x=y.messages;if(x)for(var p=0;p<x.length;p++)x[p]=f.default.fromValues(x[p]);var h=y.presence;if(h)for(var p=0;p<h.length;p++)h[p]=d.default.fromValues(h[p],!0);return Object.assign(new I,y)},I.stringify=function(y){var O="[ProtocolMessage";y.action!==void 0&&(O+="; action="+I.ActionName[y.action]||!1);for(var x,p=0;p<S.length;p++)x=S[p],y[x]!==void 0&&(O+="; "+x+"="+y[x]);if(y.messages&&(O+="; messages="+l(f.default.fromValuesArray(y.messages))),y.presence&&(O+="; presence="+l(d.default.fromValuesArray(y.presence))),y.error&&(O+="; error="+u.default.fromValues(y.error).toString()),y.auth&&y.auth.accessToken&&(O+="; token="+y.auth.accessToken),y.flags&&(O+="; flags="+T.filter(y.hasFlag).join(",")),y.params){var h="";o.forInOwnNonNullProperties(y.params,function(c){h.length>0&&(h+="; "),h+=c+"="+y.params[c]}),h.length>0&&(O+="; params=["+h+"]")}return O+="]",O},I}();n.default=R},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return function(){var o=s,u=o.lib,f=u.WordArray,d=o.enc;d.Base64={stringify:function(b){var C=b.words,T=b.sigBytes,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b.clamp();for(var S=[],R=0;R<T;R+=3)for(var I=C[R>>>2]>>>24-R%4*8&255,y=C[R+1>>>2]>>>24-(R+1)%4*8&255,O=C[R+2>>>2]>>>24-(R+2)%4*8&255,x=I<<16|y<<8|O,p=0;p<4&&R+p*.75<T;p++)S.push(l.charAt(x>>>6*(3-p)&63));var h=l.charAt(64);if(h)for(;S.length%4;)S.push(h);return S.join("")},parse:function(b){var C=b.length,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=this._reverseMap;if(!l){l=this._reverseMap=[];for(var S=0;S<T.length;S++)l[T.charCodeAt(S)]=S}var R=T.charAt(64);if(R){var I=b.indexOf(R);I!==-1&&(C=I)}return m(b,C,l)}};function m(b,C,T){for(var l=[],S=0,R=0;R<C;R++)if(R%4){var I=T[b.charCodeAt(R-1)]<<R%4*2,y=T[b.charCodeAt(R)]>>>6-R%4*2,O=I|y;l[S>>>2]|=O<<24-S%4*8,S++}return f.create(l,S)}}(),s.enc.Base64})},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(10)),f=s.__importDefault(i(26)),d=s.__importDefault(i(2)),m=s.__importDefault(i(8)),b=s.__importDefault(i(21)),C=s.__importDefault(i(18)),T=s.__importDefault(i(4)),l=s.__importDefault(i(22)),S=s.__importDefault(i(3));function R(O){var x=[80015,80017,80030];return O.code?C.default.isTokenErr(O)?!1:o.arrIn(x,O.code)?!0:O.code>=4e4&&O.code<5e4:!1}function I(O){return R(O)?[u.default.fromValues({action:u.default.Action.ERROR,error:O})]:[u.default.fromValues({action:u.default.Action.DISCONNECTED,error:O})]}var y=function(O){s.__extends(x,O);function x(p,h,c){var a=O.call(this,p,h,c,!0)||this;return a.onAuthUpdated=function(v){a.authParams={access_token:v.token}},a.stream="stream"in c?c.stream:!0,a.sendRequest=null,a.recvRequest=null,a.pendingCallback=null,a.pendingItems=null,a}return x.prototype.connect=function(){var p=this;d.default.logAction(d.default.LOG_MINOR,"CometTransport.connect()","starting"),f.default.prototype.connect.call(this);var h=this.params,c=h.options,a=m.default.getHost(c,h.host),v=m.default.getPort(c),g=c.tls?"https://":"http://";this.baseUri=g+a+":"+v+"/comet/";var w=this.baseUri+"connect";d.default.logAction(d.default.LOG_MINOR,"CometTransport.connect()","uri: "+w),this.auth.getAuthParams(function(D,k){if(D){p.disconnect(D);return}if(!p.isDisposed){p.authParams=k;var M=p.params.getConnectParams(k);"stream"in M&&(p.stream=M.stream),d.default.logAction(d.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(M));var _=!1,A=p.recvRequest=p.createRequest(w,null,M,null,p.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV);A.on("data",function(E){p.recvRequest&&(_||(_=!0,p.emit("preconnect")),p.onData(E))}),A.on("complete",function(E){if(p.recvRequest||(E=E||new T.default("Request cancelled",80003,400)),p.recvRequest=null,!_&&!E&&(_=!0,p.emit("preconnect")),p.onActivity(),E){E.code?p.onData(I(E)):p.disconnect(E);return}S.default.Config.nextTick(function(){p.recv()})}),A.exec()}})},x.prototype.requestClose=function(){d.default.logAction(d.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},x.prototype.requestDisconnect=function(){d.default.logAction(d.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},x.prototype._requestCloseOrDisconnect=function(p){var h=this,c=p?this.closeUri:this.disconnectUri;if(c){var a=this.createRequest(c,null,this.authParams,null,l.default.REQ_SEND);a.on("complete",function(v){v&&(d.default.logAction(d.default.LOG_ERROR,"CometTransport.request"+(p?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(v)),h.finish("disconnected",v))}),a.exec()}},x.prototype.dispose=function(){var p=this;d.default.logAction(d.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(d.default.logAction(d.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",b.default.disconnected()),S.default.Config.nextTick(function(){p.emit("disposed")}))},x.prototype.onConnect=function(p){var h;if(!this.isDisposed){var c=(h=p.connectionDetails)===null||h===void 0?void 0:h.connectionKey;f.default.prototype.onConnect.call(this,p);var a=this.baseUri+c;d.default.logAction(d.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+a),this.sendUri=a+"/send",this.recvUri=a+"/recv",this.closeUri=a+"/close",this.disconnectUri=a+"/disconnect"}},x.prototype.send=function(p){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(p);return}var h=this.pendingItems||[];h.push(p),this.pendingItems=null,this.sendItems(h)},x.prototype.sendAnyPending=function(){var p=this.pendingItems;p&&(this.pendingItems=null,this.sendItems(p))},x.prototype.sendItems=function(p){var h=this,c=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(p),l.default.REQ_SEND);c.on("complete",function(a,v){if(a&&d.default.logAction(d.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(a)),h.sendRequest=null,a){a.code?h.onData(I(a)):h.disconnect(a);return}v&&h.onData(v),h.pendingItems&&S.default.Config.nextTick(function(){h.sendRequest||h.sendAnyPending()})}),c.exec()},x.prototype.recv=function(){var p=this;if(!this.recvRequest&&this.isConnected){var h=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV_POLL);h.on("data",function(c){p.onData(c)}),h.on("complete",function(c){if(p.recvRequest=null,p.onActivity(),c){c.code?p.onData(I(c)):p.disconnect(c);return}S.default.Config.nextTick(function(){p.recv()})}),h.exec()}},x.prototype.onData=function(p){try{var h=this.decodeResponse(p);if(h&&h.length)for(var c=0;c<h.length;c++)this.onProtocolMessage(u.default.fromDeserialized(h[c]))}catch(a){d.default.logAction(d.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+a.stack)}},x.prototype.encodeRequest=function(p){return JSON.stringify(p)},x.prototype.decodeResponse=function(p){return typeof p=="string"?JSON.parse(p):p},x}(f.default);n.default=y},function(t,n){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}t.exports=i},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.isSuccessCode=void 0;var s;(function(u){u[u.Success=200]="Success",u[u.NoContent=204]="NoContent",u[u.BadRequest=400]="BadRequest",u[u.Unauthorized=401]="Unauthorized",u[u.Forbidden=403]="Forbidden",u[u.RequestTimeout=408]="RequestTimeout",u[u.InternalServerError=500]="InternalServerError"})(s||(s={}));function o(u){return u>=s.Success&&u<s.BadRequest}n.isSuccessCode=o,n.default=s},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1)),f=s.__importDefault(i(2)),d=s.__importDefault(i(18)),m=s.__importDefault(i(19)),b=i(4),C=s.__importDefault(i(14));function T(O,x,p,h,c){O.http.supportsAuthHeaders?O.auth.getAuthHeaders(function(a,v){a?h(a):c(u.mixin(v,x),p)}):O.auth.getAuthParams(function(a,v){a?h(a):c(x,u.mixin(v,p))})}function l(O,x){return function(p,h,c,a,v){if(p&&!h){O(p);return}if(v===C.default.NoContent){O(p,[],c,!0,v);return}if(!a)try{h=u.decodeBody(h,x)}catch(_){u.isErrorInfoOrPartialErrorInfo(_)?O(_):O(new b.PartialErrorInfo(u.inspectError(_),null));return}if(!h){O(new b.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var g=h,w=g.statusCode,D=g.response,k=g.headers;if(w===void 0){O(p,h,c,!0,v);return}if(w<200||w>=300){var M=D&&D.error||p;M||(M=new Error("Error in unenveloping "+h),M.statusCode=w),O(M,D,k,!0,w);return}O(p,D,k,!0,w)}}function S(O){var x=[];if(O)for(var p in O)x.push(p+"="+O[p]);return x.join("&")}function R(O,x){return O+(x?"?":"")+S(x)}function I(O,x,p,h){return function(c,a,v,g,w){c?f.default.logAction(f.default.LOG_MICRO,"Resource."+x+"()","Received Error; "+R(p,h)+"; Error: "+u.inspectError(c)):f.default.logAction(f.default.LOG_MICRO,"Resource."+x+"()","Received; "+R(p,h)+"; Headers: "+S(v)+"; StatusCode: "+w+"; Body: "+(o.default.BufferUtils.isBuffer(a)?a.toString():a)),O&&O(c,a,v,g,w)}}var y=function(){function O(){}return O.get=function(x,p,h,c,a,v){O.do(m.default.Get,x,p,null,h,c,a,v)},O.delete=function(x,p,h,c,a,v){O.do(m.default.Delete,x,p,null,h,c,a,v)},O.post=function(x,p,h,c,a,v,g){O.do(m.default.Post,x,p,h,c,a,v,g)},O.patch=function(x,p,h,c,a,v,g){O.do(m.default.Patch,x,p,h,c,a,v,g)},O.put=function(x,p,h,c,a,v,g){O.do(m.default.Put,x,p,h,c,a,v,g)},O.do=function(x,p,h,c,a,v,g,w){f.default.shouldLog(f.default.LOG_MICRO)&&(w=I(w,x,h,v)),g&&(w=w&&l(w,g),(v=v||{}).envelope=g);function D(k,M){var _;if(f.default.shouldLog(f.default.LOG_MICRO)&&f.default.logAction(f.default.LOG_MICRO,"Resource."+x+"()","Sending; "+R(h,M)),f.default.shouldLog(f.default.LOG_MICRO)){var A=c;if(((_=k["content-type"])===null||_===void 0?void 0:_.indexOf("msgpack"))>0)try{A=o.default.Config.msgpack.decode(c)}catch(E){f.default.logAction(f.default.LOG_MICRO,"Resource."+x+"()","Sending MsgPack Decoding Error: "+u.inspectError(E))}f.default.logAction(f.default.LOG_MICRO,"Resource."+x+"()","Sending; "+R(h,M)+"; Body: "+A)}p.http.do(x,p,h,k,c,M,function(E,L,F,U,G){if(E&&d.default.isTokenErr(E)){p.auth.authorize(null,null,function(V){if(V){w(V);return}T(p,k,M,w,D)});return}w(E,L,F,U,G)})}T(p,a,v,w,D)},O}();n.default=y},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),u=s.__importDefault(i(3)),f=s.__importDefault(i(9)),d=s.__importStar(i(1));function m(C){return b.Actions.indexOf(C)}var b=function(){function C(){}return C.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},C.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var T=this.id.split(":");return{connectionId:T[0],msgSerial:parseInt(T[1],10),index:parseInt(T[2],10)}},C.prototype.toJSON=function(){var T=this.data,l=this.encoding;return T&&u.default.BufferUtils.isBuffer(T)&&(arguments.length>0?(l=l?l+"/base64":"base64",T=u.default.BufferUtils.base64Encode(T)):T=u.default.BufferUtils.toBuffer(T)),{id:this.id,clientId:this.clientId,action:m(this.action),data:T,encoding:l,extras:this.extras}},C.prototype.toString=function(){var T="[PresenceMessage";return T+="; action="+this.action,this.id&&(T+="; id="+this.id),this.timestamp&&(T+="; timestamp="+this.timestamp),this.clientId&&(T+="; clientId="+this.clientId),this.connectionId&&(T+="; connectionId="+this.connectionId),this.encoding&&(T+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?T+="; data="+this.data:u.default.BufferUtils.isBuffer(this.data)?T+="; data (buffer)="+u.default.BufferUtils.base64Encode(this.data):T+="; data (json)="+JSON.stringify(this.data)),this.extras&&(T+="; extras="+JSON.stringify(this.extras)),T+="]",T},C.fromResponseBody=function(T,l,S){var R=[];S&&(T=d.decodeBody(T,S));for(var I=0;I<T.length;I++){var y=R[I]=C.fromValues(T[I],!0);try{C.decode(y,l)}catch(O){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",O.toString())}}return R},C.fromValues=function(T,l){return l&&(T.action=C.Actions[T.action]),Object.assign(new C,T)},C.fromValuesArray=function(T){for(var l=T.length,S=new Array(l),R=0;R<l;R++)S[R]=C.fromValues(T[R]);return S},C.fromEncoded=function(T,l){var S=C.fromValues(T,!0);try{C.decode(S,l??{})}catch(R){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",R.toString())}return S},C.fromEncodedArray=function(T,l){return T.map(function(S){return C.fromEncoded(S,l)})},C.fromData=function(T){return T instanceof C?T:C.fromValues({data:T})},C.Actions=["absent","present","enter","leave","update"],C.encode=f.default.encode,C.decode=f.default.decode,C.getMessagesSize=f.default.getMessagesSize,C}();n.default=b},function(t,n,i){(function(s){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),u=o.__importStar(i(1)),f=o.__importDefault(i(7)),d=o.__importStar(i(4)),m=o.__importDefault(i(2)),b=o.__importDefault(i(8)),C=o.__importDefault(i(22)),T=o.__importDefault(i(3));function l(g,w){return u.arrIn(u.allToLowerCase(u.keysArray(w)),"x-ably-errorcode")}function S(g,w){if(l(g,w))return g.error&&d.default.fromValues(g.error)}var R=function(){},I=0,y={},O=typeof s<"u"&&s.XDomainRequest;function x(){var g=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return g&&Number(g[1])}function p(){var g;return O&&(g=x())&&g===10}function h(g,w){return g.getResponseHeader&&g.getResponseHeader(w)}function c(g){return g.getResponseHeader&&(g.getResponseHeader("transfer-encoding")||!g.getResponseHeader("content-length"))}function a(g){for(var w=u.trim(g.getAllResponseHeaders()).split(`\r
`),D={},k=0;k<w.length;k++){var M=w[k].split(":").map(u.trim);D[M[0].toLowerCase()]=M[1]}return D}var v=function(g){o.__extends(w,g);function w(D,k,M,_,A,E,L){var F=g.call(this)||this;return M=M||{},M.rnd=u.cheapRandStr(),p()&&!M.envelope&&(M.envelope="json"),F.uri=D+u.toQueryString(M),F.headers=k||{},F.body=_,F.method=L?L.toUpperCase():u.isEmptyArg(_)?"GET":"POST",F.requestMode=A,F.timeouts=E,F.timedOut=!1,F.requestComplete=!1,F.id=String(++I),y[F.id]=F,F}return w.createRequest=function(D,k,M,_,A,E,L){var F=E||b.default.TIMEOUTS;return new w(D,k,u.copy(M),_,A,F,L)},w.prototype.complete=function(D,k,M,_,A){this.requestComplete||(this.requestComplete=!0,!D&&k&&this.emit("data",k),this.emit("complete",D,k,M,_,A),this.dispose())},w.prototype.abort=function(){this.dispose()},w.prototype.exec=function(){var D=this,k=this.headers,M=this.requestMode==C.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,_=this.timer=setTimeout(function(){D.timedOut=!0,E.abort()},M),A=this.method,E=this.xhr=new XMLHttpRequest,L=k.accept,F=this.body,U="text";if(L?L.indexOf("application/x-msgpack")===0&&(U="arraybuffer"):k.accept="application/json",F){var G=k["content-type"]||(k["content-type"]="application/json");G.indexOf("application/json")>-1&&typeof F!="string"&&(F=JSON.stringify(F))}E.open(A,this.uri,!0),E.responseType=U,"authorization"in k&&(E.withCredentials=!0);for(var V in k)E.setRequestHeader(V,k[V]);var H=function(Y,ie,he,be){var de,je=ie+" (event type: "+Y.type+")";!((de=D==null?void 0:D.xhr)===null||de===void 0)&&de.statusText&&(je+=", current statusText is "+D.xhr.statusText),m.default.logAction(m.default.LOG_ERROR,"Request.on"+Y.type+"()",je),D.complete(new d.PartialErrorInfo(je,he,be))};E.onerror=function(Y){H(Y,"XHR error occurred",null,400)},E.onabort=function(Y){D.timedOut?H(Y,"Request aborted due to request timeout expiring",null,408):H(Y,"Request cancelled",null,400)},E.ontimeout=function(Y){H(Y,"Request timed out",null,408)};var P,N,j,B=0,z=!1,J=function(){if(clearTimeout(_),j=N<400,N==204){D.complete(null,null,null,null,N);return}P=D.requestMode==C.default.REQ_RECV_STREAM&&j&&c(E)},Q=function(){var Y;try{var ie=h(E,"content-type"),he=ie?ie.indexOf("application/json")>=0:E.responseType=="text";if(he){var be=E.responseType==="arraybuffer"?T.default.BufferUtils.utf8Decode(E.response):String(E.responseText);be.length?Y=JSON.parse(be):Y=be,z=!0}else Y=E.response;Y.response!==void 0?(N=Y.statusCode,j=N<400,k=Y.headers,Y=Y.response):k=a(E)}catch(je){D.complete(new d.PartialErrorInfo("Malformed response body from server: "+je.message,null,400));return}if(j||u.isArray(Y)){D.complete(null,Y,k,z,N);return}var de=S(Y,k);de||(de=new d.PartialErrorInfo("Error response received from server: "+N+" body was: "+T.default.Config.inspect(Y),null,N)),D.complete(de,Y,k,z,N)};function X(){for(var Y=E.responseText,ie=Y.length-1,he,be;B<ie&&(he=Y.indexOf(`
`,B))>-1;)be=Y.slice(B,he),B=he+1,ee(be)}var ee=function(Y){try{Y=JSON.parse(Y)}catch(ie){D.complete(new d.PartialErrorInfo("Malformed response body from server: "+ie.message,null,400));return}D.emit("data",Y)},re=function(){X(),D.streamComplete=!0,T.default.Config.nextTick(function(){D.complete()})};E.onreadystatechange=function(){var Y=E.readyState;Y<3||E.status!==0&&(N===void 0&&(N=E.status,N===1223&&(N=204),J()),Y==3&&P?X():Y==4&&(P?re():Q()))},E.send(F)},w.prototype.dispose=function(){var D=this.xhr;if(D){D.onreadystatechange=D.onerror=D.onabort=D.ontimeout=R,this.xhr=null;var k=this.timer;k&&(clearTimeout(k),this.timer=null),this.requestComplete||D.abort()}delete y[this.id]},w}(f.default);n.default=v}).call(this,i(13))},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),u=s.__importStar(i(1)),f=s.__importDefault(i(24)),d=s.__importDefault(i(4)),m=s.__importDefault(i(45)),b=i(11),C=s.__importDefault(i(19)),T=s.__importDefault(i(14)),l=s.__importDefault(i(3)),S=s.__importDefault(i(15)),R=Math.pow(2,17);function I(){}function y(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function O(M){return!!M.connection}function x(M){return u.isErrorInfoOrPartialErrorInfo(M)?(M.code||(M.statusCode===403?M.code=40300:(M.code=40170,M.statusCode=401)),M):new d.default(u.inspectError(M),M.code||40170,M.statusCode||401)}var p=function(M,_){if(l.default.Config.createHmac){var A=l.default.Config.createHmac("SHA256",_);return A.update(M),A.digest("base64")}return(0,b.stringify)((0,m.default)(M,_))};function h(M){if(!M)return"";typeof M=="string"&&(M=JSON.parse(M));var _=Object.create(null),A=u.keysArray(M,!0);if(!A)return"";A.sort();for(var E=0;E<A.length;E++)_[A[E]]=M[A[E]].sort();return JSON.stringify(_)}function c(M){if(M.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(M.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(M.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(M.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var _="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",_),new Error(_)}}function a(M){return"useTokenAuth"in M&&!M.useTokenAuth}function v(M){return M.useTokenAuth||!a(M)&&(M.authCallback||M.authUrl||M.token||M.tokenDetails)}function g(M){return!M.key&&!M.authCallback&&!M.authUrl}var w=0;function D(){return w++}var k=function(){function M(_,A){if(this.authOptions={},this.client=_,this.tokenParams=A.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,v(A)){if(A.key&&!p){var E="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",E),new Error(E)}g(A)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(A.defaultTokenParams,A),c(this.authOptions)}else{if(!A.key){var E="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",E),new d.default(E,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(A)}}return M.prototype.authorize=function(_,A,E){var L=this,F;if(typeof _=="function"&&!E?(E=_,F=_=null):typeof A=="function"&&!E?(E=A,F=null):F=A,!E&&this.client.options.promises)return u.promisify(this,"authorize",arguments);if(F&&F.key&&this.authOptions.key!==F.key)throw new d.default("Unable to update auth options with incompatible key",40102,401);F&&"force"in F&&(o.default.deprecated("The `force` auth option","If youre using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the librarys stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if youre currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),u.isOnlyPropIn(F,"force")&&(F=null)),this._forceNewToken(_,F,function(U,G){if(U){L.client.connection&&U.statusCode===T.default.Forbidden&&L.client.connection.connectionManager.actOnErrorFromAuthorize(U),E==null||E(U);return}O(L.client)?L.client.connection.connectionManager.onAuthUpdated(G,E||I):E==null||E(null,G)})},M.prototype.authorise=function(_,A,E){o.default.renamedMethod("Auth","authorise","authorize"),this.authorize(_,A,E)},M.prototype._forceNewToken=function(_,A,E){var L=this;this.tokenDetails=null,this._saveTokenOptions(_,A),c(this.authOptions),this._ensureValidAuthCredentials(!0,function(F,U){delete L.tokenParams.timestamp,delete L.authOptions.queryTime,E(F,U)})},M.prototype.requestToken=function(_,A,E){var L=this;if(typeof _=="function"&&!E?(E=_,A=_=null):typeof A=="function"&&!E&&(E=A,A=null),!E&&this.client.options.promises)return u.promisify(this,"requestToken",arguments);A=A||this.authOptions,_=_||u.copy(this.tokenParams);var F=E||I,U,G=this.client;if(A.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),U=A.authCallback;else if(A.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),U=function(B,z){var J=u.mixin({accept:"application/json, text/plain"},A.authHeaders),Q=A.authMethod&&A.authMethod.toLowerCase()==="post",X,ee=A.authUrl.indexOf("?");ee>-1&&(X=u.parseQueryString(A.authUrl.slice(ee)),A.authUrl=A.authUrl.slice(0,ee),Q||(A.authParams=u.mixin(X,A.authParams)));var re=u.mixin({},A.authParams||{},B),Y=function(be,de,je,ht){var Pe;if(be?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+u.inspectError(be)):(Pe=je["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+Pe+"; body: "+u.inspectBody(de))),be||ht)return z(be,de);if(l.default.BufferUtils.isBuffer(de)&&(de=de.toString()),!Pe){z(new d.default("authUrl response is missing a content-type header",40170,401));return}var pt=Pe.indexOf("application/json")>-1,Xt=Pe.indexOf("text/plain")>-1||Pe.indexOf("application/jwt")>-1;if(!pt&&!Xt){z(new d.default("authUrl responded with unacceptable content-type "+Pe+", should be either text/plain, application/jwt or application/json",40170,401));return}if(pt){if(de.length>R){z(new d.default("authUrl response exceeded max permitted length",40170,401));return}try{de=JSON.parse(de)}catch(Zt){z(new d.default("Unexpected error processing authURL response; err = "+Zt.message,40170,401));return}}z(null,de,Pe)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+A.authUrl+"; Params: "+JSON.stringify(re)+"; method: "+(Q?"POST":"GET")),Q){var ie=J||{};ie["content-type"]="application/x-www-form-urlencoded";var he=u.toQueryString(re).slice(1);L.client.http.doUri(C.default.Post,G,A.authUrl,ie,he,X,Y)}else L.client.http.doUri(C.default.Get,G,A.authUrl,J||{},null,re,Y)};else if(A.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),U=function(B,z){L.createTokenRequest(B,A,z)};else{var V="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),F(new d.default(V,40171,403));return}"capability"in _&&(_.capability=h(_.capability));var H=function(B,z){var J=B.keyName,Q="/keys/"+J+"/requestToken",X=function(re){return G.baseUri(re)+Q},ee=u.defaultPostHeaders(L.client.options);A.requestHeaders&&u.mixin(ee,A.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+Q+"; Token params: "+JSON.stringify(B)),L.client.http.do(C.default.Post,G,X,ee,JSON.stringify(B),null,z)},P=!1,N=this.client.options.timeouts.realtimeRequestTimeout,j=setTimeout(function(){P=!0;var B="Token request callback timed out after "+N/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",B),F(new d.default(B,40170,401))},N);U(_,function(B,z,J){if(!P){if(clearTimeout(j),B){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+u.inspectError(B)),F(x(B));return}if(typeof z=="string"){z.length===0?F(new d.default("Token string is empty",40170,401)):z.length>R?F(new d.default("Token string exceeded max permitted length (was "+z.length+" bytes)",40170,401)):z==="undefined"||z==="null"?F(new d.default("Token string was literal null/undefined",40170,401)):z[0]==="{"&&!(J&&J.indexOf("application/jwt")>-1)?F(new d.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):F(null,{token:z});return}if(typeof z!="object"){var Q="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof z;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),F(new d.default(Q,40170,401));return}var X=JSON.stringify(z).length;if(X>R&&!A.suppressMaxLengthCheck){F(new d.default("Token request/details object exceeded max permitted stringified size (was "+X+" bytes)",40170,401));return}if("issued"in z){F(null,z);return}if(!("keyName"in z)){var Q="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),F(new d.default(Q,40170,401));return}H(z,function(ee,re,Y,ie){if(ee){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+u.inspectError(ee)),F(x(ee));return}ie||(re=JSON.parse(re)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),F(null,re)})}})},M.prototype.createTokenRequest=function(_,A,E){var L=this;if(typeof _=="function"&&!E?(E=_,A=_=null):typeof A=="function"&&!E&&(E=A,A=null),!E&&this.client.options.promises)return u.promisify(this,"createTokenRequest",arguments);A=A||this.authOptions,_=_||u.copy(this.tokenParams);var F=A.key;if(!F){E(new d.default("No key specified",40101,403));return}var U=F.split(":"),G=U[0],V=U[1];if(!V){E(new d.default("Invalid key specified",40101,403));return}if(_.clientId===""){E(new d.default("clientId cant be an empty string",40012,400));return}"capability"in _&&(_.capability=h(_.capability));var H=u.mixin({keyName:G},_),P=_.clientId||"",N=_.ttl||"",j=_.capability||"";(function(B){if(H.timestamp){B();return}L.getTimestamp(A&&A.queryTime,function(z,J){if(z){E(z);return}H.timestamp=J,B()})})(function(){var B=H.nonce||(H.nonce=y()),z=H.timestamp,J=H.keyName+`
`+N+`
`+j+`
`+P+`
`+z+`
`+B+`
`;H.mac=H.mac||p(J,V),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),E(null,H)})},M.prototype.getAuthParams=function(_){this.method=="basic"?_(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(A,E){if(A){_(A);return}if(!E)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");_(null,{access_token:E.token})})},M.prototype.getAuthHeaders=function(_){this.method=="basic"?_(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(A,E){if(A){_(A);return}if(!E)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");_(null,{authorization:"Bearer "+u.toBase64(E.token)})})},M.prototype.getTimestamp=function(_,A){!this.isTimeOffsetSet()&&(_||this.authOptions.queryTime)?this.client.time(A):A(null,this.getTimestampUsingOffset())},M.prototype.getTimestampUsingOffset=function(){return u.now()+(this.client.serverTimeOffset||0)},M.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},M.prototype._saveBasicOptions=function(_){this.method="basic",this.key=_.key,this.basicKey=u.toBase64(_.key),this.authOptions=_||{},"clientId"in _&&this._userSetClientId(_.clientId)},M.prototype._saveTokenOptions=function(_,A){this.method="token",_&&(this.tokenParams=_),A&&(A.token&&(A.tokenDetails=typeof A.token=="string"?{token:A.token}:A.token),A.tokenDetails&&(this.tokenDetails=A.tokenDetails),"clientId"in A&&this._userSetClientId(A.clientId),this.authOptions=A)},M.prototype._ensureValidAuthCredentials=function(_,A){var E=this,L=this.tokenDetails;if(L){if(this._tokenClientIdMismatch(L.clientId)){A(new d.default("Mismatch between clientId in token ("+L.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!L.expires||L.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+L.expires),A(null,L);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=f.default.create())).push(A),!(this.currentTokenRequestId!==null&&!_)){var F=this.currentTokenRequestId=D();this.requestToken(this.tokenParams,this.authOptions,function(U,G){if(E.currentTokenRequestId>F){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}E.currentTokenRequestId=null;var V=E.waitingForTokenRequest||I;if(E.waitingForTokenRequest=null,U){V(U);return}V(null,E.tokenDetails=G)})}},M.prototype._userSetClientId=function(_){if(typeof _=="string"||_===null){if(_==="*")throw new d.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var A=this._uncheckedSetClientId(_);if(A)throw A}else throw new d.default("clientId must be either a string or null",40012,400)},M.prototype._uncheckedSetClientId=function(_){if(this._tokenClientIdMismatch(_)){var A="Unexpected clientId mismatch: client has "+this.clientId+", requested "+_,E=new d.default(A,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",A),E}else return this.clientId=this.tokenParams.clientId=_,null},M.prototype._tokenClientIdMismatch=function(_){return!!(this.clientId&&this.clientId!=="*"&&_&&_!=="*"&&this.clientId!==_)},M.isTokenErr=function(_){return _.code&&_.code>=40140&&_.code<40150},M.prototype.revokeTokens=function(_,A,E){if(v(this.client.options))throw new d.default("Cannot revoke tokens when using token auth",40162,401);var L=this.client.options.keyName,F;if(typeof A=="function"?(E=A,F={}):F=A??{},E===void 0){if(this.client.options.promises)return u.promisify(this,"revokeTokens",[_,F]);E=I}var U=E,G=s.__assign({targets:_.map(function(N){return"".concat(N.type,":").concat(N.value)})},F),V=this.client.options.useBinaryProtocol?u.Format.msgpack:u.Format.json,H=u.defaultPostHeaders(this.client.options,V);this.client.options.headers&&u.mixin(H,this.client.options.headers);var P=u.encodeBody(G,V);S.default.post(this.client,"/keys/".concat(L,"/revokeTokens"),P,H,{newBatchResponse:"true"},null,function(N,j,B,z){if(N){U(N);return}var J=z?j:u.decodeBody(j,V);U(null,J)})},M}();n.default=k},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(s||(s={})),n.default=s},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.HttpPaginatedResponse=n.PaginatedResult=void 0;var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(2)),f=s.__importDefault(i(15)),d=s.__importDefault(i(14));function m(R){var I=R.match(/^\.\/(\w+)\?(.*)$/);return I&&I[2]&&o.parseQueryString(I[2])}function b(R){typeof R=="string"&&(R=R.split(","));for(var I={},y=0;y<R.length;y++){var O=R[y].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(O){var x=m(O[1]);x&&(I[O[2]]=x)}}return I}function C(R,I,y){return!(y&&(I||typeof R.code=="number"))}var T=function(){function R(I,y,O,x,p,h){this.rest=I,this.path=y,this.headers=O,this.envelope=x??null,this.bodyHandler=p,this.useHttpPaginatedResponse=h||!1}return R.prototype.get=function(I,y){var O=this;f.default.get(this.rest,this.path,this.headers,I,this.envelope,function(x,p,h,c,a){O.handlePage(x,p,h,c,a,y)})},R.prototype.delete=function(I,y){var O=this;f.default.delete(this.rest,this.path,this.headers,I,this.envelope,function(x,p,h,c,a){O.handlePage(x,p,h,c,a,y)})},R.prototype.post=function(I,y,O){var x=this;f.default.post(this.rest,this.path,y,this.headers,I,this.envelope,function(p,h,c,a,v){O&&x.handlePage(p,h,c,a,v,O)})},R.prototype.put=function(I,y,O){var x=this;f.default.put(this.rest,this.path,y,this.headers,I,this.envelope,function(p,h,c,a,v){O&&x.handlePage(p,h,c,a,v,O)})},R.prototype.patch=function(I,y,O){var x=this;f.default.patch(this.rest,this.path,y,this.headers,I,this.envelope,function(p,h,c,a,v){O&&x.handlePage(p,h,c,a,v,O)})},R.prototype.handlePage=function(I,y,O,x,p,h){if(I&&C(I,y,this.useHttpPaginatedResponse)){u.default.logAction(u.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(I)),h==null||h(I);return}var c,a,v;try{c=p==d.default.NoContent?[]:this.bodyHandler(y,O||{},x)}catch(g){h==null||h(I||g);return}O&&(a=O.Link||O.link)&&(v=b(a)),this.useHttpPaginatedResponse?h(null,new S(this,c,O||{},p,v,I)):h(null,new l(this,c,v))},R}(),l=function(){function R(I,y,O){var x=this;this.resource=I,this.items=y;var p=this;O&&("first"in O&&(this.first=function(h){if(!h&&p.resource.rest.options.promises)return o.promisify(p,"first",[]);p.get(O.first,h)}),"current"in O&&(this.current=function(h){if(!h&&p.resource.rest.options.promises)return o.promisify(p,"current",[]);p.get(O.current,h)}),this.next=function(h){if(!h&&p.resource.rest.options.promises)return o.promisify(p,"next",[]);"next"in O?p.get(O.next,h):h(null,null)},this.hasNext=function(){return"next"in O},this.isLast=function(){var h;return!(!((h=x.hasNext)===null||h===void 0)&&h.call(x))})}return R.prototype.get=function(I,y){var O=this.resource;f.default.get(O.rest,O.path,O.headers,I,O.envelope,function(x,p,h,c,a){O.handlePage(x,p,h,c,a,y)})},R}();n.PaginatedResult=l;var S=function(R){s.__extends(I,R);function I(y,O,x,p,h,c){var a=R.call(this,y,O,h)||this;return a.statusCode=p,a.success=p<300&&p>=200,a.headers=x,a.errorCode=c&&c.code,a.errorMessage=c&&c.message,a}return I.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},I}(l);n.HttpPaginatedResponse=S,n.default=T},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.isRetriable=void 0;var s=i(0),o=s.__importDefault(i(4)),u={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},f={disconnected:function(){return o.default.fromValues({statusCode:400,code:u.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return o.default.fromValues({statusCode:400,code:u.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return o.default.fromValues({statusCode:400,code:u.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return o.default.fromValues({statusCode:400,code:u.CLOSING,message:"Connection closing"})},closed:function(){return o.default.fromValues({statusCode:400,code:u.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return o.default.fromValues({statusCode:500,code:u.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return o.default.fromValues({statusCode:500,code:u.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function d(m){return!m.statusCode||!m.code||m.statusCode>=500?!0:Object.values(u).includes(m.code)}n.isRetriable=d,n.default=f},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),n.default=s},function(t,n,i){(function(s,o){t.exports=o(i(6),i(5),i(58),i(11),i(40),i(32),i(25),i(27),i(28),i(59),i(60))})(this,function(s){return s})},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),u=function(){function f(d){this.members=d||[]}return f.prototype.call=function(){for(var d=[],m=0;m<arguments.length;m++)d[m]=arguments[m];for(var b=0,C=this.members;b<C.length;b++){var T=C[b];if(T)try{T.apply(void 0,d)}catch(l){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+l+"; stack = "+l.stack)}}},f.prototype.push=function(){for(var d,m=[],b=0;b<arguments.length;b++)m[b]=arguments[b];(d=this.members).push.apply(d,m)},f.create=function(d){var m=new f(d);return Object.assign(function(){for(var b=[],C=0;C<arguments.length;C++)b[C]=arguments[C];return m.call.apply(m,b)},{push:function(b){return m.push(b)}})},f}();n.default=u},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){(function(){var o=s,u=o.lib,f=u.Base,d=o.enc,m=d.Utf8,b=o.algo;b.HMAC=f.extend({init:function(C,T){C=this._hasher=new C.init,typeof T=="string"&&(T=m.parse(T));var l=C.blockSize,S=l*4;T.sigBytes>S&&(T=C.finalize(T)),T.clamp();for(var R=this._oKey=T.clone(),I=this._iKey=T.clone(),y=R.words,O=I.words,x=0;x<l;x++)y[x]^=1549556828,O[x]^=909522486;R.sigBytes=I.sigBytes=S,this.reset()},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey)},update:function(C){return this._hasher.update(C),this},finalize:function(C){var T=this._hasher,l=T.finalize(C);T.reset();var S=T.finalize(this._oKey.clone().concat(l));return S}})})()})},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),u=s.__importStar(i(1)),f=s.__importDefault(i(7)),d=s.__importDefault(i(2)),m=s.__importDefault(i(21)),b=s.__importDefault(i(4)),C=s.__importDefault(i(3)),T=o.default.Action,l=o.default.fromValues({action:T.CLOSE}),S=o.default.fromValues({action:T.DISCONNECT}),R=function(I){s.__extends(y,I);function y(O,x,p,h){var c=I.call(this)||this;return h&&(p.format=void 0,p.heartbeats=!0),c.connectionManager=O,O.registerProposedTransport(c),c.auth=x,c.params=p,c.timeouts=p.options.timeouts,c.format=p.format,c.isConnected=!1,c.isFinished=!1,c.isDisposed=!1,c.maxIdleInterval=null,c.idleTimer=null,c.lastActivity=null,c}return y.prototype.connect=function(){},y.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",m.default.closed())},y.prototype.disconnect=function(O){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",O||m.default.disconnected())},y.prototype.fail=function(O){this.isConnected&&this.requestDisconnect(),this.finish("failed",O||m.default.failed())},y.prototype.finish=function(O,x){var p;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((p=this.idleTimer)!==null&&p!==void 0?p:void 0),this.idleTimer=null,this.emit(O,x),this.dispose())},y.prototype.onProtocolMessage=function(O){switch(d.default.shouldLog(d.default.LOG_MICRO)&&d.default.logAction(d.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(O)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),O.action){case T.HEARTBEAT:d.default.logAction(d.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",O.id);break;case T.CONNECTED:this.onConnect(O),this.emit("connected",O.error,O.connectionId,O.connectionDetails,O);break;case T.CLOSED:this.onClose(O);break;case T.DISCONNECTED:this.onDisconnect(O);break;case T.ACK:this.emit("ack",O.msgSerial,O.count);break;case T.NACK:this.emit("nack",O.msgSerial,O.count,O.error);break;case T.SYNC:this.connectionManager.onChannelMessage(O,this);break;case T.ACTIVATE:break;case T.AUTH:this.auth.authorize(function(x){x&&d.default.logAction(d.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+u.inspectError(x))});break;case T.ERROR:if(d.default.logAction(d.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+C.default.Config.inspect(O.error)+(O.channel?", channel: "+O.channel:"")),O.channel===void 0){this.onFatalError(O);break}this.connectionManager.onChannelMessage(O,this);break;default:this.connectionManager.onChannelMessage(O,this)}},y.prototype.onConnect=function(O){if(this.isConnected=!0,!O.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var x=O.connectionDetails.maxIdleInterval;x&&(this.maxIdleInterval=x+this.timeouts.realtimeRequestTimeout,this.onActivity())},y.prototype.onDisconnect=function(O){var x=O&&O.error;d.default.logAction(d.default.LOG_MINOR,"Transport.onDisconnect()","err = "+u.inspectError(x)),this.finish("disconnected",x)},y.prototype.onFatalError=function(O){var x=O&&O.error;d.default.logAction(d.default.LOG_MINOR,"Transport.onFatalError()","err = "+u.inspectError(x)),this.finish("failed",x)},y.prototype.onClose=function(O){var x=O&&O.error;d.default.logAction(d.default.LOG_MINOR,"Transport.onClose()","err = "+u.inspectError(x)),this.finish("closed",x)},y.prototype.requestClose=function(){d.default.logAction(d.default.LOG_MINOR,"Transport.requestClose()",""),this.send(l)},y.prototype.requestDisconnect=function(){d.default.logAction(d.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(S)},y.prototype.ping=function(O){var x={action:o.default.Action.HEARTBEAT};O&&(x.id=O),this.send(o.default.fromValues(x))},y.prototype.dispose=function(){d.default.logAction(d.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},y.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=u.now(),this.setIdleTimer(this.maxIdleInterval+100))},y.prototype.setIdleTimer=function(O){var x=this;this.idleTimer||(this.idleTimer=setTimeout(function(){x.onIdleTimerExpire()},O))},y.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var O=u.now()-this.lastActivity,x=this.maxIdleInterval-O;if(x<=0){var p="No activity seen from realtime in "+O+"ms; assuming connection has dropped";d.default.logAction(d.default.LOG_ERROR,"Transport.onIdleTimerExpire()",p),this.disconnect(new b.default(p,80003,408))}else this.setIdleTimer(x+100)},y.tryConnect=function(O,x,p,h,c){var a=new O(x,p,h),v,g=function(D){clearTimeout(v),c({event:this.event,error:D})},w=x.options.timeouts.realtimeRequestTimeout;v=setTimeout(function(){a.off(["preconnect","disconnected","failed"]),a.dispose(),g.call({event:"disconnected"},new b.default("Timeout waiting for transport to indicate itself viable",5e4,500))},w),a.on(["failed","disconnected"],g),a.on("preconnect",function(){d.default.logAction(d.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+a),clearTimeout(v),a.off(["failed","disconnected"],g),c(null,a)}),a.connect()},y}(f.default);n.default=R},function(t,n,i){(function(s,o){t.exports=o(i(6),i(40),i(25))})(this,function(s){return function(){var o=s,u=o.lib,f=u.Base,d=u.WordArray,m=o.algo,b=m.MD5,C=m.EvpKDF=f.extend({cfg:f.extend({keySize:128/32,hasher:b,iterations:1}),init:function(T){this.cfg=this.cfg.extend(T)},compute:function(T,l){for(var S,R=this.cfg,I=R.hasher.create(),y=d.create(),O=y.words,x=R.keySize,p=R.iterations;O.length<x;){S&&I.update(S),S=I.update(T).finalize(l),I.reset();for(var h=1;h<p;h++)S=I.finalize(S),I.reset();y.concat(S)}return y.sigBytes=x*4,y}});o.EvpKDF=function(T,l,S){return C.create(S).compute(T,l)}}(),s.EvpKDF})},function(t,n,i){(function(s,o){t.exports=o(i(6),i(27))})(this,function(s){s.lib.Cipher||function(o){var u=s,f=u.lib,d=f.Base,m=f.WordArray,b=f.BufferedBlockAlgorithm,C=u.enc;C.Utf8;var T=C.Base64,l=u.algo,S=l.EvpKDF,R=f.Cipher=b.extend({cfg:d.extend(),createEncryptor:function(k,M){return this.create(this._ENC_XFORM_MODE,k,M)},createDecryptor:function(k,M){return this.create(this._DEC_XFORM_MODE,k,M)},init:function(k,M,_){this.cfg=this.cfg.extend(_),this._xformMode=k,this._key=M,this.reset()},reset:function(){b.reset.call(this),this._doReset()},process:function(k){return this._append(k),this._process()},finalize:function(k){k&&this._append(k);var M=this._doFinalize();return M},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function k(M){return typeof M=="string"?D:v}return function(M){return{encrypt:function(_,A,E){return k(A).encrypt(M,_,A,E)},decrypt:function(_,A,E){return k(A).decrypt(M,_,A,E)}}}}()});f.StreamCipher=R.extend({_doFinalize:function(){var k=this._process(!0);return k},blockSize:1});var I=u.mode={},y=f.BlockCipherMode=d.extend({createEncryptor:function(k,M){return this.Encryptor.create(k,M)},createDecryptor:function(k,M){return this.Decryptor.create(k,M)},init:function(k,M){this._cipher=k,this._iv=M}}),O=I.CBC=function(){var k=y.extend();k.Encryptor=k.extend({processBlock:function(_,A){var E=this._cipher,L=E.blockSize;M.call(this,_,A,L),E.encryptBlock(_,A),this._prevBlock=_.slice(A,A+L)}}),k.Decryptor=k.extend({processBlock:function(_,A){var E=this._cipher,L=E.blockSize,F=_.slice(A,A+L);E.decryptBlock(_,A),M.call(this,_,A,L),this._prevBlock=F}});function M(_,A,E){var L,F=this._iv;F?(L=F,this._iv=o):L=this._prevBlock;for(var U=0;U<E;U++)_[A+U]^=L[U]}return k}(),x=u.pad={},p=x.Pkcs7={pad:function(k,M){for(var _=M*4,A=_-k.sigBytes%_,E=A<<24|A<<16|A<<8|A,L=[],F=0;F<A;F+=4)L.push(E);var U=m.create(L,A);k.concat(U)},unpad:function(k){var M=k.words[k.sigBytes-1>>>2]&255;k.sigBytes-=M}};f.BlockCipher=R.extend({cfg:R.cfg.extend({mode:O,padding:p}),reset:function(){var k;R.reset.call(this);var M=this.cfg,_=M.iv,A=M.mode;this._xformMode==this._ENC_XFORM_MODE?k=A.createEncryptor:(k=A.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==k?this._mode.init(this,_&&_.words):(this._mode=k.call(A,this,_&&_.words),this._mode.__creator=k)},_doProcessBlock:function(k,M){this._mode.processBlock(k,M)},_doFinalize:function(){var k,M=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(M.pad(this._data,this.blockSize),k=this._process(!0)):(k=this._process(!0),M.unpad(k)),k},blockSize:128/32});var h=f.CipherParams=d.extend({init:function(k){this.mixIn(k)},toString:function(k){return(k||this.formatter).stringify(this)}}),c=u.format={},a=c.OpenSSL={stringify:function(k){var M,_=k.ciphertext,A=k.salt;return A?M=m.create([1398893684,1701076831]).concat(A).concat(_):M=_,M.toString(T)},parse:function(k){var M,_=T.parse(k),A=_.words;return A[0]==1398893684&&A[1]==1701076831&&(M=m.create(A.slice(2,4)),A.splice(0,4),_.sigBytes-=16),h.create({ciphertext:_,salt:M})}},v=f.SerializableCipher=d.extend({cfg:d.extend({format:a}),encrypt:function(k,M,_,A){A=this.cfg.extend(A);var E=k.createEncryptor(_,A),L=E.finalize(M),F=E.cfg;return h.create({ciphertext:L,key:_,iv:F.iv,algorithm:k,mode:F.mode,padding:F.padding,blockSize:k.blockSize,formatter:A.format})},decrypt:function(k,M,_,A){A=this.cfg.extend(A),M=this._parse(M,A.format);var E=k.createDecryptor(_,A).finalize(M.ciphertext);return E},_parse:function(k,M){return typeof k=="string"?M.parse(k,this):k}}),g=u.kdf={},w=g.OpenSSL={execute:function(k,M,_,A){A||(A=m.random(64/8));var E=S.create({keySize:M+_}).compute(k,A),L=m.create(E.words.slice(M),_*4);return E.sigBytes=M*4,h.create({key:E,iv:L,salt:A})}},D=f.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:w}),encrypt:function(k,M,_,A){A=this.cfg.extend(A);var E=A.kdf.execute(_,k.keySize,k.ivSize);A.iv=E.iv;var L=v.encrypt.call(this,k,M,E.key,A);return L.mixIn(E),L},decrypt:function(k,M,_,A){A=this.cfg.extend(A),M=this._parse(M,A.format);var E=A.kdf.execute(_,k.keySize,k.ivSize,M.salt);A.iv=E.iv;var L=v.decrypt.call(this,k,M,E.key,A);return L}})}()})},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.Request=n.createRequest=void 0;var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(12)),f=s.__importDefault(i(3)),d=s.__importDefault(i(7)),m=i(4),b=s.__importDefault(i(8)),C=s.__importDefault(i(2)),T=s.__importDefault(i(22)),l=o.getGlobalObject(),S=function(){},R=l._ablyjs_jsonp={};R._=function(c){return R["_"+c]||S};var I=1,y="jsonp";function O(c,a,v,g,w,D,k){return D=D||b.default.TIMEOUTS,new p(void 0,c,a,o.copy(v),g,w,D,k)}n.createRequest=O;var x=function(c){s.__extends(a,c);function a(v,g,w){var D=c.call(this,v,g,w)||this;return D.shortName=y,w.stream=!1,D}return a.isAvailable=function(){return f.default.Config.jsonpSupported&&f.default.Config.allowComet},a.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},a.prototype.createRequest=function(v,g,w,D,k,M,_){return M=(this===null||this===void 0?void 0:this.timeouts)||M||b.default.TIMEOUTS,O(v,g,w,D,k,M,_)},a}(u.default),p=function(c){s.__extends(a,c);function a(v,g,w,D,k,M,_,A){var E=c.call(this)||this;return v===void 0&&(v=I++),E.id=v,E.uri=g,E.params=D||{},E.params.rnd=o.cheapRandStr(),w&&(w["X-Ably-Version"]&&(E.params.v=w["X-Ably-Version"]),w["X-Ably-Lib"]&&(E.params.lib=w["X-Ably-Lib"])),E.body=k,E.method=A,E.requestMode=M,E.timeouts=_,E.requestComplete=!1,E}return a.prototype.exec=function(){var v=this,g=this.id,w=this.body,D=this.method,k=this.uri,M=this.params;M.callback="_ablyjs_jsonp._("+g+")",M.envelope="jsonp",w&&(M.body=w),D&&D!=="get"&&(M.method=D);var _=this.script=document.createElement("script"),A=k+o.toQueryString(M);_.src=A,_.src.split("/").slice(-1)[0]!==A.split("/").slice(-1)[0]&&C.default.logAction(C.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),_.async=!0,_.type="text/javascript",_.charset="UTF-8",_.onerror=function(F){v.complete(new m.PartialErrorInfo("JSONP script error (event: "+f.default.Config.inspect(F)+")",null,400))},R["_"+g]=function(F){if(F.statusCode){var U=F.response;if(F.statusCode==204)v.complete(null,null,null,F.statusCode);else if(!U)v.complete(new m.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(F.statusCode<400||o.isArray(U))v.complete(null,U,F.headers,F.statusCode);else{var G=U.error||new m.PartialErrorInfo("Error response received from server",null,F.statusCode);v.complete(G)}}else v.complete(null,F)};var E=this.requestMode==T.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),E);var L=document.getElementsByTagName("head")[0];L.insertBefore(_,L.firstChild)},a.prototype.complete=function(v,g,w,D){if(w=w||{},!this.requestComplete){this.requestComplete=!0;var k=void 0;g&&(k=typeof g=="string"?"text/plain":"application/json",w["content-type"]=k,this.emit("data",g)),this.emit("complete",v,g,w,!0,D),this.dispose()}},a.prototype.abort=function(){this.dispose()},a.prototype.dispose=function(){var v=this.timer;v&&(clearTimeout(v),this.timer=null);var g=this.script;g.parentNode&&g.parentNode.removeChild(g),delete R[this.id],this.emit("disposed")},a}(d.default);n.Request=p;function h(c){return l.JSONPTransport=x,x.isAvailable()&&(c.supportedTransports[y]=x),x}n.default=h},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(2)),f=s.__importDefault(i(8)),d=s.__importDefault(i(18)),m=s.__importDefault(i(46)),b=s.__importDefault(i(20)),C=s.__importDefault(i(33)),T=s.__importDefault(i(4)),l=s.__importDefault(i(49)),S=s.__importDefault(i(19)),R=s.__importDefault(i(3)),I=s.__importDefault(i(9)),y=s.__importDefault(i(16)),O=s.__importDefault(i(15)),x=function(){},p=function(){function c(a){if(!a){var v="no options provided";throw u.default.logAction(u.default.LOG_ERROR,"Rest()",v),new Error(v)}var g=f.default.objectifyOptions(a);g.log?(u.default.setLog(g.log.level,g.log.handler),u.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):u.default.setLog(g.logLevel,g.logHandler),u.default.logAction(u.default.LOG_MICRO,"Rest()","initialized with clientOptions "+R.default.Config.inspect(a));var w=this.options=f.default.normaliseOptions(g);if(w.key){var D=w.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!D){var v="invalid key parameter";throw u.default.logAction(u.default.LOG_ERROR,"Rest()",v),new T.default(v,40400,404)}w.keyName=D[1],w.keySecret=D[2]}if("clientId"in w)if(typeof w.clientId=="string"||w.clientId===null){if(w.clientId==="*")throw new T.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new T.default("clientId must be either a string or null",40012,400);u.default.logAction(u.default.LOG_MINOR,"Rest()","started; version = "+f.default.version),this.baseUri=this.authority=function(k){return f.default.getHttpScheme(w)+k+":"+f.default.getPort(w,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new R.default.Http(w),this.auth=new d.default(this,w),this.channels=new h(this),this.push=new m.default(this)}return c.prototype.stats=function(a,v){if(v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.options.promises)return o.promisify(this,"stats",[a]);v=x}var g=o.defaultGetHeaders(this.options),w=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,D=this.http.supportsLinkHeaders?void 0:w;this.options.headers&&o.mixin(g,this.options.headers),new b.default(this,"/stats",g,D,function(k,M,_){for(var A=_?k:JSON.parse(k),E=0;E<A.length;E++)A[E]=l.default.fromValues(A[E]);return A}).get(a,v)},c.prototype.time=function(a,v){var g=this;if(v===void 0){if(typeof a=="function")v=a,a=null;else if(this.options.promises)return o.promisify(this,"time",[a])}var w=v||x,D=o.defaultGetHeaders(this.options);this.options.headers&&o.mixin(D,this.options.headers);var k=function(M){return g.authority(M)+"/time"};this.http.do(S.default.Get,this,k,D,null,a,function(M,_,A,E){if(M){w(M);return}E||(_=JSON.parse(_));var L=_[0];if(!L){w(new T.default("Internal error (unexpected result type from GET /time)",5e4,500));return}g.serverTimeOffset=L-o.now(),w(null,L)})},c.prototype.request=function(a,v,g,w,D,k){var M=this.options.useBinaryProtocol,_=M?R.default.Config.msgpack.encode:JSON.stringify,A=M?R.default.Config.msgpack.decode:JSON.parse,E=M?o.Format.msgpack:o.Format.json,L=this.http.supportsLinkHeaders?void 0:E;g=g||{};var F=a.toLowerCase(),U=F=="get"?o.defaultGetHeaders(this.options,E):o.defaultPostHeaders(this.options,E);if(k===void 0){if(this.options.promises)return o.promisify(this,"request",[a,v,g,w,D]);k=x}typeof w!="string"&&(w=_(w)),this.options.headers&&o.mixin(U,this.options.headers),D&&o.mixin(U,D);var G=new b.default(this,v,U,L,function(V,H,P){return o.ensureArray(P?V:A(V))},!0);if(!o.arrIn(R.default.Http.methods,F))throw new T.default("Unsupported method "+F,40500,405);o.arrIn(R.default.Http.methodsWithBody,F)?G[F](g,w,k):G[F](g,k)},c.prototype.batchPublish=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPublish",[a]);v=x}var g=v,w,D;o.isArray(a)?(w=a,D=!1):(w=[a],D=!0);var k=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,M=o.defaultPostHeaders(this.options,k);this.options.headers&&o.mixin(M,this.options.headers);var _=o.encodeBody(w,k);O.default.post(this,"/messages",_,M,{newBatchResponse:"true"},null,function(A,E,L,F){if(A){g(A);return}var U=F?E:o.decodeBody(E,k);D?g(null,U[0]):g(null,U)})},c.prototype.batchPresence=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPresence",[a]);v=x}var g=v,w=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,D=o.defaultPostHeaders(this.options,w);this.options.headers&&o.mixin(D,this.options.headers);var k=a.join(",");O.default.get(this,"/presence",D,{newBatchResponse:"true",channels:k},null,function(M,_,A,E){if(M){g(M);return}var L=E?_:o.decodeBody(_,w);g(null,L)})},c.prototype.setLog=function(a){u.default.setLog(a.level,a.handler)},c.Promise=function(a){return a=f.default.objectifyOptions(a),a.promises=!0,new c(a)},c.Callbacks=c,c.Platform=R.default,c.Message=I.default,c.PresenceMessage=y.default,c}(),h=function(){function c(a){this.rest=a,this.all=Object.create(null)}return c.prototype.get=function(a,v){a=String(a);var g=this.all[a];return g?v&&g.setOptions(v):this.all[a]=g=new C.default(this.rest,a,v),g},c.prototype.release=function(a){delete this.all[String(a)]},c}();n.default=p},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return s.enc.Utf8})},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return function(o){var u=s,f=u.lib,d=f.WordArray,m=f.Hasher,b=u.algo,C=[],T=[];(function(){function R(x){for(var p=o.sqrt(x),h=2;h<=p;h++)if(!(x%h))return!1;return!0}function I(x){return(x-(x|0))*4294967296|0}for(var y=2,O=0;O<64;)R(y)&&(O<8&&(C[O]=I(o.pow(y,1/2))),T[O]=I(o.pow(y,1/3)),O++),y++})();var l=[],S=b.SHA256=m.extend({_doReset:function(){this._hash=new d.init(C.slice(0))},_doProcessBlock:function(R,I){for(var y=this._hash.words,O=y[0],x=y[1],p=y[2],h=y[3],c=y[4],a=y[5],v=y[6],g=y[7],w=0;w<64;w++){if(w<16)l[w]=R[I+w]|0;else{var D=l[w-15],k=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,M=l[w-2],_=(M<<15|M>>>17)^(M<<13|M>>>19)^M>>>10;l[w]=k+l[w-7]+_+l[w-16]}var A=c&a^~c&v,E=O&x^O&p^x&p,L=(O<<30|O>>>2)^(O<<19|O>>>13)^(O<<10|O>>>22),F=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),U=g+F+A+T[w]+l[w],G=L+E;g=v,v=a,a=c,c=h+U|0,h=p,p=x,x=O,O=U+G|0}y[0]=y[0]+O|0,y[1]=y[1]+x|0,y[2]=y[2]+p|0,y[3]=y[3]+h|0,y[4]=y[4]+c|0,y[5]=y[5]+a|0,y[6]=y[6]+v|0,y[7]=y[7]+g|0},_doFinalize:function(){var R=this._data,I=R.words,y=this._nDataBytes*8,O=R.sigBytes*8;return I[O>>>5]|=128<<24-O%32,I[(O+64>>>9<<4)+14]=o.floor(y/4294967296),I[(O+64>>>9<<4)+15]=y,R.sigBytes=I.length*4,this._process(),this._hash},clone:function(){var R=m.clone.call(this);return R._hash=this._hash.clone(),R}});u.SHA256=m._createHelper(S),u.HmacSHA256=m._createHmacHelper(S)}(Math),s.SHA256})},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(7)),f=s.__importDefault(i(2)),d=s.__importDefault(i(34)),m=s.__importDefault(i(9)),b=s.__importDefault(i(4)),C=s.__importDefault(i(20)),T=s.__importDefault(i(15)),l=s.__importDefault(i(3));function S(){}var R=9;function I(x){return o.arrEvery(x,function(p){return!p.id})}function y(x){var p=x||{};if(p.cipher){if(!l.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var h=l.default.Crypto.getCipher(p.cipher);p.cipher=h.cipherParams,p.channelCipher=h.cipher}else"cipher"in p&&(p.cipher=void 0,p.channelCipher=null);return p}var O=function(x){s.__extends(p,x);function p(h,c,a){var v=x.call(this)||this;return f.default.logAction(f.default.LOG_MINOR,"Channel()","started; name = "+c),v.rest=h,v.name=c,v.basePath="/channels/"+encodeURIComponent(c),v.presence=new d.default(v),v.channelOptions=y(a),v}return p.prototype.setOptions=function(h){this.channelOptions=y(h)},p.prototype.history=function(h,c){if(f.default.logAction(f.default.LOG_MICRO,"Channel.history()","channel = "+this.name),c===void 0)if(typeof h=="function")c=h,h=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);c=S}this._history(h,c)},p.prototype._history=function(h,c){var a=this.rest,v=a.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:v,w=o.defaultGetHeaders(a.options,v);a.options.headers&&o.mixin(w,a.options.headers);var D=this.channelOptions;new C.default(a,this.basePath+"/messages",w,g,function(k,M,_){return m.default.fromResponseBody(k,D,_?void 0:v)}).get(h,c)},p.prototype.publish=function(){var h=this,c=arguments.length,a=arguments[0],v=arguments[1],g=arguments[c-1],w,D;if(typeof g!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);g=S}if(typeof a=="string"||a===null)w=[m.default.fromValues({name:a,data:v})],D=arguments[2];else if(o.isObject(a))w=[m.default.fromValues(a)],D=arguments[1];else if(o.isArray(a))w=m.default.fromValuesArray(a),D=arguments[1];else throw new b.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof D!="object"||!D)&&(D={});var k=this.rest,M=k.options,_=M.useBinaryProtocol?o.Format.msgpack:o.Format.json,A=k.options.idempotentRestPublishing,E=o.defaultPostHeaders(k.options,_);if(M.headers&&o.mixin(E,M.headers),A&&I(w)){var L=o.randomString(R);o.arrForEach(w,function(F,U){F.id=L+":"+U.toString()})}m.default.encodeArray(w,this.channelOptions,function(F){if(F){g(F);return}var U=m.default.getMessagesSize(w),G=M.maxMessageSize;if(U>G){g(new b.default("Maximum size of messages that can be published at once exceeded ( was "+U+" bytes; limit is "+G+" bytes)",40009,400));return}h._publish(m.default.serialize(w,_),E,D,g)})},p.prototype._publish=function(h,c,a,v){T.default.post(this.rest,this.basePath+"/messages",h,c,a,null,v)},p.prototype.status=function(h){if(typeof h!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var c=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,a=o.defaultPostHeaders(this.rest.options,c);T.default.get(this.rest,this.basePath,a,{},c,h||S)},p}(u.default);n.default=O},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(7)),f=s.__importDefault(i(2)),d=s.__importDefault(i(20)),m=s.__importDefault(i(16));function b(){}var C=function(T){s.__extends(l,T);function l(S){var R=T.call(this)||this;return R.channel=S,R.basePath=S.basePath+"/presence",R}return l.prototype.get=function(S,R){if(f.default.logAction(f.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),R===void 0)if(typeof S=="function")R=S,S=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);R=b}var I=this.channel.rest,y=I.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:y,x=o.defaultGetHeaders(I.options,y);I.options.headers&&o.mixin(x,I.options.headers);var p=this.channel.channelOptions;new d.default(I,this.basePath,x,O,function(h,c,a){return m.default.fromResponseBody(h,p,a?void 0:y)}).get(S,R)},l.prototype.history=function(S,R){return f.default.logAction(f.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(S,R)},l.prototype._history=function(S,R){if(R===void 0)if(typeof S=="function")R=S,S=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",[S]);R=b}var I=this.channel.rest,y=I.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,O=this.channel.rest.http.supportsLinkHeaders?void 0:y,x=o.defaultGetHeaders(I.options,y);I.options.headers&&o.mixin(x,I.options.headers);var p=this.channel.channelOptions;new d.default(I,this.basePath+"/history",x,O,function(h,c,a){return m.default.fromResponseBody(h,p,a?void 0:y)}).get(S,R)},l}(u.default);n.default=C},function(t,n,i){(function(s){Object.defineProperty(n,"__esModule",{value:!0}),n.TransportParams=void 0;var o=i(0),u=o.__importDefault(i(10)),f=o.__importStar(i(1)),d=o.__importStar(i(52)),m=o.__importStar(i(8)),b=o.__importDefault(i(3)),C=o.__importDefault(i(7)),T=o.__importDefault(i(36)),l=o.__importDefault(i(2)),S=o.__importDefault(i(37)),R=o.__importStar(i(21)),I=o.__importStar(i(4)),y=o.__importDefault(i(18)),O=o.__importDefault(i(9)),x=o.__importDefault(i(24)),p=o.__importDefault(i(53)),h=o.__importDefault(i(26)),c=o.__importDefault(i(14)),a=function(){var V;return typeof b.default.WebStorage<"u"&&((V=b.default.WebStorage)===null||V===void 0?void 0:V.localSupported)},v=function(){var V;return typeof b.default.WebStorage<"u"&&((V=b.default.WebStorage)===null||V===void 0?void 0:V.sessionSupported)},g=u.default.Action,w=function(){},D="ably-transport-preference",k="ably-connection-recovery";function M(){var V,H;return v()&&((H=(V=b.default.WebStorage)===null||V===void 0?void 0:V.getSession)===null||H===void 0?void 0:H.call(V,k))}function _(V){var H,P;return v()&&((P=(H=b.default.WebStorage)===null||H===void 0?void 0:H.setSession)===null||P===void 0?void 0:P.call(H,k,V))}function A(){var V,H;return v()&&((H=(V=b.default.WebStorage)===null||V===void 0?void 0:V.removeSession)===null||H===void 0?void 0:H.call(V,k))}function E(V,H){return f.arrIndexOf(b.default.Defaults.transportPreferenceOrder,V.shortName)>f.arrIndexOf(b.default.Defaults.transportPreferenceOrder,H.shortName)}function L(V,H,P){var N;if(V.channel!==H.channel||(N=V.action)!==g.PRESENCE&&N!==g.MESSAGE||N!==H.action)return!1;var j=N===g.PRESENCE?"presence":"messages",B=V[j].concat(H[j]),z=O.default.getMessagesSize(B);return z>P||!f.allSame(B,"clientId")||!f.arrEvery(B,function(J){return!J.id})?!1:(V[j]=B,!0)}function F(V){try{return JSON.parse(V)}catch{return null}}var U=function(){function V(H,P,N,j){this.options=H,this.host=P,this.mode=N,this.connectionKey=j,this.format=H.useBinaryProtocol?f.Format.msgpack:f.Format.json}return V.prototype.getConnectParams=function(H){var P=H?f.copy(H):{},N=this.options;switch(this.mode){case"upgrade":P.upgrade=this.connectionKey;break;case"resume":P.resume=this.connectionKey;break;case"recover":{var j=F(N.recover);j&&(P.recover=j.connectionKey);break}}return N.clientId!==void 0&&(P.clientId=N.clientId),N.echoMessages===!1&&(P.echo="false"),this.format!==void 0&&(P.format=this.format),this.stream!==void 0&&(P.stream=this.stream),this.heartbeats!==void 0&&(P.heartbeats=this.heartbeats),P.v=m.default.protocolVersion,P.agent=(0,m.getAgentString)(this.options),N.transportParams!==void 0&&f.mixin(P,N.transportParams),P},V.prototype.toString=function(){var H="[mode="+this.mode;return this.host&&(H+=",host="+this.host),this.connectionKey&&(H+=",connectionKey="+this.connectionKey),this.format&&(H+=",format="+this.format),H+="]",H},V}();n.TransportParams=U;var G=function(V){o.__extends(H,V);function H(P,N){var j=V.call(this)||this;j.disconnectedRetryCount=0,H.initTransports(),j.realtime=P,j.options=N;var B=N.timeouts,z=B.preferenceConnectTimeout+B.realtimeRequestTimeout;if(j.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:z,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:B.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:B.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:B.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},j.state=j.states.initialized,j.errorReason=null,j.queuedMessages=new T.default,j.msgSerial=0,j.connectionDetails=void 0,j.connectionId=void 0,j.connectionKey=void 0,j.connectionStateTtl=B.connectionStateTtl,j.maxIdleInterval=null,j.transports=f.intersect(N.transports||m.default.defaultTransports,H.supportedTransports),j.baseTransport=f.intersect(m.default.baseTransportOrder,j.transports)[0],j.upgradeTransports=f.intersect(j.transports,m.default.upgradeTransports),j.transportPreference=null,j.httpHosts=m.default.getHosts(N),j.activeProtocol=null,j.proposedTransports=[],j.pendingTransports=[],j.host=null,j.lastAutoReconnectAttempt=null,j.lastActivity=null,j.forceFallbackHost=!1,j.connectCounter=0,l.default.logAction(l.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||m.default.defaultTransports)+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+j.transports+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+j.httpHosts+"]"),!j.transports.length){var J="no requested transports available";throw l.default.logAction(l.default.LOG_ERROR,"realtime.ConnectionManager()",J),new Error(J)}var Q=b.default.Config.addEventListener;return Q&&(v()&&typeof N.recover=="function"&&Q("beforeunload",j.persistConnection.bind(j)),N.closeOnUnload===!0&&Q("beforeunload",function(){l.default.logAction(l.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),j.requestState({state:"closing"})}),Q("online",function(){j.state==j.states.disconnected||j.state==j.states.suspended?(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),j.requestState({state:"connecting"})):j.state==j.states.connecting&&(j.pendingTransports.forEach(function(X){X.off()}),j.disconnectAllTransports(),j.startConnect())}),Q("offline",function(){j.state==j.states.connected&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),j.disconnectAllTransports())})),j}return H.initTransports=function(){(0,p.default)(H),f.arrForEach(b.default.Transports,function(P){P(H)})},H.prototype.createTransportParams=function(P,N){return new U(this.options,P,N,this.connectionKey)},H.prototype.getTransportParams=function(P){var N=this,j=function(B){if(N.connectionKey){B("resume");return}if(typeof N.options.recover=="string"){B("recover");return}var z=N.options.recover,J=M();if(J&&typeof z=="function"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),z(J,function(Q){Q?(N.options.recover=J.recoveryKey,B("recover")):B("clean")});return}B("clean")};j(function(B){var z=N.createTransportParams(null,B);if(B==="recover"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var J=F(N.options.recover);J&&(N.msgSerial=J.msgSerial)}else l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+z.toString());P(z)})},H.prototype.tryATransport=function(P,N,j){var B=this;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),h.default.tryConnect(H.supportedTransports[N],this,this.realtime.auth,P,function(z,J){var Q=B.state;if(Q==B.states.closing||Q==B.states.closed||Q==B.states.failed){J&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+Q.state+" while we were attempting the transport; closing "+J),J.close()),j(!0);return}if(z){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+z.event+", err: "+z.error.toString()),y.default.isTokenErr(z.error)&&!(B.errorReason&&y.default.isTokenErr(B.errorReason))?(B.errorReason=z.error,B.realtime.auth._forceNewToken(null,null,function(X){if(X){B.actOnErrorFromAuthorize(X);return}B.tryATransport(P,N,j)})):z.event==="failed"?(B.notifyState({state:"failed",error:z.error}),j(!0)):z.event==="disconnected"&&((0,R.isRetriable)(z.error)?j(!1):(B.notifyState({state:B.states.connecting.failState,error:z.error}),j(!0)));return}l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),B.setTransportPending(J,P),j(null,J)})},H.prototype.setTransportPending=function(P,N){var j=this,B=N.mode;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+P+"; mode = "+B),f.arrDeleteValue(this.proposedTransports,P),this.pendingTransports.push(P);var z=b.default.Defaults.transportPreferenceOrder[b.default.Defaults.transportPreferenceOrder.length-1];P.once("connected",function(Q,X,ee){B=="upgrade"&&j.activeProtocol?P.shortName!==z&&f.arrIn(j.getUpgradePossibilities(),z)&&j.activeProtocol?setTimeout(function(){j.scheduleTransportActivation(Q,P,X,ee)},j.options.timeouts.parallelUpgradeDelay):j.scheduleTransportActivation(Q,P,X,ee):(j.activateTransport(Q,P,X,ee),b.default.Config.nextTick(function(){j.connectImpl(N)})),B==="recover"&&j.options.recover&&(j.options.recover=null,j.unpersistConnection())});var J=this;P.on(["disconnected","closed","failed"],function(Q){J.deactivateTransport(P,this.event,Q)}),this.emit("transport.pending",P)},H.prototype.scheduleTransportActivation=function(P,N,j,B){var z=this,J=this.activeProtocol&&this.activeProtocol.getTransport(),Q=function(){N.disconnect(),f.arrDeleteValue(z.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Q();return}if(J&&!E(N,J)){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+J.shortName+" - abandoning upgrade"),Q();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var X=null;if(!N.isConnected){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),Q();return}if(this.state===this.states.connected)l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,X=this.activeProtocol;else if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Q();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N);var ee=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),N.send(u.default.fromValues({action:g.ACTIVATE})),z.activateTransport(P,N,j,B),z.state===z.states.synchronizing?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),z.state=z.states.connected):l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+z.state.state+", so leaving unchanged"),z.state.sendEvents&&z.sendQueuedMessages()};X?X.onceIdle(ee):ee()},H.prototype.activateTransport=function(P,N,j,B){var z=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),P&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+P),j&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+j),B&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(B)),this.persistTransportPreference(N);var J=this.state,Q=this.states.connected.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+J.state),J.state==this.states.closing.state||J.state==this.states.closed.state||J.state==this.states.failed.state)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(f.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var X=this.activeProtocol;this.activeProtocol=new d.default(N),this.host=N.params.host;var ee=B.connectionKey;if(ee&&this.connectionKey!=ee&&this.setConnection(j,B,!!P),this.onConnectionDetailsUpdate(B,N),b.default.Config.nextTick(function(){N.on("connected",function(Y,ie,he){z.onConnectionDetailsUpdate(he,N),z.emit("update",new S.default(Q,Q,null,Y))})}),J.state===this.states.connected.state?P&&(this.errorReason=this.realtime.connection.errorReason=P,this.emit("update",new S.default(Q,Q,null,P))):(this.notifyState({state:"connected",error:P}),this.errorReason=this.realtime.connection.errorReason=P||null),this.emit("transport.active",N),X)if(X.messageQueue.count()>0&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+X.transport.shortName+", new one is "+N.shortName+") finishing with "+X.messageQueue.count()+" messages still pending"),X.transport===N){var re="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",re)}else X.finish();return f.safeArrForEach(this.pendingTransports,function(Y){if(Y===N){var ie="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",ie),f.arrDeleteValue(z.pendingTransports,N)}else Y.disconnect()}),f.safeArrForEach(this.proposedTransports,function(Y){Y===N?(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),f.arrDeleteValue(z.proposedTransports,N)):Y.dispose()}),!0},H.prototype.deactivateTransport=function(P,N,j){var B=this.activeProtocol,z=B&&B.getTransport()===P,J=f.arrDeleteValue(this.pendingTransports,P),Q=f.arrDeleteValue(this.proposedTransports,P),X=this.noTransportsScheduledForActivation();if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+P),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(z?"; was active":J?"; was pending":Q?"; was proposed":"")+(X?"":"; another transport is scheduled for activation")),j&&j.message&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+j.message),z&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(B.getPendingMessages()),b.default.Config.nextTick(function(){B.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",P),z&&X||z&&N==="failed"||N==="closed"||B===null&&J&&this.pendingTransports.length===0){if(N==="disconnected"&&j&&j.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:j,retryImmediately:!0});return}var ee=N==="failed"&&y.default.isTokenErr(j)?"disconnected":N;this.notifyState({state:ee,error:j});return}z&&N==="disconnected"&&this.state!==this.states.synchronizing&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:j}))},H.prototype.noTransportsScheduledForActivation=function(){return f.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(P){return!P.isConnected})},H.prototype.setConnection=function(P,N,j){var B=this.connectionId,z=B&&B!==P,J=!B&&j;(z||J)&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==P&&l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=P,this.realtime.connection.key=this.connectionKey=N.connectionKey},H.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},H.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},H.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var P=f.now()-this.lastActivity;P>this.connectionStateTtl+this.maxIdleInterval&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+P+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},H.prototype.persistConnection=function(){if(v()){var P=this.createRecoveryKey();P&&_({recoveryKey:P,disconnectedAt:f.now(),location:s.location,clientId:this.realtime.auth.clientId})}},H.prototype.unpersistConnection=function(){A()},H.prototype.getError=function(){return this.errorReason||this.getStateError()},H.prototype.getStateError=function(){var P,N;return(N=(P=R.default)[this.state.state])===null||N===void 0?void 0:N.call(P)},H.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},H.prototype.enactStateChange=function(P){var N=P.current==="failed"?l.default.LOG_ERROR:l.default.LOG_MAJOR;l.default.logAction(N,"Connection state",P.current+(P.reason?"; reason: "+P.reason:"")),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+P.current+"; reason = "+(P.reason&&P.reason.message));var j=this.state=this.states[P.current];P.reason&&(this.errorReason=P.reason,this.realtime.connection.errorReason=P.reason),(j.terminal||j.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",P)},H.prototype.startTransitionTimer=function(P){var N=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+P.state),this.transitionTimer&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager "+P.state+" timer expired","requesting new state: "+P.failState),N.notifyState({state:P.failState}))},P.retryDelay)},H.prototype.cancelTransitionTimer=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},H.prototype.startSuspendTimer=function(){var P=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){P.suspendTimer&&(P.suspendTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),P.states.connecting.failState="suspended",P.notifyState({state:"suspended"}))},this.connectionStateTtl))},H.prototype.checkSuspendTimer=function(P){P!=="disconnected"&&P!=="suspended"&&P!=="connecting"&&this.cancelSuspendTimer()},H.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},H.prototype.startRetryTimer=function(P){var N=this;this.retryTimer=setTimeout(function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},P)},H.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},H.prototype.notifyState=function(P){var N=this,j,B,z=P.state,J=z==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||P.retryImmediately||this.state===this.states.connecting&&P.error&&y.default.isTokenErr(P.error)&&!(this.errorReason&&y.default.isTokenErr(this.errorReason)));if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+z+(J?"; will retry connection immediately":"")),z!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(P.state),(z==="suspended"||z==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var Q=this.states[P.state],X=Q.retryDelay;Q.state==="disconnected"&&(this.disconnectedRetryCount++,X=f.getRetryTime(Q.retryDelay,this.disconnectedRetryCount));var ee=new S.default(this.state.state,Q.state,X,P.error||((B=(j=R.default)[Q.state])===null||B===void 0?void 0:B.call(j)));if(J){var re=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=f.now(),N.requestState({state:"connecting"}))},Y=this.lastAutoReconnectAttempt&&f.now()-this.lastAutoReconnectAttempt+1;Y&&Y<1e3?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+Y+"ms ago, waiting another "+(1e3-Y)+"ms before trying again"),setTimeout(re,1e3-Y)):b.default.Config.nextTick(re)}else(z==="disconnected"||z==="suspended")&&this.startRetryTimer(X);(z==="disconnected"&&!J||z==="suspended"||Q.terminal)&&b.default.Config.nextTick(function(){N.disconnectAllTransports()}),z=="connected"&&!this.activeProtocol&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ee),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(z,ee.reason),this.failQueuedMessages(ee.reason))}},H.prototype.requestState=function(P){var N=this,j,B,z=P.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+z+"; current state: "+this.state.state),z!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(z),!(z=="connecting"&&this.state.state=="connected")&&!(z=="closing"&&this.state.state=="closed"))){var J=this.states[z],Q=new S.default(this.state.state,J.state,null,P.error||((B=(j=R.default)[J.state])===null||B===void 0?void 0:B.call(j)));this.enactStateChange(Q),z=="connecting"&&b.default.Config.nextTick(function(){N.startConnect()}),z=="closing"&&this.closeImpl()}},H.prototype.startConnect=function(){var P=this;if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,j=++this.connectCounter,B=function(){P.checkConnectionStateFreshness(),P.getTransportParams(function(J){if(J.mode==="recover"&&J.options.recover){var Q=F(J.options.recover);Q&&P.realtime.channels.recoverChannels(Q.channelSerials)}j===P.connectCounter&&P.connectImpl(J,j)})};if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")B();else{var z=function(J){j===P.connectCounter&&(J?P.actOnErrorFromAuthorize(J):B())};this.errorReason&&y.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,z):N._ensureValidAuthCredentials(!1,z)}},H.prototype.connectImpl=function(P,N){var j=this.state.state;j!==this.states.connecting.state&&j!==this.states.connected.state?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+j):this.pendingTransports.length?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):j==this.states.connected.state?this.upgradeIfNeeded(P):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(P,N):this.connectBase(P,N)},H.prototype.connectPreference=function(P,N){var j=this,B=this.getTransportPreference(),z=!1;f.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(P,N)),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var J=setTimeout(function(){z=!0,j.state.state!==j.states.connected.state&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),j.disconnectAllTransports(),j.unpersistTransportPreference()),j.connectImpl(P,N)},this.options.timeouts.preferenceConnectTimeout);P.host=this.httpHosts[0],this.tryATransport(P,B,function(Q,X){clearTimeout(J),z&&X?(X.off(),X.disconnect(),f.arrDeleteValue(j.pendingTransports,X)):!X&&!Q&&(j.unpersistTransportPreference(),j.connectImpl(P,N))})},H.prototype.connectBase=function(P,N){var j=this,B=function(ee){j.notifyState({state:j.states.connecting.failState,error:ee})},z=this.httpHosts.slice(),J=function(ee,re){N===j.connectCounter&&!re&&!ee&&X()};l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var Q=z.shift();if(!Q){B(new I.default("Unable to connect (no available host)",80003,404));return}P.host=Q;var X=function(){if(!z.length){B(new I.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!j.realtime.http.checkConnectivity){B(new I.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}j.realtime.http.checkConnectivity(function(ee,re){if(N===j.connectCounter){if(ee){B(ee);return}if(!re){B(new I.default("Unable to connect (network unreachable)",80003,404));return}P.host=f.arrPopRandomElement(z),j.tryATransport(P,j.baseTransport,J)}})};if(this.forceFallbackHost&&z.length){this.forceFallbackHost=!1,X();return}this.tryATransport(P,this.baseTransport,J)},H.prototype.getUpgradePossibilities=function(){var P=this.activeProtocol.getTransport().shortName,N=f.arrIndexOf(this.upgradeTransports,P);return this.upgradeTransports.slice(N+1)},H.prototype.upgradeIfNeeded=function(P){var N=this,j=this.getUpgradePossibilities();l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+b.default.Config.inspect(j)),j.length&&f.arrForEach(j,function(B){var z=N.createTransportParams(P.host,"upgrade");N.tryATransport(z,B,w)})},H.prototype.closeImpl=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),f.safeArrForEach(this.pendingTransports,function(P){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+P),P&&P.close()}),f.safeArrForEach(this.proposedTransports,function(P){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+P),P&&P.dispose()}),this.activeProtocol&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},H.prototype.onAuthUpdated=function(P,N){var j=this,B;switch(this.state.state){case"connected":{if(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var z=this.activeProtocol.getTransport().params;b.default.Config.nextTick(function(){j.state.state==="connected"&&j.upgradeIfNeeded(z)})}var J=(B=this.activeProtocol)===null||B===void 0?void 0:B.getTransport();J&&J.onAuthUpdated&&J.onAuthUpdated(P);var Q=u.default.fromValues({action:g.AUTH,auth:{accessToken:P.token}});this.send(Q);var X=function(){j.off(ee),N(null,P)},ee=function(Y){Y.current==="failed"&&(j.off(X),j.off(ee),N(Y.reason||j.getStateError()))};this.once("connectiondetails",X),this.on("connectionstate",ee);break}case"connecting":l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var re=function(Y){switch(Y.current){case"connected":j.off(re),N(null,P);break;case"failed":case"closed":case"suspended":j.off(re),N(Y.reason||j.getStateError());break}};this.on("connectionstate",re),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},H.prototype.disconnectAllTransports=function(P){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(P?" except the active transport":"")),this.connectCounter++,f.safeArrForEach(this.pendingTransports,function(N){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],f.safeArrForEach(this.proposedTransports,function(N){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!P&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},H.prototype.send=function(P,N,j){j=j||w;var B=this.state;if(B.sendEvents){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new d.PendingMessage(P,j));return}var z=N&&B.queueEvents||B.forceQueueEvents;if(!z){var J="rejecting event, queueEvent was "+N+", state was "+B.state;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()",J),j(this.errorReason||new I.default(J,9e4,400));return}l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+u.default.stringify(P)),this.queue(P,j)},H.prototype.sendImpl=function(P){var N=P.message;P.ackRequired&&!P.sendAttempted&&(N.msgSerial=this.msgSerial++);try{this.activeProtocol.send(P)}catch(j){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+j.stack)}},H.prototype.queue=function(P,N){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var j=this.queuedMessages.last(),B=this.options.maxMessageSize;j&&!j.sendAttempted&&L(j.message,P,B)?(j.merged||(j.callback=x.default.create([j.callback]),j.merged=!0),j.callback.push(N)):this.queuedMessages.push(new d.PendingMessage(P,N))},H.prototype.sendQueuedMessages=function(){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var P;P=this.queuedMessages.shift();)this.sendImpl(P)},H.prototype.queuePendingMessages=function(P){P&&P.length&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+P.length+" pending messages"),this.queuedMessages.prepend(P))},H.prototype.failQueuedMessages=function(P){var N=this.queuedMessages.count();N>0&&(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+f.inspectError(P)),this.queuedMessages.completeAllMessages(P))},H.prototype.onChannelMessage=function(P,N){var j=this.activeProtocol&&N===this.activeProtocol.getTransport(),B=f.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing;j||B?this.realtime.channels.onChannelMessage(P):f.arrIndexOf([g.ACK,g.NACK,g.ERROR],P.action)>-1?this.realtime.channels.onChannelMessage(P):l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(P)+"on defunct transport; discarding")},H.prototype.ping=function(P,N){var j=this;if(P){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+P);var B=function(){P.off("heartbeat",Q),N(new I.default("Timeout waiting for heartbeat response",5e4,500))},z=f.now(),J=f.cheapRandStr(),Q=function(ie){if(ie===J){P.off("heartbeat",Q),clearTimeout(X);var he=f.now()-z;N(null,he)}},X=setTimeout(B,this.options.timeouts.realtimeRequestTimeout);P.on("heartbeat",Q),P.ping(J);return}if(this.state.state!=="connected"){N(new I.default("Unable to ping service; not connected",4e4,400));return}var ee=!1,re=function(ie,he){j.off("transport.active",Y),ee||(ee=!0,N(ie,he))},Y=function(){ee||(ee=!0,b.default.Config.nextTick(function(){j.ping(null,N)}))};this.on("transport.active",Y),this.ping(this.activeProtocol.getTransport(),re)},H.prototype.abort=function(P){this.activeProtocol.getTransport().fail(P)},H.prototype.registerProposedTransport=function(P){this.proposedTransports.push(P)},H.prototype.getTransportPreference=function(){var P,N;return this.transportPreference||a()&&((N=(P=b.default.WebStorage)===null||P===void 0?void 0:P.get)===null||N===void 0?void 0:N.call(P,D))},H.prototype.persistTransportPreference=function(P){var N,j;f.arrIn(m.default.upgradeTransports,P.shortName)&&(this.transportPreference=P.shortName,a()&&((j=(N=b.default.WebStorage)===null||N===void 0?void 0:N.set)===null||j===void 0||j.call(N,D,P.shortName)))},H.prototype.unpersistTransportPreference=function(){var P,N;this.transportPreference=null,a()&&((N=(P=b.default.WebStorage)===null||P===void 0?void 0:P.remove)===null||N===void 0||N.call(P,D))},H.prototype.actOnErrorFromAuthorize=function(P){if(P.code===40171)this.notifyState({state:"failed",error:P});else if(P.code===40102)this.notifyState({state:"failed",error:P});else if(P.statusCode===c.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new I.default(N,80019,403,P)})}else{var N="Client configured authentication provider request failed";l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new I.default(N,80019,401,P)})}},H.prototype.onConnectionDetailsUpdate=function(P,N){if(P){this.connectionDetails=P,P.maxMessageSize&&(this.options.maxMessageSize=P.maxMessageSize);var j=P.clientId;if(j){var B=this.realtime.auth._uncheckedSetClientId(j);if(B){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",B.message),N.fail(B);return}}var z=P.connectionStateTtl;z&&(this.connectionStateTtl=z),this.maxIdleInterval=P.maxIdleInterval,this.emit("connectiondetails",P)}},H.supportedTransports={},H}(C.default);n.default=G}).call(this,i(13))},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(7)),u=s.__importDefault(i(2)),f=function(d){s.__extends(m,d);function m(){var b=d.call(this)||this;return b.messages=[],b}return m.prototype.count=function(){return this.messages.length},m.prototype.push=function(b){this.messages.push(b)},m.prototype.shift=function(){return this.messages.shift()},m.prototype.last=function(){return this.messages[this.messages.length-1]},m.prototype.copyAll=function(){return this.messages.slice()},m.prototype.append=function(b){this.messages.push.apply(this.messages,b)},m.prototype.prepend=function(b){this.messages.unshift.apply(this.messages,b)},m.prototype.completeMessages=function(b,C,T){u.default.logAction(u.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+b+"; count = "+C),T=T||null;var l=this.messages;if(l.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var S=l[0];if(S){var R=S.message.msgSerial,I=b+C;if(I>R)for(var y=l.splice(0,I-R),O=0,x=y;O<x.length;O++){var p=x[O];p.callback(T)}l.length==0&&this.emit("idle")}},m.prototype.completeAllMessages=function(b){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,b)},m.prototype.resetSendAttempted=function(){for(var b=0,C=this.messages;b<C.length;b++){var T=C[b];T.sendAttempted=!1}},m.prototype.clear=function(){u.default.logAction(u.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},m}(o.default);n.default=f},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function o(u,f,d,m){this.previous=u,this.current=f,d&&(this.retryIn=d),m&&(this.reason=m)}return o}();n.default=s},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),u=s.__importDefault(i(7)),f=s.__importStar(i(1)),d=s.__importDefault(i(33)),m=s.__importDefault(i(2)),b=s.__importDefault(i(54)),C=s.__importDefault(i(9)),T=s.__importDefault(i(39)),l=s.__importStar(i(4)),S=s.__importDefault(i(16)),R=s.__importDefault(i(21)),I=o.default.Action,y=function(){};function O(h){if(h&&"params"in h&&!f.isObject(h.params))return new l.default("options.params must be an object",4e4,400);if(h&&"modes"in h){if(!f.isArray(h.modes))return new l.default("options.modes must be an array",4e4,400);for(var c=0;c<h.modes.length;c++){var a=h.modes[c];if(!a||typeof a!="string"||!f.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(a)))return new l.default("Invalid channel mode: "+a,4e4,400)}}}var x=function(h){s.__extends(c,h);function c(a,v,g){var w=h.call(this,a,v,g)||this;return w.retryCount=0,w.history=function(D,k){if(m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),k===void 0)if(typeof D=="function")k=D,D=null;else{if(this.rest.options.promises)return f.promisify(this,"history",arguments);k=y}if(D&&D.untilAttach){if(this.state!=="attached"){k(new l.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){k(new l.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete D.untilAttach,D.from_serial=this.properties.attachSerial}d.default.prototype._history.call(this,D,k)},w.whenState=function(D,k){return u.default.prototype.whenState.call(w,D,w.state,k)},m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel()","started; name = "+v),w.realtime=a,w.presence=new b.default(w),w.connectionManager=a.connection.connectionManager,w.state="initialized",w.subscriptions=new u.default,w.syncChannelSerial=void 0,w.properties={attachSerial:void 0,channelSerial:void 0},w.setOptions(g),w.errorReason=null,w._requestedFlags=null,w._mode=null,w._attachResume=!1,w._decodingContext={channelOptions:w.channelOptions,plugins:a.options.plugins||{},baseEncodedPreviousPayload:void 0},w._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},w._allChannelChanges=new u.default,w}return c.prototype.invalidStateError=function(){return new l.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},c.processListenerArgs=function(a){return a=Array.prototype.slice.call(a),typeof a[0]=="function"&&a.unshift(null),a[a.length-1]==null&&a.pop(),a},c.prototype.setOptions=function(a,v){var g=this.channelOptions;if(!v&&this.rest.options.promises)return f.promisify(this,"setOptions",arguments);var w=v||function(k){k&&m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+k.toString())},D=O(a);if(D){w(D);return}d.default.prototype.setOptions.call(this,a),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(a,g)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(k){switch(this.event){case"update":case"attached":w==null||w(null);return;default:w==null||w(k.reason);return}})):w()},c.prototype._shouldReattachToSetOptions=function(a,v){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(a!=null&&a.params){var g=p(a.params),w=p(v.params);if(Object.keys(g).length!==Object.keys(w).length||!f.shallowEquals(w,g))return!0}return!!(a!=null&&a.modes&&(!v.modes||!f.arrEquals(a.modes,v.modes)))},c.prototype.publish=function(){for(var a=this,v=[],g=0;g<arguments.length;g++)v[g]=arguments[g];var w=v[0],D=v.length,k=v[D-1];if(typeof k!="function"){if(this.realtime.options.promises)return f.promisify(this,"publish",arguments);k=y,++D}if(!this.connectionManager.activeState()){k(this.connectionManager.getError());return}if(D==2)if(f.isObject(w))w=[C.default.fromValues(w)];else if(f.isArray(w))w=C.default.fromValuesArray(w);else throw new l.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else w=[C.default.fromValues({name:v[0],data:v[1]})];var M=this.realtime.options.maxMessageSize;C.default.encodeArray(w,this.channelOptions,function(_){if(_){k(_);return}var A=C.default.getMessagesSize(w);if(A>M){k(new l.default("Maximum size of messages that can be published at once exceeded ( was "+A+" bytes; limit is "+M+" bytes)",40009,400));return}a.__publish(w,k)})},c.prototype.__publish=function(a,v){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+a.length);var g=this.state;switch(g){case"failed":case"suspended":v(l.default.fromValues(this.invalidStateError()));break;default:{m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+g);var w=new o.default;w.action=I.MESSAGE,w.channel=this.name,w.messages=a,this.sendMessage(w,v);break}}},c.prototype.onEvent=function(a){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var v=this.subscriptions,g=0;g<a.length;g++){var w=a[g];v.emit(w.name,w)}},c.prototype.attach=function(a,v){var g;if(typeof a=="function"?(v=a,g=null):g=a,!v){if(this.realtime.options.promises)return f.promisify(this,"attach",arguments);v=function(w){w&&m.default.logAction(m.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+w.toString())}}if(g)m.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=g;else if(this.state==="attached"){v(null,null);return}this._attach(!1,null,v)},c.prototype._attach=function(a,v,g){g||(g=function(D){D&&m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+D.toString())});var w=this.connectionManager;if(!w.activeState()){g(w.getError());return}(this.state!=="attaching"||a)&&this.requestState("attaching",v),this.once(function(D){switch(this.event){case"attached":g==null||g(null,D);break;case"detached":case"suspended":case"failed":g==null||g(D.reason||w.getError()||new l.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":g==null||g(new l.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},c.prototype.attachImpl=function(){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var a=o.default.fromValues({action:I.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?a.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&a.encodeModesToFlags(f.allToUpperCase(this.channelOptions.modes)),this._attachResume&&a.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(a.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(a,y)},c.prototype.detach=function(a){if(!a){if(this.realtime.options.promises)return f.promisify(this,"detach",arguments);a=y}var v=this.connectionManager;if(!v.activeState()){a(v.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),a();break;case"detached":a();break;case"failed":a(new l.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(g){switch(this.event){case"detached":a();break;case"attached":case"suspended":case"failed":a(g.reason||v.getError()||new l.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":a(new l.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},c.prototype.detachImpl=function(a){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var v=o.default.fromValues({action:I.DETACH,channel:this.name});this.sendMessage(v,a||y)},c.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var g=c.processListenerArgs(a),w=g[0],D=g[1],k=g[2];if(!k&&this.realtime.options.promises)return f.promisify(this,"subscribe",[w,D]);if(this.state==="failed"){k==null||k(l.default.fromValues(this.invalidStateError()));return}return w&&typeof w=="object"&&!Array.isArray(w)?this._subscribeFilter(w,D):this.subscriptions.on(w,D),this.attach(k||y)},c.prototype._subscribeFilter=function(a,v){var g=function(w){var D,k,M,_,A,E,L={name:w.name,refTimeserial:(k=(D=w.extras)===null||D===void 0?void 0:D.ref)===null||k===void 0?void 0:k.timeserial,refType:(_=(M=w.extras)===null||M===void 0?void 0:M.ref)===null||_===void 0?void 0:_.type,isRef:!!(!((E=(A=w.extras)===null||A===void 0?void 0:A.ref)===null||E===void 0)&&E.timeserial),clientId:w.clientId};Object.entries(a).find(function(F){var U=F[0],G=F[1];return G!==void 0?L[U]!==G:!1})||v(w)};this._addFilteredSubscription(a,v,g),this.subscriptions.on(g)},c.prototype._addFilteredSubscription=function(a,v,g){var w;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(v)){var D=this.filteredSubscriptions.get(v);D.set(a,((w=D==null?void 0:D.get(a))===null||w===void 0?void 0:w.concat(g))||[g])}else this.filteredSubscriptions.set(v,new Map([[a,[g]]]))},c.prototype._getAndDeleteFilteredSubscriptions=function(a,v){var g=this;if(!this.filteredSubscriptions)return[];if(!v&&a)return Array.from(this.filteredSubscriptions.entries()).map(function(M){var _,A=M[0],E=M[1],L=E.get(a);return E.delete(a),E.size===0&&((_=g.filteredSubscriptions)===null||_===void 0||_.delete(A)),L}).reduce(function(M,_){var A;return _?(A=M).concat.apply(A,_):M},[]);if(!v||!this.filteredSubscriptions.has(v))return[];var w=this.filteredSubscriptions.get(v);if(!a){var D=Array.from(w.values()).reduce(function(M,_){return M.concat.apply(M,_)},[]);return this.filteredSubscriptions.delete(v),D}var k=w.get(a);return w.delete(a),k||[]},c.prototype.unsubscribe=function(){for(var a=this,v,g=[],w=0;w<arguments.length;w++)g[w]=arguments[w];var D=c.processListenerArgs(g),k=D[0],M=D[1];if(typeof k=="object"&&!M||!((v=this.filteredSubscriptions)===null||v===void 0)&&v.has(M)){this._getAndDeleteFilteredSubscriptions(k,M).forEach(function(_){return a.subscriptions.off(_)});return}this.subscriptions.off(k,M)},c.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new l.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var a=this.connectionManager;if(!a.activeState())throw a.getError();var v=o.default.fromValues({action:I.SYNC,channel:this.name});this.syncChannelSerial&&(v.channelSerial=this.syncChannelSerial),a.send(v)},c.prototype.sendMessage=function(a,v){this.connectionManager.send(a,this.realtime.options.queueMessages,v)},c.prototype.sendPresence=function(a,v){var g=o.default.fromValues({action:I.PRESENCE,channel:this.name,presence:f.isArray(a)?S.default.fromValuesArray(a):[S.default.fromValues(a)]});this.sendMessage(g,v)},c.prototype.onMessage=function(a){(a.action===I.ATTACHED||a.action===I.MESSAGE||a.action===I.PRESENCE)&&this.setChannelSerial(a.channelSerial);var v,g=!1;switch(a.action){case I.ATTACHED:{this.properties.attachSerial=a.channelSerial,this._mode=a.getMode(),this.params=a.params||{};var w=a.decodeModesFromFlags();this.modes=w&&f.allToLowerCase(w)||void 0;var D=a.hasFlag("RESUMED"),k=a.hasFlag("HAS_PRESENCE"),M=a.hasFlag("HAS_BACKLOG");if(this.state==="attached"){D||this.presence.onAttached(k);var _=new T.default(this.state,this.state,D,M,a.error);this._allChannelChanges.emit("update",_),(!D||this.channelOptions.updateOnAttached)&&this.emit("update",_)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",a.error,D,k,M);break}case I.DETACHED:{var A=a.error?l.default.fromValues(a.error):new l.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",A):this.state==="attaching"?this.notifyState("suspended",A):this.requestState("attaching",A);break}case I.SYNC:if(g=!0,v=this.syncChannelSerial=a.channelSerial,!a.presence)break;case I.PRESENCE:{for(var E=a.presence,L=a.id,F=a.connectionId,U=a.timestamp,G=this.channelOptions,V=void 0,H=0;H<E.length;H++)try{V=E[H],S.default.decode(V,G),V.connectionId||(V.connectionId=F),V.timestamp||(V.timestamp=U),V.id||(V.id=L+":"+H)}catch(J){m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()",J.toString())}this.presence.setPresence(E,g,v);break}case I.MESSAGE:{if(this.state!=="attached"){m.default.logAction(m.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+a.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var P=a.messages,N=P[0],j=P[P.length-1],L=a.id,F=a.connectionId,U=a.timestamp;if(N.extras&&N.extras.delta&&N.extras.delta.from!==this._lastPayload.messageId){var B='Delta message decode failure - previous message not available for message "'+a.id+'" on this channel "'+this.name+'".';m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()",B),this._startDecodeFailureRecovery(new l.default(B,40018,400));break}for(var H=0;H<P.length;H++){var B=P[H];try{C.default.decode(B,this._decodingContext)}catch(Y){switch(m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()",Y.toString()),Y.code){case 40018:this._startDecodeFailureRecovery(Y);return;case 40019:case 40021:this.notifyState("failed",Y);return}}B.connectionId||(B.connectionId=F),B.timestamp||(B.timestamp=U),B.id||(B.id=L+":"+H)}this._lastPayload.messageId=j.id,this._lastPayload.protocolMessageChannelSerial=a.channelSerial,this.onEvent(P);break}case I.ERROR:{var z=a.error;z&&z.code==80016?this.checkPendingState():this.notifyState("failed",l.default.fromValues(z));break}default:m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+a.action+")"),this.connectionManager.abort(R.default.unknownChannelErr())}},c.prototype._startDecodeFailureRecovery=function(a){var v=this;this._lastPayload.decodeFailureRecoveryInProgress||(m.default.logAction(m.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,a,function(){v._lastPayload.decodeFailureRecoveryInProgress=!1}))},c.prototype.onAttached=function(){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},c.prototype.notifyState=function(a,v,g,w,D){if(m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+a),this.clearStateTimer(),f.arrIn(["detached","suspended","failed"],a)&&(this.properties.channelSerial=null),a!==this.state){this.presence.actOnChannelState(a,w,v),a==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),v&&(this.errorReason=v);var k=new T.default(this.state,a,g,D,v),M=a==="failed"?m.default.LOG_ERROR:m.default.LOG_MAJOR;m.default.logAction(M,'Channel state for channel "'+this.name+'"',a+(v?"; reason: "+v:"")),a!=="attaching"&&a!=="suspended"&&(this.retryCount=0),a==="attached"&&this.onAttached(),a==="attached"?this._attachResume=!0:(a==="detaching"||a==="failed")&&(this._attachResume=!1),this.state=a,this._allChannelChanges.emit(a,k),this.emit(a,k)}},c.prototype.requestState=function(a,v){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+a),this.notifyState(a,v),this.checkPendingState()},c.prototype.checkPendingState=function(){var a=this.connectionManager.state;if(!(a.sendEvents||a.forceQueueEvents)){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},c.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var a=new l.default("Channel attach timed out",90007,408);this.notifyState("suspended",a);break}case"detaching":{var a=new l.default("Channel detach timed out",90007,408);this.notifyState("attached",a);break}default:this.checkPendingState();break}},c.prototype.startStateTimerIfNotRunning=function(){var a=this;this.stateTimer||(this.stateTimer=setTimeout(function(){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),a.stateTimer=null,a.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},c.prototype.clearStateTimer=function(){var a=this.stateTimer;a&&(clearTimeout(a),this.stateTimer=null)},c.prototype.startRetryTimer=function(){var a=this;if(!this.retryTimer){this.retryCount++;var v=f.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){a.state==="suspended"&&a.connectionManager.state.sendEvents&&(a.retryTimer=null,m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),a.requestState("attaching"))},v)}},c.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},c.prototype.getReleaseErr=function(){var a=this.state;return a==="initialized"||a==="detached"||a==="failed"?null:new l.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+a,90001,400)},c.prototype.setChannelSerial=function(a){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+a+"; previous = "+this.properties.channelSerial),a&&(this.properties.channelSerial=a)},c}(d.default);function p(h){var c=h||{};c.agent;var a=s.__rest(c,["agent"]);return a}n.default=x},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function o(u,f,d,m,b){this.previous=u,this.current=f,f==="attached"&&(this.resumed=d,this.hasBacklog=m),b&&(this.reason=b)}return o}();n.default=s},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return function(){var o=s,u=o.lib,f=u.WordArray,d=u.Hasher,m=o.algo,b=[],C=m.SHA1=d.extend({_doReset:function(){this._hash=new f.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(T,l){for(var S=this._hash.words,R=S[0],I=S[1],y=S[2],O=S[3],x=S[4],p=0;p<80;p++){if(p<16)b[p]=T[l+p]|0;else{var h=b[p-3]^b[p-8]^b[p-14]^b[p-16];b[p]=h<<1|h>>>31}var c=(R<<5|R>>>27)+x+b[p];p<20?c+=(I&y|~I&O)+1518500249:p<40?c+=(I^y^O)+1859775393:p<60?c+=(I&y|I&O|y&O)-1894007588:c+=(I^y^O)-899497514,x=O,O=y,y=I<<30|I>>>2,I=R,R=c}S[0]=S[0]+R|0,S[1]=S[1]+I|0,S[2]=S[2]+y|0,S[3]=S[3]+O|0,S[4]=S[4]+x|0},_doFinalize:function(){var T=this._data,l=T.words,S=this._nDataBytes*8,R=T.sigBytes*8;return l[R>>>5]|=128<<24-R%32,l[(R+64>>>9<<4)+14]=Math.floor(S/4294967296),l[(R+64>>>9<<4)+15]=S,T.sigBytes=l.length*4,this._process(),this._hash},clone:function(){var T=d.clone.call(this);return T._hash=this._hash.clone(),T}});o.SHA1=d._createHelper(C),o.HmacSHA1=d._createHmacHelper(C)}(),s.SHA1})},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});function s(p){if(p===void 0)return"undefined";var h,c;if(p instanceof ArrayBuffer?(c="ArrayBuffer",h=new DataView(p)):p instanceof DataView&&(c="DataView",h=p),!h)return JSON.stringify(p);for(var a=[],v=0;v<p.byteLength;v++){if(v>20){a.push("...");break}var g=h.getUint8(v).toString(16);g.length===1&&(g="0"+g),a.push(g)}return"<"+c+" "+a.join(" ")+">"}function o(p,h,c){for(var a=0,v=c.length;a<v;a++){var g=c.charCodeAt(a);if(g<128){p.setUint8(h++,g>>>0&127|0);continue}if(g<2048){p.setUint8(h++,g>>>6&31|192),p.setUint8(h++,g>>>0&63|128);continue}if(g<65536){p.setUint8(h++,g>>>12&15|224),p.setUint8(h++,g>>>6&63|128),p.setUint8(h++,g>>>0&63|128);continue}if(g<1114112){p.setUint8(h++,g>>>18&7|240),p.setUint8(h++,g>>>12&63|128),p.setUint8(h++,g>>>6&63|128),p.setUint8(h++,g>>>0&63|128);continue}throw new Error("bad codepoint "+g)}}function u(p,h,c){for(var a="",v=h,g=h+c;v<g;v++){var w=p.getUint8(v);if(!(w&128)){a+=String.fromCharCode(w);continue}if((w&224)===192){a+=String.fromCharCode((w&15)<<6|p.getUint8(++v)&63);continue}if((w&240)===224){a+=String.fromCharCode((w&15)<<12|(p.getUint8(++v)&63)<<6|(p.getUint8(++v)&63)<<0);continue}if((w&248)===240){a+=String.fromCharCode((w&7)<<18|(p.getUint8(++v)&63)<<12|(p.getUint8(++v)&63)<<6|(p.getUint8(++v)&63)<<0);continue}throw new Error("Invalid byte "+w.toString(16))}return a}function f(p){for(var h=0,c=0,a=p.length;c<a;c++){var v=p.charCodeAt(c);if(v<128){h+=1;continue}if(v<2048){h+=2;continue}if(v<65536){h+=3;continue}if(v<1114112){h+=4;continue}throw new Error("bad codepoint "+v)}return h}function d(p,h){var c=x(p,h);if(c!==0){var a=new ArrayBuffer(c),v=new DataView(a);return O(p,v,0,h),a}}var m=65536*65536,b=1/m;function C(p,h){return h=h||0,p.getInt32(h)*m+p.getUint32(h+4)}function T(p,h){return h=h||0,p.getUint32(h)*m+p.getUint32(h+4)}function l(p,h,c){c<9223372036854776e3?(p.setInt32(h,Math.floor(c*b)),p.setInt32(h+4,c&-1)):(p.setUint32(h,2147483647),p.setUint32(h+4,2147483647))}function S(p,h,c){c<18446744073709552e3?(p.setUint32(h,Math.floor(c*b)),p.setInt32(h+4,c&-1)):(p.setUint32(h,4294967295),p.setUint32(h+4,4294967295))}var R=function(){function p(h,c){var a=this;this.map=function(v){for(var g={},w=0;w<v;w++){var D=a.parse();g[D]=a.parse()}return g},this.bin=function(v){var g=new ArrayBuffer(v);return new Uint8Array(g).set(new Uint8Array(a.view.buffer,a.offset,v),0),a.offset+=v,g},this.buf=this.bin,this.str=function(v){var g=u(a.view,a.offset,v);return a.offset+=v,g},this.array=function(v){for(var g=new Array(v),w=0;w<v;w++)g[w]=a.parse();return g},this.ext=function(v){return a.offset+=v,{type:a.view.getInt8(a.offset),data:a.buf(v)}},this.parse=function(){var v=a.view.getUint8(a.offset),g,w;if(!(v&128))return a.offset++,v;if((v&240)===128)return w=v&15,a.offset++,a.map(w);if((v&240)===144)return w=v&15,a.offset++,a.array(w);if((v&224)===160)return w=v&31,a.offset++,a.str(w);if((v&224)===224)return g=a.view.getInt8(a.offset),a.offset++,g;switch(v){case 192:return a.offset++,null;case 193:a.offset++;return;case 194:return a.offset++,!1;case 195:return a.offset++,!0;case 196:return w=a.view.getUint8(a.offset+1),a.offset+=2,a.bin(w);case 197:return w=a.view.getUint16(a.offset+1),a.offset+=3,a.bin(w);case 198:return w=a.view.getUint32(a.offset+1),a.offset+=5,a.bin(w);case 199:return w=a.view.getUint8(a.offset+1),a.offset+=2,a.ext(w);case 200:return w=a.view.getUint16(a.offset+1),a.offset+=3,a.ext(w);case 201:return w=a.view.getUint32(a.offset+1),a.offset+=5,a.ext(w);case 202:return g=a.view.getFloat32(a.offset+1),a.offset+=5,g;case 203:return g=a.view.getFloat64(a.offset+1),a.offset+=9,g;case 204:return g=a.view.getUint8(a.offset+1),a.offset+=2,g;case 205:return g=a.view.getUint16(a.offset+1),a.offset+=3,g;case 206:return g=a.view.getUint32(a.offset+1),a.offset+=5,g;case 207:return g=T(a.view,a.offset+1),a.offset+=9,g;case 208:return g=a.view.getInt8(a.offset+1),a.offset+=2,g;case 209:return g=a.view.getInt16(a.offset+1),a.offset+=3,g;case 210:return g=a.view.getInt32(a.offset+1),a.offset+=5,g;case 211:return g=C(a.view,a.offset+1),a.offset+=9,g;case 212:return w=1,a.offset++,a.ext(w);case 213:return w=2,a.offset++,a.ext(w);case 214:return w=4,a.offset++,a.ext(w);case 215:return w=8,a.offset++,a.ext(w);case 216:return w=16,a.offset++,a.ext(w);case 217:return w=a.view.getUint8(a.offset+1),a.offset+=2,a.str(w);case 218:return w=a.view.getUint16(a.offset+1),a.offset+=3,a.str(w);case 219:return w=a.view.getUint32(a.offset+1),a.offset+=5,a.str(w);case 220:return w=a.view.getUint16(a.offset+1),a.offset+=3,a.array(w);case 221:return w=a.view.getUint32(a.offset+1),a.offset+=5,a.array(w);case 222:return w=a.view.getUint16(a.offset+1),a.offset+=3,a.map(w);case 223:return w=a.view.getUint32(a.offset+1),a.offset+=5,a.map(w)}throw new Error("Unknown type 0x"+v.toString(16))},this.offset=c||0,this.view=h}return p}();function I(p){var h=new DataView(p),c=new R(h),a=c.parse();if(c.offset!==p.byteLength)throw new Error(p.byteLength-c.offset+" trailing bytes");return a}function y(p,h){return Object.keys(p).filter(function(c){var a=p[c],v=typeof a;return(!h||a!=null)&&(v!=="function"||!!a.toJSON)})}function O(p,h,c,a){var v=typeof p;if(typeof p=="string"){var g=f(p);if(g<32)return h.setUint8(c,g|160),o(h,c+1,p),1+g;if(g<256)return h.setUint8(c,217),h.setUint8(c+1,g),o(h,c+2,p),2+g;if(g<65536)return h.setUint8(c,218),h.setUint16(c+1,g),o(h,c+3,p),3+g;if(g<4294967296)return h.setUint8(c,219),h.setUint32(c+1,g),o(h,c+5,p),5+g}if(ArrayBuffer.isView&&ArrayBuffer.isView(p)&&(p=p.buffer),p instanceof ArrayBuffer){var w=p.byteLength;if(w<256)return h.setUint8(c,196),h.setUint8(c+1,w),new Uint8Array(h.buffer).set(new Uint8Array(p),c+2),2+w;if(w<65536)return h.setUint8(c,197),h.setUint16(c+1,w),new Uint8Array(h.buffer).set(new Uint8Array(p),c+3),3+w;if(w<4294967296)return h.setUint8(c,198),h.setUint32(c+1,w),new Uint8Array(h.buffer).set(new Uint8Array(p),c+5),5+w}if(typeof p=="number"){if(Math.floor(p)!==p)return h.setUint8(c,203),h.setFloat64(c+1,p),9;if(p>=0){if(p<128)return h.setUint8(c,p),1;if(p<256)return h.setUint8(c,204),h.setUint8(c+1,p),2;if(p<65536)return h.setUint8(c,205),h.setUint16(c+1,p),3;if(p<4294967296)return h.setUint8(c,206),h.setUint32(c+1,p),5;if(p<18446744073709552e3)return h.setUint8(c,207),S(h,c+1,p),9;throw new Error("Number too big 0x"+p.toString(16))}if(p>=-32)return h.setInt8(c,p),1;if(p>=-128)return h.setUint8(c,208),h.setInt8(c+1,p),2;if(p>=-32768)return h.setUint8(c,209),h.setInt16(c+1,p),3;if(p>=-2147483648)return h.setUint8(c,210),h.setInt32(c+1,p),5;if(p>=-9223372036854776e3)return h.setUint8(c,211),l(h,c+1,p),9;throw new Error("Number too small -0x"+(-p).toString(16).substr(1))}if(v==="undefined")return a?0:(h.setUint8(c,212),h.setUint8(c+1,0),h.setUint8(c+2,0),3);if(p===null)return a?0:(h.setUint8(c,192),1);if(v==="boolean")return h.setUint8(c,p?195:194),1;if(typeof p.toJSON=="function")return O(p.toJSON(),h,c,a);if(v==="object"){var D,k=0,M=void 0,_=Array.isArray(p);if(_?D=p.length:(M=y(p,a),D=M.length),D<16?(h.setUint8(c,D|(_?144:128)),k=1):D<65536?(h.setUint8(c,_?220:222),h.setUint16(c+1,D),k=3):D<4294967296&&(h.setUint8(c,_?221:223),h.setUint32(c+1,D),k=5),_)for(var A=0;A<D;A++)k+=O(p[A],h,c+k,a);else if(M)for(var A=0;A<D;A++){var E=M[A];k+=O(E,h,c+k),k+=O(p[E],h,c+k,a)}return k}if(v==="function")return 0;throw new Error("Unknown type "+v)}function x(p,h){var c=typeof p;if(c==="string"){var a=f(p);if(a<32)return 1+a;if(a<256)return 2+a;if(a<65536)return 3+a;if(a<4294967296)return 5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(p)&&(p=p.buffer),p instanceof ArrayBuffer){var v=p.byteLength;if(v<256)return 2+v;if(v<65536)return 3+v;if(v<4294967296)return 5+v}if(typeof p=="number"){if(Math.floor(p)!==p)return 9;if(p>=0){if(p<128)return 1;if(p<256)return 2;if(p<65536)return 3;if(p<4294967296)return 5;if(p<18446744073709552e3)return 9;throw new Error("Number too big 0x"+p.toString(16))}if(p>=-32)return 1;if(p>=-128)return 2;if(p>=-32768)return 3;if(p>=-2147483648)return 5;if(p>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+p.toString(16).substr(1))}if(c==="boolean")return 1;if(p===null)return h?0:1;if(p===void 0)return h?0:3;if(typeof p.toJSON=="function")return x(p.toJSON(),h);if(c==="object"){var g,w=0;if(Array.isArray(p)){g=p.length;for(var D=0;D<g;D++)w+=x(p[D],h)}else{var k=y(p,h);g=k.length;for(var D=0;D<g;D++){var M=k[D];w+=x(M)+x(p[M],h)}}if(g<16)return 1+w;if(g<65536)return 3+w;if(g<4294967296)return 5+w;throw new Error("Array or object too long 0x"+g.toString(16))}if(c==="function")return 0;throw new Error("Unknown type "+c)}n.default={encode:d,decode:I,inspect:s,utf8Write:o,utf8Read:u,utf8ByteCount:f}},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(30)),u=s.__importDefault(i(50)),f=s.__importDefault(i(3)),d=s.__importDefault(i(4)),m=s.__importDefault(i(55)),b=s.__importDefault(i(57)),C=s.__importDefault(i(62)),T=s.__importDefault(i(64)),l=s.__importDefault(i(68)),S=s.__importDefault(i(2)),R=i(8),I=s.__importDefault(i(65)),y=s.__importDefault(i(66)),O=s.__importDefault(i(41)),x=(0,b.default)(T.default,m.default);f.default.Crypto=x,f.default.BufferUtils=m.default,f.default.Http=C.default,f.default.Config=T.default,f.default.Transports=l.default,f.default.WebStorage=I.default,o.default.Crypto=x,u.default.Crypto=x,S.default.initLogHandlers(),f.default.Defaults=(0,R.getDefaults)(y.default),f.default.Config.agent&&(f.default.Defaults.agent+=" "+f.default.Config.agent),f.default.Config.noUpgrade&&(f.default.Defaults.upgradeTransports=[]),n.default={ErrorInfo:d.default,Rest:o.default,Realtime:u.default,msgpack:O.default}},function(t){t.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(t,n){},function(t,n,i){(function(s,o){t.exports=o(i(6),i(32),i(25))})(this,function(s){return s.HmacSHA256})},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(47)),f=s.__importDefault(i(15)),d=s.__importDefault(i(20)),m=s.__importDefault(i(4)),b=s.__importDefault(i(48)),C=function(){},T=function(){function I(y){this.rest=y,this.admin=new l(y)}return I}(),l=function(){function I(y){this.rest=y,this.deviceRegistrations=new S(y),this.channelSubscriptions=new R(y)}return I.prototype.publish=function(y,O,x){var p=this.rest,h=p.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultPostHeaders(p.options,h),a={},v=o.mixin({recipient:y},O);if(typeof x!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);x=C}p.options.headers&&o.mixin(c,p.options.headers),p.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var g=o.encodeBody(v,h);f.default.post(p,"/push/publish",g,c,a,null,function(w){return x(w)})},I}(),S=function(){function I(y){this.rest=y}return I.prototype.save=function(y,O){var x=this.rest,p=u.default.fromValues(y),h=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultPostHeaders(x.options,h),a={};if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);O=C}x.options.headers&&o.mixin(c,x.options.headers),x.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(p,h);f.default.put(x,"/push/deviceRegistrations/"+encodeURIComponent(y.id),v,c,a,null,function(g,w,D,k){O(g,g?void 0:u.default.fromResponseBody(w,k?void 0:h))})},I.prototype.get=function(y,O){var x=this.rest,p=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultGetHeaders(x.options,p),c=y.id||y;if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);O=C}if(typeof c!="string"||!c.length){O(new m.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&o.mixin(h,x.options.headers),f.default.get(x,"/push/deviceRegistrations/"+encodeURIComponent(c),h,{},null,function(a,v,g,w){O(a,a?void 0:u.default.fromResponseBody(v,w?void 0:p))})},I.prototype.list=function(y,O){var x=this.rest,p=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:p,c=o.defaultGetHeaders(x.options,p);if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);O=C}x.options.headers&&o.mixin(c,x.options.headers),new d.default(x,"/push/deviceRegistrations",c,h,function(a,v,g){return u.default.fromResponseBody(a,g?void 0:p)}).get(y,O)},I.prototype.remove=function(y,O){var x=this.rest,p=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultGetHeaders(x.options,p),c={},a=y.id||y;if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);O=C}if(typeof a!="string"||!a.length){O(new m.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}x.options.headers&&o.mixin(h,x.options.headers),x.options.pushFullWait&&o.mixin(c,{fullWait:"true"}),f.default.delete(x,"/push/deviceRegistrations/"+encodeURIComponent(a),h,c,null,function(v){return O(v)})},I.prototype.removeWhere=function(y,O){var x=this.rest,p=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultGetHeaders(x.options,p);if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);O=C}x.options.headers&&o.mixin(h,x.options.headers),x.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),f.default.delete(x,"/push/deviceRegistrations",h,y,null,function(c){return O(c)})},I}(),R=function(){function I(y){this.remove=I.prototype.removeWhere,this.rest=y}return I.prototype.save=function(y,O){var x=this.rest,p=b.default.fromValues(y),h=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultPostHeaders(x.options,h),a={};if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);O=C}x.options.headers&&o.mixin(c,x.options.headers),x.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(p,h);f.default.post(x,"/push/channelSubscriptions",v,c,a,null,function(g,w,D,k){O(g,!g&&b.default.fromResponseBody(w,k?void 0:h))})},I.prototype.list=function(y,O){var x=this.rest,p=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:p,c=o.defaultGetHeaders(x.options,p);if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);O=C}x.options.headers&&o.mixin(c,x.options.headers),new d.default(x,"/push/channelSubscriptions",c,h,function(a,v,g){return b.default.fromResponseBody(a,g?void 0:p)}).get(y,O)},I.prototype.removeWhere=function(y,O){var x=this.rest,p=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=o.defaultGetHeaders(x.options,p);if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);O=C}x.options.headers&&o.mixin(h,x.options.headers),x.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),f.default.delete(x,"/push/channelSubscriptions",h,y,null,function(c){return O(c)})},I.prototype.listChannels=function(y,O){var x=this.rest,p=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:p,c=o.defaultGetHeaders(x.options,p);if(typeof O!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);O=C}x.options.headers&&o.mixin(c,x.options.headers),x.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),new d.default(x,"/push/channels",c,h,function(a,v,g){for(var w=!g&&p?o.decodeBody(a,p):a,D=0;D<w.length;D++)w[D]=String(w[D]);return w}).get(y,O)},I}();n.default=T},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(4)),f;(function(b){b.Phone="phone",b.Tablet="tablet",b.Desktop="desktop",b.TV="tv",b.Watch="watch",b.Car="car",b.Embedded="embedded",b.Other="other"})(f||(f={}));var d;(function(b){b.Android="android",b.IOS="ios",b.Browser="browser"})(d||(d={}));var m=function(){function b(){}return b.prototype.toJSON=function(){var C,T,l;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(C=this.push)===null||C===void 0?void 0:C.recipient,state:(T=this.push)===null||T===void 0?void 0:T.state,error:(l=this.push)===null||l===void 0?void 0:l.error}}},b.prototype.toString=function(){var C,T,l,S,R="[DeviceDetails";return this.id&&(R+="; id="+this.id),this.platform&&(R+="; platform="+this.platform),this.formFactor&&(R+="; formFactor="+this.formFactor),this.clientId&&(R+="; clientId="+this.clientId),this.metadata&&(R+="; metadata="+this.metadata),this.deviceIdentityToken&&(R+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((C=this.push)===null||C===void 0)&&C.recipient&&(R+="; push.recipient="+JSON.stringify(this.push.recipient)),!((T=this.push)===null||T===void 0)&&T.state&&(R+="; push.state="+this.push.state),!((l=this.push)===null||l===void 0)&&l.error&&(R+="; push.error="+JSON.stringify(this.push.error)),!((S=this.push)===null||S===void 0)&&S.metadata&&(R+="; push.metadata="+this.push.metadata),R+="]",R},b.fromResponseBody=function(C,T){return T&&(C=o.decodeBody(C,T)),o.isArray(C)?b.fromValuesArray(C):b.fromValues(C)},b.fromValues=function(C){return C.error=C.error&&u.default.fromValues(C.error),Object.assign(new b,C)},b.fromValuesArray=function(C){for(var T=C.length,l=new Array(T),S=0;S<T;S++)l[S]=b.fromValues(C[S]);return l},b.toRequestBody=o.encodeBody,b}();n.default=m},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=function(){function f(){}return f.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},f.prototype.toString=function(){var d="[PushChannelSubscription";return this.channel&&(d+="; channel="+this.channel),this.deviceId&&(d+="; deviceId="+this.deviceId),this.clientId&&(d+="; clientId="+this.clientId),d+="]",d},f.fromResponseBody=function(d,m){return m&&(d=o.decodeBody(d,m)),o.isArray(d)?f.fromValuesArray(d):f.fromValues(d)},f.fromValues=function(d){return Object.assign(new f,d)},f.fromValuesArray=function(d){for(var m=d.length,b=new Array(m),C=0;C<m;C++)b[C]=f.fromValues(d[C]);return b},f.toRequestBody=o.encodeBody,f}();n.default=u},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=function(){function x(p){this.count=p&&p.count||0,this.data=p&&p.data||0,this.uncompressedData=p&&p.uncompressedData||0,this.failed=p&&p.failed||0,this.refused=p&&p.refused||0}return x}(),f=function(x){s.__extends(p,x);function p(h){var c=x.call(this,h)||this;return h&&h.category&&(c.category={},o.forInOwnNonNullProperties(h.category,function(a){c.category[a]=new u(h.category[a])})),c}return p}(u),d=function(){function x(p){this.peak=p&&p.peak||0,this.min=p&&p.min||0,this.mean=p&&p.mean||0,this.opened=p&&p.opened||0,this.refused=p&&p.refused||0}return x}(),m=function(){function x(p){this.succeeded=p&&p.succeeded||0,this.failed=p&&p.failed||0,this.refused=p&&p.refused||0}return x}(),b=function(){function x(p){this.plain=new d(p&&p.plain),this.tls=new d(p&&p.tls),this.all=new d(p&&p.all)}return x}(),C=function(){function x(p){this.messages=new f(p&&p.messages),this.presence=new f(p&&p.presence),this.all=new f(p&&p.all)}return x}(),T=function(){function x(p){this.realtime=new C(p&&p.realtime),this.rest=new C(p&&p.rest),this.webhook=new C(p&&p.webhook),this.sharedQueue=new C(p&&p.sharedQueue),this.externalQueue=new C(p&&p.externalQueue),this.httpEvent=new C(p&&p.httpEvent),this.push=new C(p&&p.push),this.all=new C(p&&p.all)}return x}(),l=function(){function x(p){this.all=new C(p&&p.all),this.inbound=new T(p&&p.inbound),this.outbound=new T(p&&p.outbound)}return x}(),S=function(){function x(p){this.all=new C(p&&p.all),this.producerPaid=new l(p&&p.producerPaid),this.consumerPaid=new l(p&&p.consumerPaid)}return x}(),R=function(){function x(p){this.messages=p&&p.messages||0;var h=p&&p.notifications;this.notifications={invalid:h&&h.invalid||0,attempted:h&&h.attempted||0,successful:h&&h.successful||0,failed:h&&h.failed||0},this.directPublishes=p&&p.directPublishes||0}return x}(),I=function(){function x(p){this.succeeded=p&&p.succeeded||0,this.skipped=p&&p.skipped||0,this.failed=p&&p.failed||0}return x}(),y=function(){function x(p){var h=this;this.delta=void 0,p&&p.delta&&(this.delta={},o.forInOwnNonNullProperties(p.delta,function(c){h.delta[c]=new I(p.delta[c])}))}return x}(),O=function(x){s.__extends(p,x);function p(h){var c=x.call(this,h)||this;return c.persisted=new C(h&&h.persisted),c.connections=new b(h&&h.connections),c.channels=new d(h&&h.channels),c.apiRequests=new m(h&&h.apiRequests),c.tokenRequests=new m(h&&h.tokenRequests),c.xchgProducer=new S(h&&h.xchgProducer),c.xchgConsumer=new S(h&&h.xchgConsumer),c.push=new R(h&&h.pushStats),c.processed=new y(h&&h.processed),c.inProgress=h&&h.inProgress||void 0,c.unit=h&&h.unit||void 0,c.intervalId=h&&h.intervalId||void 0,c}return p.fromValues=function(h){return new p(h)},p}(l);n.default=O},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(30)),f=s.__importDefault(i(7)),d=s.__importDefault(i(2)),m=s.__importDefault(i(51)),b=s.__importDefault(i(38)),C=s.__importDefault(i(8)),T=s.__importDefault(i(4)),l=s.__importDefault(i(10)),S=s.__importDefault(i(35)),R=s.__importDefault(i(3)),I=s.__importDefault(i(9)),y=function(x){s.__extends(p,x);function p(h){var c=x.call(this,h)||this;return d.default.logAction(d.default.LOG_MINOR,"Realtime()",""),c.connection=new m.default(c,c.options),c.channels=new O(c),h.autoConnect!==!1&&c.connect(),c}return p.prototype.connect=function(){d.default.logAction(d.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},p.prototype.close=function(){d.default.logAction(d.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},p.Promise=function(h){return h=C.default.objectifyOptions(h),h.promises=!0,new p(h)},p.Callbacks=p,p.Utils=o,p.ConnectionManager=S.default,p.Platform=R.default,p.ProtocolMessage=l.default,p.Message=I.default,p}(u.default),O=function(x){s.__extends(p,x);function p(h){var c=x.call(this)||this;return c.realtime=h,c.all=Object.create(null),h.connection.connectionManager.on("transport.active",function(){c.onTransportActive()}),c}return p.prototype.channelSerials=function(){for(var h={},c=0,a=o.keysArray(this.all,!0);c<a.length;c++){var v=a[c],g=this.all[v];g.properties.channelSerial&&(h[v]=g.properties.channelSerial)}return h},p.prototype.recoverChannels=function(h){for(var c=0,a=o.keysArray(h,!0);c<a.length;c++){var v=a[c],g=this.get(v);g.properties.channelSerial=h[v]}},p.prototype.onChannelMessage=function(h){var c=h.channel;if(c===void 0){d.default.logAction(d.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+h.action);return}var a=this.all[c];if(!a){d.default.logAction(d.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+c);return}a.onMessage(h)},p.prototype.onTransportActive=function(){for(var h in this.all){var c=this.all[h];c.state==="attaching"||c.state==="detaching"?c.checkPendingState():c.state==="suspended"?c._attach(!1,null):c.state==="attached"&&c.requestState("attaching")}},p.prototype.propogateConnectionInterruption=function(h,c){var a={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},v=["attaching","attached","detaching","suspended"],g=a[h];for(var w in this.all){var D=this.all[w];o.arrIn(v,D.state)&&D.notifyState(g,c)}},p.prototype.get=function(h,c){h=String(h);var a=this.all[h];if(!a)a=this.all[h]=new b.default(this.realtime,h,c);else if(c){if(a._shouldReattachToSetOptions(c,a.channelOptions))throw new T.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);a.setOptions(c)}return a},p.prototype.getDerived=function(h,c,a){if(c.filter){var v=o.toBase64(c.filter),g=o.matchDerivedChannel(h);h="[filter=".concat(v).concat(g.qualifierParam,"]").concat(g.channelName)}return this.get(h,a)},p.prototype.release=function(h){h=String(h);var c=this.all[h];if(c){var a=c.getReleaseErr();if(a)throw a;delete this.all[h]}},p}(f.default);n.default=y},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(7)),f=s.__importDefault(i(35)),d=s.__importDefault(i(2)),m=s.__importDefault(i(37)),b=s.__importDefault(i(3));function C(){}var T=function(l){s.__extends(S,l);function S(R,I){var y=l.call(this)||this;return y.whenState=function(O,x){return u.default.prototype.whenState.call(y,O,y.state,x,new m.default(void 0,O))},y.ably=R,y.connectionManager=new f.default(R,I),y.state=y.connectionManager.state.state,y.key=void 0,y.id=void 0,y.errorReason=null,y.connectionManager.on("connectionstate",function(O){var x=y.state=O.current;b.default.Config.nextTick(function(){y.emit(x,O)})}),y.connectionManager.on("update",function(O){b.default.Config.nextTick(function(){y.emit("update",O)})}),y}return S.prototype.connect=function(){d.default.logAction(d.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},S.prototype.ping=function(R){if(d.default.logAction(d.default.LOG_MINOR,"Connection.ping()",""),!R){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);R=C}this.connectionManager.ping(null,R)},S.prototype.close=function(){d.default.logAction(d.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(S.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),S.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},S}(u.default);n.default=T},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.PendingMessage=void 0;var s=i(0),o=s.__importDefault(i(10)),u=s.__importStar(i(1)),f=s.__importDefault(i(7)),d=s.__importDefault(i(2)),m=s.__importDefault(i(36)),b=s.__importDefault(i(4)),C=o.default.Action,T=function(){function S(R,I){this.message=R,this.callback=I,this.merged=!1;var y=R.action;this.sendAttempted=!1,this.ackRequired=y==C.MESSAGE||y==C.PRESENCE}return S}();n.PendingMessage=T;var l=function(S){s.__extends(R,S);function R(I){var y=S.call(this)||this;return y.transport=I,y.messageQueue=new m.default,I.on("ack",function(O,x){y.onAck(O,x)}),I.on("nack",function(O,x,p){y.onNack(O,x,p)}),y}return R.prototype.onAck=function(I,y){d.default.logAction(d.default.LOG_MICRO,"Protocol.onAck()","serial = "+I+"; count = "+y),this.messageQueue.completeMessages(I,y)},R.prototype.onNack=function(I,y,O){d.default.logAction(d.default.LOG_ERROR,"Protocol.onNack()","serial = "+I+"; count = "+y+"; err = "+u.inspectError(O)),O||(O=new b.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(I,y,O)},R.prototype.onceIdle=function(I){var y=this.messageQueue;if(y.count()===0){I();return}y.once("idle",I)},R.prototype.send=function(I){I.ackRequired&&this.messageQueue.push(I),d.default.shouldLog(d.default.LOG_MICRO)&&d.default.logAction(d.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(I.message)),I.sendAttempted=!0,this.transport.send(I.message)},R.prototype.getTransport=function(){return this.transport},R.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},R.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},R.prototype.finish=function(){var I=this.transport;this.onceIdle(function(){I.disconnect()})},R}(f.default);n.default=l},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1)),f=s.__importDefault(i(26)),d=s.__importDefault(i(8)),m=s.__importDefault(i(2)),b=s.__importDefault(i(10)),C=s.__importDefault(i(4)),T="web_socket";function l(I){return!!I.on}var S=function(I){s.__extends(y,I);function y(O,x,p){var h=I.call(this,O,x,p)||this;return h.shortName=T,p.heartbeats=o.default.Config.useProtocolHeartbeats,h.wsHost=d.default.getHost(p.options,p.host,!0),h}return y.isAvailable=function(){return!!o.default.Config.WebSocket},y.prototype.createWebSocket=function(O,x){return this.uri=O+u.toQueryString(x),new o.default.Config.WebSocket(this.uri)},y.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},y.prototype.connect=function(){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),f.default.prototype.connect.call(this);var O=this,x=this.params,p=x.options,h=p.tls?"wss://":"ws://",c=h+this.wsHost+":"+d.default.getPort(p)+"/";m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+c),this.auth.getAuthParams(function(a,v){if(!O.isDisposed){var g="";for(var w in v)g+=" "+w+": "+v[w]+";";if(m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+g+" err: "+a),a){O.disconnect(a);return}var D=x.getConnectParams(v);try{var k=O.wsConnection=O.createWebSocket(c,D);k.binaryType=o.default.Config.binaryType,k.onopen=function(){O.onWsOpen()},k.onclose=function(M){O.onWsClose(M)},k.onmessage=function(M){O.onWsData(M.data)},k.onerror=function(M){O.onWsError(M)},l(k)&&k.on("ping",function(){O.onActivity()})}catch(M){m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(M.stack||M.message)),O.disconnect(M)}}})},y.prototype.send=function(O){var x=this.wsConnection;if(!x){m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{x.send(b.default.serialize(O,this.params.format))}catch(h){var p="Exception from ws connection when trying to send: "+u.inspectError(h);m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.send()",p),this.finish("disconnected",new C.default(p,5e4,500))}},y.prototype.onWsData=function(O){m.default.logAction(m.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+O.length+"; type = "+typeof O);try{this.onProtocolMessage(b.default.deserialize(O,this.format))}catch(x){m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+x.stack)}},y.prototype.onWsOpen=function(){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},y.prototype.onWsClose=function(O){var x,p;if(typeof O=="object"?(p=O.code,x=O.wasClean||p===1e3):(p=O,x=p==1e3),delete this.wsConnection,x){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var h=new C.default("Websocket closed",80003,400);this.finish("disconnected",h)}else{var c="Unclean disconnection of WebSocket ; code = "+p,h=new C.default(c,80003,400);m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onWsClose()",c),this.finish("disconnected",h)}this.emit("disposed")},y.prototype.onWsError=function(O){var x=this;m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+O.message),o.default.Config.nextTick(function(){x.disconnect(Error(O.message))})},y.prototype.dispose=function(){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var O=this.wsConnection;O&&(O.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(m.default.logAction(m.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!O)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");O.close()}))},y}(f.default);function R(I){return S.isAvailable()&&(I.supportedTransports[T]=S),S}n.default=R},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(34)),f=s.__importDefault(i(7)),d=s.__importDefault(i(2)),m=s.__importDefault(i(16)),b=s.__importStar(i(4)),C=s.__importDefault(i(38)),T=s.__importDefault(i(24)),l=s.__importDefault(i(39)),S=function(){};function R(h){return h.channel.realtime.auth.clientId}function I(h){var c=h.channel.realtime,a=c.auth.clientId;return(!a||a==="*")&&c.connection.state==="connected"}function y(h,c,a){switch(h.state){case"attached":case"suspended":a();break;case"initialized":case"detached":case"detaching":case"attaching":h.attach(function(v){v?c(v):a()});break;default:c(b.default.fromValues(h.invalidStateError()))}}function O(h,c){if(h.isSynthesized()||c.isSynthesized())return h.timestamp>=c.timestamp;var a=h.parseId(),v=c.parseId();return a.msgSerial===v.msgSerial?a.index>v.index:a.msgSerial>v.msgSerial}var x=function(h){s.__extends(c,h);function c(a){var v=h.call(this,a)||this;return v.channel=a,v.syncComplete=!1,v.members=new p(v,function(g){return g.clientId+":"+g.connectionId}),v._myMembers=new p(v,function(g){return g.clientId}),v.subscriptions=new f.default,v.pendingPresence=[],v}return c.prototype.enter=function(a,v){if(I(this))throw new b.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"enter",v)},c.prototype.update=function(a,v){if(I(this))throw new b.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"update",v)},c.prototype.enterClient=function(a,v,g){return this._enterOrUpdateClient(void 0,a,v,"enter",g)},c.prototype.updateClient=function(a,v,g){return this._enterOrUpdateClient(void 0,a,v,"update",g)},c.prototype._enterOrUpdateClient=function(a,v,g,w,D){var k=this;if(!D)if(typeof g=="function")D=g,g=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[a,v,g,w]);D=S}var M=this.channel;if(!M.connectionManager.activeState()){D(M.connectionManager.getError());return}d.default.logAction(d.default.LOG_MICRO,"RealtimePresence."+w+"Client()","channel = "+M.name+", id = "+a+", client = "+(v||"(implicit) "+R(this)));var _=m.default.fromData(g);_.action=w,a&&(_.id=a),v&&(_.clientId=v),m.default.encode(_,M.channelOptions,function(A){if(A){D(A);return}switch(M.state){case"attached":M.sendPresence(_,D);break;case"initialized":case"detached":M.attach();case"attaching":k.pendingPresence.push({presence:_,callback:D});break;default:A=new b.PartialErrorInfo("Unable to "+w+" presence channel while in "+M.state+" state",90001),A.code=90001,D(A)}})},c.prototype.leave=function(a,v){if(I(this))throw new b.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,a,v)},c.prototype.leaveClient=function(a,v,g){if(!g)if(typeof v=="function")g=v,v=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[a,v]);g=S}var w=this.channel;if(!w.connectionManager.activeState()){g==null||g(w.connectionManager.getError());return}d.default.logAction(d.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+a);var D=m.default.fromData(v);switch(D.action="leave",a&&(D.clientId=a),w.state){case"attached":w.sendPresence(D,g);break;case"attaching":this.pendingPresence.push({presence:D,callback:g});break;case"initialized":case"failed":{var k=new b.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);g==null||g(k);break}default:g==null||g(w.invalidStateError())}},c.prototype.get=function(a,v){var g=this,w=Array.prototype.slice.call(arguments);w.length==1&&typeof w[0]=="function"&&w.unshift(null),a=w[0],v=w[1];var D=!a||("waitForSync"in a?a.waitForSync:!0);if(!v){if(this.channel.realtime.options.promises)return o.promisify(this,"get",w);v=S}function k(M){v(null,a?M.list(a):M.values())}if(this.channel.state==="suspended"){D?v(b.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):k(this.members);return}y(this.channel,v,function(){var M=g.members;D?M.waitSync(function(){k(M)}):k(M)})},c.prototype.history=function(a,v){if(d.default.logAction(d.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);v=S}a&&a.untilAttach&&(this.channel.state==="attached"?(delete a.untilAttach,a.from_serial=this.channel.properties.attachSerial):v(new b.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),u.default.prototype._history.call(this,a,v)},c.prototype.setPresence=function(a,v,g){d.default.logAction(d.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+a.length+" participants; syncChannelSerial = "+g);var w,D,k=this.members,M=this._myMembers,_=[],A=this.channel.connectionManager.connectionId;v&&(this.members.startSync(),g&&(D=g.match(/^[\w-]+:(.*)$/))&&(w=D[1]));for(var E=0;E<a.length;E++){var L=m.default.fromValues(a[E]);switch(L.action){case"leave":k.remove(L)&&_.push(L),L.connectionId===A&&!L.isSynthesized()&&M.remove(L);break;case"enter":case"present":case"update":k.put(L)&&_.push(L),L.connectionId===A&&M.put(L);break}}v&&!w&&(k.endSync(),this.channel.syncChannelSerial=null);for(var E=0;E<_.length;E++){var L=_[E];this.subscriptions.emit(L.action,L)}},c.prototype.onAttached=function(a){d.default.logAction(d.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+a),a?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var v=this.pendingPresence,g=v.length;if(g){this.pendingPresence=[];var w=[],D=T.default.create();d.default.logAction(d.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+g+" queued presence messages");for(var k=0;k<g;k++){var M=v[k];w.push(M.presence),D.push(M.callback)}this.channel.sendPresence(w,D)}},c.prototype.actOnChannelState=function(a,v,g){switch(a){case"attached":this.onAttached(v);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(g);break}},c.prototype.failPendingPresence=function(a){if(this.pendingPresence.length){d.default.logAction(d.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(a));for(var v=0;v<this.pendingPresence.length;v++)try{this.pendingPresence[v].callback(a)}catch{}this.pendingPresence=[]}},c.prototype._clearMyMembers=function(){this._myMembers.clear()},c.prototype._ensureMyMembersPresent=function(){var a=this,v=this._myMembers,g=function(k){if(k){var M="Presence auto-re-enter failed: "+k.toString(),_=new b.default(M,91004,400);d.default.logAction(d.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",M);var A=new l.default(a.channel.state,a.channel.state,!0,!1,_);a.channel.emit("update",A)}};for(var w in v.map){var D=v.map[w];d.default.logAction(d.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+D.clientId+'" into the presence set'),this._enterOrUpdateClient(D.id,D.clientId,D.data,"enter",g)}},c.prototype._synthesizeLeaves=function(a){var v=this.subscriptions;o.arrForEach(a,function(g){var w=m.default.fromValues({action:"leave",connectionId:g.connectionId,clientId:g.clientId,data:g.data,encoding:g.encoding,timestamp:o.now()});v.emit("leave",w)})},c.prototype.on=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];d.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,a)},c.prototype.off=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];d.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,a)},c.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var g=C.default.processListenerArgs(a),w=g[0],D=g[1],k=g[2],M=this.channel;if(!k){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[w,D]);k=S}if(M.state==="failed"){k(b.default.fromValues(M.invalidStateError()));return}this.subscriptions.on(w,D),M.attach(k)},c.prototype.unsubscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var g=C.default.processListenerArgs(a),w=g[0],D=g[1];this.subscriptions.off(w,D)},c}(u.default),p=function(h){s.__extends(c,h);function c(a,v){var g=h.call(this)||this;return g.presence=a,g.map=Object.create(null),g.syncInProgress=!1,g.residualMembers=null,g.memberKey=v,g}return c.prototype.get=function(a){return this.map[a]},c.prototype.getClient=function(a){var v=this.map,g=[];for(var w in v){var D=v[w];D.clientId==a&&D.action!="absent"&&g.push(D)}return g},c.prototype.list=function(a){var v=this.map,g=a&&a.clientId,w=a&&a.connectionId,D=[];for(var k in v){var M=v[k];M.action!=="absent"&&(g&&g!=M.clientId||w&&w!=M.connectionId||D.push(M))}return D},c.prototype.put=function(a){(a.action==="enter"||a.action==="update")&&(a=m.default.fromValues(a),a.action="present");var v=this.map,g=this.memberKey(a);this.residualMembers&&delete this.residualMembers[g];var w=v[g];return w&&!O(a,w)?!1:(v[g]=a,!0)},c.prototype.values=function(){var a=this.map,v=[];for(var g in a){var w=a[g];w.action!="absent"&&v.push(w)}return v},c.prototype.remove=function(a){var v=this.map,g=this.memberKey(a),w=v[g];return w&&!O(a,w)?!1:(this.syncInProgress?(a=m.default.fromValues(a),a.action="absent",v[g]=a):delete v[g],!0)},c.prototype.startSync=function(){var a=this.map,v=this.syncInProgress;d.default.logAction(d.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),this.syncInProgress||(this.residualMembers=o.copy(a),this.setInProgress(!0))},c.prototype.endSync=function(){var a=this.map,v=this.syncInProgress;if(d.default.logAction(d.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),v){for(var g in a){var w=a[g];w.action==="absent"&&delete a[g]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var g in this.residualMembers)delete a[g];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},c.prototype.waitSync=function(a){var v=this.syncInProgress;if(d.default.logAction(d.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),!v){a();return}this.once("sync",a)},c.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},c.prototype.setInProgress=function(a){d.default.logAction(d.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+a),this.syncInProgress=a,this.presence.syncComplete=!a},c}(f.default);n.default=x},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=i(56),u=i(31),f=i(11),d=s.__importDefault(i(5)),m=s.__importDefault(i(3)),b=function(){function C(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return C.prototype.isWordArray=function(T){return T!=null&&T.sigBytes!==void 0},C.prototype.isArrayBuffer=function(T){return T!=null&&T.constructor===ArrayBuffer},C.prototype.isTypedArray=function(T){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(T)},C.prototype.uint8ViewToBase64=function(T){for(var l="",S=this.base64CharSet,R=T.byteLength,I=R%3,y=R-I,O,x,p,h,c,a=0;a<y;a=a+3)c=T[a]<<16|T[a+1]<<8|T[a+2],O=(c&16515072)>>18,x=(c&258048)>>12,p=(c&4032)>>6,h=c&63,l+=S[O]+S[x]+S[p]+S[h];return I==1?(c=T[y],O=(c&252)>>2,x=(c&3)<<4,l+=S[O]+S[x]+"=="):I==2&&(c=T[y]<<8|T[y+1],O=(c&64512)>>10,x=(c&1008)>>4,p=(c&15)<<2,l+=S[O]+S[x]+S[p]+"="),l},C.prototype.base64ToArrayBuffer=function(T){for(var l=atob==null?void 0:atob(T),S=l.length,R=new Uint8Array(S),I=0;I<S;I++){var y=l.charCodeAt(I);R[I]=y}return R.buffer},C.prototype.isBuffer=function(T){return this.isArrayBuffer(T)||this.isWordArray(T)||this.isTypedArray(T)},C.prototype.toBuffer=function(T){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(T))return new Uint8Array(T);if(this.isTypedArray(T))return new Uint8Array(T.buffer);if(this.isWordArray(T)){for(var l=new ArrayBuffer(T.sigBytes),S=new Uint8Array(l),R=0;R<T.sigBytes;R++)S[R]=T.words[R>>>2]>>>24-R%4*8&255;return S}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},C.prototype.toArrayBuffer=function(T){return this.isArrayBuffer(T)?T:this.toBuffer(T).buffer},C.prototype.toWordArray=function(T){return this.isTypedArray(T)&&(T=T.buffer),this.isWordArray(T)?T:d.default.create(T)},C.prototype.base64Encode=function(T){return this.isWordArray(T)?(0,f.stringify)(T):this.uint8ViewToBase64(this.toBuffer(T))},C.prototype.base64Decode=function(T){return ArrayBuffer&&m.default.Config.atob?this.base64ToArrayBuffer(T):(0,f.parse)(T)},C.prototype.hexEncode=function(T){return(0,o.stringify)(this.toWordArray(T))},C.prototype.hexDecode=function(T){var l=(0,o.parse)(T);return ArrayBuffer?this.toArrayBuffer(l):l},C.prototype.utf8Encode=function(T){return m.default.Config.TextEncoder?new m.default.Config.TextEncoder().encode(T).buffer:(0,u.parse)(T)},C.prototype.utf8Decode=function(T){if(!this.isBuffer(T))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(T)?new TextDecoder().decode(T):(T=this.toWordArray(T),(0,u.stringify)(T))},C.prototype.bufferCompare=function(T,l){if(!T)return-1;if(!l)return 1;var S=this.toWordArray(T),R=this.toWordArray(l);S.clamp(),R.clamp();var I=S.sigBytes-R.sigBytes;if(I!=0)return I;for(var y=S.words,O=R.words,x=0;x<y.length;x++)if(I=y[x]-O[x],I!=0)return I;return 0},C.prototype.byteLength=function(T){return this.isArrayBuffer(T)||this.isTypedArray(T)?T.byteLength:this.isWordArray(T)?T.sigBytes:-1},C.prototype.typedArrayToBuffer=function(T){return T.buffer},C}();n.default=new b},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return s.enc.Hex})},function(t,n,i){i.r(n);var s=i(5),o=i.n(s),u=i(11),f=i(23),d=i.n(f),m=i(2),b=i.n(m),C=i(4),T=i.n(C),l=function(S,R){var I="aes",y=256,O="cbc",x=16,p=4,h=4294967296,c=2147483648,a;if(S.getRandomWordArray)a=S.getRandomWordArray;else if(typeof Uint32Array<"u"&&S.getRandomValues){var v=new Uint32Array(p);a=function(E,L){var F=E/4,U=F==p?v:new Uint32Array(F);S.getRandomValues(U,function(G){typeof L<"u"&&L(G,R.toWordArray(U))})}}else a=function(E,L){b.a.logAction(b.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var F=E/4,U=new Array(F),G=0;G<F;G++)U[G]=Math.floor(Math.random()*h)-c;L(null,o.a.create(U))};function g(E){return E+x&-x}function w(E){if(E.algorithm==="aes"&&E.mode==="cbc"){if(E.keyLength===128||E.keyLength===256)return;throw new Error("Unsupported key length "+E.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function D(E){return E.replace("_","/").replace("-","+")}var k=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function M(){}function _(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}M.CipherParams=_,M.getDefaultParams=function(E){var L;if(typeof E=="function"||typeof E=="string"){if(b.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof E=="function")b.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),M.generateRandomKey(function(U){E(null,M.getDefaultParams({key:U}))});else if(typeof arguments[1]=="function")b.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,M.getDefaultParams({key:E}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!E.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof E.key=="string"?L=Object(u.parse)(D(E.key)):L=R.toWordArray(E.key);var F=new _;if(F.key=L,F.algorithm=E.algorithm||I,F.keyLength=L.words.length*(4*8),F.mode=E.mode||O,E.keyLength&&E.keyLength!==F.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+E.keyLength+" was specified, but the key actually has length "+F.keyLength);return w(F),F},M.generateRandomKey=function(E,L){arguments.length==1&&typeof E=="function"&&(L=E,E=void 0),a((E||y)/8,function(F,U){L!==void 0&&L(F?T.a.fromValues(F):null,U)})},M.getCipher=function(E){var L=E instanceof _?E:M.getDefaultParams(E);return{cipherParams:L,cipher:new A(L,p,E.iv)}};function A(E,L,F){this.algorithm=E.algorithm+"-"+String(E.keyLength)+"-"+E.mode,this.cjsAlgorithm=E.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=R.toWordArray(E.key),F&&(this.iv=R.toWordArray(F).clone()),this.blockLengthWords=L}return A.prototype.encrypt=function(E,L){b.a.logAction(b.a.LOG_MICRO,"CBCCipher.encrypt()",""),E=R.toWordArray(E);var F=E.sigBytes,U=g(F),G=this,V=function(){G.getIv(function(H,P){if(H){L(H);return}var N=G.encryptCipher.process(E.concat(k[U-F])),j=P.concat(N);L(null,j)})};this.encryptCipher?V():this.iv?(this.encryptCipher=d.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),V()):a(x,function(H,P){if(H){L(H);return}G.encryptCipher=d.a.algo[G.cjsAlgorithm].createEncryptor(G.key,{iv:P}),G.iv=P,V()})},A.prototype.decrypt=function(E){b.a.logAction(b.a.LOG_MICRO,"CBCCipher.decrypt()",""),E=R.toWordArray(E);var L=this.blockLengthWords,F=E.words,U=o.a.create(F.slice(0,L)),G=o.a.create(F.slice(L)),V=d.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:U}),H=V.process(G),P=V.finalize();return V.reset(),P&&P.sigBytes&&H.concat(P),H},A.prototype.getIv=function(E){if(this.iv){var L=this.iv;this.iv=null,E(null,L);return}var F=this;a(x,function(U,G){if(U){E(U);return}E(null,F.encryptCipher.process(G))})},M};n.default=l},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return function(){var o=s,u=o.lib,f=u.WordArray,d=o.enc;d.Utf16=d.Utf16BE={stringify:function(b){for(var C=b.words,T=b.sigBytes,l=[],S=0;S<T;S+=2){var R=C[S>>>2]>>>16-S%4*8&65535;l.push(String.fromCharCode(R))}return l.join("")},parse:function(b){for(var C=b.length,T=[],l=0;l<C;l++)T[l>>>1]|=b.charCodeAt(l)<<16-l%2*16;return f.create(T,C*2)}},d.Utf16LE={stringify:function(b){for(var C=b.words,T=b.sigBytes,l=[],S=0;S<T;S+=2){var R=m(C[S>>>2]>>>16-S%4*8&65535);l.push(String.fromCharCode(R))}return l.join("")},parse:function(b){for(var C=b.length,T=[],l=0;l<C;l++)T[l>>>1]|=m(b.charCodeAt(l)<<16-l%2*16);return f.create(T,C*2)}};function m(b){return b<<8&4278255360|b>>>8&16711935}}(),s.enc.Utf16})},function(t,n,i){(function(s,o){t.exports=o(i(6),i(28))})(this,function(s){return function(o){var u=s,f=u.lib,d=f.CipherParams,m=u.enc,b=m.Hex,C=u.format;C.Hex={stringify:function(T){return T.ciphertext.toString(b)},parse:function(T){var l=b.parse(T);return d.create({ciphertext:l})}}}(),s.format.Hex})},function(t,n,i){(function(s,o){t.exports=o(i(6),i(11),i(61),i(27),i(28))})(this,function(s){return function(){var o=s,u=o.lib,f=u.BlockCipher,d=o.algo,m=[],b=[],C=[],T=[],l=[],S=[],R=[],I=[],y=[],O=[];(function(){for(var h=[],c=0;c<256;c++)c<128?h[c]=c<<1:h[c]=c<<1^283;for(var a=0,v=0,c=0;c<256;c++){var g=v^v<<1^v<<2^v<<3^v<<4;g=g>>>8^g&255^99,m[a]=g,b[g]=a;var w=h[a],D=h[w],k=h[D],M=h[g]*257^g*16843008;C[a]=M<<24|M>>>8,T[a]=M<<16|M>>>16,l[a]=M<<8|M>>>24,S[a]=M;var M=k*16843009^D*65537^w*257^a*16843008;R[g]=M<<24|M>>>8,I[g]=M<<16|M>>>16,y[g]=M<<8|M>>>24,O[g]=M,a?(a=w^h[h[h[k^w]]],v^=h[h[v]]):a=v=1}})();var x=[0,1,2,4,8,16,32,64,128,27,54],p=d.AES=f.extend({_doReset:function(){var h;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var c=this._keyPriorReset=this._key,a=c.words,v=c.sigBytes/4,g=this._nRounds=v+6,w=(g+1)*4,D=this._keySchedule=[],k=0;k<w;k++)k<v?D[k]=a[k]:(h=D[k-1],k%v?v>6&&k%v==4&&(h=m[h>>>24]<<24|m[h>>>16&255]<<16|m[h>>>8&255]<<8|m[h&255]):(h=h<<8|h>>>24,h=m[h>>>24]<<24|m[h>>>16&255]<<16|m[h>>>8&255]<<8|m[h&255],h^=x[k/v|0]<<24),D[k]=D[k-v]^h);for(var M=this._invKeySchedule=[],_=0;_<w;_++){var k=w-_;if(_%4)var h=D[k];else var h=D[k-4];_<4||k<=4?M[_]=h:M[_]=R[m[h>>>24]]^I[m[h>>>16&255]]^y[m[h>>>8&255]]^O[m[h&255]]}}},encryptBlock:function(h,c){this._doCryptBlock(h,c,this._keySchedule,C,T,l,S,m)},decryptBlock:function(h,c){var a=h[c+1];h[c+1]=h[c+3],h[c+3]=a,this._doCryptBlock(h,c,this._invKeySchedule,R,I,y,O,b);var a=h[c+1];h[c+1]=h[c+3],h[c+3]=a},_doCryptBlock:function(h,c,a,v,g,w,D,k){for(var M=this._nRounds,_=h[c]^a[0],A=h[c+1]^a[1],E=h[c+2]^a[2],L=h[c+3]^a[3],F=4,U=1;U<M;U++){var G=v[_>>>24]^g[A>>>16&255]^w[E>>>8&255]^D[L&255]^a[F++],V=v[A>>>24]^g[E>>>16&255]^w[L>>>8&255]^D[_&255]^a[F++],H=v[E>>>24]^g[L>>>16&255]^w[_>>>8&255]^D[A&255]^a[F++],P=v[L>>>24]^g[_>>>16&255]^w[A>>>8&255]^D[E&255]^a[F++];_=G,A=V,E=H,L=P}var G=(k[_>>>24]<<24|k[A>>>16&255]<<16|k[E>>>8&255]<<8|k[L&255])^a[F++],V=(k[A>>>24]<<24|k[E>>>16&255]<<16|k[L>>>8&255]<<8|k[_&255])^a[F++],H=(k[E>>>24]<<24|k[L>>>16&255]<<16|k[_>>>8&255]<<8|k[A&255])^a[F++],P=(k[L>>>24]<<24|k[_>>>16&255]<<16|k[A>>>8&255]<<8|k[E&255])^a[F++];h[c]=G,h[c+1]=V,h[c+2]=H,h[c+3]=P},keySize:256/32});o.AES=f._createHelper(p)}(),s.AES})},function(t,n,i){(function(s,o){t.exports=o(i(6))})(this,function(s){return function(o){var u=s,f=u.lib,d=f.WordArray,m=f.Hasher,b=u.algo,C=[];(function(){for(var y=0;y<64;y++)C[y]=o.abs(o.sin(y+1))*4294967296|0})();var T=b.MD5=m.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,O){for(var x=0;x<16;x++){var p=O+x,h=y[p];y[p]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360}var c=this._hash.words,a=y[O+0],v=y[O+1],g=y[O+2],w=y[O+3],D=y[O+4],k=y[O+5],M=y[O+6],_=y[O+7],A=y[O+8],E=y[O+9],L=y[O+10],F=y[O+11],U=y[O+12],G=y[O+13],V=y[O+14],H=y[O+15],P=c[0],N=c[1],j=c[2],B=c[3];P=l(P,N,j,B,a,7,C[0]),B=l(B,P,N,j,v,12,C[1]),j=l(j,B,P,N,g,17,C[2]),N=l(N,j,B,P,w,22,C[3]),P=l(P,N,j,B,D,7,C[4]),B=l(B,P,N,j,k,12,C[5]),j=l(j,B,P,N,M,17,C[6]),N=l(N,j,B,P,_,22,C[7]),P=l(P,N,j,B,A,7,C[8]),B=l(B,P,N,j,E,12,C[9]),j=l(j,B,P,N,L,17,C[10]),N=l(N,j,B,P,F,22,C[11]),P=l(P,N,j,B,U,7,C[12]),B=l(B,P,N,j,G,12,C[13]),j=l(j,B,P,N,V,17,C[14]),N=l(N,j,B,P,H,22,C[15]),P=S(P,N,j,B,v,5,C[16]),B=S(B,P,N,j,M,9,C[17]),j=S(j,B,P,N,F,14,C[18]),N=S(N,j,B,P,a,20,C[19]),P=S(P,N,j,B,k,5,C[20]),B=S(B,P,N,j,L,9,C[21]),j=S(j,B,P,N,H,14,C[22]),N=S(N,j,B,P,D,20,C[23]),P=S(P,N,j,B,E,5,C[24]),B=S(B,P,N,j,V,9,C[25]),j=S(j,B,P,N,w,14,C[26]),N=S(N,j,B,P,A,20,C[27]),P=S(P,N,j,B,G,5,C[28]),B=S(B,P,N,j,g,9,C[29]),j=S(j,B,P,N,_,14,C[30]),N=S(N,j,B,P,U,20,C[31]),P=R(P,N,j,B,k,4,C[32]),B=R(B,P,N,j,A,11,C[33]),j=R(j,B,P,N,F,16,C[34]),N=R(N,j,B,P,V,23,C[35]),P=R(P,N,j,B,v,4,C[36]),B=R(B,P,N,j,D,11,C[37]),j=R(j,B,P,N,_,16,C[38]),N=R(N,j,B,P,L,23,C[39]),P=R(P,N,j,B,G,4,C[40]),B=R(B,P,N,j,a,11,C[41]),j=R(j,B,P,N,w,16,C[42]),N=R(N,j,B,P,M,23,C[43]),P=R(P,N,j,B,E,4,C[44]),B=R(B,P,N,j,U,11,C[45]),j=R(j,B,P,N,H,16,C[46]),N=R(N,j,B,P,g,23,C[47]),P=I(P,N,j,B,a,6,C[48]),B=I(B,P,N,j,_,10,C[49]),j=I(j,B,P,N,V,15,C[50]),N=I(N,j,B,P,k,21,C[51]),P=I(P,N,j,B,U,6,C[52]),B=I(B,P,N,j,w,10,C[53]),j=I(j,B,P,N,L,15,C[54]),N=I(N,j,B,P,v,21,C[55]),P=I(P,N,j,B,A,6,C[56]),B=I(B,P,N,j,H,10,C[57]),j=I(j,B,P,N,M,15,C[58]),N=I(N,j,B,P,G,21,C[59]),P=I(P,N,j,B,D,6,C[60]),B=I(B,P,N,j,F,10,C[61]),j=I(j,B,P,N,g,15,C[62]),N=I(N,j,B,P,E,21,C[63]),c[0]=c[0]+P|0,c[1]=c[1]+N|0,c[2]=c[2]+j|0,c[3]=c[3]+B|0},_doFinalize:function(){var y=this._data,O=y.words,x=this._nDataBytes*8,p=y.sigBytes*8;O[p>>>5]|=128<<24-p%32;var h=o.floor(x/4294967296),c=x;O[(p+64>>>9<<4)+15]=(h<<8|h>>>24)&16711935|(h<<24|h>>>8)&4278255360,O[(p+64>>>9<<4)+14]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,y.sigBytes=(O.length+1)*4,this._process();for(var a=this._hash,v=a.words,g=0;g<4;g++){var w=v[g];v[g]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}return a},clone:function(){var y=m.clone.call(this);return y._hash=this._hash.clone(),y}});function l(y,O,x,p,h,c,a){var v=y+(O&x|~O&p)+h+a;return(v<<c|v>>>32-c)+O}function S(y,O,x,p,h,c,a){var v=y+(O&p|x&~p)+h+a;return(v<<c|v>>>32-c)+O}function R(y,O,x,p,h,c,a){var v=y+(O^x^p)+h+a;return(v<<c|v>>>32-c)+O}function I(y,O,x,p,h,c,a){var v=y+(x^(O|~p))+h+a;return(v<<c|v>>>32-c)+O}u.MD5=m._createHelper(T),u.HmacMD5=m._createHmacHelper(T)}(Math),s.MD5})},function(t,n,i){var s;Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),u=o.__importDefault(i(3)),f=o.__importStar(i(1)),d=o.__importDefault(i(8)),m=i(4),b=o.__importDefault(i(19)),C=o.__importDefault(i(17)),T=o.__importDefault(i(22)),l=o.__importDefault(i(2)),S=i(29),R=o.__importDefault(i(63)),I=i(14);function y(p){var h=p.statusCode;return h===408&&!p.code||h===400&&!p.code||h>=500&&h<=504}function O(p){var h=p.connection,c=h&&h.connectionManager.host;return c?[c].concat(d.default.getFallbackHosts(p.options)):d.default.getHosts(p.options)}var x=(s=function(){function p(h){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=O,this.options=h||{};var c=this.options.connectivityCheckUrl||d.default.connectivityCheckUrl,a=this.options.connectivityCheckParams,v=!this.options.connectivityCheckUrl;u.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(g,w,D,k,M,_,A){var E=C.default.createRequest(D,k,M,_,T.default.REQ_SEND,w&&w.options.timeouts,g);return E.once("complete",A),E.exec(),E},this.options.disableConnectivityCheck?this.checkConnectivity=function(g){g(null,!0)}:this.checkConnectivity=function(g){l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+c),this.doUri(b.default.Get,null,c,null,null,a,function(w,D,k,M,_){var A=!1;v?A=!w&&(D==null?void 0:D.replace(/\n/,""))=="yes":A=!w&&(0,I.isSuccessCode)(_),l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+A),g(null,A)})}):u.default.Config.jsonpSupported?(this.Request=function(g,w,D,k,M,_,A){var E=(0,S.createRequest)(D,k,M,_,T.default.REQ_SEND,w&&w.options.timeouts,g);return E.once("complete",A),u.default.Config.nextTick(function(){E.exec()}),E},this.options.disableConnectivityCheck?this.checkConnectivity=function(g){g(null,!0)}:this.checkConnectivity=function(g){var w=this,D=d.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(g);return}this.checksInProgress=[g],l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+D);var k=new S.Request("isTheInternetUp",D,null,null,null,T.default.REQ_SEND,d.default.TIMEOUTS);k.once("complete",function(M,_){var A=!M&&_;l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+A);for(var E=0;E<w.checksInProgress.length;E++)w.checksInProgress[E](null,A);w.checksInProgress=null}),u.default.Config.nextTick(function(){k.exec()})}):u.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=R.default,this.checkConnectivity=function(g){l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+c),this.doUri(b.default.Get,null,c,null,null,null,function(w,D){var k=!w&&(D==null?void 0:D.replace(/\n/,""))=="yes";l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+k),g(null,k)})}):this.Request=function(g,w,D,k,M,_,A){A(new m.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return p.prototype.do=function(h,c,a,v,g,w,D){var k=this,M=typeof a=="function"?a:function(L){return c.baseUri(L)+a},_=c._currentFallback;if(_)if(_.validUntil>f.now()){if(!this.Request){D==null||D(new m.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(h,c,M(_.host),v,w,g,function(L){for(var F=[],U=1;U<arguments.length;U++)F[U-1]=arguments[U];if(L&&y(L)){c._currentFallback=null,k.do(h,c,a,v,g,w,D);return}D==null||D.apply(void 0,o.__spreadArray([L],F,!1))});return}else c._currentFallback=null;var A=O(c);if(A.length===1){this.doUri(h,c,M(A[0]),v,g,w,D);return}var E=function(L,F){var U=L.shift();k.doUri(h,c,M(U),v,g,w,function(G){for(var V=[],H=1;H<arguments.length;H++)V[H-1]=arguments[H];if(G&&y(G)&&L.length){E(L,!0);return}F&&(c._currentFallback={host:U,validUntil:f.now()+c.options.timeouts.fallbackRetryTimeout}),D==null||D.apply(void 0,o.__spreadArray([G],V,!1))})};E(A)},p.prototype.doUri=function(h,c,a,v,g,w,D){if(!this.Request){D(new m.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(h,c,a,v,w,g,D)},p}(),s.methods=[b.default.Get,b.default.Delete,b.default.Post,b.default.Put,b.default.Patch],s.methodsWithoutBody=[b.default.Get,b.default.Delete],s.methodsWithBody=[b.default.Post,b.default.Put,b.default.Patch],s);n.default=x},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(4)),u=s.__importDefault(i(3)),f=s.__importDefault(i(8)),d=s.__importStar(i(1)),m=i(1);function b(l,S){return!!S.get("x-ably-errorcode")}function C(l,S){if(b(l,S))return l.error&&o.default.fromValues(l.error)}function T(l,S,R,I,y,O,x){var p=new Headers(I||{}),h=l?l.toUpperCase():d.isEmptyArg(O)?"GET":"POST",c=new AbortController,a=setTimeout(function(){c.abort(),x(new o.PartialErrorInfo("Request timed out",null,408))},S?S.options.timeouts.httpRequestTimeout:f.default.TIMEOUTS.httpRequestTimeout),v={method:h,headers:p,body:O};u.default.Config.isWebworker||(v.credentials=p.has("authorization")?"include":"same-origin"),(0,m.getGlobalObject)().fetch(R+"?"+new URLSearchParams(y||{}),v).then(function(g){clearTimeout(a);var w=g.headers.get("Content-Type"),D;w&&w.indexOf("application/x-msgpack")>-1?D=g.arrayBuffer():w&&w.indexOf("application/json")>-1?D=g.json():D=g.text(),D.then(function(k){var M=!!w&&w.indexOf("application/x-msgpack")===-1;if(g.ok)x(null,k,g.headers,M,g.status);else{var _=C(k,g.headers)||new o.PartialErrorInfo("Error response received from server: "+g.status+" body was: "+u.default.Config.inspect(k),null,g.status);x(_,k,g.headers,M,g.status)}})}).catch(function(g){clearTimeout(a),x(g)})}n.default=T},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(41)),u=s.__importStar(i(1)),f=u.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function d(){var T=f.location;return!f.WebSocket||!T||!T.origin||T.origin.indexOf("http")>-1}var m=f.navigator&&f.navigator.userAgent.toString(),b=f.location&&f.location.href,C={agent:"browser",logTimestamps:!0,userAgent:m,currentUrl:b,noUpgrade:m&&!!m.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:f.WebSocket,fetchSupported:!!f.fetch,xhrSupported:f.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:d(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!f.TextDecoder,preferBinary:!1,ArrayBuffer:f.ArrayBuffer,atob:f.atob,nextTick:typeof f.setImmediate<"u"?f.setImmediate.bind(f):function(T){setTimeout(T,0)},addEventListener:f.addEventListener,inspect:JSON.stringify,stringByteSize:function(T){return f.TextDecoder&&new f.TextEncoder().encode(T).length||T.length},TextEncoder:f.TextEncoder,TextDecoder:f.TextDecoder,Promise:f.Promise,getRandomValues:function(T){if(T!==void 0)return function(l,S){T.getRandomValues(l),S&&S(null)}}(f.crypto||msCrypto)};n.default=C},function(t,n,i){(function(s){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),u=o.__importStar(i(1)),f="ablyjs-storage-test",d=function(){function m(){try{s.sessionStorage.setItem(f,f),s.sessionStorage.removeItem(f),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{s.localStorage.setItem(f,f),s.localStorage.removeItem(f),this.localSupported=!0}catch{this.localSupported=!1}}return m.prototype.get=function(b){return this._get(b,!1)},m.prototype.getSession=function(b){return this._get(b,!0)},m.prototype.remove=function(b){return this._remove(b,!1)},m.prototype.removeSession=function(b){return this._remove(b,!0)},m.prototype.set=function(b,C,T){return this._set(b,C,T,!1)},m.prototype.setSession=function(b,C,T){return this._set(b,C,T,!0)},m.prototype._set=function(b,C,T,l){var S={value:C};return T&&(S.expires=u.now()+T),this.storageInterface(l).setItem(b,JSON.stringify(S))},m.prototype._get=function(b,C){if(C&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!C&&!this.localSupported)throw new Error("Local Storage not supported");var T=this.storageInterface(C).getItem(b);if(!T)return null;var l=JSON.parse(T);return l.expires&&l.expires<u.now()?(this.storageInterface(C).removeItem(b),null):l.value},m.prototype._remove=function(b,C){return this.storageInterface(C).removeItem(b)},m.prototype.storageInterface=function(b){return b?s.sessionStorage:s.localStorage},m}();n.default=new d}).call(this,i(13))},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(67)),u={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};n.default=u},function(t,n,i){Object.defineProperty(n,"__esModule",{value:!0});var s;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(s||(s={})),n.default=s},function(t,n,i){i.r(n);var s=i(29),o=i.n(s),u=i(1),f=i(3),d=i.n(f),m=i(12),b=i.n(m),C=i(17),T=i.n(C),l=function(y){var O="xhr_polling";function x(p,h,c){c.stream=!1,b.a.call(this,p,h,c),this.shortName=O}return u.inherits(x,b.a),x.isAvailable=function(){return d.a.Config.xhrSupported&&d.a.Config.allowComet},x.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},x.prototype.createRequest=function(p,h,c,a,v){return T.a.createRequest(p,h,c,a,v,this.timeouts)},typeof y<"u"&&x.isAvailable()&&(y.supportedTransports[O]=x),x},S=l,R=function(y){var O="xhr_streaming";function x(p,h,c){b.a.call(this,p,h,c),this.shortName=O}return u.inherits(x,b.a),x.isAvailable=function(){return d.a.Config.xhrSupported&&d.a.Config.streamingSupported&&d.a.Config.allowComet},x.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},x.prototype.createRequest=function(p,h,c,a,v){return T.a.createRequest(p,h,c,a,v,this.timeouts)},typeof y<"u"&&x.isAvailable()&&(y.supportedTransports[O]=x),x},I=R;n.default=[o.a,S,I]}]).default})})(yi);var bi=yi.exports;const Ks=Nn(bi),Js=Gi({__proto__:null,default:Ks},[bi]);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xe=function(){return xe=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},xe.apply(this,arguments)},Qs=function(){function r(e){this.options=e,this.listeners={}}return r.prototype.on=function(e,t){var n=this.listeners[e]||[];this.listeners[e]=n.concat([t])},r.prototype.triggerEvent=function(e,t){var n=this,i=this.listeners[e]||[];i.forEach(function(s){return s({target:n,event:t})})},r}(),tt;(function(r){r[r.Add=0]="Add",r[r.Remove=1]="Remove"})(tt||(tt={}));var Ys=function(){function r(){this.notifications=[]}return r.prototype.push=function(e){this.notifications.push(e),this.updateFn(e,tt.Add,this.notifications)},r.prototype.splice=function(e,t){var n=this.notifications.splice(e,t)[0];return this.updateFn(n,tt.Remove,this.notifications),n},r.prototype.indexOf=function(e){return this.notifications.indexOf(e)},r.prototype.onUpdate=function(e){this.updateFn=e},r}(),$e;(function(r){r.Dismiss="dismiss",r.Click="click"})($e||($e={}));var rr={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},Xs=function(){function r(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var e=document.createDocumentFragment(),t=this._createHTMLElement({tagName:"div",className:"notyf"});e.appendChild(t),document.body.appendChild(e),this.container=t,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return r.prototype.on=function(e,t){var n;this.events=xe(xe({},this.events),(n={},n[e]=t,n))},r.prototype.update=function(e,t){t===tt.Add?this.addNotification(e):t===tt.Remove&&this.removeNotification(e)},r.prototype.removeNotification=function(e){var t=this,n=this._popRenderedNotification(e),i;if(n){i=n.node,i.classList.add("notyf__toast--disappear");var s;i.addEventListener(this.animationEndEventName,s=function(o){o.target===i&&(i.removeEventListener(t.animationEndEventName,s),t.container.removeChild(i))})}},r.prototype.addNotification=function(e){var t=this._renderNotification(e);this.notifications.push({notification:e,node:t}),this._announce(e.options.message||"Notification")},r.prototype._renderNotification=function(e){var t,n=this._buildNotificationCard(e),i=e.options.className;return i&&(t=n.classList).add.apply(t,i.split(" ")),this.container.appendChild(n),n},r.prototype._popRenderedNotification=function(e){for(var t=-1,n=0;n<this.notifications.length&&t<0;n++)this.notifications[n].notification===e&&(t=n);if(t!==-1)return this.notifications.splice(t,1)[0]},r.prototype.getXPosition=function(e){var t;return((t=e==null?void 0:e.position)===null||t===void 0?void 0:t.x)||"right"},r.prototype.getYPosition=function(e){var t;return((t=e==null?void 0:e.position)===null||t===void 0?void 0:t.y)||"bottom"},r.prototype.adjustContainerAlignment=function(e){var t=this.X_POSITION_FLEX_MAP[this.getXPosition(e)],n=this.Y_POSITION_FLEX_MAP[this.getYPosition(e)],i=this.container.style;i.setProperty("justify-content",n),i.setProperty("align-items",t)},r.prototype._buildNotificationCard=function(e){var t=this,n=e.options,i=n.icon;this.adjustContainerAlignment(n);var s=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),u=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),f=this._createHTMLElement({tagName:"div",className:"notyf__message"});f.innerHTML=n.message||"";var d=n.background||n.backgroundColor;if(i){var m=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof i=="string"||i instanceof String)&&(m.innerHTML=new String(i).valueOf()),typeof i=="object"){var b=i.tagName,C=b===void 0?"i":b,T=i.className,l=i.text,S=i.color,R=S===void 0?d:S,I=this._createHTMLElement({tagName:C,className:T,text:l});R&&(I.style.color=R),m.appendChild(I)}u.appendChild(m)}if(u.appendChild(f),s.appendChild(u),d&&(n.ripple?(o.style.background=d,s.appendChild(o)):s.style.background=d),n.dismissible){var y=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),O=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});y.appendChild(O),u.appendChild(y),s.classList.add("notyf__toast--dismissible"),O.addEventListener("click",function(p){var h,c;(c=(h=t.events)[$e.Dismiss])===null||c===void 0||c.call(h,{target:e,event:p}),p.stopPropagation()})}s.addEventListener("click",function(p){var h,c;return(c=(h=t.events)[$e.Click])===null||c===void 0?void 0:c.call(h,{target:e,event:p})});var x=this.getYPosition(n)==="top"?"upper":"lower";return s.classList.add("notyf__toast--"+x),s},r.prototype._createHTMLElement=function(e){var t=e.tagName,n=e.className,i=e.text,s=document.createElement(t);return n&&(s.className=n),s.textContent=i||null,s},r.prototype._createA11yContainer=function(){var e=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),e.style.border="0",e.style.clip="rect(0 0 0 0)",e.style.height="1px",e.style.margin="-1px",e.style.overflow="hidden",e.style.padding="0",e.style.position="absolute",e.style.width="1px",e.style.outline="0",document.body.appendChild(e),this.a11yContainer=e},r.prototype._announce=function(e){var t=this;this.a11yContainer.textContent="",setTimeout(function(){t.a11yContainer.textContent=e},100)},r.prototype._getAnimationEndEventName=function(){var e=document.createElement("_fake"),t={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},n;for(n in t)if(e.style[n]!==void 0)return t[n];return"animationend"},r}(),Zs=function(){function r(e){var t=this;this.dismiss=this._removeNotification,this.notifications=new Ys,this.view=new Xs;var n=this.registerTypes(e);this.options=xe(xe({},rr),e),this.options.types=n,this.notifications.onUpdate(function(i,s){return t.view.update(i,s)}),this.view.on($e.Dismiss,function(i){var s=i.target,o=i.event;t._removeNotification(s),s.triggerEvent($e.Dismiss,o)}),this.view.on($e.Click,function(i){var s=i.target,o=i.event;return s.triggerEvent($e.Click,o)})}return r.prototype.error=function(e){var t=this.normalizeOptions("error",e);return this.open(t)},r.prototype.success=function(e){var t=this.normalizeOptions("success",e);return this.open(t)},r.prototype.open=function(e){var t=this.options.types.find(function(s){var o=s.type;return o===e.type})||{},n=xe(xe({},t),e);this.assignProps(["ripple","position","dismissible"],n);var i=new Qs(n);return this._pushNotification(i),i},r.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},r.prototype.assignProps=function(e,t){var n=this;e.forEach(function(i){t[i]=t[i]==null?n.options[i]:t[i]})},r.prototype._pushNotification=function(e){var t=this;this.notifications.push(e);var n=e.options.duration!==void 0?e.options.duration:this.options.duration;n&&setTimeout(function(){return t._removeNotification(e)},n)},r.prototype._removeNotification=function(e){var t=this.notifications.indexOf(e);t!==-1&&this.notifications.splice(t,1)},r.prototype.normalizeOptions=function(e,t){var n={type:e};return typeof t=="string"?n.message=t:typeof t=="object"&&(n=xe(xe({},n),t)),n},r.prototype.registerTypes=function(e){var t=(e&&e.types||[]).slice(),n=rr.types.map(function(i){var s=-1;t.forEach(function(u,f){u.type===i.type&&(s=f)});var o=s!==-1?t.splice(s,1)[0]:{};return xe(xe({},i),o)});return n.concat(t)},r}();window.Notyf=Zs;window.Ably=Js;window.Echo=new qs({broadcaster:"ably",tls:!0,disableStats:!0,authEndpoint:"/broadcasting/auth",auth:{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}});window.Echo.connector.ably.connection.on(r=>{r.current==="connected"&&console.log("connected to ably server")});window.Echo.connector.ably.connection.on("stateChange",r=>{r.current==="connected"?console.log("Connected to Ably server"):r.current==="failed"&&console.error("Failed to connect to Ably server:",r.reason)});window.axios=fe;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";let ir=document.head.querySelector('meta[name="csrf-token"]');ir?window.axios.defaults.headers.common["X-CSRF-TOKEN"]=ir.content:console.error("CSRF token not found!");var ea=Object.defineProperty,ta=(r,e,t)=>e in r?ea(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ze=(r,e,t)=>ta(r,typeof e!="symbol"?e+"":e,t);document.addEventListener("alpine:init",()=>{window.Alpine.store("editOnClickValidation",{pending:[],set(r,e){this.pending=this.pending.filter(t=>t.value!==r),this.pending.push({value:r,textContent:e})},has(r){return this.pending.some(e=>e.value===r)},get(r){return this.pending.find(e=>e.value===r)},notContains(r){return this.pending.length>0&&!this.has(r)},clear(){this.pending=[]},getTextContent(r){const e=this.pending.find(t=>t.value===r);return e?e.textContent:null}}),window.editOnClickValidation=window.Alpine.store("editOnClickValidation")});document.addEventListener("alpine:init",()=>{window.Alpine.store("pgBulkActions",{selected:[],init(){window.addEventListener("pgBulkActions::addMore",r=>{const e=r.__livewire.params[0];typeof this.selected[e.tableName]>"u"&&(this.selected[e.tableName]=[]),this.selected[e.tableName].push(e.value)}),window.addEventListener("pgBulkActions::clear",r=>{this.clear(r.detail)}),window.addEventListener("pgBulkActions::clearAll",()=>{this.clearAll()})},add(r,e){if(typeof this.selected[e]>"u"&&(this.selected[e]=[]),!this.selected[e].includes(r)){this.selected[e].push(r);return}this.remove(r,e)},remove(r,e){const t=this.selected[e].indexOf(r);t>-1&&this.selected[e].splice(t,1)},get(r){return this.selected[r]??""},count(r){return typeof this.selected[r]>"u"?0:this.selected[r].length},clear(r){this.selected[r]=[]},clearAll(){this.selected=[]}}),window.pgBulkActions=window.Alpine.store("pgBulkActions")});const na=r=>({field:r.field??null,tableName:r.tableName??null,enabled:r.enabled??!1,id:r.id,trueValue:r.trueValue,falseValue:r.falseValue,toggle:r.toggle,save(){this.toggle=this.toggle===0?1:0,this.$wire.dispatch("pg:toggleable-"+this.tableName,{id:this.id,field:this.field,value:this.toggle})}}),ra=(r,e,t)=>{const n=r[e];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((i,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})},ia=r=>({dataField:r.dataField,tableName:r.tableName,label:r.label??null,locale:r.locale??{locale:"default",dateFormat:"Y-m-d H:i",time_24hr:!1,enableTime:!0},onlyFuture:r.onlyFuture??!1,noWeekEnds:r.noWeekEnds??!1,customConfig:r.customConfig??null,type:r.type,element:null,selectedDates:null,async init(){typeof flatpickr>"u"&&(console.log("%c%s","color: #f59e0c; font-size: 1.2em; font-weight: bold; line-height: 1.5"," PowerGrid"),console.error("%c%s","font-size: 1em; line-height: 1.5",`
Failed to mount filter: Filter::datetime('${this.dataField}') on table ['${this.tableName}']

 Install flatpickr: npm install flatpickr

 Add 'import flatpickr from "flatpickr"' in resources/js/app.js file
  `)),window.addEventListener(`pg:clear_flatpickr::${this.tableName}:${this.dataField}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()}),window.addEventListener(`pg:clear_all_flatpickr::${this.tableName}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()});try{const t=await ra(Object.assign({}),`./flatpickr/dist/l10n/${this.locale.locale}.js`,5);flatpickr.localize(t.default||t)}catch{}const e=this.getOptions();this.$refs.rangeInput&&typeof flatpickr<"u"&&(this.element=flatpickr(this.$refs.rangeInput,e),this.selectedDates=this.$wire.get(`filters.${this.type}.${this.dataField}.formatted`),this.element.setDate(this.selectedDates))},getOptions(){const e={mode:"range",defaultHour:0,...this.locale,...this.customConfig};return this.onlyFuture&&(e.minDate="today"),this.noWeekEnds&&(e.disable=[function(t){return t.getDay()===0||t.getDay()===6}]),e.onClose=(t,n,i)=>{t=t.map(s=>this.element.formatDate(s,"Y-m-d")),t.length>0&&this.selectedDates!==n&&Livewire.dispatch("pg:datePicker-"+this.tableName,{selectedDates:t,dateStr:n,timezone:this.customConfig.timezone??new Date().toString().match(/([-\+][0-9]+)\s/)[1],type:this.type,field:this.dataField,label:this.label})},e}}),oa=r=>({theme:r.theme,id:r.id??null,dataField:r.dataField??null,content:r.content,fallback:r.fallback,inputClass:r.inputClass,saveOnMouseOut:r.saveOnMouseOut,oldContent:null,editable:!1,hash:null,hashError:!0,showEditable:!1,editableInput:"",init(){this.content.length===0&&this.fallback&&(this.content=this.htmlSpecialChars(this.fallback)),this.hash=this.dataField+"-"+this.id,window.addEventListener("toggle-"+this.hash,()=>{this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.click(),this.observe(()=>document.getElementById("editable-"+this.hash),t=>{setTimeout(()=>this.setFocusToEnd(t),100)})})}),this.$watch("editable",e=>{if(e){let t=!1;if(this.showEditable=!1,this.content=this.htmlSpecialChars(this.content),this.oldContent=this.content,this.hashError=this.store().notContains(this.hash),this.observe(()=>document.getElementById("editable-"+this.hash),n=>{setTimeout(()=>{this.setFocusToEnd(n),this.store().getTextContent(this.hash)&&(n.textContent=this.store().getTextContent(this.hash))},30)}),this.hashError){const n=this.store().get(this.hash),i=document.getElementById("clickable-"+n);i&&i.click()}t=!0,this.editableInput=`
                <div
                    x-ref="editable"
                    x-text="content"
                    value="${this.content}"
                    placeholder="${this.content}"
                    contenteditable
                    class="pg-single-line ${this.inputClass}"
                    ${this.saveOnMouseOut?'x-on:mousedown.outside="save()"':""}
                    x-on:keydown.enter="save()"
                    id="${"editable-"+this.dataField+"-"+this.id}"
                    x-on:keydown.esc="cancel"
                >
                </div>`,this.$nextTick(()=>setTimeout(()=>{this.showEditable=t,this.focus()},150))}}),this.content=this.htmlSpecialChars(this.content)},store(){return window.editOnClickValidation},save(){this.store().clear(),this.store().set(this.hash,this.$el.textContent),this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.textContent=this.$el.textContent}),window.addEventListener("pg:editable-close-"+this.id,()=>{this.store().clear(),this.editable=!1,this.showEditable=!1}),this.store().has(this.hash)||this.store().set(this.hash,this.$el.textContent),this.$wire.dispatch("pg:editable-"+this.$wire.tableName,{id:this.id,value:this.$el.textContent,field:this.dataField}),this.oldContent=this.store().getTextContent(this.hash),this.$nextTick(()=>{this.focus(),this.$el.setAttribute("value","")}),this.content=this.htmlSpecialChars(this.$el.textContent)},focus(){this.setFocusToEnd(this.$el)},cancel(){this.store().clear(),this.$refs.editable.textContent=this.oldContent,this.content=this.oldContent,this.editable=!1,this.showEditable=!1,this.$refs.error&&(this.$refs.error.innerHTML="")},htmlSpecialChars(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent},observe(e,t){new MutationObserver((n,i)=>{for(let s of n)if(s.type==="childList"){const o=e();if(o){t(o),i.disconnect();break}}}).observe(document.body,{childList:!0,subtree:!0})},setFocusToEnd(e){if(!e)return;const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),n.collapse(!1),t.removeAllRanges(),t.addRange(n),e.focus()}});function sa(r){r.querySelectorAll("tbody tr td").forEach(e=>{e.classList.remove("hidden")}),r.querySelectorAll("thead tr th").forEach(e=>{e.classList.remove("hidden")})}function aa(r){let e=0;const t=r.querySelectorAll("table thead tr:nth-child(1) th[fixed]"),n=In(r);return t.forEach(i=>{e+=In(i)}),n-e}function la(r,e){const t=[].slice.call(r.querySelectorAll("table thead tr:nth-child(1) th")),n=[].slice.call(t).sort(function(u,f){const d=u.getAttribute("sort_order")??999,m=f.getAttribute("sort_order")??999;return d-m});let i=0,s=!0;const o=[];return n.forEach(u=>{const f=In(u);u.getAttribute("fixed")===null&&(s&&i<=e&&i+f<=e?i+=f:(o.push(t.indexOf(u)+1),s=!1))}),o}function ua(r,e){for(const t of e)r.querySelectorAll(`tbody:not(tbody[expand]) tr td:nth-child(${t})`).forEach(n=>{n.classList.add("hidden")}),r.querySelectorAll(`thead tr th:nth-child(${t})`).forEach(n=>{n.classList.add("hidden")})}function ca(r,e){var t,n;if(r.querySelectorAll("table tbody[expand] tr td div").length){for(const i of r.querySelectorAll("table tbody[expand] tr td div"))i.innerHTML="";if(e.length)for(const i of e){const s=r.querySelectorAll("table tbody:not(tbody[expand])");for(const o of s){const u=(t=o.nextElementSibling)==null?void 0:t.querySelector("tr td div");if(!u)continue;let f=r.querySelector(`table thead tr th:nth-child(${i}) span[data-value]`).textContent;const d=(n=o.querySelector(`tr:last-child td:nth-child(${i})`))==null?void 0:n.innerHTML;f.length&&(f+=":"),u.querySelector(`div[data-expand-item-${i}]`)||(u.innerHTML+=`<div class="responsive-row-expand-item-container" data-expand-item-${i}>
                    <span class="font-bold responsive-row-expand-item-name">${f}</span>
                    <span class="responsive-row-expand-item-value">${d}</span>
                </div>`)}}}}function In(r){return parseFloat(r.getBoundingClientRect().width.toFixed(2))}function fa(r){sa(r);const e=aa(r),t=la(r,e);ca(r,t),ua(r,t)}const da=()=>({running:!1,expanded:null,element:null,hasHiddenElements:!1,size:0,toggleExpanded(r){this.expanded=this.expanded==r?null:r},init(){this.$nextTick(()=>{this.handleResize(),this.observeElement(),window.addEventListener("pg-livewire-request-finished",()=>{setTimeout(()=>this.handleResize(),5)})})},handleResize(){var r;const e=this.$el;fa(e),this.hasHiddenElements=(r=e.querySelector("table tbody[expand] tr td div"))==null?void 0:r.innerHTML,this.hasHiddenElements||(this.expanded=null)},observeElement(){new ResizeObserver(r=>{r.forEach(e=>{if(e.contentRect.width>0){if(this.size===this.$el.getBoundingClientRect().width)return;this.size=this.$el.getBoundingClientRect().width,this.handleResize()}})}).observe(this.$el)}}),ha=(r,e,t)=>{Livewire.dispatch(`${r}-${e.tableName}`,{label:e.label,field:e.dataField,values:t})},Oi=(r,e)=>{ha("pg:multiSelect",r,e)};function sn(r,e){r.split(/\s+/).forEach(t=>{e(t)})}class pa{constructor(){this._events={}}on(e,t){sn(e,n=>{const i=this._events[n]||[];i.push(t),this._events[n]=i})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}sn(e,i=>{if(n===1){delete this._events[i];return}const s=this._events[i];s!==void 0&&(s.splice(s.indexOf(t),1),this._events[i]=s)})}trigger(e,...t){var n=this;sn(e,i=>{const s=n._events[i];s!==void 0&&s.forEach(o=>{o.apply(n,t)})})}}function ga(r){return r.plugins={},class extends r{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){r.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const i=this,s=[];if(Array.isArray(e))e.forEach(o=>{typeof o=="string"?s.push(o):(i.plugins.settings[o.name]=o.options,s.push(o.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(i.plugins.settings[t]=e[t],s.push(t));for(;n=s.shift();)i.require(n)}loadPlugin(e){var t=this,n=t.plugins,i=r.plugins[e];if(!r.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=i.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}const Qt=r=>(r=r.filter(Boolean),r.length<2?r[0]||"":ma(r)==1?"["+r.join("")+"]":"(?:"+r.join("|")+")"),Ci=r=>{if(!va(r))return r.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return r.forEach((i,s)=>{if(i===r[s-1]){t++;return}n(),e+=i,t=1}),n(),e},wi=r=>{let e=Array.from(r);return Qt(e)},va=r=>new Set(r).size!==r.length,lt=r=>(r+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),ma=r=>r.reduce((e,t)=>Math.max(e,ya(t)),0),ya=r=>Array.from(r).length,Ai=r=>{if(r.length===1)return[[r]];let e=[];const t=r.substring(1);return Ai(t).forEach(function(n){let i=n.slice(0);i[0]=r.charAt(0)+i[0],e.push(i),i=n.slice(0),i.unshift(r.charAt(0)),e.push(i)}),e},ba=[[0,65535]],Oa="[-]";let Lt,Si;const Ca=3,Fn={},or={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let r in or){let e=or[r]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Fn[n]=r}}const wa=new RegExp(Object.keys(Fn).join("|")+"|"+Oa,"gu"),Aa=r=>{Lt===void 0&&(Lt=Ta(ba))},sr=(r,e="NFKD")=>r.normalize(e),kt=r=>Array.from(r).reduce((e,t)=>e+Sa(t),""),Sa=r=>(r=sr(r).toLowerCase().replace(wa,e=>Fn[e]||""),sr(r,"NFC"));function*Ea(r){for(const[e,t]of r)for(let n=e;n<=t;n++){let i=String.fromCharCode(n),s=kt(i);s!=i.toLowerCase()&&(s.length>Ca||s.length!=0&&(yield{folded:s,composed:i,code_point:n}))}}const Ra=r=>{const e={},t=(n,i)=>{const s=e[n]||new Set,o=new RegExp("^"+wi(s)+"$","iu");i.match(o)||(s.add(lt(i)),e[n]=s)};for(let n of Ea(r))t(n.folded,n.folded),t(n.folded,n.composed);return e},Ta=r=>{const e=Ra(r),t={};let n=[];for(let s in e){let o=e[s];o&&(t[s]=wi(o)),s.length>1&&n.push(lt(s))}n.sort((s,o)=>o.length-s.length);const i=Qt(n);return Si=new RegExp("^"+i,"u"),t},Ia=(r,e=1)=>{let t=0;return r=r.map(n=>(Lt[n]&&(t+=n.length),Lt[n]||n)),t>=e?Ci(r):""},xa=(r,e=1)=>(e=Math.max(e,r.length-1),Qt(Ai(r).map(t=>Ia(t,e)))),ar=(r,e=!0)=>{let t=r.length>1?1:0;return Qt(r.map(n=>{let i=[];const s=e?n.length():n.length()-1;for(let o=0;o<s;o++)i.push(xa(n.substrs[o]||"",t));return Ci(i)}))},_a=(r,e)=>{for(const t of e){if(t.start!=r.start||t.end!=r.end||t.substrs.join("")!==r.substrs.join(""))continue;let n=r.parts;const i=s=>{for(const o of n){if(o.start===s.start&&o.substr===s.substr)return!1;if(!(s.length==1||o.length==1)&&(s.start<o.start&&s.end>o.start||o.start<s.start&&o.end>s.start))return!0}return!1};if(!(t.parts.filter(i).length>0))return!0}return!1};class Dt{constructor(){Ze(this,"parts"),Ze(this,"substrs"),Ze(this,"start"),Ze(this,"end"),this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new Dt,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const f of i)n.add(f);let o=t.substr.substring(0,e-s.start),u=o.length;return n.add({start:s.start,end:s.start+u,length:u,substr:o}),n}}const Pa=r=>{Aa(),r=kt(r);let e="",t=[new Dt];for(let n=0;n<r.length;n++){let i=r.substring(n).match(Si);const s=r.substring(n,n+1),o=i?i[0]:null;let u=[],f=new Set;for(const d of t){const m=d.last();if(!m||m.length==1||m.end<=n)if(o){const b=o.length;d.add({start:n,end:n+b,length:b,substr:o}),f.add("1")}else d.add({start:n,end:n+1,length:1,substr:s}),f.add("2");else if(o){let b=d.clone(n,m);const C=o.length;b.add({start:n,end:n+C,length:C,substr:o}),u.push(b)}else f.add("3")}if(u.length>0){u=u.sort((d,m)=>d.length()-m.length());for(let d of u)_a(d,t)||t.push(d);continue}if(n>0&&f.size==1&&!f.has("3")){e+=ar(t,!1);let d=new Dt;const m=t[0];m&&d.add(m.last()),t=[d]}}return e+=ar(t,!0),e},Ma=(r,e)=>{if(r)return r[e]},La=(r,e)=>{if(r){for(var t,n=e.split(".");(t=n.shift())&&(r=r[t]););return r}},an=(r,e,t)=>{var n,i;return!r||(r=r+"",e.regex==null)||(i=r.search(e.regex),i===-1)?0:(n=e.string.length/r.length,i===0&&(n+=.5),n*t)},ln=(r,e)=>{var t=r[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(r[e]=[t])},gt=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},ka=(r,e)=>typeof r=="number"&&typeof e=="number"?r>e?1:r<e?-1:0:(r=kt(r+"").toLowerCase(),e=kt(e+"").toLowerCase(),r>e?1:e>r?-1:0);class Da{constructor(e,t){Ze(this,"items"),Ze(this,"settings"),this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const i=[],s=e.split(/\s+/);var o;return n&&(o=new RegExp("^("+Object.keys(n).map(lt).join("|")+"):(.*)$")),s.forEach(u=>{let f,d=null,m=null;o&&(f=u.match(o))&&(d=f[1],u=f[2]),u.length>0&&(this.settings.diacritics?m=Pa(u)||null:m=lt(u),m&&t&&(m="\\b"+m)),i.push({string:u,regex:m?new RegExp(m,"iu"):null,field:d})}),i}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const i=e.options.fields,s=e.weights,o=i.length,u=e.getAttrFn;if(!o)return function(){return 1};const f=function(){return o===1?function(d,m){const b=i[0].field;return an(u(m,b),d,s[b]||1)}:function(d,m){var b=0;if(d.field){const C=u(m,d.field);!d.regex&&C?b+=1/o:b+=an(C,d,1)}else gt(s,(C,T)=>{b+=an(u(m,T),d,C)});return b/o}}();return n===1?function(d){return f(t[0],d)}:e.options.conjunction==="and"?function(d){var m,b=0;for(let C of t){if(m=f(C,d),m<=0)return 0;b+=m}return b/n}:function(d){var m=0;return gt(t,b=>{m+=f(b,d)}),m/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const i=this,s=e.options,o=!e.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof o=="function")return o.bind(this);const u=function(f,d){return f==="$score"?d.score:e.getAttrFn(i.items[d.id],f)};if(o)for(let f of o)(e.query||f.field!=="$score")&&n.push(f);if(e.query){t=!0;for(let f of n)if(f.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(f=>f.field!=="$score");return n.length?function(f,d){var m,b;for(let C of n)if(b=C.field,m=(C.direction==="desc"?-1:1)*ka(u(b,f),u(b,d)),m)return m;return 0}:null}prepareSearch(e,t){const n={};var i=Object.assign({},t);if(ln(i,"sort"),ln(i,"sort_empty"),i.fields){ln(i,"fields");const s=[];i.fields.forEach(o=>{typeof o=="string"&&(o={field:o,weight:1}),s.push(o),n[o.field]="weight"in o?o.weight:1}),i.fields=s}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:i.nesting?La:Ma}}search(e,t){var n=this,i,s;s=this.prepareSearch(e,t),t=s.options,e=s.query;const o=t.score||n._getScoreFunction(s);e.length?gt(n.items,(f,d)=>{i=o(f),(t.filter===!1||i>0)&&s.items.push({score:i,id:d})}):gt(n.items,(f,d)=>{s.items.push({score:1,id:d})});const u=n._getSortFunction(s);return u&&s.items.sort(u),s.total=s.items.length,typeof t.limit=="number"&&(s.items=s.items.slice(0,t.limit)),s}}const Me=r=>typeof r>"u"||r===null?null:Rt(r),Rt=r=>typeof r=="boolean"?r?"1":"0":r+"",un=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Na=(r,e)=>e>0?window.setTimeout(r,e):(r.call(null),null),Fa=(r,e)=>{var t;return function(n,i){var s=this;t&&(s.loading=Math.max(s.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,s.loadedSearches[n]=!0,r.call(s,n,i)},e)}},lr=(r,e,t)=>{var n,i=r.trigger,s={};r.trigger=function(){var o=arguments[0];if(e.indexOf(o)!==-1)s[o]=arguments;else return i.apply(r,arguments)},t.apply(r,[]),r.trigger=i;for(n of e)n in s&&i.apply(r,s[n])},ja=r=>({start:r.selectionStart||0,length:(r.selectionEnd||0)-(r.selectionStart||0)}),ce=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Oe=(r,e,t,n)=>{r.addEventListener(e,t,n)},Ve=(r,e)=>{if(!e||!e[r])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},cn=(r,e)=>r.getAttribute("id")||(r.setAttribute("id",e),e),ur=r=>r.replace(/[\\"']/g,"\\$&"),ze=(r,e)=>{e&&r.append(e)},pe=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},Ne=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Ei(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Ei=r=>typeof r=="string"&&r.indexOf("<")>-1,Ua=r=>r.replace(/['"\\]/g,"\\$&"),fn=(r,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),r.dispatchEvent(t)},vt=(r,e)=>{Object.assign(r.style,e)},Te=(r,...e)=>{var t=Ri(e);r=Ti(r),r.map(n=>{t.map(i=>{n.classList.add(i)})})},Be=(r,...e)=>{var t=Ri(e);r=Ti(r),r.map(n=>{t.map(i=>{n.classList.remove(i)})})},Ri=r=>{var e=[];return pe(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Ti=r=>(Array.isArray(r)||(r=[r]),r),dn=(r,e,t)=>{if(!(t&&!t.contains(r)))for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},cr=(r,e=0)=>e>0?r[r.length-1]:r[0],Ba=r=>Object.keys(r).length===0,fr=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var t=0;r=r.previousElementSibling;)r.matches(e)&&t++;return t},oe=(r,e)=>{pe(e,(t,n)=>{t==null?r.removeAttribute(n):r.setAttribute(n,""+t)})},xn=(r,e)=>{r.parentNode&&r.parentNode.replaceChild(e,r)},Ha=(r,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=s=>{var o=s.data.match(e);if(o&&s.data.length>0){var u=document.createElement("span");u.className="highlight";var f=s.splitText(o.index);f.splitText(o[0].length);var d=f.cloneNode(!0);return u.appendChild(d),xn(f,u),1}return 0},n=s=>{s.nodeType===1&&s.childNodes&&!/(script|style)/i.test(s.tagName)&&(s.className!=="highlight"||s.tagName!=="SPAN")&&Array.from(s.childNodes).forEach(o=>{i(o)})},i=s=>s.nodeType===3?t(s):(n(s),0);i(r)},$a=r=>{var e=r.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Ga=65,Va=13,za=27,Wa=37,qa=38,Ka=39,Ja=40,dr=8,Qa=46,hr=9,Ya=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),mt=Ya?"metaKey":"ctrlKey",pr={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(r){return r.length>0},render:{}};function gr(r,e){var t=Object.assign({},pr,e),n=t.dataAttr,i=t.labelField,s=t.valueField,o=t.disabledField,u=t.optgroupField,f=t.optgroupLabelField,d=t.optgroupValueField,m=r.tagName.toLowerCase(),b=r.getAttribute("placeholder")||r.getAttribute("data-placeholder");if(!b&&!t.allowEmptyOption){let S=r.querySelector('option[value=""]');S&&(b=S.textContent)}var C={placeholder:b,options:[],optgroups:[],items:[],maxItems:null},T=()=>{var S,R=C.options,I={},y=1;let O=0;var x=c=>{var a=Object.assign({},c.dataset),v=n&&a[n];return typeof v=="string"&&v.length&&(a=Object.assign(a,JSON.parse(v))),a},p=(c,a)=>{var v=Me(c.value);if(v!=null&&!(!v&&!t.allowEmptyOption)){if(I.hasOwnProperty(v)){if(a){var g=I[v][u];g?Array.isArray(g)?g.push(a):I[v][u]=[g,a]:I[v][u]=a}}else{var w=x(c);w[i]=w[i]||c.textContent,w[s]=w[s]||v,w[o]=w[o]||c.disabled,w[u]=w[u]||a,w.$option=c,w.$order=w.$order||++O,I[v]=w,R.push(w)}c.selected&&C.items.push(v)}},h=c=>{var a,v;v=x(c),v[f]=v[f]||c.getAttribute("label")||"",v[d]=v[d]||y++,v[o]=v[o]||c.disabled,v.$order=v.$order||++O,C.optgroups.push(v),a=v[d],pe(c.children,g=>{p(g,a)})};C.maxItems=r.hasAttribute("multiple")?null:1,pe(r.children,c=>{S=c.tagName.toLowerCase(),S==="optgroup"?h(c):S==="option"&&p(c)})},l=()=>{const S=r.getAttribute(n);if(S)C.options=JSON.parse(S),pe(C.options,I=>{C.items.push(I[s])});else{var R=r.value.trim()||"";if(!t.allowEmptyOption&&!R.length)return;const I=R.split(t.delimiter);pe(I,y=>{const O={};O[i]=y,O[s]=y,C.options.push(O)}),C.items=I}};return m==="select"?T():l(),Object.assign({},pr,C,e)}var vr=0;class we extends ga(pa){constructor(e,t){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,vr++;var n,i=Ne(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s=window.getComputedStyle&&window.getComputedStyle(i,null);n=s.getPropertyValue("direction");const o=gr(i,t);this.settings=o,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=cn(i,"tomselect-"+vr),this.isRequired=i.required,this.sifter=new Da(this.options,{diacritics:o.diacritics}),o.mode=o.mode||(o.maxItems===1?"single":"multi"),typeof o.hideSelected!="boolean"&&(o.hideSelected=o.mode==="multi"),typeof o.hidePlaceholder!="boolean"&&(o.hidePlaceholder=o.mode!=="multi");var u=o.createFilter;typeof u!="function"&&(typeof u=="string"&&(u=new RegExp(u)),u instanceof RegExp?o.createFilter=R=>u.test(R):o.createFilter=R=>this.settings.duplicates||!this.options[R]),this.initializePlugins(o.plugins),this.setupCallbacks(),this.setupTemplates();const f=Ne("<div>"),d=Ne("<div>"),m=this._render("dropdown"),b=Ne('<div role="listbox" tabindex="-1">'),C=this.input.getAttribute("class")||"",T=o.mode;var l;if(Te(f,o.wrapperClass,C,T),Te(d,o.controlClass),ze(f,d),Te(m,o.dropdownClass,T),o.copyClassesToDropdown&&Te(m,C),Te(b,o.dropdownContentClass),ze(m,b),Ne(o.dropdownParent||f).appendChild(m),Ei(o.controlInput)){l=Ne(o.controlInput);var S=["autocorrect","autocapitalize","autocomplete","spellcheck"];pe(S,R=>{i.getAttribute(R)&&oe(l,{[R]:i.getAttribute(R)})}),l.tabIndex=-1,d.appendChild(l),this.focus_node=l}else o.controlInput?(l=Ne(o.controlInput),this.focus_node=l):(l=Ne("<input/>"),this.focus_node=d);this.wrapper=f,this.dropdown=m,this.dropdown_content=b,this.control=d,this.control_input=l,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,i=e.dropdown,s=e.dropdown_content,o=e.wrapper,u=e.control,f=e.input,d=e.focus_node,m={passive:!0},b=e.inputId+"-ts-dropdown";oe(s,{id:b}),oe(d,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":b});const C=cn(d,e.inputId+"-ts-control"),T="label[for='"+Ua(e.inputId)+"']",l=document.querySelector(T),S=e.focus.bind(e);if(l){Oe(l,"click",S),oe(l,{for:C});const y=cn(l,e.inputId+"-ts-label");oe(d,{"aria-labelledby":y}),oe(s,{"aria-labelledby":y})}if(o.style.width=f.style.width,e.plugins.names.length){const y="plugin-"+e.plugins.names.join(" plugin-");Te([o,i],y)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&oe(f,{multiple:"multiple"}),t.placeholder&&oe(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+lt(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Fa(t.load,t.loadThrottle)),Oe(i,"mousemove",()=>{e.ignoreHover=!1}),Oe(i,"mouseenter",y=>{var O=dn(y.target,"[data-selectable]",i);O&&e.onOptionHover(y,O)},{capture:!0}),Oe(i,"click",y=>{const O=dn(y.target,"[data-selectable]");O&&(e.onOptionSelect(y,O),ce(y,!0))}),Oe(u,"click",y=>{var O=dn(y.target,"[data-ts-item]",u);if(O&&e.onItemSelect(y,O)){ce(y,!0);return}n.value==""&&(e.onClick(),ce(y,!0))}),Oe(d,"keydown",y=>e.onKeyDown(y)),Oe(n,"keypress",y=>e.onKeyPress(y)),Oe(n,"input",y=>e.onInput(y)),Oe(d,"blur",y=>e.onBlur(y)),Oe(d,"focus",y=>e.onFocus(y)),Oe(n,"paste",y=>e.onPaste(y));const R=y=>{const O=y.composedPath()[0];if(!o.contains(O)&&!i.contains(O)){e.isFocused&&e.blur(),e.inputState();return}O==n&&e.isOpen?y.stopPropagation():ce(y,!0)},I=()=>{e.isOpen&&e.positionDropdown()};Oe(document,"mousedown",R),Oe(window,"scroll",I,m),Oe(window,"resize",I,m),this._destroy=()=>{document.removeEventListener("mousedown",R),window.removeEventListener("scroll",I),window.removeEventListener("resize",I),l&&l.removeEventListener("click",S)},this.revertSettings={innerHTML:f.innerHTML,tabIndex:f.tabIndex},f.tabIndex=-1,f.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,Oe(f,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,f.disabled?e.disable():f.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Te(f,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),pe(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,i={optgroup:s=>{let o=document.createElement("div");return o.className="optgroup",o.appendChild(s.options),o},optgroup_header:(s,o)=>'<div class="optgroup-header">'+o(s[n])+"</div>",option:(s,o)=>"<div>"+o(s[t])+"</div>",item:(s,o)=>"<div>"+o(s[t])+"</div>",option_create:(s,o)=>'<div class="create">Add <strong>'+o(s.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?gr(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){fn(this.input,"input"),fn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){ce(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var i=n.trim().split(t.settings.splitOn);pe(i,s=>{Me(s)&&(this.options[s]?t.addItem(s):t.createItem(s))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){ce(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),ce(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==hr&&ce(e);return}switch(e.keyCode){case Ga:if(Ve(mt,e)&&t.control_input.value==""){ce(e),t.selectAll();return}break;case za:t.isOpen&&(ce(e,!0),t.close()),t.clearActiveItems();return;case Ja:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}ce(e);return;case qa:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}ce(e);return;case Va:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),ce(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&ce(e);return;case Wa:t.advanceSelection(-1,e);return;case Ka:t.advanceSelection(1,e);return;case hr:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),ce(e)),t.settings.create&&t.createItem()&&ce(e));return;case dr:case Qa:t.deleteSelection(e);return}t.isInputHidden&&!Ve(mt,e)&&ce(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=Na(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),ce(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,i=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(n=t.dataset.value,typeof n<"u"&&(i.lastQuery=null,i.addItem(n),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(ce(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;Te(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||Be(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,fn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];lr(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,i,s,o,u,f,d;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(i=t&&t.type.toLowerCase(),i==="click"&&Ve("shiftKey",t)&&n.activeItems.length){for(d=n.getLastActive(),o=Array.prototype.indexOf.call(n.control.children,d),u=Array.prototype.indexOf.call(n.control.children,e),o>u&&(f=o,o=u,u=f),s=o;s<=u;s++)e=n.control.children[s],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);ce(t)}else i==="click"&&Ve(mt,t)||i==="keydown"&&Ve("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&Be(n,"last-active"),Te(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),Be(e,"active")}clearActiveItems(){Be(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,oe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),oe(e,{"aria-selected":"true"}),Te(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,i=n.clientHeight,s=n.scrollTop||0,o=e.offsetHeight,u=e.getBoundingClientRect().top-n.getBoundingClientRect().top+s;u+o>i+s?this.scroll(u-i+o,t):u<s&&this.scroll(u,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(Be(this.activeOption,"active"),oe(this.activeOption,{"aria-selected":null})),this.activeOption=null,oe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,pe(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(oe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&oe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,i=this,s=this.getSearchOptions();if(i.settings.score&&(n=i.settings.score.call(i,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,t=i.sifter.search(e,Object.assign(s,{score:n})),i.currentResults=t):t=Object.assign({},i.currentResults),i.settings.hideSelected&&(t.items=t.items.filter(o=>{let u=Me(o.id);return!(u&&i.items.indexOf(u)!==-1)})),t}refreshOptions(e=!0){var t,n,i,s,o,u,f,d,m,b;const C={},T=[];var l=this,S=l.inputValue();const R=S===l.lastQuery||S==""&&l.lastQuery==null;var I=l.search(S),y=null,O=l.settings.shouldOpen||!1,x=l.dropdown_content;R&&(y=l.activeOption,y&&(m=y.closest("[data-group]"))),s=I.items.length,typeof l.settings.maxOptions=="number"&&(s=Math.min(s,l.settings.maxOptions)),s>0&&(O=!0);const p=(c,a)=>{let v=C[c];if(v!==void 0){let w=T[v];if(w!==void 0)return[v,w.fragment]}let g=document.createDocumentFragment();return v=T.length,T.push({fragment:g,order:a,optgroup:c}),[v,g]};for(t=0;t<s;t++){let c=I.items[t];if(!c)continue;let a=c.id,v=l.options[a];if(v===void 0)continue;let g=Rt(a),w=l.getOption(g,!0);for(l.settings.hideSelected||w.classList.toggle("selected",l.items.includes(g)),o=v[l.settings.optgroupField]||"",u=Array.isArray(o)?o:[o],n=0,i=u&&u.length;n<i;n++){o=u[n];let D=v.$order,k=l.optgroups[o];k===void 0?o="":D=k.$order;const[M,_]=p(o,D);n>0&&(w=w.cloneNode(!0),oe(w,{id:v.$id+"-clone-"+n,"aria-selected":null}),w.classList.add("ts-cloned"),Be(w,"active"),l.activeOption&&l.activeOption.dataset.value==a&&m&&m.dataset.group===o.toString()&&(y=w)),_.appendChild(w),o!=""&&(C[o]=M)}}l.settings.lockOptgroupOrder&&T.sort((c,a)=>c.order-a.order),f=document.createDocumentFragment(),pe(T,c=>{let a=c.fragment,v=c.optgroup;if(!a||!a.children.length)return;let g=l.optgroups[v];if(g!==void 0){let w=document.createDocumentFragment(),D=l.render("optgroup_header",g);ze(w,D),ze(w,a);let k=l.render("optgroup",{group:g,options:w});ze(f,k)}else ze(f,a)}),x.innerHTML="",ze(x,f),l.settings.highlight&&($a(x),I.query.length&&I.tokens.length&&pe(I.tokens,c=>{Ha(x,c.regex)}));var h=c=>{let a=l.render(c,{input:S});return a&&(O=!0,x.insertBefore(a,x.firstChild)),a};if(l.loading?h("loading"):l.settings.shouldLoad.call(l,S)?I.items.length===0&&h("no_results"):h("not_loading"),d=l.canCreate(S),d&&(b=h("option_create")),l.hasOptions=I.items.length>0||d,O){if(I.items.length>0){if(!y&&l.settings.mode==="single"&&l.items[0]!=null&&(y=l.getOption(l.items[0])),!x.contains(y)){let c=0;b&&!l.settings.addPrecedence&&(c=1),y=l.selectable()[c]}}else b&&(y=b);e&&!l.isOpen&&(l.open(),l.scrollToOption(y,"auto")),l.setActiveOption(y)}else l.clearActiveOption(),e&&l.isOpen&&l.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const i=Me(e[n.settings.valueField]);return i===null||n.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[i]=e,n.lastQuery=null,t&&(n.userOptions[i]=t,n.trigger("option_add",i,e)),i)}addOptions(e,t=!1){pe(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Me(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var i,s;const o=Me(e),u=Me(t[n.settings.valueField]);if(o===null)return;const f=n.options[o];if(f==null)return;if(typeof u!="string")throw new Error("Value must be set in option data");const d=n.getOption(o),m=n.getItem(o);if(t.$order=t.$order||f.$order,delete n.options[o],n.uncacheValue(u),n.options[u]=t,d){if(n.dropdown_content.contains(d)){const b=n._render("option",t);xn(d,b),n.activeOption===d&&n.setActiveOption(b)}d.remove()}m&&(s=n.items.indexOf(o),s!==-1&&n.items.splice(s,1,u),i=n._render("item",t),m.classList.contains("active")&&Te(i,"active"),xn(m,i)),n.lastQuery=null}removeOption(e,t){const n=this;e=Rt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};pe(this.options,(i,s)=>{t(i,s)&&(n[s]=i)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Me(e);if(n===null)return null;const i=this.options[n];if(i!=null){if(i.$div)return i.$div;if(t)return this._render("option",i)}return null}getAdjacent(e,t,n="option"){var i=this,s;if(!e)return null;n=="item"?s=i.controlChildren():s=i.dropdown_content.querySelectorAll("[data-selectable]");for(let o=0;o<s.length;o++)if(s[o]==e)return t>0?s[o+1]:s[o-1];return null}getItem(e){if(typeof e=="object")return e;var t=Me(e);return t!==null?this.control.querySelector(`[data-value="${ur(t)}"]`):null}addItems(e,t){var n=this,i=Array.isArray(e)?e:[e];i=i.filter(o=>n.items.indexOf(o)===-1);const s=i[i.length-1];i.forEach(o=>{n.isPending=o!==s,n.addItem(o,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];lr(this,n,()=>{var i,s;const o=this,u=o.settings.mode,f=Me(e);if(!(f&&o.items.indexOf(f)!==-1&&(u==="single"&&o.close(),u==="single"||!o.settings.duplicates))&&!(f===null||!o.options.hasOwnProperty(f))&&(u==="single"&&o.clear(t),!(u==="multi"&&o.isFull()))){if(i=o._render("item",o.options[f]),o.control.contains(i)&&(i=i.cloneNode(!0)),s=o.isFull(),o.items.splice(o.caretPos,0,f),o.insertAtCaret(i),o.isSetup){if(!o.isPending&&o.settings.hideSelected){let d=o.getOption(f),m=o.getAdjacent(d,1);m&&o.setActiveOption(m)}!o.isPending&&!o.settings.closeAfterSelect&&o.refreshOptions(o.isFocused&&u!=="single"),o.settings.closeAfterSelect!=!1&&o.isFull()?o.close():o.isPending||o.positionDropdown(),o.trigger("item_add",f,i),o.isPending||o.updateOriginalInput({silent:t})}(!o.isPending||!s&&o.isFull())&&(o.inputState(),o.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var i,s;const o=e.dataset.value;i=fr(e),e.remove(),e.classList.contains("active")&&(s=n.activeItems.indexOf(e),n.activeItems.splice(s,1),Be(e,"active")),n.items.splice(i,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(o)&&n.removeOption(o,t),i<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",o,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,i=n.caretPos,s;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var o=!1,u=f=>{if(n.unlock(),!f||typeof f!="object")return t();var d=Me(f[n.settings.valueField]);if(typeof d!="string")return t();n.setTextboxValue(),n.addOption(f,!0),n.setCaret(i),n.addItem(d),t(f),o=!0};return typeof n.settings.create=="function"?s=n.settings.create.call(this,e,u):s={[n.settings.labelField]:e,[n.settings.valueField]:e},o||u(s),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",n),i.toggle("full",t),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",Ba(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,i;const s=t.input.querySelector('option[value=""]');if(t.is_select_tag){let o=function(d,m,b){return d||(d=Ne('<option value="'+un(m)+'">'+un(b)+"</option>")),d!=s&&t.input.append(d),u.push(d),(d!=s||f>0)&&(d.selected=!0),d};const u=[],f=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(d=>{d.selected=!1}),t.items.length==0&&t.settings.mode=="single"?o(s,"",""):t.items.forEach(d=>{if(n=t.options[d],i=n[t.settings.labelField]||"",u.includes(n.$option)){const m=t.input.querySelector(`option[value="${ur(d)}"]:not(:checked)`);o(m,d,i)}else n.$option=o(n.$option,d,i)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,oe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),vt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),vt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,oe(t.focus_node,{"aria-expanded":"false"}),vt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,i=t.left+window.scrollX;vt(this.dropdown,{width:t.width+"px",top:n+"px",left:i+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();pe(n,i=>{t.removeItem(i,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,i=t.control;i.insertBefore(e,i.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,i,s,o=this;t=e&&e.keyCode===dr?-1:1,n=ja(o.control_input);const u=[];if(o.activeItems.length)s=cr(o.activeItems,t),i=fr(s),t>0&&i++,pe(o.activeItems,f=>u.push(f));else if((o.isFocused||o.settings.mode==="single")&&o.items.length){const f=o.controlChildren();let d;t<0&&n.start===0&&n.length===0?d=f[o.caretPos-1]:t>0&&n.start===o.inputValue().length&&(d=f[o.caretPos]),d!==void 0&&u.push(d)}if(!o.shouldDelete(u,e))return!1;for(ce(e,!0),typeof i<"u"&&o.setCaret(i);u.length;)o.removeItem(u.pop());return o.inputState(),o.positionDropdown(),o.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(i=>i.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,i,s=this;s.rtl&&(e*=-1),!s.inputValue().length&&(Ve(mt,t)||Ve("shiftKey",t)?(n=s.getLastActive(e),n?n.classList.contains("active")?i=s.getAdjacent(n,e,"item"):i=n:e>0?i=s.control_input.nextElementSibling:i=s.control_input.previousElementSibling,i&&(i.classList.contains("active")&&s.removeActiveItem(n),s.setActiveItemClass(i))):s.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return cr(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,Be(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,i;const s=this;if(typeof this.settings.render[e]!="function"||(i=s.settings.render[e].call(this,t,un),!i))return null;if(i=Ne(i),e==="option"||e==="option_create"?t[s.settings.disabledField]?oe(i,{"aria-disabled":"true"}):oe(i,{"data-selectable":""}):e==="optgroup"&&(n=t.group[s.settings.optgroupValueField],oe(i,{"data-group":n}),t.group[s.settings.disabledField]&&oe(i,{"data-disabled":""})),e==="option"||e==="item"){const o=Rt(t[s.settings.valueField]);oe(i,{"data-value":o}),e==="item"?(Te(i,s.settings.itemClass),oe(i,{"data-ts-item":""})):(Te(i,s.settings.optionClass),oe(i,{role:"option",id:t.$id}),t.$div=i,s.options[o]=t)}return i}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){pe(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var i=this,s=i[t];i[t]=function(){var o,u;return e==="after"&&(o=s.apply(i,arguments)),u=n.apply(i,arguments),e==="instead"?u:(e==="before"&&(o=s.apply(i,arguments)),o)}}}const Xa=(r,e,t,n)=>{r.addEventListener(e,t,n)};function Za(){Xa(this.input,"change",()=>{this.sync()})}const el=r=>typeof r>"u"||r===null?null:tl(r),tl=r=>typeof r=="boolean"?r?"1":"0":r+"",mr=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},nl=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(rl(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},rl=r=>typeof r=="string"&&r.indexOf("<")>-1;function il(r){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},r);var i=function(o,u){u?(o.checked=!0,n.uncheckedClassNames&&o.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&o.classList.add(...n.checkedClassNames)):(o.checked=!1,n.checkedClassNames&&o.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&o.classList.add(...n.uncheckedClassNames))},s=function(o){setTimeout(()=>{var u=o.querySelector("input."+n.className);u instanceof HTMLInputElement&&i(u,o.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var o=e.settings.render.option;e.settings.render.option=(u,f)=>{var d=nl(o.call(e,u,f)),m=document.createElement("input");n.className&&m.classList.add(n.className),m.addEventListener("click",function(C){mr(C)}),m.type="checkbox";const b=el(u[e.settings.valueField]);return i(m,!!(b&&e.items.indexOf(b)>-1)),d.prepend(m),d}}),e.on("item_remove",o=>{var u=e.getOption(o);u&&(u.classList.remove("selected"),s(u))}),e.on("item_add",o=>{var u=e.getOption(o);u&&s(u)}),e.hook("instead","onOptionSelect",(o,u)=>{if(u.classList.contains("selected")){u.classList.remove("selected"),e.removeItem(u.dataset.value),e.refreshOptions(),mr(o,!0);return}t.call(e,o,u),s(u)})}const ol=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(sl(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},sl=r=>typeof r=="string"&&r.indexOf("<")>-1;function al(r){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},r);e.on("initialize",()=>{var n=ol(t.html(t));n.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(n)})}const ll=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ye=(r,e,t,n)=>{r.addEventListener(e,t,n)},ul=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},cl=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(fl(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},fl=r=>typeof r=="string"&&r.indexOf("<")>-1,dl=(r,e)=>{ul(e,(t,n)=>{t==null?r.removeAttribute(n):r.setAttribute(n,""+t)})},hl=(r,e)=>{var t;(t=r.parentNode)==null||t.insertBefore(e,r.nextSibling)},pl=(r,e)=>{var t;(t=r.parentNode)==null||t.insertBefore(e,r)},gl=(r,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,r==e)return!0}while(e&&e.previousElementSibling);return!1};function vl(){var r=this;if(r.settings.mode!=="multi")return;var e=r.lock,t=r.unlock;let n=!0,i;r.hook("after","setupTemplates",()=>{var s=r.settings.render.item;r.settings.render.item=(o,u)=>{const f=cl(s.call(r,o,u));dl(f,{draggable:"true"});const d=S=>{n||ll(S),S.stopPropagation()},m=S=>{i=f,setTimeout(()=>{f.classList.add("ts-dragging")},0)},b=S=>{S.preventDefault(),f.classList.add("ts-drag-over"),T(f,i)},C=()=>{f.classList.remove("ts-drag-over")},T=(S,R)=>{R!==void 0&&(gl(R,f)?hl(S,R):pl(S,R))},l=()=>{var S;document.querySelectorAll(".ts-drag-over").forEach(I=>I.classList.remove("ts-drag-over")),(S=i)==null||S.classList.remove("ts-dragging"),i=void 0;var R=[];r.control.querySelectorAll("[data-value]").forEach(I=>{if(I.dataset.value){let y=I.dataset.value;y&&R.push(y)}}),r.setValue(R)};return Ye(f,"mousedown",d),Ye(f,"dragstart",m),Ye(f,"dragenter",b),Ye(f,"dragover",b),Ye(f,"dragleave",C),Ye(f,"dragend",l),f}}),r.hook("instead","lock",()=>(n=!1,e.call(r))),r.hook("instead","unlock",()=>(n=!0,t.call(r)))}const ml=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},yl=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(bl(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},bl=r=>typeof r=="string"&&r.indexOf("<")>-1;function Ol(r){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},r);e.on("initialize",()=>{var n=yl(t.html(t)),i=n.querySelector("."+t.closeClass);i&&i.addEventListener("click",s=>{ml(s,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}const Cl=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},wl=(r,...e)=>{var t=Al(e);r=Sl(r),r.map(n=>{t.map(i=>{n.classList.remove(i)})})},Al=r=>{var e=[];return Cl(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Sl=r=>(Array.isArray(r)||(r=[r]),r),El=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var t=0;r=r.previousElementSibling;)r.matches(e)&&t++;return t};function Rl(){var r=this;r.hook("instead","setCaret",e=>{r.settings.mode==="single"||!r.control.contains(r.control_input)?e=r.items.length:(e=Math.max(0,Math.min(r.items.length,e)),e!=r.caretPos&&!r.isPending&&r.controlChildren().forEach((t,n)=>{n<e?r.control_input.insertAdjacentElement("beforebegin",t):r.control.appendChild(t)})),r.caretPos=e}),r.hook("instead","moveCaret",e=>{if(!r.isFocused)return;const t=r.getLastActive(e);if(t){const n=El(t);r.setCaret(e>0?n+1:n),r.setActiveItem(),wl(t,"last-active")}else r.setCaret(r.caretPos+e)})}const Tl=27,Il=9,xl=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},_l=(r,e,t,n)=>{r.addEventListener(e,t,n)},Pl=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},yr=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Ml(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Ml=r=>typeof r=="string"&&r.indexOf("<")>-1,Ll=(r,...e)=>{var t=kl(e);r=Dl(r),r.map(n=>{t.map(i=>{n.classList.add(i)})})},kl=r=>{var e=[];return Pl(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Dl=r=>(Array.isArray(r)||(r=[r]),r);function Nl(){const r=this;r.settings.shouldOpen=!0,r.hook("before","setup",()=>{r.focus_node=r.control,Ll(r.control_input,"dropdown-input");const e=yr('<div class="dropdown-input-wrap">');e.append(r.control_input),r.dropdown.insertBefore(e,r.dropdown.firstChild);const t=yr('<input class="items-placeholder" tabindex="-1" />');t.placeholder=r.settings.placeholder||"",r.control.append(t)}),r.on("initialize",()=>{r.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case Tl:r.isOpen&&(xl(t,!0),r.close()),r.clearActiveItems();return;case Il:r.focus_node.tabIndex=-1;break}return r.onKeyDown.call(r,t)}),r.on("blur",()=>{r.focus_node.tabIndex=r.isDisabled?-1:r.tabIndex}),r.on("dropdown_open",()=>{r.control_input.focus()});const e=r.onBlur;r.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==r.control_input))return e.call(r)}),_l(r.control_input,"blur",()=>r.onBlur()),r.hook("before","close",()=>{r.isOpen&&r.focus_node.focus({preventScroll:!0})})})}const yt=(r,e,t,n)=>{r.addEventListener(e,t,n)};function Fl(){var r=this;r.on("initialize",()=>{var e=document.createElement("span"),t=r.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",r.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const s of n)e.style[s]=t.style[s];var i=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};i(),r.on("update item_add item_remove",i),yt(t,"input",i),yt(t,"keyup",i),yt(t,"blur",i),yt(t,"update",i)})}function jl(){var r=this,e=r.deleteSelection;this.hook("instead","deleteSelection",t=>r.activeItems.length?e.call(r,t):!1)}function Ul(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const br=37,Bl=39,Hl=(r,e,t)=>{for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},$l=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var t=0;r=r.previousElementSibling;)r.matches(e)&&t++;return t};function Gl(){var r=this,e=r.onKeyDown;r.hook("instead","onKeyDown",t=>{var n,i,s,o;if(!r.isOpen||!(t.keyCode===br||t.keyCode===Bl))return e.call(r,t);r.ignoreHover=!0,o=Hl(r.activeOption,"[data-group]"),n=$l(r.activeOption,"[data-selectable]"),o&&(t.keyCode===br?o=o.previousSibling:o=o.nextSibling,o&&(s=o.querySelectorAll("[data-selectable]"),i=s[Math.min(s.length-1,n)],i&&r.setActiveOption(i)))})}const Vl=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Or=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Cr=(r,e,t,n)=>{r.addEventListener(e,t,n)},wr=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(zl(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},zl=r=>typeof r=="string"&&r.indexOf("<")>-1;function Wl(r){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},r);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Vl(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var i=t.settings.render.item;t.settings.render.item=(s,o)=>{var u=wr(i.call(t,s,o)),f=wr(n);return u.appendChild(f),Cr(f,"mousedown",d=>{Or(d,!0)}),Cr(f,"click",d=>{t.isLocked||(Or(d,!0),!t.isLocked&&t.shouldDelete([u],d)&&(t.removeItem(u),t.refreshOptions(!1),t.inputState()))}),u}})}}function ql(r){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},r);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[n];i&&e.setTextboxValue(t.text.call(e,i))}})}const Kl=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},Jl=(r,...e)=>{var t=Ql(e);r=Yl(r),r.map(n=>{t.map(i=>{n.classList.add(i)})})},Ql=r=>{var e=[];return Kl(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Yl=r=>(Array.isArray(r)||(r=[r]),r);function Xl(){const r=this,e=r.canLoad,t=r.clearActiveOption,n=r.loadCallback;var i={},s,o=!1,u,f=[];if(r.settings.shouldLoadMore||(r.settings.shouldLoadMore=()=>{if(s.clientHeight/(s.scrollHeight-s.scrollTop)>.9)return!0;if(r.activeOption){var b=r.selectable(),C=Array.from(b).indexOf(r.activeOption);if(C>=b.length-2)return!0}return!1}),!r.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";r.settings.sortField=[{field:"$order"},{field:"$score"}];const d=b=>typeof r.settings.maxOptions=="number"&&s.children.length>=r.settings.maxOptions?!1:!!(b in i&&i[b]),m=(b,C)=>r.items.indexOf(C)>=0||f.indexOf(C)>=0;r.setNextUrl=(b,C)=>{i[b]=C},r.getUrl=b=>{if(b in i){const C=i[b];return i[b]=!1,C}return r.clearPagination(),r.settings.firstUrl.call(r,b)},r.clearPagination=()=>{i={}},r.hook("instead","clearActiveOption",()=>{if(!o)return t.call(r)}),r.hook("instead","canLoad",b=>b in i?d(b):e.call(r,b)),r.hook("instead","loadCallback",(b,C)=>{if(!o)r.clearOptions(m);else if(u){const T=b[0];T!==void 0&&(u.dataset.value=T[r.settings.valueField])}n.call(r,b,C),o=!1}),r.hook("after","refreshOptions",()=>{const b=r.lastValue;var C;d(b)?(C=r.render("loading_more",{query:b}),C&&(C.setAttribute("data-selectable",""),u=C)):b in i&&!s.querySelector(".no-results")&&(C=r.render("no_more_results",{query:b})),C&&(Jl(C,r.settings.optionClass),s.append(C))}),r.on("initialize",()=>{f=Object.keys(r.options),s=r.dropdown_content,r.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},r.settings.render),s.addEventListener("scroll",()=>{r.settings.shouldLoadMore.call(r)&&d(r.lastValue)&&(o||(o=!0,r.load.call(r,r.lastValue)))})})}we.define("change_listener",Za);we.define("checkbox_options",il);we.define("clear_button",al);we.define("drag_drop",vl);we.define("dropdown_header",Ol);we.define("caret_position",Rl);we.define("dropdown_input",Nl);we.define("input_autogrow",Fl);we.define("no_backspace_delete",jl);we.define("no_active_items",Ul);we.define("optgroup_columns",Gl);we.define("remove_button",Wl);we.define("restore_on_backspace",ql);we.define("virtual_scroll",Xl);const Zl=r=>({init(){const e=this.$refs[`select_picker_${r.dataField}_${r.tableName}`],t={items:r.initialValues,...r.framework,onChange:s=>{Oi(r,s)},onInitialize:()=>{window.addEventListener(`pg:clear_multi_select::${r.tableName}:${r.dataField}`,()=>{e&&e.tomselect.clear(!0)}),window.addEventListener(`pg:clear_all_multi_select::${r.tableName}`,()=>{e&&e.tomselect.clear(!0)})}},n={valueField:r.optionValue,labelField:r.optionLabel,searchField:r.optionLabel,load:async function(s,o){function u(f,d){var m;const{method:b,url:C}=f,T=new Request(C,{method:b,body:b.toLowerCase()==="post"?JSON.stringify({search:d,...i}):void 0});T.headers.set("Content-Type","application/json"),T.headers.set("Accept","application/json"),T.headers.set("X-Requested-With","XMLHttpRequest");const l=(m=document.head.querySelector('[name="csrf-token"]'))==null?void 0:m.getAttribute("content");return l&&T.headers.set("X-CSRF-TOKEN",l),T}fetch(u(r.asyncData,s)).then(f=>f.json()).then(f=>{o(f)}).catch(()=>{o()})},render:{option:function(s,o){return`<div class="py-2 mb-1"><span>${o(s[r.optionLabel])}</span></div>`},item:function(s,o){return`<div class="py-2 mb-1"><span>${o(s[r.optionLabel])}</span></div>`}}};let i=t;r.hasOwnProperty("asyncData")&&(i=Object.assign(t,n)),new we(e,i)}}),eu=r=>({initialValues:r.initialValues,framework:r.framework,init(){const e=this.$refs["select_picker_"+r.dataField+"_"+r.tableName],t=this.deepCopy(this.framework);new window.SlimSelect({select:e,...t,events:{afterChange:n=>{let i=n.map(s=>s.value);Oi(r,i)}}})},deepCopy(e){if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(this.deepCopy);const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=this.deepCopy(e[n]));return t}}),tu=()=>({init(){Livewire.on("pg:scrollTop",r=>{setTimeout(()=>{document.querySelector("body").scrollIntoView({behavior:"auto"})},0)}),new IntersectionObserver(r=>{r[0].isIntersecting&&this.$wire.call("loadMore")},{rootMargin:"300px"}).observe(this.$el)}}),nu=r=>({rowId:(r==null?void 0:r.rowId)??null,parentId:(r==null?void 0:r.parentId)??null,toHtml(){let e=null;const t=this.parentId??this.$wire.id;if(this.rowId){const i=window[`pgActions_${t}`];i&&i[this.rowId]!==void 0&&(e=i[this.rowId])}else e=window[`pgActionsHeader_${t}`];if(typeof e!="object"||e===null)return"";let n="";return e.forEach(i=>{let s=this.shouldHideAction(i),o=this.getReplaceHtml(i);if(!s)if(o)n+=o;else{let u=this.buildAttributesString(i);if(i.icon){let f=this.processIcon(i);if(!f)return;n+=this.buildActionHtmlWithIcon(i,u,f)}else n+=this.buildActionHtml(i,u)}}),n},shouldHideAction(e){if(e.can===!1)return!0;let t=!1;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(n=>{n.action.includes(e.action)&&n.apply&&n.rule.hide&&(t=!0)}),t},getReplaceHtml(e){let t=null;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(n=>{n.apply&&n.action.includes(e.action)&&n.replaceHtml&&(t=n.replaceHtml)}),t},buildAttributesString(e){let t=e.attributes??[];return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(n=>{n.apply&&n.action.includes(e.action)&&n.rule.setAttribute&&n.rule.setAttribute.length>0&&Object.values(n.rule.setAttribute).forEach(i=>{t[i.attribute]=i.value})}),Object.entries(t).map(([n,i])=>` ${n}="${i}"`).join("")},processIcon(e){const t=Object.entries(e.iconAttributes??[]).map(([i,s])=>` ${i}="${s}"`).join("");let n=window.pgResourceIcons[e.icon];return typeof n>"u"?(console.warn(`PowerGrid: Unable to load icons in javascript window in row: [${this.rowId}]`),null):this.replaceIconAttributes(n,t)},replaceIconAttributes(e,t){return e.replace(/<([^\s>]+)([^>]*)>/,(n,i,s)=>{let o=s.trim();const u=t.replace(/class="([^"]*)"/,(f,d)=>(o.includes("class=")?o=o.replace(/class="([^"]*)"/,(m,b)=>`class="${b} ${d.trim()}"`):o+=` ${f}`,""));return`<${i} ${o} ${u}>`})},buildActionHtmlWithIcon(e,t,n){return e.slot?`<${e.tag??"button"} ${t}>${n} ${e.slot}</${e.tag??"button"}>`:`<${e.tag??"button"} ${t}>${n}</${e.tag??"button"}>`},buildActionHtml(e,t){return`<${e.tag??"button"} ${t}>${e.slot}</${e.tag??"button"}>`}}),ru=r=>({templateContent:(r==null?void 0:r.templateContent)??null,rendered:null,parentId:(r==null?void 0:r.parentId)??null,init(){const e=Object.keys(this.templateContent)[0],t=window[`pgRowTemplates_${this.parentId??this.$wire.id}`][e],n=this.templateContent[e];if(n){let i=t;for(const[s,o]of Object.entries(n)){const u=`{{ ${s} }}`,f=String(o).replace(/'/g,"\\'");i=i.replaceAll(u,f)}this.rendered=i}}}),iu=r=>({rowId:r.rowId,rules:r.rules,defaultClasses:r.defaultClasses,attributes:[],theme:[],init(){this.rules&&Object.values(this.rules).forEach(e=>{(e.applyLoop||e.apply)&&e!=null&&e.attributes&&this.attributes.push(e.attributes)})},getAttributes(){let e={class:this.defaultClasses};return this.attributes.forEach(t=>{Object.keys(t).forEach(n=>{e[n]+=e[n]?` ${t[n]}`:t[n]})}),e}});window.pgToggleable=na;window.pgFlatpickr=ia;window.pgEditable=oa;window.pgResponsive=da;window.pgTomSelect=Zl;window.pgSlimSelect=eu;window.pgLoadMore=tu;window.pgRenderActions=nu;window.pgRowAttributes=iu;window.pgRenderRowTemplate=ru;document.addEventListener("DOMContentLoaded",()=>{Livewire.hook("commit",({component:r,succeed:e,fail:t})=>{r.ephemeral.setUp&&r.ephemeral.setUp.hasOwnProperty("responsive")&&(e(()=>{queueMicrotask(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))})}),t(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))}))})});document.addEventListener("DOMContentLoaded",()=>{window.Alpine.directive("multisort-shift-click",(r,{expression:e})=>{r.addEventListener("click",t=>{window.Livewire.find(e).set("multiSort",t.shiftKey)})})});var Ii={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(dt,function(){var t=1e3,n=6e4,i=36e5,s="millisecond",o="second",u="minute",f="hour",d="day",m="week",b="month",C="quarter",T="year",l="date",S="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var _=["th","st","nd","rd"],A=M%100;return"["+M+(_[(A-20)%10]||_[A]||_[0])+"]"}},O=function(M,_,A){var E=String(M);return!E||E.length>=_?M:""+Array(_+1-E.length).join(A)+M},x={s:O,z:function(M){var _=-M.utcOffset(),A=Math.abs(_),E=Math.floor(A/60),L=A%60;return(_<=0?"+":"-")+O(E,2,"0")+":"+O(L,2,"0")},m:function M(_,A){if(_.date()<A.date())return-M(A,_);var E=12*(A.year()-_.year())+(A.month()-_.month()),L=_.clone().add(E,b),F=A-L<0,U=_.clone().add(E+(F?-1:1),b);return+(-(E+(A-L)/(F?L-U:U-L))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:b,y:T,w:m,d,D:l,h:f,m:u,s:o,ms:s,Q:C}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},p="en",h={};h[p]=y;var c="$isDayjsObject",a=function(M){return M instanceof D||!(!M||!M[c])},v=function M(_,A,E){var L;if(!_)return p;if(typeof _=="string"){var F=_.toLowerCase();h[F]&&(L=F),A&&(h[F]=A,L=F);var U=_.split("-");if(!L&&U.length>1)return M(U[0])}else{var G=_.name;h[G]=_,L=G}return!E&&L&&(p=L),L||!E&&p},g=function(M,_){if(a(M))return M.clone();var A=typeof _=="object"?_:{};return A.date=M,A.args=arguments,new D(A)},w=x;w.l=v,w.i=a,w.w=function(M,_){return g(M,{locale:_.$L,utc:_.$u,x:_.$x,$offset:_.$offset})};var D=function(){function M(A){this.$L=v(A.locale,null,!0),this.parse(A),this.$x=this.$x||A.x||{},this[c]=!0}var _=M.prototype;return _.parse=function(A){this.$d=function(E){var L=E.date,F=E.utc;if(L===null)return new Date(NaN);if(w.u(L))return new Date;if(L instanceof Date)return new Date(L);if(typeof L=="string"&&!/Z$/i.test(L)){var U=L.match(R);if(U){var G=U[2]-1||0,V=(U[7]||"0").substring(0,3);return F?new Date(Date.UTC(U[1],G,U[3]||1,U[4]||0,U[5]||0,U[6]||0,V)):new Date(U[1],G,U[3]||1,U[4]||0,U[5]||0,U[6]||0,V)}}return new Date(L)}(A),this.init()},_.init=function(){var A=this.$d;this.$y=A.getFullYear(),this.$M=A.getMonth(),this.$D=A.getDate(),this.$W=A.getDay(),this.$H=A.getHours(),this.$m=A.getMinutes(),this.$s=A.getSeconds(),this.$ms=A.getMilliseconds()},_.$utils=function(){return w},_.isValid=function(){return this.$d.toString()!==S},_.isSame=function(A,E){var L=g(A);return this.startOf(E)<=L&&L<=this.endOf(E)},_.isAfter=function(A,E){return g(A)<this.startOf(E)},_.isBefore=function(A,E){return this.endOf(E)<g(A)},_.$g=function(A,E,L){return w.u(A)?this[E]:this.set(L,A)},_.unix=function(){return Math.floor(this.valueOf()/1e3)},_.valueOf=function(){return this.$d.getTime()},_.startOf=function(A,E){var L=this,F=!!w.u(E)||E,U=w.p(A),G=function(J,Q){var X=w.w(L.$u?Date.UTC(L.$y,Q,J):new Date(L.$y,Q,J),L);return F?X:X.endOf(d)},V=function(J,Q){return w.w(L.toDate()[J].apply(L.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(Q)),L)},H=this.$W,P=this.$M,N=this.$D,j="set"+(this.$u?"UTC":"");switch(U){case T:return F?G(1,0):G(31,11);case b:return F?G(1,P):G(0,P+1);case m:var B=this.$locale().weekStart||0,z=(H<B?H+7:H)-B;return G(F?N-z:N+(6-z),P);case d:case l:return V(j+"Hours",0);case f:return V(j+"Minutes",1);case u:return V(j+"Seconds",2);case o:return V(j+"Milliseconds",3);default:return this.clone()}},_.endOf=function(A){return this.startOf(A,!1)},_.$set=function(A,E){var L,F=w.p(A),U="set"+(this.$u?"UTC":""),G=(L={},L[d]=U+"Date",L[l]=U+"Date",L[b]=U+"Month",L[T]=U+"FullYear",L[f]=U+"Hours",L[u]=U+"Minutes",L[o]=U+"Seconds",L[s]=U+"Milliseconds",L)[F],V=F===d?this.$D+(E-this.$W):E;if(F===b||F===T){var H=this.clone().set(l,1);H.$d[G](V),H.init(),this.$d=H.set(l,Math.min(this.$D,H.daysInMonth())).$d}else G&&this.$d[G](V);return this.init(),this},_.set=function(A,E){return this.clone().$set(A,E)},_.get=function(A){return this[w.p(A)]()},_.add=function(A,E){var L,F=this;A=Number(A);var U=w.p(E),G=function(P){var N=g(F);return w.w(N.date(N.date()+Math.round(P*A)),F)};if(U===b)return this.set(b,this.$M+A);if(U===T)return this.set(T,this.$y+A);if(U===d)return G(1);if(U===m)return G(7);var V=(L={},L[u]=n,L[f]=i,L[o]=t,L)[U]||1,H=this.$d.getTime()+A*V;return w.w(H,this)},_.subtract=function(A,E){return this.add(-1*A,E)},_.format=function(A){var E=this,L=this.$locale();if(!this.isValid())return L.invalidDate||S;var F=A||"YYYY-MM-DDTHH:mm:ssZ",U=w.z(this),G=this.$H,V=this.$m,H=this.$M,P=L.weekdays,N=L.months,j=L.meridiem,B=function(Q,X,ee,re){return Q&&(Q[X]||Q(E,F))||ee[X].slice(0,re)},z=function(Q){return w.s(G%12||12,Q,"0")},J=j||function(Q,X,ee){var re=Q<12?"AM":"PM";return ee?re.toLowerCase():re};return F.replace(I,function(Q,X){return X||function(ee){switch(ee){case"YY":return String(E.$y).slice(-2);case"YYYY":return w.s(E.$y,4,"0");case"M":return H+1;case"MM":return w.s(H+1,2,"0");case"MMM":return B(L.monthsShort,H,N,3);case"MMMM":return B(N,H);case"D":return E.$D;case"DD":return w.s(E.$D,2,"0");case"d":return String(E.$W);case"dd":return B(L.weekdaysMin,E.$W,P,2);case"ddd":return B(L.weekdaysShort,E.$W,P,3);case"dddd":return P[E.$W];case"H":return String(G);case"HH":return w.s(G,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return J(G,V,!0);case"A":return J(G,V,!1);case"m":return String(V);case"mm":return w.s(V,2,"0");case"s":return String(E.$s);case"ss":return w.s(E.$s,2,"0");case"SSS":return w.s(E.$ms,3,"0");case"Z":return U}return null}(Q)||U.replace(":","")})},_.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},_.diff=function(A,E,L){var F,U=this,G=w.p(E),V=g(A),H=(V.utcOffset()-this.utcOffset())*n,P=this-V,N=function(){return w.m(U,V)};switch(G){case T:F=N()/12;break;case b:F=N();break;case C:F=N()/3;break;case m:F=(P-H)/6048e5;break;case d:F=(P-H)/864e5;break;case f:F=P/i;break;case u:F=P/n;break;case o:F=P/t;break;default:F=P}return L?F:w.a(F)},_.daysInMonth=function(){return this.endOf(b).$D},_.$locale=function(){return h[this.$L]},_.locale=function(A,E){if(!A)return this.$L;var L=this.clone(),F=v(A,E,!0);return F&&(L.$L=F),L},_.clone=function(){return w.w(this.$d,this)},_.toDate=function(){return new Date(this.valueOf())},_.toJSON=function(){return this.isValid()?this.toISOString():null},_.toISOString=function(){return this.$d.toISOString()},_.toString=function(){return this.$d.toUTCString()},M}(),k=D.prototype;return g.prototype=k,[["$ms",s],["$s",o],["$m",u],["$H",f],["$W",d],["$M",b],["$y",T],["$D",l]].forEach(function(M){k[M[1]]=function(_){return this.$g(_,M[0],M[1])}}),g.extend=function(M,_){return M.$i||(M(_,D,g),M.$i=!0),g},g.locale=v,g.isDayjs=a,g.unix=function(M){return g(1e3*M)},g.en=h[p],g.Ls=h,g.p={},g})})(Ii);var xi=Ii.exports;const jn=Nn(xi);var ou={exports:{}};(function(r,e){(function(t,n){r.exports=n(xi)})(dt,function(t){function n(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var i=n(t),s={name:"id",weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),weekStart:1,formats:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},ordinal:function(o){return o+"."}};return i.default.locale(s,null,!0),s})})(ou);var _i={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(dt,function(){return function(t,n,i){t=t||{};var s=n.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function u(d,m,b,C){return s.fromToBase(d,m,b,C)}i.en.relativeTime=o,s.fromToBase=function(d,m,b,C,T){for(var l,S,R,I=b.$locale().relativeTime||o,y=t.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],O=y.length,x=0;x<O;x+=1){var p=y[x];p.d&&(l=C?i(d).diff(b,p.d,!0):b.diff(d,p.d,!0));var h=(t.rounding||Math.round)(Math.abs(l));if(R=l>0,h<=p.r||!p.r){h<=1&&x>0&&(p=y[x-1]);var c=I[p.l];T&&(h=T(""+h)),S=typeof c=="string"?c.replace("%d",h):c(h,m,p.l,R);break}}if(m)return S;var a=R?I.future:I.past;return typeof a=="function"?a(S):a.replace("%s",S)},s.to=function(d,m){return u(d,m,this,!0)},s.from=function(d,m){return u(d,m,this)};var f=function(d){return d.$u?i.utc():i()};s.toNow=function(d){return this.to(f(this),d)},s.fromNow=function(d){return this.from(f(this),d)}}})})(_i);var su=_i.exports;const au=Nn(su);function hn(r,e){r.split(/\s+/).forEach(t=>{e(t)})}class lu{constructor(){this._events={}}on(e,t){hn(e,n=>{const i=this._events[n]||[];i.push(t),this._events[n]=i})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}hn(e,i=>{if(n===1){delete this._events[i];return}const s=this._events[i];s!==void 0&&(s.splice(s.indexOf(t),1),this._events[i]=s)})}trigger(e,...t){var n=this;hn(e,i=>{const s=n._events[i];s!==void 0&&s.forEach(o=>{o.apply(n,t)})})}}function uu(r){return r.plugins={},class extends r{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){r.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const i=this,s=[];if(Array.isArray(e))e.forEach(o=>{typeof o=="string"?s.push(o):(i.plugins.settings[o.name]=o.options,s.push(o.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(i.plugins.settings[t]=e[t],s.push(t));for(;n=s.shift();)i.require(n)}loadPlugin(e){var t=this,n=t.plugins,i=r.plugins[e];if(!r.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=i.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}const Yt=r=>(r=r.filter(Boolean),r.length<2?r[0]||"":fu(r)==1?"["+r.join("")+"]":"(?:"+r.join("|")+")"),Pi=r=>{if(!cu(r))return r.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return r.forEach((i,s)=>{if(i===r[s-1]){t++;return}n(),e+=i,t=1}),n(),e},Mi=r=>{let e=Array.from(r);return Yt(e)},cu=r=>new Set(r).size!==r.length,ut=r=>(r+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),fu=r=>r.reduce((e,t)=>Math.max(e,du(t)),0),du=r=>Array.from(r).length,Li=r=>{if(r.length===1)return[[r]];let e=[];const t=r.substring(1);return Li(t).forEach(function(i){let s=i.slice(0);s[0]=r.charAt(0)+s[0],e.push(s),s=i.slice(0),s.unshift(r.charAt(0)),e.push(s)}),e},hu=[[0,65535]],pu="[-]";let Nt,ki;const gu=3,Un={},Ar={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let r in Ar){let e=Ar[r]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Un[n]=r}}const vu=new RegExp(Object.keys(Un).join("|")+"|"+pu,"gu"),mu=r=>{Nt===void 0&&(Nt=Cu(hu))},Sr=(r,e="NFKD")=>r.normalize(e),Ft=r=>Array.from(r).reduce((e,t)=>e+yu(t),""),yu=r=>(r=Sr(r).toLowerCase().replace(vu,e=>Un[e]||""),Sr(r,"NFC"));function*bu(r){for(const[e,t]of r)for(let n=e;n<=t;n++){let i=String.fromCharCode(n),s=Ft(i);s!=i.toLowerCase()&&(s.length>gu||s.length!=0&&(yield{folded:s,composed:i,code_point:n}))}}const Ou=r=>{const e={},t=(n,i)=>{const s=e[n]||new Set,o=new RegExp("^"+Mi(s)+"$","iu");i.match(o)||(s.add(ut(i)),e[n]=s)};for(let n of bu(r))t(n.folded,n.folded),t(n.folded,n.composed);return e},Cu=r=>{const e=Ou(r),t={};let n=[];for(let s in e){let o=e[s];o&&(t[s]=Mi(o)),s.length>1&&n.push(ut(s))}n.sort((s,o)=>o.length-s.length);const i=Yt(n);return ki=new RegExp("^"+i,"u"),t},wu=(r,e=1)=>{let t=0;return r=r.map(n=>(Nt[n]&&(t+=n.length),Nt[n]||n)),t>=e?Pi(r):""},Au=(r,e=1)=>(e=Math.max(e,r.length-1),Yt(Li(r).map(t=>wu(t,e)))),Er=(r,e=!0)=>{let t=r.length>1?1:0;return Yt(r.map(n=>{let i=[];const s=e?n.length():n.length()-1;for(let o=0;o<s;o++)i.push(Au(n.substrs[o]||"",t));return Pi(i)}))},Su=(r,e)=>{for(const t of e){if(t.start!=r.start||t.end!=r.end||t.substrs.join("")!==r.substrs.join(""))continue;let n=r.parts;const i=o=>{for(const u of n){if(u.start===o.start&&u.substr===o.substr)return!1;if(!(o.length==1||u.length==1)&&(o.start<u.start&&o.end>u.start||u.start<o.start&&u.end>o.start))return!0}return!1};if(!(t.parts.filter(i).length>0))return!0}return!1};class jt{constructor(){Ge(this,"parts");Ge(this,"substrs");Ge(this,"start");Ge(this,"end");this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new jt,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const f of i)n.add(f);let o=t.substr.substring(0,e-s.start),u=o.length;return n.add({start:s.start,end:s.start+u,length:u,substr:o}),n}}const Eu=r=>{mu(),r=Ft(r);let e="",t=[new jt];for(let n=0;n<r.length;n++){let s=r.substring(n).match(ki);const o=r.substring(n,n+1),u=s?s[0]:null;let f=[],d=new Set;for(const m of t){const b=m.last();if(!b||b.length==1||b.end<=n)if(u){const C=u.length;m.add({start:n,end:n+C,length:C,substr:u}),d.add("1")}else m.add({start:n,end:n+1,length:1,substr:o}),d.add("2");else if(u){let C=m.clone(n,b);const T=u.length;C.add({start:n,end:n+T,length:T,substr:u}),f.push(C)}else d.add("3")}if(f.length>0){f=f.sort((m,b)=>m.length()-b.length());for(let m of f)Su(m,t)||t.push(m);continue}if(n>0&&d.size==1&&!d.has("3")){e+=Er(t,!1);let m=new jt;const b=t[0];b&&m.add(b.last()),t=[m]}}return e+=Er(t,!0),e},Ru=(r,e)=>{if(r)return r[e]},Tu=(r,e)=>{if(r){for(var t,n=e.split(".");(t=n.shift())&&(r=r[t]););return r}},pn=(r,e,t)=>{var n,i;return!r||(r=r+"",e.regex==null)||(i=r.search(e.regex),i===-1)?0:(n=e.string.length/r.length,i===0&&(n+=.5),n*t)},gn=(r,e)=>{var t=r[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(r[e]=[t])},bt=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},Iu=(r,e)=>typeof r=="number"&&typeof e=="number"?r>e?1:r<e?-1:0:(r=Ft(r+"").toLowerCase(),e=Ft(e+"").toLowerCase(),r>e?1:e>r?-1:0);class xu{constructor(e,t){Ge(this,"items");Ge(this,"settings");this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const i=[],s=e.split(/\s+/);var o;return n&&(o=new RegExp("^("+Object.keys(n).map(ut).join("|")+"):(.*)$")),s.forEach(u=>{let f,d=null,m=null;o&&(f=u.match(o))&&(d=f[1],u=f[2]),u.length>0&&(this.settings.diacritics?m=Eu(u)||null:m=ut(u),m&&t&&(m="\\b"+m)),i.push({string:u,regex:m?new RegExp(m,"iu"):null,field:d})}),i}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const i=e.options.fields,s=e.weights,o=i.length,u=e.getAttrFn;if(!o)return function(){return 1};const f=function(){return o===1?function(d,m){const b=i[0].field;return pn(u(m,b),d,s[b]||1)}:function(d,m){var b=0;if(d.field){const C=u(m,d.field);!d.regex&&C?b+=1/o:b+=pn(C,d,1)}else bt(s,(C,T)=>{b+=pn(u(m,T),d,C)});return b/o}}();return n===1?function(d){return f(t[0],d)}:e.options.conjunction==="and"?function(d){var m,b=0;for(let C of t){if(m=f(C,d),m<=0)return 0;b+=m}return b/n}:function(d){var m=0;return bt(t,b=>{m+=f(b,d)}),m/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const i=this,s=e.options,o=!e.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof o=="function")return o.bind(this);const u=function(d,m){return d==="$score"?m.score:e.getAttrFn(i.items[m.id],d)};if(o)for(let d of o)(e.query||d.field!=="$score")&&n.push(d);if(e.query){t=!0;for(let d of n)if(d.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(d=>d.field!=="$score");return n.length?function(d,m){var b,C;for(let T of n)if(C=T.field,b=(T.direction==="desc"?-1:1)*Iu(u(C,d),u(C,m)),b)return b;return 0}:null}prepareSearch(e,t){const n={};var i=Object.assign({},t);if(gn(i,"sort"),gn(i,"sort_empty"),i.fields){gn(i,"fields");const s=[];i.fields.forEach(o=>{typeof o=="string"&&(o={field:o,weight:1}),s.push(o),n[o.field]="weight"in o?o.weight:1}),i.fields=s}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:i.nesting?Tu:Ru}}search(e,t){var n=this,i,s;s=this.prepareSearch(e,t),t=s.options,e=s.query;const o=t.score||n._getScoreFunction(s);e.length?bt(n.items,(f,d)=>{i=o(f),(t.filter===!1||i>0)&&s.items.push({score:i,id:d})}):bt(n.items,(f,d)=>{s.items.push({score:1,id:d})});const u=n._getSortFunction(s);return u&&s.items.sort(u),s.total=s.items.length,typeof t.limit=="number"&&(s.items=s.items.slice(0,t.limit)),s}}const Le=r=>typeof r>"u"||r===null?null:Tt(r),Tt=r=>typeof r=="boolean"?r?"1":"0":r+"",vn=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),_u=(r,e)=>e>0?window.setTimeout(r,e):(r.call(null),null),Pu=(r,e)=>{var t;return function(n,i){var s=this;t&&(s.loading=Math.max(s.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,s.loadedSearches[n]=!0,r.call(s,n,i)},e)}},Rr=(r,e,t)=>{var n,i=r.trigger,s={};r.trigger=function(){var o=arguments[0];if(e.indexOf(o)!==-1)s[o]=arguments;else return i.apply(r,arguments)},t.apply(r,[]),r.trigger=i;for(n of e)n in s&&i.apply(r,s[n])},Mu=r=>({start:r.selectionStart||0,length:(r.selectionEnd||0)-(r.selectionStart||0)}),ue=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ce=(r,e,t,n)=>{r.addEventListener(e,t,n)},We=(r,e)=>{if(!e||!e[r])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},mn=(r,e)=>{const t=r.getAttribute("id");return t||(r.setAttribute("id",e),e)},Tr=r=>r.replace(/[\\"']/g,"\\$&"),qe=(r,e)=>{e&&r.append(e)},ge=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},Fe=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Di(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Di=r=>typeof r=="string"&&r.indexOf("<")>-1,Lu=r=>r.replace(/['"\\]/g,"\\$&"),yn=(r,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),r.dispatchEvent(t)},Ot=(r,e)=>{Object.assign(r.style,e)},Ie=(r,...e)=>{var t=Ni(e);r=Fi(r),r.map(n=>{t.map(i=>{n.classList.add(i)})})},He=(r,...e)=>{var t=Ni(e);r=Fi(r),r.map(n=>{t.map(i=>{n.classList.remove(i)})})},Ni=r=>{var e=[];return ge(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Fi=r=>(Array.isArray(r)||(r=[r]),r),bn=(r,e,t)=>{if(!(t&&!t.contains(r)))for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},Ir=(r,e=0)=>e>0?r[r.length-1]:r[0],ku=r=>Object.keys(r).length===0,xr=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var t=0;r=r.previousElementSibling;)r.matches(e)&&t++;return t},se=(r,e)=>{ge(e,(t,n)=>{t==null?r.removeAttribute(n):r.setAttribute(n,""+t)})},_n=(r,e)=>{r.parentNode&&r.parentNode.replaceChild(e,r)},Du=(r,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=s=>{var o=s.data.match(e);if(o&&s.data.length>0){var u=document.createElement("span");u.className="highlight";var f=s.splitText(o.index);f.splitText(o[0].length);var d=f.cloneNode(!0);return u.appendChild(d),_n(f,u),1}return 0},n=s=>{s.nodeType===1&&s.childNodes&&!/(script|style)/i.test(s.tagName)&&(s.className!=="highlight"||s.tagName!=="SPAN")&&Array.from(s.childNodes).forEach(o=>{i(o)})},i=s=>s.nodeType===3?t(s):(n(s),0);i(r)},Nu=r=>{var e=r.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Fu=65,ju=13,Uu=27,Bu=37,Hu=38,$u=39,Gu=40,_r=8,Vu=46,Pr=9,zu=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Ct=zu?"metaKey":"ctrlKey",Mr={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(r){return r.length>0},render:{}};function Lr(r,e){var t=Object.assign({},Mr,e),n=t.dataAttr,i=t.labelField,s=t.valueField,o=t.disabledField,u=t.optgroupField,f=t.optgroupLabelField,d=t.optgroupValueField,m=r.tagName.toLowerCase(),b=r.getAttribute("placeholder")||r.getAttribute("data-placeholder");if(!b&&!t.allowEmptyOption){let S=r.querySelector('option[value=""]');S&&(b=S.textContent)}var C={placeholder:b,options:[],optgroups:[],items:[],maxItems:null},T=()=>{var S,R=C.options,I={},y=1;let O=0;var x=c=>{var a=Object.assign({},c.dataset),v=n&&a[n];return typeof v=="string"&&v.length&&(a=Object.assign(a,JSON.parse(v))),a},p=(c,a)=>{var v=Le(c.value);if(v!=null&&!(!v&&!t.allowEmptyOption)){if(I.hasOwnProperty(v)){if(a){var g=I[v][u];g?Array.isArray(g)?g.push(a):I[v][u]=[g,a]:I[v][u]=a}}else{var w=x(c);w[i]=w[i]||c.textContent,w[s]=w[s]||v,w[o]=w[o]||c.disabled,w[u]=w[u]||a,w.$option=c,w.$order=w.$order||++O,I[v]=w,R.push(w)}c.selected&&C.items.push(v)}},h=c=>{var a,v;v=x(c),v[f]=v[f]||c.getAttribute("label")||"",v[d]=v[d]||y++,v[o]=v[o]||c.disabled,v.$order=v.$order||++O,C.optgroups.push(v),a=v[d],ge(c.children,g=>{p(g,a)})};C.maxItems=r.hasAttribute("multiple")?null:1,ge(r.children,c=>{S=c.tagName.toLowerCase(),S==="optgroup"?h(c):S==="option"&&p(c)})},l=()=>{const S=r.getAttribute(n);if(S)C.options=JSON.parse(S),ge(C.options,I=>{C.items.push(I[s])});else{var R=r.value.trim()||"";if(!t.allowEmptyOption&&!R.length)return;const I=R.split(t.delimiter);ge(I,y=>{const O={};O[i]=y,O[s]=y,C.options.push(O)}),C.items=I}};return m==="select"?T():l(),Object.assign({},Mr,C,e)}var kr=0;class Ae extends uu(lu){constructor(e,t){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,kr++;var n,i=Fe(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s=window.getComputedStyle&&window.getComputedStyle(i,null);n=s.getPropertyValue("direction");const o=Lr(i,t);this.settings=o,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=mn(i,"tomselect-"+kr),this.isRequired=i.required,this.sifter=new xu(this.options,{diacritics:o.diacritics}),o.mode=o.mode||(o.maxItems===1?"single":"multi"),typeof o.hideSelected!="boolean"&&(o.hideSelected=o.mode==="multi"),typeof o.hidePlaceholder!="boolean"&&(o.hidePlaceholder=o.mode!=="multi");var u=o.createFilter;typeof u!="function"&&(typeof u=="string"&&(u=new RegExp(u)),u instanceof RegExp?o.createFilter=R=>u.test(R):o.createFilter=R=>this.settings.duplicates||!this.options[R]),this.initializePlugins(o.plugins),this.setupCallbacks(),this.setupTemplates();const f=Fe("<div>"),d=Fe("<div>"),m=this._render("dropdown"),b=Fe('<div role="listbox" tabindex="-1">'),C=this.input.getAttribute("class")||"",T=o.mode;var l;if(Ie(f,o.wrapperClass,C,T),Ie(d,o.controlClass),qe(f,d),Ie(m,o.dropdownClass,T),o.copyClassesToDropdown&&Ie(m,C),Ie(b,o.dropdownContentClass),qe(m,b),Fe(o.dropdownParent||f).appendChild(m),Di(o.controlInput)){l=Fe(o.controlInput);var S=["autocorrect","autocapitalize","autocomplete","spellcheck"];ge(S,R=>{i.getAttribute(R)&&se(l,{[R]:i.getAttribute(R)})}),l.tabIndex=-1,d.appendChild(l),this.focus_node=l}else o.controlInput?(l=Fe(o.controlInput),this.focus_node=l):(l=Fe("<input/>"),this.focus_node=d);this.wrapper=f,this.dropdown=m,this.dropdown_content=b,this.control=d,this.control_input=l,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,i=e.dropdown,s=e.dropdown_content,o=e.wrapper,u=e.control,f=e.input,d=e.focus_node,m={passive:!0},b=e.inputId+"-ts-dropdown";se(s,{id:b}),se(d,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":b});const C=mn(d,e.inputId+"-ts-control"),T="label[for='"+Lu(e.inputId)+"']",l=document.querySelector(T),S=e.focus.bind(e);if(l){Ce(l,"click",S),se(l,{for:C});const y=mn(l,e.inputId+"-ts-label");se(d,{"aria-labelledby":y}),se(s,{"aria-labelledby":y})}if(o.style.width=f.style.width,e.plugins.names.length){const y="plugin-"+e.plugins.names.join(" plugin-");Ie([o,i],y)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&se(f,{multiple:"multiple"}),t.placeholder&&se(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+ut(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Pu(t.load,t.loadThrottle)),Ce(i,"mousemove",()=>{e.ignoreHover=!1}),Ce(i,"mouseenter",y=>{var O=bn(y.target,"[data-selectable]",i);O&&e.onOptionHover(y,O)},{capture:!0}),Ce(i,"click",y=>{const O=bn(y.target,"[data-selectable]");O&&(e.onOptionSelect(y,O),ue(y,!0))}),Ce(u,"click",y=>{var O=bn(y.target,"[data-ts-item]",u);if(O&&e.onItemSelect(y,O)){ue(y,!0);return}n.value==""&&(e.onClick(),ue(y,!0))}),Ce(d,"keydown",y=>e.onKeyDown(y)),Ce(n,"keypress",y=>e.onKeyPress(y)),Ce(n,"input",y=>e.onInput(y)),Ce(d,"blur",y=>e.onBlur(y)),Ce(d,"focus",y=>e.onFocus(y)),Ce(n,"paste",y=>e.onPaste(y));const R=y=>{const O=y.composedPath()[0];if(!o.contains(O)&&!i.contains(O)){e.isFocused&&e.blur(),e.inputState();return}O==n&&e.isOpen?y.stopPropagation():ue(y,!0)},I=()=>{e.isOpen&&e.positionDropdown()};Ce(document,"mousedown",R),Ce(window,"scroll",I,m),Ce(window,"resize",I,m),this._destroy=()=>{document.removeEventListener("mousedown",R),window.removeEventListener("scroll",I),window.removeEventListener("resize",I),l&&l.removeEventListener("click",S)},this.revertSettings={innerHTML:f.innerHTML,tabIndex:f.tabIndex},f.tabIndex=-1,f.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,Ce(f,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,f.disabled?e.disable():f.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Ie(f,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),ge(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,i={optgroup:s=>{let o=document.createElement("div");return o.className="optgroup",o.appendChild(s.options),o},optgroup_header:(s,o)=>'<div class="optgroup-header">'+o(s[n])+"</div>",option:(s,o)=>"<div>"+o(s[t])+"</div>",item:(s,o)=>"<div>"+o(s[t])+"</div>",option_create:(s,o)=>'<div class="create">Add <strong>'+o(s.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?Lr(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){yn(this.input,"input"),yn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){ue(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var i=n.trim().split(t.settings.splitOn);ge(i,s=>{Le(s)&&(this.options[s]?t.addItem(s):t.createItem(s))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){ue(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),ue(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==Pr&&ue(e);return}switch(e.keyCode){case Fu:if(We(Ct,e)&&t.control_input.value==""){ue(e),t.selectAll();return}break;case Uu:t.isOpen&&(ue(e,!0),t.close()),t.clearActiveItems();return;case Gu:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}ue(e);return;case Hu:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}ue(e);return;case ju:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),ue(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&ue(e);return;case Bu:t.advanceSelection(-1,e);return;case $u:t.advanceSelection(1,e);return;case Pr:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),ue(e)),t.settings.create&&t.createItem()&&ue(e));return;case _r:case Vu:t.deleteSelection(e);return}t.isInputHidden&&!We(Ct,e)&&ue(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=_u(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),ue(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,i=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(n=t.dataset.value,typeof n<"u"&&(i.lastQuery=null,i.addItem(n),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(ue(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;Ie(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||He(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,yn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];Rr(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,i,s,o,u,f,d;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(i=t&&t.type.toLowerCase(),i==="click"&&We("shiftKey",t)&&n.activeItems.length){for(d=n.getLastActive(),o=Array.prototype.indexOf.call(n.control.children,d),u=Array.prototype.indexOf.call(n.control.children,e),o>u&&(f=o,o=u,u=f),s=o;s<=u;s++)e=n.control.children[s],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);ue(t)}else i==="click"&&We(Ct,t)||i==="keydown"&&We("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&He(n,"last-active"),Ie(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),He(e,"active")}clearActiveItems(){He(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,se(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),se(e,{"aria-selected":"true"}),Ie(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,i=n.clientHeight,s=n.scrollTop||0,o=e.offsetHeight,u=e.getBoundingClientRect().top-n.getBoundingClientRect().top+s;u+o>i+s?this.scroll(u-i+o,t):u<s&&this.scroll(u,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(He(this.activeOption,"active"),se(this.activeOption,{"aria-selected":null})),this.activeOption=null,se(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,ge(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(se(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&se(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,i=this,s=this.getSearchOptions();if(i.settings.score&&(n=i.settings.score.call(i,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,t=i.sifter.search(e,Object.assign(s,{score:n})),i.currentResults=t):t=Object.assign({},i.currentResults),i.settings.hideSelected&&(t.items=t.items.filter(o=>{let u=Le(o.id);return!(u&&i.items.indexOf(u)!==-1)})),t}refreshOptions(e=!0){var t,n,i,s,o,u,f,d,m,b;const C={},T=[];var l=this,S=l.inputValue();const R=S===l.lastQuery||S==""&&l.lastQuery==null;var I=l.search(S),y=null,O=l.settings.shouldOpen||!1,x=l.dropdown_content;R&&(y=l.activeOption,y&&(m=y.closest("[data-group]"))),s=I.items.length,typeof l.settings.maxOptions=="number"&&(s=Math.min(s,l.settings.maxOptions)),s>0&&(O=!0);const p=(c,a)=>{let v=C[c];if(v!==void 0){let w=T[v];if(w!==void 0)return[v,w.fragment]}let g=document.createDocumentFragment();return v=T.length,T.push({fragment:g,order:a,optgroup:c}),[v,g]};for(t=0;t<s;t++){let c=I.items[t];if(!c)continue;let a=c.id,v=l.options[a];if(v===void 0)continue;let g=Tt(a),w=l.getOption(g,!0);for(l.settings.hideSelected||w.classList.toggle("selected",l.items.includes(g)),o=v[l.settings.optgroupField]||"",u=Array.isArray(o)?o:[o],n=0,i=u&&u.length;n<i;n++){o=u[n];let D=v.$order,k=l.optgroups[o];k===void 0?o="":D=k.$order;const[M,_]=p(o,D);n>0&&(w=w.cloneNode(!0),se(w,{id:v.$id+"-clone-"+n,"aria-selected":null}),w.classList.add("ts-cloned"),He(w,"active"),l.activeOption&&l.activeOption.dataset.value==a&&m&&m.dataset.group===o.toString()&&(y=w)),_.appendChild(w),o!=""&&(C[o]=M)}}l.settings.lockOptgroupOrder&&T.sort((c,a)=>c.order-a.order),f=document.createDocumentFragment(),ge(T,c=>{let a=c.fragment,v=c.optgroup;if(!a||!a.children.length)return;let g=l.optgroups[v];if(g!==void 0){let w=document.createDocumentFragment(),D=l.render("optgroup_header",g);qe(w,D),qe(w,a);let k=l.render("optgroup",{group:g,options:w});qe(f,k)}else qe(f,a)}),x.innerHTML="",qe(x,f),l.settings.highlight&&(Nu(x),I.query.length&&I.tokens.length&&ge(I.tokens,c=>{Du(x,c.regex)}));var h=c=>{let a=l.render(c,{input:S});return a&&(O=!0,x.insertBefore(a,x.firstChild)),a};if(l.loading?h("loading"):l.settings.shouldLoad.call(l,S)?I.items.length===0&&h("no_results"):h("not_loading"),d=l.canCreate(S),d&&(b=h("option_create")),l.hasOptions=I.items.length>0||d,O){if(I.items.length>0){if(!y&&l.settings.mode==="single"&&l.items[0]!=null&&(y=l.getOption(l.items[0])),!x.contains(y)){let c=0;b&&!l.settings.addPrecedence&&(c=1),y=l.selectable()[c]}}else b&&(y=b);e&&!l.isOpen&&(l.open(),l.scrollToOption(y,"auto")),l.setActiveOption(y)}else l.clearActiveOption(),e&&l.isOpen&&l.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const i=Le(e[n.settings.valueField]);return i===null||n.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[i]=e,n.lastQuery=null,t&&(n.userOptions[i]=t,n.trigger("option_add",i,e)),i)}addOptions(e,t=!1){ge(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Le(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var i,s;const o=Le(e),u=Le(t[n.settings.valueField]);if(o===null)return;const f=n.options[o];if(f==null)return;if(typeof u!="string")throw new Error("Value must be set in option data");const d=n.getOption(o),m=n.getItem(o);if(t.$order=t.$order||f.$order,delete n.options[o],n.uncacheValue(u),n.options[u]=t,d){if(n.dropdown_content.contains(d)){const b=n._render("option",t);_n(d,b),n.activeOption===d&&n.setActiveOption(b)}d.remove()}m&&(s=n.items.indexOf(o),s!==-1&&n.items.splice(s,1,u),i=n._render("item",t),m.classList.contains("active")&&Ie(i,"active"),_n(m,i)),n.lastQuery=null}removeOption(e,t){const n=this;e=Tt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};ge(this.options,(i,s)=>{t(i,s)&&(n[s]=i)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Le(e);if(n===null)return null;const i=this.options[n];if(i!=null){if(i.$div)return i.$div;if(t)return this._render("option",i)}return null}getAdjacent(e,t,n="option"){var i=this,s;if(!e)return null;n=="item"?s=i.controlChildren():s=i.dropdown_content.querySelectorAll("[data-selectable]");for(let o=0;o<s.length;o++)if(s[o]==e)return t>0?s[o+1]:s[o-1];return null}getItem(e){if(typeof e=="object")return e;var t=Le(e);return t!==null?this.control.querySelector(`[data-value="${Tr(t)}"]`):null}addItems(e,t){var n=this,i=Array.isArray(e)?e:[e];i=i.filter(o=>n.items.indexOf(o)===-1);const s=i[i.length-1];i.forEach(o=>{n.isPending=o!==s,n.addItem(o,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];Rr(this,n,()=>{var i,s;const o=this,u=o.settings.mode,f=Le(e);if(!(f&&o.items.indexOf(f)!==-1&&(u==="single"&&o.close(),u==="single"||!o.settings.duplicates))&&!(f===null||!o.options.hasOwnProperty(f))&&(u==="single"&&o.clear(t),!(u==="multi"&&o.isFull()))){if(i=o._render("item",o.options[f]),o.control.contains(i)&&(i=i.cloneNode(!0)),s=o.isFull(),o.items.splice(o.caretPos,0,f),o.insertAtCaret(i),o.isSetup){if(!o.isPending&&o.settings.hideSelected){let d=o.getOption(f),m=o.getAdjacent(d,1);m&&o.setActiveOption(m)}!o.isPending&&!o.settings.closeAfterSelect&&o.refreshOptions(o.isFocused&&u!=="single"),o.settings.closeAfterSelect!=!1&&o.isFull()?o.close():o.isPending||o.positionDropdown(),o.trigger("item_add",f,i),o.isPending||o.updateOriginalInput({silent:t})}(!o.isPending||!s&&o.isFull())&&(o.inputState(),o.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var i,s;const o=e.dataset.value;i=xr(e),e.remove(),e.classList.contains("active")&&(s=n.activeItems.indexOf(e),n.activeItems.splice(s,1),He(e,"active")),n.items.splice(i,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(o)&&n.removeOption(o,t),i<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",o,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,i=n.caretPos,s;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var o=!1,u=f=>{if(n.unlock(),!f||typeof f!="object")return t();var d=Le(f[n.settings.valueField]);if(typeof d!="string")return t();n.setTextboxValue(),n.addOption(f,!0),n.setCaret(i),n.addItem(d),t(f),o=!0};return typeof n.settings.create=="function"?s=n.settings.create.call(this,e,u):s={[n.settings.labelField]:e,[n.settings.valueField]:e},o||u(s),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",n),i.toggle("full",t),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",ku(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,i;const s=t.input.querySelector('option[value=""]');if(t.is_select_tag){let d=function(m,b,C){return m||(m=Fe('<option value="'+vn(b)+'">'+vn(C)+"</option>")),m!=s&&t.input.append(m),u.push(m),(m!=s||f>0)&&(m.selected=!0),m};var o=d;const u=[],f=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(m=>{m.selected=!1}),t.items.length==0&&t.settings.mode=="single"?d(s,"",""):t.items.forEach(m=>{if(n=t.options[m],i=n[t.settings.labelField]||"",u.includes(n.$option)){const b=t.input.querySelector(`option[value="${Tr(m)}"]:not(:checked)`);d(b,m,i)}else n.$option=d(n.$option,m,i)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,se(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Ot(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Ot(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,se(t.focus_node,{"aria-expanded":"false"}),Ot(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,i=t.left+window.scrollX;Ot(this.dropdown,{width:t.width+"px",top:n+"px",left:i+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();ge(n,i=>{t.removeItem(i,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,i=t.control;i.insertBefore(e,i.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,i,s,o=this;t=e&&e.keyCode===_r?-1:1,n=Mu(o.control_input);const u=[];if(o.activeItems.length)s=Ir(o.activeItems,t),i=xr(s),t>0&&i++,ge(o.activeItems,f=>u.push(f));else if((o.isFocused||o.settings.mode==="single")&&o.items.length){const f=o.controlChildren();let d;t<0&&n.start===0&&n.length===0?d=f[o.caretPos-1]:t>0&&n.start===o.inputValue().length&&(d=f[o.caretPos]),d!==void 0&&u.push(d)}if(!o.shouldDelete(u,e))return!1;for(ue(e,!0),typeof i<"u"&&o.setCaret(i);u.length;)o.removeItem(u.pop());return o.inputState(),o.positionDropdown(),o.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(i=>i.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,i,s=this;s.rtl&&(e*=-1),!s.inputValue().length&&(We(Ct,t)||We("shiftKey",t)?(n=s.getLastActive(e),n?n.classList.contains("active")?i=s.getAdjacent(n,e,"item"):i=n:e>0?i=s.control_input.nextElementSibling:i=s.control_input.previousElementSibling,i&&(i.classList.contains("active")&&s.removeActiveItem(n),s.setActiveItemClass(i))):s.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return Ir(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,He(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,i;const s=this;if(typeof this.settings.render[e]!="function"||(i=s.settings.render[e].call(this,t,vn),!i))return null;if(i=Fe(i),e==="option"||e==="option_create"?t[s.settings.disabledField]?se(i,{"aria-disabled":"true"}):se(i,{"data-selectable":""}):e==="optgroup"&&(n=t.group[s.settings.optgroupValueField],se(i,{"data-group":n}),t.group[s.settings.disabledField]&&se(i,{"data-disabled":""})),e==="option"||e==="item"){const o=Tt(t[s.settings.valueField]);se(i,{"data-value":o}),e==="item"?(Ie(i,s.settings.itemClass),se(i,{"data-ts-item":""})):(Ie(i,s.settings.optionClass),se(i,{role:"option",id:t.$id}),t.$div=i,s.options[o]=t)}return i}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){ge(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var i=this,s=i[t];i[t]=function(){var o,u;return e==="after"&&(o=s.apply(i,arguments)),u=n.apply(i,arguments),e==="instead"?u:(e==="before"&&(o=s.apply(i,arguments)),o)}}}const Wu=(r,e,t,n)=>{r.addEventListener(e,t,n)};function qu(){Wu(this.input,"change",()=>{this.sync()})}const Ku=r=>typeof r>"u"||r===null?null:Ju(r),Ju=r=>typeof r=="boolean"?r?"1":"0":r+"",Dr=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Qu=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Yu(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Yu=r=>typeof r=="string"&&r.indexOf("<")>-1;function Xu(r){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},r);var i=function(u,f){f?(u.checked=!0,n.uncheckedClassNames&&u.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&u.classList.add(...n.checkedClassNames)):(u.checked=!1,n.checkedClassNames&&u.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&u.classList.add(...n.uncheckedClassNames))},s=function(u){setTimeout(()=>{var f=u.querySelector("input."+n.className);f instanceof HTMLInputElement&&i(f,u.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var o=e.settings.render.option;e.settings.render.option=(u,f)=>{var d=Qu(o.call(e,u,f)),m=document.createElement("input");n.className&&m.classList.add(n.className),m.addEventListener("click",function(C){Dr(C)}),m.type="checkbox";const b=Ku(u[e.settings.valueField]);return i(m,!!(b&&e.items.indexOf(b)>-1)),d.prepend(m),d}}),e.on("item_remove",o=>{var u=e.getOption(o);u&&(u.classList.remove("selected"),s(u))}),e.on("item_add",o=>{var u=e.getOption(o);u&&s(u)}),e.hook("instead","onOptionSelect",(o,u)=>{if(u.classList.contains("selected")){u.classList.remove("selected"),e.removeItem(u.dataset.value),e.refreshOptions(),Dr(o,!0);return}t.call(e,o,u),s(u)})}const Zu=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(ec(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},ec=r=>typeof r=="string"&&r.indexOf("<")>-1;function tc(r){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},r);e.on("initialize",()=>{var n=Zu(t.html(t));n.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(n)})}const nc=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Xe=(r,e,t,n)=>{r.addEventListener(e,t,n)},rc=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},ic=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(oc(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},oc=r=>typeof r=="string"&&r.indexOf("<")>-1,sc=(r,e)=>{rc(e,(t,n)=>{t==null?r.removeAttribute(n):r.setAttribute(n,""+t)})},ac=(r,e)=>{var t;(t=r.parentNode)==null||t.insertBefore(e,r.nextSibling)},lc=(r,e)=>{var t;(t=r.parentNode)==null||t.insertBefore(e,r)},uc=(r,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,r==e)return!0}while(e&&e.previousElementSibling);return!1};function cc(){var r=this;if(r.settings.mode!=="multi")return;var e=r.lock,t=r.unlock;let n=!0,i;r.hook("after","setupTemplates",()=>{var s=r.settings.render.item;r.settings.render.item=(o,u)=>{const f=ic(s.call(r,o,u));sc(f,{draggable:"true"});const d=S=>{n||nc(S),S.stopPropagation()},m=S=>{i=f,setTimeout(()=>{f.classList.add("ts-dragging")},0)},b=S=>{S.preventDefault(),f.classList.add("ts-drag-over"),T(f,i)},C=()=>{f.classList.remove("ts-drag-over")},T=(S,R)=>{R!==void 0&&(uc(R,f)?ac(S,R):lc(S,R))},l=()=>{var S;document.querySelectorAll(".ts-drag-over").forEach(I=>I.classList.remove("ts-drag-over")),(S=i)==null||S.classList.remove("ts-dragging"),i=void 0;var R=[];r.control.querySelectorAll("[data-value]").forEach(I=>{if(I.dataset.value){let y=I.dataset.value;y&&R.push(y)}}),r.setValue(R)};return Xe(f,"mousedown",d),Xe(f,"dragstart",m),Xe(f,"dragenter",b),Xe(f,"dragover",b),Xe(f,"dragleave",C),Xe(f,"dragend",l),f}}),r.hook("instead","lock",()=>(n=!1,e.call(r))),r.hook("instead","unlock",()=>(n=!0,t.call(r)))}const fc=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},dc=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(hc(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},hc=r=>typeof r=="string"&&r.indexOf("<")>-1;function pc(r){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},r);e.on("initialize",()=>{var n=dc(t.html(t)),i=n.querySelector("."+t.closeClass);i&&i.addEventListener("click",s=>{fc(s,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}const gc=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},vc=(r,...e)=>{var t=mc(e);r=yc(r),r.map(n=>{t.map(i=>{n.classList.remove(i)})})},mc=r=>{var e=[];return gc(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},yc=r=>(Array.isArray(r)||(r=[r]),r),bc=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var t=0;r=r.previousElementSibling;)r.matches(e)&&t++;return t};function Oc(){var r=this;r.hook("instead","setCaret",e=>{r.settings.mode==="single"||!r.control.contains(r.control_input)?e=r.items.length:(e=Math.max(0,Math.min(r.items.length,e)),e!=r.caretPos&&!r.isPending&&r.controlChildren().forEach((t,n)=>{n<e?r.control_input.insertAdjacentElement("beforebegin",t):r.control.appendChild(t)})),r.caretPos=e}),r.hook("instead","moveCaret",e=>{if(!r.isFocused)return;const t=r.getLastActive(e);if(t){const n=bc(t);r.setCaret(e>0?n+1:n),r.setActiveItem(),vc(t,"last-active")}else r.setCaret(r.caretPos+e)})}const Cc=27,wc=9,Ac=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Sc=(r,e,t,n)=>{r.addEventListener(e,t,n)},Ec=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},Nr=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Rc(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Rc=r=>typeof r=="string"&&r.indexOf("<")>-1,Tc=(r,...e)=>{var t=Ic(e);r=xc(r),r.map(n=>{t.map(i=>{n.classList.add(i)})})},Ic=r=>{var e=[];return Ec(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},xc=r=>(Array.isArray(r)||(r=[r]),r);function _c(){const r=this;r.settings.shouldOpen=!0,r.hook("before","setup",()=>{r.focus_node=r.control,Tc(r.control_input,"dropdown-input");const e=Nr('<div class="dropdown-input-wrap">');e.append(r.control_input),r.dropdown.insertBefore(e,r.dropdown.firstChild);const t=Nr('<input class="items-placeholder" tabindex="-1" />');t.placeholder=r.settings.placeholder||"",r.control.append(t)}),r.on("initialize",()=>{r.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case Cc:r.isOpen&&(Ac(t,!0),r.close()),r.clearActiveItems();return;case wc:r.focus_node.tabIndex=-1;break}return r.onKeyDown.call(r,t)}),r.on("blur",()=>{r.focus_node.tabIndex=r.isDisabled?-1:r.tabIndex}),r.on("dropdown_open",()=>{r.control_input.focus()});const e=r.onBlur;r.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==r.control_input))return e.call(r)}),Sc(r.control_input,"blur",()=>r.onBlur()),r.hook("before","close",()=>{r.isOpen&&r.focus_node.focus({preventScroll:!0})})})}const wt=(r,e,t,n)=>{r.addEventListener(e,t,n)};function Pc(){var r=this;r.on("initialize",()=>{var e=document.createElement("span"),t=r.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",r.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const s of n)e.style[s]=t.style[s];var i=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};i(),r.on("update item_add item_remove",i),wt(t,"input",i),wt(t,"keyup",i),wt(t,"blur",i),wt(t,"update",i)})}function Mc(){var r=this,e=r.deleteSelection;this.hook("instead","deleteSelection",t=>r.activeItems.length?e.call(r,t):!1)}function Lc(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const Fr=37,kc=39,Dc=(r,e,t)=>{for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},Nc=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var t=0;r=r.previousElementSibling;)r.matches(e)&&t++;return t};function Fc(){var r=this,e=r.onKeyDown;r.hook("instead","onKeyDown",t=>{var n,i,s,o;if(!r.isOpen||!(t.keyCode===Fr||t.keyCode===kc))return e.call(r,t);r.ignoreHover=!0,o=Dc(r.activeOption,"[data-group]"),n=Nc(r.activeOption,"[data-selectable]"),o&&(t.keyCode===Fr?o=o.previousSibling:o=o.nextSibling,o&&(s=o.querySelectorAll("[data-selectable]"),i=s[Math.min(s.length-1,n)],i&&r.setActiveOption(i)))})}const jc=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),jr=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ur=(r,e,t,n)=>{r.addEventListener(e,t,n)},Br=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Uc(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Uc=r=>typeof r=="string"&&r.indexOf("<")>-1;function Bc(r){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},r);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+jc(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var i=t.settings.render.item;t.settings.render.item=(s,o)=>{var u=Br(i.call(t,s,o)),f=Br(n);return u.appendChild(f),Ur(f,"mousedown",d=>{jr(d,!0)}),Ur(f,"click",d=>{t.isLocked||(jr(d,!0),!t.isLocked&&t.shouldDelete([u],d)&&(t.removeItem(u),t.refreshOptions(!1),t.inputState()))}),u}})}}function Hc(r){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},r);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[n];i&&e.setTextboxValue(t.text.call(e,i))}})}const $c=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var t in r)r.hasOwnProperty(t)&&e(r[t],t)},Gc=(r,...e)=>{var t=Vc(e);r=zc(r),r.map(n=>{t.map(i=>{n.classList.add(i)})})},Vc=r=>{var e=[];return $c(r,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},zc=r=>(Array.isArray(r)||(r=[r]),r);function Wc(){const r=this,e=r.canLoad,t=r.clearActiveOption,n=r.loadCallback;var i={},s,o=!1,u,f=[];if(r.settings.shouldLoadMore||(r.settings.shouldLoadMore=()=>{if(s.clientHeight/(s.scrollHeight-s.scrollTop)>.9)return!0;if(r.activeOption){var C=r.selectable(),T=Array.from(C).indexOf(r.activeOption);if(T>=C.length-2)return!0}return!1}),!r.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";r.settings.sortField=[{field:"$order"},{field:"$score"}];const d=b=>typeof r.settings.maxOptions=="number"&&s.children.length>=r.settings.maxOptions?!1:!!(b in i&&i[b]),m=(b,C)=>r.items.indexOf(C)>=0||f.indexOf(C)>=0;r.setNextUrl=(b,C)=>{i[b]=C},r.getUrl=b=>{if(b in i){const C=i[b];return i[b]=!1,C}return r.clearPagination(),r.settings.firstUrl.call(r,b)},r.clearPagination=()=>{i={}},r.hook("instead","clearActiveOption",()=>{if(!o)return t.call(r)}),r.hook("instead","canLoad",b=>b in i?d(b):e.call(r,b)),r.hook("instead","loadCallback",(b,C)=>{if(!o)r.clearOptions(m);else if(u){const T=b[0];T!==void 0&&(u.dataset.value=T[r.settings.valueField])}n.call(r,b,C),o=!1}),r.hook("after","refreshOptions",()=>{const b=r.lastValue;var C;d(b)?(C=r.render("loading_more",{query:b}),C&&(C.setAttribute("data-selectable",""),u=C)):b in i&&!s.querySelector(".no-results")&&(C=r.render("no_more_results",{query:b})),C&&(Gc(C,r.settings.optionClass),s.append(C))}),r.on("initialize",()=>{f=Object.keys(r.options),s=r.dropdown_content,r.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},r.settings.render),s.addEventListener("scroll",()=>{r.settings.shouldLoadMore.call(r)&&d(r.lastValue)&&(o||(o=!0,r.load.call(r,r.lastValue)))})})}Ae.define("change_listener",qu);Ae.define("checkbox_options",Xu);Ae.define("clear_button",tc);Ae.define("drag_drop",cc);Ae.define("dropdown_header",pc);Ae.define("caret_position",Oc);Ae.define("dropdown_input",_c);Ae.define("input_autogrow",Pc);Ae.define("no_backspace_delete",Mc);Ae.define("no_active_items",Lc);Ae.define("optgroup_columns",Fc);Ae.define("remove_button",Bc);Ae.define("restore_on_backspace",Hc);Ae.define("virtual_scroll",Wc);var qc={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(dt,function(){const t=(u,f)=>{if(Array.isArray(u))u.forEach(f);else for(var d in u)u.hasOwnProperty(d)&&f(u[d],d)},n=(u,...f)=>{var d=i(f);u=s(u),u.map(m=>{d.map(b=>{m.classList.add(b)})})},i=u=>{var f=[];return t(u,d=>{typeof d=="string"&&(d=d.trim().split(/[\t\n\f\r\s]/)),Array.isArray(d)&&(f=f.concat(d))}),f.filter(Boolean)},s=u=>(Array.isArray(u)||(u=[u]),u);function o(){const u=this,f=u.canLoad,d=u.clearActiveOption,m=u.loadCallback;var b={},C,T=!1,l,S=[];if(u.settings.shouldLoadMore||(u.settings.shouldLoadMore=()=>{if(C.clientHeight/(C.scrollHeight-C.scrollTop)>.9)return!0;if(u.activeOption){var O=u.selectable(),x=Array.from(O).indexOf(u.activeOption);if(x>=O.length-2)return!0}return!1}),!u.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";u.settings.sortField=[{field:"$order"},{field:"$score"}];const R=y=>typeof u.settings.maxOptions=="number"&&C.children.length>=u.settings.maxOptions?!1:!!(y in b&&b[y]),I=(y,O)=>u.items.indexOf(O)>=0||S.indexOf(O)>=0;u.setNextUrl=(y,O)=>{b[y]=O},u.getUrl=y=>{if(y in b){const O=b[y];return b[y]=!1,O}return u.clearPagination(),u.settings.firstUrl.call(u,y)},u.clearPagination=()=>{b={}},u.hook("instead","clearActiveOption",()=>{if(!T)return d.call(u)}),u.hook("instead","canLoad",y=>y in b?R(y):f.call(u,y)),u.hook("instead","loadCallback",(y,O)=>{if(!T)u.clearOptions(I);else if(l){const x=y[0];x!==void 0&&(l.dataset.value=x[u.settings.valueField])}m.call(u,y,O),T=!1}),u.hook("after","refreshOptions",()=>{const y=u.lastValue;var O;R(y)?(O=u.render("loading_more",{query:y}),O&&(O.setAttribute("data-selectable",""),l=O)):y in b&&!C.querySelector(".no-results")&&(O=u.render("no_more_results",{query:y})),O&&(n(O,u.settings.optionClass),C.append(O))}),u.on("initialize",()=>{S=Object.keys(u.options),C=u.dropdown_content,u.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},u.settings.render),C.addEventListener("scroll",()=>{u.settings.shouldLoadMore.call(u)&&R(u.lastValue)&&(T||(T=!0,u.load.call(u,u.lastValue)))})})}return o})})(qc);var Kc={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(dt,function(){const i=(u,f,d)=>{for(;u&&u.matches;){if(u.matches(f))return u;u=u.parentNode}},s=(u,f)=>{if(!u)return-1;f=f||u.nodeName;for(var d=0;u=u.previousElementSibling;)u.matches(f)&&d++;return d};function o(){var u=this,f=u.onKeyDown;u.hook("instead","onKeyDown",d=>{var m,b,C,T;if(!u.isOpen||!(d.keyCode===37||d.keyCode===39))return f.call(u,d);u.ignoreHover=!0,T=i(u.activeOption,"[data-group]"),m=s(u.activeOption,"[data-selectable]"),T&&(d.keyCode===37?T=T.previousSibling:T=T.nextSibling,T&&(C=T.querySelectorAll("[data-selectable]"),b=C[Math.min(C.length-1,m)],b&&u.setActiveOption(b)))})}return o})})(Kc);jn.extend(au);jn.locale("id");window.dayjs=jn;window.TomSelect=Ae;
