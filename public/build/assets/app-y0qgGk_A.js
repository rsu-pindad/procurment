function Lr(r,e){for(var n=0;n<e.length;n++){const t=e[n];if(typeof t!="string"&&!Array.isArray(t)){for(const i in t)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(t,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>t[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}function Gn(r,e){return function(){return r.apply(e,arguments)}}const{toString:kr}=Object.prototype,{getPrototypeOf:Yt}=Object,{iterator:vt,toStringTag:Vn}=Symbol,mt=(r=>e=>{const n=kr.call(e);return r[n]||(r[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Te=r=>(r=r.toLowerCase(),e=>mt(e)===r),yt=r=>e=>typeof e===r,{isArray:Ve}=Array,$e=yt("undefined");function Nr(r){return r!==null&&!$e(r)&&r.constructor!==null&&!$e(r.constructor)&&Oe(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const zn=Te("ArrayBuffer");function Dr(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&zn(r.buffer),e}const _r=yt("string"),Oe=yt("function"),Wn=yt("number"),bt=r=>r!==null&&typeof r=="object",jr=r=>r===!0||r===!1,it=r=>{if(mt(r)!=="object")return!1;const e=Yt(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Vn in r)&&!(vt in r)},Ur=Te("Date"),Br=Te("File"),Fr=Te("Blob"),Hr=Te("FileList"),Gr=r=>bt(r)&&Oe(r.pipe),Vr=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Oe(r.append)&&((e=mt(r))==="formdata"||e==="object"&&Oe(r.toString)&&r.toString()==="[object FormData]"))},zr=Te("URLSearchParams"),[Wr,qr,$r,Kr]=["ReadableStream","Request","Response","Headers"].map(Te),Jr=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qe(r,e,{allOwnKeys:n=!1}={}){if(r===null||typeof r>"u")return;let t,i;if(typeof r!="object"&&(r=[r]),Ve(r))for(t=0,i=r.length;t<i;t++)e.call(null,r[t],t,r);else{const s=n?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let p;for(t=0;t<o;t++)p=s[t],e.call(null,r[p],p,r)}}function qn(r,e){e=e.toLowerCase();const n=Object.keys(r);let t=n.length,i;for(;t-- >0;)if(i=n[t],e===i.toLowerCase())return i;return null}const _e=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,$n=r=>!$e(r)&&r!==_e;function Gt(){const{caseless:r}=$n(this)&&this||{},e={},n=(t,i)=>{const s=r&&qn(e,i)||i;it(e[s])&&it(t)?e[s]=Gt(e[s],t):it(t)?e[s]=Gt({},t):Ve(t)?e[s]=t.slice():e[s]=t};for(let t=0,i=arguments.length;t<i;t++)arguments[t]&&Qe(arguments[t],n);return e}const Qr=(r,e,n,{allOwnKeys:t}={})=>(Qe(e,(i,s)=>{n&&Oe(i)?r[s]=Gn(i,n):r[s]=i},{allOwnKeys:t}),r),Xr=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Yr=(r,e,n,t)=>{r.prototype=Object.create(e.prototype,t),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),n&&Object.assign(r.prototype,n)},Zr=(r,e,n,t)=>{let i,s,o;const p={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!t||t(o,r,e))&&!p[o]&&(e[o]=r[o],p[o]=!0);r=n!==!1&&Yt(r)}while(r&&(!n||n(r,e))&&r!==Object.prototype);return e},ei=(r,e,n)=>{r=String(r),(n===void 0||n>r.length)&&(n=r.length),n-=e.length;const t=r.indexOf(e,n);return t!==-1&&t===n},ti=r=>{if(!r)return null;if(Ve(r))return r;let e=r.length;if(!Wn(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=r[e];return n},ni=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&Yt(Uint8Array)),ri=(r,e)=>{const t=(r&&r[vt]).call(r);let i;for(;(i=t.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},ii=(r,e)=>{let n;const t=[];for(;(n=r.exec(e))!==null;)t.push(n);return t},oi=Te("HTMLFormElement"),si=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,t,i){return t.toUpperCase()+i}),on=(({hasOwnProperty:r})=>(e,n)=>r.call(e,n))(Object.prototype),ai=Te("RegExp"),Kn=(r,e)=>{const n=Object.getOwnPropertyDescriptors(r),t={};Qe(n,(i,s)=>{let o;(o=e(i,s,r))!==!1&&(t[s]=o||i)}),Object.defineProperties(r,t)},li=r=>{Kn(r,(e,n)=>{if(Oe(r)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const t=r[n];if(Oe(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},ui=(r,e)=>{const n={},t=i=>{i.forEach(s=>{n[s]=!0})};return Ve(r)?t(r):t(String(r).split(e)),n},ci=()=>{},fi=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function di(r){return!!(r&&Oe(r.append)&&r[Vn]==="FormData"&&r[vt])}const hi=r=>{const e=new Array(10),n=(t,i)=>{if(bt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[i]=t;const s=Ve(t)?[]:{};return Qe(t,(o,p)=>{const d=n(o,i+1);!$e(d)&&(s[p]=d)}),e[i]=void 0,s}}return t};return n(r,0)},pi=Te("AsyncFunction"),gi=r=>r&&(bt(r)||Oe(r))&&Oe(r.then)&&Oe(r.catch),Jn=((r,e)=>r?setImmediate:e?((n,t)=>(_e.addEventListener("message",({source:i,data:s})=>{i===_e&&s===n&&t.length&&t.shift()()},!1),i=>{t.push(i),_e.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Oe(_e.postMessage)),vi=typeof queueMicrotask<"u"?queueMicrotask.bind(_e):typeof process<"u"&&process.nextTick||Jn,mi=r=>r!=null&&Oe(r[vt]),W={isArray:Ve,isArrayBuffer:zn,isBuffer:Nr,isFormData:Vr,isArrayBufferView:Dr,isString:_r,isNumber:Wn,isBoolean:jr,isObject:bt,isPlainObject:it,isReadableStream:Wr,isRequest:qr,isResponse:$r,isHeaders:Kr,isUndefined:$e,isDate:Ur,isFile:Br,isBlob:Fr,isRegExp:ai,isFunction:Oe,isStream:Gr,isURLSearchParams:zr,isTypedArray:ni,isFileList:Hr,forEach:Qe,merge:Gt,extend:Qr,trim:Jr,stripBOM:Xr,inherits:Yr,toFlatObject:Zr,kindOf:mt,kindOfTest:Te,endsWith:ei,toArray:ti,forEachEntry:ri,matchAll:ii,isHTMLForm:oi,hasOwnProperty:on,hasOwnProp:on,reduceDescriptors:Kn,freezeMethods:li,toObjectSet:ui,toCamelCase:si,noop:ci,toFiniteNumber:fi,findKey:qn,global:_e,isContextDefined:$n,isSpecCompliantForm:di,toJSONObject:hi,isAsyncFn:pi,isThenable:gi,setImmediate:Jn,asap:vi,isIterable:mi};function te(r,e,n,t,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),t&&(this.request=t),i&&(this.response=i,this.status=i.status?i.status:null)}W.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:W.toJSONObject(this.config),code:this.code,status:this.status}}});const Qn=te.prototype,Xn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Xn[r]={value:r}});Object.defineProperties(te,Xn);Object.defineProperty(Qn,"isAxiosError",{value:!0});te.from=(r,e,n,t,i,s)=>{const o=Object.create(Qn);return W.toFlatObject(r,o,function(d){return d!==Error.prototype},p=>p!=="isAxiosError"),te.call(o,r.message,e,n,t,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const yi=null;function Vt(r){return W.isPlainObject(r)||W.isArray(r)}function Yn(r){return W.endsWith(r,"[]")?r.slice(0,-2):r}function sn(r,e,n){return r?r.concat(e).map(function(i,s){return i=Yn(i),!n&&s?"["+i+"]":i}).join(n?".":""):e}function bi(r){return W.isArray(r)&&!r.some(Vt)}const Oi=W.toFlatObject(W,{},null,function(e){return/^is[A-Z]/.test(e)});function Ot(r,e,n){if(!W.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,n=W.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(A,R){return!W.isUndefined(R[A])});const t=n.metaTokens,i=n.visitor||b,s=n.dots,o=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&W.isSpecCompliantForm(e);if(!W.isFunction(i))throw new TypeError("visitor must be a function");function v(l){if(l===null)return"";if(W.isDate(l))return l.toISOString();if(W.isBoolean(l))return l.toString();if(!d&&W.isBlob(l))throw new te("Blob is not supported. Use a Buffer instead.");return W.isArrayBuffer(l)||W.isTypedArray(l)?d&&typeof Blob=="function"?new Blob([l]):Buffer.from(l):l}function b(l,A,R){let I=l;if(l&&!R&&typeof l=="object"){if(W.endsWith(A,"{}"))A=t?A:A.slice(0,-2),l=JSON.stringify(l);else if(W.isArray(l)&&bi(l)||(W.isFileList(l)||W.endsWith(A,"[]"))&&(I=W.toArray(l)))return A=Yn(A),I.forEach(function(m,T){!(W.isUndefined(m)||m===null)&&e.append(o===!0?sn([A],T,s):o===null?A:A+"[]",v(m))}),!1}return Vt(l)?!0:(e.append(sn(R,A,s),v(l)),!1)}const w=[],C=Object.assign(Oi,{defaultVisitor:b,convertValue:v,isVisitable:Vt});function P(l,A){if(!W.isUndefined(l)){if(w.indexOf(l)!==-1)throw Error("Circular reference detected in "+A.join("."));w.push(l),W.forEach(l,function(I,y){(!(W.isUndefined(I)||I===null)&&i.call(e,I,W.isString(y)?y.trim():y,A,C))===!0&&P(I,A?A.concat(y):[y])}),w.pop()}}if(!W.isObject(r))throw new TypeError("data must be an object");return P(r),e}function an(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Zt(r,e){this._pairs=[],r&&Ot(r,this,e)}const Zn=Zt.prototype;Zn.append=function(e,n){this._pairs.push([e,n])};Zn.toString=function(e){const n=e?function(t){return e.call(this,t,an)}:an;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function Ci(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function er(r,e,n){if(!e)return r;const t=n&&n.encode||Ci;W.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(i?s=i(e,n):s=W.isURLSearchParams(e)?e.toString():new Zt(e,n).toString(t),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class ln{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){W.forEach(this.handlers,function(t){t!==null&&e(t)})}}const tr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ai=typeof URLSearchParams<"u"?URLSearchParams:Zt,wi=typeof FormData<"u"?FormData:null,Si=typeof Blob<"u"?Blob:null,Ei={isBrowser:!0,classes:{URLSearchParams:Ai,FormData:wi,Blob:Si},protocols:["http","https","file","blob","url","data"]},en=typeof window<"u"&&typeof document<"u",zt=typeof navigator=="object"&&navigator||void 0,Ri=en&&(!zt||["ReactNative","NativeScript","NS"].indexOf(zt.product)<0),Ti=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ii=en&&window.location.href||"http://localhost",Pi=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:en,hasStandardBrowserEnv:Ri,hasStandardBrowserWebWorkerEnv:Ti,navigator:zt,origin:Ii},Symbol.toStringTag,{value:"Module"})),ge={...Pi,...Ei};function xi(r,e){return Ot(r,new ge.classes.URLSearchParams,Object.assign({visitor:function(n,t,i,s){return ge.isNode&&W.isBuffer(n)?(this.append(t,n.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Mi(r){return W.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Li(r){const e={},n=Object.keys(r);let t;const i=n.length;let s;for(t=0;t<i;t++)s=n[t],e[s]=r[s];return e}function nr(r){function e(n,t,i,s){let o=n[s++];if(o==="__proto__")return!0;const p=Number.isFinite(+o),d=s>=n.length;return o=!o&&W.isArray(i)?i.length:o,d?(W.hasOwnProp(i,o)?i[o]=[i[o],t]:i[o]=t,!p):((!i[o]||!W.isObject(i[o]))&&(i[o]=[]),e(n,t,i[o],s)&&W.isArray(i[o])&&(i[o]=Li(i[o])),!p)}if(W.isFormData(r)&&W.isFunction(r.entries)){const n={};return W.forEachEntry(r,(t,i)=>{e(Mi(t),i,n,0)}),n}return null}function ki(r,e,n){if(W.isString(r))try{return(e||JSON.parse)(r),W.trim(r)}catch(t){if(t.name!=="SyntaxError")throw t}return(n||JSON.stringify)(r)}const Xe={transitional:tr,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",i=t.indexOf("application/json")>-1,s=W.isObject(e);if(s&&W.isHTMLForm(e)&&(e=new FormData(e)),W.isFormData(e))return i?JSON.stringify(nr(e)):e;if(W.isArrayBuffer(e)||W.isBuffer(e)||W.isStream(e)||W.isFile(e)||W.isBlob(e)||W.isReadableStream(e))return e;if(W.isArrayBufferView(e))return e.buffer;if(W.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let p;if(s){if(t.indexOf("application/x-www-form-urlencoded")>-1)return xi(e,this.formSerializer).toString();if((p=W.isFileList(e))||t.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Ot(p?{"files[]":e}:e,d&&new d,this.formSerializer)}}return s||i?(n.setContentType("application/json",!1),ki(e)):e}],transformResponse:[function(e){const n=this.transitional||Xe.transitional,t=n&&n.forcedJSONParsing,i=this.responseType==="json";if(W.isResponse(e)||W.isReadableStream(e))return e;if(e&&W.isString(e)&&(t&&!this.responseType||i)){const o=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(p){if(o)throw p.name==="SyntaxError"?te.from(p,te.ERR_BAD_RESPONSE,this,null,this.response):p}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ge.classes.FormData,Blob:ge.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};W.forEach(["delete","get","head","post","put","patch"],r=>{Xe.headers[r]={}});const Ni=W.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Di=r=>{const e={};let n,t,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),n=o.substring(0,i).trim().toLowerCase(),t=o.substring(i+1).trim(),!(!n||e[n]&&Ni[n])&&(n==="set-cookie"?e[n]?e[n].push(t):e[n]=[t]:e[n]=e[n]?e[n]+", "+t:t)}),e},un=Symbol("internals");function qe(r){return r&&String(r).trim().toLowerCase()}function ot(r){return r===!1||r==null?r:W.isArray(r)?r.map(ot):String(r)}function _i(r){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=n.exec(r);)e[t[1]]=t[2];return e}const ji=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function xt(r,e,n,t,i){if(W.isFunction(t))return t.call(this,e,n);if(i&&(e=n),!!W.isString(e)){if(W.isString(t))return e.indexOf(t)!==-1;if(W.isRegExp(t))return t.test(e)}}function Ui(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}function Bi(r,e){const n=W.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(r,t+n,{value:function(i,s,o){return this[t].call(this,e,i,s,o)},configurable:!0})})}let Ce=class{constructor(e){e&&this.set(e)}set(e,n,t){const i=this;function s(p,d,v){const b=qe(d);if(!b)throw new Error("header name must be a non-empty string");const w=W.findKey(i,b);(!w||i[w]===void 0||v===!0||v===void 0&&i[w]!==!1)&&(i[w||d]=ot(p))}const o=(p,d)=>W.forEach(p,(v,b)=>s(v,b,d));if(W.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(W.isString(e)&&(e=e.trim())&&!ji(e))o(Di(e),n);else if(W.isObject(e)&&W.isIterable(e)){let p={},d,v;for(const b of e){if(!W.isArray(b))throw TypeError("Object iterator must return a key-value pair");p[v=b[0]]=(d=p[v])?W.isArray(d)?[...d,b[1]]:[d,b[1]]:b[1]}o(p,n)}else e!=null&&s(n,e,t);return this}get(e,n){if(e=qe(e),e){const t=W.findKey(this,e);if(t){const i=this[t];if(!n)return i;if(n===!0)return _i(i);if(W.isFunction(n))return n.call(this,i,t);if(W.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=qe(e),e){const t=W.findKey(this,e);return!!(t&&this[t]!==void 0&&(!n||xt(this,this[t],t,n)))}return!1}delete(e,n){const t=this;let i=!1;function s(o){if(o=qe(o),o){const p=W.findKey(t,o);p&&(!n||xt(t,t[p],p,n))&&(delete t[p],i=!0)}}return W.isArray(e)?e.forEach(s):s(e),i}clear(e){const n=Object.keys(this);let t=n.length,i=!1;for(;t--;){const s=n[t];(!e||xt(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const n=this,t={};return W.forEach(this,(i,s)=>{const o=W.findKey(t,s);if(o){n[o]=ot(i),delete n[s];return}const p=e?Ui(s):String(s).trim();p!==s&&delete n[s],n[p]=ot(i),t[p]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return W.forEach(this,(t,i)=>{t!=null&&t!==!1&&(n[i]=e&&W.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(i=>t.set(i)),t}static accessor(e){const t=(this[un]=this[un]={accessors:{}}).accessors,i=this.prototype;function s(o){const p=qe(o);t[p]||(Bi(i,o),t[p]=!0)}return W.isArray(e)?e.forEach(s):s(e),this}};Ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);W.reduceDescriptors(Ce.prototype,({value:r},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(t){this[n]=t}}});W.freezeMethods(Ce);function Mt(r,e){const n=this||Xe,t=e||n,i=Ce.from(t.headers);let s=t.data;return W.forEach(r,function(p){s=p.call(n,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function rr(r){return!!(r&&r.__CANCEL__)}function ze(r,e,n){te.call(this,r??"canceled",te.ERR_CANCELED,e,n),this.name="CanceledError"}W.inherits(ze,te,{__CANCEL__:!0});function ir(r,e,n){const t=n.config.validateStatus;!n.status||!t||t(n.status)?r(n):e(new te("Request failed with status code "+n.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Fi(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Hi(r,e){r=r||10;const n=new Array(r),t=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(d){const v=Date.now(),b=t[s];o||(o=v),n[i]=d,t[i]=v;let w=s,C=0;for(;w!==i;)C+=n[w++],w=w%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),v-o<e)return;const P=b&&v-b;return P?Math.round(C*1e3/P):void 0}}function Gi(r,e){let n=0,t=1e3/e,i,s;const o=(v,b=Date.now())=>{n=b,i=null,s&&(clearTimeout(s),s=null),r.apply(null,v)};return[(...v)=>{const b=Date.now(),w=b-n;w>=t?o(v,b):(i=v,s||(s=setTimeout(()=>{s=null,o(i)},t-w)))},()=>i&&o(i)]}const lt=(r,e,n=3)=>{let t=0;const i=Hi(50,250);return Gi(s=>{const o=s.loaded,p=s.lengthComputable?s.total:void 0,d=o-t,v=i(d),b=o<=p;t=o;const w={loaded:o,total:p,progress:p?o/p:void 0,bytes:d,rate:v||void 0,estimated:v&&p&&b?(p-o)/v:void 0,event:s,lengthComputable:p!=null,[e?"download":"upload"]:!0};r(w)},n)},cn=(r,e)=>{const n=r!=null;return[t=>e[0]({lengthComputable:n,total:r,loaded:t}),e[1]]},fn=r=>(...e)=>W.asap(()=>r(...e)),Vi=ge.hasStandardBrowserEnv?((r,e)=>n=>(n=new URL(n,ge.origin),r.protocol===n.protocol&&r.host===n.host&&(e||r.port===n.port)))(new URL(ge.origin),ge.navigator&&/(msie|trident)/i.test(ge.navigator.userAgent)):()=>!0,zi=ge.hasStandardBrowserEnv?{write(r,e,n,t,i,s){const o=[r+"="+encodeURIComponent(e)];W.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),W.isString(t)&&o.push("path="+t),W.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Wi(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function qi(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function or(r,e,n){let t=!Wi(e);return r&&(t||n==!1)?qi(r,e):e}const dn=r=>r instanceof Ce?{...r}:r;function Ue(r,e){e=e||{};const n={};function t(v,b,w,C){return W.isPlainObject(v)&&W.isPlainObject(b)?W.merge.call({caseless:C},v,b):W.isPlainObject(b)?W.merge({},b):W.isArray(b)?b.slice():b}function i(v,b,w,C){if(W.isUndefined(b)){if(!W.isUndefined(v))return t(void 0,v,w,C)}else return t(v,b,w,C)}function s(v,b){if(!W.isUndefined(b))return t(void 0,b)}function o(v,b){if(W.isUndefined(b)){if(!W.isUndefined(v))return t(void 0,v)}else return t(void 0,b)}function p(v,b,w){if(w in e)return t(v,b);if(w in r)return t(void 0,v)}const d={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:p,headers:(v,b,w)=>i(dn(v),dn(b),w,!0)};return W.forEach(Object.keys(Object.assign({},r,e)),function(b){const w=d[b]||i,C=w(r[b],e[b],b);W.isUndefined(C)&&w!==p||(n[b]=C)}),n}const sr=r=>{const e=Ue({},r);let{data:n,withXSRFToken:t,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:p}=e;e.headers=o=Ce.from(o),e.url=er(or(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),p&&o.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):"")));let d;if(W.isFormData(n)){if(ge.hasStandardBrowserEnv||ge.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((d=o.getContentType())!==!1){const[v,...b]=d?d.split(";").map(w=>w.trim()).filter(Boolean):[];o.setContentType([v||"multipart/form-data",...b].join("; "))}}if(ge.hasStandardBrowserEnv&&(t&&W.isFunction(t)&&(t=t(e)),t||t!==!1&&Vi(e.url))){const v=i&&s&&zi.read(s);v&&o.set(i,v)}return e},$i=typeof XMLHttpRequest<"u",Ki=$i&&function(r){return new Promise(function(n,t){const i=sr(r);let s=i.data;const o=Ce.from(i.headers).normalize();let{responseType:p,onUploadProgress:d,onDownloadProgress:v}=i,b,w,C,P,l;function A(){P&&P(),l&&l(),i.cancelToken&&i.cancelToken.unsubscribe(b),i.signal&&i.signal.removeEventListener("abort",b)}let R=new XMLHttpRequest;R.open(i.method.toUpperCase(),i.url,!0),R.timeout=i.timeout;function I(){if(!R)return;const m=Ce.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),f={data:!p||p==="text"||p==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:m,config:r,request:R};ir(function(u){n(u),A()},function(u){t(u),A()},f),R=null}"onloadend"in R?R.onloadend=I:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(I)},R.onabort=function(){R&&(t(new te("Request aborted",te.ECONNABORTED,r,R)),R=null)},R.onerror=function(){t(new te("Network Error",te.ERR_NETWORK,r,R)),R=null},R.ontimeout=function(){let T=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const f=i.transitional||tr;i.timeoutErrorMessage&&(T=i.timeoutErrorMessage),t(new te(T,f.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,r,R)),R=null},s===void 0&&o.setContentType(null),"setRequestHeader"in R&&W.forEach(o.toJSON(),function(T,f){R.setRequestHeader(f,T)}),W.isUndefined(i.withCredentials)||(R.withCredentials=!!i.withCredentials),p&&p!=="json"&&(R.responseType=i.responseType),v&&([C,l]=lt(v,!0),R.addEventListener("progress",C)),d&&R.upload&&([w,P]=lt(d),R.upload.addEventListener("progress",w),R.upload.addEventListener("loadend",P)),(i.cancelToken||i.signal)&&(b=m=>{R&&(t(!m||m.type?new ze(null,r,R):m),R.abort(),R=null)},i.cancelToken&&i.cancelToken.subscribe(b),i.signal&&(i.signal.aborted?b():i.signal.addEventListener("abort",b)));const y=Fi(i.url);if(y&&ge.protocols.indexOf(y)===-1){t(new te("Unsupported protocol "+y+":",te.ERR_BAD_REQUEST,r));return}R.send(s||null)})},Ji=(r,e)=>{const{length:n}=r=r?r.filter(Boolean):[];if(e||n){let t=new AbortController,i;const s=function(v){if(!i){i=!0,p();const b=v instanceof Error?v:this.reason;t.abort(b instanceof te?b:new ze(b instanceof Error?b.message:b))}};let o=e&&setTimeout(()=>{o=null,s(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const p=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(v=>{v.unsubscribe?v.unsubscribe(s):v.removeEventListener("abort",s)}),r=null)};r.forEach(v=>v.addEventListener("abort",s));const{signal:d}=t;return d.unsubscribe=()=>W.asap(p),d}},Qi=function*(r,e){let n=r.byteLength;if(n<e){yield r;return}let t=0,i;for(;t<n;)i=t+e,yield r.slice(t,i),t=i},Xi=async function*(r,e){for await(const n of Yi(r))yield*Qi(n,e)},Yi=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:n,value:t}=await e.read();if(n)break;yield t}}finally{await e.cancel()}},hn=(r,e,n,t)=>{const i=Xi(r,e);let s=0,o,p=d=>{o||(o=!0,t&&t(d))};return new ReadableStream({async pull(d){try{const{done:v,value:b}=await i.next();if(v){p(),d.close();return}let w=b.byteLength;if(n){let C=s+=w;n(C)}d.enqueue(new Uint8Array(b))}catch(v){throw p(v),v}},cancel(d){return p(d),i.return()}},{highWaterMark:2})},Ct=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ar=Ct&&typeof ReadableStream=="function",Zi=Ct&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),lr=(r,...e)=>{try{return!!r(...e)}catch{return!1}},eo=ar&&lr(()=>{let r=!1;const e=new Request(ge.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),pn=64*1024,Wt=ar&&lr(()=>W.isReadableStream(new Response("").body)),ut={stream:Wt&&(r=>r.body)};Ct&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ut[e]&&(ut[e]=W.isFunction(r[e])?n=>n[e]():(n,t)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,t)})})})(new Response);const to=async r=>{if(r==null)return 0;if(W.isBlob(r))return r.size;if(W.isSpecCompliantForm(r))return(await new Request(ge.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(W.isArrayBufferView(r)||W.isArrayBuffer(r))return r.byteLength;if(W.isURLSearchParams(r)&&(r=r+""),W.isString(r))return(await Zi(r)).byteLength},no=async(r,e)=>{const n=W.toFiniteNumber(r.getContentLength());return n??to(e)},ro=Ct&&(async r=>{let{url:e,method:n,data:t,signal:i,cancelToken:s,timeout:o,onDownloadProgress:p,onUploadProgress:d,responseType:v,headers:b,withCredentials:w="same-origin",fetchOptions:C}=sr(r);v=v?(v+"").toLowerCase():"text";let P=Ji([i,s&&s.toAbortSignal()],o),l;const A=P&&P.unsubscribe&&(()=>{P.unsubscribe()});let R;try{if(d&&eo&&n!=="get"&&n!=="head"&&(R=await no(b,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),c;if(W.isFormData(t)&&(c=f.headers.get("content-type"))&&b.setContentType(c),f.body){const[u,a]=cn(R,lt(fn(d)));t=hn(f.body,pn,u,a)}}W.isString(w)||(w=w?"include":"omit");const I="credentials"in Request.prototype;l=new Request(e,{...C,signal:P,method:n.toUpperCase(),headers:b.normalize().toJSON(),body:t,duplex:"half",credentials:I?w:void 0});let y=await fetch(l,C);const m=Wt&&(v==="stream"||v==="response");if(Wt&&(p||m&&A)){const f={};["status","statusText","headers"].forEach(g=>{f[g]=y[g]});const c=W.toFiniteNumber(y.headers.get("content-length")),[u,a]=p&&cn(c,lt(fn(p),!0))||[];y=new Response(hn(y.body,pn,u,()=>{a&&a(),A&&A()}),f)}v=v||"text";let T=await ut[W.findKey(ut,v)||"text"](y,r);return!m&&A&&A(),await new Promise((f,c)=>{ir(f,c,{data:T,headers:Ce.from(y.headers),status:y.status,statusText:y.statusText,config:r,request:l})})}catch(I){throw A&&A(),I&&I.name==="TypeError"&&/Load failed|fetch/i.test(I.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,r,l),{cause:I.cause||I}):te.from(I,I&&I.code,r,l)}}),qt={http:yi,xhr:Ki,fetch:ro};W.forEach(qt,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const gn=r=>`- ${r}`,oo=r=>W.isFunction(r)||r===null||r===!1,ur={getAdapter:r=>{r=W.isArray(r)?r:[r];const{length:e}=r;let n,t;const i={};for(let s=0;s<e;s++){n=r[s];let o;if(t=n,!oo(n)&&(t=qt[(o=String(n)).toLowerCase()],t===void 0))throw new te(`Unknown adapter '${o}'`);if(t)break;i[o||"#"+s]=t}if(!t){const s=Object.entries(i).map(([p,d])=>`adapter ${p} `+(d===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(gn).join(`
`):" "+gn(s[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return t},adapters:qt};function Lt(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new ze(null,r)}function vn(r){return Lt(r),r.headers=Ce.from(r.headers),r.data=Mt.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),ur.getAdapter(r.adapter||Xe.adapter)(r).then(function(t){return Lt(r),t.data=Mt.call(r,r.transformResponse,t),t.headers=Ce.from(t.headers),t},function(t){return rr(t)||(Lt(r),t&&t.response&&(t.response.data=Mt.call(r,r.transformResponse,t.response),t.response.headers=Ce.from(t.response.headers))),Promise.reject(t)})}const cr="1.10.0",At={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{At[r]=function(t){return typeof t===r||"a"+(e<1?"n ":" ")+r}});const mn={};At.transitional=function(e,n,t){function i(s,o){return"[Axios v"+cr+"] Transitional option '"+s+"'"+o+(t?". "+t:"")}return(s,o,p)=>{if(e===!1)throw new te(i(o," has been removed"+(n?" in "+n:"")),te.ERR_DEPRECATED);return n&&!mn[o]&&(mn[o]=!0,console.warn(i(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(s,o,p):!0}};At.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function so(r,e,n){if(typeof r!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const t=Object.keys(r);let i=t.length;for(;i-- >0;){const s=t[i],o=e[s];if(o){const p=r[s],d=p===void 0||o(p,s,r);if(d!==!0)throw new te("option "+s+" must be "+d,te.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new te("Unknown option "+s,te.ERR_BAD_OPTION)}}const st={assertOptions:so,validators:At},Ie=st.validators;let je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ln,response:new ln}}async request(e,n){try{return await this._request(e,n)}catch(t){if(t instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{t.stack?s&&!String(t.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+s):t.stack=s}catch{}}throw t}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Ue(this.defaults,n);const{transitional:t,paramsSerializer:i,headers:s}=n;t!==void 0&&st.assertOptions(t,{silentJSONParsing:Ie.transitional(Ie.boolean),forcedJSONParsing:Ie.transitional(Ie.boolean),clarifyTimeoutError:Ie.transitional(Ie.boolean)},!1),i!=null&&(W.isFunction(i)?n.paramsSerializer={serialize:i}:st.assertOptions(i,{encode:Ie.function,serialize:Ie.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),st.assertOptions(n,{baseUrl:Ie.spelling("baseURL"),withXsrfToken:Ie.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=s&&W.merge(s.common,s[n.method]);s&&W.forEach(["delete","get","head","post","put","patch","common"],l=>{delete s[l]}),n.headers=Ce.concat(o,s);const p=[];let d=!0;this.interceptors.request.forEach(function(A){typeof A.runWhen=="function"&&A.runWhen(n)===!1||(d=d&&A.synchronous,p.unshift(A.fulfilled,A.rejected))});const v=[];this.interceptors.response.forEach(function(A){v.push(A.fulfilled,A.rejected)});let b,w=0,C;if(!d){const l=[vn.bind(this),void 0];for(l.unshift.apply(l,p),l.push.apply(l,v),C=l.length,b=Promise.resolve(n);w<C;)b=b.then(l[w++],l[w++]);return b}C=p.length;let P=n;for(w=0;w<C;){const l=p[w++],A=p[w++];try{P=l(P)}catch(R){A.call(this,R);break}}try{b=vn.call(this,P)}catch(l){return Promise.reject(l)}for(w=0,C=v.length;w<C;)b=b.then(v[w++],v[w++]);return b}getUri(e){e=Ue(this.defaults,e);const n=or(e.baseURL,e.url,e.allowAbsoluteUrls);return er(n,e.params,e.paramsSerializer)}};W.forEach(["delete","get","head","options"],function(e){je.prototype[e]=function(n,t){return this.request(Ue(t||{},{method:e,url:n,data:(t||{}).data}))}});W.forEach(["post","put","patch"],function(e){function n(t){return function(s,o,p){return this.request(Ue(p||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}je.prototype[e]=n(),je.prototype[e+"Form"]=n(!0)});let ao=class fr{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const t=this;this.promise.then(i=>{if(!t._listeners)return;let s=t._listeners.length;for(;s-- >0;)t._listeners[s](i);t._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(p=>{t.subscribe(p),s=p}).then(i);return o.cancel=function(){t.unsubscribe(s)},o},e(function(s,o,p){t.reason||(t.reason=new ze(s,o,p),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=t=>{e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new fr(function(i){e=i}),cancel:e}}};function lo(r){return function(n){return r.apply(null,n)}}function uo(r){return W.isObject(r)&&r.isAxiosError===!0}const $t={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries($t).forEach(([r,e])=>{$t[e]=r});function dr(r){const e=new je(r),n=Gn(je.prototype.request,e);return W.extend(n,je.prototype,e,{allOwnKeys:!0}),W.extend(n,e,null,{allOwnKeys:!0}),n.create=function(i){return dr(Ue(r,i))},n}const ue=dr(Xe);ue.Axios=je;ue.CanceledError=ze;ue.CancelToken=ao;ue.isCancel=rr;ue.VERSION=cr;ue.toFormData=Ot;ue.AxiosError=te;ue.Cancel=ue.CanceledError;ue.all=function(e){return Promise.all(e)};ue.spread=lo;ue.isAxiosError=uo;ue.mergeConfig=Ue;ue.AxiosHeaders=Ce;ue.formToJSON=r=>nr(W.isHTMLForm(r)?new FormData(r):r);ue.getAdapter=ur.getAdapter;ue.HttpStatusCode=$t;ue.default=ue;const{Axios:Xa,AxiosError:Ya,CanceledError:Za,isCancel:el,CancelToken:tl,VERSION:nl,all:rl,Cancel:il,isAxiosError:ol,spread:sl,toFormData:al,AxiosHeaders:ll,HttpStatusCode:ul,formToJSON:cl,getAdapter:fl,mergeConfig:dl}=ue;function co(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function he(r,e,n){return e=He(e),ho(r,hr()?Reflect.construct(e,n||[],He(r).constructor):e.apply(r,n))}function se(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function fo(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,mo(t.key),t)}}function ae(r,e,n){return e&&fo(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Se(){return Se=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)({}).hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r},Se.apply(null,arguments)}function Kt(){return Kt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,n){var t=po(r,e);if(t){var i=Object.getOwnPropertyDescriptor(t,e);return i.get?i.get.call(arguments.length<3?r:n):i.value}},Kt.apply(null,arguments)}function He(r){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},He(r)}function pe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Jt(r,e)}function hr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hr=function(){return!!r})()}function ho(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return co(r)}function Me(){Me=function(){return e};var r,e={},n=Object.prototype,t=n.hasOwnProperty,i=Object.defineProperty||function(E,S,_){E[S]=_.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",p=s.asyncIterator||"@@asyncIterator",d=s.toStringTag||"@@toStringTag";function v(E,S,_){return Object.defineProperty(E,S,{value:_,enumerable:!0,configurable:!0,writable:!0}),E[S]}try{v({},"")}catch{v=function(S,_,U){return S[_]=U}}function b(E,S,_,U){var F=S&&S.prototype instanceof I?S:I,z=Object.create(F.prototype),q=new L(U||[]);return i(z,"_invoke",{value:h(E,_,q)}),z}function w(E,S,_){try{return{type:"normal",arg:E.call(S,_)}}catch(U){return{type:"throw",arg:U}}}e.wrap=b;var C="suspendedStart",P="suspendedYield",l="executing",A="completed",R={};function I(){}function y(){}function m(){}var T={};v(T,o,function(){return this});var f=Object.getPrototypeOf,c=f&&f(f(M([])));c&&c!==n&&t.call(c,o)&&(T=c);var u=m.prototype=I.prototype=Object.create(T);function a(E){["next","throw","return"].forEach(function(S){v(E,S,function(_){return this._invoke(S,_)})})}function g(E,S){function _(F,z,q,G){var x=w(E[F],E,z);if(x.type!=="throw"){var D=x.arg,j=D.value;return j&&typeof j=="object"&&t.call(j,"__await")?S.resolve(j.__await).then(function(B){_("next",B,q,G)},function(B){_("throw",B,q,G)}):S.resolve(j).then(function(B){D.value=B,q(D)},function(B){return _("throw",B,q,G)})}G(x.arg)}var U;i(this,"_invoke",{value:function(F,z){function q(){return new S(function(G,x){_(F,z,G,x)})}return U=U?U.then(q,q):q()}})}function h(E,S,_){var U=C;return function(F,z){if(U===l)throw Error("Generator is already running");if(U===A){if(F==="throw")throw z;return{value:r,done:!0}}for(_.method=F,_.arg=z;;){var q=_.delegate;if(q){var G=O(q,_);if(G){if(G===R)continue;return G}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(U===C)throw U=A,_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);U=l;var x=w(E,S,_);if(x.type==="normal"){if(U=_.done?A:P,x.arg===R)continue;return{value:x.arg,done:_.done}}x.type==="throw"&&(U=A,_.method="throw",_.arg=x.arg)}}}function O(E,S){var _=S.method,U=E.iterator[_];if(U===r)return S.delegate=null,_==="throw"&&E.iterator.return&&(S.method="return",S.arg=r,O(E,S),S.method==="throw")||_!=="return"&&(S.method="throw",S.arg=new TypeError("The iterator does not provide a '"+_+"' method")),R;var F=w(U,E.iterator,S.arg);if(F.type==="throw")return S.method="throw",S.arg=F.arg,S.delegate=null,R;var z=F.arg;return z?z.done?(S[E.resultName]=z.value,S.next=E.nextLoc,S.method!=="return"&&(S.method="next",S.arg=r),S.delegate=null,R):z:(S.method="throw",S.arg=new TypeError("iterator result is not an object"),S.delegate=null,R)}function N(E){var S={tryLoc:E[0]};1 in E&&(S.catchLoc=E[1]),2 in E&&(S.finallyLoc=E[2],S.afterLoc=E[3]),this.tryEntries.push(S)}function k(E){var S=E.completion||{};S.type="normal",delete S.arg,E.completion=S}function L(E){this.tryEntries=[{tryLoc:"root"}],E.forEach(N,this),this.reset(!0)}function M(E){if(E||E===""){var S=E[o];if(S)return S.call(E);if(typeof E.next=="function")return E;if(!isNaN(E.length)){var _=-1,U=function F(){for(;++_<E.length;)if(t.call(E,_))return F.value=E[_],F.done=!1,F;return F.value=r,F.done=!0,F};return U.next=U}}throw new TypeError(typeof E+" is not iterable")}return y.prototype=m,i(u,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:y,configurable:!0}),y.displayName=v(m,d,"GeneratorFunction"),e.isGeneratorFunction=function(E){var S=typeof E=="function"&&E.constructor;return!!S&&(S===y||(S.displayName||S.name)==="GeneratorFunction")},e.mark=function(E){return Object.setPrototypeOf?Object.setPrototypeOf(E,m):(E.__proto__=m,v(E,d,"GeneratorFunction")),E.prototype=Object.create(u),E},e.awrap=function(E){return{__await:E}},a(g.prototype),v(g.prototype,p,function(){return this}),e.AsyncIterator=g,e.async=function(E,S,_,U,F){F===void 0&&(F=Promise);var z=new g(b(E,S,_,U),F);return e.isGeneratorFunction(S)?z:z.next().then(function(q){return q.done?q.value:z.next()})},a(u),v(u,d,"Generator"),v(u,o,function(){return this}),v(u,"toString",function(){return"[object Generator]"}),e.keys=function(E){var S=Object(E),_=[];for(var U in S)_.push(U);return _.reverse(),function F(){for(;_.length;){var z=_.pop();if(z in S)return F.value=z,F.done=!1,F}return F.done=!0,F}},e.values=M,L.prototype={constructor:L,reset:function(E){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(k),!E)for(var S in this)S.charAt(0)==="t"&&t.call(this,S)&&!isNaN(+S.slice(1))&&(this[S]=r)},stop:function(){this.done=!0;var E=this.tryEntries[0].completion;if(E.type==="throw")throw E.arg;return this.rval},dispatchException:function(E){if(this.done)throw E;var S=this;function _(x,D){return z.type="throw",z.arg=E,S.next=x,D&&(S.method="next",S.arg=r),!!D}for(var U=this.tryEntries.length-1;U>=0;--U){var F=this.tryEntries[U],z=F.completion;if(F.tryLoc==="root")return _("end");if(F.tryLoc<=this.prev){var q=t.call(F,"catchLoc"),G=t.call(F,"finallyLoc");if(q&&G){if(this.prev<F.catchLoc)return _(F.catchLoc,!0);if(this.prev<F.finallyLoc)return _(F.finallyLoc)}else if(q){if(this.prev<F.catchLoc)return _(F.catchLoc,!0)}else{if(!G)throw Error("try statement without catch or finally");if(this.prev<F.finallyLoc)return _(F.finallyLoc)}}}},abrupt:function(E,S){for(var _=this.tryEntries.length-1;_>=0;--_){var U=this.tryEntries[_];if(U.tryLoc<=this.prev&&t.call(U,"finallyLoc")&&this.prev<U.finallyLoc){var F=U;break}}F&&(E==="break"||E==="continue")&&F.tryLoc<=S&&S<=F.finallyLoc&&(F=null);var z=F?F.completion:{};return z.type=E,z.arg=S,F?(this.method="next",this.next=F.finallyLoc,R):this.complete(z)},complete:function(E,S){if(E.type==="throw")throw E.arg;return E.type==="break"||E.type==="continue"?this.next=E.arg:E.type==="return"?(this.rval=this.arg=E.arg,this.method="return",this.next="end"):E.type==="normal"&&S&&(this.next=S),R},finish:function(E){for(var S=this.tryEntries.length-1;S>=0;--S){var _=this.tryEntries[S];if(_.finallyLoc===E)return this.complete(_.completion,_.afterLoc),k(_),R}},catch:function(E){for(var S=this.tryEntries.length-1;S>=0;--S){var _=this.tryEntries[S];if(_.tryLoc===E){var U=_.completion;if(U.type==="throw"){var F=U.arg;k(_)}return F}}throw Error("illegal catch attempt")},delegateYield:function(E,S,_){return this.delegate={iterator:M(E),resultName:S,nextLoc:_},this.method==="next"&&(this.arg=r),R}},e}function Jt(r,e){return Jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},Jt(r,e)}function po(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=He(r))!==null;);return r}function go(r,e,n,t){var i=Kt(He(r.prototype),e,n);return typeof i=="function"?function(s){return i.apply(n,s)}:i}function vo(r,e){if(typeof r!="object"||!r)return r;var n=r[Symbol.toPrimitive];if(n!==void 0){var t=n.call(r,e);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function mo(r){var e=vo(r,"string");return typeof e=="symbol"?e:e+""}function Ke(r){"@babel/helpers - typeof";return Ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(r)}var wt=function(){function r(){se(this,r)}return ae(r,[{key:"listenForWhisper",value:function(n,t){return this.listen(".client-"+n,t)}},{key:"notification",value:function(n){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",n)}},{key:"stopListeningForWhisper",value:function(n,t){return this.stopListening(".client-"+n,t)}}])}();function ct(r,e){var n={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.indexOf(t)<0&&(n[t]=r[t]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,t=Object.getOwnPropertySymbols(r);i<t.length;i++)e.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(r,t[i])&&(n[t[i]]=r[t[i]]);return n}function ft(r,e,n,t){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function p(b){try{v(t.next(b))}catch(w){o(w)}}function d(b){try{v(t.throw(b))}catch(w){o(w)}}function v(b){b.done?s(b.value):i(b.value).then(p,d)}v((t=t.apply(r,[])).next())})}var tn=function(){function r(e){se(this,r),this.namespace=e}return ae(r,[{key:"format",value:function(n){return[".","\\"].includes(n.charAt(0))?n.substring(1):(this.namespace&&(n=this.namespace+"."+n),n.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(n){this.namespace=n}}])}(),nn=function(r){function e(n,t,i){var s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return se(this,e),s=he(this,e),s._alertErrorListeners=function(p){p&&s.errorListeners.forEach(function(d){return d(p)})},s.name=t,s.ably=n,s.options=i,s.eventFormatter=new tn(s.options.namespace),s.subscribedListeners=[],s.errorListeners=[],s.channel=n.channels.get(t),s.callbacks=new Map,o&&s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){var t=this;this.channel.on(function(i){var s=i.previous,o=i.current,p=i.reason;s!=="attached"&&o=="attached"?t.subscribedListeners.forEach(function(d){return d()}):p&&t._alertErrorListeners(i)}),this.channel.attach(this._alertErrorListeners)}},{key:"unsubscribe",value:function(){this.channel.unsubscribe(),this.callbacks.clear(),this.unregisterError(),this.unregisterSubscribed(),this.channel.off(),this.channel.detach()}},{key:"listen",value:function(t,i){return this.callbacks.set(i,function(s){var o=s.data,p=ct(s,["data"]);return i(o,p)}),this.channel.subscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this}},{key:"listenToAll",value:function(t){var i=this;return this.callbacks.set(t,function(s){var o=s.name,p=s.data,d=ct(s,["name","data"]),v=i.options.namespace.replace(/\./g,"\\"),b=o.startsWith(v)?o.substring(v.length+1):"."+o;t(b,p,d)}),this.channel.subscribe(this.callbacks.get(t)),this}},{key:"stopListening",value:function(t,i){return i?(this.channel.unsubscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this.callbacks.delete(i)):this.channel.unsubscribe(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?(this.channel.unsubscribe(this.callbacks.get(t)),this.callbacks.delete(t)):this.channel.unsubscribe(),this}},{key:"subscribed",value:function(t){return this.subscribedListeners.push(t),this}},{key:"error",value:function(t){return this.errorListeners.push(t),this}},{key:"unregisterSubscribed",value:function(t){return t?this.subscribedListeners=this.subscribedListeners.filter(function(i){return i!=t}):this.subscribedListeners=[],this}},{key:"unregisterError",value:function(t){return t?this.errorListeners=this.errorListeners.filter(function(i){return i!=t}):this.errorListeners=[],this}}])}(wt),yo=function(r){function e(n,t,i,s){var o;return se(this,e),o=he(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.subscribe(),o}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(nn),pr=function(r){function e(n,t,i,s){var o;return se(this,e),o=he(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.channel.on("attached",function(){return o.enter(o.presenceData,o._alertErrorListeners)}),o.subscribe(),o}return pe(e,r),ae(e,[{key:"unsubscribe",value:function(){this.leave(this.presenceData,this._alertErrorListeners),this.channel.presence.unsubscribe(),go(e,"unsubscribe",this)([])}},{key:"here",value:function(t){var i=this;return this.channel.presence.subscribe(["enter","update","leave"],function(){return i.channel.presence.get(function(s,o){return t(o.map(function(p){var d=p.data;return d}),s)})}),this}},{key:"joining",value:function(t){return this.channel.presence.subscribe(["enter","update"],function(i){var s=i.data,o=ct(i,["data"]);t(s,o)}),this}},{key:"leaving",value:function(t){return this.channel.presence.subscribe("leave",function(i){var s=i.data,o=ct(i,["data"]);t(s,o)}),this}},{key:"enter",value:function(t,i){return this.channel.presence.enter(t,i),this}},{key:"leave",value:function(t,i){return this.channel.presence.leave(t,i),this}},{key:"update",value:function(t,i){return this.channel.presence.update(t,i),this}},{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(nn),bo=function(e){return e==null||e===void 0},gr=function(e){var n=e.split(".")[0],t=n.replace("-","+").replace("_","/"),i=JSON.parse(yn(t)),s=e.split(".")[1],o=s.replace("-","+").replace("_","/"),p=JSON.parse(yn(o));return{header:i,payload:p}},kt=function(e){var n=gr(e),t=n.payload;return{clientId:t["x-ably-clientId"],expires:t.exp*1e3,issued:t.iat*1e3,token:e}},St=(typeof window>"u"?"undefined":Ke(window))==="object",yn=function(e){var n=e.replace(/-/g,"+").replace(/_/g,"/"),t=e.length%4===0?"":"=".repeat(4-e.length%4),i=n+t;return St?atob(i):Buffer.from(i,"base64").toString()},Oo=function(e){var n="";return St?n=btoa(e):n=Buffer.from(e).toString("base64"),n.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},Co=function(e){return e&&e.indexOf("http://")===0||e.indexOf("https://")===0},Ao=function(e){var n,t,i;if(!Co(e)&&typeof window<"u"){var s=(n=window==null?void 0:window.location)===null||n===void 0?void 0:n.hostname,o=(t=window==null?void 0:window.location)===null||t===void 0?void 0:t.port,p=(i=window==null?void 0:window.location)===null||i===void 0?void 0:i.protocol.replace(":","");if(s&&o&&p)return p+"://"+s+":"+o+e}return e},Nt;function wo(r,e){Nt||(Nt=new Ably.Rest.Platform.Http),St?delete r.headers["Content-Length"]:r.method=r.method.toLowerCase(),Nt.doUri(r.method,null,r.uri,r.headers,r.body,r.paramsIfNoHeaders||{},e)}var So=function(e){return new Promise(function(n,t){wo(e,function(i,s){if(i)t(i);else if(typeof s=="string")n(JSON.parse(s));else if(!St&&Buffer.isBuffer(s))try{n(JSON.parse(s.toString()))}catch{n(s)}else n(s)})})},bn=!1,Eo=function(e,n){var t=e.channels.get("dummy");if(t.__proto__.authorizeChannel=n,bn)return;var i=t.__proto__._attach;if(bo(i)){console.warn("Failed to enable authorize for pre-attach, please check for right library version");return}function s(o,p,d){var v=this;if(!this.authorizing){this.authorizing=!0;var b=i.bind(this);this.authorizeChannel(this,function(w){if(v.authorizing=!1,w){d?d(w):console.error("channel ".concat(v.name," auth error => ").concat(w));return}else b(o,p,d)})}}t.__proto__._attach=s,bn=!0},Ro=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;se(this,r),this.execute=function(i){return new Promise(function(s,o){e.queue.run(function(){return ft(e,void 0,void 0,Me().mark(function p(){var d,v,b;return Me().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.prev=0,C.next=3,i(this.cachedToken);case 3:d=C.sent,v=d.token,b=d.info,this.cachedToken=v,s({token:v,info:b}),C.next=13;break;case 10:C.prev=10,C.t0=C.catch(0),o(C.t0);case 13:case"end":return C.stop()}},p,this,[[0,10]])}))})})},this.request=function(i){return e.execute(function(s){return e.requestTokenFn(i,s)})},this.cachedToken=n,this.requestTokenFn=t,this.queue=new To}),To=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;se(this,r),this.canRunNext=function(){return e.running.length<e.count&&e.todo.length},this.run=function(i){return ft(e,void 0,void 0,Me().mark(function s(){var o;return Me().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:i&&this.todo.push(i);case 1:if(!this.canRunNext()){d.next=9;break}return o=this.todo.shift(),this.running.push(o),d.next=6,o();case 6:this.running.shift(),d.next=1;break;case 9:case"end":return d.stop()}},s,this)}))},this.total=n.length,this.todo=n,this.running=[],this.count=t}),Io=ae(function r(e,n){var t=this;se(this,r),this.expiredAuthChannels=new Set,this.setExpired=function(d){return t.expiredAuthChannels.add(d)},this.isExpired=function(d){return t.expiredAuthChannels.has(d)},this.removeExpired=function(d){return t.expiredAuthChannels.delete(d)},this.options={queryTime:!0,useTokenAuth:!0,authCallback:function(v,b){return ft(t,void 0,void 0,Me().mark(function w(){var C,P,l;return Me().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.prev=0,R.next=3,this.authRequestExecuter.request(null);case 3:C=R.sent,P=C.token,l=kt(P),b(null,l),R.next=12;break;case 9:R.prev=9,R.t0=R.catch(0),b(R.t0,null);case 12:case"end":return R.stop()}},w,this,[[0,9]])}))},echoMessages:!1},this.requestToken=function(d,v){return ft(t,void 0,void 0,Me().mark(function b(){var w,C;return Me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return w=JSON.stringify({channel_name:d,token:v}),C={uri:this.authEndpoint,method:"POST",headers:Se({Accept:"application/json","Content-Type":"application/json","Content-Length":w.length},this.authHeaders),body:w},l.next=4,So(C);case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},b,this)}))},this.ablyClient=function(){return t.ablyConnector.ably},this.existingToken=function(){return t.ablyClient().auth.tokenDetails},this.getChannel=function(d){return t.ablyConnector.channels[d]},this.enableAuthorizeBeforeChannelAttach=function(){var d=t.ablyClient();d.auth.getTimestamp(t.options.queryTime,function(){}),Eo(d,function(v,b){var w=v.name;if(w.startsWith("public:")){b(null);return}var C=t.existingToken();if(C&&!t.isExpired(w)){var P=gr(C.token).payload["x-ably-capability"],l=P.includes("".concat(w,'"'));if(l&&C.expires>d.auth.getTimestampUsingOffset()){b(null);return}}t.authRequestExecuter.request(w).then(function(A){var R=A.token,I=A.info,y=t.getChannel(w);t.setPresenceInfo(y,I),t.tryAuthorizeOnSameConnection(Se(Se({},t.options),{token:kt(R)}),function(m,T){m?b(m):(t.removeExpired(w),b(null))})}).catch(function(A){return b(A)})})},this.allowReconnectOnUserLogin=function(){var d=t.ablyClient().connection,v=function(w){w.reason.code==40102&&(d.off(v),console.warn("User login detected, re-connecting again!"),t.onClientIdChanged())};d.on("failed",v)},this.onClientIdChanged=function(){t.ablyClient().connect();for(var d=0,v=Object.values(t.ablyConnector.channels);d<v.length;d++){var b=v[d];b.channel.attach(b._alertErrorListeners)}},this.tryAuthorizeOnSameConnection=function(d,v){t.ablyClient().auth.authorize(null,d,v)},this.onChannelFailed=function(d){return function(v){var b;((b=v.reason)===null||b===void 0?void 0:b.code)==40160&&t.handleChannelAuthError(d)}},this.handleChannelAuthError=function(d){if(!d.skipAuth){var v=d.name;t.authRequestExecuter.request(v).then(function(b){var w=b.token,C=b.info;t.setPresenceInfo(d,C),t.tryAuthorizeOnSameConnection(Se(Se({},t.options),{token:kt(w)}),function(P,l){P?d._alertErrorListeners(P):(d.skipAuth=!0,d.channel.once("attached",function(){d.skipAuth=!1}),d.channel.attach(d._alertErrorListeners))})}).catch(function(b){return d._alertErrorListeners(b)})}},this.setPresenceInfo=function(d,v){d instanceof pr&&(d.presenceData=v)},this.ablyConnector=e;var i=n.authEndpoint,s=n.auth.headers,o=n.token,p=n.requestTokenFn;this.authEndpoint=Ao(i),this.authHeaders=s,this.authRequestExecuter=new Ro(o,p??this.requestToken)}),Et=function(r){function e(n,t,i){var s;return se(this,e),s=he(this,e),s.name=t,s.pusher=n,s.options=i,s.eventFormatter=new tn(s.options.namespace),s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"listenToAll",value:function(t){var i=this;return this.subscription.bind_global(function(s,o){if(!s.startsWith("pusher:")){var p=i.options.namespace.replace(/\./g,"\\"),d=s.startsWith(p)?s.substring(p.length+1):"."+s;t(d,o)}}),this}},{key:"stopListening",value:function(t,i){return i?this.subscription.unbind(this.eventFormatter.format(t),i):this.subscription.unbind(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?this.subscription.unbind_global(t):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(t){return this.on("pusher:subscription_succeeded",function(){t()}),this}},{key:"error",value:function(t){return this.on("pusher:subscription_error",function(i){t(i)}),this}},{key:"on",value:function(t,i){return this.subscription.bind(t,i),this}}])}(wt),Po=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(Et),xo=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(Et),Mo=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this.on("pusher:subscription_succeeded",function(i){t(Object.keys(i.members).map(function(s){return i.members[s]}))}),this}},{key:"joining",value:function(t){return this.on("pusher:member_added",function(i){t(i.info)}),this}},{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}},{key:"leaving",value:function(t){return this.on("pusher:member_removed",function(i){t(i.info)}),this}}])}(Et),vr=function(r){function e(n,t,i){var s;return se(this,e),s=he(this,e),s.events={},s.listeners={},s.name=t,s.socket=n,s.options=i,s.eventFormatter=new tn(s.options.namespace),s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"stopListening",value:function(t,i){return this.unbindEvent(this.eventFormatter.format(t),i),this}},{key:"subscribed",value:function(t){return this.on("connect",function(i){t(i)}),this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){var s=this;return this.listeners[t]=this.listeners[t]||[],this.events[t]||(this.events[t]=function(o,p){s.name===o&&s.listeners[t]&&s.listeners[t].forEach(function(d){return d(p)})},this.socket.on(t,this.events[t])),this.listeners[t].push(i),this}},{key:"unbind",value:function(){var t=this;Object.keys(this.events).forEach(function(i){t.unbindEvent(i)})}},{key:"unbindEvent",value:function(t,i){this.listeners[t]=this.listeners[t]||[],i&&(this.listeners[t]=this.listeners[t].filter(function(s){return s!==i})),(!i||this.listeners[t].length===0)&&(this.events[t]&&(this.socket.removeListener(t,this.events[t]),delete this.events[t]),delete this.listeners[t])}}])}(wt),mr=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}}])}(vr),Lo=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this.on("presence:subscribed",function(i){t(i.map(function(s){return s.user_info}))}),this}},{key:"joining",value:function(t){return this.on("presence:joining",function(i){return t(i.user_info)}),this}},{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}},{key:"leaving",value:function(t){return this.on("presence:leaving",function(i){return t(i.user_info)}),this}}])}(mr),dt=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(t,i){return this}},{key:"listenToAll",value:function(t){return this}},{key:"stopListening",value:function(t,i){return this}},{key:"subscribed",value:function(t){return this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){return this}}])}(wt),On=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this}}])}(dt),ko=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this}},{key:"joining",value:function(t){return this}},{key:"whisper",value:function(t,i){return this}},{key:"leaving",value:function(t){return this}}])}(dt),Rt=function(){function r(e){se(this,r),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(e),this.connect()}return ae(r,[{key:"setOptions",value:function(n){this.options=Se(this._defaultOptions,n);var t=this.csrfToken();return t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),t=this.options.bearerToken,t&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t),n}},{key:"csrfToken",value:function(){var n;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(n=document.querySelector('meta[name="csrf-token"]'))?n.getAttribute("content"):null}}])}(),Cn=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new Et(this.pusher,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new Po(this.pusher,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"encryptedPrivateChannel",value:function(t){return this.channels["private-encrypted-"+t]||(this.channels["private-encrypted-"+t]=new xo(this.pusher,"private-encrypted-"+t,this.options)),this.channels["private-encrypted-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new Mo(this.pusher,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"private-encrypted-"+t,"presence-"+t];s.forEach(function(o,p){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}])}(Rt),No=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){var t=this,i=this.getSocketIO();return this.socket=i(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(t.channels).forEach(function(s){s.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new vr(this.socket,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new mr(this.socket,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new Lo(this.socket,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"presence-"+t];s.forEach(function(o){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}])}(Rt),Do=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){}},{key:"listen",value:function(t,i,s){return new dt}},{key:"channel",value:function(t){return new dt}},{key:"privateChannel",value:function(t){return new On}},{key:"encryptedPrivateChannel",value:function(t){return new On}},{key:"presenceChannel",value:function(t){return new ko}},{key:"leave",value:function(t){}},{key:"leaveChannel",value:function(t){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}])}(Rt),yr=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.ably=this.options.client:(this.ablyAuth=new Io(this,this.options),this.options.agents||(this.options.agents={}),this.options.agents["laravel-echo"]=e.LIB_VERSION,this.ably=new Ably.Realtime(Se(Se({},this.ablyAuth.options),this.options)),this.ablyAuth.enableAuthorizeBeforeChannelAttach(),this.ablyAuth.allowReconnectOnUserLogin())}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){var i="public:".concat(t);return this.channels[i]||(this.channels[i]=new nn(this.ably,i,this.options)),this.channels[i]}},{key:"privateChannel",value:function(t){var i="private:".concat(t);return this.channels[i]||(this.channels[i]=new yo(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"presenceChannel",value:function(t){var i="presence:".concat(t);return this.channels[i]||(this.channels[i]=new pr(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"leave",value:function(t){var i=this,s=["public:".concat(t),"private:".concat(t),"presence:".concat(t)];s.forEach(function(o,p){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){if(t.indexOf("public:")!==0&&t.indexOf("private:")!==0&&t.indexOf("presence:")!==0)throw new Error("Error leaving ".concat(t,', name should be prefixed with either "public:", "private:" or "presence:"'));this.channels[t]&&(this.channels[t].unsubscribe(),this.ablyAuth.setExpired(t),delete this.channels[t])}},{key:"socketId",value:function(){var t,i={connectionKey:this.ably.connection.key,clientId:(t=this.ably.auth.clientId)!==null&&t!==void 0?t:null};return Oo(JSON.stringify(i))}},{key:"disconnect",value:function(){this.ably.close()}}])}(Rt);yr.LIB_VERSION="1.0.6";var _o=function(){function r(e){se(this,r),this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return ae(r,[{key:"channel",value:function(n){return this.connector.channel(n)}},{key:"connect",value:function(){if(this.options.broadcaster=="ably")this.connector=new yr(this.options);else if(this.options.broadcaster=="reverb")this.connector=new Cn(Se(Se({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new Cn(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new No(this.options);else if(this.options.broadcaster=="null")this.connector=new Do(this.options);else if(typeof this.options.broadcaster=="function")this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(Ke(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(n){return this.connector.presenceChannel(n)}},{key:"leave",value:function(n){this.connector.leave(n)}},{key:"leaveChannel",value:function(n){this.connector.leaveChannel(n)}},{key:"leaveAllChannels",value:function(){for(var n in this.connector.channels)this.leaveChannel(n)}},{key:"listen",value:function(n,t,i){return this.connector.listen(n,t,i)}},{key:"private",value:function(n){return this.connector.privateChannel(n)}},{key:"encryptedPrivate",value:function(n){return this.connector.encryptedPrivateChannel(n)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":Ke(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var n=this;Vue.http.interceptors.push(function(t,i){n.socketId()&&t.headers.set("X-Socket-ID",n.socketId()),i()})}},{key:"registerAxiosRequestInterceptor",value:function(){var n=this;axios.interceptors.request.use(function(t){return n.socketId()&&(t.headers["X-Socket-Id"]=n.socketId()),t})}},{key:"registerjQueryAjaxSetup",value:function(){var n=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(t,i,s){n.socketId()&&s.setRequestHeader("X-Socket-Id",n.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var n=this;document.addEventListener("turbo:before-fetch-request",function(t){t.detail.fetchOptions.headers["X-Socket-Id"]=n.socketId()})}}])}();function jo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var br={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(r,e){(function(t,i){r.exports=i()})(window,function(){return function(n){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=t,i.d=function(s,o,p){i.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:p})},i.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,o){if(o&1&&(s=i(s)),o&8||o&4&&typeof s=="object"&&s&&s.__esModule)return s;var p=Object.create(null);if(i.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:s}),o&2&&typeof s!="string")for(var d in s)i.d(p,d,(function(v){return s[v]}).bind(null,d));return p},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=42)}([function(n,t,i){i.r(t),i.d(t,"__extends",function(){return o}),i.d(t,"__assign",function(){return p}),i.d(t,"__rest",function(){return d}),i.d(t,"__decorate",function(){return v}),i.d(t,"__param",function(){return b}),i.d(t,"__metadata",function(){return w}),i.d(t,"__awaiter",function(){return C}),i.d(t,"__generator",function(){return P}),i.d(t,"__createBinding",function(){return l}),i.d(t,"__exportStar",function(){return A}),i.d(t,"__values",function(){return R}),i.d(t,"__read",function(){return I}),i.d(t,"__spread",function(){return y}),i.d(t,"__spreadArrays",function(){return m}),i.d(t,"__spreadArray",function(){return T}),i.d(t,"__await",function(){return f}),i.d(t,"__asyncGenerator",function(){return c}),i.d(t,"__asyncDelegator",function(){return u}),i.d(t,"__asyncValues",function(){return a}),i.d(t,"__makeTemplateObject",function(){return g}),i.d(t,"__importStar",function(){return O}),i.d(t,"__importDefault",function(){return N}),i.d(t,"__classPrivateFieldGet",function(){return k}),i.d(t,"__classPrivateFieldSet",function(){return L});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var s=function(M,E){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,_){S.__proto__=_}||function(S,_){for(var U in _)Object.prototype.hasOwnProperty.call(_,U)&&(S[U]=_[U])},s(M,E)};function o(M,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");s(M,E);function S(){this.constructor=M}M.prototype=E===null?Object.create(E):(S.prototype=E.prototype,new S)}var p=function(){return p=Object.assign||function(E){for(var S,_=1,U=arguments.length;_<U;_++){S=arguments[_];for(var F in S)Object.prototype.hasOwnProperty.call(S,F)&&(E[F]=S[F])}return E},p.apply(this,arguments)};function d(M,E){var S={};for(var _ in M)Object.prototype.hasOwnProperty.call(M,_)&&E.indexOf(_)<0&&(S[_]=M[_]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var U=0,_=Object.getOwnPropertySymbols(M);U<_.length;U++)E.indexOf(_[U])<0&&Object.prototype.propertyIsEnumerable.call(M,_[U])&&(S[_[U]]=M[_[U]]);return S}function v(M,E,S,_){var U=arguments.length,F=U<3?E:_===null?_=Object.getOwnPropertyDescriptor(E,S):_,z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")F=Reflect.decorate(M,E,S,_);else for(var q=M.length-1;q>=0;q--)(z=M[q])&&(F=(U<3?z(F):U>3?z(E,S,F):z(E,S))||F);return U>3&&F&&Object.defineProperty(E,S,F),F}function b(M,E){return function(S,_){E(S,_,M)}}function w(M,E){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(M,E)}function C(M,E,S,_){function U(F){return F instanceof S?F:new S(function(z){z(F)})}return new(S||(S=Promise))(function(F,z){function q(D){try{x(_.next(D))}catch(j){z(j)}}function G(D){try{x(_.throw(D))}catch(j){z(j)}}function x(D){D.done?F(D.value):U(D.value).then(q,G)}x((_=_.apply(M,E||[])).next())})}function P(M,E){var S={label:0,sent:function(){if(F[0]&1)throw F[1];return F[1]},trys:[],ops:[]},_,U,F,z;return z={next:q(0),throw:q(1),return:q(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function q(x){return function(D){return G([x,D])}}function G(x){if(_)throw new TypeError("Generator is already executing.");for(;S;)try{if(_=1,U&&(F=x[0]&2?U.return:x[0]?U.throw||((F=U.return)&&F.call(U),0):U.next)&&!(F=F.call(U,x[1])).done)return F;switch(U=0,F&&(x=[x[0]&2,F.value]),x[0]){case 0:case 1:F=x;break;case 4:return S.label++,{value:x[1],done:!1};case 5:S.label++,U=x[1],x=[0];continue;case 7:x=S.ops.pop(),S.trys.pop();continue;default:if(F=S.trys,!(F=F.length>0&&F[F.length-1])&&(x[0]===6||x[0]===2)){S=0;continue}if(x[0]===3&&(!F||x[1]>F[0]&&x[1]<F[3])){S.label=x[1];break}if(x[0]===6&&S.label<F[1]){S.label=F[1],F=x;break}if(F&&S.label<F[2]){S.label=F[2],S.ops.push(x);break}F[2]&&S.ops.pop(),S.trys.pop();continue}x=E.call(M,S)}catch(D){x=[6,D],U=0}finally{_=F=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var l=Object.create?function(M,E,S,_){_===void 0&&(_=S),Object.defineProperty(M,_,{enumerable:!0,get:function(){return E[S]}})}:function(M,E,S,_){_===void 0&&(_=S),M[_]=E[S]};function A(M,E){for(var S in M)S!=="default"&&!Object.prototype.hasOwnProperty.call(E,S)&&l(E,M,S)}function R(M){var E=typeof Symbol=="function"&&Symbol.iterator,S=E&&M[E],_=0;if(S)return S.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&_>=M.length&&(M=void 0),{value:M&&M[_++],done:!M}}};throw new TypeError(E?"Object is not iterable.":"Symbol.iterator is not defined.")}function I(M,E){var S=typeof Symbol=="function"&&M[Symbol.iterator];if(!S)return M;var _=S.call(M),U,F=[],z;try{for(;(E===void 0||E-- >0)&&!(U=_.next()).done;)F.push(U.value)}catch(q){z={error:q}}finally{try{U&&!U.done&&(S=_.return)&&S.call(_)}finally{if(z)throw z.error}}return F}function y(){for(var M=[],E=0;E<arguments.length;E++)M=M.concat(I(arguments[E]));return M}function m(){for(var M=0,E=0,S=arguments.length;E<S;E++)M+=arguments[E].length;for(var _=Array(M),U=0,E=0;E<S;E++)for(var F=arguments[E],z=0,q=F.length;z<q;z++,U++)_[U]=F[z];return _}function T(M,E,S){if(S||arguments.length===2)for(var _=0,U=E.length,F;_<U;_++)(F||!(_ in E))&&(F||(F=Array.prototype.slice.call(E,0,_)),F[_]=E[_]);return M.concat(F||Array.prototype.slice.call(E))}function f(M){return this instanceof f?(this.v=M,this):new f(M)}function c(M,E,S){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _=S.apply(M,E||[]),U,F=[];return U={},z("next"),z("throw"),z("return"),U[Symbol.asyncIterator]=function(){return this},U;function z(B){_[B]&&(U[B]=function(V){return new Promise(function(J,Q){F.push([B,V,J,Q])>1||q(B,V)})})}function q(B,V){try{G(_[B](V))}catch(J){j(F[0][3],J)}}function G(B){B.value instanceof f?Promise.resolve(B.value.v).then(x,D):j(F[0][2],B)}function x(B){q("next",B)}function D(B){q("throw",B)}function j(B,V){B(V),F.shift(),F.length&&q(F[0][0],F[0][1])}}function u(M){var E,S;return E={},_("next"),_("throw",function(U){throw U}),_("return"),E[Symbol.iterator]=function(){return this},E;function _(U,F){E[U]=M[U]?function(z){return(S=!S)?{value:f(M[U](z)),done:U==="return"}:F?F(z):z}:F}}function a(M){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var E=M[Symbol.asyncIterator],S;return E?E.call(M):(M=typeof R=="function"?R(M):M[Symbol.iterator](),S={},_("next"),_("throw"),_("return"),S[Symbol.asyncIterator]=function(){return this},S);function _(F){S[F]=M[F]&&function(z){return new Promise(function(q,G){z=M[F](z),U(q,G,z.done,z.value)})}}function U(F,z,q,G){Promise.resolve(G).then(function(x){F({value:x,done:q})},z)}}function g(M,E){return Object.defineProperty?Object.defineProperty(M,"raw",{value:E}):M.raw=E,M}var h=Object.create?function(M,E){Object.defineProperty(M,"default",{enumerable:!0,value:E})}:function(M,E){M.default=E};function O(M){if(M&&M.__esModule)return M;var E={};if(M!=null)for(var S in M)S!=="default"&&Object.prototype.hasOwnProperty.call(M,S)&&l(E,M,S);return h(E,M),E}function N(M){return M&&M.__esModule?M:{default:M}}function k(M,E,S,_){if(S==="a"&&!_)throw new TypeError("Private accessor was defined without a getter");if(typeof E=="function"?M!==E||!_:!E.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?_:S==="a"?_.call(M):_?_.value:E.get(M)}function L(M,E,S,_,U){if(_==="m")throw new TypeError("Private method is not writable");if(_==="a"&&!U)throw new TypeError("Private accessor was defined without a setter");if(typeof E=="function"?M!==E||!U:!E.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return _==="a"?U.call(M,S):U?U.value=S:E.set(M,S),S}},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.allToUpperCase=t.allToLowerCase=t.encodeBody=t.decodeBody=t.Format=t.promisify=t.trim=t.arrChooseN=t.randomHexString=t.randomString=t.cheapRandStr=t.dataSizeBytes=t.inspectBody=t.inspectError=t.isErrorInfoOrPartialErrorInfo=t.now=t.parseQueryString=t.toQueryString=t.arrPopRandomElement=t.defaultPostHeaders=t.defaultGetHeaders=t.allSame=t.arrEvery=t.arrFilter=t.arrMap=t.safeArrForEach=t.arrForEach=t.forInOwnNonNullProperties=t.valuesArray=t.keysArray=t.arrWithoutValue=t.arrDeleteValue=t.arrIn=t.arrIndexOf=t.arrSubtract=t.arrIntersectOb=t.arrIntersect=t.intersect=t.containsValue=t.inherits=t.prototypicalClone=t.shallowClone=t.isEmptyArg=t.isOnlyPropIn=t.isEmpty=t.isObject=t.ensureArray=t.isArray=t.copy=t.mixin=void 0,t.arrEquals=t.toBase64=t.matchDerivedChannel=t.shallowEquals=t.getGlobalObject=t.getRetryTime=t.getJitterCoefficient=t.getBackoffCoefficient=void 0;var o=i(0),p=o.__importDefault(i(3)),d=o.__importStar(i(8)),v=o.__importDefault(i(4)),b=i(11),w=i(31);function C(H){return Math.floor(Math.random()*H.length)}function P(H){for(var $=[],K=1;K<arguments.length;K++)$[K-1]=arguments[K];for(var Y=0;Y<$.length;Y++){var ne=$[Y];if(!ne)break;var be=Object.prototype.hasOwnProperty;for(var We in ne)(!be||be.call(ne,We))&&(H[We]=ne[We])}return H}t.mixin=P;function l(H){return P({},H)}t.copy=l,t.isArray=Array.isArray||function(H){return Object.prototype.toString.call(H)=="[object Array]"};function A(H){return m(H)?[]:(0,t.isArray)(H)?H:[H]}t.ensureArray=A;function R(H){return Object.prototype.toString.call(H)=="[object Object]"}t.isObject=R;function I(H){for(var $ in H)return!1;return!0}t.isEmpty=I;function y(H,$){for(var K in H)if(K!==$)return!1;return!0}t.isOnlyPropIn=y;function m(H){return H==null}t.isEmptyArg=m;function T(H){var $=new Object;for(var K in H)$[K]=H[K];return $}t.shallowClone=T;function f(H,$){var K=function(){function ne(){}return ne}();K.prototype=H;var Y=new K;return $&&P(Y,$),Y}t.prototypicalClone=f;var c=function(H,$){if(p.default.Config.inherits){p.default.Config.inherits(H,$);return}H.super_=$,H.prototype=f($.prototype,{constructor:H})};t.inherits=c;function u(H,$){for(var K in H)if(H[K]==$)return!0;return!1}t.containsValue=u;function a(H,$){return(0,t.isArray)($)?g(H,$):h(H,$)}t.intersect=a;function g(H,$){for(var K=[],Y=0;Y<H.length;Y++){var ne=H[Y];(0,t.arrIndexOf)($,ne)!=-1&&K.push(ne)}return K}t.arrIntersect=g;function h(H,$){for(var K=[],Y=0;Y<H.length;Y++){var ne=H[Y];ne in $&&K.push(ne)}return K}t.arrIntersectOb=h;function O(H,$){for(var K=[],Y=0;Y<H.length;Y++){var ne=H[Y];(0,t.arrIndexOf)($,ne)==-1&&K.push(ne)}return K}t.arrSubtract=O,t.arrIndexOf=Array.prototype.indexOf?function(H,$,K){return H.indexOf($,K)}:function(H,$,K){K=K||0;for(var Y=H.length;K<Y;K++)if(H[K]===$)return K;return-1};function N(H,$){return(0,t.arrIndexOf)(H,$)!==-1}t.arrIn=N;function k(H,$){var K=(0,t.arrIndexOf)(H,$),Y=K!=-1;return Y&&H.splice(K,1),Y}t.arrDeleteValue=k;function L(H,$){var K=H.slice();return k(K,$),K}t.arrWithoutValue=L;function M(H,$){var K=[];for(var Y in H)$&&!Object.prototype.hasOwnProperty.call(H,Y)||K.push(Y);return K}t.keysArray=M;function E(H,$){var K=[];for(var Y in H)$&&!Object.prototype.hasOwnProperty.call(H,Y)||K.push(H[Y]);return K}t.valuesArray=E;function S(H,$){for(var K in H)Object.prototype.hasOwnProperty.call(H,K)&&H[K]&&$(K)}t.forInOwnNonNullProperties=S,t.arrForEach=Array.prototype.forEach?function(H,$){H.forEach($)}:function(H,$){for(var K=H.length,Y=0;Y<K;Y++)$(H[Y],Y,H)};function _(H,$){return(0,t.arrForEach)(H.slice(),$)}t.safeArrForEach=_,t.arrMap=Array.prototype.map?function(H,$){return H.map($)}:function(H,$){for(var K=[],Y=H.length,ne=0;ne<Y;ne++)K.push($(H[ne],ne,H));return K},t.arrFilter=Array.prototype.filter?function(H,$){return H.filter($)}:function(H,$){for(var K=[],Y=H.length,ne=0;ne<Y;ne++)$(H[ne])&&K.push(H[ne]);return K},t.arrEvery=Array.prototype.every?function(H,$){return H.every($)}:function(H,$){for(var K=H.length,Y=0;Y<K;Y++)if(!$(H[Y],Y,H))return!1;return!0};function U(H,$){if(H.length===0)return!0;var K=H[0][$];return(0,t.arrEvery)(H,function(Y){return Y[$]===K})}t.allSame=U;var F={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function z(H,$){var K=F[$||ie.json];return{accept:K,"X-Ably-Version":d.default.protocolVersion.toString(),"Ably-Agent":(0,d.getAgentString)(H)}}t.defaultGetHeaders=z;function q(H,$){var K,Y=K=F[$||ie.json];return{accept:Y,"content-type":K,"X-Ably-Version":d.default.protocolVersion.toString(),"Ably-Agent":(0,d.getAgentString)(H)}}t.defaultPostHeaders=q;function G(H){return H.splice(C(H),1)[0]}t.arrPopRandomElement=G;function x(H){var $=[];if(H)for(var K in H)$.push(encodeURIComponent(K)+"="+encodeURIComponent(H[K]));return $.length?"?"+$.join("&"):""}t.toQueryString=x;function D(H){for(var $,K=/([^?&=]+)=?([^&]*)/g,Y={};$=K.exec(H);)Y[decodeURIComponent($[1])]=decodeURIComponent($[2]);return Y}t.parseQueryString=D,t.now=Date.now||function(){return new Date().getTime()};function j(H){return typeof H=="object"&&H!==null&&(H.constructor.name=="ErrorInfo"||H.constructor.name=="PartialErrorInfo")}t.isErrorInfoOrPartialErrorInfo=j;function B(H){var $,K;return H instanceof Error||(($=H==null?void 0:H.constructor)===null||$===void 0?void 0:$.name)==="ErrorInfo"||((K=H==null?void 0:H.constructor)===null||K===void 0?void 0:K.name)==="PartialErrorInfo"?H.toString():p.default.Config.inspect(H)}t.inspectError=B;function V(H){return p.default.BufferUtils.isBuffer(H)?H.toString():typeof H=="string"?H:p.default.Config.inspect(H)}t.inspectBody=V;function J(H){if(p.default.BufferUtils.isBuffer(H))return p.default.BufferUtils.byteLength(H);if(typeof H=="string")return p.default.Config.stringByteSize(H);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof H)}t.dataSizeBytes=J;function Q(){return String(Math.random()).substr(2)}t.cheapRandStr=Q;var Z=function(H){if(p.default.Config.getRandomValues&&typeof Uint8Array<"u"){var $=new Uint8Array(H);return p.default.Config.getRandomValues($),p.default.BufferUtils.base64Encode($)}for(var K=p.default.BufferUtils.base64CharSet,Y=Math.round(H*4/3),ne="",be=0;be<Y;be++)ne+=K[C(K)];return ne};t.randomString=Z;var ee=function(H){if(p.default.Config.getRandomValues&&typeof Uint8Array<"u"){var $=new Uint8Array(H);return p.default.Config.getRandomValues($),p.default.BufferUtils.hexEncode($)}for(var K=p.default.BufferUtils.hexCharSet,Y=H*2,ne="",be=0;be<Y;be++)ne+=K[C(K)];return ne};t.randomHexString=ee;function re(H,$){for(var K=Math.min($,H.length),Y=H.slice(),ne=[],be=0;be<K;be++)ne.push(G(Y));return ne}t.arrChooseN=re,t.trim=String.prototype.trim?function(H){return H.trim()}:function(H){return H.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function X(H,$,K){return new Promise(function(Y,ne){H[$].apply(H,o.__spreadArray(o.__spreadArray([],K,!1),[function(be,We){be?ne(be):Y(We)}],!1))})}t.promisify=X;var ie;(function(H){H.msgpack="msgpack",H.json="json"})(ie=t.Format||(t.Format={}));function fe(H,$){return $=="msgpack"?p.default.Config.msgpack.decode(H):JSON.parse(String(H))}t.decodeBody=fe;function ve(H,$){return $=="msgpack"?p.default.Config.msgpack.encode(H,!0):JSON.stringify(H)}t.encodeBody=ve;function ce(H){return H.map(function($){return $&&$.toLowerCase()})}t.allToLowerCase=ce;function xe(H){return H.map(function($){return $&&$.toUpperCase()})}t.allToUpperCase=xe;function Ye(H){return Math.min((H+2)/3,2)}t.getBackoffCoefficient=Ye;function Ee(){return 1-Math.random()*.2}t.getJitterCoefficient=Ee;function Ze(H,$){return H*Ye($)*Ee()}t.getRetryTime=Ze;function It(){return s||(typeof window<"u"?window:self)}t.getGlobalObject=It;function Pt(H,$){return Object.keys(H).every(function(K){return H[K]===$[K]})&&Object.keys($).every(function(K){return $[K]===H[K]})}t.shallowEquals=Pt;function Pr(H){var $=/^(\[([^?]*)(?:(.*))\])?(.+)$/,K=H.match($);if(!K||!K.length||K.length<5)throw new v.default("regex match failed",400,40010);if(K[2])throw new v.default("cannot use a derived option with a ".concat(K[2]," channel"),400,40010);return{qualifierParam:K[3]||"",channelName:K[4]}}t.matchDerivedChannel=Pr;function xr(H){return p.default.Config.createHmac?Buffer.from(H,"ascii").toString("base64"):(0,b.stringify)((0,w.parse)(H))}t.toBase64=xr;function Mr(H,$){return H.length===$.length&&(0,t.arrEvery)(H,function(K,Y){return K===$[Y]})}t.arrEquals=Mr}).call(this,i(13))},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),p=o.__importDefault(i(3)),d=s||(typeof window<"u"?window:self),v;(function(l){l[l.None=0]="None",l[l.Error=1]="Error",l[l.Major=2]="Major",l[l.Minor=3]="Minor",l[l.Micro=4]="Micro"})(v||(v={}));function b(l,A){return"".concat(l).padStart(A?3:2,"0")}function w(l){return p.default.Config.logTimestamps?function(A){var R=new Date;l(b(R.getHours())+":"+b(R.getMinutes())+":"+b(R.getSeconds())+"."+b(R.getMilliseconds(),1)+" "+A)}:l}var C=function(){var l,A,R,I;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((A=(l=d==null?void 0:d.console)===null||l===void 0?void 0:l.log)===null||A===void 0?void 0:A.apply)=="function"?(R=function(){for(var y=[],m=0;m<arguments.length;m++)y[m]=arguments[m];console.log.apply(console,y)},I=console.warn?function(){for(var y=[],m=0;m<arguments.length;m++)y[m]=arguments[m];console.warn.apply(console,y)}:R):d!=null&&d.console.log?R=I=function(){Function.prototype.apply.call(console.log,console,arguments)}:R=I=function(){},[R,I].map(w)},P=function(){function l(){l.logLevel=l.LOG_DEFAULT}return l.initLogHandlers=function(){var A=C(),R=A[0],I=A[1];this.logHandler=R,this.logErrorHandler=I},l.renamedClientOption=function(A,R){l.deprecationWarning("The `".concat(A,"` client option has been renamed to `").concat(R,"`. Please update your code to use `").concat(R,"` instead. `").concat(A,"` will be removed in a future version."))},l.renamedMethod=function(A,R,I){l.deprecationWarning("`".concat(A,"`s `").concat(R,"` method has been renamed to `").concat(I,"`. Please update your code to use `").concat(I,"` instead. `").concat(R,"` will be removed in a future version."))},l.deprecationWarning=function(A){l.shouldLog(v.Error)&&l.logErrorHandler("Ably: Deprecation warning - ".concat(A))},l.logLevel=v.Error,l.LOG_NONE=v.None,l.LOG_ERROR=v.Error,l.LOG_MAJOR=v.Major,l.LOG_MINOR=v.Minor,l.LOG_MICRO=v.Micro,l.LOG_DEFAULT=v.Error,l.LOG_DEBUG=v.Micro,l.logAction=function(A,R,I){l.shouldLog(A)&&(A===v.Error?l.logErrorHandler:l.logHandler)("Ably: "+R+": "+I)},l.deprecated=function(A,R){l.deprecationWarning("".concat(A," is deprecated and will be removed in a future version. ").concat(R))},l.shouldLog=function(A){return A<=l.logLevel},l.setLog=function(A,R){A!==void 0&&(l.logLevel=A),R!==void 0&&(l.logHandler=l.logErrorHandler=R)},l}();t.default=P}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(){}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartialErrorInfo=void 0;var s=i(0),o=s.__importDefault(i(3)),p=s.__importStar(i(1));function d(w){var C="["+w.constructor.name;return w.message&&(C+=": "+w.message),w.statusCode&&(C+="; statusCode="+w.statusCode),w.code&&(C+="; code="+w.code),w.cause&&(C+="; cause="+p.inspectError(w.cause)),w.href&&!(w.message&&w.message.indexOf("help.ably.io")>-1)&&(C+="; see "+w.href+" "),C+="]",C}var v=function(w){s.__extends(C,w);function C(P,l,A,R){var I=w.call(this,P)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(I,C.prototype),I.code=l,I.statusCode=A,I.cause=R,I}return C.prototype.toString=function(){return d(this)},C.fromValues=function(P){var l=P,A=l.message,R=l.code,I=l.statusCode;if(typeof A!="string"||typeof R!="number"||typeof I!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(P));var y=Object.assign(new C(A,R,I),P);return y.code&&!y.href&&(y.href="https://help.ably.io/error/"+y.code),y},C}(Error);t.default=v;var b=function(w){s.__extends(C,w);function C(P,l,A,R){var I=w.call(this,P)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(I,C.prototype),I.code=l,I.statusCode=A,I.cause=R,I}return C.prototype.toString=function(){return d(this)},C}(Error);t.PartialErrorInfo=b},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var o=s,p=o.lib,d=p.WordArray,v=d.init,b=d.init=function(w){if(w instanceof ArrayBuffer&&(w=new Uint8Array(w)),(w instanceof Int8Array||typeof Uint8ClampedArray<"u"&&w instanceof Uint8ClampedArray||w instanceof Int16Array||w instanceof Uint16Array||w instanceof Int32Array||w instanceof Uint32Array||w instanceof Float32Array||w instanceof Float64Array)&&(w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),w instanceof Uint8Array){for(var C=w.byteLength,P=[],l=0;l<C;l++)P[l>>>2]|=w[l]<<24-l%4*8;v.call(this,P,C)}else v.apply(this,arguments)};b.prototype=d}}(),s.lib.WordArray})},function(n,t,i){(function(s){(function(o,p){n.exports=p()})(this,function(){var o=o||function(p,d){var v;if(typeof window<"u"&&window.crypto&&(v=window.crypto),!v&&typeof window<"u"&&window.msCrypto&&(v=window.msCrypto),!v&&typeof s<"u"&&s.crypto&&(v=s.crypto),!v)try{v=i(44)}catch{}var b=function(){if(v){if(typeof v.getRandomValues=="function")try{return v.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof v.randomBytes=="function")try{return v.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},w=Object.create||function(){function c(){}return function(u){var a;return c.prototype=u,a=new c,c.prototype=null,a}}(),C={},P=C.lib={},l=P.Base=function(){return{extend:function(c){var u=w(this);return c&&u.mixIn(c),(!u.hasOwnProperty("init")||this.init===u.init)&&(u.init=function(){u.$super.init.apply(this,arguments)}),u.init.prototype=u,u.$super=this,u},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var u in c)c.hasOwnProperty(u)&&(this[u]=c[u]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),A=P.WordArray=l.extend({init:function(c,u){c=this.words=c||[],u!=d?this.sigBytes=u:this.sigBytes=c.length*4},toString:function(c){return(c||I).stringify(this)},concat:function(c){var u=this.words,a=c.words,g=this.sigBytes,h=c.sigBytes;if(this.clamp(),g%4)for(var O=0;O<h;O++){var N=a[O>>>2]>>>24-O%4*8&255;u[g+O>>>2]|=N<<24-(g+O)%4*8}else for(var O=0;O<h;O+=4)u[g+O>>>2]=a[O>>>2];return this.sigBytes+=h,this},clamp:function(){var c=this.words,u=this.sigBytes;c[u>>>2]&=4294967295<<32-u%4*8,c.length=p.ceil(u/4)},clone:function(){var c=l.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var u=[],a=0;a<c;a+=4)u.push(b());return new A.init(u,c)}}),R=C.enc={},I=R.Hex={stringify:function(c){for(var u=c.words,a=c.sigBytes,g=[],h=0;h<a;h++){var O=u[h>>>2]>>>24-h%4*8&255;g.push((O>>>4).toString(16)),g.push((O&15).toString(16))}return g.join("")},parse:function(c){for(var u=c.length,a=[],g=0;g<u;g+=2)a[g>>>3]|=parseInt(c.substr(g,2),16)<<24-g%8*4;return new A.init(a,u/2)}},y=R.Latin1={stringify:function(c){for(var u=c.words,a=c.sigBytes,g=[],h=0;h<a;h++){var O=u[h>>>2]>>>24-h%4*8&255;g.push(String.fromCharCode(O))}return g.join("")},parse:function(c){for(var u=c.length,a=[],g=0;g<u;g++)a[g>>>2]|=(c.charCodeAt(g)&255)<<24-g%4*8;return new A.init(a,u)}},m=R.Utf8={stringify:function(c){try{return decodeURIComponent(escape(y.stringify(c)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(c){return y.parse(unescape(encodeURIComponent(c)))}},T=P.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new A.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=m.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var u,a=this._data,g=a.words,h=a.sigBytes,O=this.blockSize,N=O*4,k=h/N;c?k=p.ceil(k):k=p.max((k|0)-this._minBufferSize,0);var L=k*O,M=p.min(L*4,h);if(L){for(var E=0;E<L;E+=O)this._doProcessBlock(g,E);u=g.splice(0,L),a.sigBytes-=M}return new A.init(u,M)},clone:function(){var c=l.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});P.Hasher=T.extend({cfg:l.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){c&&this._append(c);var u=this._doFinalize();return u},blockSize:16,_createHelper:function(c){return function(u,a){return new c.init(a).finalize(u)}},_createHmacHelper:function(c){return function(u,a){return new f.HMAC.init(c,a).finalize(u)}}});var f=C.algo={};return C}(Math);return o})}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(2)),d=s.__importDefault(i(3));function v(C,P,l){try{P.apply(C,l)}catch(A){p.default.logAction(p.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+A+"; stack = "+(A&&A.stack))}}function b(C,P,l){for(var A,R,I,y=0;y<C.length;y++)if(A=C[y],l&&(A=A[l]),o.isArray(A)){for(;(R=o.arrIndexOf(A,P))!==-1;)A.splice(R,1);l&&A.length===0&&delete C[y][l]}else if(o.isObject(A))for(I in A)Object.prototype.hasOwnProperty.call(A,I)&&o.isArray(A[I])&&b([A],P,I)}var w=function(){function C(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return C.prototype.on=function(){for(var P=this,l=[],A=0;A<arguments.length;A++)l[A]=arguments[A];if(l.length===1){var R=l[0];if(typeof R=="function")this.any.push(R);else throw new Error("EventListener.on(): Invalid arguments: "+d.default.Config.inspect(l))}if(l.length===2){var I=l[0],y=l[1];if(typeof y!="function")throw new Error("EventListener.on(): Invalid arguments: "+d.default.Config.inspect(l));if(o.isEmptyArg(I))this.any.push(y);else if(o.isArray(I))I.forEach(function(T){P.on(T,y)});else{if(typeof I!="string")throw new Error("EventListener.on(): Invalid arguments: "+d.default.Config.inspect(l));var m=this.events[I]||(this.events[I]=[]);m.push(y)}}},C.prototype.off=function(){for(var P,l=this,A=[],R=0;R<arguments.length;R++)A[R]=arguments[R];if(A.length==0||o.isEmptyArg(A[0])&&o.isEmptyArg(A[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var I=A[0],y=A[1],m=null,T=null;if(A.length===1||!y)typeof I=="function"?m=I:T=I;else{if(typeof y!="function")throw new Error("EventEmitter.off(): invalid arguments:"+d.default.Config.inspect(A));P=[I,y],T=P[0],m=P[1]}if(m&&o.isEmptyArg(T)){b([this.any,this.events,this.anyOnce,this.eventsOnce],m);return}if(o.isArray(T)){T.forEach(function(f){l.off(f,m)});return}if(typeof T!="string")throw new Error("EventEmitter.off(): invalid arguments:"+d.default.Config.inspect(A));m?b([this.events,this.eventsOnce],m,T):(delete this.events[T],delete this.eventsOnce[T])},C.prototype.listeners=function(P){if(P){var l=this.events[P]||[];return this.eventsOnce[P]&&Array.prototype.push.apply(l,this.eventsOnce[P]),l.length?l:null}return this.any.length?this.any:null},C.prototype.emit=function(P){for(var l=[],A=1;A<arguments.length;A++)l[A-1]=arguments[A];var R={event:P},I=[];this.anyOnce.length&&(Array.prototype.push.apply(I,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(I,this.any);var y=this.eventsOnce[P];y&&(Array.prototype.push.apply(I,y),delete this.eventsOnce[P]);var m=this.events[P];m&&Array.prototype.push.apply(I,m),o.arrForEach(I,function(T){v(R,T,l)})},C.prototype.once=function(){for(var P=this,l=[],A=0;A<arguments.length;A++)l[A]=arguments[A];var R=l.length;if((R===0||R===1&&typeof l[0]!="function")&&d.default.Config.Promise){var I=l[0];return new d.default.Config.Promise(function(u){P.once(I,u)})}var y=l[0],m=l[1];if(l.length===1&&typeof y=="function")this.anyOnce.push(y);else if(o.isEmptyArg(y)){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));this.anyOnce.push(m)}else if(o.isArray(y)){var T=this,f=function(){var u=Array.prototype.slice.call(arguments);if(o.arrForEach(y,function(a){T.off(a,f)}),typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));m.apply(this,u)};o.arrForEach(y,function(u){T.on(u,f)})}else{if(typeof y!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));var c=this.eventsOnce[y]||(this.eventsOnce[y]=[]);if(m){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));c.push(m)}}},C.prototype.whenState=function(P,l,A){for(var R=this,I=[],y=3;y<arguments.length;y++)I[y-3]=arguments[y];var m={event:P};if(typeof P!="string"||typeof l!="string")throw"whenState requires a valid event String argument";if(typeof A!="function"&&d.default.Config.Promise)return new d.default.Config.Promise(function(T){C.prototype.whenState.apply(R,[P,l,T].concat(I))});P===l?v(m,A,I):this.once(P,A)},C}();t.default=w},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaults=t.normaliseOptions=t.objectifyOptions=t.getAgentString=t.getHosts=t.getFallbackHosts=t.environmentFallbackHosts=t.getHttpScheme=t.getPort=t.getHost=void 0;var s=i(0),o=s.__importDefault(i(3)),p=s.__importStar(i(1)),d=s.__importDefault(i(2)),v=s.__importDefault(i(4)),b=i(43),w="ably-js/"+b.version,C={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:b.version,protocolVersion:2,agent:w,getHost:P,getPort:l,getHttpScheme:A,environmentFallbackHosts:R,getFallbackHosts:I,getHosts:y,checkHost:m,objectifyOptions:u,normaliseOptions:a};function P(h,O,N){return N?O=O==h.restHost&&h.realtimeHost||O||h.realtimeHost:O=O||h.restHost,O}t.getHost=P;function l(h,O){return O||h.tls?h.tlsPort:h.port}t.getPort=l;function A(h){return h.tls?"https://":"http://"}t.getHttpScheme=A;function R(h){return[h+"-a-fallback.ably-realtime.com",h+"-b-fallback.ably-realtime.com",h+"-c-fallback.ably-realtime.com",h+"-d-fallback.ably-realtime.com",h+"-e-fallback.ably-realtime.com"]}t.environmentFallbackHosts=R;function I(h){var O=h.fallbackHosts,N=typeof h.httpMaxRetryCount<"u"?h.httpMaxRetryCount:C.httpMaxRetryCount;return O?p.arrChooseN(O,N):[]}t.getFallbackHosts=I;function y(h){return[h.restHost].concat(I(h))}t.getHosts=y;function m(h){if(typeof h!="string")throw new v.default("host must be a string; was a "+typeof h,4e4,400);if(!h.length)throw new v.default("host must not be zero-length",4e4,400)}function T(h,O,N){return h.realtimeHost?h.realtimeHost:h.restHost?(d.default.logAction(d.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+h.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+h.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),h.restHost):O?C.REALTIME_HOST:N+"-"+C.REALTIME_HOST}function f(h){var O={};for(var N in C.TIMEOUTS)O[N]=h[N]||C.TIMEOUTS[N];return O}function c(h){var O=C.agent;if(h.agents)for(var N in h.agents)O+=" "+N+"/"+h.agents[N];return O}t.getAgentString=c;function u(h){return typeof h=="string"?h.indexOf(":")==-1?{token:h}:{key:h}:h}t.objectifyOptions=u;function a(h){if(h.host&&(d.default.renamedClientOption("host","restHost"),h.restHost=h.host),h.wsHost&&(d.default.renamedClientOption("wsHost","realtimeHost"),h.realtimeHost=h.wsHost),h.queueEvents&&(d.default.renamedClientOption("queueEvents","queueMessages"),h.queueMessages=h.queueEvents),h.headers&&d.default.deprecated("the `headers` client option",""),h.fallbackHostsUseDefault){if(h.fallbackHosts){var O="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions",O),new v.default(O,4e4,400)}if(h.port||h.tlsPort){var O="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions",O),new v.default(O,4e4,400)}h.environment?d.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):d.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youre not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if youre using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),h.fallbackHosts=C.FALLBACK_HOSTS}h.recover===!0&&(d.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),h.recover=function(G,x){x(!0)}),typeof h.recover=="function"&&h.closeOnUnload===!0&&(d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),h.recover=void 0),"closeOnUnload"in h||(h.closeOnUnload=!h.recover),h.transports&&p.arrIn(h.transports,"xhr")&&(d.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),p.arrDeleteValue(h.transports,"xhr"),h.transports.push("xhr_streaming")),"queueMessages"in h||(h.queueMessages=!0);var N=h.environment&&String(h.environment).toLowerCase()||C.ENVIRONMENT,k=!N||N==="production";!h.fallbackHosts&&!h.restHost&&!h.realtimeHost&&!h.port&&!h.tlsPort&&(h.fallbackHosts=k?C.FALLBACK_HOSTS:R(N));var L=h.restHost||(k?C.REST_HOST:N+"-"+C.REST_HOST),M=T(h,k,N);p.arrForEach((h.fallbackHosts||[]).concat(L,M),m),h.port=h.port||C.PORT,h.tlsPort=h.tlsPort||C.TLS_PORT,"tls"in h||(h.tls=!0);var E=f(h);if("useBinaryProtocol"in h?h.useBinaryProtocol=o.default.Config.supportsBinary&&h.useBinaryProtocol:h.useBinaryProtocol=o.default.Config.preferBinary,h.clientId){var S=h.headers=h.headers||{};S["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(h.clientId))}"idempotentRestPublishing"in h||(h.idempotentRestPublishing=!0),h.promises&&!o.default.Config.Promise&&(d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),h.promises=!1);var _=null,U=h.connectivityCheckUrl;if(h.connectivityCheckUrl){var F=h.connectivityCheckUrl.split("?"),z=F[0],q=F[1];_=q?p.parseQueryString(q):{},z.indexOf("://")===-1&&(z="https://"+z),U=z}return s.__assign(s.__assign({},h),{useBinaryProtocol:"useBinaryProtocol"in h?o.default.Config.supportsBinary&&h.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:M,restHost:L,maxMessageSize:h.maxMessageSize||C.maxMessageSize,timeouts:E,connectivityCheckParams:_,connectivityCheckUrl:U})}t.normaliseOptions=a,t.default=C;function g(h){return Object.assign(C,h)}t.getDefaults=g},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),p=s.__importDefault(i(2)),d=s.__importDefault(i(4)),v=s.__importStar(i(1));function b(l){return!l||!l.channelOptions?{channelOptions:l,plugins:{},baseEncodedPreviousPayload:void 0}:l}function w(l){if(l&&l.cipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var A=o.default.Crypto.getCipher(l.cipher);return{cipher:A.cipherParams,channelCipher:A.cipher}}return l??{}}function C(l){var A=0;return l.name&&(A+=l.name.length),l.clientId&&(A+=l.clientId.length),l.extras&&(A+=JSON.stringify(l.extras).length),l.data&&(A+=v.dataSizeBytes(l.data)),A}var P=function(){function l(){}return l.prototype.toJSON=function(){var A=this.encoding,R=this.data;return R&&o.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(A=A?A+"/base64":"base64",R=o.default.BufferUtils.base64Encode(R)):R=o.default.BufferUtils.toBuffer(R)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:A,data:R}},l.prototype.toString=function(){var A="[Message";return this.name&&(A+="; name="+this.name),this.id&&(A+="; id="+this.id),this.timestamp&&(A+="; timestamp="+this.timestamp),this.clientId&&(A+="; clientId="+this.clientId),this.connectionId&&(A+="; connectionId="+this.connectionId),this.encoding&&(A+="; encoding="+this.encoding),this.extras&&(A+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?A+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?A+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):A+="; data (json)="+JSON.stringify(this.data)),this.extras&&(A+="; extras="+JSON.stringify(this.extras)),A+="]",A},l.encrypt=function(A,R,I){var y=A.data,m=A.encoding,T=R.channelCipher;m=m?m+"/":"",o.default.BufferUtils.isBuffer(y)||(y=o.default.BufferUtils.utf8Encode(String(y)),m=m+"utf-8/"),T.encrypt(y,function(f,c){if(f){I(f);return}A.data=c,A.encoding=m+"cipher+"+T.algorithm,I(null,A)})},l.encode=function(A,R,I){var y=A.data,m=typeof y=="string"||o.default.BufferUtils.isBuffer(y)||y===null||y===void 0;if(!m)if(v.isObject(y)||v.isArray(y))A.data=JSON.stringify(y),A.encoding=A.encoding?A.encoding+"/json":"json";else throw new d.default("Data type is unsupported",40013,400);R!=null&&R.cipher?l.encrypt(A,R,I):I(null,A)},l.encodeArray=function(A,R,I){for(var y=0,m=0;m<A.length;m++)l.encode(A[m],R,function(T){if(T){I(T);return}y++,y==A.length&&I(null,A)})},l.decode=function(A,R){var I=b(R),y=A.data,m=A.encoding;if(m){var T=m.split("/"),f=void 0,c=T.length,u=A.data,a="";try{for(;(f=c)>0;){var g=T[--c].match(/([-\w]+)(\+([\w-]+))?/);if(!g)break;switch(a=g[1],a){case"base64":u=o.default.BufferUtils.base64Decode(String(u)),f==T.length&&(y=u);continue;case"utf-8":u=o.default.BufferUtils.utf8Decode(u);continue;case"json":u=JSON.parse(u);continue;case"cipher":if(I.channelOptions!=null&&I.channelOptions.cipher&&I.channelOptions.channelCipher){var h=g[3],O=I.channelOptions.channelCipher;if(h!=O.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");u=O.decrypt(u);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!I.plugins||!I.plugins.vcdiff)throw new d.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new d.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var N=I.baseEncodedPreviousPayload;typeof N=="string"&&(N=o.default.BufferUtils.utf8Encode(N)),N=o.default.BufferUtils.toBuffer(N),u=o.default.BufferUtils.toBuffer(u),u=o.default.BufferUtils.typedArrayToBuffer(I.plugins.vcdiff.decode(u,N)),y=u}catch(L){throw new d.default("Vcdiff delta decode failed with "+L,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(L){var k=L;throw new d.default("Error processing the "+a+" encoding, decoder returned "+k.message+"",k.code||40013,400)}finally{A.encoding=f<=0?null:T.slice(0,f).join("/"),A.data=u}}I.baseEncodedPreviousPayload=y},l.fromResponseBody=function(A,R,I){I&&(A=v.decodeBody(A,I));for(var y=0;y<A.length;y++){var m=A[y]=l.fromValues(A[y]);try{l.decode(m,R)}catch(T){p.default.logAction(p.default.LOG_ERROR,"Message.fromResponseBody()",T.toString())}}return A},l.fromValues=function(A){return Object.assign(new l,A)},l.fromValuesArray=function(A){for(var R=A.length,I=new Array(R),y=0;y<R;y++)I[y]=l.fromValues(A[y]);return I},l.fromEncoded=function(A,R){var I=l.fromValues(A),y=w(R??null);try{l.decode(I,y)}catch(m){p.default.logAction(p.default.LOG_ERROR,"Message.fromEncoded()",m.toString())}return I},l.fromEncodedArray=function(A,R){return A.map(function(I){return l.fromEncoded(I,R)})},l.getMessagesSize=function(A){for(var R,I=0,y=0;y<A.length;y++)R=A[y],I+=R.size||(R.size=C(R));return I},l.serialize=v.encodeBody,l}();t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(4)),d=s.__importDefault(i(9)),v=s.__importDefault(i(16)),b={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},w=[];Object.keys(b).forEach(function(I){w[b[I]]=I});var C={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},P=Object.keys(C);C.MODE_ALL=C.PRESENCE|C.PUBLISH|C.SUBSCRIBE|C.PRESENCE_SUBSCRIBE;function l(I){var y=[];if(I)for(var m=0;m<I.length;m++)y.push(I[m].toString());return"[ "+y.join(", ")+" ]"}var A="id channel channelSerial connectionId count msgSerial timestamp".split(" "),R=function(){function I(){var y=this;this.hasFlag=function(m){return(y.flags&C[m])>0}}return I.prototype.setFlag=function(y){return this.flags=this.flags|C[y]},I.prototype.getMode=function(){return this.flags&&this.flags&C.MODE_ALL},I.prototype.encodeModesToFlags=function(y){var m=this;y.forEach(function(T){return m.setFlag(T)})},I.prototype.decodeModesFromFlags=function(){var y=this,m=[];return I.channelModes.forEach(function(T){y.hasFlag(T)&&m.push(T)}),m.length>0?m:void 0},I.fromValues=function(y){return Object.assign(new I,y)},I.Action=b,I.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],I.ActionName=w,I.serialize=o.encodeBody,I.deserialize=function(y,m){var T=o.decodeBody(y,m);return I.fromDeserialized(T)},I.fromDeserialized=function(y){var m=y.error;m&&(y.error=p.default.fromValues(m));var T=y.messages;if(T)for(var f=0;f<T.length;f++)T[f]=d.default.fromValues(T[f]);var c=y.presence;if(c)for(var f=0;f<c.length;f++)c[f]=v.default.fromValues(c[f],!0);return Object.assign(new I,y)},I.stringify=function(y){var m="[ProtocolMessage";y.action!==void 0&&(m+="; action="+I.ActionName[y.action]||!1);for(var T,f=0;f<A.length;f++)T=A[f],y[T]!==void 0&&(m+="; "+T+"="+y[T]);if(y.messages&&(m+="; messages="+l(d.default.fromValuesArray(y.messages))),y.presence&&(m+="; presence="+l(v.default.fromValuesArray(y.presence))),y.error&&(m+="; error="+p.default.fromValues(y.error).toString()),y.auth&&y.auth.accessToken&&(m+="; token="+y.auth.accessToken),y.flags&&(m+="; flags="+P.filter(y.hasFlag).join(",")),y.params){var c="";o.forInOwnNonNullProperties(y.params,function(u){c.length>0&&(c+="; "),c+=u+"="+y.params[u]}),c.length>0&&(m+="; params=["+c+"]")}return m+="]",m},I}();t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,p=o.lib,d=p.WordArray,v=o.enc;v.Base64={stringify:function(w){var C=w.words,P=w.sigBytes,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";w.clamp();for(var A=[],R=0;R<P;R+=3)for(var I=C[R>>>2]>>>24-R%4*8&255,y=C[R+1>>>2]>>>24-(R+1)%4*8&255,m=C[R+2>>>2]>>>24-(R+2)%4*8&255,T=I<<16|y<<8|m,f=0;f<4&&R+f*.75<P;f++)A.push(l.charAt(T>>>6*(3-f)&63));var c=l.charAt(64);if(c)for(;A.length%4;)A.push(c);return A.join("")},parse:function(w){var C=w.length,P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=this._reverseMap;if(!l){l=this._reverseMap=[];for(var A=0;A<P.length;A++)l[P.charCodeAt(A)]=A}var R=P.charAt(64);if(R){var I=w.indexOf(R);I!==-1&&(C=I)}return b(w,C,l)}};function b(w,C,P){for(var l=[],A=0,R=0;R<C;R++)if(R%4){var I=P[w.charCodeAt(R-1)]<<R%4*2,y=P[w.charCodeAt(R)]>>>6-R%4*2,m=I|y;l[A>>>2]|=m<<24-A%4*8,A++}return d.create(l,A)}}(),s.enc.Base64})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(10)),d=s.__importDefault(i(26)),v=s.__importDefault(i(2)),b=s.__importDefault(i(8)),w=s.__importDefault(i(21)),C=s.__importDefault(i(18)),P=s.__importDefault(i(4)),l=s.__importDefault(i(22)),A=s.__importDefault(i(3));function R(m){var T=[80015,80017,80030];return m.code?C.default.isTokenErr(m)?!1:o.arrIn(T,m.code)?!0:m.code>=4e4&&m.code<5e4:!1}function I(m){return R(m)?[p.default.fromValues({action:p.default.Action.ERROR,error:m})]:[p.default.fromValues({action:p.default.Action.DISCONNECTED,error:m})]}var y=function(m){s.__extends(T,m);function T(f,c,u){var a=m.call(this,f,c,u,!0)||this;return a.onAuthUpdated=function(g){a.authParams={access_token:g.token}},a.stream="stream"in u?u.stream:!0,a.sendRequest=null,a.recvRequest=null,a.pendingCallback=null,a.pendingItems=null,a}return T.prototype.connect=function(){var f=this;v.default.logAction(v.default.LOG_MINOR,"CometTransport.connect()","starting"),d.default.prototype.connect.call(this);var c=this.params,u=c.options,a=b.default.getHost(u,c.host),g=b.default.getPort(u),h=u.tls?"https://":"http://";this.baseUri=h+a+":"+g+"/comet/";var O=this.baseUri+"connect";v.default.logAction(v.default.LOG_MINOR,"CometTransport.connect()","uri: "+O),this.auth.getAuthParams(function(N,k){if(N){f.disconnect(N);return}if(!f.isDisposed){f.authParams=k;var L=f.params.getConnectParams(k);"stream"in L&&(f.stream=L.stream),v.default.logAction(v.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(L));var M=!1,E=f.recvRequest=f.createRequest(O,null,L,null,f.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV);E.on("data",function(S){f.recvRequest&&(M||(M=!0,f.emit("preconnect")),f.onData(S))}),E.on("complete",function(S){if(f.recvRequest||(S=S||new P.default("Request cancelled",80003,400)),f.recvRequest=null,!M&&!S&&(M=!0,f.emit("preconnect")),f.onActivity(),S){S.code?f.onData(I(S)):f.disconnect(S);return}A.default.Config.nextTick(function(){f.recv()})}),E.exec()}})},T.prototype.requestClose=function(){v.default.logAction(v.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},T.prototype.requestDisconnect=function(){v.default.logAction(v.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},T.prototype._requestCloseOrDisconnect=function(f){var c=this,u=f?this.closeUri:this.disconnectUri;if(u){var a=this.createRequest(u,null,this.authParams,null,l.default.REQ_SEND);a.on("complete",function(g){g&&(v.default.logAction(v.default.LOG_ERROR,"CometTransport.request"+(f?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(g)),c.finish("disconnected",g))}),a.exec()}},T.prototype.dispose=function(){var f=this;v.default.logAction(v.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(v.default.logAction(v.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",w.default.disconnected()),A.default.Config.nextTick(function(){f.emit("disposed")}))},T.prototype.onConnect=function(f){var c;if(!this.isDisposed){var u=(c=f.connectionDetails)===null||c===void 0?void 0:c.connectionKey;d.default.prototype.onConnect.call(this,f);var a=this.baseUri+u;v.default.logAction(v.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+a),this.sendUri=a+"/send",this.recvUri=a+"/recv",this.closeUri=a+"/close",this.disconnectUri=a+"/disconnect"}},T.prototype.send=function(f){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(f);return}var c=this.pendingItems||[];c.push(f),this.pendingItems=null,this.sendItems(c)},T.prototype.sendAnyPending=function(){var f=this.pendingItems;f&&(this.pendingItems=null,this.sendItems(f))},T.prototype.sendItems=function(f){var c=this,u=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(f),l.default.REQ_SEND);u.on("complete",function(a,g){if(a&&v.default.logAction(v.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(a)),c.sendRequest=null,a){a.code?c.onData(I(a)):c.disconnect(a);return}g&&c.onData(g),c.pendingItems&&A.default.Config.nextTick(function(){c.sendRequest||c.sendAnyPending()})}),u.exec()},T.prototype.recv=function(){var f=this;if(!this.recvRequest&&this.isConnected){var c=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV_POLL);c.on("data",function(u){f.onData(u)}),c.on("complete",function(u){if(f.recvRequest=null,f.onActivity(),u){u.code?f.onData(I(u)):f.disconnect(u);return}A.default.Config.nextTick(function(){f.recv()})}),c.exec()}},T.prototype.onData=function(f){try{var c=this.decodeResponse(f);if(c&&c.length)for(var u=0;u<c.length;u++)this.onProtocolMessage(p.default.fromDeserialized(c[u]))}catch(a){v.default.logAction(v.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+a.stack)}},T.prototype.encodeRequest=function(f){return JSON.stringify(f)},T.prototype.decodeResponse=function(f){return typeof f=="string"?JSON.parse(f):f},T}(d.default);t.default=y},function(n,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}n.exports=i},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isSuccessCode=void 0;var s;(function(p){p[p.Success=200]="Success",p[p.NoContent=204]="NoContent",p[p.BadRequest=400]="BadRequest",p[p.Unauthorized=401]="Unauthorized",p[p.Forbidden=403]="Forbidden",p[p.RequestTimeout=408]="RequestTimeout",p[p.InternalServerError=500]="InternalServerError"})(s||(s={}));function o(p){return p>=s.Success&&p<s.BadRequest}t.isSuccessCode=o,t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),p=s.__importStar(i(1)),d=s.__importDefault(i(2)),v=s.__importDefault(i(18)),b=s.__importDefault(i(19)),w=i(4),C=s.__importDefault(i(14));function P(m,T,f,c,u){m.http.supportsAuthHeaders?m.auth.getAuthHeaders(function(a,g){a?c(a):u(p.mixin(g,T),f)}):m.auth.getAuthParams(function(a,g){a?c(a):u(T,p.mixin(g,f))})}function l(m,T){return function(f,c,u,a,g){if(f&&!c){m(f);return}if(g===C.default.NoContent){m(f,[],u,!0,g);return}if(!a)try{c=p.decodeBody(c,T)}catch(M){p.isErrorInfoOrPartialErrorInfo(M)?m(M):m(new w.PartialErrorInfo(p.inspectError(M),null));return}if(!c){m(new w.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var h=c,O=h.statusCode,N=h.response,k=h.headers;if(O===void 0){m(f,c,u,!0,g);return}if(O<200||O>=300){var L=N&&N.error||f;L||(L=new Error("Error in unenveloping "+c),L.statusCode=O),m(L,N,k,!0,O);return}m(f,N,k,!0,O)}}function A(m){var T=[];if(m)for(var f in m)T.push(f+"="+m[f]);return T.join("&")}function R(m,T){return m+(T?"?":"")+A(T)}function I(m,T,f,c){return function(u,a,g,h,O){u?d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Received Error; "+R(f,c)+"; Error: "+p.inspectError(u)):d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Received; "+R(f,c)+"; Headers: "+A(g)+"; StatusCode: "+O+"; Body: "+(o.default.BufferUtils.isBuffer(a)?a.toString():a)),m&&m(u,a,g,h,O)}}var y=function(){function m(){}return m.get=function(T,f,c,u,a,g){m.do(b.default.Get,T,f,null,c,u,a,g)},m.delete=function(T,f,c,u,a,g){m.do(b.default.Delete,T,f,null,c,u,a,g)},m.post=function(T,f,c,u,a,g,h){m.do(b.default.Post,T,f,c,u,a,g,h)},m.patch=function(T,f,c,u,a,g,h){m.do(b.default.Patch,T,f,c,u,a,g,h)},m.put=function(T,f,c,u,a,g,h){m.do(b.default.Put,T,f,c,u,a,g,h)},m.do=function(T,f,c,u,a,g,h,O){d.default.shouldLog(d.default.LOG_MICRO)&&(O=I(O,T,c,g)),h&&(O=O&&l(O,h),(g=g||{}).envelope=h);function N(k,L){var M;if(d.default.shouldLog(d.default.LOG_MICRO)&&d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(c,L)),d.default.shouldLog(d.default.LOG_MICRO)){var E=u;if(((M=k["content-type"])===null||M===void 0?void 0:M.indexOf("msgpack"))>0)try{E=o.default.Config.msgpack.decode(u)}catch(S){d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Sending MsgPack Decoding Error: "+p.inspectError(S))}d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(c,L)+"; Body: "+E)}f.http.do(T,f,c,k,u,L,function(S,_,U,F,z){if(S&&v.default.isTokenErr(S)){f.auth.authorize(null,null,function(q){if(q){O(q);return}P(f,k,L,O,N)});return}O(S,_,U,F,z)})}P(f,a,g,O,N)},m}();t.default=y},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),p=s.__importDefault(i(3)),d=s.__importDefault(i(9)),v=s.__importStar(i(1));function b(C){return w.Actions.indexOf(C)}var w=function(){function C(){}return C.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},C.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var P=this.id.split(":");return{connectionId:P[0],msgSerial:parseInt(P[1],10),index:parseInt(P[2],10)}},C.prototype.toJSON=function(){var P=this.data,l=this.encoding;return P&&p.default.BufferUtils.isBuffer(P)&&(arguments.length>0?(l=l?l+"/base64":"base64",P=p.default.BufferUtils.base64Encode(P)):P=p.default.BufferUtils.toBuffer(P)),{id:this.id,clientId:this.clientId,action:b(this.action),data:P,encoding:l,extras:this.extras}},C.prototype.toString=function(){var P="[PresenceMessage";return P+="; action="+this.action,this.id&&(P+="; id="+this.id),this.timestamp&&(P+="; timestamp="+this.timestamp),this.clientId&&(P+="; clientId="+this.clientId),this.connectionId&&(P+="; connectionId="+this.connectionId),this.encoding&&(P+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?P+="; data="+this.data:p.default.BufferUtils.isBuffer(this.data)?P+="; data (buffer)="+p.default.BufferUtils.base64Encode(this.data):P+="; data (json)="+JSON.stringify(this.data)),this.extras&&(P+="; extras="+JSON.stringify(this.extras)),P+="]",P},C.fromResponseBody=function(P,l,A){var R=[];A&&(P=v.decodeBody(P,A));for(var I=0;I<P.length;I++){var y=R[I]=C.fromValues(P[I],!0);try{C.decode(y,l)}catch(m){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",m.toString())}}return R},C.fromValues=function(P,l){return l&&(P.action=C.Actions[P.action]),Object.assign(new C,P)},C.fromValuesArray=function(P){for(var l=P.length,A=new Array(l),R=0;R<l;R++)A[R]=C.fromValues(P[R]);return A},C.fromEncoded=function(P,l){var A=C.fromValues(P,!0);try{C.decode(A,l??{})}catch(R){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",R.toString())}return A},C.fromEncodedArray=function(P,l){return P.map(function(A){return C.fromEncoded(A,l)})},C.fromData=function(P){return P instanceof C?P:C.fromValues({data:P})},C.Actions=["absent","present","enter","leave","update"],C.encode=d.default.encode,C.decode=d.default.decode,C.getMessagesSize=d.default.getMessagesSize,C}();t.default=w},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),p=o.__importStar(i(1)),d=o.__importDefault(i(7)),v=o.__importStar(i(4)),b=o.__importDefault(i(2)),w=o.__importDefault(i(8)),C=o.__importDefault(i(22)),P=o.__importDefault(i(3));function l(h,O){return p.arrIn(p.allToLowerCase(p.keysArray(O)),"x-ably-errorcode")}function A(h,O){if(l(h,O))return h.error&&v.default.fromValues(h.error)}var R=function(){},I=0,y={},m=typeof s<"u"&&s.XDomainRequest;function T(){var h=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return h&&Number(h[1])}function f(){var h;return m&&(h=T())&&h===10}function c(h,O){return h.getResponseHeader&&h.getResponseHeader(O)}function u(h){return h.getResponseHeader&&(h.getResponseHeader("transfer-encoding")||!h.getResponseHeader("content-length"))}function a(h){for(var O=p.trim(h.getAllResponseHeaders()).split(`\r
`),N={},k=0;k<O.length;k++){var L=O[k].split(":").map(p.trim);N[L[0].toLowerCase()]=L[1]}return N}var g=function(h){o.__extends(O,h);function O(N,k,L,M,E,S,_){var U=h.call(this)||this;return L=L||{},L.rnd=p.cheapRandStr(),f()&&!L.envelope&&(L.envelope="json"),U.uri=N+p.toQueryString(L),U.headers=k||{},U.body=M,U.method=_?_.toUpperCase():p.isEmptyArg(M)?"GET":"POST",U.requestMode=E,U.timeouts=S,U.timedOut=!1,U.requestComplete=!1,U.id=String(++I),y[U.id]=U,U}return O.createRequest=function(N,k,L,M,E,S,_){var U=S||w.default.TIMEOUTS;return new O(N,k,p.copy(L),M,E,U,_)},O.prototype.complete=function(N,k,L,M,E){this.requestComplete||(this.requestComplete=!0,!N&&k&&this.emit("data",k),this.emit("complete",N,k,L,M,E),this.dispose())},O.prototype.abort=function(){this.dispose()},O.prototype.exec=function(){var N=this,k=this.headers,L=this.requestMode==C.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,M=this.timer=setTimeout(function(){N.timedOut=!0,S.abort()},L),E=this.method,S=this.xhr=new XMLHttpRequest,_=k.accept,U=this.body,F="text";if(_?_.indexOf("application/x-msgpack")===0&&(F="arraybuffer"):k.accept="application/json",U){var z=k["content-type"]||(k["content-type"]="application/json");z.indexOf("application/json")>-1&&typeof U!="string"&&(U=JSON.stringify(U))}S.open(E,this.uri,!0),S.responseType=F,"authorization"in k&&(S.withCredentials=!0);for(var q in k)S.setRequestHeader(q,k[q]);var G=function(X,ie,fe,ve){var ce,xe=ie+" (event type: "+X.type+")";!((ce=N==null?void 0:N.xhr)===null||ce===void 0)&&ce.statusText&&(xe+=", current statusText is "+N.xhr.statusText),b.default.logAction(b.default.LOG_ERROR,"Request.on"+X.type+"()",xe),N.complete(new v.PartialErrorInfo(xe,fe,ve))};S.onerror=function(X){G(X,"XHR error occurred",null,400)},S.onabort=function(X){N.timedOut?G(X,"Request aborted due to request timeout expiring",null,408):G(X,"Request cancelled",null,400)},S.ontimeout=function(X){G(X,"Request timed out",null,408)};var x,D,j,B=0,V=!1,J=function(){if(clearTimeout(M),j=D<400,D==204){N.complete(null,null,null,null,D);return}x=N.requestMode==C.default.REQ_RECV_STREAM&&j&&u(S)},Q=function(){var X;try{var ie=c(S,"content-type"),fe=ie?ie.indexOf("application/json")>=0:S.responseType=="text";if(fe){var ve=S.responseType==="arraybuffer"?P.default.BufferUtils.utf8Decode(S.response):String(S.responseText);ve.length?X=JSON.parse(ve):X=ve,V=!0}else X=S.response;X.response!==void 0?(D=X.statusCode,j=D<400,k=X.headers,X=X.response):k=a(S)}catch(xe){N.complete(new v.PartialErrorInfo("Malformed response body from server: "+xe.message,null,400));return}if(j||p.isArray(X)){N.complete(null,X,k,V,D);return}var ce=A(X,k);ce||(ce=new v.PartialErrorInfo("Error response received from server: "+D+" body was: "+P.default.Config.inspect(X),null,D)),N.complete(ce,X,k,V,D)};function Z(){for(var X=S.responseText,ie=X.length-1,fe,ve;B<ie&&(fe=X.indexOf(`
`,B))>-1;)ve=X.slice(B,fe),B=fe+1,ee(ve)}var ee=function(X){try{X=JSON.parse(X)}catch(ie){N.complete(new v.PartialErrorInfo("Malformed response body from server: "+ie.message,null,400));return}N.emit("data",X)},re=function(){Z(),N.streamComplete=!0,P.default.Config.nextTick(function(){N.complete()})};S.onreadystatechange=function(){var X=S.readyState;X<3||S.status!==0&&(D===void 0&&(D=S.status,D===1223&&(D=204),J()),X==3&&x?Z():X==4&&(x?re():Q()))},S.send(U)},O.prototype.dispose=function(){var N=this.xhr;if(N){N.onreadystatechange=N.onerror=N.onabort=N.ontimeout=R,this.xhr=null;var k=this.timer;k&&(clearTimeout(k),this.timer=null),this.requestComplete||N.abort()}delete y[this.id]},O}(d.default);t.default=g}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),p=s.__importStar(i(1)),d=s.__importDefault(i(24)),v=s.__importDefault(i(4)),b=s.__importDefault(i(45)),w=i(11),C=s.__importDefault(i(19)),P=s.__importDefault(i(14)),l=s.__importDefault(i(3)),A=s.__importDefault(i(15)),R=Math.pow(2,17);function I(){}function y(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function m(L){return!!L.connection}function T(L){return p.isErrorInfoOrPartialErrorInfo(L)?(L.code||(L.statusCode===403?L.code=40300:(L.code=40170,L.statusCode=401)),L):new v.default(p.inspectError(L),L.code||40170,L.statusCode||401)}var f=function(L,M){if(l.default.Config.createHmac){var E=l.default.Config.createHmac("SHA256",M);return E.update(L),E.digest("base64")}return(0,w.stringify)((0,b.default)(L,M))};function c(L){if(!L)return"";typeof L=="string"&&(L=JSON.parse(L));var M=Object.create(null),E=p.keysArray(L,!0);if(!E)return"";E.sort();for(var S=0;S<E.length;S++)M[E[S]]=L[E[S]].sort();return JSON.stringify(M)}function u(L){if(L.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(L.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(L.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(L.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var M="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",M),new Error(M)}}function a(L){return"useTokenAuth"in L&&!L.useTokenAuth}function g(L){return L.useTokenAuth||!a(L)&&(L.authCallback||L.authUrl||L.token||L.tokenDetails)}function h(L){return!L.key&&!L.authCallback&&!L.authUrl}var O=0;function N(){return O++}var k=function(){function L(M,E){if(this.authOptions={},this.client=M,this.tokenParams=E.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,g(E)){if(E.key&&!f){var S="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",S),new Error(S)}h(E)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(E.defaultTokenParams,E),u(this.authOptions)}else{if(!E.key){var S="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",S),new v.default(S,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(E)}}return L.prototype.authorize=function(M,E,S){var _=this,U;if(typeof M=="function"&&!S?(S=M,U=M=null):typeof E=="function"&&!S?(S=E,U=null):U=E,!S&&this.client.options.promises)return p.promisify(this,"authorize",arguments);if(U&&U.key&&this.authOptions.key!==U.key)throw new v.default("Unable to update auth options with incompatible key",40102,401);U&&"force"in U&&(o.default.deprecated("The `force` auth option","If youre using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the librarys stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if youre currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),p.isOnlyPropIn(U,"force")&&(U=null)),this._forceNewToken(M,U,function(F,z){if(F){_.client.connection&&F.statusCode===P.default.Forbidden&&_.client.connection.connectionManager.actOnErrorFromAuthorize(F),S==null||S(F);return}m(_.client)?_.client.connection.connectionManager.onAuthUpdated(z,S||I):S==null||S(null,z)})},L.prototype.authorise=function(M,E,S){o.default.renamedMethod("Auth","authorise","authorize"),this.authorize(M,E,S)},L.prototype._forceNewToken=function(M,E,S){var _=this;this.tokenDetails=null,this._saveTokenOptions(M,E),u(this.authOptions),this._ensureValidAuthCredentials(!0,function(U,F){delete _.tokenParams.timestamp,delete _.authOptions.queryTime,S(U,F)})},L.prototype.requestToken=function(M,E,S){var _=this;if(typeof M=="function"&&!S?(S=M,E=M=null):typeof E=="function"&&!S&&(S=E,E=null),!S&&this.client.options.promises)return p.promisify(this,"requestToken",arguments);E=E||this.authOptions,M=M||p.copy(this.tokenParams);var U=S||I,F,z=this.client;if(E.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),F=E.authCallback;else if(E.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),F=function(B,V){var J=p.mixin({accept:"application/json, text/plain"},E.authHeaders),Q=E.authMethod&&E.authMethod.toLowerCase()==="post",Z,ee=E.authUrl.indexOf("?");ee>-1&&(Z=p.parseQueryString(E.authUrl.slice(ee)),E.authUrl=E.authUrl.slice(0,ee),Q||(E.authParams=p.mixin(Z,E.authParams)));var re=p.mixin({},E.authParams||{},B),X=function(ve,ce,xe,Ye){var Ee;if(ve?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+p.inspectError(ve)):(Ee=xe["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+Ee+"; body: "+p.inspectBody(ce))),ve||Ye)return V(ve,ce);if(l.default.BufferUtils.isBuffer(ce)&&(ce=ce.toString()),!Ee){V(new v.default("authUrl response is missing a content-type header",40170,401));return}var Ze=Ee.indexOf("application/json")>-1,It=Ee.indexOf("text/plain")>-1||Ee.indexOf("application/jwt")>-1;if(!Ze&&!It){V(new v.default("authUrl responded with unacceptable content-type "+Ee+", should be either text/plain, application/jwt or application/json",40170,401));return}if(Ze){if(ce.length>R){V(new v.default("authUrl response exceeded max permitted length",40170,401));return}try{ce=JSON.parse(ce)}catch(Pt){V(new v.default("Unexpected error processing authURL response; err = "+Pt.message,40170,401));return}}V(null,ce,Ee)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+E.authUrl+"; Params: "+JSON.stringify(re)+"; method: "+(Q?"POST":"GET")),Q){var ie=J||{};ie["content-type"]="application/x-www-form-urlencoded";var fe=p.toQueryString(re).slice(1);_.client.http.doUri(C.default.Post,z,E.authUrl,ie,fe,Z,X)}else _.client.http.doUri(C.default.Get,z,E.authUrl,J||{},null,re,X)};else if(E.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),F=function(B,V){_.createTokenRequest(B,E,V)};else{var q="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),U(new v.default(q,40171,403));return}"capability"in M&&(M.capability=c(M.capability));var G=function(B,V){var J=B.keyName,Q="/keys/"+J+"/requestToken",Z=function(re){return z.baseUri(re)+Q},ee=p.defaultPostHeaders(_.client.options);E.requestHeaders&&p.mixin(ee,E.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+Q+"; Token params: "+JSON.stringify(B)),_.client.http.do(C.default.Post,z,Z,ee,JSON.stringify(B),null,V)},x=!1,D=this.client.options.timeouts.realtimeRequestTimeout,j=setTimeout(function(){x=!0;var B="Token request callback timed out after "+D/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",B),U(new v.default(B,40170,401))},D);F(M,function(B,V,J){if(!x){if(clearTimeout(j),B){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+p.inspectError(B)),U(T(B));return}if(typeof V=="string"){V.length===0?U(new v.default("Token string is empty",40170,401)):V.length>R?U(new v.default("Token string exceeded max permitted length (was "+V.length+" bytes)",40170,401)):V==="undefined"||V==="null"?U(new v.default("Token string was literal null/undefined",40170,401)):V[0]==="{"&&!(J&&J.indexOf("application/jwt")>-1)?U(new v.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):U(null,{token:V});return}if(typeof V!="object"){var Q="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof V;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),U(new v.default(Q,40170,401));return}var Z=JSON.stringify(V).length;if(Z>R&&!E.suppressMaxLengthCheck){U(new v.default("Token request/details object exceeded max permitted stringified size (was "+Z+" bytes)",40170,401));return}if("issued"in V){U(null,V);return}if(!("keyName"in V)){var Q="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),U(new v.default(Q,40170,401));return}G(V,function(ee,re,X,ie){if(ee){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+p.inspectError(ee)),U(T(ee));return}ie||(re=JSON.parse(re)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),U(null,re)})}})},L.prototype.createTokenRequest=function(M,E,S){var _=this;if(typeof M=="function"&&!S?(S=M,E=M=null):typeof E=="function"&&!S&&(S=E,E=null),!S&&this.client.options.promises)return p.promisify(this,"createTokenRequest",arguments);E=E||this.authOptions,M=M||p.copy(this.tokenParams);var U=E.key;if(!U){S(new v.default("No key specified",40101,403));return}var F=U.split(":"),z=F[0],q=F[1];if(!q){S(new v.default("Invalid key specified",40101,403));return}if(M.clientId===""){S(new v.default("clientId cant be an empty string",40012,400));return}"capability"in M&&(M.capability=c(M.capability));var G=p.mixin({keyName:z},M),x=M.clientId||"",D=M.ttl||"",j=M.capability||"";(function(B){if(G.timestamp){B();return}_.getTimestamp(E&&E.queryTime,function(V,J){if(V){S(V);return}G.timestamp=J,B()})})(function(){var B=G.nonce||(G.nonce=y()),V=G.timestamp,J=G.keyName+`
`+D+`
`+j+`
`+x+`
`+V+`
`+B+`
`;G.mac=G.mac||f(J,q),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),S(null,G)})},L.prototype.getAuthParams=function(M){this.method=="basic"?M(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(E,S){if(E){M(E);return}if(!S)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");M(null,{access_token:S.token})})},L.prototype.getAuthHeaders=function(M){this.method=="basic"?M(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(E,S){if(E){M(E);return}if(!S)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");M(null,{authorization:"Bearer "+p.toBase64(S.token)})})},L.prototype.getTimestamp=function(M,E){!this.isTimeOffsetSet()&&(M||this.authOptions.queryTime)?this.client.time(E):E(null,this.getTimestampUsingOffset())},L.prototype.getTimestampUsingOffset=function(){return p.now()+(this.client.serverTimeOffset||0)},L.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},L.prototype._saveBasicOptions=function(M){this.method="basic",this.key=M.key,this.basicKey=p.toBase64(M.key),this.authOptions=M||{},"clientId"in M&&this._userSetClientId(M.clientId)},L.prototype._saveTokenOptions=function(M,E){this.method="token",M&&(this.tokenParams=M),E&&(E.token&&(E.tokenDetails=typeof E.token=="string"?{token:E.token}:E.token),E.tokenDetails&&(this.tokenDetails=E.tokenDetails),"clientId"in E&&this._userSetClientId(E.clientId),this.authOptions=E)},L.prototype._ensureValidAuthCredentials=function(M,E){var S=this,_=this.tokenDetails;if(_){if(this._tokenClientIdMismatch(_.clientId)){E(new v.default("Mismatch between clientId in token ("+_.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!_.expires||_.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+_.expires),E(null,_);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=d.default.create())).push(E),!(this.currentTokenRequestId!==null&&!M)){var U=this.currentTokenRequestId=N();this.requestToken(this.tokenParams,this.authOptions,function(F,z){if(S.currentTokenRequestId>U){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}S.currentTokenRequestId=null;var q=S.waitingForTokenRequest||I;if(S.waitingForTokenRequest=null,F){q(F);return}q(null,S.tokenDetails=z)})}},L.prototype._userSetClientId=function(M){if(typeof M=="string"||M===null){if(M==="*")throw new v.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var E=this._uncheckedSetClientId(M);if(E)throw E}else throw new v.default("clientId must be either a string or null",40012,400)},L.prototype._uncheckedSetClientId=function(M){if(this._tokenClientIdMismatch(M)){var E="Unexpected clientId mismatch: client has "+this.clientId+", requested "+M,S=new v.default(E,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",E),S}else return this.clientId=this.tokenParams.clientId=M,null},L.prototype._tokenClientIdMismatch=function(M){return!!(this.clientId&&this.clientId!=="*"&&M&&M!=="*"&&this.clientId!==M)},L.isTokenErr=function(M){return M.code&&M.code>=40140&&M.code<40150},L.prototype.revokeTokens=function(M,E,S){if(g(this.client.options))throw new v.default("Cannot revoke tokens when using token auth",40162,401);var _=this.client.options.keyName,U;if(typeof E=="function"?(S=E,U={}):U=E??{},S===void 0){if(this.client.options.promises)return p.promisify(this,"revokeTokens",[M,U]);S=I}var F=S,z=s.__assign({targets:M.map(function(D){return"".concat(D.type,":").concat(D.value)})},U),q=this.client.options.useBinaryProtocol?p.Format.msgpack:p.Format.json,G=p.defaultPostHeaders(this.client.options,q);this.client.options.headers&&p.mixin(G,this.client.options.headers);var x=p.encodeBody(z,q);A.default.post(this.client,"/keys/".concat(_,"/revokeTokens"),x,G,{newBatchResponse:"true"},null,function(D,j,B,V){if(D){F(D);return}var J=V?j:p.decodeBody(j,q);F(null,J)})},L}();t.default=k},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(s||(s={})),t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.HttpPaginatedResponse=t.PaginatedResult=void 0;var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(2)),d=s.__importDefault(i(15)),v=s.__importDefault(i(14));function b(R){var I=R.match(/^\.\/(\w+)\?(.*)$/);return I&&I[2]&&o.parseQueryString(I[2])}function w(R){typeof R=="string"&&(R=R.split(","));for(var I={},y=0;y<R.length;y++){var m=R[y].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(m){var T=b(m[1]);T&&(I[m[2]]=T)}}return I}function C(R,I,y){return!(y&&(I||typeof R.code=="number"))}var P=function(){function R(I,y,m,T,f,c){this.rest=I,this.path=y,this.headers=m,this.envelope=T??null,this.bodyHandler=f,this.useHttpPaginatedResponse=c||!1}return R.prototype.get=function(I,y){var m=this;d.default.get(this.rest,this.path,this.headers,I,this.envelope,function(T,f,c,u,a){m.handlePage(T,f,c,u,a,y)})},R.prototype.delete=function(I,y){var m=this;d.default.delete(this.rest,this.path,this.headers,I,this.envelope,function(T,f,c,u,a){m.handlePage(T,f,c,u,a,y)})},R.prototype.post=function(I,y,m){var T=this;d.default.post(this.rest,this.path,y,this.headers,I,this.envelope,function(f,c,u,a,g){m&&T.handlePage(f,c,u,a,g,m)})},R.prototype.put=function(I,y,m){var T=this;d.default.put(this.rest,this.path,y,this.headers,I,this.envelope,function(f,c,u,a,g){m&&T.handlePage(f,c,u,a,g,m)})},R.prototype.patch=function(I,y,m){var T=this;d.default.patch(this.rest,this.path,y,this.headers,I,this.envelope,function(f,c,u,a,g){m&&T.handlePage(f,c,u,a,g,m)})},R.prototype.handlePage=function(I,y,m,T,f,c){if(I&&C(I,y,this.useHttpPaginatedResponse)){p.default.logAction(p.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(I)),c==null||c(I);return}var u,a,g;try{u=f==v.default.NoContent?[]:this.bodyHandler(y,m||{},T)}catch(h){c==null||c(I||h);return}m&&(a=m.Link||m.link)&&(g=w(a)),this.useHttpPaginatedResponse?c(null,new A(this,u,m||{},f,g,I)):c(null,new l(this,u,g))},R}(),l=function(){function R(I,y,m){var T=this;this.resource=I,this.items=y;var f=this;m&&("first"in m&&(this.first=function(c){if(!c&&f.resource.rest.options.promises)return o.promisify(f,"first",[]);f.get(m.first,c)}),"current"in m&&(this.current=function(c){if(!c&&f.resource.rest.options.promises)return o.promisify(f,"current",[]);f.get(m.current,c)}),this.next=function(c){if(!c&&f.resource.rest.options.promises)return o.promisify(f,"next",[]);"next"in m?f.get(m.next,c):c(null,null)},this.hasNext=function(){return"next"in m},this.isLast=function(){var c;return!(!((c=T.hasNext)===null||c===void 0)&&c.call(T))})}return R.prototype.get=function(I,y){var m=this.resource;d.default.get(m.rest,m.path,m.headers,I,m.envelope,function(T,f,c,u,a){m.handlePage(T,f,c,u,a,y)})},R}();t.PaginatedResult=l;var A=function(R){s.__extends(I,R);function I(y,m,T,f,c,u){var a=R.call(this,y,m,c)||this;return a.statusCode=f,a.success=f<300&&f>=200,a.headers=T,a.errorCode=u&&u.code,a.errorMessage=u&&u.message,a}return I.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},I}(l);t.HttpPaginatedResponse=A,t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isRetriable=void 0;var s=i(0),o=s.__importDefault(i(4)),p={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},d={disconnected:function(){return o.default.fromValues({statusCode:400,code:p.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return o.default.fromValues({statusCode:400,code:p.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return o.default.fromValues({statusCode:400,code:p.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return o.default.fromValues({statusCode:400,code:p.CLOSING,message:"Connection closing"})},closed:function(){return o.default.fromValues({statusCode:400,code:p.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return o.default.fromValues({statusCode:500,code:p.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return o.default.fromValues({statusCode:500,code:p.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function v(b){return!b.statusCode||!b.code||b.statusCode>=500?!0:Object.values(p).includes(b.code)}t.isRetriable=v,t.default=d},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6),i(5),i(58),i(11),i(40),i(32),i(25),i(27),i(28),i(59),i(60))})(this,function(s){return s})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),p=function(){function d(v){this.members=v||[]}return d.prototype.call=function(){for(var v=[],b=0;b<arguments.length;b++)v[b]=arguments[b];for(var w=0,C=this.members;w<C.length;w++){var P=C[w];if(P)try{P.apply(void 0,v)}catch(l){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+l+"; stack = "+l.stack)}}},d.prototype.push=function(){for(var v,b=[],w=0;w<arguments.length;w++)b[w]=arguments[w];(v=this.members).push.apply(v,b)},d.create=function(v){var b=new d(v);return Object.assign(function(){for(var w=[],C=0;C<arguments.length;C++)w[C]=arguments[C];return b.call.apply(b,w)},{push:function(w){return b.push(w)}})},d}();t.default=p},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){(function(){var o=s,p=o.lib,d=p.Base,v=o.enc,b=v.Utf8,w=o.algo;w.HMAC=d.extend({init:function(C,P){C=this._hasher=new C.init,typeof P=="string"&&(P=b.parse(P));var l=C.blockSize,A=l*4;P.sigBytes>A&&(P=C.finalize(P)),P.clamp();for(var R=this._oKey=P.clone(),I=this._iKey=P.clone(),y=R.words,m=I.words,T=0;T<l;T++)y[T]^=1549556828,m[T]^=909522486;R.sigBytes=I.sigBytes=A,this.reset()},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey)},update:function(C){return this._hasher.update(C),this},finalize:function(C){var P=this._hasher,l=P.finalize(C);P.reset();var A=P.finalize(this._oKey.clone().concat(l));return A}})})()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),p=s.__importStar(i(1)),d=s.__importDefault(i(7)),v=s.__importDefault(i(2)),b=s.__importDefault(i(21)),w=s.__importDefault(i(4)),C=s.__importDefault(i(3)),P=o.default.Action,l=o.default.fromValues({action:P.CLOSE}),A=o.default.fromValues({action:P.DISCONNECT}),R=function(I){s.__extends(y,I);function y(m,T,f,c){var u=I.call(this)||this;return c&&(f.format=void 0,f.heartbeats=!0),u.connectionManager=m,m.registerProposedTransport(u),u.auth=T,u.params=f,u.timeouts=f.options.timeouts,u.format=f.format,u.isConnected=!1,u.isFinished=!1,u.isDisposed=!1,u.maxIdleInterval=null,u.idleTimer=null,u.lastActivity=null,u}return y.prototype.connect=function(){},y.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",b.default.closed())},y.prototype.disconnect=function(m){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",m||b.default.disconnected())},y.prototype.fail=function(m){this.isConnected&&this.requestDisconnect(),this.finish("failed",m||b.default.failed())},y.prototype.finish=function(m,T){var f;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((f=this.idleTimer)!==null&&f!==void 0?f:void 0),this.idleTimer=null,this.emit(m,T),this.dispose())},y.prototype.onProtocolMessage=function(m){switch(v.default.shouldLog(v.default.LOG_MICRO)&&v.default.logAction(v.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(m)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),m.action){case P.HEARTBEAT:v.default.logAction(v.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",m.id);break;case P.CONNECTED:this.onConnect(m),this.emit("connected",m.error,m.connectionId,m.connectionDetails,m);break;case P.CLOSED:this.onClose(m);break;case P.DISCONNECTED:this.onDisconnect(m);break;case P.ACK:this.emit("ack",m.msgSerial,m.count);break;case P.NACK:this.emit("nack",m.msgSerial,m.count,m.error);break;case P.SYNC:this.connectionManager.onChannelMessage(m,this);break;case P.ACTIVATE:break;case P.AUTH:this.auth.authorize(function(T){T&&v.default.logAction(v.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+p.inspectError(T))});break;case P.ERROR:if(v.default.logAction(v.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+C.default.Config.inspect(m.error)+(m.channel?", channel: "+m.channel:"")),m.channel===void 0){this.onFatalError(m);break}this.connectionManager.onChannelMessage(m,this);break;default:this.connectionManager.onChannelMessage(m,this)}},y.prototype.onConnect=function(m){if(this.isConnected=!0,!m.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var T=m.connectionDetails.maxIdleInterval;T&&(this.maxIdleInterval=T+this.timeouts.realtimeRequestTimeout,this.onActivity())},y.prototype.onDisconnect=function(m){var T=m&&m.error;v.default.logAction(v.default.LOG_MINOR,"Transport.onDisconnect()","err = "+p.inspectError(T)),this.finish("disconnected",T)},y.prototype.onFatalError=function(m){var T=m&&m.error;v.default.logAction(v.default.LOG_MINOR,"Transport.onFatalError()","err = "+p.inspectError(T)),this.finish("failed",T)},y.prototype.onClose=function(m){var T=m&&m.error;v.default.logAction(v.default.LOG_MINOR,"Transport.onClose()","err = "+p.inspectError(T)),this.finish("closed",T)},y.prototype.requestClose=function(){v.default.logAction(v.default.LOG_MINOR,"Transport.requestClose()",""),this.send(l)},y.prototype.requestDisconnect=function(){v.default.logAction(v.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(A)},y.prototype.ping=function(m){var T={action:o.default.Action.HEARTBEAT};m&&(T.id=m),this.send(o.default.fromValues(T))},y.prototype.dispose=function(){v.default.logAction(v.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},y.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=p.now(),this.setIdleTimer(this.maxIdleInterval+100))},y.prototype.setIdleTimer=function(m){var T=this;this.idleTimer||(this.idleTimer=setTimeout(function(){T.onIdleTimerExpire()},m))},y.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var m=p.now()-this.lastActivity,T=this.maxIdleInterval-m;if(T<=0){var f="No activity seen from realtime in "+m+"ms; assuming connection has dropped";v.default.logAction(v.default.LOG_ERROR,"Transport.onIdleTimerExpire()",f),this.disconnect(new w.default(f,80003,408))}else this.setIdleTimer(T+100)},y.tryConnect=function(m,T,f,c,u){var a=new m(T,f,c),g,h=function(N){clearTimeout(g),u({event:this.event,error:N})},O=T.options.timeouts.realtimeRequestTimeout;g=setTimeout(function(){a.off(["preconnect","disconnected","failed"]),a.dispose(),h.call({event:"disconnected"},new w.default("Timeout waiting for transport to indicate itself viable",5e4,500))},O),a.on(["failed","disconnected"],h),a.on("preconnect",function(){v.default.logAction(v.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+a),clearTimeout(g),a.off(["failed","disconnected"],h),u(null,a)}),a.connect()},y}(d.default);t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6),i(40),i(25))})(this,function(s){return function(){var o=s,p=o.lib,d=p.Base,v=p.WordArray,b=o.algo,w=b.MD5,C=b.EvpKDF=d.extend({cfg:d.extend({keySize:128/32,hasher:w,iterations:1}),init:function(P){this.cfg=this.cfg.extend(P)},compute:function(P,l){for(var A,R=this.cfg,I=R.hasher.create(),y=v.create(),m=y.words,T=R.keySize,f=R.iterations;m.length<T;){A&&I.update(A),A=I.update(P).finalize(l),I.reset();for(var c=1;c<f;c++)A=I.finalize(A),I.reset();y.concat(A)}return y.sigBytes=T*4,y}});o.EvpKDF=function(P,l,A){return C.create(A).compute(P,l)}}(),s.EvpKDF})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(27))})(this,function(s){s.lib.Cipher||function(o){var p=s,d=p.lib,v=d.Base,b=d.WordArray,w=d.BufferedBlockAlgorithm,C=p.enc;C.Utf8;var P=C.Base64,l=p.algo,A=l.EvpKDF,R=d.Cipher=w.extend({cfg:v.extend(),createEncryptor:function(k,L){return this.create(this._ENC_XFORM_MODE,k,L)},createDecryptor:function(k,L){return this.create(this._DEC_XFORM_MODE,k,L)},init:function(k,L,M){this.cfg=this.cfg.extend(M),this._xformMode=k,this._key=L,this.reset()},reset:function(){w.reset.call(this),this._doReset()},process:function(k){return this._append(k),this._process()},finalize:function(k){k&&this._append(k);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function k(L){return typeof L=="string"?N:g}return function(L){return{encrypt:function(M,E,S){return k(E).encrypt(L,M,E,S)},decrypt:function(M,E,S){return k(E).decrypt(L,M,E,S)}}}}()});d.StreamCipher=R.extend({_doFinalize:function(){var k=this._process(!0);return k},blockSize:1});var I=p.mode={},y=d.BlockCipherMode=v.extend({createEncryptor:function(k,L){return this.Encryptor.create(k,L)},createDecryptor:function(k,L){return this.Decryptor.create(k,L)},init:function(k,L){this._cipher=k,this._iv=L}}),m=I.CBC=function(){var k=y.extend();k.Encryptor=k.extend({processBlock:function(M,E){var S=this._cipher,_=S.blockSize;L.call(this,M,E,_),S.encryptBlock(M,E),this._prevBlock=M.slice(E,E+_)}}),k.Decryptor=k.extend({processBlock:function(M,E){var S=this._cipher,_=S.blockSize,U=M.slice(E,E+_);S.decryptBlock(M,E),L.call(this,M,E,_),this._prevBlock=U}});function L(M,E,S){var _,U=this._iv;U?(_=U,this._iv=o):_=this._prevBlock;for(var F=0;F<S;F++)M[E+F]^=_[F]}return k}(),T=p.pad={},f=T.Pkcs7={pad:function(k,L){for(var M=L*4,E=M-k.sigBytes%M,S=E<<24|E<<16|E<<8|E,_=[],U=0;U<E;U+=4)_.push(S);var F=b.create(_,E);k.concat(F)},unpad:function(k){var L=k.words[k.sigBytes-1>>>2]&255;k.sigBytes-=L}};d.BlockCipher=R.extend({cfg:R.cfg.extend({mode:m,padding:f}),reset:function(){var k;R.reset.call(this);var L=this.cfg,M=L.iv,E=L.mode;this._xformMode==this._ENC_XFORM_MODE?k=E.createEncryptor:(k=E.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==k?this._mode.init(this,M&&M.words):(this._mode=k.call(E,this,M&&M.words),this._mode.__creator=k)},_doProcessBlock:function(k,L){this._mode.processBlock(k,L)},_doFinalize:function(){var k,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),k=this._process(!0)):(k=this._process(!0),L.unpad(k)),k},blockSize:128/32});var c=d.CipherParams=v.extend({init:function(k){this.mixIn(k)},toString:function(k){return(k||this.formatter).stringify(this)}}),u=p.format={},a=u.OpenSSL={stringify:function(k){var L,M=k.ciphertext,E=k.salt;return E?L=b.create([1398893684,1701076831]).concat(E).concat(M):L=M,L.toString(P)},parse:function(k){var L,M=P.parse(k),E=M.words;return E[0]==1398893684&&E[1]==1701076831&&(L=b.create(E.slice(2,4)),E.splice(0,4),M.sigBytes-=16),c.create({ciphertext:M,salt:L})}},g=d.SerializableCipher=v.extend({cfg:v.extend({format:a}),encrypt:function(k,L,M,E){E=this.cfg.extend(E);var S=k.createEncryptor(M,E),_=S.finalize(L),U=S.cfg;return c.create({ciphertext:_,key:M,iv:U.iv,algorithm:k,mode:U.mode,padding:U.padding,blockSize:k.blockSize,formatter:E.format})},decrypt:function(k,L,M,E){E=this.cfg.extend(E),L=this._parse(L,E.format);var S=k.createDecryptor(M,E).finalize(L.ciphertext);return S},_parse:function(k,L){return typeof k=="string"?L.parse(k,this):k}}),h=p.kdf={},O=h.OpenSSL={execute:function(k,L,M,E){E||(E=b.random(64/8));var S=A.create({keySize:L+M}).compute(k,E),_=b.create(S.words.slice(L),M*4);return S.sigBytes=L*4,c.create({key:S,iv:_,salt:E})}},N=d.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:O}),encrypt:function(k,L,M,E){E=this.cfg.extend(E);var S=E.kdf.execute(M,k.keySize,k.ivSize);E.iv=S.iv;var _=g.encrypt.call(this,k,L,S.key,E);return _.mixIn(S),_},decrypt:function(k,L,M,E){E=this.cfg.extend(E),L=this._parse(L,E.format);var S=E.kdf.execute(M,k.keySize,k.ivSize,L.salt);E.iv=S.iv;var _=g.decrypt.call(this,k,L,S.key,E);return _}})}()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.createRequest=void 0;var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(12)),d=s.__importDefault(i(3)),v=s.__importDefault(i(7)),b=i(4),w=s.__importDefault(i(8)),C=s.__importDefault(i(2)),P=s.__importDefault(i(22)),l=o.getGlobalObject(),A=function(){},R=l._ablyjs_jsonp={};R._=function(u){return R["_"+u]||A};var I=1,y="jsonp";function m(u,a,g,h,O,N,k){return N=N||w.default.TIMEOUTS,new f(void 0,u,a,o.copy(g),h,O,N,k)}t.createRequest=m;var T=function(u){s.__extends(a,u);function a(g,h,O){var N=u.call(this,g,h,O)||this;return N.shortName=y,O.stream=!1,N}return a.isAvailable=function(){return d.default.Config.jsonpSupported&&d.default.Config.allowComet},a.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},a.prototype.createRequest=function(g,h,O,N,k,L,M){return L=(this===null||this===void 0?void 0:this.timeouts)||L||w.default.TIMEOUTS,m(g,h,O,N,k,L,M)},a}(p.default),f=function(u){s.__extends(a,u);function a(g,h,O,N,k,L,M,E){var S=u.call(this)||this;return g===void 0&&(g=I++),S.id=g,S.uri=h,S.params=N||{},S.params.rnd=o.cheapRandStr(),O&&(O["X-Ably-Version"]&&(S.params.v=O["X-Ably-Version"]),O["X-Ably-Lib"]&&(S.params.lib=O["X-Ably-Lib"])),S.body=k,S.method=E,S.requestMode=L,S.timeouts=M,S.requestComplete=!1,S}return a.prototype.exec=function(){var g=this,h=this.id,O=this.body,N=this.method,k=this.uri,L=this.params;L.callback="_ablyjs_jsonp._("+h+")",L.envelope="jsonp",O&&(L.body=O),N&&N!=="get"&&(L.method=N);var M=this.script=document.createElement("script"),E=k+o.toQueryString(L);M.src=E,M.src.split("/").slice(-1)[0]!==E.split("/").slice(-1)[0]&&C.default.logAction(C.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),M.async=!0,M.type="text/javascript",M.charset="UTF-8",M.onerror=function(U){g.complete(new b.PartialErrorInfo("JSONP script error (event: "+d.default.Config.inspect(U)+")",null,400))},R["_"+h]=function(U){if(U.statusCode){var F=U.response;if(U.statusCode==204)g.complete(null,null,null,U.statusCode);else if(!F)g.complete(new b.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(U.statusCode<400||o.isArray(F))g.complete(null,F,U.headers,U.statusCode);else{var z=F.error||new b.PartialErrorInfo("Error response received from server",null,U.statusCode);g.complete(z)}}else g.complete(null,U)};var S=this.requestMode==P.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),S);var _=document.getElementsByTagName("head")[0];_.insertBefore(M,_.firstChild)},a.prototype.complete=function(g,h,O,N){if(O=O||{},!this.requestComplete){this.requestComplete=!0;var k=void 0;h&&(k=typeof h=="string"?"text/plain":"application/json",O["content-type"]=k,this.emit("data",h)),this.emit("complete",g,h,O,!0,N),this.dispose()}},a.prototype.abort=function(){this.dispose()},a.prototype.dispose=function(){var g=this.timer;g&&(clearTimeout(g),this.timer=null);var h=this.script;h.parentNode&&h.parentNode.removeChild(h),delete R[this.id],this.emit("disposed")},a}(v.default);t.Request=f;function c(u){return l.JSONPTransport=T,T.isAvailable()&&(u.supportedTransports[y]=T),T}t.default=c},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(2)),d=s.__importDefault(i(8)),v=s.__importDefault(i(18)),b=s.__importDefault(i(46)),w=s.__importDefault(i(20)),C=s.__importDefault(i(33)),P=s.__importDefault(i(4)),l=s.__importDefault(i(49)),A=s.__importDefault(i(19)),R=s.__importDefault(i(3)),I=s.__importDefault(i(9)),y=s.__importDefault(i(16)),m=s.__importDefault(i(15)),T=function(){},f=function(){function u(a){if(!a){var g="no options provided";throw p.default.logAction(p.default.LOG_ERROR,"Rest()",g),new Error(g)}var h=d.default.objectifyOptions(a);h.log?(p.default.setLog(h.log.level,h.log.handler),p.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):p.default.setLog(h.logLevel,h.logHandler),p.default.logAction(p.default.LOG_MICRO,"Rest()","initialized with clientOptions "+R.default.Config.inspect(a));var O=this.options=d.default.normaliseOptions(h);if(O.key){var N=O.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!N){var g="invalid key parameter";throw p.default.logAction(p.default.LOG_ERROR,"Rest()",g),new P.default(g,40400,404)}O.keyName=N[1],O.keySecret=N[2]}if("clientId"in O)if(typeof O.clientId=="string"||O.clientId===null){if(O.clientId==="*")throw new P.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new P.default("clientId must be either a string or null",40012,400);p.default.logAction(p.default.LOG_MINOR,"Rest()","started; version = "+d.default.version),this.baseUri=this.authority=function(k){return d.default.getHttpScheme(O)+k+":"+d.default.getPort(O,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new R.default.Http(O),this.auth=new v.default(this,O),this.channels=new c(this),this.push=new b.default(this)}return u.prototype.stats=function(a,g){if(g===void 0)if(typeof a=="function")g=a,a=null;else{if(this.options.promises)return o.promisify(this,"stats",[a]);g=T}var h=o.defaultGetHeaders(this.options),O=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,N=this.http.supportsLinkHeaders?void 0:O;this.options.headers&&o.mixin(h,this.options.headers),new w.default(this,"/stats",h,N,function(k,L,M){for(var E=M?k:JSON.parse(k),S=0;S<E.length;S++)E[S]=l.default.fromValues(E[S]);return E}).get(a,g)},u.prototype.time=function(a,g){var h=this;if(g===void 0){if(typeof a=="function")g=a,a=null;else if(this.options.promises)return o.promisify(this,"time",[a])}var O=g||T,N=o.defaultGetHeaders(this.options);this.options.headers&&o.mixin(N,this.options.headers);var k=function(L){return h.authority(L)+"/time"};this.http.do(A.default.Get,this,k,N,null,a,function(L,M,E,S){if(L){O(L);return}S||(M=JSON.parse(M));var _=M[0];if(!_){O(new P.default("Internal error (unexpected result type from GET /time)",5e4,500));return}h.serverTimeOffset=_-o.now(),O(null,_)})},u.prototype.request=function(a,g,h,O,N,k){var L=this.options.useBinaryProtocol,M=L?R.default.Config.msgpack.encode:JSON.stringify,E=L?R.default.Config.msgpack.decode:JSON.parse,S=L?o.Format.msgpack:o.Format.json,_=this.http.supportsLinkHeaders?void 0:S;h=h||{};var U=a.toLowerCase(),F=U=="get"?o.defaultGetHeaders(this.options,S):o.defaultPostHeaders(this.options,S);if(k===void 0){if(this.options.promises)return o.promisify(this,"request",[a,g,h,O,N]);k=T}typeof O!="string"&&(O=M(O)),this.options.headers&&o.mixin(F,this.options.headers),N&&o.mixin(F,N);var z=new w.default(this,g,F,_,function(q,G,x){return o.ensureArray(x?q:E(q))},!0);if(!o.arrIn(R.default.Http.methods,U))throw new P.default("Unsupported method "+U,40500,405);o.arrIn(R.default.Http.methodsWithBody,U)?z[U](h,O,k):z[U](h,k)},u.prototype.batchPublish=function(a,g){if(g===void 0){if(this.options.promises)return o.promisify(this,"batchPublish",[a]);g=T}var h=g,O,N;o.isArray(a)?(O=a,N=!1):(O=[a],N=!0);var k=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,L=o.defaultPostHeaders(this.options,k);this.options.headers&&o.mixin(L,this.options.headers);var M=o.encodeBody(O,k);m.default.post(this,"/messages",M,L,{newBatchResponse:"true"},null,function(E,S,_,U){if(E){h(E);return}var F=U?S:o.decodeBody(S,k);N?h(null,F[0]):h(null,F)})},u.prototype.batchPresence=function(a,g){if(g===void 0){if(this.options.promises)return o.promisify(this,"batchPresence",[a]);g=T}var h=g,O=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,N=o.defaultPostHeaders(this.options,O);this.options.headers&&o.mixin(N,this.options.headers);var k=a.join(",");m.default.get(this,"/presence",N,{newBatchResponse:"true",channels:k},null,function(L,M,E,S){if(L){h(L);return}var _=S?M:o.decodeBody(M,O);h(null,_)})},u.prototype.setLog=function(a){p.default.setLog(a.level,a.handler)},u.Promise=function(a){return a=d.default.objectifyOptions(a),a.promises=!0,new u(a)},u.Callbacks=u,u.Platform=R.default,u.Message=I.default,u.PresenceMessage=y.default,u}(),c=function(){function u(a){this.rest=a,this.all=Object.create(null)}return u.prototype.get=function(a,g){a=String(a);var h=this.all[a];return h?g&&h.setOptions(g):this.all[a]=h=new C.default(this.rest,a,g),h},u.prototype.release=function(a){delete this.all[String(a)]},u}();t.default=f},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Utf8})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var p=s,d=p.lib,v=d.WordArray,b=d.Hasher,w=p.algo,C=[],P=[];(function(){function R(T){for(var f=o.sqrt(T),c=2;c<=f;c++)if(!(T%c))return!1;return!0}function I(T){return(T-(T|0))*4294967296|0}for(var y=2,m=0;m<64;)R(y)&&(m<8&&(C[m]=I(o.pow(y,1/2))),P[m]=I(o.pow(y,1/3)),m++),y++})();var l=[],A=w.SHA256=b.extend({_doReset:function(){this._hash=new v.init(C.slice(0))},_doProcessBlock:function(R,I){for(var y=this._hash.words,m=y[0],T=y[1],f=y[2],c=y[3],u=y[4],a=y[5],g=y[6],h=y[7],O=0;O<64;O++){if(O<16)l[O]=R[I+O]|0;else{var N=l[O-15],k=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,L=l[O-2],M=(L<<15|L>>>17)^(L<<13|L>>>19)^L>>>10;l[O]=k+l[O-7]+M+l[O-16]}var E=u&a^~u&g,S=m&T^m&f^T&f,_=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),U=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),F=h+U+E+P[O]+l[O],z=_+S;h=g,g=a,a=u,u=c+F|0,c=f,f=T,T=m,m=F+z|0}y[0]=y[0]+m|0,y[1]=y[1]+T|0,y[2]=y[2]+f|0,y[3]=y[3]+c|0,y[4]=y[4]+u|0,y[5]=y[5]+a|0,y[6]=y[6]+g|0,y[7]=y[7]+h|0},_doFinalize:function(){var R=this._data,I=R.words,y=this._nDataBytes*8,m=R.sigBytes*8;return I[m>>>5]|=128<<24-m%32,I[(m+64>>>9<<4)+14]=o.floor(y/4294967296),I[(m+64>>>9<<4)+15]=y,R.sigBytes=I.length*4,this._process(),this._hash},clone:function(){var R=b.clone.call(this);return R._hash=this._hash.clone(),R}});p.SHA256=b._createHelper(A),p.HmacSHA256=b._createHmacHelper(A)}(Math),s.SHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(7)),d=s.__importDefault(i(2)),v=s.__importDefault(i(34)),b=s.__importDefault(i(9)),w=s.__importDefault(i(4)),C=s.__importDefault(i(20)),P=s.__importDefault(i(15)),l=s.__importDefault(i(3));function A(){}var R=9;function I(T){return o.arrEvery(T,function(f){return!f.id})}function y(T){var f=T||{};if(f.cipher){if(!l.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var c=l.default.Crypto.getCipher(f.cipher);f.cipher=c.cipherParams,f.channelCipher=c.cipher}else"cipher"in f&&(f.cipher=void 0,f.channelCipher=null);return f}var m=function(T){s.__extends(f,T);function f(c,u,a){var g=T.call(this)||this;return d.default.logAction(d.default.LOG_MINOR,"Channel()","started; name = "+u),g.rest=c,g.name=u,g.basePath="/channels/"+encodeURIComponent(u),g.presence=new v.default(g),g.channelOptions=y(a),g}return f.prototype.setOptions=function(c){this.channelOptions=y(c)},f.prototype.history=function(c,u){if(d.default.logAction(d.default.LOG_MICRO,"Channel.history()","channel = "+this.name),u===void 0)if(typeof c=="function")u=c,c=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);u=A}this._history(c,u)},f.prototype._history=function(c,u){var a=this.rest,g=a.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:g,O=o.defaultGetHeaders(a.options,g);a.options.headers&&o.mixin(O,a.options.headers);var N=this.channelOptions;new C.default(a,this.basePath+"/messages",O,h,function(k,L,M){return b.default.fromResponseBody(k,N,M?void 0:g)}).get(c,u)},f.prototype.publish=function(){var c=this,u=arguments.length,a=arguments[0],g=arguments[1],h=arguments[u-1],O,N;if(typeof h!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);h=A}if(typeof a=="string"||a===null)O=[b.default.fromValues({name:a,data:g})],N=arguments[2];else if(o.isObject(a))O=[b.default.fromValues(a)],N=arguments[1];else if(o.isArray(a))O=b.default.fromValuesArray(a),N=arguments[1];else throw new w.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof N!="object"||!N)&&(N={});var k=this.rest,L=k.options,M=L.useBinaryProtocol?o.Format.msgpack:o.Format.json,E=k.options.idempotentRestPublishing,S=o.defaultPostHeaders(k.options,M);if(L.headers&&o.mixin(S,L.headers),E&&I(O)){var _=o.randomString(R);o.arrForEach(O,function(U,F){U.id=_+":"+F.toString()})}b.default.encodeArray(O,this.channelOptions,function(U){if(U){h(U);return}var F=b.default.getMessagesSize(O),z=L.maxMessageSize;if(F>z){h(new w.default("Maximum size of messages that can be published at once exceeded ( was "+F+" bytes; limit is "+z+" bytes)",40009,400));return}c._publish(b.default.serialize(O,M),S,N,h)})},f.prototype._publish=function(c,u,a,g){P.default.post(this.rest,this.basePath+"/messages",c,u,a,null,g)},f.prototype.status=function(c){if(typeof c!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var u=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,a=o.defaultPostHeaders(this.rest.options,u);P.default.get(this.rest,this.basePath,a,{},u,c||A)},f}(p.default);t.default=m},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(7)),d=s.__importDefault(i(2)),v=s.__importDefault(i(20)),b=s.__importDefault(i(16));function w(){}var C=function(P){s.__extends(l,P);function l(A){var R=P.call(this)||this;return R.channel=A,R.basePath=A.basePath+"/presence",R}return l.prototype.get=function(A,R){if(d.default.logAction(d.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),R===void 0)if(typeof A=="function")R=A,A=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);R=w}var I=this.channel.rest,y=I.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:y,T=o.defaultGetHeaders(I.options,y);I.options.headers&&o.mixin(T,I.options.headers);var f=this.channel.channelOptions;new v.default(I,this.basePath,T,m,function(c,u,a){return b.default.fromResponseBody(c,f,a?void 0:y)}).get(A,R)},l.prototype.history=function(A,R){return d.default.logAction(d.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(A,R)},l.prototype._history=function(A,R){if(R===void 0)if(typeof A=="function")R=A,A=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",[A]);R=w}var I=this.channel.rest,y=I.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:y,T=o.defaultGetHeaders(I.options,y);I.options.headers&&o.mixin(T,I.options.headers);var f=this.channel.channelOptions;new v.default(I,this.basePath+"/history",T,m,function(c,u,a){return b.default.fromResponseBody(c,f,a?void 0:y)}).get(A,R)},l}(p.default);t.default=C},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.TransportParams=void 0;var o=i(0),p=o.__importDefault(i(10)),d=o.__importStar(i(1)),v=o.__importStar(i(52)),b=o.__importStar(i(8)),w=o.__importDefault(i(3)),C=o.__importDefault(i(7)),P=o.__importDefault(i(36)),l=o.__importDefault(i(2)),A=o.__importDefault(i(37)),R=o.__importStar(i(21)),I=o.__importStar(i(4)),y=o.__importDefault(i(18)),m=o.__importDefault(i(9)),T=o.__importDefault(i(24)),f=o.__importDefault(i(53)),c=o.__importDefault(i(26)),u=o.__importDefault(i(14)),a=function(){var q;return typeof w.default.WebStorage<"u"&&((q=w.default.WebStorage)===null||q===void 0?void 0:q.localSupported)},g=function(){var q;return typeof w.default.WebStorage<"u"&&((q=w.default.WebStorage)===null||q===void 0?void 0:q.sessionSupported)},h=p.default.Action,O=function(){},N="ably-transport-preference",k="ably-connection-recovery";function L(){var q,G;return g()&&((G=(q=w.default.WebStorage)===null||q===void 0?void 0:q.getSession)===null||G===void 0?void 0:G.call(q,k))}function M(q){var G,x;return g()&&((x=(G=w.default.WebStorage)===null||G===void 0?void 0:G.setSession)===null||x===void 0?void 0:x.call(G,k,q))}function E(){var q,G;return g()&&((G=(q=w.default.WebStorage)===null||q===void 0?void 0:q.removeSession)===null||G===void 0?void 0:G.call(q,k))}function S(q,G){return d.arrIndexOf(w.default.Defaults.transportPreferenceOrder,q.shortName)>d.arrIndexOf(w.default.Defaults.transportPreferenceOrder,G.shortName)}function _(q,G,x){var D;if(q.channel!==G.channel||(D=q.action)!==h.PRESENCE&&D!==h.MESSAGE||D!==G.action)return!1;var j=D===h.PRESENCE?"presence":"messages",B=q[j].concat(G[j]),V=m.default.getMessagesSize(B);return V>x||!d.allSame(B,"clientId")||!d.arrEvery(B,function(J){return!J.id})?!1:(q[j]=B,!0)}function U(q){try{return JSON.parse(q)}catch{return null}}var F=function(){function q(G,x,D,j){this.options=G,this.host=x,this.mode=D,this.connectionKey=j,this.format=G.useBinaryProtocol?d.Format.msgpack:d.Format.json}return q.prototype.getConnectParams=function(G){var x=G?d.copy(G):{},D=this.options;switch(this.mode){case"upgrade":x.upgrade=this.connectionKey;break;case"resume":x.resume=this.connectionKey;break;case"recover":{var j=U(D.recover);j&&(x.recover=j.connectionKey);break}}return D.clientId!==void 0&&(x.clientId=D.clientId),D.echoMessages===!1&&(x.echo="false"),this.format!==void 0&&(x.format=this.format),this.stream!==void 0&&(x.stream=this.stream),this.heartbeats!==void 0&&(x.heartbeats=this.heartbeats),x.v=b.default.protocolVersion,x.agent=(0,b.getAgentString)(this.options),D.transportParams!==void 0&&d.mixin(x,D.transportParams),x},q.prototype.toString=function(){var G="[mode="+this.mode;return this.host&&(G+=",host="+this.host),this.connectionKey&&(G+=",connectionKey="+this.connectionKey),this.format&&(G+=",format="+this.format),G+="]",G},q}();t.TransportParams=F;var z=function(q){o.__extends(G,q);function G(x,D){var j=q.call(this)||this;j.disconnectedRetryCount=0,G.initTransports(),j.realtime=x,j.options=D;var B=D.timeouts,V=B.preferenceConnectTimeout+B.realtimeRequestTimeout;if(j.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:V,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:B.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:B.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:B.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},j.state=j.states.initialized,j.errorReason=null,j.queuedMessages=new P.default,j.msgSerial=0,j.connectionDetails=void 0,j.connectionId=void 0,j.connectionKey=void 0,j.connectionStateTtl=B.connectionStateTtl,j.maxIdleInterval=null,j.transports=d.intersect(D.transports||b.default.defaultTransports,G.supportedTransports),j.baseTransport=d.intersect(b.default.baseTransportOrder,j.transports)[0],j.upgradeTransports=d.intersect(j.transports,b.default.upgradeTransports),j.transportPreference=null,j.httpHosts=b.default.getHosts(D),j.activeProtocol=null,j.proposedTransports=[],j.pendingTransports=[],j.host=null,j.lastAutoReconnectAttempt=null,j.lastActivity=null,j.forceFallbackHost=!1,j.connectCounter=0,l.default.logAction(l.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(D.transports||b.default.defaultTransports)+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+j.transports+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+j.httpHosts+"]"),!j.transports.length){var J="no requested transports available";throw l.default.logAction(l.default.LOG_ERROR,"realtime.ConnectionManager()",J),new Error(J)}var Q=w.default.Config.addEventListener;return Q&&(g()&&typeof D.recover=="function"&&Q("beforeunload",j.persistConnection.bind(j)),D.closeOnUnload===!0&&Q("beforeunload",function(){l.default.logAction(l.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),j.requestState({state:"closing"})}),Q("online",function(){j.state==j.states.disconnected||j.state==j.states.suspended?(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),j.requestState({state:"connecting"})):j.state==j.states.connecting&&(j.pendingTransports.forEach(function(Z){Z.off()}),j.disconnectAllTransports(),j.startConnect())}),Q("offline",function(){j.state==j.states.connected&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),j.disconnectAllTransports())})),j}return G.initTransports=function(){(0,f.default)(G),d.arrForEach(w.default.Transports,function(x){x(G)})},G.prototype.createTransportParams=function(x,D){return new F(this.options,x,D,this.connectionKey)},G.prototype.getTransportParams=function(x){var D=this,j=function(B){if(D.connectionKey){B("resume");return}if(typeof D.options.recover=="string"){B("recover");return}var V=D.options.recover,J=L();if(J&&typeof V=="function"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),V(J,function(Q){Q?(D.options.recover=J.recoveryKey,B("recover")):B("clean")});return}B("clean")};j(function(B){var V=D.createTransportParams(null,B);if(B==="recover"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+D.options.recover);var J=U(D.options.recover);J&&(D.msgSerial=J.msgSerial)}else l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+V.toString());x(V)})},G.prototype.tryATransport=function(x,D,j){var B=this;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+D),c.default.tryConnect(G.supportedTransports[D],this,this.realtime.auth,x,function(V,J){var Q=B.state;if(Q==B.states.closing||Q==B.states.closed||Q==B.states.failed){J&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+Q.state+" while we were attempting the transport; closing "+J),J.close()),j(!0);return}if(V){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+D+" "+V.event+", err: "+V.error.toString()),y.default.isTokenErr(V.error)&&!(B.errorReason&&y.default.isTokenErr(B.errorReason))?(B.errorReason=V.error,B.realtime.auth._forceNewToken(null,null,function(Z){if(Z){B.actOnErrorFromAuthorize(Z);return}B.tryATransport(x,D,j)})):V.event==="failed"?(B.notifyState({state:"failed",error:V.error}),j(!0)):V.event==="disconnected"&&((0,R.isRetriable)(V.error)?j(!1):(B.notifyState({state:B.states.connecting.failState,error:V.error}),j(!0)));return}l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+D+"; setting pending"),B.setTransportPending(J,x),j(null,J)})},G.prototype.setTransportPending=function(x,D){var j=this,B=D.mode;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+x+"; mode = "+B),d.arrDeleteValue(this.proposedTransports,x),this.pendingTransports.push(x);var V=w.default.Defaults.transportPreferenceOrder[w.default.Defaults.transportPreferenceOrder.length-1];x.once("connected",function(Q,Z,ee){B=="upgrade"&&j.activeProtocol?x.shortName!==V&&d.arrIn(j.getUpgradePossibilities(),V)&&j.activeProtocol?setTimeout(function(){j.scheduleTransportActivation(Q,x,Z,ee)},j.options.timeouts.parallelUpgradeDelay):j.scheduleTransportActivation(Q,x,Z,ee):(j.activateTransport(Q,x,Z,ee),w.default.Config.nextTick(function(){j.connectImpl(D)})),B==="recover"&&j.options.recover&&(j.options.recover=null,j.unpersistConnection())});var J=this;x.on(["disconnected","closed","failed"],function(Q){J.deactivateTransport(x,this.event,Q)}),this.emit("transport.pending",x)},G.prototype.scheduleTransportActivation=function(x,D,j,B){var V=this,J=this.activeProtocol&&this.activeProtocol.getTransport(),Q=function(){D.disconnect(),d.arrDeleteValue(V.pendingTransports,D)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),Q();return}if(J&&!S(D,J)){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+" is no better than current active transport "+J.shortName+" - abandoning upgrade"),Q();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+D);var Z=null;if(!D.isConnected){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+D.shortName+"is no longer connected; abandoning upgrade"),Q();return}if(this.state===this.states.connected)l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Z=this.activeProtocol;else if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+D.shortName),Q();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+D);var ee=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+D),D.send(p.default.fromValues({action:h.ACTIVATE})),V.activateTransport(x,D,j,B),V.state===V.states.synchronizing?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+D),V.state=V.states.connected):l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+V.state.state+", so leaving unchanged"),V.state.sendEvents&&V.sendQueuedMessages()};Z?Z.onceIdle(ee):ee()},G.prototype.activateTransport=function(x,D,j,B){var V=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+D),x&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+x),j&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+j),B&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(B)),this.persistTransportPreference(D);var J=this.state,Q=this.states.connected.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+J.state),J.state==this.states.closing.state||J.state==this.states.closed.state||J.state==this.states.failed.state)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),D.disconnect(),!1;if(d.arrDeleteValue(this.pendingTransports,D),!D.isConnected)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+D+" since it appears to no longer be connected"),!1;var Z=this.activeProtocol;this.activeProtocol=new v.default(D),this.host=D.params.host;var ee=B.connectionKey;if(ee&&this.connectionKey!=ee&&this.setConnection(j,B,!!x),this.onConnectionDetailsUpdate(B,D),w.default.Config.nextTick(function(){D.on("connected",function(X,ie,fe){V.onConnectionDetailsUpdate(fe,D),V.emit("update",new A.default(Q,Q,null,X))})}),J.state===this.states.connected.state?x&&(this.errorReason=this.realtime.connection.errorReason=x,this.emit("update",new A.default(Q,Q,null,x))):(this.notifyState({state:"connected",error:x}),this.errorReason=this.realtime.connection.errorReason=x||null),this.emit("transport.active",D),Z)if(Z.messageQueue.count()>0&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Z.transport.shortName+", new one is "+D.shortName+") finishing with "+Z.messageQueue.count()+" messages still pending"),Z.transport===D){var re="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+D.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",re)}else Z.finish();return d.safeArrForEach(this.pendingTransports,function(X){if(X===D){var ie="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+D.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",ie),d.arrDeleteValue(V.pendingTransports,D)}else X.disconnect()}),d.safeArrForEach(this.proposedTransports,function(X){X===D?(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+D.shortName+"; stack = "+new Error().stack),d.arrDeleteValue(V.proposedTransports,D)):X.dispose()}),!0},G.prototype.deactivateTransport=function(x,D,j){var B=this.activeProtocol,V=B&&B.getTransport()===x,J=d.arrDeleteValue(this.pendingTransports,x),Q=d.arrDeleteValue(this.proposedTransports,x),Z=this.noTransportsScheduledForActivation();if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+x),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+D+(V?"; was active":J?"; was pending":Q?"; was proposed":"")+(Z?"":"; another transport is scheduled for activation")),j&&j.message&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+j.message),V&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(B.getPendingMessages()),w.default.Config.nextTick(function(){B.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",x),V&&Z||V&&D==="failed"||D==="closed"||B===null&&J&&this.pendingTransports.length===0){if(D==="disconnected"&&j&&j.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:D,error:j,retryImmediately:!0});return}var ee=D==="failed"&&y.default.isTokenErr(j)?"disconnected":D;this.notifyState({state:ee,error:j});return}V&&D==="disconnected"&&this.state!==this.states.synchronizing&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:j}))},G.prototype.noTransportsScheduledForActivation=function(){return d.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(x){return!x.isConnected})},G.prototype.setConnection=function(x,D,j){var B=this.connectionId,V=B&&B!==x,J=!B&&j;(V||J)&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==x&&l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=x,this.realtime.connection.key=this.connectionKey=D.connectionKey},G.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},G.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},G.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var x=d.now()-this.lastActivity;x>this.connectionStateTtl+this.maxIdleInterval&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+x+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},G.prototype.persistConnection=function(){if(g()){var x=this.createRecoveryKey();x&&M({recoveryKey:x,disconnectedAt:d.now(),location:s.location,clientId:this.realtime.auth.clientId})}},G.prototype.unpersistConnection=function(){E()},G.prototype.getError=function(){return this.errorReason||this.getStateError()},G.prototype.getStateError=function(){var x,D;return(D=(x=R.default)[this.state.state])===null||D===void 0?void 0:D.call(x)},G.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},G.prototype.enactStateChange=function(x){var D=x.current==="failed"?l.default.LOG_ERROR:l.default.LOG_MAJOR;l.default.logAction(D,"Connection state",x.current+(x.reason?"; reason: "+x.reason:"")),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+x.current+"; reason = "+(x.reason&&x.reason.message));var j=this.state=this.states[x.current];x.reason&&(this.errorReason=x.reason,this.realtime.connection.errorReason=x.reason),(j.terminal||j.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",x)},G.prototype.startTransitionTimer=function(x){var D=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+x.state),this.transitionTimer&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){D.transitionTimer&&(D.transitionTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager "+x.state+" timer expired","requesting new state: "+x.failState),D.notifyState({state:x.failState}))},x.retryDelay)},G.prototype.cancelTransitionTimer=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},G.prototype.startSuspendTimer=function(){var x=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){x.suspendTimer&&(x.suspendTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),x.states.connecting.failState="suspended",x.notifyState({state:"suspended"}))},this.connectionStateTtl))},G.prototype.checkSuspendTimer=function(x){x!=="disconnected"&&x!=="suspended"&&x!=="connecting"&&this.cancelSuspendTimer()},G.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},G.prototype.startRetryTimer=function(x){var D=this;this.retryTimer=setTimeout(function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),D.retryTimer=null,D.requestState({state:"connecting"})},x)},G.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},G.prototype.notifyState=function(x){var D=this,j,B,V=x.state,J=V==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||x.retryImmediately||this.state===this.states.connecting&&x.error&&y.default.isTokenErr(x.error)&&!(this.errorReason&&y.default.isTokenErr(this.errorReason)));if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+V+(J?"; will retry connection immediately":"")),V!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(x.state),(V==="suspended"||V==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var Q=this.states[x.state],Z=Q.retryDelay;Q.state==="disconnected"&&(this.disconnectedRetryCount++,Z=d.getRetryTime(Q.retryDelay,this.disconnectedRetryCount));var ee=new A.default(this.state.state,Q.state,Z,x.error||((B=(j=R.default)[Q.state])===null||B===void 0?void 0:B.call(j)));if(J){var re=function(){D.state===D.states.disconnected&&(D.lastAutoReconnectAttempt=d.now(),D.requestState({state:"connecting"}))},X=this.lastAutoReconnectAttempt&&d.now()-this.lastAutoReconnectAttempt+1;X&&X<1e3?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+X+"ms ago, waiting another "+(1e3-X)+"ms before trying again"),setTimeout(re,1e3-X)):w.default.Config.nextTick(re)}else(V==="disconnected"||V==="suspended")&&this.startRetryTimer(Z);(V==="disconnected"&&!J||V==="suspended"||Q.terminal)&&w.default.Config.nextTick(function(){D.disconnectAllTransports()}),V=="connected"&&!this.activeProtocol&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ee),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(V,ee.reason),this.failQueuedMessages(ee.reason))}},G.prototype.requestState=function(x){var D=this,j,B,V=x.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+V+"; current state: "+this.state.state),V!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(V),!(V=="connecting"&&this.state.state=="connected")&&!(V=="closing"&&this.state.state=="closed"))){var J=this.states[V],Q=new A.default(this.state.state,J.state,null,x.error||((B=(j=R.default)[J.state])===null||B===void 0?void 0:B.call(j)));this.enactStateChange(Q),V=="connecting"&&w.default.Config.nextTick(function(){D.startConnect()}),V=="closing"&&this.closeImpl()}},G.prototype.startConnect=function(){var x=this;if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var D=this.realtime.auth,j=++this.connectCounter,B=function(){x.checkConnectionStateFreshness(),x.getTransportParams(function(J){if(J.mode==="recover"&&J.options.recover){var Q=U(J.options.recover);Q&&x.realtime.channels.recoverChannels(Q.channelSerials)}j===x.connectCounter&&x.connectImpl(J,j)})};if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),D.method==="basic")B();else{var V=function(J){j===x.connectCounter&&(J?x.actOnErrorFromAuthorize(J):B())};this.errorReason&&y.default.isTokenErr(this.errorReason)?D._forceNewToken(null,null,V):D._ensureValidAuthCredentials(!1,V)}},G.prototype.connectImpl=function(x,D){var j=this.state.state;j!==this.states.connecting.state&&j!==this.states.connected.state?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+j):this.pendingTransports.length?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):j==this.states.connected.state?this.upgradeIfNeeded(x):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(x,D):this.connectBase(x,D)},G.prototype.connectPreference=function(x,D){var j=this,B=this.getTransportPreference(),V=!1;d.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(x,D)),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var J=setTimeout(function(){V=!0,j.state.state!==j.states.connected.state&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),j.disconnectAllTransports(),j.unpersistTransportPreference()),j.connectImpl(x,D)},this.options.timeouts.preferenceConnectTimeout);x.host=this.httpHosts[0],this.tryATransport(x,B,function(Q,Z){clearTimeout(J),V&&Z?(Z.off(),Z.disconnect(),d.arrDeleteValue(j.pendingTransports,Z)):!Z&&!Q&&(j.unpersistTransportPreference(),j.connectImpl(x,D))})},G.prototype.connectBase=function(x,D){var j=this,B=function(ee){j.notifyState({state:j.states.connecting.failState,error:ee})},V=this.httpHosts.slice(),J=function(ee,re){D===j.connectCounter&&!re&&!ee&&Z()};l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var Q=V.shift();if(!Q){B(new I.default("Unable to connect (no available host)",80003,404));return}x.host=Q;var Z=function(){if(!V.length){B(new I.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!j.realtime.http.checkConnectivity){B(new I.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}j.realtime.http.checkConnectivity(function(ee,re){if(D===j.connectCounter){if(ee){B(ee);return}if(!re){B(new I.default("Unable to connect (network unreachable)",80003,404));return}x.host=d.arrPopRandomElement(V),j.tryATransport(x,j.baseTransport,J)}})};if(this.forceFallbackHost&&V.length){this.forceFallbackHost=!1,Z();return}this.tryATransport(x,this.baseTransport,J)},G.prototype.getUpgradePossibilities=function(){var x=this.activeProtocol.getTransport().shortName,D=d.arrIndexOf(this.upgradeTransports,x);return this.upgradeTransports.slice(D+1)},G.prototype.upgradeIfNeeded=function(x){var D=this,j=this.getUpgradePossibilities();l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+w.default.Config.inspect(j)),j.length&&d.arrForEach(j,function(B){var V=D.createTransportParams(x.host,"upgrade");D.tryATransport(V,B,O)})},G.prototype.closeImpl=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),d.safeArrForEach(this.pendingTransports,function(x){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+x),x&&x.close()}),d.safeArrForEach(this.proposedTransports,function(x){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+x),x&&x.dispose()}),this.activeProtocol&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},G.prototype.onAuthUpdated=function(x,D){var j=this,B;switch(this.state.state){case"connected":{if(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var V=this.activeProtocol.getTransport().params;w.default.Config.nextTick(function(){j.state.state==="connected"&&j.upgradeIfNeeded(V)})}var J=(B=this.activeProtocol)===null||B===void 0?void 0:B.getTransport();J&&J.onAuthUpdated&&J.onAuthUpdated(x);var Q=p.default.fromValues({action:h.AUTH,auth:{accessToken:x.token}});this.send(Q);var Z=function(){j.off(ee),D(null,x)},ee=function(X){X.current==="failed"&&(j.off(Z),j.off(ee),D(X.reason||j.getStateError()))};this.once("connectiondetails",Z),this.on("connectionstate",ee);break}case"connecting":l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var re=function(X){switch(X.current){case"connected":j.off(re),D(null,x);break;case"failed":case"closed":case"suspended":j.off(re),D(X.reason||j.getStateError());break}};this.on("connectionstate",re),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},G.prototype.disconnectAllTransports=function(x){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(x?" except the active transport":"")),this.connectCounter++,d.safeArrForEach(this.pendingTransports,function(D){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+D),D&&D.disconnect()}),this.pendingTransports=[],d.safeArrForEach(this.proposedTransports,function(D){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+D),D&&D.dispose()}),this.proposedTransports=[],this.activeProtocol&&!x&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},G.prototype.send=function(x,D,j){j=j||O;var B=this.state;if(B.sendEvents){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new v.PendingMessage(x,j));return}var V=D&&B.queueEvents||B.forceQueueEvents;if(!V){var J="rejecting event, queueEvent was "+D+", state was "+B.state;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()",J),j(this.errorReason||new I.default(J,9e4,400));return}l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+p.default.stringify(x)),this.queue(x,j)},G.prototype.sendImpl=function(x){var D=x.message;x.ackRequired&&!x.sendAttempted&&(D.msgSerial=this.msgSerial++);try{this.activeProtocol.send(x)}catch(j){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+j.stack)}},G.prototype.queue=function(x,D){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var j=this.queuedMessages.last(),B=this.options.maxMessageSize;j&&!j.sendAttempted&&_(j.message,x,B)?(j.merged||(j.callback=T.default.create([j.callback]),j.merged=!0),j.callback.push(D)):this.queuedMessages.push(new v.PendingMessage(x,D))},G.prototype.sendQueuedMessages=function(){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var x;x=this.queuedMessages.shift();)this.sendImpl(x)},G.prototype.queuePendingMessages=function(x){x&&x.length&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+x.length+" pending messages"),this.queuedMessages.prepend(x))},G.prototype.failQueuedMessages=function(x){var D=this.queuedMessages.count();D>0&&(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+D+" queued messages, err = "+d.inspectError(x)),this.queuedMessages.completeAllMessages(x))},G.prototype.onChannelMessage=function(x,D){var j=this.activeProtocol&&D===this.activeProtocol.getTransport(),B=d.arrIn(this.pendingTransports,D)&&this.state==this.states.synchronizing;j||B?this.realtime.channels.onChannelMessage(x):d.arrIndexOf([h.ACK,h.NACK,h.ERROR],x.action)>-1?this.realtime.channels.onChannelMessage(x):l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(x)+"on defunct transport; discarding")},G.prototype.ping=function(x,D){var j=this;if(x){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+x);var B=function(){x.off("heartbeat",Q),D(new I.default("Timeout waiting for heartbeat response",5e4,500))},V=d.now(),J=d.cheapRandStr(),Q=function(ie){if(ie===J){x.off("heartbeat",Q),clearTimeout(Z);var fe=d.now()-V;D(null,fe)}},Z=setTimeout(B,this.options.timeouts.realtimeRequestTimeout);x.on("heartbeat",Q),x.ping(J);return}if(this.state.state!=="connected"){D(new I.default("Unable to ping service; not connected",4e4,400));return}var ee=!1,re=function(ie,fe){j.off("transport.active",X),ee||(ee=!0,D(ie,fe))},X=function(){ee||(ee=!0,w.default.Config.nextTick(function(){j.ping(null,D)}))};this.on("transport.active",X),this.ping(this.activeProtocol.getTransport(),re)},G.prototype.abort=function(x){this.activeProtocol.getTransport().fail(x)},G.prototype.registerProposedTransport=function(x){this.proposedTransports.push(x)},G.prototype.getTransportPreference=function(){var x,D;return this.transportPreference||a()&&((D=(x=w.default.WebStorage)===null||x===void 0?void 0:x.get)===null||D===void 0?void 0:D.call(x,N))},G.prototype.persistTransportPreference=function(x){var D,j;d.arrIn(b.default.upgradeTransports,x.shortName)&&(this.transportPreference=x.shortName,a()&&((j=(D=w.default.WebStorage)===null||D===void 0?void 0:D.set)===null||j===void 0||j.call(D,N,x.shortName)))},G.prototype.unpersistTransportPreference=function(){var x,D;this.transportPreference=null,a()&&((D=(x=w.default.WebStorage)===null||x===void 0?void 0:x.remove)===null||D===void 0||D.call(x,N))},G.prototype.actOnErrorFromAuthorize=function(x){if(x.code===40171)this.notifyState({state:"failed",error:x});else if(x.code===40102)this.notifyState({state:"failed",error:x});else if(x.statusCode===u.default.Forbidden){var D="Client configured authentication provider returned 403; failing the connection";l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",D),this.notifyState({state:"failed",error:new I.default(D,80019,403,x)})}else{var D="Client configured authentication provider request failed";l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",D),this.notifyState({state:this.state.failState,error:new I.default(D,80019,401,x)})}},G.prototype.onConnectionDetailsUpdate=function(x,D){if(x){this.connectionDetails=x,x.maxMessageSize&&(this.options.maxMessageSize=x.maxMessageSize);var j=x.clientId;if(j){var B=this.realtime.auth._uncheckedSetClientId(j);if(B){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",B.message),D.fail(B);return}}var V=x.connectionStateTtl;V&&(this.connectionStateTtl=V),this.maxIdleInterval=x.maxIdleInterval,this.emit("connectiondetails",x)}},G.supportedTransports={},G}(C.default);t.default=z}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(7)),p=s.__importDefault(i(2)),d=function(v){s.__extends(b,v);function b(){var w=v.call(this)||this;return w.messages=[],w}return b.prototype.count=function(){return this.messages.length},b.prototype.push=function(w){this.messages.push(w)},b.prototype.shift=function(){return this.messages.shift()},b.prototype.last=function(){return this.messages[this.messages.length-1]},b.prototype.copyAll=function(){return this.messages.slice()},b.prototype.append=function(w){this.messages.push.apply(this.messages,w)},b.prototype.prepend=function(w){this.messages.unshift.apply(this.messages,w)},b.prototype.completeMessages=function(w,C,P){p.default.logAction(p.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+w+"; count = "+C),P=P||null;var l=this.messages;if(l.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var A=l[0];if(A){var R=A.message.msgSerial,I=w+C;if(I>R)for(var y=l.splice(0,I-R),m=0,T=y;m<T.length;m++){var f=T[m];f.callback(P)}l.length==0&&this.emit("idle")}},b.prototype.completeAllMessages=function(w){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,w)},b.prototype.resetSendAttempted=function(){for(var w=0,C=this.messages;w<C.length;w++){var P=C[w];P.sendAttempted=!1}},b.prototype.clear=function(){p.default.logAction(p.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},b}(o.default);t.default=d},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(p,d,v,b){this.previous=p,this.current=d,v&&(this.retryIn=v),b&&(this.reason=b)}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),p=s.__importDefault(i(7)),d=s.__importStar(i(1)),v=s.__importDefault(i(33)),b=s.__importDefault(i(2)),w=s.__importDefault(i(54)),C=s.__importDefault(i(9)),P=s.__importDefault(i(39)),l=s.__importStar(i(4)),A=s.__importDefault(i(16)),R=s.__importDefault(i(21)),I=o.default.Action,y=function(){};function m(c){if(c&&"params"in c&&!d.isObject(c.params))return new l.default("options.params must be an object",4e4,400);if(c&&"modes"in c){if(!d.isArray(c.modes))return new l.default("options.modes must be an array",4e4,400);for(var u=0;u<c.modes.length;u++){var a=c.modes[u];if(!a||typeof a!="string"||!d.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(a)))return new l.default("Invalid channel mode: "+a,4e4,400)}}}var T=function(c){s.__extends(u,c);function u(a,g,h){var O=c.call(this,a,g,h)||this;return O.retryCount=0,O.history=function(N,k){if(b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),k===void 0)if(typeof N=="function")k=N,N=null;else{if(this.rest.options.promises)return d.promisify(this,"history",arguments);k=y}if(N&&N.untilAttach){if(this.state!=="attached"){k(new l.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){k(new l.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete N.untilAttach,N.from_serial=this.properties.attachSerial}v.default.prototype._history.call(this,N,k)},O.whenState=function(N,k){return p.default.prototype.whenState.call(O,N,O.state,k)},b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel()","started; name = "+g),O.realtime=a,O.presence=new w.default(O),O.connectionManager=a.connection.connectionManager,O.state="initialized",O.subscriptions=new p.default,O.syncChannelSerial=void 0,O.properties={attachSerial:void 0,channelSerial:void 0},O.setOptions(h),O.errorReason=null,O._requestedFlags=null,O._mode=null,O._attachResume=!1,O._decodingContext={channelOptions:O.channelOptions,plugins:a.options.plugins||{},baseEncodedPreviousPayload:void 0},O._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},O._allChannelChanges=new p.default,O}return u.prototype.invalidStateError=function(){return new l.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},u.processListenerArgs=function(a){return a=Array.prototype.slice.call(a),typeof a[0]=="function"&&a.unshift(null),a[a.length-1]==null&&a.pop(),a},u.prototype.setOptions=function(a,g){var h=this.channelOptions;if(!g&&this.rest.options.promises)return d.promisify(this,"setOptions",arguments);var O=g||function(k){k&&b.default.logAction(b.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+k.toString())},N=m(a);if(N){O(N);return}v.default.prototype.setOptions.call(this,a),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(a,h)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(k){switch(this.event){case"update":case"attached":O==null||O(null);return;default:O==null||O(k.reason);return}})):O()},u.prototype._shouldReattachToSetOptions=function(a,g){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(a!=null&&a.params){var h=f(a.params),O=f(g.params);if(Object.keys(h).length!==Object.keys(O).length||!d.shallowEquals(O,h))return!0}return!!(a!=null&&a.modes&&(!g.modes||!d.arrEquals(a.modes,g.modes)))},u.prototype.publish=function(){for(var a=this,g=[],h=0;h<arguments.length;h++)g[h]=arguments[h];var O=g[0],N=g.length,k=g[N-1];if(typeof k!="function"){if(this.realtime.options.promises)return d.promisify(this,"publish",arguments);k=y,++N}if(!this.connectionManager.activeState()){k(this.connectionManager.getError());return}if(N==2)if(d.isObject(O))O=[C.default.fromValues(O)];else if(d.isArray(O))O=C.default.fromValuesArray(O);else throw new l.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else O=[C.default.fromValues({name:g[0],data:g[1]})];var L=this.realtime.options.maxMessageSize;C.default.encodeArray(O,this.channelOptions,function(M){if(M){k(M);return}var E=C.default.getMessagesSize(O);if(E>L){k(new l.default("Maximum size of messages that can be published at once exceeded ( was "+E+" bytes; limit is "+L+" bytes)",40009,400));return}a.__publish(O,k)})},u.prototype.__publish=function(a,g){b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+a.length);var h=this.state;switch(h){case"failed":case"suspended":g(l.default.fromValues(this.invalidStateError()));break;default:{b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+h);var O=new o.default;O.action=I.MESSAGE,O.channel=this.name,O.messages=a,this.sendMessage(O,g);break}}},u.prototype.onEvent=function(a){b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var g=this.subscriptions,h=0;h<a.length;h++){var O=a[h];g.emit(O.name,O)}},u.prototype.attach=function(a,g){var h;if(typeof a=="function"?(g=a,h=null):h=a,!g){if(this.realtime.options.promises)return d.promisify(this,"attach",arguments);g=function(O){O&&b.default.logAction(b.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+O.toString())}}if(h)b.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=h;else if(this.state==="attached"){g(null,null);return}this._attach(!1,null,g)},u.prototype._attach=function(a,g,h){h||(h=function(N){N&&b.default.logAction(b.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+N.toString())});var O=this.connectionManager;if(!O.activeState()){h(O.getError());return}(this.state!=="attaching"||a)&&this.requestState("attaching",g),this.once(function(N){switch(this.event){case"attached":h==null||h(null,N);break;case"detached":case"suspended":case"failed":h==null||h(N.reason||O.getError()||new l.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":h==null||h(new l.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},u.prototype.attachImpl=function(){b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var a=o.default.fromValues({action:I.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?a.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&a.encodeModesToFlags(d.allToUpperCase(this.channelOptions.modes)),this._attachResume&&a.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(a.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(a,y)},u.prototype.detach=function(a){if(!a){if(this.realtime.options.promises)return d.promisify(this,"detach",arguments);a=y}var g=this.connectionManager;if(!g.activeState()){a(g.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),a();break;case"detached":a();break;case"failed":a(new l.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(h){switch(this.event){case"detached":a();break;case"attached":case"suspended":case"failed":a(h.reason||g.getError()||new l.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":a(new l.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},u.prototype.detachImpl=function(a){b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var g=o.default.fromValues({action:I.DETACH,channel:this.name});this.sendMessage(g,a||y)},u.prototype.subscribe=function(){for(var a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];var h=u.processListenerArgs(a),O=h[0],N=h[1],k=h[2];if(!k&&this.realtime.options.promises)return d.promisify(this,"subscribe",[O,N]);if(this.state==="failed"){k==null||k(l.default.fromValues(this.invalidStateError()));return}return O&&typeof O=="object"&&!Array.isArray(O)?this._subscribeFilter(O,N):this.subscriptions.on(O,N),this.attach(k||y)},u.prototype._subscribeFilter=function(a,g){var h=function(O){var N,k,L,M,E,S,_={name:O.name,refTimeserial:(k=(N=O.extras)===null||N===void 0?void 0:N.ref)===null||k===void 0?void 0:k.timeserial,refType:(M=(L=O.extras)===null||L===void 0?void 0:L.ref)===null||M===void 0?void 0:M.type,isRef:!!(!((S=(E=O.extras)===null||E===void 0?void 0:E.ref)===null||S===void 0)&&S.timeserial),clientId:O.clientId};Object.entries(a).find(function(U){var F=U[0],z=U[1];return z!==void 0?_[F]!==z:!1})||g(O)};this._addFilteredSubscription(a,g,h),this.subscriptions.on(h)},u.prototype._addFilteredSubscription=function(a,g,h){var O;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(g)){var N=this.filteredSubscriptions.get(g);N.set(a,((O=N==null?void 0:N.get(a))===null||O===void 0?void 0:O.concat(h))||[h])}else this.filteredSubscriptions.set(g,new Map([[a,[h]]]))},u.prototype._getAndDeleteFilteredSubscriptions=function(a,g){var h=this;if(!this.filteredSubscriptions)return[];if(!g&&a)return Array.from(this.filteredSubscriptions.entries()).map(function(L){var M,E=L[0],S=L[1],_=S.get(a);return S.delete(a),S.size===0&&((M=h.filteredSubscriptions)===null||M===void 0||M.delete(E)),_}).reduce(function(L,M){var E;return M?(E=L).concat.apply(E,M):L},[]);if(!g||!this.filteredSubscriptions.has(g))return[];var O=this.filteredSubscriptions.get(g);if(!a){var N=Array.from(O.values()).reduce(function(L,M){return L.concat.apply(L,M)},[]);return this.filteredSubscriptions.delete(g),N}var k=O.get(a);return O.delete(a),k||[]},u.prototype.unsubscribe=function(){for(var a=this,g,h=[],O=0;O<arguments.length;O++)h[O]=arguments[O];var N=u.processListenerArgs(h),k=N[0],L=N[1];if(typeof k=="object"&&!L||!((g=this.filteredSubscriptions)===null||g===void 0)&&g.has(L)){this._getAndDeleteFilteredSubscriptions(k,L).forEach(function(M){return a.subscriptions.off(M)});return}this.subscriptions.off(k,L)},u.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new l.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var a=this.connectionManager;if(!a.activeState())throw a.getError();var g=o.default.fromValues({action:I.SYNC,channel:this.name});this.syncChannelSerial&&(g.channelSerial=this.syncChannelSerial),a.send(g)},u.prototype.sendMessage=function(a,g){this.connectionManager.send(a,this.realtime.options.queueMessages,g)},u.prototype.sendPresence=function(a,g){var h=o.default.fromValues({action:I.PRESENCE,channel:this.name,presence:d.isArray(a)?A.default.fromValuesArray(a):[A.default.fromValues(a)]});this.sendMessage(h,g)},u.prototype.onMessage=function(a){(a.action===I.ATTACHED||a.action===I.MESSAGE||a.action===I.PRESENCE)&&this.setChannelSerial(a.channelSerial);var g,h=!1;switch(a.action){case I.ATTACHED:{this.properties.attachSerial=a.channelSerial,this._mode=a.getMode(),this.params=a.params||{};var O=a.decodeModesFromFlags();this.modes=O&&d.allToLowerCase(O)||void 0;var N=a.hasFlag("RESUMED"),k=a.hasFlag("HAS_PRESENCE"),L=a.hasFlag("HAS_BACKLOG");if(this.state==="attached"){N||this.presence.onAttached(k);var M=new P.default(this.state,this.state,N,L,a.error);this._allChannelChanges.emit("update",M),(!N||this.channelOptions.updateOnAttached)&&this.emit("update",M)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",a.error,N,k,L);break}case I.DETACHED:{var E=a.error?l.default.fromValues(a.error):new l.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",E):this.state==="attaching"?this.notifyState("suspended",E):this.requestState("attaching",E);break}case I.SYNC:if(h=!0,g=this.syncChannelSerial=a.channelSerial,!a.presence)break;case I.PRESENCE:{for(var S=a.presence,_=a.id,U=a.connectionId,F=a.timestamp,z=this.channelOptions,q=void 0,G=0;G<S.length;G++)try{q=S[G],A.default.decode(q,z),q.connectionId||(q.connectionId=U),q.timestamp||(q.timestamp=F),q.id||(q.id=_+":"+G)}catch(J){b.default.logAction(b.default.LOG_ERROR,"RealtimeChannel.onMessage()",J.toString())}this.presence.setPresence(S,h,g);break}case I.MESSAGE:{if(this.state!=="attached"){b.default.logAction(b.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+a.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var x=a.messages,D=x[0],j=x[x.length-1],_=a.id,U=a.connectionId,F=a.timestamp;if(D.extras&&D.extras.delta&&D.extras.delta.from!==this._lastPayload.messageId){var B='Delta message decode failure - previous message not available for message "'+a.id+'" on this channel "'+this.name+'".';b.default.logAction(b.default.LOG_ERROR,"RealtimeChannel.onMessage()",B),this._startDecodeFailureRecovery(new l.default(B,40018,400));break}for(var G=0;G<x.length;G++){var B=x[G];try{C.default.decode(B,this._decodingContext)}catch(X){switch(b.default.logAction(b.default.LOG_ERROR,"RealtimeChannel.onMessage()",X.toString()),X.code){case 40018:this._startDecodeFailureRecovery(X);return;case 40019:case 40021:this.notifyState("failed",X);return}}B.connectionId||(B.connectionId=U),B.timestamp||(B.timestamp=F),B.id||(B.id=_+":"+G)}this._lastPayload.messageId=j.id,this._lastPayload.protocolMessageChannelSerial=a.channelSerial,this.onEvent(x);break}case I.ERROR:{var V=a.error;V&&V.code==80016?this.checkPendingState():this.notifyState("failed",l.default.fromValues(V));break}default:b.default.logAction(b.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+a.action+")"),this.connectionManager.abort(R.default.unknownChannelErr())}},u.prototype._startDecodeFailureRecovery=function(a){var g=this;this._lastPayload.decodeFailureRecoveryInProgress||(b.default.logAction(b.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,a,function(){g._lastPayload.decodeFailureRecoveryInProgress=!1}))},u.prototype.onAttached=function(){b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},u.prototype.notifyState=function(a,g,h,O,N){if(b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+a),this.clearStateTimer(),d.arrIn(["detached","suspended","failed"],a)&&(this.properties.channelSerial=null),a!==this.state){this.presence.actOnChannelState(a,O,g),a==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),g&&(this.errorReason=g);var k=new P.default(this.state,a,h,N,g),L=a==="failed"?b.default.LOG_ERROR:b.default.LOG_MAJOR;b.default.logAction(L,'Channel state for channel "'+this.name+'"',a+(g?"; reason: "+g:"")),a!=="attaching"&&a!=="suspended"&&(this.retryCount=0),a==="attached"&&this.onAttached(),a==="attached"?this._attachResume=!0:(a==="detaching"||a==="failed")&&(this._attachResume=!1),this.state=a,this._allChannelChanges.emit(a,k),this.emit(a,k)}},u.prototype.requestState=function(a,g){b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+a),this.notifyState(a,g),this.checkPendingState()},u.prototype.checkPendingState=function(){var a=this.connectionManager.state;if(!(a.sendEvents||a.forceQueueEvents)){b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},u.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var a=new l.default("Channel attach timed out",90007,408);this.notifyState("suspended",a);break}case"detaching":{var a=new l.default("Channel detach timed out",90007,408);this.notifyState("attached",a);break}default:this.checkPendingState();break}},u.prototype.startStateTimerIfNotRunning=function(){var a=this;this.stateTimer||(this.stateTimer=setTimeout(function(){b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),a.stateTimer=null,a.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},u.prototype.clearStateTimer=function(){var a=this.stateTimer;a&&(clearTimeout(a),this.stateTimer=null)},u.prototype.startRetryTimer=function(){var a=this;if(!this.retryTimer){this.retryCount++;var g=d.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){a.state==="suspended"&&a.connectionManager.state.sendEvents&&(a.retryTimer=null,b.default.logAction(b.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),a.requestState("attaching"))},g)}},u.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},u.prototype.getReleaseErr=function(){var a=this.state;return a==="initialized"||a==="detached"||a==="failed"?null:new l.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+a,90001,400)},u.prototype.setChannelSerial=function(a){b.default.logAction(b.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+a+"; previous = "+this.properties.channelSerial),a&&(this.properties.channelSerial=a)},u}(v.default);function f(c){var u=c||{};u.agent;var a=s.__rest(u,["agent"]);return a}t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(p,d,v,b,w){this.previous=p,this.current=d,d==="attached"&&(this.resumed=v,this.hasBacklog=b),w&&(this.reason=w)}return o}();t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,p=o.lib,d=p.WordArray,v=p.Hasher,b=o.algo,w=[],C=b.SHA1=v.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(P,l){for(var A=this._hash.words,R=A[0],I=A[1],y=A[2],m=A[3],T=A[4],f=0;f<80;f++){if(f<16)w[f]=P[l+f]|0;else{var c=w[f-3]^w[f-8]^w[f-14]^w[f-16];w[f]=c<<1|c>>>31}var u=(R<<5|R>>>27)+T+w[f];f<20?u+=(I&y|~I&m)+1518500249:f<40?u+=(I^y^m)+1859775393:f<60?u+=(I&y|I&m|y&m)-1894007588:u+=(I^y^m)-899497514,T=m,m=y,y=I<<30|I>>>2,I=R,R=u}A[0]=A[0]+R|0,A[1]=A[1]+I|0,A[2]=A[2]+y|0,A[3]=A[3]+m|0,A[4]=A[4]+T|0},_doFinalize:function(){var P=this._data,l=P.words,A=this._nDataBytes*8,R=P.sigBytes*8;return l[R>>>5]|=128<<24-R%32,l[(R+64>>>9<<4)+14]=Math.floor(A/4294967296),l[(R+64>>>9<<4)+15]=A,P.sigBytes=l.length*4,this._process(),this._hash},clone:function(){var P=v.clone.call(this);return P._hash=this._hash.clone(),P}});o.SHA1=v._createHelper(C),o.HmacSHA1=v._createHmacHelper(C)}(),s.SHA1})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});function s(f){if(f===void 0)return"undefined";var c,u;if(f instanceof ArrayBuffer?(u="ArrayBuffer",c=new DataView(f)):f instanceof DataView&&(u="DataView",c=f),!c)return JSON.stringify(f);for(var a=[],g=0;g<f.byteLength;g++){if(g>20){a.push("...");break}var h=c.getUint8(g).toString(16);h.length===1&&(h="0"+h),a.push(h)}return"<"+u+" "+a.join(" ")+">"}function o(f,c,u){for(var a=0,g=u.length;a<g;a++){var h=u.charCodeAt(a);if(h<128){f.setUint8(c++,h>>>0&127|0);continue}if(h<2048){f.setUint8(c++,h>>>6&31|192),f.setUint8(c++,h>>>0&63|128);continue}if(h<65536){f.setUint8(c++,h>>>12&15|224),f.setUint8(c++,h>>>6&63|128),f.setUint8(c++,h>>>0&63|128);continue}if(h<1114112){f.setUint8(c++,h>>>18&7|240),f.setUint8(c++,h>>>12&63|128),f.setUint8(c++,h>>>6&63|128),f.setUint8(c++,h>>>0&63|128);continue}throw new Error("bad codepoint "+h)}}function p(f,c,u){for(var a="",g=c,h=c+u;g<h;g++){var O=f.getUint8(g);if(!(O&128)){a+=String.fromCharCode(O);continue}if((O&224)===192){a+=String.fromCharCode((O&15)<<6|f.getUint8(++g)&63);continue}if((O&240)===224){a+=String.fromCharCode((O&15)<<12|(f.getUint8(++g)&63)<<6|(f.getUint8(++g)&63)<<0);continue}if((O&248)===240){a+=String.fromCharCode((O&7)<<18|(f.getUint8(++g)&63)<<12|(f.getUint8(++g)&63)<<6|(f.getUint8(++g)&63)<<0);continue}throw new Error("Invalid byte "+O.toString(16))}return a}function d(f){for(var c=0,u=0,a=f.length;u<a;u++){var g=f.charCodeAt(u);if(g<128){c+=1;continue}if(g<2048){c+=2;continue}if(g<65536){c+=3;continue}if(g<1114112){c+=4;continue}throw new Error("bad codepoint "+g)}return c}function v(f,c){var u=T(f,c);if(u!==0){var a=new ArrayBuffer(u),g=new DataView(a);return m(f,g,0,c),a}}var b=65536*65536,w=1/b;function C(f,c){return c=c||0,f.getInt32(c)*b+f.getUint32(c+4)}function P(f,c){return c=c||0,f.getUint32(c)*b+f.getUint32(c+4)}function l(f,c,u){u<9223372036854776e3?(f.setInt32(c,Math.floor(u*w)),f.setInt32(c+4,u&-1)):(f.setUint32(c,2147483647),f.setUint32(c+4,2147483647))}function A(f,c,u){u<18446744073709552e3?(f.setUint32(c,Math.floor(u*w)),f.setInt32(c+4,u&-1)):(f.setUint32(c,4294967295),f.setUint32(c+4,4294967295))}var R=function(){function f(c,u){var a=this;this.map=function(g){for(var h={},O=0;O<g;O++){var N=a.parse();h[N]=a.parse()}return h},this.bin=function(g){var h=new ArrayBuffer(g);return new Uint8Array(h).set(new Uint8Array(a.view.buffer,a.offset,g),0),a.offset+=g,h},this.buf=this.bin,this.str=function(g){var h=p(a.view,a.offset,g);return a.offset+=g,h},this.array=function(g){for(var h=new Array(g),O=0;O<g;O++)h[O]=a.parse();return h},this.ext=function(g){return a.offset+=g,{type:a.view.getInt8(a.offset),data:a.buf(g)}},this.parse=function(){var g=a.view.getUint8(a.offset),h,O;if(!(g&128))return a.offset++,g;if((g&240)===128)return O=g&15,a.offset++,a.map(O);if((g&240)===144)return O=g&15,a.offset++,a.array(O);if((g&224)===160)return O=g&31,a.offset++,a.str(O);if((g&224)===224)return h=a.view.getInt8(a.offset),a.offset++,h;switch(g){case 192:return a.offset++,null;case 193:a.offset++;return;case 194:return a.offset++,!1;case 195:return a.offset++,!0;case 196:return O=a.view.getUint8(a.offset+1),a.offset+=2,a.bin(O);case 197:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.bin(O);case 198:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.bin(O);case 199:return O=a.view.getUint8(a.offset+1),a.offset+=2,a.ext(O);case 200:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.ext(O);case 201:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.ext(O);case 202:return h=a.view.getFloat32(a.offset+1),a.offset+=5,h;case 203:return h=a.view.getFloat64(a.offset+1),a.offset+=9,h;case 204:return h=a.view.getUint8(a.offset+1),a.offset+=2,h;case 205:return h=a.view.getUint16(a.offset+1),a.offset+=3,h;case 206:return h=a.view.getUint32(a.offset+1),a.offset+=5,h;case 207:return h=P(a.view,a.offset+1),a.offset+=9,h;case 208:return h=a.view.getInt8(a.offset+1),a.offset+=2,h;case 209:return h=a.view.getInt16(a.offset+1),a.offset+=3,h;case 210:return h=a.view.getInt32(a.offset+1),a.offset+=5,h;case 211:return h=C(a.view,a.offset+1),a.offset+=9,h;case 212:return O=1,a.offset++,a.ext(O);case 213:return O=2,a.offset++,a.ext(O);case 214:return O=4,a.offset++,a.ext(O);case 215:return O=8,a.offset++,a.ext(O);case 216:return O=16,a.offset++,a.ext(O);case 217:return O=a.view.getUint8(a.offset+1),a.offset+=2,a.str(O);case 218:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.str(O);case 219:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.str(O);case 220:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.array(O);case 221:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.array(O);case 222:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.map(O);case 223:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.map(O)}throw new Error("Unknown type 0x"+g.toString(16))},this.offset=u||0,this.view=c}return f}();function I(f){var c=new DataView(f),u=new R(c),a=u.parse();if(u.offset!==f.byteLength)throw new Error(f.byteLength-u.offset+" trailing bytes");return a}function y(f,c){return Object.keys(f).filter(function(u){var a=f[u],g=typeof a;return(!c||a!=null)&&(g!=="function"||!!a.toJSON)})}function m(f,c,u,a){var g=typeof f;if(typeof f=="string"){var h=d(f);if(h<32)return c.setUint8(u,h|160),o(c,u+1,f),1+h;if(h<256)return c.setUint8(u,217),c.setUint8(u+1,h),o(c,u+2,f),2+h;if(h<65536)return c.setUint8(u,218),c.setUint16(u+1,h),o(c,u+3,f),3+h;if(h<4294967296)return c.setUint8(u,219),c.setUint32(u+1,h),o(c,u+5,f),5+h}if(ArrayBuffer.isView&&ArrayBuffer.isView(f)&&(f=f.buffer),f instanceof ArrayBuffer){var O=f.byteLength;if(O<256)return c.setUint8(u,196),c.setUint8(u+1,O),new Uint8Array(c.buffer).set(new Uint8Array(f),u+2),2+O;if(O<65536)return c.setUint8(u,197),c.setUint16(u+1,O),new Uint8Array(c.buffer).set(new Uint8Array(f),u+3),3+O;if(O<4294967296)return c.setUint8(u,198),c.setUint32(u+1,O),new Uint8Array(c.buffer).set(new Uint8Array(f),u+5),5+O}if(typeof f=="number"){if(Math.floor(f)!==f)return c.setUint8(u,203),c.setFloat64(u+1,f),9;if(f>=0){if(f<128)return c.setUint8(u,f),1;if(f<256)return c.setUint8(u,204),c.setUint8(u+1,f),2;if(f<65536)return c.setUint8(u,205),c.setUint16(u+1,f),3;if(f<4294967296)return c.setUint8(u,206),c.setUint32(u+1,f),5;if(f<18446744073709552e3)return c.setUint8(u,207),A(c,u+1,f),9;throw new Error("Number too big 0x"+f.toString(16))}if(f>=-32)return c.setInt8(u,f),1;if(f>=-128)return c.setUint8(u,208),c.setInt8(u+1,f),2;if(f>=-32768)return c.setUint8(u,209),c.setInt16(u+1,f),3;if(f>=-2147483648)return c.setUint8(u,210),c.setInt32(u+1,f),5;if(f>=-9223372036854776e3)return c.setUint8(u,211),l(c,u+1,f),9;throw new Error("Number too small -0x"+(-f).toString(16).substr(1))}if(g==="undefined")return a?0:(c.setUint8(u,212),c.setUint8(u+1,0),c.setUint8(u+2,0),3);if(f===null)return a?0:(c.setUint8(u,192),1);if(g==="boolean")return c.setUint8(u,f?195:194),1;if(typeof f.toJSON=="function")return m(f.toJSON(),c,u,a);if(g==="object"){var N,k=0,L=void 0,M=Array.isArray(f);if(M?N=f.length:(L=y(f,a),N=L.length),N<16?(c.setUint8(u,N|(M?144:128)),k=1):N<65536?(c.setUint8(u,M?220:222),c.setUint16(u+1,N),k=3):N<4294967296&&(c.setUint8(u,M?221:223),c.setUint32(u+1,N),k=5),M)for(var E=0;E<N;E++)k+=m(f[E],c,u+k,a);else if(L)for(var E=0;E<N;E++){var S=L[E];k+=m(S,c,u+k),k+=m(f[S],c,u+k,a)}return k}if(g==="function")return 0;throw new Error("Unknown type "+g)}function T(f,c){var u=typeof f;if(u==="string"){var a=d(f);if(a<32)return 1+a;if(a<256)return 2+a;if(a<65536)return 3+a;if(a<4294967296)return 5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(f)&&(f=f.buffer),f instanceof ArrayBuffer){var g=f.byteLength;if(g<256)return 2+g;if(g<65536)return 3+g;if(g<4294967296)return 5+g}if(typeof f=="number"){if(Math.floor(f)!==f)return 9;if(f>=0){if(f<128)return 1;if(f<256)return 2;if(f<65536)return 3;if(f<4294967296)return 5;if(f<18446744073709552e3)return 9;throw new Error("Number too big 0x"+f.toString(16))}if(f>=-32)return 1;if(f>=-128)return 2;if(f>=-32768)return 3;if(f>=-2147483648)return 5;if(f>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+f.toString(16).substr(1))}if(u==="boolean")return 1;if(f===null)return c?0:1;if(f===void 0)return c?0:3;if(typeof f.toJSON=="function")return T(f.toJSON(),c);if(u==="object"){var h,O=0;if(Array.isArray(f)){h=f.length;for(var N=0;N<h;N++)O+=T(f[N],c)}else{var k=y(f,c);h=k.length;for(var N=0;N<h;N++){var L=k[N];O+=T(L)+T(f[L],c)}}if(h<16)return 1+O;if(h<65536)return 3+O;if(h<4294967296)return 5+O;throw new Error("Array or object too long 0x"+h.toString(16))}if(u==="function")return 0;throw new Error("Unknown type "+u)}t.default={encode:v,decode:I,inspect:s,utf8Write:o,utf8Read:p,utf8ByteCount:d}},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(30)),p=s.__importDefault(i(50)),d=s.__importDefault(i(3)),v=s.__importDefault(i(4)),b=s.__importDefault(i(55)),w=s.__importDefault(i(57)),C=s.__importDefault(i(62)),P=s.__importDefault(i(64)),l=s.__importDefault(i(68)),A=s.__importDefault(i(2)),R=i(8),I=s.__importDefault(i(65)),y=s.__importDefault(i(66)),m=s.__importDefault(i(41)),T=(0,w.default)(P.default,b.default);d.default.Crypto=T,d.default.BufferUtils=b.default,d.default.Http=C.default,d.default.Config=P.default,d.default.Transports=l.default,d.default.WebStorage=I.default,o.default.Crypto=T,p.default.Crypto=T,A.default.initLogHandlers(),d.default.Defaults=(0,R.getDefaults)(y.default),d.default.Config.agent&&(d.default.Defaults.agent+=" "+d.default.Config.agent),d.default.Config.noUpgrade&&(d.default.Defaults.upgradeTransports=[]),t.default={ErrorInfo:v.default,Rest:o.default,Realtime:p.default,msgpack:m.default}},function(n){n.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(n,t){},function(n,t,i){(function(s,o){n.exports=o(i(6),i(32),i(25))})(this,function(s){return s.HmacSHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(47)),d=s.__importDefault(i(15)),v=s.__importDefault(i(20)),b=s.__importDefault(i(4)),w=s.__importDefault(i(48)),C=function(){},P=function(){function I(y){this.rest=y,this.admin=new l(y)}return I}(),l=function(){function I(y){this.rest=y,this.deviceRegistrations=new A(y),this.channelSubscriptions=new R(y)}return I.prototype.publish=function(y,m,T){var f=this.rest,c=f.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,u=o.defaultPostHeaders(f.options,c),a={},g=o.mixin({recipient:y},m);if(typeof T!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);T=C}f.options.headers&&o.mixin(u,f.options.headers),f.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var h=o.encodeBody(g,c);d.default.post(f,"/push/publish",h,u,a,null,function(O){return T(O)})},I}(),A=function(){function I(y){this.rest=y}return I.prototype.save=function(y,m){var T=this.rest,f=p.default.fromValues(y),c=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,u=o.defaultPostHeaders(T.options,c),a={};if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);m=C}T.options.headers&&o.mixin(u,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var g=o.encodeBody(f,c);d.default.put(T,"/push/deviceRegistrations/"+encodeURIComponent(y.id),g,u,a,null,function(h,O,N,k){m(h,h?void 0:p.default.fromResponseBody(O,k?void 0:c))})},I.prototype.get=function(y,m){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f),u=y.id||y;if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);m=C}if(typeof u!="string"||!u.length){m(new b.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(c,T.options.headers),d.default.get(T,"/push/deviceRegistrations/"+encodeURIComponent(u),c,{},null,function(a,g,h,O){m(a,a?void 0:p.default.fromResponseBody(g,O?void 0:f))})},I.prototype.list=function(y,m){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:f,u=o.defaultGetHeaders(T.options,f);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);m=C}T.options.headers&&o.mixin(u,T.options.headers),new v.default(T,"/push/deviceRegistrations",u,c,function(a,g,h){return p.default.fromResponseBody(a,h?void 0:f)}).get(y,m)},I.prototype.remove=function(y,m){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f),u={},a=y.id||y;if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);m=C}if(typeof a!="string"||!a.length){m(new b.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(u,{fullWait:"true"}),d.default.delete(T,"/push/deviceRegistrations/"+encodeURIComponent(a),c,u,null,function(g){return m(g)})},I.prototype.removeWhere=function(y,m){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);m=C}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),d.default.delete(T,"/push/deviceRegistrations",c,y,null,function(u){return m(u)})},I}(),R=function(){function I(y){this.remove=I.prototype.removeWhere,this.rest=y}return I.prototype.save=function(y,m){var T=this.rest,f=w.default.fromValues(y),c=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,u=o.defaultPostHeaders(T.options,c),a={};if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);m=C}T.options.headers&&o.mixin(u,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var g=o.encodeBody(f,c);d.default.post(T,"/push/channelSubscriptions",g,u,a,null,function(h,O,N,k){m(h,!h&&w.default.fromResponseBody(O,k?void 0:c))})},I.prototype.list=function(y,m){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:f,u=o.defaultGetHeaders(T.options,f);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);m=C}T.options.headers&&o.mixin(u,T.options.headers),new v.default(T,"/push/channelSubscriptions",u,c,function(a,g,h){return w.default.fromResponseBody(a,h?void 0:f)}).get(y,m)},I.prototype.removeWhere=function(y,m){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);m=C}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),d.default.delete(T,"/push/channelSubscriptions",c,y,null,function(u){return m(u)})},I.prototype.listChannels=function(y,m){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:f,u=o.defaultGetHeaders(T.options,f);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);m=C}T.options.headers&&o.mixin(u,T.options.headers),T.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),new v.default(T,"/push/channels",u,c,function(a,g,h){for(var O=!h&&f?o.decodeBody(a,f):a,N=0;N<O.length;N++)O[N]=String(O[N]);return O}).get(y,m)},I}();t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(4)),d;(function(w){w.Phone="phone",w.Tablet="tablet",w.Desktop="desktop",w.TV="tv",w.Watch="watch",w.Car="car",w.Embedded="embedded",w.Other="other"})(d||(d={}));var v;(function(w){w.Android="android",w.IOS="ios",w.Browser="browser"})(v||(v={}));var b=function(){function w(){}return w.prototype.toJSON=function(){var C,P,l;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(C=this.push)===null||C===void 0?void 0:C.recipient,state:(P=this.push)===null||P===void 0?void 0:P.state,error:(l=this.push)===null||l===void 0?void 0:l.error}}},w.prototype.toString=function(){var C,P,l,A,R="[DeviceDetails";return this.id&&(R+="; id="+this.id),this.platform&&(R+="; platform="+this.platform),this.formFactor&&(R+="; formFactor="+this.formFactor),this.clientId&&(R+="; clientId="+this.clientId),this.metadata&&(R+="; metadata="+this.metadata),this.deviceIdentityToken&&(R+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((C=this.push)===null||C===void 0)&&C.recipient&&(R+="; push.recipient="+JSON.stringify(this.push.recipient)),!((P=this.push)===null||P===void 0)&&P.state&&(R+="; push.state="+this.push.state),!((l=this.push)===null||l===void 0)&&l.error&&(R+="; push.error="+JSON.stringify(this.push.error)),!((A=this.push)===null||A===void 0)&&A.metadata&&(R+="; push.metadata="+this.push.metadata),R+="]",R},w.fromResponseBody=function(C,P){return P&&(C=o.decodeBody(C,P)),o.isArray(C)?w.fromValuesArray(C):w.fromValues(C)},w.fromValues=function(C){return C.error=C.error&&p.default.fromValues(C.error),Object.assign(new w,C)},w.fromValuesArray=function(C){for(var P=C.length,l=new Array(P),A=0;A<P;A++)l[A]=w.fromValues(C[A]);return l},w.toRequestBody=o.encodeBody,w}();t.default=b},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=function(){function d(){}return d.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},d.prototype.toString=function(){var v="[PushChannelSubscription";return this.channel&&(v+="; channel="+this.channel),this.deviceId&&(v+="; deviceId="+this.deviceId),this.clientId&&(v+="; clientId="+this.clientId),v+="]",v},d.fromResponseBody=function(v,b){return b&&(v=o.decodeBody(v,b)),o.isArray(v)?d.fromValuesArray(v):d.fromValues(v)},d.fromValues=function(v){return Object.assign(new d,v)},d.fromValuesArray=function(v){for(var b=v.length,w=new Array(b),C=0;C<b;C++)w[C]=d.fromValues(v[C]);return w},d.toRequestBody=o.encodeBody,d}();t.default=p},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=function(){function T(f){this.count=f&&f.count||0,this.data=f&&f.data||0,this.uncompressedData=f&&f.uncompressedData||0,this.failed=f&&f.failed||0,this.refused=f&&f.refused||0}return T}(),d=function(T){s.__extends(f,T);function f(c){var u=T.call(this,c)||this;return c&&c.category&&(u.category={},o.forInOwnNonNullProperties(c.category,function(a){u.category[a]=new p(c.category[a])})),u}return f}(p),v=function(){function T(f){this.peak=f&&f.peak||0,this.min=f&&f.min||0,this.mean=f&&f.mean||0,this.opened=f&&f.opened||0,this.refused=f&&f.refused||0}return T}(),b=function(){function T(f){this.succeeded=f&&f.succeeded||0,this.failed=f&&f.failed||0,this.refused=f&&f.refused||0}return T}(),w=function(){function T(f){this.plain=new v(f&&f.plain),this.tls=new v(f&&f.tls),this.all=new v(f&&f.all)}return T}(),C=function(){function T(f){this.messages=new d(f&&f.messages),this.presence=new d(f&&f.presence),this.all=new d(f&&f.all)}return T}(),P=function(){function T(f){this.realtime=new C(f&&f.realtime),this.rest=new C(f&&f.rest),this.webhook=new C(f&&f.webhook),this.sharedQueue=new C(f&&f.sharedQueue),this.externalQueue=new C(f&&f.externalQueue),this.httpEvent=new C(f&&f.httpEvent),this.push=new C(f&&f.push),this.all=new C(f&&f.all)}return T}(),l=function(){function T(f){this.all=new C(f&&f.all),this.inbound=new P(f&&f.inbound),this.outbound=new P(f&&f.outbound)}return T}(),A=function(){function T(f){this.all=new C(f&&f.all),this.producerPaid=new l(f&&f.producerPaid),this.consumerPaid=new l(f&&f.consumerPaid)}return T}(),R=function(){function T(f){this.messages=f&&f.messages||0;var c=f&&f.notifications;this.notifications={invalid:c&&c.invalid||0,attempted:c&&c.attempted||0,successful:c&&c.successful||0,failed:c&&c.failed||0},this.directPublishes=f&&f.directPublishes||0}return T}(),I=function(){function T(f){this.succeeded=f&&f.succeeded||0,this.skipped=f&&f.skipped||0,this.failed=f&&f.failed||0}return T}(),y=function(){function T(f){var c=this;this.delta=void 0,f&&f.delta&&(this.delta={},o.forInOwnNonNullProperties(f.delta,function(u){c.delta[u]=new I(f.delta[u])}))}return T}(),m=function(T){s.__extends(f,T);function f(c){var u=T.call(this,c)||this;return u.persisted=new C(c&&c.persisted),u.connections=new w(c&&c.connections),u.channels=new v(c&&c.channels),u.apiRequests=new b(c&&c.apiRequests),u.tokenRequests=new b(c&&c.tokenRequests),u.xchgProducer=new A(c&&c.xchgProducer),u.xchgConsumer=new A(c&&c.xchgConsumer),u.push=new R(c&&c.pushStats),u.processed=new y(c&&c.processed),u.inProgress=c&&c.inProgress||void 0,u.unit=c&&c.unit||void 0,u.intervalId=c&&c.intervalId||void 0,u}return f.fromValues=function(c){return new f(c)},f}(l);t.default=m},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(30)),d=s.__importDefault(i(7)),v=s.__importDefault(i(2)),b=s.__importDefault(i(51)),w=s.__importDefault(i(38)),C=s.__importDefault(i(8)),P=s.__importDefault(i(4)),l=s.__importDefault(i(10)),A=s.__importDefault(i(35)),R=s.__importDefault(i(3)),I=s.__importDefault(i(9)),y=function(T){s.__extends(f,T);function f(c){var u=T.call(this,c)||this;return v.default.logAction(v.default.LOG_MINOR,"Realtime()",""),u.connection=new b.default(u,u.options),u.channels=new m(u),c.autoConnect!==!1&&u.connect(),u}return f.prototype.connect=function(){v.default.logAction(v.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},f.prototype.close=function(){v.default.logAction(v.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},f.Promise=function(c){return c=C.default.objectifyOptions(c),c.promises=!0,new f(c)},f.Callbacks=f,f.Utils=o,f.ConnectionManager=A.default,f.Platform=R.default,f.ProtocolMessage=l.default,f.Message=I.default,f}(p.default),m=function(T){s.__extends(f,T);function f(c){var u=T.call(this)||this;return u.realtime=c,u.all=Object.create(null),c.connection.connectionManager.on("transport.active",function(){u.onTransportActive()}),u}return f.prototype.channelSerials=function(){for(var c={},u=0,a=o.keysArray(this.all,!0);u<a.length;u++){var g=a[u],h=this.all[g];h.properties.channelSerial&&(c[g]=h.properties.channelSerial)}return c},f.prototype.recoverChannels=function(c){for(var u=0,a=o.keysArray(c,!0);u<a.length;u++){var g=a[u],h=this.get(g);h.properties.channelSerial=c[g]}},f.prototype.onChannelMessage=function(c){var u=c.channel;if(u===void 0){v.default.logAction(v.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+c.action);return}var a=this.all[u];if(!a){v.default.logAction(v.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+u);return}a.onMessage(c)},f.prototype.onTransportActive=function(){for(var c in this.all){var u=this.all[c];u.state==="attaching"||u.state==="detaching"?u.checkPendingState():u.state==="suspended"?u._attach(!1,null):u.state==="attached"&&u.requestState("attaching")}},f.prototype.propogateConnectionInterruption=function(c,u){var a={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},g=["attaching","attached","detaching","suspended"],h=a[c];for(var O in this.all){var N=this.all[O];o.arrIn(g,N.state)&&N.notifyState(h,u)}},f.prototype.get=function(c,u){c=String(c);var a=this.all[c];if(!a)a=this.all[c]=new w.default(this.realtime,c,u);else if(u){if(a._shouldReattachToSetOptions(u,a.channelOptions))throw new P.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);a.setOptions(u)}return a},f.prototype.getDerived=function(c,u,a){if(u.filter){var g=o.toBase64(u.filter),h=o.matchDerivedChannel(c);c="[filter=".concat(g).concat(h.qualifierParam,"]").concat(h.channelName)}return this.get(c,a)},f.prototype.release=function(c){c=String(c);var u=this.all[c];if(u){var a=u.getReleaseErr();if(a)throw a;delete this.all[c]}},f}(d.default);t.default=y},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(7)),d=s.__importDefault(i(35)),v=s.__importDefault(i(2)),b=s.__importDefault(i(37)),w=s.__importDefault(i(3));function C(){}var P=function(l){s.__extends(A,l);function A(R,I){var y=l.call(this)||this;return y.whenState=function(m,T){return p.default.prototype.whenState.call(y,m,y.state,T,new b.default(void 0,m))},y.ably=R,y.connectionManager=new d.default(R,I),y.state=y.connectionManager.state.state,y.key=void 0,y.id=void 0,y.errorReason=null,y.connectionManager.on("connectionstate",function(m){var T=y.state=m.current;w.default.Config.nextTick(function(){y.emit(T,m)})}),y.connectionManager.on("update",function(m){w.default.Config.nextTick(function(){y.emit("update",m)})}),y}return A.prototype.connect=function(){v.default.logAction(v.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},A.prototype.ping=function(R){if(v.default.logAction(v.default.LOG_MINOR,"Connection.ping()",""),!R){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);R=C}this.connectionManager.ping(null,R)},A.prototype.close=function(){v.default.logAction(v.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(A.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),A.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},A}(p.default);t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PendingMessage=void 0;var s=i(0),o=s.__importDefault(i(10)),p=s.__importStar(i(1)),d=s.__importDefault(i(7)),v=s.__importDefault(i(2)),b=s.__importDefault(i(36)),w=s.__importDefault(i(4)),C=o.default.Action,P=function(){function A(R,I){this.message=R,this.callback=I,this.merged=!1;var y=R.action;this.sendAttempted=!1,this.ackRequired=y==C.MESSAGE||y==C.PRESENCE}return A}();t.PendingMessage=P;var l=function(A){s.__extends(R,A);function R(I){var y=A.call(this)||this;return y.transport=I,y.messageQueue=new b.default,I.on("ack",function(m,T){y.onAck(m,T)}),I.on("nack",function(m,T,f){y.onNack(m,T,f)}),y}return R.prototype.onAck=function(I,y){v.default.logAction(v.default.LOG_MICRO,"Protocol.onAck()","serial = "+I+"; count = "+y),this.messageQueue.completeMessages(I,y)},R.prototype.onNack=function(I,y,m){v.default.logAction(v.default.LOG_ERROR,"Protocol.onNack()","serial = "+I+"; count = "+y+"; err = "+p.inspectError(m)),m||(m=new w.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(I,y,m)},R.prototype.onceIdle=function(I){var y=this.messageQueue;if(y.count()===0){I();return}y.once("idle",I)},R.prototype.send=function(I){I.ackRequired&&this.messageQueue.push(I),v.default.shouldLog(v.default.LOG_MICRO)&&v.default.logAction(v.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(I.message)),I.sendAttempted=!0,this.transport.send(I.message)},R.prototype.getTransport=function(){return this.transport},R.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},R.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},R.prototype.finish=function(){var I=this.transport;this.onceIdle(function(){I.disconnect()})},R}(d.default);t.default=l},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),p=s.__importStar(i(1)),d=s.__importDefault(i(26)),v=s.__importDefault(i(8)),b=s.__importDefault(i(2)),w=s.__importDefault(i(10)),C=s.__importDefault(i(4)),P="web_socket";function l(I){return!!I.on}var A=function(I){s.__extends(y,I);function y(m,T,f){var c=I.call(this,m,T,f)||this;return c.shortName=P,f.heartbeats=o.default.Config.useProtocolHeartbeats,c.wsHost=v.default.getHost(f.options,f.host,!0),c}return y.isAvailable=function(){return!!o.default.Config.WebSocket},y.prototype.createWebSocket=function(m,T){return this.uri=m+p.toQueryString(T),new o.default.Config.WebSocket(this.uri)},y.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},y.prototype.connect=function(){b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),d.default.prototype.connect.call(this);var m=this,T=this.params,f=T.options,c=f.tls?"wss://":"ws://",u=c+this.wsHost+":"+v.default.getPort(f)+"/";b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+u),this.auth.getAuthParams(function(a,g){if(!m.isDisposed){var h="";for(var O in g)h+=" "+O+": "+g[O]+";";if(b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+h+" err: "+a),a){m.disconnect(a);return}var N=T.getConnectParams(g);try{var k=m.wsConnection=m.createWebSocket(u,N);k.binaryType=o.default.Config.binaryType,k.onopen=function(){m.onWsOpen()},k.onclose=function(L){m.onWsClose(L)},k.onmessage=function(L){m.onWsData(L.data)},k.onerror=function(L){m.onWsError(L)},l(k)&&k.on("ping",function(){m.onActivity()})}catch(L){b.default.logAction(b.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(L.stack||L.message)),m.disconnect(L)}}})},y.prototype.send=function(m){var T=this.wsConnection;if(!T){b.default.logAction(b.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{T.send(w.default.serialize(m,this.params.format))}catch(c){var f="Exception from ws connection when trying to send: "+p.inspectError(c);b.default.logAction(b.default.LOG_ERROR,"WebSocketTransport.send()",f),this.finish("disconnected",new C.default(f,5e4,500))}},y.prototype.onWsData=function(m){b.default.logAction(b.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+m.length+"; type = "+typeof m);try{this.onProtocolMessage(w.default.deserialize(m,this.format))}catch(T){b.default.logAction(b.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+T.stack)}},y.prototype.onWsOpen=function(){b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},y.prototype.onWsClose=function(m){var T,f;if(typeof m=="object"?(f=m.code,T=m.wasClean||f===1e3):(f=m,T=f==1e3),delete this.wsConnection,T){b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var c=new C.default("Websocket closed",80003,400);this.finish("disconnected",c)}else{var u="Unclean disconnection of WebSocket ; code = "+f,c=new C.default(u,80003,400);b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.onWsClose()",u),this.finish("disconnected",c)}this.emit("disposed")},y.prototype.onWsError=function(m){var T=this;b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+m.message),o.default.Config.nextTick(function(){T.disconnect(Error(m.message))})},y.prototype.dispose=function(){b.default.logAction(b.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var m=this.wsConnection;m&&(m.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(b.default.logAction(b.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!m)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");m.close()}))},y}(d.default);function R(I){return A.isAvailable()&&(I.supportedTransports[P]=A),A}t.default=R},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),p=s.__importDefault(i(34)),d=s.__importDefault(i(7)),v=s.__importDefault(i(2)),b=s.__importDefault(i(16)),w=s.__importStar(i(4)),C=s.__importDefault(i(38)),P=s.__importDefault(i(24)),l=s.__importDefault(i(39)),A=function(){};function R(c){return c.channel.realtime.auth.clientId}function I(c){var u=c.channel.realtime,a=u.auth.clientId;return(!a||a==="*")&&u.connection.state==="connected"}function y(c,u,a){switch(c.state){case"attached":case"suspended":a();break;case"initialized":case"detached":case"detaching":case"attaching":c.attach(function(g){g?u(g):a()});break;default:u(w.default.fromValues(c.invalidStateError()))}}function m(c,u){if(c.isSynthesized()||u.isSynthesized())return c.timestamp>=u.timestamp;var a=c.parseId(),g=u.parseId();return a.msgSerial===g.msgSerial?a.index>g.index:a.msgSerial>g.msgSerial}var T=function(c){s.__extends(u,c);function u(a){var g=c.call(this,a)||this;return g.channel=a,g.syncComplete=!1,g.members=new f(g,function(h){return h.clientId+":"+h.connectionId}),g._myMembers=new f(g,function(h){return h.clientId}),g.subscriptions=new d.default,g.pendingPresence=[],g}return u.prototype.enter=function(a,g){if(I(this))throw new w.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"enter",g)},u.prototype.update=function(a,g){if(I(this))throw new w.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"update",g)},u.prototype.enterClient=function(a,g,h){return this._enterOrUpdateClient(void 0,a,g,"enter",h)},u.prototype.updateClient=function(a,g,h){return this._enterOrUpdateClient(void 0,a,g,"update",h)},u.prototype._enterOrUpdateClient=function(a,g,h,O,N){var k=this;if(!N)if(typeof h=="function")N=h,h=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[a,g,h,O]);N=A}var L=this.channel;if(!L.connectionManager.activeState()){N(L.connectionManager.getError());return}v.default.logAction(v.default.LOG_MICRO,"RealtimePresence."+O+"Client()","channel = "+L.name+", id = "+a+", client = "+(g||"(implicit) "+R(this)));var M=b.default.fromData(h);M.action=O,a&&(M.id=a),g&&(M.clientId=g),b.default.encode(M,L.channelOptions,function(E){if(E){N(E);return}switch(L.state){case"attached":L.sendPresence(M,N);break;case"initialized":case"detached":L.attach();case"attaching":k.pendingPresence.push({presence:M,callback:N});break;default:E=new w.PartialErrorInfo("Unable to "+O+" presence channel while in "+L.state+" state",90001),E.code=90001,N(E)}})},u.prototype.leave=function(a,g){if(I(this))throw new w.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,a,g)},u.prototype.leaveClient=function(a,g,h){if(!h)if(typeof g=="function")h=g,g=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[a,g]);h=A}var O=this.channel;if(!O.connectionManager.activeState()){h==null||h(O.connectionManager.getError());return}v.default.logAction(v.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+a);var N=b.default.fromData(g);switch(N.action="leave",a&&(N.clientId=a),O.state){case"attached":O.sendPresence(N,h);break;case"attaching":this.pendingPresence.push({presence:N,callback:h});break;case"initialized":case"failed":{var k=new w.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);h==null||h(k);break}default:h==null||h(O.invalidStateError())}},u.prototype.get=function(a,g){var h=this,O=Array.prototype.slice.call(arguments);O.length==1&&typeof O[0]=="function"&&O.unshift(null),a=O[0],g=O[1];var N=!a||("waitForSync"in a?a.waitForSync:!0);if(!g){if(this.channel.realtime.options.promises)return o.promisify(this,"get",O);g=A}function k(L){g(null,a?L.list(a):L.values())}if(this.channel.state==="suspended"){N?g(w.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):k(this.members);return}y(this.channel,g,function(){var L=h.members;N?L.waitSync(function(){k(L)}):k(L)})},u.prototype.history=function(a,g){if(v.default.logAction(v.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),g===void 0)if(typeof a=="function")g=a,a=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);g=A}a&&a.untilAttach&&(this.channel.state==="attached"?(delete a.untilAttach,a.from_serial=this.channel.properties.attachSerial):g(new w.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),p.default.prototype._history.call(this,a,g)},u.prototype.setPresence=function(a,g,h){v.default.logAction(v.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+a.length+" participants; syncChannelSerial = "+h);var O,N,k=this.members,L=this._myMembers,M=[],E=this.channel.connectionManager.connectionId;g&&(this.members.startSync(),h&&(N=h.match(/^[\w-]+:(.*)$/))&&(O=N[1]));for(var S=0;S<a.length;S++){var _=b.default.fromValues(a[S]);switch(_.action){case"leave":k.remove(_)&&M.push(_),_.connectionId===E&&!_.isSynthesized()&&L.remove(_);break;case"enter":case"present":case"update":k.put(_)&&M.push(_),_.connectionId===E&&L.put(_);break}}g&&!O&&(k.endSync(),this.channel.syncChannelSerial=null);for(var S=0;S<M.length;S++){var _=M[S];this.subscriptions.emit(_.action,_)}},u.prototype.onAttached=function(a){v.default.logAction(v.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+a),a?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var g=this.pendingPresence,h=g.length;if(h){this.pendingPresence=[];var O=[],N=P.default.create();v.default.logAction(v.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+h+" queued presence messages");for(var k=0;k<h;k++){var L=g[k];O.push(L.presence),N.push(L.callback)}this.channel.sendPresence(O,N)}},u.prototype.actOnChannelState=function(a,g,h){switch(a){case"attached":this.onAttached(g);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(h);break}},u.prototype.failPendingPresence=function(a){if(this.pendingPresence.length){v.default.logAction(v.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(a));for(var g=0;g<this.pendingPresence.length;g++)try{this.pendingPresence[g].callback(a)}catch{}this.pendingPresence=[]}},u.prototype._clearMyMembers=function(){this._myMembers.clear()},u.prototype._ensureMyMembersPresent=function(){var a=this,g=this._myMembers,h=function(k){if(k){var L="Presence auto-re-enter failed: "+k.toString(),M=new w.default(L,91004,400);v.default.logAction(v.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",L);var E=new l.default(a.channel.state,a.channel.state,!0,!1,M);a.channel.emit("update",E)}};for(var O in g.map){var N=g.map[O];v.default.logAction(v.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+N.clientId+'" into the presence set'),this._enterOrUpdateClient(N.id,N.clientId,N.data,"enter",h)}},u.prototype._synthesizeLeaves=function(a){var g=this.subscriptions;o.arrForEach(a,function(h){var O=b.default.fromValues({action:"leave",connectionId:h.connectionId,clientId:h.clientId,data:h.data,encoding:h.encoding,timestamp:o.now()});g.emit("leave",O)})},u.prototype.on=function(){for(var a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];v.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,a)},u.prototype.off=function(){for(var a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];v.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,a)},u.prototype.subscribe=function(){for(var a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];var h=C.default.processListenerArgs(a),O=h[0],N=h[1],k=h[2],L=this.channel;if(!k){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[O,N]);k=A}if(L.state==="failed"){k(w.default.fromValues(L.invalidStateError()));return}this.subscriptions.on(O,N),L.attach(k)},u.prototype.unsubscribe=function(){for(var a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];var h=C.default.processListenerArgs(a),O=h[0],N=h[1];this.subscriptions.off(O,N)},u}(p.default),f=function(c){s.__extends(u,c);function u(a,g){var h=c.call(this)||this;return h.presence=a,h.map=Object.create(null),h.syncInProgress=!1,h.residualMembers=null,h.memberKey=g,h}return u.prototype.get=function(a){return this.map[a]},u.prototype.getClient=function(a){var g=this.map,h=[];for(var O in g){var N=g[O];N.clientId==a&&N.action!="absent"&&h.push(N)}return h},u.prototype.list=function(a){var g=this.map,h=a&&a.clientId,O=a&&a.connectionId,N=[];for(var k in g){var L=g[k];L.action!=="absent"&&(h&&h!=L.clientId||O&&O!=L.connectionId||N.push(L))}return N},u.prototype.put=function(a){(a.action==="enter"||a.action==="update")&&(a=b.default.fromValues(a),a.action="present");var g=this.map,h=this.memberKey(a);this.residualMembers&&delete this.residualMembers[h];var O=g[h];return O&&!m(a,O)?!1:(g[h]=a,!0)},u.prototype.values=function(){var a=this.map,g=[];for(var h in a){var O=a[h];O.action!="absent"&&g.push(O)}return g},u.prototype.remove=function(a){var g=this.map,h=this.memberKey(a),O=g[h];return O&&!m(a,O)?!1:(this.syncInProgress?(a=b.default.fromValues(a),a.action="absent",g[h]=a):delete g[h],!0)},u.prototype.startSync=function(){var a=this.map,g=this.syncInProgress;v.default.logAction(v.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+g),this.syncInProgress||(this.residualMembers=o.copy(a),this.setInProgress(!0))},u.prototype.endSync=function(){var a=this.map,g=this.syncInProgress;if(v.default.logAction(v.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+g),g){for(var h in a){var O=a[h];O.action==="absent"&&delete a[h]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var h in this.residualMembers)delete a[h];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},u.prototype.waitSync=function(a){var g=this.syncInProgress;if(v.default.logAction(v.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+g),!g){a();return}this.once("sync",a)},u.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},u.prototype.setInProgress=function(a){v.default.logAction(v.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+a),this.syncInProgress=a,this.presence.syncComplete=!a},u}(d.default);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=i(56),p=i(31),d=i(11),v=s.__importDefault(i(5)),b=s.__importDefault(i(3)),w=function(){function C(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return C.prototype.isWordArray=function(P){return P!=null&&P.sigBytes!==void 0},C.prototype.isArrayBuffer=function(P){return P!=null&&P.constructor===ArrayBuffer},C.prototype.isTypedArray=function(P){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(P)},C.prototype.uint8ViewToBase64=function(P){for(var l="",A=this.base64CharSet,R=P.byteLength,I=R%3,y=R-I,m,T,f,c,u,a=0;a<y;a=a+3)u=P[a]<<16|P[a+1]<<8|P[a+2],m=(u&16515072)>>18,T=(u&258048)>>12,f=(u&4032)>>6,c=u&63,l+=A[m]+A[T]+A[f]+A[c];return I==1?(u=P[y],m=(u&252)>>2,T=(u&3)<<4,l+=A[m]+A[T]+"=="):I==2&&(u=P[y]<<8|P[y+1],m=(u&64512)>>10,T=(u&1008)>>4,f=(u&15)<<2,l+=A[m]+A[T]+A[f]+"="),l},C.prototype.base64ToArrayBuffer=function(P){for(var l=atob==null?void 0:atob(P),A=l.length,R=new Uint8Array(A),I=0;I<A;I++){var y=l.charCodeAt(I);R[I]=y}return R.buffer},C.prototype.isBuffer=function(P){return this.isArrayBuffer(P)||this.isWordArray(P)||this.isTypedArray(P)},C.prototype.toBuffer=function(P){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(P))return new Uint8Array(P);if(this.isTypedArray(P))return new Uint8Array(P.buffer);if(this.isWordArray(P)){for(var l=new ArrayBuffer(P.sigBytes),A=new Uint8Array(l),R=0;R<P.sigBytes;R++)A[R]=P.words[R>>>2]>>>24-R%4*8&255;return A}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},C.prototype.toArrayBuffer=function(P){return this.isArrayBuffer(P)?P:this.toBuffer(P).buffer},C.prototype.toWordArray=function(P){return this.isTypedArray(P)&&(P=P.buffer),this.isWordArray(P)?P:v.default.create(P)},C.prototype.base64Encode=function(P){return this.isWordArray(P)?(0,d.stringify)(P):this.uint8ViewToBase64(this.toBuffer(P))},C.prototype.base64Decode=function(P){return ArrayBuffer&&b.default.Config.atob?this.base64ToArrayBuffer(P):(0,d.parse)(P)},C.prototype.hexEncode=function(P){return(0,o.stringify)(this.toWordArray(P))},C.prototype.hexDecode=function(P){var l=(0,o.parse)(P);return ArrayBuffer?this.toArrayBuffer(l):l},C.prototype.utf8Encode=function(P){return b.default.Config.TextEncoder?new b.default.Config.TextEncoder().encode(P).buffer:(0,p.parse)(P)},C.prototype.utf8Decode=function(P){if(!this.isBuffer(P))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(P)?new TextDecoder().decode(P):(P=this.toWordArray(P),(0,p.stringify)(P))},C.prototype.bufferCompare=function(P,l){if(!P)return-1;if(!l)return 1;var A=this.toWordArray(P),R=this.toWordArray(l);A.clamp(),R.clamp();var I=A.sigBytes-R.sigBytes;if(I!=0)return I;for(var y=A.words,m=R.words,T=0;T<y.length;T++)if(I=y[T]-m[T],I!=0)return I;return 0},C.prototype.byteLength=function(P){return this.isArrayBuffer(P)||this.isTypedArray(P)?P.byteLength:this.isWordArray(P)?P.sigBytes:-1},C.prototype.typedArrayToBuffer=function(P){return P.buffer},C}();t.default=new w},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Hex})},function(n,t,i){i.r(t);var s=i(5),o=i.n(s),p=i(11),d=i(23),v=i.n(d),b=i(2),w=i.n(b),C=i(4),P=i.n(C),l=function(A,R){var I="aes",y=256,m="cbc",T=16,f=4,c=4294967296,u=2147483648,a;if(A.getRandomWordArray)a=A.getRandomWordArray;else if(typeof Uint32Array<"u"&&A.getRandomValues){var g=new Uint32Array(f);a=function(S,_){var U=S/4,F=U==f?g:new Uint32Array(U);A.getRandomValues(F,function(z){typeof _<"u"&&_(z,R.toWordArray(F))})}}else a=function(S,_){w.a.logAction(w.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var U=S/4,F=new Array(U),z=0;z<U;z++)F[z]=Math.floor(Math.random()*c)-u;_(null,o.a.create(F))};function h(S){return S+T&-T}function O(S){if(S.algorithm==="aes"&&S.mode==="cbc"){if(S.keyLength===128||S.keyLength===256)return;throw new Error("Unsupported key length "+S.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function N(S){return S.replace("_","/").replace("-","+")}var k=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function L(){}function M(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}L.CipherParams=M,L.getDefaultParams=function(S){var _;if(typeof S=="function"||typeof S=="string"){if(w.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof S=="function")w.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),L.generateRandomKey(function(F){S(null,L.getDefaultParams({key:F}))});else if(typeof arguments[1]=="function")w.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,L.getDefaultParams({key:S}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!S.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof S.key=="string"?_=Object(p.parse)(N(S.key)):_=R.toWordArray(S.key);var U=new M;if(U.key=_,U.algorithm=S.algorithm||I,U.keyLength=_.words.length*(4*8),U.mode=S.mode||m,S.keyLength&&S.keyLength!==U.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+S.keyLength+" was specified, but the key actually has length "+U.keyLength);return O(U),U},L.generateRandomKey=function(S,_){arguments.length==1&&typeof S=="function"&&(_=S,S=void 0),a((S||y)/8,function(U,F){_!==void 0&&_(U?P.a.fromValues(U):null,F)})},L.getCipher=function(S){var _=S instanceof M?S:L.getDefaultParams(S);return{cipherParams:_,cipher:new E(_,f,S.iv)}};function E(S,_,U){this.algorithm=S.algorithm+"-"+String(S.keyLength)+"-"+S.mode,this.cjsAlgorithm=S.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=R.toWordArray(S.key),U&&(this.iv=R.toWordArray(U).clone()),this.blockLengthWords=_}return E.prototype.encrypt=function(S,_){w.a.logAction(w.a.LOG_MICRO,"CBCCipher.encrypt()",""),S=R.toWordArray(S);var U=S.sigBytes,F=h(U),z=this,q=function(){z.getIv(function(G,x){if(G){_(G);return}var D=z.encryptCipher.process(S.concat(k[F-U])),j=x.concat(D);_(null,j)})};this.encryptCipher?q():this.iv?(this.encryptCipher=v.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),q()):a(T,function(G,x){if(G){_(G);return}z.encryptCipher=v.a.algo[z.cjsAlgorithm].createEncryptor(z.key,{iv:x}),z.iv=x,q()})},E.prototype.decrypt=function(S){w.a.logAction(w.a.LOG_MICRO,"CBCCipher.decrypt()",""),S=R.toWordArray(S);var _=this.blockLengthWords,U=S.words,F=o.a.create(U.slice(0,_)),z=o.a.create(U.slice(_)),q=v.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:F}),G=q.process(z),x=q.finalize();return q.reset(),x&&x.sigBytes&&G.concat(x),G},E.prototype.getIv=function(S){if(this.iv){var _=this.iv;this.iv=null,S(null,_);return}var U=this;a(T,function(F,z){if(F){S(F);return}S(null,U.encryptCipher.process(z))})},L};t.default=l},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,p=o.lib,d=p.WordArray,v=o.enc;v.Utf16=v.Utf16BE={stringify:function(w){for(var C=w.words,P=w.sigBytes,l=[],A=0;A<P;A+=2){var R=C[A>>>2]>>>16-A%4*8&65535;l.push(String.fromCharCode(R))}return l.join("")},parse:function(w){for(var C=w.length,P=[],l=0;l<C;l++)P[l>>>1]|=w.charCodeAt(l)<<16-l%2*16;return d.create(P,C*2)}},v.Utf16LE={stringify:function(w){for(var C=w.words,P=w.sigBytes,l=[],A=0;A<P;A+=2){var R=b(C[A>>>2]>>>16-A%4*8&65535);l.push(String.fromCharCode(R))}return l.join("")},parse:function(w){for(var C=w.length,P=[],l=0;l<C;l++)P[l>>>1]|=b(w.charCodeAt(l)<<16-l%2*16);return d.create(P,C*2)}};function b(w){return w<<8&4278255360|w>>>8&16711935}}(),s.enc.Utf16})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(28))})(this,function(s){return function(o){var p=s,d=p.lib,v=d.CipherParams,b=p.enc,w=b.Hex,C=p.format;C.Hex={stringify:function(P){return P.ciphertext.toString(w)},parse:function(P){var l=w.parse(P);return v.create({ciphertext:l})}}}(),s.format.Hex})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(11),i(61),i(27),i(28))})(this,function(s){return function(){var o=s,p=o.lib,d=p.BlockCipher,v=o.algo,b=[],w=[],C=[],P=[],l=[],A=[],R=[],I=[],y=[],m=[];(function(){for(var c=[],u=0;u<256;u++)u<128?c[u]=u<<1:c[u]=u<<1^283;for(var a=0,g=0,u=0;u<256;u++){var h=g^g<<1^g<<2^g<<3^g<<4;h=h>>>8^h&255^99,b[a]=h,w[h]=a;var O=c[a],N=c[O],k=c[N],L=c[h]*257^h*16843008;C[a]=L<<24|L>>>8,P[a]=L<<16|L>>>16,l[a]=L<<8|L>>>24,A[a]=L;var L=k*16843009^N*65537^O*257^a*16843008;R[h]=L<<24|L>>>8,I[h]=L<<16|L>>>16,y[h]=L<<8|L>>>24,m[h]=L,a?(a=O^c[c[c[k^O]]],g^=c[c[g]]):a=g=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],f=v.AES=d.extend({_doReset:function(){var c;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var u=this._keyPriorReset=this._key,a=u.words,g=u.sigBytes/4,h=this._nRounds=g+6,O=(h+1)*4,N=this._keySchedule=[],k=0;k<O;k++)k<g?N[k]=a[k]:(c=N[k-1],k%g?g>6&&k%g==4&&(c=b[c>>>24]<<24|b[c>>>16&255]<<16|b[c>>>8&255]<<8|b[c&255]):(c=c<<8|c>>>24,c=b[c>>>24]<<24|b[c>>>16&255]<<16|b[c>>>8&255]<<8|b[c&255],c^=T[k/g|0]<<24),N[k]=N[k-g]^c);for(var L=this._invKeySchedule=[],M=0;M<O;M++){var k=O-M;if(M%4)var c=N[k];else var c=N[k-4];M<4||k<=4?L[M]=c:L[M]=R[b[c>>>24]]^I[b[c>>>16&255]]^y[b[c>>>8&255]]^m[b[c&255]]}}},encryptBlock:function(c,u){this._doCryptBlock(c,u,this._keySchedule,C,P,l,A,b)},decryptBlock:function(c,u){var a=c[u+1];c[u+1]=c[u+3],c[u+3]=a,this._doCryptBlock(c,u,this._invKeySchedule,R,I,y,m,w);var a=c[u+1];c[u+1]=c[u+3],c[u+3]=a},_doCryptBlock:function(c,u,a,g,h,O,N,k){for(var L=this._nRounds,M=c[u]^a[0],E=c[u+1]^a[1],S=c[u+2]^a[2],_=c[u+3]^a[3],U=4,F=1;F<L;F++){var z=g[M>>>24]^h[E>>>16&255]^O[S>>>8&255]^N[_&255]^a[U++],q=g[E>>>24]^h[S>>>16&255]^O[_>>>8&255]^N[M&255]^a[U++],G=g[S>>>24]^h[_>>>16&255]^O[M>>>8&255]^N[E&255]^a[U++],x=g[_>>>24]^h[M>>>16&255]^O[E>>>8&255]^N[S&255]^a[U++];M=z,E=q,S=G,_=x}var z=(k[M>>>24]<<24|k[E>>>16&255]<<16|k[S>>>8&255]<<8|k[_&255])^a[U++],q=(k[E>>>24]<<24|k[S>>>16&255]<<16|k[_>>>8&255]<<8|k[M&255])^a[U++],G=(k[S>>>24]<<24|k[_>>>16&255]<<16|k[M>>>8&255]<<8|k[E&255])^a[U++],x=(k[_>>>24]<<24|k[M>>>16&255]<<16|k[E>>>8&255]<<8|k[S&255])^a[U++];c[u]=z,c[u+1]=q,c[u+2]=G,c[u+3]=x},keySize:256/32});o.AES=d._createHelper(f)}(),s.AES})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var p=s,d=p.lib,v=d.WordArray,b=d.Hasher,w=p.algo,C=[];(function(){for(var y=0;y<64;y++)C[y]=o.abs(o.sin(y+1))*4294967296|0})();var P=w.MD5=b.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,m){for(var T=0;T<16;T++){var f=m+T,c=y[f];y[f]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}var u=this._hash.words,a=y[m+0],g=y[m+1],h=y[m+2],O=y[m+3],N=y[m+4],k=y[m+5],L=y[m+6],M=y[m+7],E=y[m+8],S=y[m+9],_=y[m+10],U=y[m+11],F=y[m+12],z=y[m+13],q=y[m+14],G=y[m+15],x=u[0],D=u[1],j=u[2],B=u[3];x=l(x,D,j,B,a,7,C[0]),B=l(B,x,D,j,g,12,C[1]),j=l(j,B,x,D,h,17,C[2]),D=l(D,j,B,x,O,22,C[3]),x=l(x,D,j,B,N,7,C[4]),B=l(B,x,D,j,k,12,C[5]),j=l(j,B,x,D,L,17,C[6]),D=l(D,j,B,x,M,22,C[7]),x=l(x,D,j,B,E,7,C[8]),B=l(B,x,D,j,S,12,C[9]),j=l(j,B,x,D,_,17,C[10]),D=l(D,j,B,x,U,22,C[11]),x=l(x,D,j,B,F,7,C[12]),B=l(B,x,D,j,z,12,C[13]),j=l(j,B,x,D,q,17,C[14]),D=l(D,j,B,x,G,22,C[15]),x=A(x,D,j,B,g,5,C[16]),B=A(B,x,D,j,L,9,C[17]),j=A(j,B,x,D,U,14,C[18]),D=A(D,j,B,x,a,20,C[19]),x=A(x,D,j,B,k,5,C[20]),B=A(B,x,D,j,_,9,C[21]),j=A(j,B,x,D,G,14,C[22]),D=A(D,j,B,x,N,20,C[23]),x=A(x,D,j,B,S,5,C[24]),B=A(B,x,D,j,q,9,C[25]),j=A(j,B,x,D,O,14,C[26]),D=A(D,j,B,x,E,20,C[27]),x=A(x,D,j,B,z,5,C[28]),B=A(B,x,D,j,h,9,C[29]),j=A(j,B,x,D,M,14,C[30]),D=A(D,j,B,x,F,20,C[31]),x=R(x,D,j,B,k,4,C[32]),B=R(B,x,D,j,E,11,C[33]),j=R(j,B,x,D,U,16,C[34]),D=R(D,j,B,x,q,23,C[35]),x=R(x,D,j,B,g,4,C[36]),B=R(B,x,D,j,N,11,C[37]),j=R(j,B,x,D,M,16,C[38]),D=R(D,j,B,x,_,23,C[39]),x=R(x,D,j,B,z,4,C[40]),B=R(B,x,D,j,a,11,C[41]),j=R(j,B,x,D,O,16,C[42]),D=R(D,j,B,x,L,23,C[43]),x=R(x,D,j,B,S,4,C[44]),B=R(B,x,D,j,F,11,C[45]),j=R(j,B,x,D,G,16,C[46]),D=R(D,j,B,x,h,23,C[47]),x=I(x,D,j,B,a,6,C[48]),B=I(B,x,D,j,M,10,C[49]),j=I(j,B,x,D,q,15,C[50]),D=I(D,j,B,x,k,21,C[51]),x=I(x,D,j,B,F,6,C[52]),B=I(B,x,D,j,O,10,C[53]),j=I(j,B,x,D,_,15,C[54]),D=I(D,j,B,x,g,21,C[55]),x=I(x,D,j,B,E,6,C[56]),B=I(B,x,D,j,G,10,C[57]),j=I(j,B,x,D,L,15,C[58]),D=I(D,j,B,x,z,21,C[59]),x=I(x,D,j,B,N,6,C[60]),B=I(B,x,D,j,U,10,C[61]),j=I(j,B,x,D,h,15,C[62]),D=I(D,j,B,x,S,21,C[63]),u[0]=u[0]+x|0,u[1]=u[1]+D|0,u[2]=u[2]+j|0,u[3]=u[3]+B|0},_doFinalize:function(){var y=this._data,m=y.words,T=this._nDataBytes*8,f=y.sigBytes*8;m[f>>>5]|=128<<24-f%32;var c=o.floor(T/4294967296),u=T;m[(f+64>>>9<<4)+15]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,m[(f+64>>>9<<4)+14]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360,y.sigBytes=(m.length+1)*4,this._process();for(var a=this._hash,g=a.words,h=0;h<4;h++){var O=g[h];g[h]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360}return a},clone:function(){var y=b.clone.call(this);return y._hash=this._hash.clone(),y}});function l(y,m,T,f,c,u,a){var g=y+(m&T|~m&f)+c+a;return(g<<u|g>>>32-u)+m}function A(y,m,T,f,c,u,a){var g=y+(m&f|T&~f)+c+a;return(g<<u|g>>>32-u)+m}function R(y,m,T,f,c,u,a){var g=y+(m^T^f)+c+a;return(g<<u|g>>>32-u)+m}function I(y,m,T,f,c,u,a){var g=y+(T^(m|~f))+c+a;return(g<<u|g>>>32-u)+m}p.MD5=b._createHelper(P),p.HmacMD5=b._createHmacHelper(P)}(Math),s.MD5})},function(n,t,i){var s;Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),p=o.__importDefault(i(3)),d=o.__importStar(i(1)),v=o.__importDefault(i(8)),b=i(4),w=o.__importDefault(i(19)),C=o.__importDefault(i(17)),P=o.__importDefault(i(22)),l=o.__importDefault(i(2)),A=i(29),R=o.__importDefault(i(63)),I=i(14);function y(f){var c=f.statusCode;return c===408&&!f.code||c===400&&!f.code||c>=500&&c<=504}function m(f){var c=f.connection,u=c&&c.connectionManager.host;return u?[u].concat(v.default.getFallbackHosts(f.options)):v.default.getHosts(f.options)}var T=(s=function(){function f(c){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=m,this.options=c||{};var u=this.options.connectivityCheckUrl||v.default.connectivityCheckUrl,a=this.options.connectivityCheckParams,g=!this.options.connectivityCheckUrl;p.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(h,O,N,k,L,M,E){var S=C.default.createRequest(N,k,L,M,P.default.REQ_SEND,O&&O.options.timeouts,h);return S.once("complete",E),S.exec(),S},this.options.disableConnectivityCheck?this.checkConnectivity=function(h){h(null,!0)}:this.checkConnectivity=function(h){l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+u),this.doUri(w.default.Get,null,u,null,null,a,function(O,N,k,L,M){var E=!1;g?E=!O&&(N==null?void 0:N.replace(/\n/,""))=="yes":E=!O&&(0,I.isSuccessCode)(M),l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+E),h(null,E)})}):p.default.Config.jsonpSupported?(this.Request=function(h,O,N,k,L,M,E){var S=(0,A.createRequest)(N,k,L,M,P.default.REQ_SEND,O&&O.options.timeouts,h);return S.once("complete",E),p.default.Config.nextTick(function(){S.exec()}),S},this.options.disableConnectivityCheck?this.checkConnectivity=function(h){h(null,!0)}:this.checkConnectivity=function(h){var O=this,N=v.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(h);return}this.checksInProgress=[h],l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+N);var k=new A.Request("isTheInternetUp",N,null,null,null,P.default.REQ_SEND,v.default.TIMEOUTS);k.once("complete",function(L,M){var E=!L&&M;l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+E);for(var S=0;S<O.checksInProgress.length;S++)O.checksInProgress[S](null,E);O.checksInProgress=null}),p.default.Config.nextTick(function(){k.exec()})}):p.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=R.default,this.checkConnectivity=function(h){l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+u),this.doUri(w.default.Get,null,u,null,null,null,function(O,N){var k=!O&&(N==null?void 0:N.replace(/\n/,""))=="yes";l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+k),h(null,k)})}):this.Request=function(h,O,N,k,L,M,E){E(new b.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return f.prototype.do=function(c,u,a,g,h,O,N){var k=this,L=typeof a=="function"?a:function(_){return u.baseUri(_)+a},M=u._currentFallback;if(M)if(M.validUntil>d.now()){if(!this.Request){N==null||N(new b.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,u,L(M.host),g,O,h,function(_){for(var U=[],F=1;F<arguments.length;F++)U[F-1]=arguments[F];if(_&&y(_)){u._currentFallback=null,k.do(c,u,a,g,h,O,N);return}N==null||N.apply(void 0,o.__spreadArray([_],U,!1))});return}else u._currentFallback=null;var E=m(u);if(E.length===1){this.doUri(c,u,L(E[0]),g,h,O,N);return}var S=function(_,U){var F=_.shift();k.doUri(c,u,L(F),g,h,O,function(z){for(var q=[],G=1;G<arguments.length;G++)q[G-1]=arguments[G];if(z&&y(z)&&_.length){S(_,!0);return}U&&(u._currentFallback={host:F,validUntil:d.now()+u.options.timeouts.fallbackRetryTimeout}),N==null||N.apply(void 0,o.__spreadArray([z],q,!1))})};S(E)},f.prototype.doUri=function(c,u,a,g,h,O,N){if(!this.Request){N(new b.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,u,a,g,O,h,N)},f}(),s.methods=[w.default.Get,w.default.Delete,w.default.Post,w.default.Put,w.default.Patch],s.methodsWithoutBody=[w.default.Get,w.default.Delete],s.methodsWithBody=[w.default.Post,w.default.Put,w.default.Patch],s);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(4)),p=s.__importDefault(i(3)),d=s.__importDefault(i(8)),v=s.__importStar(i(1)),b=i(1);function w(l,A){return!!A.get("x-ably-errorcode")}function C(l,A){if(w(l,A))return l.error&&o.default.fromValues(l.error)}function P(l,A,R,I,y,m,T){var f=new Headers(I||{}),c=l?l.toUpperCase():v.isEmptyArg(m)?"GET":"POST",u=new AbortController,a=setTimeout(function(){u.abort(),T(new o.PartialErrorInfo("Request timed out",null,408))},A?A.options.timeouts.httpRequestTimeout:d.default.TIMEOUTS.httpRequestTimeout),g={method:c,headers:f,body:m};p.default.Config.isWebworker||(g.credentials=f.has("authorization")?"include":"same-origin"),(0,b.getGlobalObject)().fetch(R+"?"+new URLSearchParams(y||{}),g).then(function(h){clearTimeout(a);var O=h.headers.get("Content-Type"),N;O&&O.indexOf("application/x-msgpack")>-1?N=h.arrayBuffer():O&&O.indexOf("application/json")>-1?N=h.json():N=h.text(),N.then(function(k){var L=!!O&&O.indexOf("application/x-msgpack")===-1;if(h.ok)T(null,k,h.headers,L,h.status);else{var M=C(k,h.headers)||new o.PartialErrorInfo("Error response received from server: "+h.status+" body was: "+p.default.Config.inspect(k),null,h.status);T(M,k,h.headers,L,h.status)}})}).catch(function(h){clearTimeout(a),T(h)})}t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(41)),p=s.__importStar(i(1)),d=p.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function v(){var P=d.location;return!d.WebSocket||!P||!P.origin||P.origin.indexOf("http")>-1}var b=d.navigator&&d.navigator.userAgent.toString(),w=d.location&&d.location.href,C={agent:"browser",logTimestamps:!0,userAgent:b,currentUrl:w,noUpgrade:b&&!!b.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:d.WebSocket,fetchSupported:!!d.fetch,xhrSupported:d.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:v(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!d.TextDecoder,preferBinary:!1,ArrayBuffer:d.ArrayBuffer,atob:d.atob,nextTick:typeof d.setImmediate<"u"?d.setImmediate.bind(d):function(P){setTimeout(P,0)},addEventListener:d.addEventListener,inspect:JSON.stringify,stringByteSize:function(P){return d.TextDecoder&&new d.TextEncoder().encode(P).length||P.length},TextEncoder:d.TextEncoder,TextDecoder:d.TextDecoder,Promise:d.Promise,getRandomValues:function(P){if(P!==void 0)return function(l,A){P.getRandomValues(l),A&&A(null)}}(d.crypto||msCrypto)};t.default=C},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),p=o.__importStar(i(1)),d="ablyjs-storage-test",v=function(){function b(){try{s.sessionStorage.setItem(d,d),s.sessionStorage.removeItem(d),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{s.localStorage.setItem(d,d),s.localStorage.removeItem(d),this.localSupported=!0}catch{this.localSupported=!1}}return b.prototype.get=function(w){return this._get(w,!1)},b.prototype.getSession=function(w){return this._get(w,!0)},b.prototype.remove=function(w){return this._remove(w,!1)},b.prototype.removeSession=function(w){return this._remove(w,!0)},b.prototype.set=function(w,C,P){return this._set(w,C,P,!1)},b.prototype.setSession=function(w,C,P){return this._set(w,C,P,!0)},b.prototype._set=function(w,C,P,l){var A={value:C};return P&&(A.expires=p.now()+P),this.storageInterface(l).setItem(w,JSON.stringify(A))},b.prototype._get=function(w,C){if(C&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!C&&!this.localSupported)throw new Error("Local Storage not supported");var P=this.storageInterface(C).getItem(w);if(!P)return null;var l=JSON.parse(P);return l.expires&&l.expires<p.now()?(this.storageInterface(C).removeItem(w),null):l.value},b.prototype._remove=function(w,C){return this.storageInterface(C).removeItem(w)},b.prototype.storageInterface=function(w){return w?s.sessionStorage:s.localStorage},b}();t.default=new v}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(67)),p={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};t.default=p},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(s||(s={})),t.default=s},function(n,t,i){i.r(t);var s=i(29),o=i.n(s),p=i(1),d=i(3),v=i.n(d),b=i(12),w=i.n(b),C=i(17),P=i.n(C),l=function(y){var m="xhr_polling";function T(f,c,u){u.stream=!1,w.a.call(this,f,c,u),this.shortName=m}return p.inherits(T,w.a),T.isAvailable=function(){return v.a.Config.xhrSupported&&v.a.Config.allowComet},T.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(f,c,u,a,g){return P.a.createRequest(f,c,u,a,g,this.timeouts)},typeof y<"u"&&T.isAvailable()&&(y.supportedTransports[m]=T),T},A=l,R=function(y){var m="xhr_streaming";function T(f,c,u){w.a.call(this,f,c,u),this.shortName=m}return p.inherits(T,w.a),T.isAvailable=function(){return v.a.Config.xhrSupported&&v.a.Config.streamingSupported&&v.a.Config.allowComet},T.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(f,c,u,a,g){return P.a.createRequest(f,c,u,a,g,this.timeouts)},typeof y<"u"&&T.isAvailable()&&(y.supportedTransports[m]=T),T},I=R;t.default=[o.a,A,I]}]).default})})(br);var Or=br.exports;const Uo=jo(Or),Bo=Lr({__proto__:null,default:Uo},[Or]);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var we=function(){return we=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},we.apply(this,arguments)},Fo=function(){function r(e){this.options=e,this.listeners={}}return r.prototype.on=function(e,n){var t=this.listeners[e]||[];this.listeners[e]=t.concat([n])},r.prototype.triggerEvent=function(e,n){var t=this,i=this.listeners[e]||[];i.forEach(function(s){return s({target:t,event:n})})},r}(),Ge;(function(r){r[r.Add=0]="Add",r[r.Remove=1]="Remove"})(Ge||(Ge={}));var Ho=function(){function r(){this.notifications=[]}return r.prototype.push=function(e){this.notifications.push(e),this.updateFn(e,Ge.Add,this.notifications)},r.prototype.splice=function(e,n){var t=this.notifications.splice(e,n)[0];return this.updateFn(t,Ge.Remove,this.notifications),t},r.prototype.indexOf=function(e){return this.notifications.indexOf(e)},r.prototype.onUpdate=function(e){this.updateFn=e},r}(),ke;(function(r){r.Dismiss="dismiss",r.Click="click"})(ke||(ke={}));var An={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},Go=function(){function r(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var e=document.createDocumentFragment(),n=this._createHTMLElement({tagName:"div",className:"notyf"});e.appendChild(n),document.body.appendChild(e),this.container=n,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return r.prototype.on=function(e,n){var t;this.events=we(we({},this.events),(t={},t[e]=n,t))},r.prototype.update=function(e,n){n===Ge.Add?this.addNotification(e):n===Ge.Remove&&this.removeNotification(e)},r.prototype.removeNotification=function(e){var n=this,t=this._popRenderedNotification(e),i;if(t){i=t.node,i.classList.add("notyf__toast--disappear");var s;i.addEventListener(this.animationEndEventName,s=function(o){o.target===i&&(i.removeEventListener(n.animationEndEventName,s),n.container.removeChild(i))})}},r.prototype.addNotification=function(e){var n=this._renderNotification(e);this.notifications.push({notification:e,node:n}),this._announce(e.options.message||"Notification")},r.prototype._renderNotification=function(e){var n,t=this._buildNotificationCard(e),i=e.options.className;return i&&(n=t.classList).add.apply(n,i.split(" ")),this.container.appendChild(t),t},r.prototype._popRenderedNotification=function(e){for(var n=-1,t=0;t<this.notifications.length&&n<0;t++)this.notifications[t].notification===e&&(n=t);if(n!==-1)return this.notifications.splice(n,1)[0]},r.prototype.getXPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.x)||"right"},r.prototype.getYPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.y)||"bottom"},r.prototype.adjustContainerAlignment=function(e){var n=this.X_POSITION_FLEX_MAP[this.getXPosition(e)],t=this.Y_POSITION_FLEX_MAP[this.getYPosition(e)],i=this.container.style;i.setProperty("justify-content",t),i.setProperty("align-items",n)},r.prototype._buildNotificationCard=function(e){var n=this,t=e.options,i=t.icon;this.adjustContainerAlignment(t);var s=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),p=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),d=this._createHTMLElement({tagName:"div",className:"notyf__message"});d.innerHTML=t.message||"";var v=t.background||t.backgroundColor;if(i){var b=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof i=="string"||i instanceof String)&&(b.innerHTML=new String(i).valueOf()),typeof i=="object"){var w=i.tagName,C=w===void 0?"i":w,P=i.className,l=i.text,A=i.color,R=A===void 0?v:A,I=this._createHTMLElement({tagName:C,className:P,text:l});R&&(I.style.color=R),b.appendChild(I)}p.appendChild(b)}if(p.appendChild(d),s.appendChild(p),v&&(t.ripple?(o.style.background=v,s.appendChild(o)):s.style.background=v),t.dismissible){var y=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),m=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});y.appendChild(m),p.appendChild(y),s.classList.add("notyf__toast--dismissible"),m.addEventListener("click",function(f){var c,u;(u=(c=n.events)[ke.Dismiss])===null||u===void 0||u.call(c,{target:e,event:f}),f.stopPropagation()})}s.addEventListener("click",function(f){var c,u;return(u=(c=n.events)[ke.Click])===null||u===void 0?void 0:u.call(c,{target:e,event:f})});var T=this.getYPosition(t)==="top"?"upper":"lower";return s.classList.add("notyf__toast--"+T),s},r.prototype._createHTMLElement=function(e){var n=e.tagName,t=e.className,i=e.text,s=document.createElement(n);return t&&(s.className=t),s.textContent=i||null,s},r.prototype._createA11yContainer=function(){var e=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),e.style.border="0",e.style.clip="rect(0 0 0 0)",e.style.height="1px",e.style.margin="-1px",e.style.overflow="hidden",e.style.padding="0",e.style.position="absolute",e.style.width="1px",e.style.outline="0",document.body.appendChild(e),this.a11yContainer=e},r.prototype._announce=function(e){var n=this;this.a11yContainer.textContent="",setTimeout(function(){n.a11yContainer.textContent=e},100)},r.prototype._getAnimationEndEventName=function(){var e=document.createElement("_fake"),n={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},t;for(t in n)if(e.style[t]!==void 0)return n[t];return"animationend"},r}(),Vo=function(){function r(e){var n=this;this.dismiss=this._removeNotification,this.notifications=new Ho,this.view=new Go;var t=this.registerTypes(e);this.options=we(we({},An),e),this.options.types=t,this.notifications.onUpdate(function(i,s){return n.view.update(i,s)}),this.view.on(ke.Dismiss,function(i){var s=i.target,o=i.event;n._removeNotification(s),s.triggerEvent(ke.Dismiss,o)}),this.view.on(ke.Click,function(i){var s=i.target,o=i.event;return s.triggerEvent(ke.Click,o)})}return r.prototype.error=function(e){var n=this.normalizeOptions("error",e);return this.open(n)},r.prototype.success=function(e){var n=this.normalizeOptions("success",e);return this.open(n)},r.prototype.open=function(e){var n=this.options.types.find(function(s){var o=s.type;return o===e.type})||{},t=we(we({},n),e);this.assignProps(["ripple","position","dismissible"],t);var i=new Fo(t);return this._pushNotification(i),i},r.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},r.prototype.assignProps=function(e,n){var t=this;e.forEach(function(i){n[i]=n[i]==null?t.options[i]:n[i]})},r.prototype._pushNotification=function(e){var n=this;this.notifications.push(e);var t=e.options.duration!==void 0?e.options.duration:this.options.duration;t&&setTimeout(function(){return n._removeNotification(e)},t)},r.prototype._removeNotification=function(e){var n=this.notifications.indexOf(e);n!==-1&&this.notifications.splice(n,1)},r.prototype.normalizeOptions=function(e,n){var t={type:e};return typeof n=="string"?t.message=n:typeof n=="object"&&(t=we(we({},t),n)),t},r.prototype.registerTypes=function(e){var n=(e&&e.types||[]).slice(),t=An.types.map(function(i){var s=-1;n.forEach(function(p,d){p.type===i.type&&(s=d)});var o=s!==-1?n.splice(s,1)[0]:{};return we(we({},i),o)});return t.concat(n)},r}();window.Notyf=Vo;window.Ably=Bo;window.Echo=new _o({broadcaster:"ably",tls:!0,disableStats:!0,authEndpoint:"/broadcasting/auth",auth:{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}});window.Echo.connector.ably.connection.on(r=>{r.current==="connected"&&console.log("connected to ably server")});window.Echo.connector.ably.connection.on("stateChange",r=>{r.current==="connected"?console.log("Connected to Ably server"):r.current==="failed"&&console.error("Failed to connect to Ably server:",r.reason)});window.axios=ue;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";let wn=document.head.querySelector('meta[name="csrf-token"]');wn?window.axios.defaults.headers.common["X-CSRF-TOKEN"]=wn.content:console.error("CSRF token not found!");var zo=Object.defineProperty,Wo=(r,e,n)=>e in r?zo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,Fe=(r,e,n)=>Wo(r,typeof e!="symbol"?e+"":e,n);document.addEventListener("alpine:init",()=>{window.Alpine.store("editOnClickValidation",{pending:[],set(r,e){this.pending=this.pending.filter(n=>n.value!==r),this.pending.push({value:r,textContent:e})},has(r){return this.pending.some(e=>e.value===r)},get(r){return this.pending.find(e=>e.value===r)},notContains(r){return this.pending.length>0&&!this.has(r)},clear(){this.pending=[]},getTextContent(r){const e=this.pending.find(n=>n.value===r);return e?e.textContent:null}}),window.editOnClickValidation=window.Alpine.store("editOnClickValidation")});document.addEventListener("alpine:init",()=>{window.Alpine.store("pgBulkActions",{selected:[],init(){window.addEventListener("pgBulkActions::addMore",r=>{const e=r.__livewire.params[0];typeof this.selected[e.tableName]>"u"&&(this.selected[e.tableName]=[]),this.selected[e.tableName].push(e.value)}),window.addEventListener("pgBulkActions::clear",r=>{this.clear(r.detail)}),window.addEventListener("pgBulkActions::clearAll",()=>{this.clearAll()})},add(r,e){if(typeof this.selected[e]>"u"&&(this.selected[e]=[]),!this.selected[e].includes(r)){this.selected[e].push(r);return}this.remove(r,e)},remove(r,e){const n=this.selected[e].indexOf(r);n>-1&&this.selected[e].splice(n,1)},get(r){return this.selected[r]??""},count(r){return typeof this.selected[r]>"u"?0:this.selected[r].length},clear(r){this.selected[r]=[]},clearAll(){this.selected=[]}}),window.pgBulkActions=window.Alpine.store("pgBulkActions")});const qo=r=>({field:r.field??null,tableName:r.tableName??null,enabled:r.enabled??!1,id:r.id,trueValue:r.trueValue,falseValue:r.falseValue,toggle:r.toggle,save(){this.toggle=this.toggle===0?1:0,this.$wire.dispatch("pg:toggleable-"+this.tableName,{id:this.id,field:this.field,value:this.toggle})}}),$o=(r,e,n)=>{const t=r[e];return t?typeof t=="function"?t():Promise.resolve(t):new Promise((i,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})},Ko=r=>({dataField:r.dataField,tableName:r.tableName,label:r.label??null,locale:r.locale??{locale:"default",dateFormat:"Y-m-d H:i",time_24hr:!1,enableTime:!0},onlyFuture:r.onlyFuture??!1,noWeekEnds:r.noWeekEnds??!1,customConfig:r.customConfig??null,type:r.type,element:null,selectedDates:null,async init(){typeof flatpickr>"u"&&(console.log("%c%s","color: #f59e0c; font-size: 1.2em; font-weight: bold; line-height: 1.5"," PowerGrid"),console.error("%c%s","font-size: 1em; line-height: 1.5",`
Failed to mount filter: Filter::datetime('${this.dataField}') on table ['${this.tableName}']

 Install flatpickr: npm install flatpickr

 Add 'import flatpickr from "flatpickr"' in resources/js/app.js file
  `)),window.addEventListener(`pg:clear_flatpickr::${this.tableName}:${this.dataField}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()}),window.addEventListener(`pg:clear_all_flatpickr::${this.tableName}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()});try{const n=await $o(Object.assign({}),`./flatpickr/dist/l10n/${this.locale.locale}.js`,5);flatpickr.localize(n.default||n)}catch{}const e=this.getOptions();this.$refs.rangeInput&&typeof flatpickr<"u"&&(this.element=flatpickr(this.$refs.rangeInput,e),this.selectedDates=this.$wire.get(`filters.${this.type}.${this.dataField}.formatted`),this.element.setDate(this.selectedDates))},getOptions(){const e={mode:"range",defaultHour:0,...this.locale,...this.customConfig};return this.onlyFuture&&(e.minDate="today"),this.noWeekEnds&&(e.disable=[function(n){return n.getDay()===0||n.getDay()===6}]),e.onClose=(n,t,i)=>{n=n.map(s=>this.element.formatDate(s,"Y-m-d")),n.length>0&&this.selectedDates!==t&&Livewire.dispatch("pg:datePicker-"+this.tableName,{selectedDates:n,dateStr:t,timezone:this.customConfig.timezone??new Date().toString().match(/([-\+][0-9]+)\s/)[1],type:this.type,field:this.dataField,label:this.label})},e}}),Jo=r=>({theme:r.theme,id:r.id??null,dataField:r.dataField??null,content:r.content,fallback:r.fallback,inputClass:r.inputClass,saveOnMouseOut:r.saveOnMouseOut,oldContent:null,editable:!1,hash:null,hashError:!0,showEditable:!1,editableInput:"",init(){this.content.length===0&&this.fallback&&(this.content=this.htmlSpecialChars(this.fallback)),this.hash=this.dataField+"-"+this.id,window.addEventListener("toggle-"+this.hash,()=>{this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.click(),this.observe(()=>document.getElementById("editable-"+this.hash),n=>{setTimeout(()=>this.setFocusToEnd(n),100)})})}),this.$watch("editable",e=>{if(e){let n=!1;if(this.showEditable=!1,this.content=this.htmlSpecialChars(this.content),this.oldContent=this.content,this.hashError=this.store().notContains(this.hash),this.observe(()=>document.getElementById("editable-"+this.hash),t=>{setTimeout(()=>{this.setFocusToEnd(t),this.store().getTextContent(this.hash)&&(t.textContent=this.store().getTextContent(this.hash))},30)}),this.hashError){const t=this.store().get(this.hash),i=document.getElementById("clickable-"+t);i&&i.click()}n=!0,this.editableInput=`
                <div
                    x-ref="editable"
                    x-text="content"
                    value="${this.content}"
                    placeholder="${this.content}"
                    contenteditable
                    class="pg-single-line ${this.inputClass}"
                    ${this.saveOnMouseOut?'x-on:mousedown.outside="save()"':""}
                    x-on:keydown.enter="save()"
                    id="${"editable-"+this.dataField+"-"+this.id}"
                    x-on:keydown.esc="cancel"
                >
                </div>`,this.$nextTick(()=>setTimeout(()=>{this.showEditable=n,this.focus()},150))}}),this.content=this.htmlSpecialChars(this.content)},store(){return window.editOnClickValidation},save(){this.store().clear(),this.store().set(this.hash,this.$el.textContent),this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.textContent=this.$el.textContent}),window.addEventListener("pg:editable-close-"+this.id,()=>{this.store().clear(),this.editable=!1,this.showEditable=!1}),this.store().has(this.hash)||this.store().set(this.hash,this.$el.textContent),this.$wire.dispatch("pg:editable-"+this.$wire.tableName,{id:this.id,value:this.$el.textContent,field:this.dataField}),this.oldContent=this.store().getTextContent(this.hash),this.$nextTick(()=>{this.focus(),this.$el.setAttribute("value","")}),this.content=this.htmlSpecialChars(this.$el.textContent)},focus(){this.setFocusToEnd(this.$el)},cancel(){this.store().clear(),this.$refs.editable.textContent=this.oldContent,this.content=this.oldContent,this.editable=!1,this.showEditable=!1,this.$refs.error&&(this.$refs.error.innerHTML="")},htmlSpecialChars(e){const n=document.createElement("div");return n.innerHTML=e,n.textContent},observe(e,n){new MutationObserver((t,i)=>{for(let s of t)if(s.type==="childList"){const o=e();if(o){n(o),i.disconnect();break}}}).observe(document.body,{childList:!0,subtree:!0})},setFocusToEnd(e){if(!e)return;const n=window.getSelection(),t=document.createRange();t.selectNodeContents(e),t.collapse(!1),n.removeAllRanges(),n.addRange(t),e.focus()}});function Qo(r){r.querySelectorAll("tbody tr td").forEach(e=>{e.classList.remove("hidden")}),r.querySelectorAll("thead tr th").forEach(e=>{e.classList.remove("hidden")})}function Xo(r){let e=0;const n=r.querySelectorAll("table thead tr:nth-child(1) th[fixed]"),t=Qt(r);return n.forEach(i=>{e+=Qt(i)}),t-e}function Yo(r,e){const n=[].slice.call(r.querySelectorAll("table thead tr:nth-child(1) th")),t=[].slice.call(n).sort(function(p,d){const v=p.getAttribute("sort_order")??999,b=d.getAttribute("sort_order")??999;return v-b});let i=0,s=!0;const o=[];return t.forEach(p=>{const d=Qt(p);p.getAttribute("fixed")===null&&(s&&i<=e&&i+d<=e?i+=d:(o.push(n.indexOf(p)+1),s=!1))}),o}function Zo(r,e){for(const n of e)r.querySelectorAll(`tbody:not(tbody[expand]) tr td:nth-child(${n})`).forEach(t=>{t.classList.add("hidden")}),r.querySelectorAll(`thead tr th:nth-child(${n})`).forEach(t=>{t.classList.add("hidden")})}function es(r,e){var n,t;if(r.querySelectorAll("table tbody[expand] tr td div").length){for(const i of r.querySelectorAll("table tbody[expand] tr td div"))i.innerHTML="";if(e.length)for(const i of e){const s=r.querySelectorAll("table tbody:not(tbody[expand])");for(const o of s){const p=(n=o.nextElementSibling)==null?void 0:n.querySelector("tr td div");if(!p)continue;let d=r.querySelector(`table thead tr th:nth-child(${i}) span[data-value]`).textContent;const v=(t=o.querySelector(`tr:last-child td:nth-child(${i})`))==null?void 0:t.innerHTML;d.length&&(d+=":"),p.querySelector(`div[data-expand-item-${i}]`)||(p.innerHTML+=`<div class="responsive-row-expand-item-container" data-expand-item-${i}>
                    <span class="font-bold responsive-row-expand-item-name">${d}</span>
                    <span class="responsive-row-expand-item-value">${v}</span>
                </div>`)}}}}function Qt(r){return parseFloat(r.getBoundingClientRect().width.toFixed(2))}function ts(r){Qo(r);const e=Xo(r),n=Yo(r,e);es(r,n),Zo(r,n)}const ns=()=>({running:!1,expanded:null,element:null,hasHiddenElements:!1,size:0,toggleExpanded(r){this.expanded=this.expanded==r?null:r},init(){this.$nextTick(()=>{this.handleResize(),this.observeElement(),window.addEventListener("pg-livewire-request-finished",()=>{setTimeout(()=>this.handleResize(),5)})})},handleResize(){var r;const e=this.$el;ts(e),this.hasHiddenElements=(r=e.querySelector("table tbody[expand] tr td div"))==null?void 0:r.innerHTML,this.hasHiddenElements||(this.expanded=null)},observeElement(){new ResizeObserver(r=>{r.forEach(e=>{if(e.contentRect.width>0){if(this.size===this.$el.getBoundingClientRect().width)return;this.size=this.$el.getBoundingClientRect().width,this.handleResize()}})}).observe(this.$el)}}),rs=(r,e,n)=>{Livewire.dispatch(`${r}-${e.tableName}`,{label:e.label,field:e.dataField,values:n})},Cr=(r,e)=>{rs("pg:multiSelect",r,e)};function Dt(r,e){r.split(/\s+/).forEach(n=>{e(n)})}class is{constructor(){this._events={}}on(e,n){Dt(e,t=>{const i=this._events[t]||[];i.push(n),this._events[t]=i})}off(e,n){var t=arguments.length;if(t===0){this._events={};return}Dt(e,i=>{if(t===1){delete this._events[i];return}const s=this._events[i];s!==void 0&&(s.splice(s.indexOf(n),1),this._events[i]=s)})}trigger(e,...n){var t=this;Dt(e,i=>{const s=t._events[i];s!==void 0&&s.forEach(o=>{o.apply(t,n)})})}}function os(r){return r.plugins={},class extends r{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,n){r.plugins[e]={name:e,fn:n}}initializePlugins(e){var n,t;const i=this,s=[];if(Array.isArray(e))e.forEach(o=>{typeof o=="string"?s.push(o):(i.plugins.settings[o.name]=o.options,s.push(o.name))});else if(e)for(n in e)e.hasOwnProperty(n)&&(i.plugins.settings[n]=e[n],s.push(n));for(;t=s.shift();)i.require(t)}loadPlugin(e){var n=this,t=n.plugins,i=r.plugins[e];if(!r.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(n,[n.plugins.settings[e]||{}]),t.names.push(e)}require(e){var n=this,t=n.plugins;if(!n.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');n.loadPlugin(e)}return t.loaded[e]}}}const Tt=r=>(r=r.filter(Boolean),r.length<2?r[0]||"":as(r)==1?"["+r.join("")+"]":"(?:"+r.join("|")+")"),Ar=r=>{if(!ss(r))return r.join("");let e="",n=0;const t=()=>{n>1&&(e+="{"+n+"}")};return r.forEach((i,s)=>{if(i===r[s-1]){n++;return}t(),e+=i,n=1}),t(),e},wr=r=>{let e=Array.from(r);return Tt(e)},ss=r=>new Set(r).size!==r.length,Je=r=>(r+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),as=r=>r.reduce((e,n)=>Math.max(e,ls(n)),0),ls=r=>Array.from(r).length,Sr=r=>{if(r.length===1)return[[r]];let e=[];const n=r.substring(1);return Sr(n).forEach(function(t){let i=t.slice(0);i[0]=r.charAt(0)+i[0],e.push(i),i=t.slice(0),i.unshift(r.charAt(0)),e.push(i)}),e},us=[[0,65535]],cs="[-]";let ht,Er;const fs=3,rn={},Sn={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let r in Sn){let e=Sn[r]||"";for(let n=0;n<e.length;n++){let t=e.substring(n,n+1);rn[t]=r}}const ds=new RegExp(Object.keys(rn).join("|")+"|"+cs,"gu"),hs=r=>{ht===void 0&&(ht=ms(us))},En=(r,e="NFKD")=>r.normalize(e),pt=r=>Array.from(r).reduce((e,n)=>e+ps(n),""),ps=r=>(r=En(r).toLowerCase().replace(ds,e=>rn[e]||""),En(r,"NFC"));function*gs(r){for(const[e,n]of r)for(let t=e;t<=n;t++){let i=String.fromCharCode(t),s=pt(i);s!=i.toLowerCase()&&(s.length>fs||s.length!=0&&(yield{folded:s,composed:i,code_point:t}))}}const vs=r=>{const e={},n=(t,i)=>{const s=e[t]||new Set,o=new RegExp("^"+wr(s)+"$","iu");i.match(o)||(s.add(Je(i)),e[t]=s)};for(let t of gs(r))n(t.folded,t.folded),n(t.folded,t.composed);return e},ms=r=>{const e=vs(r),n={};let t=[];for(let s in e){let o=e[s];o&&(n[s]=wr(o)),s.length>1&&t.push(Je(s))}t.sort((s,o)=>o.length-s.length);const i=Tt(t);return Er=new RegExp("^"+i,"u"),n},ys=(r,e=1)=>{let n=0;return r=r.map(t=>(ht[t]&&(n+=t.length),ht[t]||t)),n>=e?Ar(r):""},bs=(r,e=1)=>(e=Math.max(e,r.length-1),Tt(Sr(r).map(n=>ys(n,e)))),Rn=(r,e=!0)=>{let n=r.length>1?1:0;return Tt(r.map(t=>{let i=[];const s=e?t.length():t.length()-1;for(let o=0;o<s;o++)i.push(bs(t.substrs[o]||"",n));return Ar(i)}))},Os=(r,e)=>{for(const n of e){if(n.start!=r.start||n.end!=r.end||n.substrs.join("")!==r.substrs.join(""))continue;let t=r.parts;const i=s=>{for(const o of t){if(o.start===s.start&&o.substr===s.substr)return!1;if(!(s.length==1||o.length==1)&&(s.start<o.start&&s.end>o.start||o.start<s.start&&o.end>s.start))return!0}return!1};if(!(n.parts.filter(i).length>0))return!0}return!1};class gt{constructor(){Fe(this,"parts"),Fe(this,"substrs"),Fe(this,"start"),Fe(this,"end"),this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,n){let t=new gt,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const d of i)t.add(d);let o=n.substr.substring(0,e-s.start),p=o.length;return t.add({start:s.start,end:s.start+p,length:p,substr:o}),t}}const Cs=r=>{hs(),r=pt(r);let e="",n=[new gt];for(let t=0;t<r.length;t++){let i=r.substring(t).match(Er);const s=r.substring(t,t+1),o=i?i[0]:null;let p=[],d=new Set;for(const v of n){const b=v.last();if(!b||b.length==1||b.end<=t)if(o){const w=o.length;v.add({start:t,end:t+w,length:w,substr:o}),d.add("1")}else v.add({start:t,end:t+1,length:1,substr:s}),d.add("2");else if(o){let w=v.clone(t,b);const C=o.length;w.add({start:t,end:t+C,length:C,substr:o}),p.push(w)}else d.add("3")}if(p.length>0){p=p.sort((v,b)=>v.length()-b.length());for(let v of p)Os(v,n)||n.push(v);continue}if(t>0&&d.size==1&&!d.has("3")){e+=Rn(n,!1);let v=new gt;const b=n[0];b&&v.add(b.last()),n=[v]}}return e+=Rn(n,!0),e},As=(r,e)=>{if(r)return r[e]},ws=(r,e)=>{if(r){for(var n,t=e.split(".");(n=t.shift())&&(r=r[n]););return r}},_t=(r,e,n)=>{var t,i;return!r||(r=r+"",e.regex==null)||(i=r.search(e.regex),i===-1)?0:(t=e.string.length/r.length,i===0&&(t+=.5),t*n)},jt=(r,e)=>{var n=r[e];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(r[e]=[n])},et=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Ss=(r,e)=>typeof r=="number"&&typeof e=="number"?r>e?1:r<e?-1:0:(r=pt(r+"").toLowerCase(),e=pt(e+"").toLowerCase(),r>e?1:e>r?-1:0);class Es{constructor(e,n){Fe(this,"items"),Fe(this,"settings"),this.items=e,this.settings=n||{diacritics:!0}}tokenize(e,n,t){if(!e||!e.length)return[];const i=[],s=e.split(/\s+/);var o;return t&&(o=new RegExp("^("+Object.keys(t).map(Je).join("|")+"):(.*)$")),s.forEach(p=>{let d,v=null,b=null;o&&(d=p.match(o))&&(v=d[1],p=d[2]),p.length>0&&(this.settings.diacritics?b=Cs(p)||null:b=Je(p),b&&n&&(b="\\b"+b)),i.push({string:p,regex:b?new RegExp(b,"iu"):null,field:v})}),i}getScoreFunction(e,n){var t=this.prepareSearch(e,n);return this._getScoreFunction(t)}_getScoreFunction(e){const n=e.tokens,t=n.length;if(!t)return function(){return 0};const i=e.options.fields,s=e.weights,o=i.length,p=e.getAttrFn;if(!o)return function(){return 1};const d=function(){return o===1?function(v,b){const w=i[0].field;return _t(p(b,w),v,s[w]||1)}:function(v,b){var w=0;if(v.field){const C=p(b,v.field);!v.regex&&C?w+=1/o:w+=_t(C,v,1)}else et(s,(C,P)=>{w+=_t(p(b,P),v,C)});return w/o}}();return t===1?function(v){return d(n[0],v)}:e.options.conjunction==="and"?function(v){var b,w=0;for(let C of n){if(b=d(C,v),b<=0)return 0;w+=b}return w/t}:function(v){var b=0;return et(n,w=>{b+=d(w,v)}),b/t}}getSortFunction(e,n){var t=this.prepareSearch(e,n);return this._getSortFunction(t)}_getSortFunction(e){var n,t=[];const i=this,s=e.options,o=!e.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof o=="function")return o.bind(this);const p=function(d,v){return d==="$score"?v.score:e.getAttrFn(i.items[v.id],d)};if(o)for(let d of o)(e.query||d.field!=="$score")&&t.push(d);if(e.query){n=!0;for(let d of t)if(d.field==="$score"){n=!1;break}n&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(d=>d.field!=="$score");return t.length?function(d,v){var b,w;for(let C of t)if(w=C.field,b=(C.direction==="desc"?-1:1)*Ss(p(w,d),p(w,v)),b)return b;return 0}:null}prepareSearch(e,n){const t={};var i=Object.assign({},n);if(jt(i,"sort"),jt(i,"sort_empty"),i.fields){jt(i,"fields");const s=[];i.fields.forEach(o=>{typeof o=="string"&&(o={field:o,weight:1}),s.push(o),t[o.field]="weight"in o?o.weight:1}),i.fields=s}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,t),total:0,items:[],weights:t,getAttrFn:i.nesting?ws:As}}search(e,n){var t=this,i,s;s=this.prepareSearch(e,n),n=s.options,e=s.query;const o=n.score||t._getScoreFunction(s);e.length?et(t.items,(d,v)=>{i=o(d),(n.filter===!1||i>0)&&s.items.push({score:i,id:v})}):et(t.items,(d,v)=>{s.items.push({score:1,id:v})});const p=t._getSortFunction(s);return p&&s.items.sort(p),s.total=s.items.length,typeof n.limit=="number"&&(s.items=s.items.slice(0,n.limit)),s}}const Re=r=>typeof r>"u"||r===null?null:at(r),at=r=>typeof r=="boolean"?r?"1":"0":r+"",Ut=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Rs=(r,e)=>e>0?window.setTimeout(r,e):(r.call(null),null),Ts=(r,e)=>{var n;return function(t,i){var s=this;n&&(s.loading=Math.max(s.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,s.loadedSearches[t]=!0,r.call(s,t,i)},e)}},Tn=(r,e,n)=>{var t,i=r.trigger,s={};r.trigger=function(){var o=arguments[0];if(e.indexOf(o)!==-1)s[o]=arguments;else return i.apply(r,arguments)},n.apply(r,[]),r.trigger=i;for(t of e)t in s&&i.apply(r,s[t])},Is=r=>({start:r.selectionStart||0,length:(r.selectionEnd||0)-(r.selectionStart||0)}),le=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},me=(r,e,n,t)=>{r.addEventListener(e,n,t)},Ne=(r,e)=>{if(!e||!e[r])return!1;var n=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return n===1},Bt=(r,e)=>r.getAttribute("id")||(r.setAttribute("id",e),e),In=r=>r.replace(/[\\"']/g,"\\$&"),De=(r,e)=>{e&&r.append(e)},de=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Pe=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Rr(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Rr=r=>typeof r=="string"&&r.indexOf("<")>-1,Ps=r=>r.replace(/['"\\]/g,"\\$&"),Ft=(r,e)=>{var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!1),r.dispatchEvent(n)},tt=(r,e)=>{Object.assign(r.style,e)},Ae=(r,...e)=>{var n=Tr(e);r=Ir(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Le=(r,...e)=>{var n=Tr(e);r=Ir(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},Tr=r=>{var e=[];return de(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Ir=r=>(Array.isArray(r)||(r=[r]),r),Ht=(r,e,n)=>{if(!(n&&!n.contains(r)))for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},Pn=(r,e=0)=>e>0?r[r.length-1]:r[0],xs=r=>Object.keys(r).length===0,xn=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n},oe=(r,e)=>{de(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},Xt=(r,e)=>{r.parentNode&&r.parentNode.replaceChild(e,r)},Ms=(r,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const n=s=>{var o=s.data.match(e);if(o&&s.data.length>0){var p=document.createElement("span");p.className="highlight";var d=s.splitText(o.index);d.splitText(o[0].length);var v=d.cloneNode(!0);return p.appendChild(v),Xt(d,p),1}return 0},t=s=>{s.nodeType===1&&s.childNodes&&!/(script|style)/i.test(s.tagName)&&(s.className!=="highlight"||s.tagName!=="SPAN")&&Array.from(s.childNodes).forEach(o=>{i(o)})},i=s=>s.nodeType===3?n(s):(t(s),0);i(r)},Ls=r=>{var e=r.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(n){var t=n.parentNode;t.replaceChild(n.firstChild,n),t.normalize()})},ks=65,Ns=13,Ds=27,_s=37,js=38,Us=39,Bs=40,Mn=8,Fs=46,Ln=9,Hs=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),nt=Hs?"metaKey":"ctrlKey",kn={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(r){return r.length>0},render:{}};function Nn(r,e){var n=Object.assign({},kn,e),t=n.dataAttr,i=n.labelField,s=n.valueField,o=n.disabledField,p=n.optgroupField,d=n.optgroupLabelField,v=n.optgroupValueField,b=r.tagName.toLowerCase(),w=r.getAttribute("placeholder")||r.getAttribute("data-placeholder");if(!w&&!n.allowEmptyOption){let A=r.querySelector('option[value=""]');A&&(w=A.textContent)}var C={placeholder:w,options:[],optgroups:[],items:[],maxItems:null},P=()=>{var A,R=C.options,I={},y=1;let m=0;var T=u=>{var a=Object.assign({},u.dataset),g=t&&a[t];return typeof g=="string"&&g.length&&(a=Object.assign(a,JSON.parse(g))),a},f=(u,a)=>{var g=Re(u.value);if(g!=null&&!(!g&&!n.allowEmptyOption)){if(I.hasOwnProperty(g)){if(a){var h=I[g][p];h?Array.isArray(h)?h.push(a):I[g][p]=[h,a]:I[g][p]=a}}else{var O=T(u);O[i]=O[i]||u.textContent,O[s]=O[s]||g,O[o]=O[o]||u.disabled,O[p]=O[p]||a,O.$option=u,O.$order=O.$order||++m,I[g]=O,R.push(O)}u.selected&&C.items.push(g)}},c=u=>{var a,g;g=T(u),g[d]=g[d]||u.getAttribute("label")||"",g[v]=g[v]||y++,g[o]=g[o]||u.disabled,g.$order=g.$order||++m,C.optgroups.push(g),a=g[v],de(u.children,h=>{f(h,a)})};C.maxItems=r.hasAttribute("multiple")?null:1,de(r.children,u=>{A=u.tagName.toLowerCase(),A==="optgroup"?c(u):A==="option"&&f(u)})},l=()=>{const A=r.getAttribute(t);if(A)C.options=JSON.parse(A),de(C.options,I=>{C.items.push(I[s])});else{var R=r.value.trim()||"";if(!n.allowEmptyOption&&!R.length)return;const I=R.split(n.delimiter);de(I,y=>{const m={};m[i]=y,m[s]=y,C.options.push(m)}),C.items=I}};return b==="select"?P():l(),Object.assign({},kn,C,e)}var Dn=0;class ye extends os(is){constructor(e,n){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Dn++;var t,i=Pe(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s=window.getComputedStyle&&window.getComputedStyle(i,null);t=s.getPropertyValue("direction");const o=Nn(i,n);this.settings=o,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(t),this.inputId=Bt(i,"tomselect-"+Dn),this.isRequired=i.required,this.sifter=new Es(this.options,{diacritics:o.diacritics}),o.mode=o.mode||(o.maxItems===1?"single":"multi"),typeof o.hideSelected!="boolean"&&(o.hideSelected=o.mode==="multi"),typeof o.hidePlaceholder!="boolean"&&(o.hidePlaceholder=o.mode!=="multi");var p=o.createFilter;typeof p!="function"&&(typeof p=="string"&&(p=new RegExp(p)),p instanceof RegExp?o.createFilter=R=>p.test(R):o.createFilter=R=>this.settings.duplicates||!this.options[R]),this.initializePlugins(o.plugins),this.setupCallbacks(),this.setupTemplates();const d=Pe("<div>"),v=Pe("<div>"),b=this._render("dropdown"),w=Pe('<div role="listbox" tabindex="-1">'),C=this.input.getAttribute("class")||"",P=o.mode;var l;if(Ae(d,o.wrapperClass,C,P),Ae(v,o.controlClass),De(d,v),Ae(b,o.dropdownClass,P),o.copyClassesToDropdown&&Ae(b,C),Ae(w,o.dropdownContentClass),De(b,w),Pe(o.dropdownParent||d).appendChild(b),Rr(o.controlInput)){l=Pe(o.controlInput);var A=["autocorrect","autocapitalize","autocomplete","spellcheck"];de(A,R=>{i.getAttribute(R)&&oe(l,{[R]:i.getAttribute(R)})}),l.tabIndex=-1,v.appendChild(l),this.focus_node=l}else o.controlInput?(l=Pe(o.controlInput),this.focus_node=l):(l=Pe("<input/>"),this.focus_node=v);this.wrapper=d,this.dropdown=b,this.dropdown_content=w,this.control=v,this.control_input=l,this.setup()}setup(){const e=this,n=e.settings,t=e.control_input,i=e.dropdown,s=e.dropdown_content,o=e.wrapper,p=e.control,d=e.input,v=e.focus_node,b={passive:!0},w=e.inputId+"-ts-dropdown";oe(s,{id:w}),oe(v,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":w});const C=Bt(v,e.inputId+"-ts-control"),P="label[for='"+Ps(e.inputId)+"']",l=document.querySelector(P),A=e.focus.bind(e);if(l){me(l,"click",A),oe(l,{for:C});const y=Bt(l,e.inputId+"-ts-label");oe(v,{"aria-labelledby":y}),oe(s,{"aria-labelledby":y})}if(o.style.width=d.style.width,e.plugins.names.length){const y="plugin-"+e.plugins.names.join(" plugin-");Ae([o,i],y)}(n.maxItems===null||n.maxItems>1)&&e.is_select_tag&&oe(d,{multiple:"multiple"}),n.placeholder&&oe(t,{placeholder:n.placeholder}),!n.splitOn&&n.delimiter&&(n.splitOn=new RegExp("\\s*"+Je(n.delimiter)+"+\\s*")),n.load&&n.loadThrottle&&(n.load=Ts(n.load,n.loadThrottle)),me(i,"mousemove",()=>{e.ignoreHover=!1}),me(i,"mouseenter",y=>{var m=Ht(y.target,"[data-selectable]",i);m&&e.onOptionHover(y,m)},{capture:!0}),me(i,"click",y=>{const m=Ht(y.target,"[data-selectable]");m&&(e.onOptionSelect(y,m),le(y,!0))}),me(p,"click",y=>{var m=Ht(y.target,"[data-ts-item]",p);if(m&&e.onItemSelect(y,m)){le(y,!0);return}t.value==""&&(e.onClick(),le(y,!0))}),me(v,"keydown",y=>e.onKeyDown(y)),me(t,"keypress",y=>e.onKeyPress(y)),me(t,"input",y=>e.onInput(y)),me(v,"blur",y=>e.onBlur(y)),me(v,"focus",y=>e.onFocus(y)),me(t,"paste",y=>e.onPaste(y));const R=y=>{const m=y.composedPath()[0];if(!o.contains(m)&&!i.contains(m)){e.isFocused&&e.blur(),e.inputState();return}m==t&&e.isOpen?y.stopPropagation():le(y,!0)},I=()=>{e.isOpen&&e.positionDropdown()};me(document,"mousedown",R),me(window,"scroll",I,b),me(window,"resize",I,b),this._destroy=()=>{document.removeEventListener("mousedown",R),window.removeEventListener("scroll",I),window.removeEventListener("resize",I),l&&l.removeEventListener("click",A)},this.revertSettings={innerHTML:d.innerHTML,tabIndex:d.tabIndex},d.tabIndex=-1,d.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),n.items=[],delete n.optgroups,delete n.options,me(d,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,d.disabled?e.disable():d.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Ae(d,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),n.preload===!0&&e.preload()}setupOptions(e=[],n=[]){this.addOptions(e),de(n,t=>{this.registerOptionGroup(t)})}setupTemplates(){var e=this,n=e.settings.labelField,t=e.settings.optgroupLabelField,i={optgroup:s=>{let o=document.createElement("div");return o.className="optgroup",o.appendChild(s.options),o},optgroup_header:(s,o)=>'<div class="optgroup-header">'+o(s[t])+"</div>",option:(s,o)=>"<div>"+o(s[n])+"</div>",item:(s,o)=>"<div>"+o(s[n])+"</div>",option_create:(s,o)=>'<div class="create">Add <strong>'+o(s.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,n,t={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in t)n=this.settings[t[e]],n&&this.on(e,n)}sync(e=!0){const n=this,t=e?Nn(n.input,{delimiter:n.settings.delimiter}):n.settings;n.setupOptions(t.options,t.optgroups),n.setValue(t.items||[],!0),n.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Ft(this.input,"input"),Ft(this.input,"change")}onPaste(e){var n=this;if(n.isInputHidden||n.isLocked){le(e);return}n.settings.splitOn&&setTimeout(()=>{var t=n.inputValue();if(t.match(n.settings.splitOn)){var i=t.trim().split(n.settings.splitOn);de(i,s=>{Re(s)&&(this.options[s]?n.addItem(s):n.createItem(s))})}},0)}onKeyPress(e){var n=this;if(n.isLocked){le(e);return}var t=String.fromCharCode(e.keyCode||e.which);if(n.settings.create&&n.settings.mode==="multi"&&t===n.settings.delimiter){n.createItem(),le(e);return}}onKeyDown(e){var n=this;if(n.ignoreHover=!0,n.isLocked){e.keyCode!==Ln&&le(e);return}switch(e.keyCode){case ks:if(Ne(nt,e)&&n.control_input.value==""){le(e),n.selectAll();return}break;case Ds:n.isOpen&&(le(e,!0),n.close()),n.clearActiveItems();return;case Bs:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let t=n.getAdjacent(n.activeOption,1);t&&n.setActiveOption(t)}le(e);return;case js:if(n.activeOption){let t=n.getAdjacent(n.activeOption,-1);t&&n.setActiveOption(t)}le(e);return;case Ns:n.canSelect(n.activeOption)?(n.onOptionSelect(e,n.activeOption),le(e)):(n.settings.create&&n.createItem()||document.activeElement==n.control_input&&n.isOpen)&&le(e);return;case _s:n.advanceSelection(-1,e);return;case Us:n.advanceSelection(1,e);return;case Ln:n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(e,n.activeOption),le(e)),n.settings.create&&n.createItem()&&le(e));return;case Mn:case Fs:n.deleteSelection(e);return}n.isInputHidden&&!Ne(nt,e)&&le(e)}onInput(e){if(this.isLocked)return;const n=this.inputValue();if(this.lastValue!==n){if(this.lastValue=n,n==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=Rs(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,n){this.ignoreHover||this.setActiveOption(n,!1)}onFocus(e){var n=this,t=n.isFocused;if(n.isDisabled||n.isReadOnly){n.blur(),le(e);return}n.ignoreFocus||(n.isFocused=!0,n.settings.preload==="focus"&&n.preload(),t||n.trigger("focus"),n.activeItems.length||(n.inputState(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var n=this;if(n.isFocused){n.isFocused=!1,n.ignoreFocus=!1;var t=()=>{n.close(),n.setActiveItem(),n.setCaret(n.items.length),n.trigger("blur")};n.settings.create&&n.settings.createOnBlur?n.createItem(null,t):t()}}}onOptionSelect(e,n){var t,i=this;n.parentElement&&n.parentElement.matches("[data-disabled]")||(n.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(t=n.dataset.value,typeof t<"u"&&(i.lastQuery=null,i.addItem(t),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(n))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,n){var t=this;return!t.isLocked&&t.settings.mode==="multi"?(le(e),t.setActiveItem(n,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const n=this;if(!n.canLoad(e))return;Ae(n.wrapper,n.settings.loadingClass),n.loading++;const t=n.loadCallback.bind(n);n.settings.load.call(n,e,t)}loadCallback(e,n){const t=this;t.loading=Math.max(t.loading-1,0),t.lastQuery=null,t.clearActiveOption(),t.setupOptions(e,n),t.refreshOptions(t.isFocused&&!t.isInputHidden),t.loading||Le(t.wrapper,t.settings.loadingClass),t.trigger("load",e,n)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var n=this.control_input,t=n.value!==e;t&&(n.value=e,Ft(n,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,n){var t=n?[]:["change"];Tn(this,t,()=>{this.clear(n),this.addItems(e,n)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,n){var t=this,i,s,o,p,d,v;if(t.settings.mode!=="single"){if(!e){t.clearActiveItems(),t.isFocused&&t.inputState();return}if(i=n&&n.type.toLowerCase(),i==="click"&&Ne("shiftKey",n)&&t.activeItems.length){for(v=t.getLastActive(),o=Array.prototype.indexOf.call(t.control.children,v),p=Array.prototype.indexOf.call(t.control.children,e),o>p&&(d=o,o=p,p=d),s=o;s<=p;s++)e=t.control.children[s],t.activeItems.indexOf(e)===-1&&t.setActiveItemClass(e);le(n)}else i==="click"&&Ne(nt,n)||i==="keydown"&&Ne("shiftKey",n)?e.classList.contains("active")?t.removeActiveItem(e):t.setActiveItemClass(e):(t.clearActiveItems(),t.setActiveItemClass(e));t.inputState(),t.isFocused||t.focus()}}setActiveItemClass(e){const n=this,t=n.control.querySelector(".last-active");t&&Le(t,"last-active"),Ae(e,"active last-active"),n.trigger("item_select",e),n.activeItems.indexOf(e)==-1&&n.activeItems.push(e)}removeActiveItem(e){var n=this.activeItems.indexOf(e);this.activeItems.splice(n,1),Le(e,"active")}clearActiveItems(){Le(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,n=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,oe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),oe(e,{"aria-selected":"true"}),Ae(e,"active"),n&&this.scrollToOption(e)))}scrollToOption(e,n){if(!e)return;const t=this.dropdown_content,i=t.clientHeight,s=t.scrollTop||0,o=e.offsetHeight,p=e.getBoundingClientRect().top-t.getBoundingClientRect().top+s;p+o>i+s?this.scroll(p-i+o,n):p<s&&this.scroll(p,n)}scroll(e,n){const t=this.dropdown_content;n&&(t.style.scrollBehavior=n),t.scrollTop=e,t.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(Le(this.activeOption,"active"),oe(this.activeOption,{"aria-selected":null})),this.activeOption=null,oe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const n=e.controlChildren();n.length&&(e.inputState(),e.close(),e.activeItems=n,de(n,t=>{e.setActiveItemClass(t)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(oe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&oe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,n=e.sortField;return typeof e.sortField=="string"&&(n=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:n,nesting:e.nesting}}search(e){var n,t,i=this,s=this.getSearchOptions();if(i.settings.score&&(t=i.settings.score.call(i,e),typeof t!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,n=i.sifter.search(e,Object.assign(s,{score:t})),i.currentResults=n):n=Object.assign({},i.currentResults),i.settings.hideSelected&&(n.items=n.items.filter(o=>{let p=Re(o.id);return!(p&&i.items.indexOf(p)!==-1)})),n}refreshOptions(e=!0){var n,t,i,s,o,p,d,v,b,w;const C={},P=[];var l=this,A=l.inputValue();const R=A===l.lastQuery||A==""&&l.lastQuery==null;var I=l.search(A),y=null,m=l.settings.shouldOpen||!1,T=l.dropdown_content;R&&(y=l.activeOption,y&&(b=y.closest("[data-group]"))),s=I.items.length,typeof l.settings.maxOptions=="number"&&(s=Math.min(s,l.settings.maxOptions)),s>0&&(m=!0);const f=(u,a)=>{let g=C[u];if(g!==void 0){let O=P[g];if(O!==void 0)return[g,O.fragment]}let h=document.createDocumentFragment();return g=P.length,P.push({fragment:h,order:a,optgroup:u}),[g,h]};for(n=0;n<s;n++){let u=I.items[n];if(!u)continue;let a=u.id,g=l.options[a];if(g===void 0)continue;let h=at(a),O=l.getOption(h,!0);for(l.settings.hideSelected||O.classList.toggle("selected",l.items.includes(h)),o=g[l.settings.optgroupField]||"",p=Array.isArray(o)?o:[o],t=0,i=p&&p.length;t<i;t++){o=p[t];let N=g.$order,k=l.optgroups[o];k===void 0?o="":N=k.$order;const[L,M]=f(o,N);t>0&&(O=O.cloneNode(!0),oe(O,{id:g.$id+"-clone-"+t,"aria-selected":null}),O.classList.add("ts-cloned"),Le(O,"active"),l.activeOption&&l.activeOption.dataset.value==a&&b&&b.dataset.group===o.toString()&&(y=O)),M.appendChild(O),o!=""&&(C[o]=L)}}l.settings.lockOptgroupOrder&&P.sort((u,a)=>u.order-a.order),d=document.createDocumentFragment(),de(P,u=>{let a=u.fragment,g=u.optgroup;if(!a||!a.children.length)return;let h=l.optgroups[g];if(h!==void 0){let O=document.createDocumentFragment(),N=l.render("optgroup_header",h);De(O,N),De(O,a);let k=l.render("optgroup",{group:h,options:O});De(d,k)}else De(d,a)}),T.innerHTML="",De(T,d),l.settings.highlight&&(Ls(T),I.query.length&&I.tokens.length&&de(I.tokens,u=>{Ms(T,u.regex)}));var c=u=>{let a=l.render(u,{input:A});return a&&(m=!0,T.insertBefore(a,T.firstChild)),a};if(l.loading?c("loading"):l.settings.shouldLoad.call(l,A)?I.items.length===0&&c("no_results"):c("not_loading"),v=l.canCreate(A),v&&(w=c("option_create")),l.hasOptions=I.items.length>0||v,m){if(I.items.length>0){if(!y&&l.settings.mode==="single"&&l.items[0]!=null&&(y=l.getOption(l.items[0])),!T.contains(y)){let u=0;w&&!l.settings.addPrecedence&&(u=1),y=l.selectable()[u]}}else w&&(y=w);e&&!l.isOpen&&(l.open(),l.scrollToOption(y,"auto")),l.setActiveOption(y)}else l.clearActiveOption(),e&&l.isOpen&&l.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,n=!1){const t=this;if(Array.isArray(e))return t.addOptions(e,n),!1;const i=Re(e[t.settings.valueField]);return i===null||t.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++t.order,e.$id=t.inputId+"-opt-"+e.$order,t.options[i]=e,t.lastQuery=null,n&&(t.userOptions[i]=n,t.trigger("option_add",i,e)),i)}addOptions(e,n=!1){de(e,t=>{this.addOption(t,n)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var n=Re(e[this.settings.optgroupValueField]);return n===null?!1:(e.$order=e.$order||++this.order,this.optgroups[n]=e,n)}addOptionGroup(e,n){var t;n[this.settings.optgroupValueField]=e,(t=this.registerOptionGroup(n))&&this.trigger("optgroup_add",t,n)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,n){const t=this;var i,s;const o=Re(e),p=Re(n[t.settings.valueField]);if(o===null)return;const d=t.options[o];if(d==null)return;if(typeof p!="string")throw new Error("Value must be set in option data");const v=t.getOption(o),b=t.getItem(o);if(n.$order=n.$order||d.$order,delete t.options[o],t.uncacheValue(p),t.options[p]=n,v){if(t.dropdown_content.contains(v)){const w=t._render("option",n);Xt(v,w),t.activeOption===v&&t.setActiveOption(w)}v.remove()}b&&(s=t.items.indexOf(o),s!==-1&&t.items.splice(s,1,p),i=t._render("item",n),b.classList.contains("active")&&Ae(i,"active"),Xt(b,i)),t.lastQuery=null}removeOption(e,n){const t=this;e=at(e),t.uncacheValue(e),delete t.userOptions[e],delete t.options[e],t.lastQuery=null,t.trigger("option_remove",e),t.removeItem(e,n)}clearOptions(e){const n=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};de(this.options,(i,s)=>{n(i,s)&&(t[s]=i)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,n){return this.items.indexOf(n)>=0}getOption(e,n=!1){const t=Re(e);if(t===null)return null;const i=this.options[t];if(i!=null){if(i.$div)return i.$div;if(n)return this._render("option",i)}return null}getAdjacent(e,n,t="option"){var i=this,s;if(!e)return null;t=="item"?s=i.controlChildren():s=i.dropdown_content.querySelectorAll("[data-selectable]");for(let o=0;o<s.length;o++)if(s[o]==e)return n>0?s[o+1]:s[o-1];return null}getItem(e){if(typeof e=="object")return e;var n=Re(e);return n!==null?this.control.querySelector(`[data-value="${In(n)}"]`):null}addItems(e,n){var t=this,i=Array.isArray(e)?e:[e];i=i.filter(o=>t.items.indexOf(o)===-1);const s=i[i.length-1];i.forEach(o=>{t.isPending=o!==s,t.addItem(o,n)})}addItem(e,n){var t=n?[]:["change","dropdown_close"];Tn(this,t,()=>{var i,s;const o=this,p=o.settings.mode,d=Re(e);if(!(d&&o.items.indexOf(d)!==-1&&(p==="single"&&o.close(),p==="single"||!o.settings.duplicates))&&!(d===null||!o.options.hasOwnProperty(d))&&(p==="single"&&o.clear(n),!(p==="multi"&&o.isFull()))){if(i=o._render("item",o.options[d]),o.control.contains(i)&&(i=i.cloneNode(!0)),s=o.isFull(),o.items.splice(o.caretPos,0,d),o.insertAtCaret(i),o.isSetup){if(!o.isPending&&o.settings.hideSelected){let v=o.getOption(d),b=o.getAdjacent(v,1);b&&o.setActiveOption(b)}!o.isPending&&!o.settings.closeAfterSelect&&o.refreshOptions(o.isFocused&&p!=="single"),o.settings.closeAfterSelect!=!1&&o.isFull()?o.close():o.isPending||o.positionDropdown(),o.trigger("item_add",d,i),o.isPending||o.updateOriginalInput({silent:n})}(!o.isPending||!s&&o.isFull())&&(o.inputState(),o.refreshState())}})}removeItem(e=null,n){const t=this;if(e=t.getItem(e),!e)return;var i,s;const o=e.dataset.value;i=xn(e),e.remove(),e.classList.contains("active")&&(s=t.activeItems.indexOf(e),t.activeItems.splice(s,1),Le(e,"active")),t.items.splice(i,1),t.lastQuery=null,!t.settings.persist&&t.userOptions.hasOwnProperty(o)&&t.removeOption(o,n),i<t.caretPos&&t.setCaret(t.caretPos-1),t.updateOriginalInput({silent:n}),t.refreshState(),t.positionDropdown(),t.trigger("item_remove",o,e)}createItem(e=null,n=()=>{}){arguments.length===3&&(n=arguments[2]),typeof n!="function"&&(n=()=>{});var t=this,i=t.caretPos,s;if(e=e||t.inputValue(),!t.canCreate(e))return n(),!1;t.lock();var o=!1,p=d=>{if(t.unlock(),!d||typeof d!="object")return n();var v=Re(d[t.settings.valueField]);if(typeof v!="string")return n();t.setTextboxValue(),t.addOption(d,!0),t.setCaret(i),t.addItem(v),n(d),o=!0};return typeof t.settings.create=="function"?s=t.settings.create.call(this,e,p):s={[t.settings.labelField]:e,[t.settings.valueField]:e},o||p(s),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const n=e.isFull(),t=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",t),i.toggle("full",n),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",xs(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const n=this;var t,i;const s=n.input.querySelector('option[value=""]');if(n.is_select_tag){let o=function(v,b,w){return v||(v=Pe('<option value="'+Ut(b)+'">'+Ut(w)+"</option>")),v!=s&&n.input.append(v),p.push(v),(v!=s||d>0)&&(v.selected=!0),v};const p=[],d=n.input.querySelectorAll("option:checked").length;n.input.querySelectorAll("option:checked").forEach(v=>{v.selected=!1}),n.items.length==0&&n.settings.mode=="single"?o(s,"",""):n.items.forEach(v=>{if(t=n.options[v],i=t[n.settings.labelField]||"",p.includes(t.$option)){const b=n.input.querySelector(`option[value="${In(v)}"]:not(:checked)`);o(b,v,i)}else t.$option=o(t.$option,v,i)})}else n.input.value=n.getValue();n.isSetup&&(e.silent||n.trigger("change",n.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,oe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),tt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),tt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var n=this,t=n.isOpen;e&&(n.setTextboxValue(),n.settings.mode==="single"&&n.items.length&&n.inputState()),n.isOpen=!1,oe(n.focus_node,{"aria-expanded":"false"}),tt(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),t&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,n=e.getBoundingClientRect(),t=e.offsetHeight+n.top+window.scrollY,i=n.left+window.scrollX;tt(this.dropdown,{width:n.width+"px",top:t+"px",left:i+"px"})}}clear(e){var n=this;if(n.items.length){var t=n.controlChildren();de(t,i=>{n.removeItem(i,!0)}),n.inputState(),e||n.updateOriginalInput(),n.trigger("clear")}}insertAtCaret(e){const n=this,t=n.caretPos,i=n.control;i.insertBefore(e,i.children[t]||null),n.setCaret(t+1)}deleteSelection(e){var n,t,i,s,o=this;n=e&&e.keyCode===Mn?-1:1,t=Is(o.control_input);const p=[];if(o.activeItems.length)s=Pn(o.activeItems,n),i=xn(s),n>0&&i++,de(o.activeItems,d=>p.push(d));else if((o.isFocused||o.settings.mode==="single")&&o.items.length){const d=o.controlChildren();let v;n<0&&t.start===0&&t.length===0?v=d[o.caretPos-1]:n>0&&t.start===o.inputValue().length&&(v=d[o.caretPos]),v!==void 0&&p.push(v)}if(!o.shouldDelete(p,e))return!1;for(le(e,!0),typeof i<"u"&&o.setCaret(i);p.length;)o.removeItem(p.pop());return o.inputState(),o.positionDropdown(),o.refreshOptions(!1),!0}shouldDelete(e,n){const t=e.map(i=>i.dataset.value);return!(!t.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(t,n)===!1)}advanceSelection(e,n){var t,i,s=this;s.rtl&&(e*=-1),!s.inputValue().length&&(Ne(nt,n)||Ne("shiftKey",n)?(t=s.getLastActive(e),t?t.classList.contains("active")?i=s.getAdjacent(t,e,"item"):i=t:e>0?i=s.control_input.nextElementSibling:i=s.control_input.previousElementSibling,i&&(i.classList.contains("active")&&s.removeActiveItem(t),s.setActiveItemClass(i))):s.moveCaret(e))}moveCaret(e){}getLastActive(e){let n=this.control.querySelector(".last-active");if(n)return n;var t=this.control.querySelectorAll(".active");if(t)return Pn(t,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,n=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=n.innerHTML,e.input.tabIndex=n.tabIndex,Le(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,n){var t,i;const s=this;if(typeof this.settings.render[e]!="function"||(i=s.settings.render[e].call(this,n,Ut),!i))return null;if(i=Pe(i),e==="option"||e==="option_create"?n[s.settings.disabledField]?oe(i,{"aria-disabled":"true"}):oe(i,{"data-selectable":""}):e==="optgroup"&&(t=n.group[s.settings.optgroupValueField],oe(i,{"data-group":t}),n.group[s.settings.disabledField]&&oe(i,{"data-disabled":""})),e==="option"||e==="item"){const o=at(n[s.settings.valueField]);oe(i,{"data-value":o}),e==="item"?(Ae(i,s.settings.itemClass),oe(i,{"data-ts-item":""})):(Ae(i,s.settings.optionClass),oe(i,{role:"option",id:n.$id}),n.$div=i,s.options[o]=n)}return i}_render(e,n){const t=this.render(e,n);if(t==null)throw"HTMLElement expected";return t}clearCache(){de(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const n=this.getOption(e);n&&n.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,n,t){var i=this,s=i[n];i[n]=function(){var o,p;return e==="after"&&(o=s.apply(i,arguments)),p=t.apply(i,arguments),e==="instead"?p:(e==="before"&&(o=s.apply(i,arguments)),o)}}}const Gs=(r,e,n,t)=>{r.addEventListener(e,n,t)};function Vs(){Gs(this.input,"change",()=>{this.sync()})}const zs=r=>typeof r>"u"||r===null?null:Ws(r),Ws=r=>typeof r=="boolean"?r?"1":"0":r+"",_n=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},qs=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if($s(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},$s=r=>typeof r=="string"&&r.indexOf("<")>-1;function Ks(r){var e=this,n=e.onOptionSelect;e.settings.hideSelected=!1;const t=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},r);var i=function(o,p){p?(o.checked=!0,t.uncheckedClassNames&&o.classList.remove(...t.uncheckedClassNames),t.checkedClassNames&&o.classList.add(...t.checkedClassNames)):(o.checked=!1,t.checkedClassNames&&o.classList.remove(...t.checkedClassNames),t.uncheckedClassNames&&o.classList.add(...t.uncheckedClassNames))},s=function(o){setTimeout(()=>{var p=o.querySelector("input."+t.className);p instanceof HTMLInputElement&&i(p,o.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var o=e.settings.render.option;e.settings.render.option=(p,d)=>{var v=qs(o.call(e,p,d)),b=document.createElement("input");t.className&&b.classList.add(t.className),b.addEventListener("click",function(C){_n(C)}),b.type="checkbox";const w=zs(p[e.settings.valueField]);return i(b,!!(w&&e.items.indexOf(w)>-1)),v.prepend(b),v}}),e.on("item_remove",o=>{var p=e.getOption(o);p&&(p.classList.remove("selected"),s(p))}),e.on("item_add",o=>{var p=e.getOption(o);p&&s(p)}),e.hook("instead","onOptionSelect",(o,p)=>{if(p.classList.contains("selected")){p.classList.remove("selected"),e.removeItem(p.dataset.value),e.refreshOptions(),_n(o,!0);return}n.call(e,o,p),s(p)})}const Js=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Qs(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Qs=r=>typeof r=="string"&&r.indexOf("<")>-1;function Xs(r){const e=this,n=Object.assign({className:"clear-button",title:"Clear All",html:t=>`<div class="${t.className}" title="${t.title}">&#10799;</div>`},r);e.on("initialize",()=>{var t=Js(n.html(n));t.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(t)})}const Ys=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Be=(r,e,n,t)=>{r.addEventListener(e,n,t)},Zs=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},ea=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(ta(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},ta=r=>typeof r=="string"&&r.indexOf("<")>-1,na=(r,e)=>{Zs(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},ra=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r.nextSibling)},ia=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r)},oa=(r,e)=>{do{var n;if(e=(n=e)==null?void 0:n.previousElementSibling,r==e)return!0}while(e&&e.previousElementSibling);return!1};function sa(){var r=this;if(r.settings.mode!=="multi")return;var e=r.lock,n=r.unlock;let t=!0,i;r.hook("after","setupTemplates",()=>{var s=r.settings.render.item;r.settings.render.item=(o,p)=>{const d=ea(s.call(r,o,p));na(d,{draggable:"true"});const v=A=>{t||Ys(A),A.stopPropagation()},b=A=>{i=d,setTimeout(()=>{d.classList.add("ts-dragging")},0)},w=A=>{A.preventDefault(),d.classList.add("ts-drag-over"),P(d,i)},C=()=>{d.classList.remove("ts-drag-over")},P=(A,R)=>{R!==void 0&&(oa(R,d)?ra(A,R):ia(A,R))},l=()=>{var A;document.querySelectorAll(".ts-drag-over").forEach(I=>I.classList.remove("ts-drag-over")),(A=i)==null||A.classList.remove("ts-dragging"),i=void 0;var R=[];r.control.querySelectorAll("[data-value]").forEach(I=>{if(I.dataset.value){let y=I.dataset.value;y&&R.push(y)}}),r.setValue(R)};return Be(d,"mousedown",v),Be(d,"dragstart",b),Be(d,"dragenter",w),Be(d,"dragover",w),Be(d,"dragleave",C),Be(d,"dragend",l),d}}),r.hook("instead","lock",()=>(t=!1,e.call(r))),r.hook("instead","unlock",()=>(t=!0,n.call(r)))}const aa=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},la=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(ua(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},ua=r=>typeof r=="string"&&r.indexOf("<")>-1;function ca(r){const e=this,n=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:t=>'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a class="'+t.closeClass+'">&times;</a></div></div>'},r);e.on("initialize",()=>{var t=la(n.html(n)),i=t.querySelector("."+n.closeClass);i&&i.addEventListener("click",s=>{aa(s,!0),e.close()}),e.dropdown.insertBefore(t,e.dropdown.firstChild)})}const fa=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},da=(r,...e)=>{var n=ha(e);r=pa(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},ha=r=>{var e=[];return fa(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},pa=r=>(Array.isArray(r)||(r=[r]),r),ga=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function va(){var r=this;r.hook("instead","setCaret",e=>{r.settings.mode==="single"||!r.control.contains(r.control_input)?e=r.items.length:(e=Math.max(0,Math.min(r.items.length,e)),e!=r.caretPos&&!r.isPending&&r.controlChildren().forEach((n,t)=>{t<e?r.control_input.insertAdjacentElement("beforebegin",n):r.control.appendChild(n)})),r.caretPos=e}),r.hook("instead","moveCaret",e=>{if(!r.isFocused)return;const n=r.getLastActive(e);if(n){const t=ga(n);r.setCaret(e>0?t+1:t),r.setActiveItem(),da(n,"last-active")}else r.setCaret(r.caretPos+e)})}const ma=27,ya=9,ba=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Oa=(r,e,n,t)=>{r.addEventListener(e,n,t)},Ca=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},jn=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Aa(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Aa=r=>typeof r=="string"&&r.indexOf("<")>-1,wa=(r,...e)=>{var n=Sa(e);r=Ea(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Sa=r=>{var e=[];return Ca(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Ea=r=>(Array.isArray(r)||(r=[r]),r);function Ra(){const r=this;r.settings.shouldOpen=!0,r.hook("before","setup",()=>{r.focus_node=r.control,wa(r.control_input,"dropdown-input");const e=jn('<div class="dropdown-input-wrap">');e.append(r.control_input),r.dropdown.insertBefore(e,r.dropdown.firstChild);const n=jn('<input class="items-placeholder" tabindex="-1" />');n.placeholder=r.settings.placeholder||"",r.control.append(n)}),r.on("initialize",()=>{r.control_input.addEventListener("keydown",n=>{switch(n.keyCode){case ma:r.isOpen&&(ba(n,!0),r.close()),r.clearActiveItems();return;case ya:r.focus_node.tabIndex=-1;break}return r.onKeyDown.call(r,n)}),r.on("blur",()=>{r.focus_node.tabIndex=r.isDisabled?-1:r.tabIndex}),r.on("dropdown_open",()=>{r.control_input.focus()});const e=r.onBlur;r.hook("instead","onBlur",n=>{if(!(n&&n.relatedTarget==r.control_input))return e.call(r)}),Oa(r.control_input,"blur",()=>r.onBlur()),r.hook("before","close",()=>{r.isOpen&&r.focus_node.focus({preventScroll:!0})})})}const rt=(r,e,n,t)=>{r.addEventListener(e,n,t)};function Ta(){var r=this;r.on("initialize",()=>{var e=document.createElement("span"),n=r.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",r.wrapper.appendChild(e);var t=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const s of t)e.style[s]=n.style[s];var i=()=>{e.textContent=n.value,n.style.width=e.clientWidth+"px"};i(),r.on("update item_add item_remove",i),rt(n,"input",i),rt(n,"keyup",i),rt(n,"blur",i),rt(n,"update",i)})}function Ia(){var r=this,e=r.deleteSelection;this.hook("instead","deleteSelection",n=>r.activeItems.length?e.call(r,n):!1)}function Pa(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const Un=37,xa=39,Ma=(r,e,n)=>{for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},La=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function ka(){var r=this,e=r.onKeyDown;r.hook("instead","onKeyDown",n=>{var t,i,s,o;if(!r.isOpen||!(n.keyCode===Un||n.keyCode===xa))return e.call(r,n);r.ignoreHover=!0,o=Ma(r.activeOption,"[data-group]"),t=La(r.activeOption,"[data-selectable]"),o&&(n.keyCode===Un?o=o.previousSibling:o=o.nextSibling,o&&(s=o.querySelectorAll("[data-selectable]"),i=s[Math.min(s.length-1,t)],i&&r.setActiveOption(i)))})}const Na=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Bn=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Fn=(r,e,n,t)=>{r.addEventListener(e,n,t)},Hn=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Da(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Da=r=>typeof r=="string"&&r.indexOf("<")>-1;function _a(r){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},r);var n=this;if(e.append){var t='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Na(e.title)+'">'+e.label+"</a>";n.hook("after","setupTemplates",()=>{var i=n.settings.render.item;n.settings.render.item=(s,o)=>{var p=Hn(i.call(n,s,o)),d=Hn(t);return p.appendChild(d),Fn(d,"mousedown",v=>{Bn(v,!0)}),Fn(d,"click",v=>{n.isLocked||(Bn(v,!0),!n.isLocked&&n.shouldDelete([p],v)&&(n.removeItem(p),n.refreshOptions(!1),n.inputState()))}),p}})}}function ja(r){const e=this,n=Object.assign({text:t=>t[e.settings.labelField]},r);e.on("item_remove",function(t){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[t];i&&e.setTextboxValue(n.text.call(e,i))}})}const Ua=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Ba=(r,...e)=>{var n=Fa(e);r=Ha(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Fa=r=>{var e=[];return Ua(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Ha=r=>(Array.isArray(r)||(r=[r]),r);function Ga(){const r=this,e=r.canLoad,n=r.clearActiveOption,t=r.loadCallback;var i={},s,o=!1,p,d=[];if(r.settings.shouldLoadMore||(r.settings.shouldLoadMore=()=>{if(s.clientHeight/(s.scrollHeight-s.scrollTop)>.9)return!0;if(r.activeOption){var w=r.selectable(),C=Array.from(w).indexOf(r.activeOption);if(C>=w.length-2)return!0}return!1}),!r.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";r.settings.sortField=[{field:"$order"},{field:"$score"}];const v=w=>typeof r.settings.maxOptions=="number"&&s.children.length>=r.settings.maxOptions?!1:!!(w in i&&i[w]),b=(w,C)=>r.items.indexOf(C)>=0||d.indexOf(C)>=0;r.setNextUrl=(w,C)=>{i[w]=C},r.getUrl=w=>{if(w in i){const C=i[w];return i[w]=!1,C}return r.clearPagination(),r.settings.firstUrl.call(r,w)},r.clearPagination=()=>{i={}},r.hook("instead","clearActiveOption",()=>{if(!o)return n.call(r)}),r.hook("instead","canLoad",w=>w in i?v(w):e.call(r,w)),r.hook("instead","loadCallback",(w,C)=>{if(!o)r.clearOptions(b);else if(p){const P=w[0];P!==void 0&&(p.dataset.value=P[r.settings.valueField])}t.call(r,w,C),o=!1}),r.hook("after","refreshOptions",()=>{const w=r.lastValue;var C;v(w)?(C=r.render("loading_more",{query:w}),C&&(C.setAttribute("data-selectable",""),p=C)):w in i&&!s.querySelector(".no-results")&&(C=r.render("no_more_results",{query:w})),C&&(Ba(C,r.settings.optionClass),s.append(C))}),r.on("initialize",()=>{d=Object.keys(r.options),s=r.dropdown_content,r.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},r.settings.render),s.addEventListener("scroll",()=>{r.settings.shouldLoadMore.call(r)&&v(r.lastValue)&&(o||(o=!0,r.load.call(r,r.lastValue)))})})}ye.define("change_listener",Vs);ye.define("checkbox_options",Ks);ye.define("clear_button",Xs);ye.define("drag_drop",sa);ye.define("dropdown_header",ca);ye.define("caret_position",va);ye.define("dropdown_input",Ra);ye.define("input_autogrow",Ta);ye.define("no_backspace_delete",Ia);ye.define("no_active_items",Pa);ye.define("optgroup_columns",ka);ye.define("remove_button",_a);ye.define("restore_on_backspace",ja);ye.define("virtual_scroll",Ga);const Va=r=>({init(){const e=this.$refs[`select_picker_${r.dataField}_${r.tableName}`],n={items:r.initialValues,...r.framework,onChange:s=>{Cr(r,s)},onInitialize:()=>{window.addEventListener(`pg:clear_multi_select::${r.tableName}:${r.dataField}`,()=>{e&&e.tomselect.clear(!0)}),window.addEventListener(`pg:clear_all_multi_select::${r.tableName}`,()=>{e&&e.tomselect.clear(!0)})}},t={valueField:r.optionValue,labelField:r.optionLabel,searchField:r.optionLabel,load:async function(s,o){function p(d,v){var b;const{method:w,url:C}=d,P=new Request(C,{method:w,body:w.toLowerCase()==="post"?JSON.stringify({search:v,...i}):void 0});P.headers.set("Content-Type","application/json"),P.headers.set("Accept","application/json"),P.headers.set("X-Requested-With","XMLHttpRequest");const l=(b=document.head.querySelector('[name="csrf-token"]'))==null?void 0:b.getAttribute("content");return l&&P.headers.set("X-CSRF-TOKEN",l),P}fetch(p(r.asyncData,s)).then(d=>d.json()).then(d=>{o(d)}).catch(()=>{o()})},render:{option:function(s,o){return`<div class="py-2 mb-1"><span>${o(s[r.optionLabel])}</span></div>`},item:function(s,o){return`<div class="py-2 mb-1"><span>${o(s[r.optionLabel])}</span></div>`}}};let i=n;r.hasOwnProperty("asyncData")&&(i=Object.assign(n,t)),new ye(e,i)}}),za=r=>({initialValues:r.initialValues,framework:r.framework,init(){const e=this.$refs["select_picker_"+r.dataField+"_"+r.tableName],n=this.deepCopy(this.framework);new window.SlimSelect({select:e,...n,events:{afterChange:t=>{let i=t.map(s=>s.value);Cr(r,i)}}})},deepCopy(e){if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(this.deepCopy);const n={};for(const t in e)e.hasOwnProperty(t)&&(n[t]=this.deepCopy(e[t]));return n}}),Wa=()=>({init(){Livewire.on("pg:scrollTop",r=>{setTimeout(()=>{document.querySelector("body").scrollIntoView({behavior:"auto"})},0)}),new IntersectionObserver(r=>{r[0].isIntersecting&&this.$wire.call("loadMore")},{rootMargin:"300px"}).observe(this.$el)}}),qa=r=>({rowId:(r==null?void 0:r.rowId)??null,parentId:(r==null?void 0:r.parentId)??null,toHtml(){let e=null;const n=this.parentId??this.$wire.id;if(this.rowId){const i=window[`pgActions_${n}`];i&&i[this.rowId]!==void 0&&(e=i[this.rowId])}else e=window[`pgActionsHeader_${n}`];if(typeof e!="object"||e===null)return"";let t="";return e.forEach(i=>{let s=this.shouldHideAction(i),o=this.getReplaceHtml(i);if(!s)if(o)t+=o;else{let p=this.buildAttributesString(i);if(i.icon){let d=this.processIcon(i);if(!d)return;t+=this.buildActionHtmlWithIcon(i,p,d)}else t+=this.buildActionHtml(i,p)}}),t},shouldHideAction(e){if(e.can===!1)return!0;let n=!1;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(t=>{t.action.includes(e.action)&&t.apply&&t.rule.hide&&(n=!0)}),n},getReplaceHtml(e){let n=null;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(t=>{t.apply&&t.action.includes(e.action)&&t.replaceHtml&&(n=t.replaceHtml)}),n},buildAttributesString(e){let n=e.attributes??[];return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(t=>{t.apply&&t.action.includes(e.action)&&t.rule.setAttribute&&t.rule.setAttribute.length>0&&Object.values(t.rule.setAttribute).forEach(i=>{n[i.attribute]=i.value})}),Object.entries(n).map(([t,i])=>` ${t}="${i}"`).join("")},processIcon(e){const n=Object.entries(e.iconAttributes??[]).map(([i,s])=>` ${i}="${s}"`).join("");let t=window.pgResourceIcons[e.icon];return typeof t>"u"?(console.warn(`PowerGrid: Unable to load icons in javascript window in row: [${this.rowId}]`),null):this.replaceIconAttributes(t,n)},replaceIconAttributes(e,n){return e.replace(/<([^\s>]+)([^>]*)>/,(t,i,s)=>{let o=s.trim();const p=n.replace(/class="([^"]*)"/,(d,v)=>(o.includes("class=")?o=o.replace(/class="([^"]*)"/,(b,w)=>`class="${w} ${v.trim()}"`):o+=` ${d}`,""));return`<${i} ${o} ${p}>`})},buildActionHtmlWithIcon(e,n,t){return e.slot?`<${e.tag??"button"} ${n}>${t} ${e.slot}</${e.tag??"button"}>`:`<${e.tag??"button"} ${n}>${t}</${e.tag??"button"}>`},buildActionHtml(e,n){return`<${e.tag??"button"} ${n}>${e.slot}</${e.tag??"button"}>`}}),$a=r=>({templateContent:(r==null?void 0:r.templateContent)??null,rendered:null,parentId:(r==null?void 0:r.parentId)??null,init(){const e=Object.keys(this.templateContent)[0],n=window[`pgRowTemplates_${this.parentId??this.$wire.id}`][e],t=this.templateContent[e];if(t){let i=n;for(const[s,o]of Object.entries(t)){const p=`{{ ${s} }}`,d=String(o).replace(/'/g,"\\'");i=i.replaceAll(p,d)}this.rendered=i}}}),Ka=r=>({rowId:r.rowId,rules:r.rules,defaultClasses:r.defaultClasses,attributes:[],theme:[],init(){this.rules&&Object.values(this.rules).forEach(e=>{(e.applyLoop||e.apply)&&e!=null&&e.attributes&&this.attributes.push(e.attributes)})},getAttributes(){let e={class:this.defaultClasses};return this.attributes.forEach(n=>{Object.keys(n).forEach(t=>{e[t]+=e[t]?` ${n[t]}`:n[t]})}),e}});window.pgToggleable=qo;window.pgFlatpickr=Ko;window.pgEditable=Jo;window.pgResponsive=ns;window.pgTomSelect=Va;window.pgSlimSelect=za;window.pgLoadMore=Wa;window.pgRenderActions=qa;window.pgRowAttributes=Ka;window.pgRenderRowTemplate=$a;document.addEventListener("DOMContentLoaded",()=>{Livewire.hook("commit",({component:r,succeed:e,fail:n})=>{r.ephemeral.setUp&&r.ephemeral.setUp.hasOwnProperty("responsive")&&(e(()=>{queueMicrotask(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))})}),n(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))}))})});document.addEventListener("DOMContentLoaded",()=>{window.Alpine.directive("multisort-shift-click",(r,{expression:e})=>{r.addEventListener("click",n=>{window.Livewire.find(e).set("multiSort",n.shiftKey)})})});
