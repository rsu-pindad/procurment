var Ii=Object.defineProperty;var Mi=(r,e,n)=>e in r?Ii(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var He=(r,e,n)=>Mi(r,typeof e!="symbol"?e+"":e,n);import{m as st,i as rt,a as _i,e as Pi,c as Rr,r as le,v as Li,t as ki,d as Di,b as Ni,A as Ui,P as Fi,B as Bi}from"./vendor_chartjs--jLXEWWA.js";function ji(r,e){for(var n=0;n<e.length;n++){const t=e[n];if(typeof t!="string"&&!Array.isArray(t)){for(const i in t)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(t,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>t[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}function Tr(r,e){return function(){return r.apply(e,arguments)}}const{toString:Hi}=Object.prototype,{getPrototypeOf:Tn}=Object,{iterator:Bt,toStringTag:xr}=Symbol,jt=(r=>e=>{const n=Hi.call(e);return r[n]||(r[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Me=r=>(r=r.toLowerCase(),e=>jt(e)===r),Ht=r=>e=>typeof e===r,{isArray:Qe}=Array,at=Ht("undefined");function Gi(r){return r!==null&&!at(r)&&r.constructor!==null&&!at(r.constructor)&&Ce(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Ir=Me("ArrayBuffer");function $i(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Ir(r.buffer),e}const Vi=Ht("string"),Ce=Ht("function"),Mr=Ht("number"),Gt=r=>r!==null&&typeof r=="object",Wi=r=>r===!0||r===!1,Tt=r=>{if(jt(r)!=="object")return!1;const e=Tn(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(xr in r)&&!(Bt in r)},zi=Me("Date"),Ki=Me("File"),qi=Me("Blob"),Ji=Me("FileList"),Yi=r=>Gt(r)&&Ce(r.pipe),Qi=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Ce(r.append)&&((e=jt(r))==="formdata"||e==="object"&&Ce(r.toString)&&r.toString()==="[object FormData]"))},Xi=Me("URLSearchParams"),[Zi,eo,to,no]=["ReadableStream","Request","Response","Headers"].map(Me),ro=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ct(r,e,{allOwnKeys:n=!1}={}){if(r===null||typeof r>"u")return;let t,i;if(typeof r!="object"&&(r=[r]),Qe(r))for(t=0,i=r.length;t<i;t++)e.call(null,r[t],t,r);else{const s=n?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let u;for(t=0;t<o;t++)u=s[t],e.call(null,r[u],u,r)}}function _r(r,e){e=e.toLowerCase();const n=Object.keys(r);let t=n.length,i;for(;t-- >0;)if(i=n[t],e===i.toLowerCase())return i;return null}const Ve=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Pr=r=>!at(r)&&r!==Ve;function gn(){const{caseless:r}=Pr(this)&&this||{},e={},n=(t,i)=>{const s=r&&_r(e,i)||i;Tt(e[s])&&Tt(t)?e[s]=gn(e[s],t):Tt(t)?e[s]=gn({},t):Qe(t)?e[s]=t.slice():e[s]=t};for(let t=0,i=arguments.length;t<i;t++)arguments[t]&&ct(arguments[t],n);return e}const oo=(r,e,n,{allOwnKeys:t}={})=>(ct(e,(i,s)=>{n&&Ce(i)?r[s]=Tr(i,n):r[s]=i},{allOwnKeys:t}),r),so=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),ao=(r,e,n,t)=>{r.prototype=Object.create(e.prototype,t),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),n&&Object.assign(r.prototype,n)},uo=(r,e,n,t)=>{let i,s,o;const u={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!t||t(o,r,e))&&!u[o]&&(e[o]=r[o],u[o]=!0);r=n!==!1&&Tn(r)}while(r&&(!n||n(r,e))&&r!==Object.prototype);return e},lo=(r,e,n)=>{r=String(r),(n===void 0||n>r.length)&&(n=r.length),n-=e.length;const t=r.indexOf(e,n);return t!==-1&&t===n},co=r=>{if(!r)return null;if(Qe(r))return r;let e=r.length;if(!Mr(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=r[e];return n},fo=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&Tn(Uint8Array)),ho=(r,e)=>{const t=(r&&r[Bt]).call(r);let i;for(;(i=t.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},po=(r,e)=>{let n;const t=[];for(;(n=r.exec(e))!==null;)t.push(n);return t},go=Me("HTMLFormElement"),vo=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,t,i){return t.toUpperCase()+i}),Un=(({hasOwnProperty:r})=>(e,n)=>r.call(e,n))(Object.prototype),mo=Me("RegExp"),Lr=(r,e)=>{const n=Object.getOwnPropertyDescriptors(r),t={};ct(n,(i,s)=>{let o;(o=e(i,s,r))!==!1&&(t[s]=o||i)}),Object.defineProperties(r,t)},yo=r=>{Lr(r,(e,n)=>{if(Ce(r)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const t=r[n];if(Ce(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},bo=(r,e)=>{const n={},t=i=>{i.forEach(s=>{n[s]=!0})};return Qe(r)?t(r):t(String(r).split(e)),n},Oo=()=>{},Co=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function So(r){return!!(r&&Ce(r.append)&&r[xr]==="FormData"&&r[Bt])}const Ao=r=>{const e=new Array(10),n=(t,i)=>{if(Gt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[i]=t;const s=Qe(t)?[]:{};return ct(t,(o,u)=>{const d=n(o,i+1);!at(d)&&(s[u]=d)}),e[i]=void 0,s}}return t};return n(r,0)},wo=Me("AsyncFunction"),Eo=r=>r&&(Gt(r)||Ce(r))&&Ce(r.then)&&Ce(r.catch),kr=((r,e)=>r?setImmediate:e?((n,t)=>(Ve.addEventListener("message",({source:i,data:s})=>{i===Ve&&s===n&&t.length&&t.shift()()},!1),i=>{t.push(i),Ve.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Ce(Ve.postMessage)),Ro=typeof queueMicrotask<"u"?queueMicrotask.bind(Ve):typeof process<"u"&&process.nextTick||kr,To=r=>r!=null&&Ce(r[Bt]),z={isArray:Qe,isArrayBuffer:Ir,isBuffer:Gi,isFormData:Qi,isArrayBufferView:$i,isString:Vi,isNumber:Mr,isBoolean:Wi,isObject:Gt,isPlainObject:Tt,isReadableStream:Zi,isRequest:eo,isResponse:to,isHeaders:no,isUndefined:at,isDate:zi,isFile:Ki,isBlob:qi,isRegExp:mo,isFunction:Ce,isStream:Yi,isURLSearchParams:Xi,isTypedArray:fo,isFileList:Ji,forEach:ct,merge:gn,extend:oo,trim:ro,stripBOM:so,inherits:ao,toFlatObject:uo,kindOf:jt,kindOfTest:Me,endsWith:lo,toArray:co,forEachEntry:ho,matchAll:po,isHTMLForm:go,hasOwnProperty:Un,hasOwnProp:Un,reduceDescriptors:Lr,freezeMethods:yo,toObjectSet:bo,toCamelCase:vo,noop:Oo,toFiniteNumber:Co,findKey:_r,global:Ve,isContextDefined:Pr,isSpecCompliantForm:So,toJSONObject:Ao,isAsyncFn:wo,isThenable:Eo,setImmediate:kr,asap:Ro,isIterable:To};function te(r,e,n,t,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),t&&(this.request=t),i&&(this.response=i,this.status=i.status?i.status:null)}z.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:z.toJSONObject(this.config),code:this.code,status:this.status}}});const Dr=te.prototype,Nr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Nr[r]={value:r}});Object.defineProperties(te,Nr);Object.defineProperty(Dr,"isAxiosError",{value:!0});te.from=(r,e,n,t,i,s)=>{const o=Object.create(Dr);return z.toFlatObject(r,o,function(d){return d!==Error.prototype},u=>u!=="isAxiosError"),te.call(o,r.message,e,n,t,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const xo=null;function vn(r){return z.isPlainObject(r)||z.isArray(r)}function Ur(r){return z.endsWith(r,"[]")?r.slice(0,-2):r}function Fn(r,e,n){return r?r.concat(e).map(function(i,s){return i=Ur(i),!n&&s?"["+i+"]":i}).join(n?".":""):e}function Io(r){return z.isArray(r)&&!r.some(vn)}const Mo=z.toFlatObject(z,{},null,function(e){return/^is[A-Z]/.test(e)});function $t(r,e,n){if(!z.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,n=z.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,R){return!z.isUndefined(R[E])});const t=n.metaTokens,i=n.visitor||m,s=n.dots,o=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&z.isSpecCompliantForm(e);if(!z.isFunction(i))throw new TypeError("visitor must be a function");function h(l){if(l===null)return"";if(z.isDate(l))return l.toISOString();if(z.isBoolean(l))return l.toString();if(!d&&z.isBlob(l))throw new te("Blob is not supported. Use a Buffer instead.");return z.isArrayBuffer(l)||z.isTypedArray(l)?d&&typeof Blob=="function"?new Blob([l]):Buffer.from(l):l}function m(l,E,R){let M=l;if(l&&!R&&typeof l=="object"){if(z.endsWith(E,"{}"))E=t?E:E.slice(0,-2),l=JSON.stringify(l);else if(z.isArray(l)&&Io(l)||(z.isFileList(l)||z.endsWith(E,"[]"))&&(M=z.toArray(l)))return E=Ur(E),M.forEach(function(y,T){!(z.isUndefined(y)||y===null)&&e.append(o===!0?Fn([E],T,s):o===null?E:E+"[]",h(y))}),!1}return vn(l)?!0:(e.append(Fn(R,E,s),h(l)),!1)}const O=[],w=Object.assign(Mo,{defaultVisitor:m,convertValue:h,isVisitable:vn});function x(l,E){if(!z.isUndefined(l)){if(O.indexOf(l)!==-1)throw Error("Circular reference detected in "+E.join("."));O.push(l),z.forEach(l,function(M,b){(!(z.isUndefined(M)||M===null)&&i.call(e,M,z.isString(b)?b.trim():b,E,w))===!0&&x(M,E?E.concat(b):[b])}),O.pop()}}if(!z.isObject(r))throw new TypeError("data must be an object");return x(r),e}function Bn(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function xn(r,e){this._pairs=[],r&&$t(r,this,e)}const Fr=xn.prototype;Fr.append=function(e,n){this._pairs.push([e,n])};Fr.toString=function(e){const n=e?function(t){return e.call(this,t,Bn)}:Bn;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function _o(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Br(r,e,n){if(!e)return r;const t=n&&n.encode||_o;z.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(i?s=i(e,n):s=z.isURLSearchParams(e)?e.toString():new xn(e,n).toString(t),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class jn{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){z.forEach(this.handlers,function(t){t!==null&&e(t)})}}const jr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Po=typeof URLSearchParams<"u"?URLSearchParams:xn,Lo=typeof FormData<"u"?FormData:null,ko=typeof Blob<"u"?Blob:null,Do={isBrowser:!0,classes:{URLSearchParams:Po,FormData:Lo,Blob:ko},protocols:["http","https","file","blob","url","data"]},In=typeof window<"u"&&typeof document<"u",mn=typeof navigator=="object"&&navigator||void 0,No=In&&(!mn||["ReactNative","NativeScript","NS"].indexOf(mn.product)<0),Uo=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Fo=In&&window.location.href||"http://localhost",Bo=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:In,hasStandardBrowserEnv:No,hasStandardBrowserWebWorkerEnv:Uo,navigator:mn,origin:Fo},Symbol.toStringTag,{value:"Module"})),ve={...Bo,...Do};function jo(r,e){return $t(r,new ve.classes.URLSearchParams,Object.assign({visitor:function(n,t,i,s){return ve.isNode&&z.isBuffer(n)?(this.append(t,n.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Ho(r){return z.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Go(r){const e={},n=Object.keys(r);let t;const i=n.length;let s;for(t=0;t<i;t++)s=n[t],e[s]=r[s];return e}function Hr(r){function e(n,t,i,s){let o=n[s++];if(o==="__proto__")return!0;const u=Number.isFinite(+o),d=s>=n.length;return o=!o&&z.isArray(i)?i.length:o,d?(z.hasOwnProp(i,o)?i[o]=[i[o],t]:i[o]=t,!u):((!i[o]||!z.isObject(i[o]))&&(i[o]=[]),e(n,t,i[o],s)&&z.isArray(i[o])&&(i[o]=Go(i[o])),!u)}if(z.isFormData(r)&&z.isFunction(r.entries)){const n={};return z.forEachEntry(r,(t,i)=>{e(Ho(t),i,n,0)}),n}return null}function $o(r,e,n){if(z.isString(r))try{return(e||JSON.parse)(r),z.trim(r)}catch(t){if(t.name!=="SyntaxError")throw t}return(n||JSON.stringify)(r)}const ft={transitional:jr,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",i=t.indexOf("application/json")>-1,s=z.isObject(e);if(s&&z.isHTMLForm(e)&&(e=new FormData(e)),z.isFormData(e))return i?JSON.stringify(Hr(e)):e;if(z.isArrayBuffer(e)||z.isBuffer(e)||z.isStream(e)||z.isFile(e)||z.isBlob(e)||z.isReadableStream(e))return e;if(z.isArrayBufferView(e))return e.buffer;if(z.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(s){if(t.indexOf("application/x-www-form-urlencoded")>-1)return jo(e,this.formSerializer).toString();if((u=z.isFileList(e))||t.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return $t(u?{"files[]":e}:e,d&&new d,this.formSerializer)}}return s||i?(n.setContentType("application/json",!1),$o(e)):e}],transformResponse:[function(e){const n=this.transitional||ft.transitional,t=n&&n.forcedJSONParsing,i=this.responseType==="json";if(z.isResponse(e)||z.isReadableStream(e))return e;if(e&&z.isString(e)&&(t&&!this.responseType||i)){const o=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(u){if(o)throw u.name==="SyntaxError"?te.from(u,te.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ve.classes.FormData,Blob:ve.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};z.forEach(["delete","get","head","post","put","patch"],r=>{ft.headers[r]={}});const Vo=z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Wo=r=>{const e={};let n,t,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),n=o.substring(0,i).trim().toLowerCase(),t=o.substring(i+1).trim(),!(!n||e[n]&&Vo[n])&&(n==="set-cookie"?e[n]?e[n].push(t):e[n]=[t]:e[n]=e[n]?e[n]+", "+t:t)}),e},Hn=Symbol("internals");function et(r){return r&&String(r).trim().toLowerCase()}function xt(r){return r===!1||r==null?r:z.isArray(r)?r.map(xt):String(r)}function zo(r){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=n.exec(r);)e[t[1]]=t[2];return e}const Ko=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Zt(r,e,n,t,i){if(z.isFunction(t))return t.call(this,e,n);if(i&&(e=n),!!z.isString(e)){if(z.isString(t))return e.indexOf(t)!==-1;if(z.isRegExp(t))return t.test(e)}}function qo(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}function Jo(r,e){const n=z.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(r,t+n,{value:function(i,s,o){return this[t].call(this,e,i,s,o)},configurable:!0})})}let Se=class{constructor(e){e&&this.set(e)}set(e,n,t){const i=this;function s(u,d,h){const m=et(d);if(!m)throw new Error("header name must be a non-empty string");const O=z.findKey(i,m);(!O||i[O]===void 0||h===!0||h===void 0&&i[O]!==!1)&&(i[O||d]=xt(u))}const o=(u,d)=>z.forEach(u,(h,m)=>s(h,m,d));if(z.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(z.isString(e)&&(e=e.trim())&&!Ko(e))o(Wo(e),n);else if(z.isObject(e)&&z.isIterable(e)){let u={},d,h;for(const m of e){if(!z.isArray(m))throw TypeError("Object iterator must return a key-value pair");u[h=m[0]]=(d=u[h])?z.isArray(d)?[...d,m[1]]:[d,m[1]]:m[1]}o(u,n)}else e!=null&&s(n,e,t);return this}get(e,n){if(e=et(e),e){const t=z.findKey(this,e);if(t){const i=this[t];if(!n)return i;if(n===!0)return zo(i);if(z.isFunction(n))return n.call(this,i,t);if(z.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=et(e),e){const t=z.findKey(this,e);return!!(t&&this[t]!==void 0&&(!n||Zt(this,this[t],t,n)))}return!1}delete(e,n){const t=this;let i=!1;function s(o){if(o=et(o),o){const u=z.findKey(t,o);u&&(!n||Zt(t,t[u],u,n))&&(delete t[u],i=!0)}}return z.isArray(e)?e.forEach(s):s(e),i}clear(e){const n=Object.keys(this);let t=n.length,i=!1;for(;t--;){const s=n[t];(!e||Zt(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const n=this,t={};return z.forEach(this,(i,s)=>{const o=z.findKey(t,s);if(o){n[o]=xt(i),delete n[s];return}const u=e?qo(s):String(s).trim();u!==s&&delete n[s],n[u]=xt(i),t[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return z.forEach(this,(t,i)=>{t!=null&&t!==!1&&(n[i]=e&&z.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(i=>t.set(i)),t}static accessor(e){const t=(this[Hn]=this[Hn]={accessors:{}}).accessors,i=this.prototype;function s(o){const u=et(o);t[u]||(Jo(i,o),t[u]=!0)}return z.isArray(e)?e.forEach(s):s(e),this}};Se.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);z.reduceDescriptors(Se.prototype,({value:r},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(t){this[n]=t}}});z.freezeMethods(Se);function en(r,e){const n=this||ft,t=e||n,i=Se.from(t.headers);let s=t.data;return z.forEach(r,function(u){s=u.call(n,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function Gr(r){return!!(r&&r.__CANCEL__)}function Xe(r,e,n){te.call(this,r??"canceled",te.ERR_CANCELED,e,n),this.name="CanceledError"}z.inherits(Xe,te,{__CANCEL__:!0});function $r(r,e,n){const t=n.config.validateStatus;!n.status||!t||t(n.status)?r(n):e(new te("Request failed with status code "+n.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Yo(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Qo(r,e){r=r||10;const n=new Array(r),t=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(d){const h=Date.now(),m=t[s];o||(o=h),n[i]=d,t[i]=h;let O=s,w=0;for(;O!==i;)w+=n[O++],O=O%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),h-o<e)return;const x=m&&h-m;return x?Math.round(w*1e3/x):void 0}}function Xo(r,e){let n=0,t=1e3/e,i,s;const o=(h,m=Date.now())=>{n=m,i=null,s&&(clearTimeout(s),s=null),r.apply(null,h)};return[(...h)=>{const m=Date.now(),O=m-n;O>=t?o(h,m):(i=h,s||(s=setTimeout(()=>{s=null,o(i)},t-O)))},()=>i&&o(i)]}const _t=(r,e,n=3)=>{let t=0;const i=Qo(50,250);return Xo(s=>{const o=s.loaded,u=s.lengthComputable?s.total:void 0,d=o-t,h=i(d),m=o<=u;t=o;const O={loaded:o,total:u,progress:u?o/u:void 0,bytes:d,rate:h||void 0,estimated:h&&u&&m?(u-o)/h:void 0,event:s,lengthComputable:u!=null,[e?"download":"upload"]:!0};r(O)},n)},Gn=(r,e)=>{const n=r!=null;return[t=>e[0]({lengthComputable:n,total:r,loaded:t}),e[1]]},$n=r=>(...e)=>z.asap(()=>r(...e)),Zo=ve.hasStandardBrowserEnv?((r,e)=>n=>(n=new URL(n,ve.origin),r.protocol===n.protocol&&r.host===n.host&&(e||r.port===n.port)))(new URL(ve.origin),ve.navigator&&/(msie|trident)/i.test(ve.navigator.userAgent)):()=>!0,es=ve.hasStandardBrowserEnv?{write(r,e,n,t,i,s){const o=[r+"="+encodeURIComponent(e)];z.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),z.isString(t)&&o.push("path="+t),z.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ts(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ns(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function Vr(r,e,n){let t=!ts(e);return r&&(t||n==!1)?ns(r,e):e}const Vn=r=>r instanceof Se?{...r}:r;function ze(r,e){e=e||{};const n={};function t(h,m,O,w){return z.isPlainObject(h)&&z.isPlainObject(m)?z.merge.call({caseless:w},h,m):z.isPlainObject(m)?z.merge({},m):z.isArray(m)?m.slice():m}function i(h,m,O,w){if(z.isUndefined(m)){if(!z.isUndefined(h))return t(void 0,h,O,w)}else return t(h,m,O,w)}function s(h,m){if(!z.isUndefined(m))return t(void 0,m)}function o(h,m){if(z.isUndefined(m)){if(!z.isUndefined(h))return t(void 0,h)}else return t(void 0,m)}function u(h,m,O){if(O in e)return t(h,m);if(O in r)return t(void 0,h)}const d={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u,headers:(h,m,O)=>i(Vn(h),Vn(m),O,!0)};return z.forEach(Object.keys(Object.assign({},r,e)),function(m){const O=d[m]||i,w=O(r[m],e[m],m);z.isUndefined(w)&&O!==u||(n[m]=w)}),n}const Wr=r=>{const e=ze({},r);let{data:n,withXSRFToken:t,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:u}=e;e.headers=o=Se.from(o),e.url=Br(Vr(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),u&&o.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let d;if(z.isFormData(n)){if(ve.hasStandardBrowserEnv||ve.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((d=o.getContentType())!==!1){const[h,...m]=d?d.split(";").map(O=>O.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...m].join("; "))}}if(ve.hasStandardBrowserEnv&&(t&&z.isFunction(t)&&(t=t(e)),t||t!==!1&&Zo(e.url))){const h=i&&s&&es.read(s);h&&o.set(i,h)}return e},rs=typeof XMLHttpRequest<"u",is=rs&&function(r){return new Promise(function(n,t){const i=Wr(r);let s=i.data;const o=Se.from(i.headers).normalize();let{responseType:u,onUploadProgress:d,onDownloadProgress:h}=i,m,O,w,x,l;function E(){x&&x(),l&&l(),i.cancelToken&&i.cancelToken.unsubscribe(m),i.signal&&i.signal.removeEventListener("abort",m)}let R=new XMLHttpRequest;R.open(i.method.toUpperCase(),i.url,!0),R.timeout=i.timeout;function M(){if(!R)return;const y=Se.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),p={data:!u||u==="text"||u==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:y,config:r,request:R};$r(function(c){n(c),E()},function(c){t(c),E()},p),R=null}"onloadend"in R?R.onloadend=M:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(M)},R.onabort=function(){R&&(t(new te("Request aborted",te.ECONNABORTED,r,R)),R=null)},R.onerror=function(){t(new te("Network Error",te.ERR_NETWORK,r,R)),R=null},R.ontimeout=function(){let T=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const p=i.transitional||jr;i.timeoutErrorMessage&&(T=i.timeoutErrorMessage),t(new te(T,p.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,r,R)),R=null},s===void 0&&o.setContentType(null),"setRequestHeader"in R&&z.forEach(o.toJSON(),function(T,p){R.setRequestHeader(p,T)}),z.isUndefined(i.withCredentials)||(R.withCredentials=!!i.withCredentials),u&&u!=="json"&&(R.responseType=i.responseType),h&&([w,l]=_t(h,!0),R.addEventListener("progress",w)),d&&R.upload&&([O,x]=_t(d),R.upload.addEventListener("progress",O),R.upload.addEventListener("loadend",x)),(i.cancelToken||i.signal)&&(m=y=>{R&&(t(!y||y.type?new Xe(null,r,R):y),R.abort(),R=null)},i.cancelToken&&i.cancelToken.subscribe(m),i.signal&&(i.signal.aborted?m():i.signal.addEventListener("abort",m)));const b=Yo(i.url);if(b&&ve.protocols.indexOf(b)===-1){t(new te("Unsupported protocol "+b+":",te.ERR_BAD_REQUEST,r));return}R.send(s||null)})},os=(r,e)=>{const{length:n}=r=r?r.filter(Boolean):[];if(e||n){let t=new AbortController,i;const s=function(h){if(!i){i=!0,u();const m=h instanceof Error?h:this.reason;t.abort(m instanceof te?m:new Xe(m instanceof Error?m.message:m))}};let o=e&&setTimeout(()=>{o=null,s(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const u=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),r=null)};r.forEach(h=>h.addEventListener("abort",s));const{signal:d}=t;return d.unsubscribe=()=>z.asap(u),d}},ss=function*(r,e){let n=r.byteLength;if(n<e){yield r;return}let t=0,i;for(;t<n;)i=t+e,yield r.slice(t,i),t=i},as=async function*(r,e){for await(const n of us(r))yield*ss(n,e)},us=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:n,value:t}=await e.read();if(n)break;yield t}}finally{await e.cancel()}},Wn=(r,e,n,t)=>{const i=as(r,e);let s=0,o,u=d=>{o||(o=!0,t&&t(d))};return new ReadableStream({async pull(d){try{const{done:h,value:m}=await i.next();if(h){u(),d.close();return}let O=m.byteLength;if(n){let w=s+=O;n(w)}d.enqueue(new Uint8Array(m))}catch(h){throw u(h),h}},cancel(d){return u(d),i.return()}},{highWaterMark:2})},Vt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",zr=Vt&&typeof ReadableStream=="function",ls=Vt&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),Kr=(r,...e)=>{try{return!!r(...e)}catch{return!1}},cs=zr&&Kr(()=>{let r=!1;const e=new Request(ve.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),zn=64*1024,yn=zr&&Kr(()=>z.isReadableStream(new Response("").body)),Pt={stream:yn&&(r=>r.body)};Vt&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Pt[e]&&(Pt[e]=z.isFunction(r[e])?n=>n[e]():(n,t)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,t)})})})(new Response);const fs=async r=>{if(r==null)return 0;if(z.isBlob(r))return r.size;if(z.isSpecCompliantForm(r))return(await new Request(ve.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(z.isArrayBufferView(r)||z.isArrayBuffer(r))return r.byteLength;if(z.isURLSearchParams(r)&&(r=r+""),z.isString(r))return(await ls(r)).byteLength},ds=async(r,e)=>{const n=z.toFiniteNumber(r.getContentLength());return n??fs(e)},hs=Vt&&(async r=>{let{url:e,method:n,data:t,signal:i,cancelToken:s,timeout:o,onDownloadProgress:u,onUploadProgress:d,responseType:h,headers:m,withCredentials:O="same-origin",fetchOptions:w}=Wr(r);h=h?(h+"").toLowerCase():"text";let x=os([i,s&&s.toAbortSignal()],o),l;const E=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let R;try{if(d&&cs&&n!=="get"&&n!=="head"&&(R=await ds(m,t))!==0){let p=new Request(e,{method:"POST",body:t,duplex:"half"}),f;if(z.isFormData(t)&&(f=p.headers.get("content-type"))&&m.setContentType(f),p.body){const[c,a]=Gn(R,_t($n(d)));t=Wn(p.body,zn,c,a)}}z.isString(O)||(O=O?"include":"omit");const M="credentials"in Request.prototype;l=new Request(e,{...w,signal:x,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:t,duplex:"half",credentials:M?O:void 0});let b=await fetch(l,w);const y=yn&&(h==="stream"||h==="response");if(yn&&(u||y&&E)){const p={};["status","statusText","headers"].forEach(v=>{p[v]=b[v]});const f=z.toFiniteNumber(b.headers.get("content-length")),[c,a]=u&&Gn(f,_t($n(u),!0))||[];b=new Response(Wn(b.body,zn,c,()=>{a&&a(),E&&E()}),p)}h=h||"text";let T=await Pt[z.findKey(Pt,h)||"text"](b,r);return!y&&E&&E(),await new Promise((p,f)=>{$r(p,f,{data:T,headers:Se.from(b.headers),status:b.status,statusText:b.statusText,config:r,request:l})})}catch(M){throw E&&E(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,r,l),{cause:M.cause||M}):te.from(M,M&&M.code,r,l)}}),bn={http:xo,xhr:is,fetch:hs};z.forEach(bn,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const Kn=r=>`- ${r}`,ps=r=>z.isFunction(r)||r===null||r===!1,qr={getAdapter:r=>{r=z.isArray(r)?r:[r];const{length:e}=r;let n,t;const i={};for(let s=0;s<e;s++){n=r[s];let o;if(t=n,!ps(n)&&(t=bn[(o=String(n)).toLowerCase()],t===void 0))throw new te(`Unknown adapter '${o}'`);if(t)break;i[o||"#"+s]=t}if(!t){const s=Object.entries(i).map(([u,d])=>`adapter ${u} `+(d===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(Kn).join(`
`):" "+Kn(s[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return t},adapters:bn};function tn(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Xe(null,r)}function qn(r){return tn(r),r.headers=Se.from(r.headers),r.data=en.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),qr.getAdapter(r.adapter||ft.adapter)(r).then(function(t){return tn(r),t.data=en.call(r,r.transformResponse,t),t.headers=Se.from(t.headers),t},function(t){return Gr(t)||(tn(r),t&&t.response&&(t.response.data=en.call(r,r.transformResponse,t.response),t.response.headers=Se.from(t.response.headers))),Promise.reject(t)})}const Jr="1.10.0",Wt={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Wt[r]=function(t){return typeof t===r||"a"+(e<1?"n ":" ")+r}});const Jn={};Wt.transitional=function(e,n,t){function i(s,o){return"[Axios v"+Jr+"] Transitional option '"+s+"'"+o+(t?". "+t:"")}return(s,o,u)=>{if(e===!1)throw new te(i(o," has been removed"+(n?" in "+n:"")),te.ERR_DEPRECATED);return n&&!Jn[o]&&(Jn[o]=!0,console.warn(i(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(s,o,u):!0}};Wt.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function gs(r,e,n){if(typeof r!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const t=Object.keys(r);let i=t.length;for(;i-- >0;){const s=t[i],o=e[s];if(o){const u=r[s],d=u===void 0||o(u,s,r);if(d!==!0)throw new te("option "+s+" must be "+d,te.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new te("Unknown option "+s,te.ERR_BAD_OPTION)}}const It={assertOptions:gs,validators:Wt},_e=It.validators;let We=class{constructor(e){this.defaults=e||{},this.interceptors={request:new jn,response:new jn}}async request(e,n){try{return await this._request(e,n)}catch(t){if(t instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{t.stack?s&&!String(t.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+s):t.stack=s}catch{}}throw t}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=ze(this.defaults,n);const{transitional:t,paramsSerializer:i,headers:s}=n;t!==void 0&&It.assertOptions(t,{silentJSONParsing:_e.transitional(_e.boolean),forcedJSONParsing:_e.transitional(_e.boolean),clarifyTimeoutError:_e.transitional(_e.boolean)},!1),i!=null&&(z.isFunction(i)?n.paramsSerializer={serialize:i}:It.assertOptions(i,{encode:_e.function,serialize:_e.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),It.assertOptions(n,{baseUrl:_e.spelling("baseURL"),withXsrfToken:_e.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=s&&z.merge(s.common,s[n.method]);s&&z.forEach(["delete","get","head","post","put","patch","common"],l=>{delete s[l]}),n.headers=Se.concat(o,s);const u=[];let d=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(n)===!1||(d=d&&E.synchronous,u.unshift(E.fulfilled,E.rejected))});const h=[];this.interceptors.response.forEach(function(E){h.push(E.fulfilled,E.rejected)});let m,O=0,w;if(!d){const l=[qn.bind(this),void 0];for(l.unshift.apply(l,u),l.push.apply(l,h),w=l.length,m=Promise.resolve(n);O<w;)m=m.then(l[O++],l[O++]);return m}w=u.length;let x=n;for(O=0;O<w;){const l=u[O++],E=u[O++];try{x=l(x)}catch(R){E.call(this,R);break}}try{m=qn.call(this,x)}catch(l){return Promise.reject(l)}for(O=0,w=h.length;O<w;)m=m.then(h[O++],h[O++]);return m}getUri(e){e=ze(this.defaults,e);const n=Vr(e.baseURL,e.url,e.allowAbsoluteUrls);return Br(n,e.params,e.paramsSerializer)}};z.forEach(["delete","get","head","options"],function(e){We.prototype[e]=function(n,t){return this.request(ze(t||{},{method:e,url:n,data:(t||{}).data}))}});z.forEach(["post","put","patch"],function(e){function n(t){return function(s,o,u){return this.request(ze(u||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}We.prototype[e]=n(),We.prototype[e+"Form"]=n(!0)});let vs=class Yr{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const t=this;this.promise.then(i=>{if(!t._listeners)return;let s=t._listeners.length;for(;s-- >0;)t._listeners[s](i);t._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(u=>{t.subscribe(u),s=u}).then(i);return o.cancel=function(){t.unsubscribe(s)},o},e(function(s,o,u){t.reason||(t.reason=new Xe(s,o,u),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=t=>{e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Yr(function(i){e=i}),cancel:e}}};function ms(r){return function(n){return r.apply(null,n)}}function ys(r){return z.isObject(r)&&r.isAxiosError===!0}const On={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(On).forEach(([r,e])=>{On[e]=r});function Qr(r){const e=new We(r),n=Tr(We.prototype.request,e);return z.extend(n,We.prototype,e,{allOwnKeys:!0}),z.extend(n,e,null,{allOwnKeys:!0}),n.create=function(i){return Qr(ze(r,i))},n}const ce=Qr(ft);ce.Axios=We;ce.CanceledError=Xe;ce.CancelToken=vs;ce.isCancel=Gr;ce.VERSION=Jr;ce.toFormData=$t;ce.AxiosError=te;ce.Cancel=ce.CanceledError;ce.all=function(e){return Promise.all(e)};ce.spread=ms;ce.isAxiosError=ys;ce.mergeConfig=ze;ce.AxiosHeaders=Se;ce.formToJSON=r=>Hr(z.isHTMLForm(r)?new FormData(r):r);ce.getAdapter=qr.getAdapter;ce.HttpStatusCode=On;ce.default=ce;const{Axios:_l,AxiosError:Pl,CanceledError:Ll,isCancel:kl,CancelToken:Dl,VERSION:Nl,all:Ul,Cancel:Fl,isAxiosError:Bl,spread:jl,toFormData:Hl,AxiosHeaders:Gl,HttpStatusCode:$l,formToJSON:Vl,getAdapter:Wl,mergeConfig:zl}=ce;function bs(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function pe(r,e,n){return e=Je(e),Cs(r,Xr()?Reflect.construct(e,n||[],Je(r).constructor):e.apply(r,n))}function se(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Os(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,Es(t.key),t)}}function ae(r,e,n){return e&&Os(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Te(){return Te=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)({}).hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r},Te.apply(null,arguments)}function Cn(){return Cn=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,n){var t=Ss(r,e);if(t){var i=Object.getOwnPropertyDescriptor(t,e);return i.get?i.get.call(arguments.length<3?r:n):i.value}},Cn.apply(null,arguments)}function Je(r){return Je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Je(r)}function ge(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Sn(r,e)}function Xr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xr=function(){return!!r})()}function Cs(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bs(r)}function De(){De=function(){return e};var r,e={},n=Object.prototype,t=n.hasOwnProperty,i=Object.defineProperty||function(C,A,L){C[A]=L.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",d=s.toStringTag||"@@toStringTag";function h(C,A,L){return Object.defineProperty(C,A,{value:L,enumerable:!0,configurable:!0,writable:!0}),C[A]}try{h({},"")}catch{h=function(A,L,U){return A[L]=U}}function m(C,A,L,U){var B=A&&A.prototype instanceof M?A:M,$=Object.create(B.prototype),V=new P(U||[]);return i($,"_invoke",{value:g(C,L,V)}),$}function O(C,A,L){try{return{type:"normal",arg:C.call(A,L)}}catch(U){return{type:"throw",arg:U}}}e.wrap=m;var w="suspendedStart",x="suspendedYield",l="executing",E="completed",R={};function M(){}function b(){}function y(){}var T={};h(T,o,function(){return this});var p=Object.getPrototypeOf,f=p&&p(p(I([])));f&&f!==n&&t.call(f,o)&&(T=f);var c=y.prototype=M.prototype=Object.create(T);function a(C){["next","throw","return"].forEach(function(A){h(C,A,function(L){return this._invoke(A,L)})})}function v(C,A){function L(B,$,V,H){var _=O(C[B],C,$);if(_.type!=="throw"){var N=_.arg,F=N.value;return F&&typeof F=="object"&&t.call(F,"__await")?A.resolve(F.__await).then(function(j){L("next",j,V,H)},function(j){L("throw",j,V,H)}):A.resolve(F).then(function(j){N.value=j,V(N)},function(j){return L("throw",j,V,H)})}H(_.arg)}var U;i(this,"_invoke",{value:function(B,$){function V(){return new A(function(H,_){L(B,$,H,_)})}return U=U?U.then(V,V):V()}})}function g(C,A,L){var U=w;return function(B,$){if(U===l)throw Error("Generator is already running");if(U===E){if(B==="throw")throw $;return{value:r,done:!0}}for(L.method=B,L.arg=$;;){var V=L.delegate;if(V){var H=S(V,L);if(H){if(H===R)continue;return H}}if(L.method==="next")L.sent=L._sent=L.arg;else if(L.method==="throw"){if(U===w)throw U=E,L.arg;L.dispatchException(L.arg)}else L.method==="return"&&L.abrupt("return",L.arg);U=l;var _=O(C,A,L);if(_.type==="normal"){if(U=L.done?E:x,_.arg===R)continue;return{value:_.arg,done:L.done}}_.type==="throw"&&(U=E,L.method="throw",L.arg=_.arg)}}}function S(C,A){var L=A.method,U=C.iterator[L];if(U===r)return A.delegate=null,L==="throw"&&C.iterator.return&&(A.method="return",A.arg=r,S(C,A),A.method==="throw")||L!=="return"&&(A.method="throw",A.arg=new TypeError("The iterator does not provide a '"+L+"' method")),R;var B=O(U,C.iterator,A.arg);if(B.type==="throw")return A.method="throw",A.arg=B.arg,A.delegate=null,R;var $=B.arg;return $?$.done?(A[C.resultName]=$.value,A.next=C.nextLoc,A.method!=="return"&&(A.method="next",A.arg=r),A.delegate=null,R):$:(A.method="throw",A.arg=new TypeError("iterator result is not an object"),A.delegate=null,R)}function D(C){var A={tryLoc:C[0]};1 in C&&(A.catchLoc=C[1]),2 in C&&(A.finallyLoc=C[2],A.afterLoc=C[3]),this.tryEntries.push(A)}function k(C){var A=C.completion||{};A.type="normal",delete A.arg,C.completion=A}function P(C){this.tryEntries=[{tryLoc:"root"}],C.forEach(D,this),this.reset(!0)}function I(C){if(C||C===""){var A=C[o];if(A)return A.call(C);if(typeof C.next=="function")return C;if(!isNaN(C.length)){var L=-1,U=function B(){for(;++L<C.length;)if(t.call(C,L))return B.value=C[L],B.done=!1,B;return B.value=r,B.done=!0,B};return U.next=U}}throw new TypeError(typeof C+" is not iterable")}return b.prototype=y,i(c,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:b,configurable:!0}),b.displayName=h(y,d,"GeneratorFunction"),e.isGeneratorFunction=function(C){var A=typeof C=="function"&&C.constructor;return!!A&&(A===b||(A.displayName||A.name)==="GeneratorFunction")},e.mark=function(C){return Object.setPrototypeOf?Object.setPrototypeOf(C,y):(C.__proto__=y,h(C,d,"GeneratorFunction")),C.prototype=Object.create(c),C},e.awrap=function(C){return{__await:C}},a(v.prototype),h(v.prototype,u,function(){return this}),e.AsyncIterator=v,e.async=function(C,A,L,U,B){B===void 0&&(B=Promise);var $=new v(m(C,A,L,U),B);return e.isGeneratorFunction(A)?$:$.next().then(function(V){return V.done?V.value:$.next()})},a(c),h(c,d,"Generator"),h(c,o,function(){return this}),h(c,"toString",function(){return"[object Generator]"}),e.keys=function(C){var A=Object(C),L=[];for(var U in A)L.push(U);return L.reverse(),function B(){for(;L.length;){var $=L.pop();if($ in A)return B.value=$,B.done=!1,B}return B.done=!0,B}},e.values=I,P.prototype={constructor:P,reset:function(C){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(k),!C)for(var A in this)A.charAt(0)==="t"&&t.call(this,A)&&!isNaN(+A.slice(1))&&(this[A]=r)},stop:function(){this.done=!0;var C=this.tryEntries[0].completion;if(C.type==="throw")throw C.arg;return this.rval},dispatchException:function(C){if(this.done)throw C;var A=this;function L(_,N){return $.type="throw",$.arg=C,A.next=_,N&&(A.method="next",A.arg=r),!!N}for(var U=this.tryEntries.length-1;U>=0;--U){var B=this.tryEntries[U],$=B.completion;if(B.tryLoc==="root")return L("end");if(B.tryLoc<=this.prev){var V=t.call(B,"catchLoc"),H=t.call(B,"finallyLoc");if(V&&H){if(this.prev<B.catchLoc)return L(B.catchLoc,!0);if(this.prev<B.finallyLoc)return L(B.finallyLoc)}else if(V){if(this.prev<B.catchLoc)return L(B.catchLoc,!0)}else{if(!H)throw Error("try statement without catch or finally");if(this.prev<B.finallyLoc)return L(B.finallyLoc)}}}},abrupt:function(C,A){for(var L=this.tryEntries.length-1;L>=0;--L){var U=this.tryEntries[L];if(U.tryLoc<=this.prev&&t.call(U,"finallyLoc")&&this.prev<U.finallyLoc){var B=U;break}}B&&(C==="break"||C==="continue")&&B.tryLoc<=A&&A<=B.finallyLoc&&(B=null);var $=B?B.completion:{};return $.type=C,$.arg=A,B?(this.method="next",this.next=B.finallyLoc,R):this.complete($)},complete:function(C,A){if(C.type==="throw")throw C.arg;return C.type==="break"||C.type==="continue"?this.next=C.arg:C.type==="return"?(this.rval=this.arg=C.arg,this.method="return",this.next="end"):C.type==="normal"&&A&&(this.next=A),R},finish:function(C){for(var A=this.tryEntries.length-1;A>=0;--A){var L=this.tryEntries[A];if(L.finallyLoc===C)return this.complete(L.completion,L.afterLoc),k(L),R}},catch:function(C){for(var A=this.tryEntries.length-1;A>=0;--A){var L=this.tryEntries[A];if(L.tryLoc===C){var U=L.completion;if(U.type==="throw"){var B=U.arg;k(L)}return B}}throw Error("illegal catch attempt")},delegateYield:function(C,A,L){return this.delegate={iterator:I(C),resultName:A,nextLoc:L},this.method==="next"&&(this.arg=r),R}},e}function Sn(r,e){return Sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},Sn(r,e)}function Ss(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=Je(r))!==null;);return r}function As(r,e,n,t){var i=Cn(Je(r.prototype),e,n);return typeof i=="function"?function(s){return i.apply(n,s)}:i}function ws(r,e){if(typeof r!="object"||!r)return r;var n=r[Symbol.toPrimitive];if(n!==void 0){var t=n.call(r,e);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Es(r){var e=ws(r,"string");return typeof e=="symbol"?e:e+""}function ut(r){"@babel/helpers - typeof";return ut=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(r)}var zt=function(){function r(){se(this,r)}return ae(r,[{key:"listenForWhisper",value:function(n,t){return this.listen(".client-"+n,t)}},{key:"notification",value:function(n){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",n)}},{key:"stopListeningForWhisper",value:function(n,t){return this.stopListening(".client-"+n,t)}}])}();function Lt(r,e){var n={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.indexOf(t)<0&&(n[t]=r[t]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,t=Object.getOwnPropertySymbols(r);i<t.length;i++)e.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(r,t[i])&&(n[t[i]]=r[t[i]]);return n}function kt(r,e,n,t){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function u(m){try{h(t.next(m))}catch(O){o(O)}}function d(m){try{h(t.throw(m))}catch(O){o(O)}}function h(m){m.done?s(m.value):i(m.value).then(u,d)}h((t=t.apply(r,[])).next())})}var Mn=function(){function r(e){se(this,r),this.namespace=e}return ae(r,[{key:"format",value:function(n){return[".","\\"].includes(n.charAt(0))?n.substring(1):(this.namespace&&(n=this.namespace+"."+n),n.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(n){this.namespace=n}}])}(),_n=function(r){function e(n,t,i){var s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return se(this,e),s=pe(this,e),s._alertErrorListeners=function(u){u&&s.errorListeners.forEach(function(d){return d(u)})},s.name=t,s.ably=n,s.options=i,s.eventFormatter=new Mn(s.options.namespace),s.subscribedListeners=[],s.errorListeners=[],s.channel=n.channels.get(t),s.callbacks=new Map,o&&s.subscribe(),s}return ge(e,r),ae(e,[{key:"subscribe",value:function(){var t=this;this.channel.on(function(i){var s=i.previous,o=i.current,u=i.reason;s!=="attached"&&o=="attached"?t.subscribedListeners.forEach(function(d){return d()}):u&&t._alertErrorListeners(i)}),this.channel.attach(this._alertErrorListeners)}},{key:"unsubscribe",value:function(){this.channel.unsubscribe(),this.callbacks.clear(),this.unregisterError(),this.unregisterSubscribed(),this.channel.off(),this.channel.detach()}},{key:"listen",value:function(t,i){return this.callbacks.set(i,function(s){var o=s.data,u=Lt(s,["data"]);return i(o,u)}),this.channel.subscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this}},{key:"listenToAll",value:function(t){var i=this;return this.callbacks.set(t,function(s){var o=s.name,u=s.data,d=Lt(s,["name","data"]),h=i.options.namespace.replace(/\./g,"\\"),m=o.startsWith(h)?o.substring(h.length+1):"."+o;t(m,u,d)}),this.channel.subscribe(this.callbacks.get(t)),this}},{key:"stopListening",value:function(t,i){return i?(this.channel.unsubscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this.callbacks.delete(i)):this.channel.unsubscribe(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?(this.channel.unsubscribe(this.callbacks.get(t)),this.callbacks.delete(t)):this.channel.unsubscribe(),this}},{key:"subscribed",value:function(t){return this.subscribedListeners.push(t),this}},{key:"error",value:function(t){return this.errorListeners.push(t),this}},{key:"unregisterSubscribed",value:function(t){return t?this.subscribedListeners=this.subscribedListeners.filter(function(i){return i!=t}):this.subscribedListeners=[],this}},{key:"unregisterError",value:function(t){return t?this.errorListeners=this.errorListeners.filter(function(i){return i!=t}):this.errorListeners=[],this}}])}(zt),Rs=function(r){function e(n,t,i,s){var o;return se(this,e),o=pe(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.subscribe(),o}return ge(e,r),ae(e,[{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(_n),Zr=function(r){function e(n,t,i,s){var o;return se(this,e),o=pe(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.channel.on("attached",function(){return o.enter(o.presenceData,o._alertErrorListeners)}),o.subscribe(),o}return ge(e,r),ae(e,[{key:"unsubscribe",value:function(){this.leave(this.presenceData,this._alertErrorListeners),this.channel.presence.unsubscribe(),As(e,"unsubscribe",this)([])}},{key:"here",value:function(t){var i=this;return this.channel.presence.subscribe(["enter","update","leave"],function(){return i.channel.presence.get(function(s,o){return t(o.map(function(u){var d=u.data;return d}),s)})}),this}},{key:"joining",value:function(t){return this.channel.presence.subscribe(["enter","update"],function(i){var s=i.data,o=Lt(i,["data"]);t(s,o)}),this}},{key:"leaving",value:function(t){return this.channel.presence.subscribe("leave",function(i){var s=i.data,o=Lt(i,["data"]);t(s,o)}),this}},{key:"enter",value:function(t,i){return this.channel.presence.enter(t,i),this}},{key:"leave",value:function(t,i){return this.channel.presence.leave(t,i),this}},{key:"update",value:function(t,i){return this.channel.presence.update(t,i),this}},{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(_n),Ts=function(e){return e==null||e===void 0},ei=function(e){var n=e.split(".")[0],t=n.replace("-","+").replace("_","/"),i=JSON.parse(Yn(t)),s=e.split(".")[1],o=s.replace("-","+").replace("_","/"),u=JSON.parse(Yn(o));return{header:i,payload:u}},nn=function(e){var n=ei(e),t=n.payload;return{clientId:t["x-ably-clientId"],expires:t.exp*1e3,issued:t.iat*1e3,token:e}},Kt=(typeof window>"u"?"undefined":ut(window))==="object",Yn=function(e){var n=e.replace(/-/g,"+").replace(/_/g,"/"),t=e.length%4===0?"":"=".repeat(4-e.length%4),i=n+t;return Kt?atob(i):Buffer.from(i,"base64").toString()},xs=function(e){var n="";return Kt?n=btoa(e):n=Buffer.from(e).toString("base64"),n.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},Is=function(e){return e&&e.indexOf("http://")===0||e.indexOf("https://")===0},Ms=function(e){var n,t,i;if(!Is(e)&&typeof window<"u"){var s=(n=window==null?void 0:window.location)===null||n===void 0?void 0:n.hostname,o=(t=window==null?void 0:window.location)===null||t===void 0?void 0:t.port,u=(i=window==null?void 0:window.location)===null||i===void 0?void 0:i.protocol.replace(":","");if(s&&o&&u)return u+"://"+s+":"+o+e}return e},rn;function _s(r,e){rn||(rn=new Ably.Rest.Platform.Http),Kt?delete r.headers["Content-Length"]:r.method=r.method.toLowerCase(),rn.doUri(r.method,null,r.uri,r.headers,r.body,r.paramsIfNoHeaders||{},e)}var Ps=function(e){return new Promise(function(n,t){_s(e,function(i,s){if(i)t(i);else if(typeof s=="string")n(JSON.parse(s));else if(!Kt&&Buffer.isBuffer(s))try{n(JSON.parse(s.toString()))}catch{n(s)}else n(s)})})},Qn=!1,Ls=function(e,n){var t=e.channels.get("dummy");if(t.__proto__.authorizeChannel=n,Qn)return;var i=t.__proto__._attach;if(Ts(i)){console.warn("Failed to enable authorize for pre-attach, please check for right library version");return}function s(o,u,d){var h=this;if(!this.authorizing){this.authorizing=!0;var m=i.bind(this);this.authorizeChannel(this,function(O){if(h.authorizing=!1,O){d?d(O):console.error("channel ".concat(h.name," auth error => ").concat(O));return}else m(o,u,d)})}}t.__proto__._attach=s,Qn=!0},ks=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;se(this,r),this.execute=function(i){return new Promise(function(s,o){e.queue.run(function(){return kt(e,void 0,void 0,De().mark(function u(){var d,h,m;return De().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,w.next=3,i(this.cachedToken);case 3:d=w.sent,h=d.token,m=d.info,this.cachedToken=h,s({token:h,info:m}),w.next=13;break;case 10:w.prev=10,w.t0=w.catch(0),o(w.t0);case 13:case"end":return w.stop()}},u,this,[[0,10]])}))})})},this.request=function(i){return e.execute(function(s){return e.requestTokenFn(i,s)})},this.cachedToken=n,this.requestTokenFn=t,this.queue=new Ds}),Ds=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;se(this,r),this.canRunNext=function(){return e.running.length<e.count&&e.todo.length},this.run=function(i){return kt(e,void 0,void 0,De().mark(function s(){var o;return De().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:i&&this.todo.push(i);case 1:if(!this.canRunNext()){d.next=9;break}return o=this.todo.shift(),this.running.push(o),d.next=6,o();case 6:this.running.shift(),d.next=1;break;case 9:case"end":return d.stop()}},s,this)}))},this.total=n.length,this.todo=n,this.running=[],this.count=t}),Ns=ae(function r(e,n){var t=this;se(this,r),this.expiredAuthChannels=new Set,this.setExpired=function(d){return t.expiredAuthChannels.add(d)},this.isExpired=function(d){return t.expiredAuthChannels.has(d)},this.removeExpired=function(d){return t.expiredAuthChannels.delete(d)},this.options={queryTime:!0,useTokenAuth:!0,authCallback:function(h,m){return kt(t,void 0,void 0,De().mark(function O(){var w,x,l;return De().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.prev=0,R.next=3,this.authRequestExecuter.request(null);case 3:w=R.sent,x=w.token,l=nn(x),m(null,l),R.next=12;break;case 9:R.prev=9,R.t0=R.catch(0),m(R.t0,null);case 12:case"end":return R.stop()}},O,this,[[0,9]])}))},echoMessages:!1},this.requestToken=function(d,h){return kt(t,void 0,void 0,De().mark(function m(){var O,w;return De().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return O=JSON.stringify({channel_name:d,token:h}),w={uri:this.authEndpoint,method:"POST",headers:Te({Accept:"application/json","Content-Type":"application/json","Content-Length":O.length},this.authHeaders),body:O},l.next=4,Ps(w);case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},m,this)}))},this.ablyClient=function(){return t.ablyConnector.ably},this.existingToken=function(){return t.ablyClient().auth.tokenDetails},this.getChannel=function(d){return t.ablyConnector.channels[d]},this.enableAuthorizeBeforeChannelAttach=function(){var d=t.ablyClient();d.auth.getTimestamp(t.options.queryTime,function(){}),Ls(d,function(h,m){var O=h.name;if(O.startsWith("public:")){m(null);return}var w=t.existingToken();if(w&&!t.isExpired(O)){var x=ei(w.token).payload["x-ably-capability"],l=x.includes("".concat(O,'"'));if(l&&w.expires>d.auth.getTimestampUsingOffset()){m(null);return}}t.authRequestExecuter.request(O).then(function(E){var R=E.token,M=E.info,b=t.getChannel(O);t.setPresenceInfo(b,M),t.tryAuthorizeOnSameConnection(Te(Te({},t.options),{token:nn(R)}),function(y,T){y?m(y):(t.removeExpired(O),m(null))})}).catch(function(E){return m(E)})})},this.allowReconnectOnUserLogin=function(){var d=t.ablyClient().connection,h=function(O){O.reason.code==40102&&(d.off(h),console.warn("User login detected, re-connecting again!"),t.onClientIdChanged())};d.on("failed",h)},this.onClientIdChanged=function(){t.ablyClient().connect();for(var d=0,h=Object.values(t.ablyConnector.channels);d<h.length;d++){var m=h[d];m.channel.attach(m._alertErrorListeners)}},this.tryAuthorizeOnSameConnection=function(d,h){t.ablyClient().auth.authorize(null,d,h)},this.onChannelFailed=function(d){return function(h){var m;((m=h.reason)===null||m===void 0?void 0:m.code)==40160&&t.handleChannelAuthError(d)}},this.handleChannelAuthError=function(d){if(!d.skipAuth){var h=d.name;t.authRequestExecuter.request(h).then(function(m){var O=m.token,w=m.info;t.setPresenceInfo(d,w),t.tryAuthorizeOnSameConnection(Te(Te({},t.options),{token:nn(O)}),function(x,l){x?d._alertErrorListeners(x):(d.skipAuth=!0,d.channel.once("attached",function(){d.skipAuth=!1}),d.channel.attach(d._alertErrorListeners))})}).catch(function(m){return d._alertErrorListeners(m)})}},this.setPresenceInfo=function(d,h){d instanceof Zr&&(d.presenceData=h)},this.ablyConnector=e;var i=n.authEndpoint,s=n.auth.headers,o=n.token,u=n.requestTokenFn;this.authEndpoint=Ms(i),this.authHeaders=s,this.authRequestExecuter=new ks(o,u??this.requestToken)}),qt=function(r){function e(n,t,i){var s;return se(this,e),s=pe(this,e),s.name=t,s.pusher=n,s.options=i,s.eventFormatter=new Mn(s.options.namespace),s.subscribe(),s}return ge(e,r),ae(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"listenToAll",value:function(t){var i=this;return this.subscription.bind_global(function(s,o){if(!s.startsWith("pusher:")){var u=i.options.namespace.replace(/\./g,"\\"),d=s.startsWith(u)?s.substring(u.length+1):"."+s;t(d,o)}}),this}},{key:"stopListening",value:function(t,i){return i?this.subscription.unbind(this.eventFormatter.format(t),i):this.subscription.unbind(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?this.subscription.unbind_global(t):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(t){return this.on("pusher:subscription_succeeded",function(){t()}),this}},{key:"error",value:function(t){return this.on("pusher:subscription_error",function(i){t(i)}),this}},{key:"on",value:function(t,i){return this.subscription.bind(t,i),this}}])}(zt),Us=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(qt),Fs=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(qt),Bs=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"here",value:function(t){return this.on("pusher:subscription_succeeded",function(i){t(Object.keys(i.members).map(function(s){return i.members[s]}))}),this}},{key:"joining",value:function(t){return this.on("pusher:member_added",function(i){t(i.info)}),this}},{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}},{key:"leaving",value:function(t){return this.on("pusher:member_removed",function(i){t(i.info)}),this}}])}(qt),ti=function(r){function e(n,t,i){var s;return se(this,e),s=pe(this,e),s.events={},s.listeners={},s.name=t,s.socket=n,s.options=i,s.eventFormatter=new Mn(s.options.namespace),s.subscribe(),s}return ge(e,r),ae(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"stopListening",value:function(t,i){return this.unbindEvent(this.eventFormatter.format(t),i),this}},{key:"subscribed",value:function(t){return this.on("connect",function(i){t(i)}),this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){var s=this;return this.listeners[t]=this.listeners[t]||[],this.events[t]||(this.events[t]=function(o,u){s.name===o&&s.listeners[t]&&s.listeners[t].forEach(function(d){return d(u)})},this.socket.on(t,this.events[t])),this.listeners[t].push(i),this}},{key:"unbind",value:function(){var t=this;Object.keys(this.events).forEach(function(i){t.unbindEvent(i)})}},{key:"unbindEvent",value:function(t,i){this.listeners[t]=this.listeners[t]||[],i&&(this.listeners[t]=this.listeners[t].filter(function(s){return s!==i})),(!i||this.listeners[t].length===0)&&(this.events[t]&&(this.socket.removeListener(t,this.events[t]),delete this.events[t]),delete this.listeners[t])}}])}(zt),ni=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}}])}(ti),js=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"here",value:function(t){return this.on("presence:subscribed",function(i){t(i.map(function(s){return s.user_info}))}),this}},{key:"joining",value:function(t){return this.on("presence:joining",function(i){return t(i.user_info)}),this}},{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}},{key:"leaving",value:function(t){return this.on("presence:leaving",function(i){return t(i.user_info)}),this}}])}(ni),Dt=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(t,i){return this}},{key:"listenToAll",value:function(t){return this}},{key:"stopListening",value:function(t,i){return this}},{key:"subscribed",value:function(t){return this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){return this}}])}(zt),Xn=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"whisper",value:function(t,i){return this}}])}(Dt),Hs=function(r){function e(){return se(this,e),pe(this,e,arguments)}return ge(e,r),ae(e,[{key:"here",value:function(t){return this}},{key:"joining",value:function(t){return this}},{key:"whisper",value:function(t,i){return this}},{key:"leaving",value:function(t){return this}}])}(Dt),Jt=function(){function r(e){se(this,r),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(e),this.connect()}return ae(r,[{key:"setOptions",value:function(n){this.options=Te(this._defaultOptions,n);var t=this.csrfToken();return t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),t=this.options.bearerToken,t&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t),n}},{key:"csrfToken",value:function(){var n;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(n=document.querySelector('meta[name="csrf-token"]'))?n.getAttribute("content"):null}}])}(),Zn=function(r){function e(){var n;return se(this,e),n=pe(this,e,arguments),n.channels={},n}return ge(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new qt(this.pusher,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new Us(this.pusher,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"encryptedPrivateChannel",value:function(t){return this.channels["private-encrypted-"+t]||(this.channels["private-encrypted-"+t]=new Fs(this.pusher,"private-encrypted-"+t,this.options)),this.channels["private-encrypted-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new Bs(this.pusher,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"private-encrypted-"+t,"presence-"+t];s.forEach(function(o,u){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}])}(Jt),Gs=function(r){function e(){var n;return se(this,e),n=pe(this,e,arguments),n.channels={},n}return ge(e,r),ae(e,[{key:"connect",value:function(){var t=this,i=this.getSocketIO();return this.socket=i(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(t.channels).forEach(function(s){s.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new ti(this.socket,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new ni(this.socket,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new js(this.socket,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"presence-"+t];s.forEach(function(o){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}])}(Jt),$s=function(r){function e(){var n;return se(this,e),n=pe(this,e,arguments),n.channels={},n}return ge(e,r),ae(e,[{key:"connect",value:function(){}},{key:"listen",value:function(t,i,s){return new Dt}},{key:"channel",value:function(t){return new Dt}},{key:"privateChannel",value:function(t){return new Xn}},{key:"encryptedPrivateChannel",value:function(t){return new Xn}},{key:"presenceChannel",value:function(t){return new Hs}},{key:"leave",value:function(t){}},{key:"leaveChannel",value:function(t){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}])}(Jt),ri=function(r){function e(){var n;return se(this,e),n=pe(this,e,arguments),n.channels={},n}return ge(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.ably=this.options.client:(this.ablyAuth=new Ns(this,this.options),this.options.agents||(this.options.agents={}),this.options.agents["laravel-echo"]=e.LIB_VERSION,this.ably=new Ably.Realtime(Te(Te({},this.ablyAuth.options),this.options)),this.ablyAuth.enableAuthorizeBeforeChannelAttach(),this.ablyAuth.allowReconnectOnUserLogin())}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){var i="public:".concat(t);return this.channels[i]||(this.channels[i]=new _n(this.ably,i,this.options)),this.channels[i]}},{key:"privateChannel",value:function(t){var i="private:".concat(t);return this.channels[i]||(this.channels[i]=new Rs(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"presenceChannel",value:function(t){var i="presence:".concat(t);return this.channels[i]||(this.channels[i]=new Zr(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"leave",value:function(t){var i=this,s=["public:".concat(t),"private:".concat(t),"presence:".concat(t)];s.forEach(function(o,u){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){if(t.indexOf("public:")!==0&&t.indexOf("private:")!==0&&t.indexOf("presence:")!==0)throw new Error("Error leaving ".concat(t,', name should be prefixed with either "public:", "private:" or "presence:"'));this.channels[t]&&(this.channels[t].unsubscribe(),this.ablyAuth.setExpired(t),delete this.channels[t])}},{key:"socketId",value:function(){var t,i={connectionKey:this.ably.connection.key,clientId:(t=this.ably.auth.clientId)!==null&&t!==void 0?t:null};return xs(JSON.stringify(i))}},{key:"disconnect",value:function(){this.ably.close()}}])}(Jt);ri.LIB_VERSION="1.0.6";var Kl=function(){function r(e){se(this,r),this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return ae(r,[{key:"channel",value:function(n){return this.connector.channel(n)}},{key:"connect",value:function(){if(this.options.broadcaster=="ably")this.connector=new ri(this.options);else if(this.options.broadcaster=="reverb")this.connector=new Zn(Te(Te({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new Zn(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new Gs(this.options);else if(this.options.broadcaster=="null")this.connector=new $s(this.options);else if(typeof this.options.broadcaster=="function")this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(ut(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(n){return this.connector.presenceChannel(n)}},{key:"leave",value:function(n){this.connector.leave(n)}},{key:"leaveChannel",value:function(n){this.connector.leaveChannel(n)}},{key:"leaveAllChannels",value:function(){for(var n in this.connector.channels)this.leaveChannel(n)}},{key:"listen",value:function(n,t,i){return this.connector.listen(n,t,i)}},{key:"private",value:function(n){return this.connector.privateChannel(n)}},{key:"encryptedPrivate",value:function(n){return this.connector.encryptedPrivateChannel(n)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":ut(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var n=this;Vue.http.interceptors.push(function(t,i){n.socketId()&&t.headers.set("X-Socket-ID",n.socketId()),i()})}},{key:"registerAxiosRequestInterceptor",value:function(){var n=this;axios.interceptors.request.use(function(t){return n.socketId()&&(t.headers["X-Socket-Id"]=n.socketId()),t})}},{key:"registerjQueryAjaxSetup",value:function(){var n=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(t,i,s){n.socketId()&&s.setRequestHeader("X-Socket-Id",n.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var n=this;document.addEventListener("turbo:before-fetch-request",function(t){t.detail.fetchOptions.headers["X-Socket-Id"]=n.socketId()})}}])}(),dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pn(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ii={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(r,e){(function(t,i){r.exports=i()})(window,function(){return function(n){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=t,i.d=function(s,o,u){i.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:u})},i.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,o){if(o&1&&(s=i(s)),o&8||o&4&&typeof s=="object"&&s&&s.__esModule)return s;var u=Object.create(null);if(i.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:s}),o&2&&typeof s!="string")for(var d in s)i.d(u,d,(function(h){return s[h]}).bind(null,d));return u},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=42)}([function(n,t,i){i.r(t),i.d(t,"__extends",function(){return o}),i.d(t,"__assign",function(){return u}),i.d(t,"__rest",function(){return d}),i.d(t,"__decorate",function(){return h}),i.d(t,"__param",function(){return m}),i.d(t,"__metadata",function(){return O}),i.d(t,"__awaiter",function(){return w}),i.d(t,"__generator",function(){return x}),i.d(t,"__createBinding",function(){return l}),i.d(t,"__exportStar",function(){return E}),i.d(t,"__values",function(){return R}),i.d(t,"__read",function(){return M}),i.d(t,"__spread",function(){return b}),i.d(t,"__spreadArrays",function(){return y}),i.d(t,"__spreadArray",function(){return T}),i.d(t,"__await",function(){return p}),i.d(t,"__asyncGenerator",function(){return f}),i.d(t,"__asyncDelegator",function(){return c}),i.d(t,"__asyncValues",function(){return a}),i.d(t,"__makeTemplateObject",function(){return v}),i.d(t,"__importStar",function(){return S}),i.d(t,"__importDefault",function(){return D}),i.d(t,"__classPrivateFieldGet",function(){return k}),i.d(t,"__classPrivateFieldSet",function(){return P});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var s=function(I,C){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,L){A.__proto__=L}||function(A,L){for(var U in L)Object.prototype.hasOwnProperty.call(L,U)&&(A[U]=L[U])},s(I,C)};function o(I,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");s(I,C);function A(){this.constructor=I}I.prototype=C===null?Object.create(C):(A.prototype=C.prototype,new A)}var u=function(){return u=Object.assign||function(C){for(var A,L=1,U=arguments.length;L<U;L++){A=arguments[L];for(var B in A)Object.prototype.hasOwnProperty.call(A,B)&&(C[B]=A[B])}return C},u.apply(this,arguments)};function d(I,C){var A={};for(var L in I)Object.prototype.hasOwnProperty.call(I,L)&&C.indexOf(L)<0&&(A[L]=I[L]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var U=0,L=Object.getOwnPropertySymbols(I);U<L.length;U++)C.indexOf(L[U])<0&&Object.prototype.propertyIsEnumerable.call(I,L[U])&&(A[L[U]]=I[L[U]]);return A}function h(I,C,A,L){var U=arguments.length,B=U<3?C:L===null?L=Object.getOwnPropertyDescriptor(C,A):L,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(I,C,A,L);else for(var V=I.length-1;V>=0;V--)($=I[V])&&(B=(U<3?$(B):U>3?$(C,A,B):$(C,A))||B);return U>3&&B&&Object.defineProperty(C,A,B),B}function m(I,C){return function(A,L){C(A,L,I)}}function O(I,C){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(I,C)}function w(I,C,A,L){function U(B){return B instanceof A?B:new A(function($){$(B)})}return new(A||(A=Promise))(function(B,$){function V(N){try{_(L.next(N))}catch(F){$(F)}}function H(N){try{_(L.throw(N))}catch(F){$(F)}}function _(N){N.done?B(N.value):U(N.value).then(V,H)}_((L=L.apply(I,C||[])).next())})}function x(I,C){var A={label:0,sent:function(){if(B[0]&1)throw B[1];return B[1]},trys:[],ops:[]},L,U,B,$;return $={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function V(_){return function(N){return H([_,N])}}function H(_){if(L)throw new TypeError("Generator is already executing.");for(;A;)try{if(L=1,U&&(B=_[0]&2?U.return:_[0]?U.throw||((B=U.return)&&B.call(U),0):U.next)&&!(B=B.call(U,_[1])).done)return B;switch(U=0,B&&(_=[_[0]&2,B.value]),_[0]){case 0:case 1:B=_;break;case 4:return A.label++,{value:_[1],done:!1};case 5:A.label++,U=_[1],_=[0];continue;case 7:_=A.ops.pop(),A.trys.pop();continue;default:if(B=A.trys,!(B=B.length>0&&B[B.length-1])&&(_[0]===6||_[0]===2)){A=0;continue}if(_[0]===3&&(!B||_[1]>B[0]&&_[1]<B[3])){A.label=_[1];break}if(_[0]===6&&A.label<B[1]){A.label=B[1],B=_;break}if(B&&A.label<B[2]){A.label=B[2],A.ops.push(_);break}B[2]&&A.ops.pop(),A.trys.pop();continue}_=C.call(I,A)}catch(N){_=[6,N],U=0}finally{L=B=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}var l=Object.create?function(I,C,A,L){L===void 0&&(L=A),Object.defineProperty(I,L,{enumerable:!0,get:function(){return C[A]}})}:function(I,C,A,L){L===void 0&&(L=A),I[L]=C[A]};function E(I,C){for(var A in I)A!=="default"&&!Object.prototype.hasOwnProperty.call(C,A)&&l(C,I,A)}function R(I){var C=typeof Symbol=="function"&&Symbol.iterator,A=C&&I[C],L=0;if(A)return A.call(I);if(I&&typeof I.length=="number")return{next:function(){return I&&L>=I.length&&(I=void 0),{value:I&&I[L++],done:!I}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")}function M(I,C){var A=typeof Symbol=="function"&&I[Symbol.iterator];if(!A)return I;var L=A.call(I),U,B=[],$;try{for(;(C===void 0||C-- >0)&&!(U=L.next()).done;)B.push(U.value)}catch(V){$={error:V}}finally{try{U&&!U.done&&(A=L.return)&&A.call(L)}finally{if($)throw $.error}}return B}function b(){for(var I=[],C=0;C<arguments.length;C++)I=I.concat(M(arguments[C]));return I}function y(){for(var I=0,C=0,A=arguments.length;C<A;C++)I+=arguments[C].length;for(var L=Array(I),U=0,C=0;C<A;C++)for(var B=arguments[C],$=0,V=B.length;$<V;$++,U++)L[U]=B[$];return L}function T(I,C,A){if(A||arguments.length===2)for(var L=0,U=C.length,B;L<U;L++)(B||!(L in C))&&(B||(B=Array.prototype.slice.call(C,0,L)),B[L]=C[L]);return I.concat(B||Array.prototype.slice.call(C))}function p(I){return this instanceof p?(this.v=I,this):new p(I)}function f(I,C,A){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var L=A.apply(I,C||[]),U,B=[];return U={},$("next"),$("throw"),$("return"),U[Symbol.asyncIterator]=function(){return this},U;function $(j){L[j]&&(U[j]=function(W){return new Promise(function(J,Y){B.push([j,W,J,Y])>1||V(j,W)})})}function V(j,W){try{H(L[j](W))}catch(J){F(B[0][3],J)}}function H(j){j.value instanceof p?Promise.resolve(j.value.v).then(_,N):F(B[0][2],j)}function _(j){V("next",j)}function N(j){V("throw",j)}function F(j,W){j(W),B.shift(),B.length&&V(B[0][0],B[0][1])}}function c(I){var C,A;return C={},L("next"),L("throw",function(U){throw U}),L("return"),C[Symbol.iterator]=function(){return this},C;function L(U,B){C[U]=I[U]?function($){return(A=!A)?{value:p(I[U]($)),done:U==="return"}:B?B($):$}:B}}function a(I){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C=I[Symbol.asyncIterator],A;return C?C.call(I):(I=typeof R=="function"?R(I):I[Symbol.iterator](),A={},L("next"),L("throw"),L("return"),A[Symbol.asyncIterator]=function(){return this},A);function L(B){A[B]=I[B]&&function($){return new Promise(function(V,H){$=I[B]($),U(V,H,$.done,$.value)})}}function U(B,$,V,H){Promise.resolve(H).then(function(_){B({value:_,done:V})},$)}}function v(I,C){return Object.defineProperty?Object.defineProperty(I,"raw",{value:C}):I.raw=C,I}var g=Object.create?function(I,C){Object.defineProperty(I,"default",{enumerable:!0,value:C})}:function(I,C){I.default=C};function S(I){if(I&&I.__esModule)return I;var C={};if(I!=null)for(var A in I)A!=="default"&&Object.prototype.hasOwnProperty.call(I,A)&&l(C,I,A);return g(C,I),C}function D(I){return I&&I.__esModule?I:{default:I}}function k(I,C,A,L){if(A==="a"&&!L)throw new TypeError("Private accessor was defined without a getter");if(typeof C=="function"?I!==C||!L:!C.has(I))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?L:A==="a"?L.call(I):L?L.value:C.get(I)}function P(I,C,A,L,U){if(L==="m")throw new TypeError("Private method is not writable");if(L==="a"&&!U)throw new TypeError("Private accessor was defined without a setter");if(typeof C=="function"?I!==C||!U:!C.has(I))throw new TypeError("Cannot write private member to an object whose class did not declare it");return L==="a"?U.call(I,A):U?U.value=A:C.set(I,A),A}},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.allToUpperCase=t.allToLowerCase=t.encodeBody=t.decodeBody=t.Format=t.promisify=t.trim=t.arrChooseN=t.randomHexString=t.randomString=t.cheapRandStr=t.dataSizeBytes=t.inspectBody=t.inspectError=t.isErrorInfoOrPartialErrorInfo=t.now=t.parseQueryString=t.toQueryString=t.arrPopRandomElement=t.defaultPostHeaders=t.defaultGetHeaders=t.allSame=t.arrEvery=t.arrFilter=t.arrMap=t.safeArrForEach=t.arrForEach=t.forInOwnNonNullProperties=t.valuesArray=t.keysArray=t.arrWithoutValue=t.arrDeleteValue=t.arrIn=t.arrIndexOf=t.arrSubtract=t.arrIntersectOb=t.arrIntersect=t.intersect=t.containsValue=t.inherits=t.prototypicalClone=t.shallowClone=t.isEmptyArg=t.isOnlyPropIn=t.isEmpty=t.isObject=t.ensureArray=t.isArray=t.copy=t.mixin=void 0,t.arrEquals=t.toBase64=t.matchDerivedChannel=t.shallowEquals=t.getGlobalObject=t.getRetryTime=t.getJitterCoefficient=t.getBackoffCoefficient=void 0;var o=i(0),u=o.__importDefault(i(3)),d=o.__importStar(i(8)),h=o.__importDefault(i(4)),m=i(11),O=i(31);function w(G){return Math.floor(Math.random()*G.length)}function x(G){for(var K=[],q=1;q<arguments.length;q++)K[q-1]=arguments[q];for(var Z=0;Z<K.length;Z++){var ne=K[Z];if(!ne)break;var be=Object.prototype.hasOwnProperty;for(var Ze in ne)(!be||be.call(ne,Ze))&&(G[Ze]=ne[Ze])}return G}t.mixin=x;function l(G){return x({},G)}t.copy=l,t.isArray=Array.isArray||function(G){return Object.prototype.toString.call(G)=="[object Array]"};function E(G){return y(G)?[]:(0,t.isArray)(G)?G:[G]}t.ensureArray=E;function R(G){return Object.prototype.toString.call(G)=="[object Object]"}t.isObject=R;function M(G){for(var K in G)return!1;return!0}t.isEmpty=M;function b(G,K){for(var q in G)if(q!==K)return!1;return!0}t.isOnlyPropIn=b;function y(G){return G==null}t.isEmptyArg=y;function T(G){var K=new Object;for(var q in G)K[q]=G[q];return K}t.shallowClone=T;function p(G,K){var q=function(){function ne(){}return ne}();q.prototype=G;var Z=new q;return K&&x(Z,K),Z}t.prototypicalClone=p;var f=function(G,K){if(u.default.Config.inherits){u.default.Config.inherits(G,K);return}G.super_=K,G.prototype=p(K.prototype,{constructor:G})};t.inherits=f;function c(G,K){for(var q in G)if(G[q]==K)return!0;return!1}t.containsValue=c;function a(G,K){return(0,t.isArray)(K)?v(G,K):g(G,K)}t.intersect=a;function v(G,K){for(var q=[],Z=0;Z<G.length;Z++){var ne=G[Z];(0,t.arrIndexOf)(K,ne)!=-1&&q.push(ne)}return q}t.arrIntersect=v;function g(G,K){for(var q=[],Z=0;Z<G.length;Z++){var ne=G[Z];ne in K&&q.push(ne)}return q}t.arrIntersectOb=g;function S(G,K){for(var q=[],Z=0;Z<G.length;Z++){var ne=G[Z];(0,t.arrIndexOf)(K,ne)==-1&&q.push(ne)}return q}t.arrSubtract=S,t.arrIndexOf=Array.prototype.indexOf?function(G,K,q){return G.indexOf(K,q)}:function(G,K,q){q=q||0;for(var Z=G.length;q<Z;q++)if(G[q]===K)return q;return-1};function D(G,K){return(0,t.arrIndexOf)(G,K)!==-1}t.arrIn=D;function k(G,K){var q=(0,t.arrIndexOf)(G,K),Z=q!=-1;return Z&&G.splice(q,1),Z}t.arrDeleteValue=k;function P(G,K){var q=G.slice();return k(q,K),q}t.arrWithoutValue=P;function I(G,K){var q=[];for(var Z in G)K&&!Object.prototype.hasOwnProperty.call(G,Z)||q.push(Z);return q}t.keysArray=I;function C(G,K){var q=[];for(var Z in G)K&&!Object.prototype.hasOwnProperty.call(G,Z)||q.push(G[Z]);return q}t.valuesArray=C;function A(G,K){for(var q in G)Object.prototype.hasOwnProperty.call(G,q)&&G[q]&&K(q)}t.forInOwnNonNullProperties=A,t.arrForEach=Array.prototype.forEach?function(G,K){G.forEach(K)}:function(G,K){for(var q=G.length,Z=0;Z<q;Z++)K(G[Z],Z,G)};function L(G,K){return(0,t.arrForEach)(G.slice(),K)}t.safeArrForEach=L,t.arrMap=Array.prototype.map?function(G,K){return G.map(K)}:function(G,K){for(var q=[],Z=G.length,ne=0;ne<Z;ne++)q.push(K(G[ne],ne,G));return q},t.arrFilter=Array.prototype.filter?function(G,K){return G.filter(K)}:function(G,K){for(var q=[],Z=G.length,ne=0;ne<Z;ne++)K(G[ne])&&q.push(G[ne]);return q},t.arrEvery=Array.prototype.every?function(G,K){return G.every(K)}:function(G,K){for(var q=G.length,Z=0;Z<q;Z++)if(!K(G[Z],Z,G))return!1;return!0};function U(G,K){if(G.length===0)return!0;var q=G[0][K];return(0,t.arrEvery)(G,function(Z){return Z[K]===q})}t.allSame=U;var B={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function $(G,K){var q=B[K||ie.json];return{accept:q,"X-Ably-Version":d.default.protocolVersion.toString(),"Ably-Agent":(0,d.getAgentString)(G)}}t.defaultGetHeaders=$;function V(G,K){var q,Z=q=B[K||ie.json];return{accept:Z,"content-type":q,"X-Ably-Version":d.default.protocolVersion.toString(),"Ably-Agent":(0,d.getAgentString)(G)}}t.defaultPostHeaders=V;function H(G){return G.splice(w(G),1)[0]}t.arrPopRandomElement=H;function _(G){var K=[];if(G)for(var q in G)K.push(encodeURIComponent(q)+"="+encodeURIComponent(G[q]));return K.length?"?"+K.join("&"):""}t.toQueryString=_;function N(G){for(var K,q=/([^?&=]+)=?([^&]*)/g,Z={};K=q.exec(G);)Z[decodeURIComponent(K[1])]=decodeURIComponent(K[2]);return Z}t.parseQueryString=N,t.now=Date.now||function(){return new Date().getTime()};function F(G){return typeof G=="object"&&G!==null&&(G.constructor.name=="ErrorInfo"||G.constructor.name=="PartialErrorInfo")}t.isErrorInfoOrPartialErrorInfo=F;function j(G){var K,q;return G instanceof Error||((K=G==null?void 0:G.constructor)===null||K===void 0?void 0:K.name)==="ErrorInfo"||((q=G==null?void 0:G.constructor)===null||q===void 0?void 0:q.name)==="PartialErrorInfo"?G.toString():u.default.Config.inspect(G)}t.inspectError=j;function W(G){return u.default.BufferUtils.isBuffer(G)?G.toString():typeof G=="string"?G:u.default.Config.inspect(G)}t.inspectBody=W;function J(G){if(u.default.BufferUtils.isBuffer(G))return u.default.BufferUtils.byteLength(G);if(typeof G=="string")return u.default.Config.stringByteSize(G);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof G)}t.dataSizeBytes=J;function Y(){return String(Math.random()).substr(2)}t.cheapRandStr=Y;var X=function(G){if(u.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(G);return u.default.Config.getRandomValues(K),u.default.BufferUtils.base64Encode(K)}for(var q=u.default.BufferUtils.base64CharSet,Z=Math.round(G*4/3),ne="",be=0;be<Z;be++)ne+=q[w(q)];return ne};t.randomString=X;var ee=function(G){if(u.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(G);return u.default.Config.getRandomValues(K),u.default.BufferUtils.hexEncode(K)}for(var q=u.default.BufferUtils.hexCharSet,Z=G*2,ne="",be=0;be<Z;be++)ne+=q[w(q)];return ne};t.randomHexString=ee;function re(G,K){for(var q=Math.min(K,G.length),Z=G.slice(),ne=[],be=0;be<q;be++)ne.push(H(Z));return ne}t.arrChooseN=re,t.trim=String.prototype.trim?function(G){return G.trim()}:function(G){return G.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Q(G,K,q){return new Promise(function(Z,ne){G[K].apply(G,o.__spreadArray(o.__spreadArray([],q,!1),[function(be,Ze){be?ne(be):Z(Ze)}],!1))})}t.promisify=Q;var ie;(function(G){G.msgpack="msgpack",G.json="json"})(ie=t.Format||(t.Format={}));function de(G,K){return K=="msgpack"?u.default.Config.msgpack.decode(G):JSON.parse(String(G))}t.decodeBody=de;function me(G,K){return K=="msgpack"?u.default.Config.msgpack.encode(G,!0):JSON.stringify(G)}t.encodeBody=me;function fe(G){return G.map(function(K){return K&&K.toLowerCase()})}t.allToLowerCase=fe;function Le(G){return G.map(function(K){return K&&K.toUpperCase()})}t.allToUpperCase=Le;function pt(G){return Math.min((G+2)/3,2)}t.getBackoffCoefficient=pt;function xe(){return 1-Math.random()*.2}t.getJitterCoefficient=xe;function gt(G,K){return G*pt(K)*xe()}t.getRetryTime=gt;function Qt(){return s||(typeof window<"u"?window:self)}t.getGlobalObject=Qt;function Xt(G,K){return Object.keys(G).every(function(q){return G[q]===K[q]})&&Object.keys(K).every(function(q){return K[q]===G[q]})}t.shallowEquals=Xt;function Ri(G){var K=/^(\[([^?]*)(?:(.*))\])?(.+)$/,q=G.match(K);if(!q||!q.length||q.length<5)throw new h.default("regex match failed",400,40010);if(q[2])throw new h.default("cannot use a derived option with a ".concat(q[2]," channel"),400,40010);return{qualifierParam:q[3]||"",channelName:q[4]}}t.matchDerivedChannel=Ri;function Ti(G){return u.default.Config.createHmac?Buffer.from(G,"ascii").toString("base64"):(0,m.stringify)((0,O.parse)(G))}t.toBase64=Ti;function xi(G,K){return G.length===K.length&&(0,t.arrEvery)(G,function(q,Z){return q===K[Z]})}t.arrEquals=xi}).call(this,i(13))},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),u=o.__importDefault(i(3)),d=s||(typeof window<"u"?window:self),h;(function(l){l[l.None=0]="None",l[l.Error=1]="Error",l[l.Major=2]="Major",l[l.Minor=3]="Minor",l[l.Micro=4]="Micro"})(h||(h={}));function m(l,E){return"".concat(l).padStart(E?3:2,"0")}function O(l){return u.default.Config.logTimestamps?function(E){var R=new Date;l(m(R.getHours())+":"+m(R.getMinutes())+":"+m(R.getSeconds())+"."+m(R.getMilliseconds(),1)+" "+E)}:l}var w=function(){var l,E,R,M;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((E=(l=d==null?void 0:d.console)===null||l===void 0?void 0:l.log)===null||E===void 0?void 0:E.apply)=="function"?(R=function(){for(var b=[],y=0;y<arguments.length;y++)b[y]=arguments[y];console.log.apply(console,b)},M=console.warn?function(){for(var b=[],y=0;y<arguments.length;y++)b[y]=arguments[y];console.warn.apply(console,b)}:R):d!=null&&d.console.log?R=M=function(){Function.prototype.apply.call(console.log,console,arguments)}:R=M=function(){},[R,M].map(O)},x=function(){function l(){l.logLevel=l.LOG_DEFAULT}return l.initLogHandlers=function(){var E=w(),R=E[0],M=E[1];this.logHandler=R,this.logErrorHandler=M},l.renamedClientOption=function(E,R){l.deprecationWarning("The `".concat(E,"` client option has been renamed to `").concat(R,"`. Please update your code to use `").concat(R,"` instead. `").concat(E,"` will be removed in a future version."))},l.renamedMethod=function(E,R,M){l.deprecationWarning("`".concat(E,"`s `").concat(R,"` method has been renamed to `").concat(M,"`. Please update your code to use `").concat(M,"` instead. `").concat(R,"` will be removed in a future version."))},l.deprecationWarning=function(E){l.shouldLog(h.Error)&&l.logErrorHandler("Ably: Deprecation warning - ".concat(E))},l.logLevel=h.Error,l.LOG_NONE=h.None,l.LOG_ERROR=h.Error,l.LOG_MAJOR=h.Major,l.LOG_MINOR=h.Minor,l.LOG_MICRO=h.Micro,l.LOG_DEFAULT=h.Error,l.LOG_DEBUG=h.Micro,l.logAction=function(E,R,M){l.shouldLog(E)&&(E===h.Error?l.logErrorHandler:l.logHandler)("Ably: "+R+": "+M)},l.deprecated=function(E,R){l.deprecationWarning("".concat(E," is deprecated and will be removed in a future version. ").concat(R))},l.shouldLog=function(E){return E<=l.logLevel},l.setLog=function(E,R){E!==void 0&&(l.logLevel=E),R!==void 0&&(l.logHandler=l.logErrorHandler=R)},l}();t.default=x}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(){}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartialErrorInfo=void 0;var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1));function d(O){var w="["+O.constructor.name;return O.message&&(w+=": "+O.message),O.statusCode&&(w+="; statusCode="+O.statusCode),O.code&&(w+="; code="+O.code),O.cause&&(w+="; cause="+u.inspectError(O.cause)),O.href&&!(O.message&&O.message.indexOf("help.ably.io")>-1)&&(w+="; see "+O.href+" "),w+="]",w}var h=function(O){s.__extends(w,O);function w(x,l,E,R){var M=O.call(this,x)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(M,w.prototype),M.code=l,M.statusCode=E,M.cause=R,M}return w.prototype.toString=function(){return d(this)},w.fromValues=function(x){var l=x,E=l.message,R=l.code,M=l.statusCode;if(typeof E!="string"||typeof R!="number"||typeof M!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(x));var b=Object.assign(new w(E,R,M),x);return b.code&&!b.href&&(b.href="https://help.ably.io/error/"+b.code),b},w}(Error);t.default=h;var m=function(O){s.__extends(w,O);function w(x,l,E,R){var M=O.call(this,x)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(M,w.prototype),M.code=l,M.statusCode=E,M.cause=R,M}return w.prototype.toString=function(){return d(this)},w}(Error);t.PartialErrorInfo=m},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var o=s,u=o.lib,d=u.WordArray,h=d.init,m=d.init=function(O){if(O instanceof ArrayBuffer&&(O=new Uint8Array(O)),(O instanceof Int8Array||typeof Uint8ClampedArray<"u"&&O instanceof Uint8ClampedArray||O instanceof Int16Array||O instanceof Uint16Array||O instanceof Int32Array||O instanceof Uint32Array||O instanceof Float32Array||O instanceof Float64Array)&&(O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength)),O instanceof Uint8Array){for(var w=O.byteLength,x=[],l=0;l<w;l++)x[l>>>2]|=O[l]<<24-l%4*8;h.call(this,x,w)}else h.apply(this,arguments)};m.prototype=d}}(),s.lib.WordArray})},function(n,t,i){(function(s){(function(o,u){n.exports=u()})(this,function(){var o=o||function(u,d){var h;if(typeof window<"u"&&window.crypto&&(h=window.crypto),!h&&typeof window<"u"&&window.msCrypto&&(h=window.msCrypto),!h&&typeof s<"u"&&s.crypto&&(h=s.crypto),!h)try{h=i(44)}catch{}var m=function(){if(h){if(typeof h.getRandomValues=="function")try{return h.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof h.randomBytes=="function")try{return h.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},O=Object.create||function(){function f(){}return function(c){var a;return f.prototype=c,a=new f,f.prototype=null,a}}(),w={},x=w.lib={},l=x.Base=function(){return{extend:function(f){var c=O(this);return f&&c.mixIn(f),(!c.hasOwnProperty("init")||this.init===c.init)&&(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var f=this.extend();return f.init.apply(f,arguments),f},init:function(){},mixIn:function(f){for(var c in f)f.hasOwnProperty(c)&&(this[c]=f[c]);f.hasOwnProperty("toString")&&(this.toString=f.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=x.WordArray=l.extend({init:function(f,c){f=this.words=f||[],c!=d?this.sigBytes=c:this.sigBytes=f.length*4},toString:function(f){return(f||M).stringify(this)},concat:function(f){var c=this.words,a=f.words,v=this.sigBytes,g=f.sigBytes;if(this.clamp(),v%4)for(var S=0;S<g;S++){var D=a[S>>>2]>>>24-S%4*8&255;c[v+S>>>2]|=D<<24-(v+S)%4*8}else for(var S=0;S<g;S+=4)c[v+S>>>2]=a[S>>>2];return this.sigBytes+=g,this},clamp:function(){var f=this.words,c=this.sigBytes;f[c>>>2]&=4294967295<<32-c%4*8,f.length=u.ceil(c/4)},clone:function(){var f=l.clone.call(this);return f.words=this.words.slice(0),f},random:function(f){for(var c=[],a=0;a<f;a+=4)c.push(m());return new E.init(c,f)}}),R=w.enc={},M=R.Hex={stringify:function(f){for(var c=f.words,a=f.sigBytes,v=[],g=0;g<a;g++){var S=c[g>>>2]>>>24-g%4*8&255;v.push((S>>>4).toString(16)),v.push((S&15).toString(16))}return v.join("")},parse:function(f){for(var c=f.length,a=[],v=0;v<c;v+=2)a[v>>>3]|=parseInt(f.substr(v,2),16)<<24-v%8*4;return new E.init(a,c/2)}},b=R.Latin1={stringify:function(f){for(var c=f.words,a=f.sigBytes,v=[],g=0;g<a;g++){var S=c[g>>>2]>>>24-g%4*8&255;v.push(String.fromCharCode(S))}return v.join("")},parse:function(f){for(var c=f.length,a=[],v=0;v<c;v++)a[v>>>2]|=(f.charCodeAt(v)&255)<<24-v%4*8;return new E.init(a,c)}},y=R.Utf8={stringify:function(f){try{return decodeURIComponent(escape(b.stringify(f)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(f){return b.parse(unescape(encodeURIComponent(f)))}},T=x.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(f){typeof f=="string"&&(f=y.parse(f)),this._data.concat(f),this._nDataBytes+=f.sigBytes},_process:function(f){var c,a=this._data,v=a.words,g=a.sigBytes,S=this.blockSize,D=S*4,k=g/D;f?k=u.ceil(k):k=u.max((k|0)-this._minBufferSize,0);var P=k*S,I=u.min(P*4,g);if(P){for(var C=0;C<P;C+=S)this._doProcessBlock(v,C);c=v.splice(0,P),a.sigBytes-=I}return new E.init(c,I)},clone:function(){var f=l.clone.call(this);return f._data=this._data.clone(),f},_minBufferSize:0});x.Hasher=T.extend({cfg:l.extend(),init:function(f){this.cfg=this.cfg.extend(f),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(f){return this._append(f),this._process(),this},finalize:function(f){f&&this._append(f);var c=this._doFinalize();return c},blockSize:16,_createHelper:function(f){return function(c,a){return new f.init(a).finalize(c)}},_createHmacHelper:function(f){return function(c,a){return new p.HMAC.init(f,a).finalize(c)}}});var p=w.algo={};return w}(Math);return o})}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(2)),d=s.__importDefault(i(3));function h(w,x,l){try{x.apply(w,l)}catch(E){u.default.logAction(u.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+E+"; stack = "+(E&&E.stack))}}function m(w,x,l){for(var E,R,M,b=0;b<w.length;b++)if(E=w[b],l&&(E=E[l]),o.isArray(E)){for(;(R=o.arrIndexOf(E,x))!==-1;)E.splice(R,1);l&&E.length===0&&delete w[b][l]}else if(o.isObject(E))for(M in E)Object.prototype.hasOwnProperty.call(E,M)&&o.isArray(E[M])&&m([E],x,M)}var O=function(){function w(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return w.prototype.on=function(){for(var x=this,l=[],E=0;E<arguments.length;E++)l[E]=arguments[E];if(l.length===1){var R=l[0];if(typeof R=="function")this.any.push(R);else throw new Error("EventListener.on(): Invalid arguments: "+d.default.Config.inspect(l))}if(l.length===2){var M=l[0],b=l[1];if(typeof b!="function")throw new Error("EventListener.on(): Invalid arguments: "+d.default.Config.inspect(l));if(o.isEmptyArg(M))this.any.push(b);else if(o.isArray(M))M.forEach(function(T){x.on(T,b)});else{if(typeof M!="string")throw new Error("EventListener.on(): Invalid arguments: "+d.default.Config.inspect(l));var y=this.events[M]||(this.events[M]=[]);y.push(b)}}},w.prototype.off=function(){for(var x,l=this,E=[],R=0;R<arguments.length;R++)E[R]=arguments[R];if(E.length==0||o.isEmptyArg(E[0])&&o.isEmptyArg(E[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var M=E[0],b=E[1],y=null,T=null;if(E.length===1||!b)typeof M=="function"?y=M:T=M;else{if(typeof b!="function")throw new Error("EventEmitter.off(): invalid arguments:"+d.default.Config.inspect(E));x=[M,b],T=x[0],y=x[1]}if(y&&o.isEmptyArg(T)){m([this.any,this.events,this.anyOnce,this.eventsOnce],y);return}if(o.isArray(T)){T.forEach(function(p){l.off(p,y)});return}if(typeof T!="string")throw new Error("EventEmitter.off(): invalid arguments:"+d.default.Config.inspect(E));y?m([this.events,this.eventsOnce],y,T):(delete this.events[T],delete this.eventsOnce[T])},w.prototype.listeners=function(x){if(x){var l=this.events[x]||[];return this.eventsOnce[x]&&Array.prototype.push.apply(l,this.eventsOnce[x]),l.length?l:null}return this.any.length?this.any:null},w.prototype.emit=function(x){for(var l=[],E=1;E<arguments.length;E++)l[E-1]=arguments[E];var R={event:x},M=[];this.anyOnce.length&&(Array.prototype.push.apply(M,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(M,this.any);var b=this.eventsOnce[x];b&&(Array.prototype.push.apply(M,b),delete this.eventsOnce[x]);var y=this.events[x];y&&Array.prototype.push.apply(M,y),o.arrForEach(M,function(T){h(R,T,l)})},w.prototype.once=function(){for(var x=this,l=[],E=0;E<arguments.length;E++)l[E]=arguments[E];var R=l.length;if((R===0||R===1&&typeof l[0]!="function")&&d.default.Config.Promise){var M=l[0];return new d.default.Config.Promise(function(c){x.once(M,c)})}var b=l[0],y=l[1];if(l.length===1&&typeof b=="function")this.anyOnce.push(b);else if(o.isEmptyArg(b)){if(typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));this.anyOnce.push(y)}else if(o.isArray(b)){var T=this,p=function(){var c=Array.prototype.slice.call(arguments);if(o.arrForEach(b,function(a){T.off(a,p)}),typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));y.apply(this,c)};o.arrForEach(b,function(c){T.on(c,p)})}else{if(typeof b!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));var f=this.eventsOnce[b]||(this.eventsOnce[b]=[]);if(y){if(typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+d.default.Config.inspect(l));f.push(y)}}},w.prototype.whenState=function(x,l,E){for(var R=this,M=[],b=3;b<arguments.length;b++)M[b-3]=arguments[b];var y={event:x};if(typeof x!="string"||typeof l!="string")throw"whenState requires a valid event String argument";if(typeof E!="function"&&d.default.Config.Promise)return new d.default.Config.Promise(function(T){w.prototype.whenState.apply(R,[x,l,T].concat(M))});x===l?h(y,E,M):this.once(x,E)},w}();t.default=O},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaults=t.normaliseOptions=t.objectifyOptions=t.getAgentString=t.getHosts=t.getFallbackHosts=t.environmentFallbackHosts=t.getHttpScheme=t.getPort=t.getHost=void 0;var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1)),d=s.__importDefault(i(2)),h=s.__importDefault(i(4)),m=i(43),O="ably-js/"+m.version,w={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:m.version,protocolVersion:2,agent:O,getHost:x,getPort:l,getHttpScheme:E,environmentFallbackHosts:R,getFallbackHosts:M,getHosts:b,checkHost:y,objectifyOptions:c,normaliseOptions:a};function x(g,S,D){return D?S=S==g.restHost&&g.realtimeHost||S||g.realtimeHost:S=S||g.restHost,S}t.getHost=x;function l(g,S){return S||g.tls?g.tlsPort:g.port}t.getPort=l;function E(g){return g.tls?"https://":"http://"}t.getHttpScheme=E;function R(g){return[g+"-a-fallback.ably-realtime.com",g+"-b-fallback.ably-realtime.com",g+"-c-fallback.ably-realtime.com",g+"-d-fallback.ably-realtime.com",g+"-e-fallback.ably-realtime.com"]}t.environmentFallbackHosts=R;function M(g){var S=g.fallbackHosts,D=typeof g.httpMaxRetryCount<"u"?g.httpMaxRetryCount:w.httpMaxRetryCount;return S?u.arrChooseN(S,D):[]}t.getFallbackHosts=M;function b(g){return[g.restHost].concat(M(g))}t.getHosts=b;function y(g){if(typeof g!="string")throw new h.default("host must be a string; was a "+typeof g,4e4,400);if(!g.length)throw new h.default("host must not be zero-length",4e4,400)}function T(g,S,D){return g.realtimeHost?g.realtimeHost:g.restHost?(d.default.logAction(d.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+g.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+g.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),g.restHost):S?w.REALTIME_HOST:D+"-"+w.REALTIME_HOST}function p(g){var S={};for(var D in w.TIMEOUTS)S[D]=g[D]||w.TIMEOUTS[D];return S}function f(g){var S=w.agent;if(g.agents)for(var D in g.agents)S+=" "+D+"/"+g.agents[D];return S}t.getAgentString=f;function c(g){return typeof g=="string"?g.indexOf(":")==-1?{token:g}:{key:g}:g}t.objectifyOptions=c;function a(g){if(g.host&&(d.default.renamedClientOption("host","restHost"),g.restHost=g.host),g.wsHost&&(d.default.renamedClientOption("wsHost","realtimeHost"),g.realtimeHost=g.wsHost),g.queueEvents&&(d.default.renamedClientOption("queueEvents","queueMessages"),g.queueMessages=g.queueEvents),g.headers&&d.default.deprecated("the `headers` client option",""),g.fallbackHostsUseDefault){if(g.fallbackHosts){var S="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions",S),new h.default(S,4e4,400)}if(g.port||g.tlsPort){var S="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions",S),new h.default(S,4e4,400)}g.environment?d.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):d.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youre not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if youre using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),g.fallbackHosts=w.FALLBACK_HOSTS}g.recover===!0&&(d.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),g.recover=function(H,_){_(!0)}),typeof g.recover=="function"&&g.closeOnUnload===!0&&(d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),g.recover=void 0),"closeOnUnload"in g||(g.closeOnUnload=!g.recover),g.transports&&u.arrIn(g.transports,"xhr")&&(d.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),u.arrDeleteValue(g.transports,"xhr"),g.transports.push("xhr_streaming")),"queueMessages"in g||(g.queueMessages=!0);var D=g.environment&&String(g.environment).toLowerCase()||w.ENVIRONMENT,k=!D||D==="production";!g.fallbackHosts&&!g.restHost&&!g.realtimeHost&&!g.port&&!g.tlsPort&&(g.fallbackHosts=k?w.FALLBACK_HOSTS:R(D));var P=g.restHost||(k?w.REST_HOST:D+"-"+w.REST_HOST),I=T(g,k,D);u.arrForEach((g.fallbackHosts||[]).concat(P,I),y),g.port=g.port||w.PORT,g.tlsPort=g.tlsPort||w.TLS_PORT,"tls"in g||(g.tls=!0);var C=p(g);if("useBinaryProtocol"in g?g.useBinaryProtocol=o.default.Config.supportsBinary&&g.useBinaryProtocol:g.useBinaryProtocol=o.default.Config.preferBinary,g.clientId){var A=g.headers=g.headers||{};A["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(g.clientId))}"idempotentRestPublishing"in g||(g.idempotentRestPublishing=!0),g.promises&&!o.default.Config.Promise&&(d.default.logAction(d.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),g.promises=!1);var L=null,U=g.connectivityCheckUrl;if(g.connectivityCheckUrl){var B=g.connectivityCheckUrl.split("?"),$=B[0],V=B[1];L=V?u.parseQueryString(V):{},$.indexOf("://")===-1&&($="https://"+$),U=$}return s.__assign(s.__assign({},g),{useBinaryProtocol:"useBinaryProtocol"in g?o.default.Config.supportsBinary&&g.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:I,restHost:P,maxMessageSize:g.maxMessageSize||w.maxMessageSize,timeouts:C,connectivityCheckParams:L,connectivityCheckUrl:U})}t.normaliseOptions=a,t.default=w;function v(g){return Object.assign(w,g)}t.getDefaults=v},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),u=s.__importDefault(i(2)),d=s.__importDefault(i(4)),h=s.__importStar(i(1));function m(l){return!l||!l.channelOptions?{channelOptions:l,plugins:{},baseEncodedPreviousPayload:void 0}:l}function O(l){if(l&&l.cipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var E=o.default.Crypto.getCipher(l.cipher);return{cipher:E.cipherParams,channelCipher:E.cipher}}return l??{}}function w(l){var E=0;return l.name&&(E+=l.name.length),l.clientId&&(E+=l.clientId.length),l.extras&&(E+=JSON.stringify(l.extras).length),l.data&&(E+=h.dataSizeBytes(l.data)),E}var x=function(){function l(){}return l.prototype.toJSON=function(){var E=this.encoding,R=this.data;return R&&o.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(E=E?E+"/base64":"base64",R=o.default.BufferUtils.base64Encode(R)):R=o.default.BufferUtils.toBuffer(R)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:E,data:R}},l.prototype.toString=function(){var E="[Message";return this.name&&(E+="; name="+this.name),this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.extras&&(E+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?E+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},l.encrypt=function(E,R,M){var b=E.data,y=E.encoding,T=R.channelCipher;y=y?y+"/":"",o.default.BufferUtils.isBuffer(b)||(b=o.default.BufferUtils.utf8Encode(String(b)),y=y+"utf-8/"),T.encrypt(b,function(p,f){if(p){M(p);return}E.data=f,E.encoding=y+"cipher+"+T.algorithm,M(null,E)})},l.encode=function(E,R,M){var b=E.data,y=typeof b=="string"||o.default.BufferUtils.isBuffer(b)||b===null||b===void 0;if(!y)if(h.isObject(b)||h.isArray(b))E.data=JSON.stringify(b),E.encoding=E.encoding?E.encoding+"/json":"json";else throw new d.default("Data type is unsupported",40013,400);R!=null&&R.cipher?l.encrypt(E,R,M):M(null,E)},l.encodeArray=function(E,R,M){for(var b=0,y=0;y<E.length;y++)l.encode(E[y],R,function(T){if(T){M(T);return}b++,b==E.length&&M(null,E)})},l.decode=function(E,R){var M=m(R),b=E.data,y=E.encoding;if(y){var T=y.split("/"),p=void 0,f=T.length,c=E.data,a="";try{for(;(p=f)>0;){var v=T[--f].match(/([-\w]+)(\+([\w-]+))?/);if(!v)break;switch(a=v[1],a){case"base64":c=o.default.BufferUtils.base64Decode(String(c)),p==T.length&&(b=c);continue;case"utf-8":c=o.default.BufferUtils.utf8Decode(c);continue;case"json":c=JSON.parse(c);continue;case"cipher":if(M.channelOptions!=null&&M.channelOptions.cipher&&M.channelOptions.channelCipher){var g=v[3],S=M.channelOptions.channelCipher;if(g!=S.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");c=S.decrypt(c);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!M.plugins||!M.plugins.vcdiff)throw new d.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new d.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var D=M.baseEncodedPreviousPayload;typeof D=="string"&&(D=o.default.BufferUtils.utf8Encode(D)),D=o.default.BufferUtils.toBuffer(D),c=o.default.BufferUtils.toBuffer(c),c=o.default.BufferUtils.typedArrayToBuffer(M.plugins.vcdiff.decode(c,D)),b=c}catch(P){throw new d.default("Vcdiff delta decode failed with "+P,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(P){var k=P;throw new d.default("Error processing the "+a+" encoding, decoder returned "+k.message+"",k.code||40013,400)}finally{E.encoding=p<=0?null:T.slice(0,p).join("/"),E.data=c}}M.baseEncodedPreviousPayload=b},l.fromResponseBody=function(E,R,M){M&&(E=h.decodeBody(E,M));for(var b=0;b<E.length;b++){var y=E[b]=l.fromValues(E[b]);try{l.decode(y,R)}catch(T){u.default.logAction(u.default.LOG_ERROR,"Message.fromResponseBody()",T.toString())}}return E},l.fromValues=function(E){return Object.assign(new l,E)},l.fromValuesArray=function(E){for(var R=E.length,M=new Array(R),b=0;b<R;b++)M[b]=l.fromValues(E[b]);return M},l.fromEncoded=function(E,R){var M=l.fromValues(E),b=O(R??null);try{l.decode(M,b)}catch(y){u.default.logAction(u.default.LOG_ERROR,"Message.fromEncoded()",y.toString())}return M},l.fromEncodedArray=function(E,R){return E.map(function(M){return l.fromEncoded(M,R)})},l.getMessagesSize=function(E){for(var R,M=0,b=0;b<E.length;b++)R=E[b],M+=R.size||(R.size=w(R));return M},l.serialize=h.encodeBody,l}();t.default=x},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(4)),d=s.__importDefault(i(9)),h=s.__importDefault(i(16)),m={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},O=[];Object.keys(m).forEach(function(M){O[m[M]]=M});var w={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},x=Object.keys(w);w.MODE_ALL=w.PRESENCE|w.PUBLISH|w.SUBSCRIBE|w.PRESENCE_SUBSCRIBE;function l(M){var b=[];if(M)for(var y=0;y<M.length;y++)b.push(M[y].toString());return"[ "+b.join(", ")+" ]"}var E="id channel channelSerial connectionId count msgSerial timestamp".split(" "),R=function(){function M(){var b=this;this.hasFlag=function(y){return(b.flags&w[y])>0}}return M.prototype.setFlag=function(b){return this.flags=this.flags|w[b]},M.prototype.getMode=function(){return this.flags&&this.flags&w.MODE_ALL},M.prototype.encodeModesToFlags=function(b){var y=this;b.forEach(function(T){return y.setFlag(T)})},M.prototype.decodeModesFromFlags=function(){var b=this,y=[];return M.channelModes.forEach(function(T){b.hasFlag(T)&&y.push(T)}),y.length>0?y:void 0},M.fromValues=function(b){return Object.assign(new M,b)},M.Action=m,M.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],M.ActionName=O,M.serialize=o.encodeBody,M.deserialize=function(b,y){var T=o.decodeBody(b,y);return M.fromDeserialized(T)},M.fromDeserialized=function(b){var y=b.error;y&&(b.error=u.default.fromValues(y));var T=b.messages;if(T)for(var p=0;p<T.length;p++)T[p]=d.default.fromValues(T[p]);var f=b.presence;if(f)for(var p=0;p<f.length;p++)f[p]=h.default.fromValues(f[p],!0);return Object.assign(new M,b)},M.stringify=function(b){var y="[ProtocolMessage";b.action!==void 0&&(y+="; action="+M.ActionName[b.action]||!1);for(var T,p=0;p<E.length;p++)T=E[p],b[T]!==void 0&&(y+="; "+T+"="+b[T]);if(b.messages&&(y+="; messages="+l(d.default.fromValuesArray(b.messages))),b.presence&&(y+="; presence="+l(h.default.fromValuesArray(b.presence))),b.error&&(y+="; error="+u.default.fromValues(b.error).toString()),b.auth&&b.auth.accessToken&&(y+="; token="+b.auth.accessToken),b.flags&&(y+="; flags="+x.filter(b.hasFlag).join(",")),b.params){var f="";o.forInOwnNonNullProperties(b.params,function(c){f.length>0&&(f+="; "),f+=c+"="+b.params[c]}),f.length>0&&(y+="; params=["+f+"]")}return y+="]",y},M}();t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,u=o.lib,d=u.WordArray,h=o.enc;h.Base64={stringify:function(O){var w=O.words,x=O.sigBytes,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";O.clamp();for(var E=[],R=0;R<x;R+=3)for(var M=w[R>>>2]>>>24-R%4*8&255,b=w[R+1>>>2]>>>24-(R+1)%4*8&255,y=w[R+2>>>2]>>>24-(R+2)%4*8&255,T=M<<16|b<<8|y,p=0;p<4&&R+p*.75<x;p++)E.push(l.charAt(T>>>6*(3-p)&63));var f=l.charAt(64);if(f)for(;E.length%4;)E.push(f);return E.join("")},parse:function(O){var w=O.length,x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=this._reverseMap;if(!l){l=this._reverseMap=[];for(var E=0;E<x.length;E++)l[x.charCodeAt(E)]=E}var R=x.charAt(64);if(R){var M=O.indexOf(R);M!==-1&&(w=M)}return m(O,w,l)}};function m(O,w,x){for(var l=[],E=0,R=0;R<w;R++)if(R%4){var M=x[O.charCodeAt(R-1)]<<R%4*2,b=x[O.charCodeAt(R)]>>>6-R%4*2,y=M|b;l[E>>>2]|=y<<24-E%4*8,E++}return d.create(l,E)}}(),s.enc.Base64})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(10)),d=s.__importDefault(i(26)),h=s.__importDefault(i(2)),m=s.__importDefault(i(8)),O=s.__importDefault(i(21)),w=s.__importDefault(i(18)),x=s.__importDefault(i(4)),l=s.__importDefault(i(22)),E=s.__importDefault(i(3));function R(y){var T=[80015,80017,80030];return y.code?w.default.isTokenErr(y)?!1:o.arrIn(T,y.code)?!0:y.code>=4e4&&y.code<5e4:!1}function M(y){return R(y)?[u.default.fromValues({action:u.default.Action.ERROR,error:y})]:[u.default.fromValues({action:u.default.Action.DISCONNECTED,error:y})]}var b=function(y){s.__extends(T,y);function T(p,f,c){var a=y.call(this,p,f,c,!0)||this;return a.onAuthUpdated=function(v){a.authParams={access_token:v.token}},a.stream="stream"in c?c.stream:!0,a.sendRequest=null,a.recvRequest=null,a.pendingCallback=null,a.pendingItems=null,a}return T.prototype.connect=function(){var p=this;h.default.logAction(h.default.LOG_MINOR,"CometTransport.connect()","starting"),d.default.prototype.connect.call(this);var f=this.params,c=f.options,a=m.default.getHost(c,f.host),v=m.default.getPort(c),g=c.tls?"https://":"http://";this.baseUri=g+a+":"+v+"/comet/";var S=this.baseUri+"connect";h.default.logAction(h.default.LOG_MINOR,"CometTransport.connect()","uri: "+S),this.auth.getAuthParams(function(D,k){if(D){p.disconnect(D);return}if(!p.isDisposed){p.authParams=k;var P=p.params.getConnectParams(k);"stream"in P&&(p.stream=P.stream),h.default.logAction(h.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(P));var I=!1,C=p.recvRequest=p.createRequest(S,null,P,null,p.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV);C.on("data",function(A){p.recvRequest&&(I||(I=!0,p.emit("preconnect")),p.onData(A))}),C.on("complete",function(A){if(p.recvRequest||(A=A||new x.default("Request cancelled",80003,400)),p.recvRequest=null,!I&&!A&&(I=!0,p.emit("preconnect")),p.onActivity(),A){A.code?p.onData(M(A)):p.disconnect(A);return}E.default.Config.nextTick(function(){p.recv()})}),C.exec()}})},T.prototype.requestClose=function(){h.default.logAction(h.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},T.prototype.requestDisconnect=function(){h.default.logAction(h.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},T.prototype._requestCloseOrDisconnect=function(p){var f=this,c=p?this.closeUri:this.disconnectUri;if(c){var a=this.createRequest(c,null,this.authParams,null,l.default.REQ_SEND);a.on("complete",function(v){v&&(h.default.logAction(h.default.LOG_ERROR,"CometTransport.request"+(p?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(v)),f.finish("disconnected",v))}),a.exec()}},T.prototype.dispose=function(){var p=this;h.default.logAction(h.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(h.default.logAction(h.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",O.default.disconnected()),E.default.Config.nextTick(function(){p.emit("disposed")}))},T.prototype.onConnect=function(p){var f;if(!this.isDisposed){var c=(f=p.connectionDetails)===null||f===void 0?void 0:f.connectionKey;d.default.prototype.onConnect.call(this,p);var a=this.baseUri+c;h.default.logAction(h.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+a),this.sendUri=a+"/send",this.recvUri=a+"/recv",this.closeUri=a+"/close",this.disconnectUri=a+"/disconnect"}},T.prototype.send=function(p){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(p);return}var f=this.pendingItems||[];f.push(p),this.pendingItems=null,this.sendItems(f)},T.prototype.sendAnyPending=function(){var p=this.pendingItems;p&&(this.pendingItems=null,this.sendItems(p))},T.prototype.sendItems=function(p){var f=this,c=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(p),l.default.REQ_SEND);c.on("complete",function(a,v){if(a&&h.default.logAction(h.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(a)),f.sendRequest=null,a){a.code?f.onData(M(a)):f.disconnect(a);return}v&&f.onData(v),f.pendingItems&&E.default.Config.nextTick(function(){f.sendRequest||f.sendAnyPending()})}),c.exec()},T.prototype.recv=function(){var p=this;if(!this.recvRequest&&this.isConnected){var f=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV_POLL);f.on("data",function(c){p.onData(c)}),f.on("complete",function(c){if(p.recvRequest=null,p.onActivity(),c){c.code?p.onData(M(c)):p.disconnect(c);return}E.default.Config.nextTick(function(){p.recv()})}),f.exec()}},T.prototype.onData=function(p){try{var f=this.decodeResponse(p);if(f&&f.length)for(var c=0;c<f.length;c++)this.onProtocolMessage(u.default.fromDeserialized(f[c]))}catch(a){h.default.logAction(h.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+a.stack)}},T.prototype.encodeRequest=function(p){return JSON.stringify(p)},T.prototype.decodeResponse=function(p){return typeof p=="string"?JSON.parse(p):p},T}(d.default);t.default=b},function(n,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}n.exports=i},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isSuccessCode=void 0;var s;(function(u){u[u.Success=200]="Success",u[u.NoContent=204]="NoContent",u[u.BadRequest=400]="BadRequest",u[u.Unauthorized=401]="Unauthorized",u[u.Forbidden=403]="Forbidden",u[u.RequestTimeout=408]="RequestTimeout",u[u.InternalServerError=500]="InternalServerError"})(s||(s={}));function o(u){return u>=s.Success&&u<s.BadRequest}t.isSuccessCode=o,t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1)),d=s.__importDefault(i(2)),h=s.__importDefault(i(18)),m=s.__importDefault(i(19)),O=i(4),w=s.__importDefault(i(14));function x(y,T,p,f,c){y.http.supportsAuthHeaders?y.auth.getAuthHeaders(function(a,v){a?f(a):c(u.mixin(v,T),p)}):y.auth.getAuthParams(function(a,v){a?f(a):c(T,u.mixin(v,p))})}function l(y,T){return function(p,f,c,a,v){if(p&&!f){y(p);return}if(v===w.default.NoContent){y(p,[],c,!0,v);return}if(!a)try{f=u.decodeBody(f,T)}catch(I){u.isErrorInfoOrPartialErrorInfo(I)?y(I):y(new O.PartialErrorInfo(u.inspectError(I),null));return}if(!f){y(new O.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var g=f,S=g.statusCode,D=g.response,k=g.headers;if(S===void 0){y(p,f,c,!0,v);return}if(S<200||S>=300){var P=D&&D.error||p;P||(P=new Error("Error in unenveloping "+f),P.statusCode=S),y(P,D,k,!0,S);return}y(p,D,k,!0,S)}}function E(y){var T=[];if(y)for(var p in y)T.push(p+"="+y[p]);return T.join("&")}function R(y,T){return y+(T?"?":"")+E(T)}function M(y,T,p,f){return function(c,a,v,g,S){c?d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Received Error; "+R(p,f)+"; Error: "+u.inspectError(c)):d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Received; "+R(p,f)+"; Headers: "+E(v)+"; StatusCode: "+S+"; Body: "+(o.default.BufferUtils.isBuffer(a)?a.toString():a)),y&&y(c,a,v,g,S)}}var b=function(){function y(){}return y.get=function(T,p,f,c,a,v){y.do(m.default.Get,T,p,null,f,c,a,v)},y.delete=function(T,p,f,c,a,v){y.do(m.default.Delete,T,p,null,f,c,a,v)},y.post=function(T,p,f,c,a,v,g){y.do(m.default.Post,T,p,f,c,a,v,g)},y.patch=function(T,p,f,c,a,v,g){y.do(m.default.Patch,T,p,f,c,a,v,g)},y.put=function(T,p,f,c,a,v,g){y.do(m.default.Put,T,p,f,c,a,v,g)},y.do=function(T,p,f,c,a,v,g,S){d.default.shouldLog(d.default.LOG_MICRO)&&(S=M(S,T,f,v)),g&&(S=S&&l(S,g),(v=v||{}).envelope=g);function D(k,P){var I;if(d.default.shouldLog(d.default.LOG_MICRO)&&d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(f,P)),d.default.shouldLog(d.default.LOG_MICRO)){var C=c;if(((I=k["content-type"])===null||I===void 0?void 0:I.indexOf("msgpack"))>0)try{C=o.default.Config.msgpack.decode(c)}catch(A){d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Sending MsgPack Decoding Error: "+u.inspectError(A))}d.default.logAction(d.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(f,P)+"; Body: "+C)}p.http.do(T,p,f,k,c,P,function(A,L,U,B,$){if(A&&h.default.isTokenErr(A)){p.auth.authorize(null,null,function(V){if(V){S(V);return}x(p,k,P,S,D)});return}S(A,L,U,B,$)})}x(p,a,v,S,D)},y}();t.default=b},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),u=s.__importDefault(i(3)),d=s.__importDefault(i(9)),h=s.__importStar(i(1));function m(w){return O.Actions.indexOf(w)}var O=function(){function w(){}return w.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},w.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var x=this.id.split(":");return{connectionId:x[0],msgSerial:parseInt(x[1],10),index:parseInt(x[2],10)}},w.prototype.toJSON=function(){var x=this.data,l=this.encoding;return x&&u.default.BufferUtils.isBuffer(x)&&(arguments.length>0?(l=l?l+"/base64":"base64",x=u.default.BufferUtils.base64Encode(x)):x=u.default.BufferUtils.toBuffer(x)),{id:this.id,clientId:this.clientId,action:m(this.action),data:x,encoding:l,extras:this.extras}},w.prototype.toString=function(){var x="[PresenceMessage";return x+="; action="+this.action,this.id&&(x+="; id="+this.id),this.timestamp&&(x+="; timestamp="+this.timestamp),this.clientId&&(x+="; clientId="+this.clientId),this.connectionId&&(x+="; connectionId="+this.connectionId),this.encoding&&(x+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?x+="; data="+this.data:u.default.BufferUtils.isBuffer(this.data)?x+="; data (buffer)="+u.default.BufferUtils.base64Encode(this.data):x+="; data (json)="+JSON.stringify(this.data)),this.extras&&(x+="; extras="+JSON.stringify(this.extras)),x+="]",x},w.fromResponseBody=function(x,l,E){var R=[];E&&(x=h.decodeBody(x,E));for(var M=0;M<x.length;M++){var b=R[M]=w.fromValues(x[M],!0);try{w.decode(b,l)}catch(y){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",y.toString())}}return R},w.fromValues=function(x,l){return l&&(x.action=w.Actions[x.action]),Object.assign(new w,x)},w.fromValuesArray=function(x){for(var l=x.length,E=new Array(l),R=0;R<l;R++)E[R]=w.fromValues(x[R]);return E},w.fromEncoded=function(x,l){var E=w.fromValues(x,!0);try{w.decode(E,l??{})}catch(R){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",R.toString())}return E},w.fromEncodedArray=function(x,l){return x.map(function(E){return w.fromEncoded(E,l)})},w.fromData=function(x){return x instanceof w?x:w.fromValues({data:x})},w.Actions=["absent","present","enter","leave","update"],w.encode=d.default.encode,w.decode=d.default.decode,w.getMessagesSize=d.default.getMessagesSize,w}();t.default=O},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),u=o.__importStar(i(1)),d=o.__importDefault(i(7)),h=o.__importStar(i(4)),m=o.__importDefault(i(2)),O=o.__importDefault(i(8)),w=o.__importDefault(i(22)),x=o.__importDefault(i(3));function l(g,S){return u.arrIn(u.allToLowerCase(u.keysArray(S)),"x-ably-errorcode")}function E(g,S){if(l(g,S))return g.error&&h.default.fromValues(g.error)}var R=function(){},M=0,b={},y=typeof s<"u"&&s.XDomainRequest;function T(){var g=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return g&&Number(g[1])}function p(){var g;return y&&(g=T())&&g===10}function f(g,S){return g.getResponseHeader&&g.getResponseHeader(S)}function c(g){return g.getResponseHeader&&(g.getResponseHeader("transfer-encoding")||!g.getResponseHeader("content-length"))}function a(g){for(var S=u.trim(g.getAllResponseHeaders()).split(`\r
`),D={},k=0;k<S.length;k++){var P=S[k].split(":").map(u.trim);D[P[0].toLowerCase()]=P[1]}return D}var v=function(g){o.__extends(S,g);function S(D,k,P,I,C,A,L){var U=g.call(this)||this;return P=P||{},P.rnd=u.cheapRandStr(),p()&&!P.envelope&&(P.envelope="json"),U.uri=D+u.toQueryString(P),U.headers=k||{},U.body=I,U.method=L?L.toUpperCase():u.isEmptyArg(I)?"GET":"POST",U.requestMode=C,U.timeouts=A,U.timedOut=!1,U.requestComplete=!1,U.id=String(++M),b[U.id]=U,U}return S.createRequest=function(D,k,P,I,C,A,L){var U=A||O.default.TIMEOUTS;return new S(D,k,u.copy(P),I,C,U,L)},S.prototype.complete=function(D,k,P,I,C){this.requestComplete||(this.requestComplete=!0,!D&&k&&this.emit("data",k),this.emit("complete",D,k,P,I,C),this.dispose())},S.prototype.abort=function(){this.dispose()},S.prototype.exec=function(){var D=this,k=this.headers,P=this.requestMode==w.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,I=this.timer=setTimeout(function(){D.timedOut=!0,A.abort()},P),C=this.method,A=this.xhr=new XMLHttpRequest,L=k.accept,U=this.body,B="text";if(L?L.indexOf("application/x-msgpack")===0&&(B="arraybuffer"):k.accept="application/json",U){var $=k["content-type"]||(k["content-type"]="application/json");$.indexOf("application/json")>-1&&typeof U!="string"&&(U=JSON.stringify(U))}A.open(C,this.uri,!0),A.responseType=B,"authorization"in k&&(A.withCredentials=!0);for(var V in k)A.setRequestHeader(V,k[V]);var H=function(Q,ie,de,me){var fe,Le=ie+" (event type: "+Q.type+")";!((fe=D==null?void 0:D.xhr)===null||fe===void 0)&&fe.statusText&&(Le+=", current statusText is "+D.xhr.statusText),m.default.logAction(m.default.LOG_ERROR,"Request.on"+Q.type+"()",Le),D.complete(new h.PartialErrorInfo(Le,de,me))};A.onerror=function(Q){H(Q,"XHR error occurred",null,400)},A.onabort=function(Q){D.timedOut?H(Q,"Request aborted due to request timeout expiring",null,408):H(Q,"Request cancelled",null,400)},A.ontimeout=function(Q){H(Q,"Request timed out",null,408)};var _,N,F,j=0,W=!1,J=function(){if(clearTimeout(I),F=N<400,N==204){D.complete(null,null,null,null,N);return}_=D.requestMode==w.default.REQ_RECV_STREAM&&F&&c(A)},Y=function(){var Q;try{var ie=f(A,"content-type"),de=ie?ie.indexOf("application/json")>=0:A.responseType=="text";if(de){var me=A.responseType==="arraybuffer"?x.default.BufferUtils.utf8Decode(A.response):String(A.responseText);me.length?Q=JSON.parse(me):Q=me,W=!0}else Q=A.response;Q.response!==void 0?(N=Q.statusCode,F=N<400,k=Q.headers,Q=Q.response):k=a(A)}catch(Le){D.complete(new h.PartialErrorInfo("Malformed response body from server: "+Le.message,null,400));return}if(F||u.isArray(Q)){D.complete(null,Q,k,W,N);return}var fe=E(Q,k);fe||(fe=new h.PartialErrorInfo("Error response received from server: "+N+" body was: "+x.default.Config.inspect(Q),null,N)),D.complete(fe,Q,k,W,N)};function X(){for(var Q=A.responseText,ie=Q.length-1,de,me;j<ie&&(de=Q.indexOf(`
`,j))>-1;)me=Q.slice(j,de),j=de+1,ee(me)}var ee=function(Q){try{Q=JSON.parse(Q)}catch(ie){D.complete(new h.PartialErrorInfo("Malformed response body from server: "+ie.message,null,400));return}D.emit("data",Q)},re=function(){X(),D.streamComplete=!0,x.default.Config.nextTick(function(){D.complete()})};A.onreadystatechange=function(){var Q=A.readyState;Q<3||A.status!==0&&(N===void 0&&(N=A.status,N===1223&&(N=204),J()),Q==3&&_?X():Q==4&&(_?re():Y()))},A.send(U)},S.prototype.dispose=function(){var D=this.xhr;if(D){D.onreadystatechange=D.onerror=D.onabort=D.ontimeout=R,this.xhr=null;var k=this.timer;k&&(clearTimeout(k),this.timer=null),this.requestComplete||D.abort()}delete b[this.id]},S}(d.default);t.default=v}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),u=s.__importStar(i(1)),d=s.__importDefault(i(24)),h=s.__importDefault(i(4)),m=s.__importDefault(i(45)),O=i(11),w=s.__importDefault(i(19)),x=s.__importDefault(i(14)),l=s.__importDefault(i(3)),E=s.__importDefault(i(15)),R=Math.pow(2,17);function M(){}function b(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function y(P){return!!P.connection}function T(P){return u.isErrorInfoOrPartialErrorInfo(P)?(P.code||(P.statusCode===403?P.code=40300:(P.code=40170,P.statusCode=401)),P):new h.default(u.inspectError(P),P.code||40170,P.statusCode||401)}var p=function(P,I){if(l.default.Config.createHmac){var C=l.default.Config.createHmac("SHA256",I);return C.update(P),C.digest("base64")}return(0,O.stringify)((0,m.default)(P,I))};function f(P){if(!P)return"";typeof P=="string"&&(P=JSON.parse(P));var I=Object.create(null),C=u.keysArray(P,!0);if(!C)return"";C.sort();for(var A=0;A<C.length;A++)I[C[A]]=P[C[A]].sort();return JSON.stringify(I)}function c(P){if(P.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(P.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(P.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(P.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var I="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",I),new Error(I)}}function a(P){return"useTokenAuth"in P&&!P.useTokenAuth}function v(P){return P.useTokenAuth||!a(P)&&(P.authCallback||P.authUrl||P.token||P.tokenDetails)}function g(P){return!P.key&&!P.authCallback&&!P.authUrl}var S=0;function D(){return S++}var k=function(){function P(I,C){if(this.authOptions={},this.client=I,this.tokenParams=C.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,v(C)){if(C.key&&!p){var A="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",A),new Error(A)}g(C)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(C.defaultTokenParams,C),c(this.authOptions)}else{if(!C.key){var A="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",A),new h.default(A,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(C)}}return P.prototype.authorize=function(I,C,A){var L=this,U;if(typeof I=="function"&&!A?(A=I,U=I=null):typeof C=="function"&&!A?(A=C,U=null):U=C,!A&&this.client.options.promises)return u.promisify(this,"authorize",arguments);if(U&&U.key&&this.authOptions.key!==U.key)throw new h.default("Unable to update auth options with incompatible key",40102,401);U&&"force"in U&&(o.default.deprecated("The `force` auth option","If youre using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the librarys stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if youre currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),u.isOnlyPropIn(U,"force")&&(U=null)),this._forceNewToken(I,U,function(B,$){if(B){L.client.connection&&B.statusCode===x.default.Forbidden&&L.client.connection.connectionManager.actOnErrorFromAuthorize(B),A==null||A(B);return}y(L.client)?L.client.connection.connectionManager.onAuthUpdated($,A||M):A==null||A(null,$)})},P.prototype.authorise=function(I,C,A){o.default.renamedMethod("Auth","authorise","authorize"),this.authorize(I,C,A)},P.prototype._forceNewToken=function(I,C,A){var L=this;this.tokenDetails=null,this._saveTokenOptions(I,C),c(this.authOptions),this._ensureValidAuthCredentials(!0,function(U,B){delete L.tokenParams.timestamp,delete L.authOptions.queryTime,A(U,B)})},P.prototype.requestToken=function(I,C,A){var L=this;if(typeof I=="function"&&!A?(A=I,C=I=null):typeof C=="function"&&!A&&(A=C,C=null),!A&&this.client.options.promises)return u.promisify(this,"requestToken",arguments);C=C||this.authOptions,I=I||u.copy(this.tokenParams);var U=A||M,B,$=this.client;if(C.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),B=C.authCallback;else if(C.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),B=function(j,W){var J=u.mixin({accept:"application/json, text/plain"},C.authHeaders),Y=C.authMethod&&C.authMethod.toLowerCase()==="post",X,ee=C.authUrl.indexOf("?");ee>-1&&(X=u.parseQueryString(C.authUrl.slice(ee)),C.authUrl=C.authUrl.slice(0,ee),Y||(C.authParams=u.mixin(X,C.authParams)));var re=u.mixin({},C.authParams||{},j),Q=function(me,fe,Le,pt){var xe;if(me?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+u.inspectError(me)):(xe=Le["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+xe+"; body: "+u.inspectBody(fe))),me||pt)return W(me,fe);if(l.default.BufferUtils.isBuffer(fe)&&(fe=fe.toString()),!xe){W(new h.default("authUrl response is missing a content-type header",40170,401));return}var gt=xe.indexOf("application/json")>-1,Qt=xe.indexOf("text/plain")>-1||xe.indexOf("application/jwt")>-1;if(!gt&&!Qt){W(new h.default("authUrl responded with unacceptable content-type "+xe+", should be either text/plain, application/jwt or application/json",40170,401));return}if(gt){if(fe.length>R){W(new h.default("authUrl response exceeded max permitted length",40170,401));return}try{fe=JSON.parse(fe)}catch(Xt){W(new h.default("Unexpected error processing authURL response; err = "+Xt.message,40170,401));return}}W(null,fe,xe)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+C.authUrl+"; Params: "+JSON.stringify(re)+"; method: "+(Y?"POST":"GET")),Y){var ie=J||{};ie["content-type"]="application/x-www-form-urlencoded";var de=u.toQueryString(re).slice(1);L.client.http.doUri(w.default.Post,$,C.authUrl,ie,de,X,Q)}else L.client.http.doUri(w.default.Get,$,C.authUrl,J||{},null,re,Q)};else if(C.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),B=function(j,W){L.createTokenRequest(j,C,W)};else{var V="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),U(new h.default(V,40171,403));return}"capability"in I&&(I.capability=f(I.capability));var H=function(j,W){var J=j.keyName,Y="/keys/"+J+"/requestToken",X=function(re){return $.baseUri(re)+Y},ee=u.defaultPostHeaders(L.client.options);C.requestHeaders&&u.mixin(ee,C.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+Y+"; Token params: "+JSON.stringify(j)),L.client.http.do(w.default.Post,$,X,ee,JSON.stringify(j),null,W)},_=!1,N=this.client.options.timeouts.realtimeRequestTimeout,F=setTimeout(function(){_=!0;var j="Token request callback timed out after "+N/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",j),U(new h.default(j,40170,401))},N);B(I,function(j,W,J){if(!_){if(clearTimeout(F),j){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+u.inspectError(j)),U(T(j));return}if(typeof W=="string"){W.length===0?U(new h.default("Token string is empty",40170,401)):W.length>R?U(new h.default("Token string exceeded max permitted length (was "+W.length+" bytes)",40170,401)):W==="undefined"||W==="null"?U(new h.default("Token string was literal null/undefined",40170,401)):W[0]==="{"&&!(J&&J.indexOf("application/jwt")>-1)?U(new h.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):U(null,{token:W});return}if(typeof W!="object"){var Y="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof W;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Y),U(new h.default(Y,40170,401));return}var X=JSON.stringify(W).length;if(X>R&&!C.suppressMaxLengthCheck){U(new h.default("Token request/details object exceeded max permitted stringified size (was "+X+" bytes)",40170,401));return}if("issued"in W){U(null,W);return}if(!("keyName"in W)){var Y="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Y),U(new h.default(Y,40170,401));return}H(W,function(ee,re,Q,ie){if(ee){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+u.inspectError(ee)),U(T(ee));return}ie||(re=JSON.parse(re)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),U(null,re)})}})},P.prototype.createTokenRequest=function(I,C,A){var L=this;if(typeof I=="function"&&!A?(A=I,C=I=null):typeof C=="function"&&!A&&(A=C,C=null),!A&&this.client.options.promises)return u.promisify(this,"createTokenRequest",arguments);C=C||this.authOptions,I=I||u.copy(this.tokenParams);var U=C.key;if(!U){A(new h.default("No key specified",40101,403));return}var B=U.split(":"),$=B[0],V=B[1];if(!V){A(new h.default("Invalid key specified",40101,403));return}if(I.clientId===""){A(new h.default("clientId cant be an empty string",40012,400));return}"capability"in I&&(I.capability=f(I.capability));var H=u.mixin({keyName:$},I),_=I.clientId||"",N=I.ttl||"",F=I.capability||"";(function(j){if(H.timestamp){j();return}L.getTimestamp(C&&C.queryTime,function(W,J){if(W){A(W);return}H.timestamp=J,j()})})(function(){var j=H.nonce||(H.nonce=b()),W=H.timestamp,J=H.keyName+`
`+N+`
`+F+`
`+_+`
`+W+`
`+j+`
`;H.mac=H.mac||p(J,V),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),A(null,H)})},P.prototype.getAuthParams=function(I){this.method=="basic"?I(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(C,A){if(C){I(C);return}if(!A)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");I(null,{access_token:A.token})})},P.prototype.getAuthHeaders=function(I){this.method=="basic"?I(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(C,A){if(C){I(C);return}if(!A)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");I(null,{authorization:"Bearer "+u.toBase64(A.token)})})},P.prototype.getTimestamp=function(I,C){!this.isTimeOffsetSet()&&(I||this.authOptions.queryTime)?this.client.time(C):C(null,this.getTimestampUsingOffset())},P.prototype.getTimestampUsingOffset=function(){return u.now()+(this.client.serverTimeOffset||0)},P.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},P.prototype._saveBasicOptions=function(I){this.method="basic",this.key=I.key,this.basicKey=u.toBase64(I.key),this.authOptions=I||{},"clientId"in I&&this._userSetClientId(I.clientId)},P.prototype._saveTokenOptions=function(I,C){this.method="token",I&&(this.tokenParams=I),C&&(C.token&&(C.tokenDetails=typeof C.token=="string"?{token:C.token}:C.token),C.tokenDetails&&(this.tokenDetails=C.tokenDetails),"clientId"in C&&this._userSetClientId(C.clientId),this.authOptions=C)},P.prototype._ensureValidAuthCredentials=function(I,C){var A=this,L=this.tokenDetails;if(L){if(this._tokenClientIdMismatch(L.clientId)){C(new h.default("Mismatch between clientId in token ("+L.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!L.expires||L.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+L.expires),C(null,L);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=d.default.create())).push(C),!(this.currentTokenRequestId!==null&&!I)){var U=this.currentTokenRequestId=D();this.requestToken(this.tokenParams,this.authOptions,function(B,$){if(A.currentTokenRequestId>U){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}A.currentTokenRequestId=null;var V=A.waitingForTokenRequest||M;if(A.waitingForTokenRequest=null,B){V(B);return}V(null,A.tokenDetails=$)})}},P.prototype._userSetClientId=function(I){if(typeof I=="string"||I===null){if(I==="*")throw new h.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var C=this._uncheckedSetClientId(I);if(C)throw C}else throw new h.default("clientId must be either a string or null",40012,400)},P.prototype._uncheckedSetClientId=function(I){if(this._tokenClientIdMismatch(I)){var C="Unexpected clientId mismatch: client has "+this.clientId+", requested "+I,A=new h.default(C,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",C),A}else return this.clientId=this.tokenParams.clientId=I,null},P.prototype._tokenClientIdMismatch=function(I){return!!(this.clientId&&this.clientId!=="*"&&I&&I!=="*"&&this.clientId!==I)},P.isTokenErr=function(I){return I.code&&I.code>=40140&&I.code<40150},P.prototype.revokeTokens=function(I,C,A){if(v(this.client.options))throw new h.default("Cannot revoke tokens when using token auth",40162,401);var L=this.client.options.keyName,U;if(typeof C=="function"?(A=C,U={}):U=C??{},A===void 0){if(this.client.options.promises)return u.promisify(this,"revokeTokens",[I,U]);A=M}var B=A,$=s.__assign({targets:I.map(function(N){return"".concat(N.type,":").concat(N.value)})},U),V=this.client.options.useBinaryProtocol?u.Format.msgpack:u.Format.json,H=u.defaultPostHeaders(this.client.options,V);this.client.options.headers&&u.mixin(H,this.client.options.headers);var _=u.encodeBody($,V);E.default.post(this.client,"/keys/".concat(L,"/revokeTokens"),_,H,{newBatchResponse:"true"},null,function(N,F,j,W){if(N){B(N);return}var J=W?F:u.decodeBody(F,V);B(null,J)})},P}();t.default=k},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(s||(s={})),t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.HttpPaginatedResponse=t.PaginatedResult=void 0;var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(2)),d=s.__importDefault(i(15)),h=s.__importDefault(i(14));function m(R){var M=R.match(/^\.\/(\w+)\?(.*)$/);return M&&M[2]&&o.parseQueryString(M[2])}function O(R){typeof R=="string"&&(R=R.split(","));for(var M={},b=0;b<R.length;b++){var y=R[b].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(y){var T=m(y[1]);T&&(M[y[2]]=T)}}return M}function w(R,M,b){return!(b&&(M||typeof R.code=="number"))}var x=function(){function R(M,b,y,T,p,f){this.rest=M,this.path=b,this.headers=y,this.envelope=T??null,this.bodyHandler=p,this.useHttpPaginatedResponse=f||!1}return R.prototype.get=function(M,b){var y=this;d.default.get(this.rest,this.path,this.headers,M,this.envelope,function(T,p,f,c,a){y.handlePage(T,p,f,c,a,b)})},R.prototype.delete=function(M,b){var y=this;d.default.delete(this.rest,this.path,this.headers,M,this.envelope,function(T,p,f,c,a){y.handlePage(T,p,f,c,a,b)})},R.prototype.post=function(M,b,y){var T=this;d.default.post(this.rest,this.path,b,this.headers,M,this.envelope,function(p,f,c,a,v){y&&T.handlePage(p,f,c,a,v,y)})},R.prototype.put=function(M,b,y){var T=this;d.default.put(this.rest,this.path,b,this.headers,M,this.envelope,function(p,f,c,a,v){y&&T.handlePage(p,f,c,a,v,y)})},R.prototype.patch=function(M,b,y){var T=this;d.default.patch(this.rest,this.path,b,this.headers,M,this.envelope,function(p,f,c,a,v){y&&T.handlePage(p,f,c,a,v,y)})},R.prototype.handlePage=function(M,b,y,T,p,f){if(M&&w(M,b,this.useHttpPaginatedResponse)){u.default.logAction(u.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(M)),f==null||f(M);return}var c,a,v;try{c=p==h.default.NoContent?[]:this.bodyHandler(b,y||{},T)}catch(g){f==null||f(M||g);return}y&&(a=y.Link||y.link)&&(v=O(a)),this.useHttpPaginatedResponse?f(null,new E(this,c,y||{},p,v,M)):f(null,new l(this,c,v))},R}(),l=function(){function R(M,b,y){var T=this;this.resource=M,this.items=b;var p=this;y&&("first"in y&&(this.first=function(f){if(!f&&p.resource.rest.options.promises)return o.promisify(p,"first",[]);p.get(y.first,f)}),"current"in y&&(this.current=function(f){if(!f&&p.resource.rest.options.promises)return o.promisify(p,"current",[]);p.get(y.current,f)}),this.next=function(f){if(!f&&p.resource.rest.options.promises)return o.promisify(p,"next",[]);"next"in y?p.get(y.next,f):f(null,null)},this.hasNext=function(){return"next"in y},this.isLast=function(){var f;return!(!((f=T.hasNext)===null||f===void 0)&&f.call(T))})}return R.prototype.get=function(M,b){var y=this.resource;d.default.get(y.rest,y.path,y.headers,M,y.envelope,function(T,p,f,c,a){y.handlePage(T,p,f,c,a,b)})},R}();t.PaginatedResult=l;var E=function(R){s.__extends(M,R);function M(b,y,T,p,f,c){var a=R.call(this,b,y,f)||this;return a.statusCode=p,a.success=p<300&&p>=200,a.headers=T,a.errorCode=c&&c.code,a.errorMessage=c&&c.message,a}return M.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},M}(l);t.HttpPaginatedResponse=E,t.default=x},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isRetriable=void 0;var s=i(0),o=s.__importDefault(i(4)),u={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},d={disconnected:function(){return o.default.fromValues({statusCode:400,code:u.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return o.default.fromValues({statusCode:400,code:u.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return o.default.fromValues({statusCode:400,code:u.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return o.default.fromValues({statusCode:400,code:u.CLOSING,message:"Connection closing"})},closed:function(){return o.default.fromValues({statusCode:400,code:u.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return o.default.fromValues({statusCode:500,code:u.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return o.default.fromValues({statusCode:500,code:u.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function h(m){return!m.statusCode||!m.code||m.statusCode>=500?!0:Object.values(u).includes(m.code)}t.isRetriable=h,t.default=d},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6),i(5),i(58),i(11),i(40),i(32),i(25),i(27),i(28),i(59),i(60))})(this,function(s){return s})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),u=function(){function d(h){this.members=h||[]}return d.prototype.call=function(){for(var h=[],m=0;m<arguments.length;m++)h[m]=arguments[m];for(var O=0,w=this.members;O<w.length;O++){var x=w[O];if(x)try{x.apply(void 0,h)}catch(l){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+l+"; stack = "+l.stack)}}},d.prototype.push=function(){for(var h,m=[],O=0;O<arguments.length;O++)m[O]=arguments[O];(h=this.members).push.apply(h,m)},d.create=function(h){var m=new d(h);return Object.assign(function(){for(var O=[],w=0;w<arguments.length;w++)O[w]=arguments[w];return m.call.apply(m,O)},{push:function(O){return m.push(O)}})},d}();t.default=u},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){(function(){var o=s,u=o.lib,d=u.Base,h=o.enc,m=h.Utf8,O=o.algo;O.HMAC=d.extend({init:function(w,x){w=this._hasher=new w.init,typeof x=="string"&&(x=m.parse(x));var l=w.blockSize,E=l*4;x.sigBytes>E&&(x=w.finalize(x)),x.clamp();for(var R=this._oKey=x.clone(),M=this._iKey=x.clone(),b=R.words,y=M.words,T=0;T<l;T++)b[T]^=1549556828,y[T]^=909522486;R.sigBytes=M.sigBytes=E,this.reset()},reset:function(){var w=this._hasher;w.reset(),w.update(this._iKey)},update:function(w){return this._hasher.update(w),this},finalize:function(w){var x=this._hasher,l=x.finalize(w);x.reset();var E=x.finalize(this._oKey.clone().concat(l));return E}})})()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),u=s.__importStar(i(1)),d=s.__importDefault(i(7)),h=s.__importDefault(i(2)),m=s.__importDefault(i(21)),O=s.__importDefault(i(4)),w=s.__importDefault(i(3)),x=o.default.Action,l=o.default.fromValues({action:x.CLOSE}),E=o.default.fromValues({action:x.DISCONNECT}),R=function(M){s.__extends(b,M);function b(y,T,p,f){var c=M.call(this)||this;return f&&(p.format=void 0,p.heartbeats=!0),c.connectionManager=y,y.registerProposedTransport(c),c.auth=T,c.params=p,c.timeouts=p.options.timeouts,c.format=p.format,c.isConnected=!1,c.isFinished=!1,c.isDisposed=!1,c.maxIdleInterval=null,c.idleTimer=null,c.lastActivity=null,c}return b.prototype.connect=function(){},b.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",m.default.closed())},b.prototype.disconnect=function(y){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",y||m.default.disconnected())},b.prototype.fail=function(y){this.isConnected&&this.requestDisconnect(),this.finish("failed",y||m.default.failed())},b.prototype.finish=function(y,T){var p;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((p=this.idleTimer)!==null&&p!==void 0?p:void 0),this.idleTimer=null,this.emit(y,T),this.dispose())},b.prototype.onProtocolMessage=function(y){switch(h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(y)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),y.action){case x.HEARTBEAT:h.default.logAction(h.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",y.id);break;case x.CONNECTED:this.onConnect(y),this.emit("connected",y.error,y.connectionId,y.connectionDetails,y);break;case x.CLOSED:this.onClose(y);break;case x.DISCONNECTED:this.onDisconnect(y);break;case x.ACK:this.emit("ack",y.msgSerial,y.count);break;case x.NACK:this.emit("nack",y.msgSerial,y.count,y.error);break;case x.SYNC:this.connectionManager.onChannelMessage(y,this);break;case x.ACTIVATE:break;case x.AUTH:this.auth.authorize(function(T){T&&h.default.logAction(h.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+u.inspectError(T))});break;case x.ERROR:if(h.default.logAction(h.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+w.default.Config.inspect(y.error)+(y.channel?", channel: "+y.channel:"")),y.channel===void 0){this.onFatalError(y);break}this.connectionManager.onChannelMessage(y,this);break;default:this.connectionManager.onChannelMessage(y,this)}},b.prototype.onConnect=function(y){if(this.isConnected=!0,!y.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var T=y.connectionDetails.maxIdleInterval;T&&(this.maxIdleInterval=T+this.timeouts.realtimeRequestTimeout,this.onActivity())},b.prototype.onDisconnect=function(y){var T=y&&y.error;h.default.logAction(h.default.LOG_MINOR,"Transport.onDisconnect()","err = "+u.inspectError(T)),this.finish("disconnected",T)},b.prototype.onFatalError=function(y){var T=y&&y.error;h.default.logAction(h.default.LOG_MINOR,"Transport.onFatalError()","err = "+u.inspectError(T)),this.finish("failed",T)},b.prototype.onClose=function(y){var T=y&&y.error;h.default.logAction(h.default.LOG_MINOR,"Transport.onClose()","err = "+u.inspectError(T)),this.finish("closed",T)},b.prototype.requestClose=function(){h.default.logAction(h.default.LOG_MINOR,"Transport.requestClose()",""),this.send(l)},b.prototype.requestDisconnect=function(){h.default.logAction(h.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(E)},b.prototype.ping=function(y){var T={action:o.default.Action.HEARTBEAT};y&&(T.id=y),this.send(o.default.fromValues(T))},b.prototype.dispose=function(){h.default.logAction(h.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},b.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=u.now(),this.setIdleTimer(this.maxIdleInterval+100))},b.prototype.setIdleTimer=function(y){var T=this;this.idleTimer||(this.idleTimer=setTimeout(function(){T.onIdleTimerExpire()},y))},b.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var y=u.now()-this.lastActivity,T=this.maxIdleInterval-y;if(T<=0){var p="No activity seen from realtime in "+y+"ms; assuming connection has dropped";h.default.logAction(h.default.LOG_ERROR,"Transport.onIdleTimerExpire()",p),this.disconnect(new O.default(p,80003,408))}else this.setIdleTimer(T+100)},b.tryConnect=function(y,T,p,f,c){var a=new y(T,p,f),v,g=function(D){clearTimeout(v),c({event:this.event,error:D})},S=T.options.timeouts.realtimeRequestTimeout;v=setTimeout(function(){a.off(["preconnect","disconnected","failed"]),a.dispose(),g.call({event:"disconnected"},new O.default("Timeout waiting for transport to indicate itself viable",5e4,500))},S),a.on(["failed","disconnected"],g),a.on("preconnect",function(){h.default.logAction(h.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+a),clearTimeout(v),a.off(["failed","disconnected"],g),c(null,a)}),a.connect()},b}(d.default);t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6),i(40),i(25))})(this,function(s){return function(){var o=s,u=o.lib,d=u.Base,h=u.WordArray,m=o.algo,O=m.MD5,w=m.EvpKDF=d.extend({cfg:d.extend({keySize:128/32,hasher:O,iterations:1}),init:function(x){this.cfg=this.cfg.extend(x)},compute:function(x,l){for(var E,R=this.cfg,M=R.hasher.create(),b=h.create(),y=b.words,T=R.keySize,p=R.iterations;y.length<T;){E&&M.update(E),E=M.update(x).finalize(l),M.reset();for(var f=1;f<p;f++)E=M.finalize(E),M.reset();b.concat(E)}return b.sigBytes=T*4,b}});o.EvpKDF=function(x,l,E){return w.create(E).compute(x,l)}}(),s.EvpKDF})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(27))})(this,function(s){s.lib.Cipher||function(o){var u=s,d=u.lib,h=d.Base,m=d.WordArray,O=d.BufferedBlockAlgorithm,w=u.enc;w.Utf8;var x=w.Base64,l=u.algo,E=l.EvpKDF,R=d.Cipher=O.extend({cfg:h.extend(),createEncryptor:function(k,P){return this.create(this._ENC_XFORM_MODE,k,P)},createDecryptor:function(k,P){return this.create(this._DEC_XFORM_MODE,k,P)},init:function(k,P,I){this.cfg=this.cfg.extend(I),this._xformMode=k,this._key=P,this.reset()},reset:function(){O.reset.call(this),this._doReset()},process:function(k){return this._append(k),this._process()},finalize:function(k){k&&this._append(k);var P=this._doFinalize();return P},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function k(P){return typeof P=="string"?D:v}return function(P){return{encrypt:function(I,C,A){return k(C).encrypt(P,I,C,A)},decrypt:function(I,C,A){return k(C).decrypt(P,I,C,A)}}}}()});d.StreamCipher=R.extend({_doFinalize:function(){var k=this._process(!0);return k},blockSize:1});var M=u.mode={},b=d.BlockCipherMode=h.extend({createEncryptor:function(k,P){return this.Encryptor.create(k,P)},createDecryptor:function(k,P){return this.Decryptor.create(k,P)},init:function(k,P){this._cipher=k,this._iv=P}}),y=M.CBC=function(){var k=b.extend();k.Encryptor=k.extend({processBlock:function(I,C){var A=this._cipher,L=A.blockSize;P.call(this,I,C,L),A.encryptBlock(I,C),this._prevBlock=I.slice(C,C+L)}}),k.Decryptor=k.extend({processBlock:function(I,C){var A=this._cipher,L=A.blockSize,U=I.slice(C,C+L);A.decryptBlock(I,C),P.call(this,I,C,L),this._prevBlock=U}});function P(I,C,A){var L,U=this._iv;U?(L=U,this._iv=o):L=this._prevBlock;for(var B=0;B<A;B++)I[C+B]^=L[B]}return k}(),T=u.pad={},p=T.Pkcs7={pad:function(k,P){for(var I=P*4,C=I-k.sigBytes%I,A=C<<24|C<<16|C<<8|C,L=[],U=0;U<C;U+=4)L.push(A);var B=m.create(L,C);k.concat(B)},unpad:function(k){var P=k.words[k.sigBytes-1>>>2]&255;k.sigBytes-=P}};d.BlockCipher=R.extend({cfg:R.cfg.extend({mode:y,padding:p}),reset:function(){var k;R.reset.call(this);var P=this.cfg,I=P.iv,C=P.mode;this._xformMode==this._ENC_XFORM_MODE?k=C.createEncryptor:(k=C.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==k?this._mode.init(this,I&&I.words):(this._mode=k.call(C,this,I&&I.words),this._mode.__creator=k)},_doProcessBlock:function(k,P){this._mode.processBlock(k,P)},_doFinalize:function(){var k,P=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(P.pad(this._data,this.blockSize),k=this._process(!0)):(k=this._process(!0),P.unpad(k)),k},blockSize:128/32});var f=d.CipherParams=h.extend({init:function(k){this.mixIn(k)},toString:function(k){return(k||this.formatter).stringify(this)}}),c=u.format={},a=c.OpenSSL={stringify:function(k){var P,I=k.ciphertext,C=k.salt;return C?P=m.create([1398893684,1701076831]).concat(C).concat(I):P=I,P.toString(x)},parse:function(k){var P,I=x.parse(k),C=I.words;return C[0]==1398893684&&C[1]==1701076831&&(P=m.create(C.slice(2,4)),C.splice(0,4),I.sigBytes-=16),f.create({ciphertext:I,salt:P})}},v=d.SerializableCipher=h.extend({cfg:h.extend({format:a}),encrypt:function(k,P,I,C){C=this.cfg.extend(C);var A=k.createEncryptor(I,C),L=A.finalize(P),U=A.cfg;return f.create({ciphertext:L,key:I,iv:U.iv,algorithm:k,mode:U.mode,padding:U.padding,blockSize:k.blockSize,formatter:C.format})},decrypt:function(k,P,I,C){C=this.cfg.extend(C),P=this._parse(P,C.format);var A=k.createDecryptor(I,C).finalize(P.ciphertext);return A},_parse:function(k,P){return typeof k=="string"?P.parse(k,this):k}}),g=u.kdf={},S=g.OpenSSL={execute:function(k,P,I,C){C||(C=m.random(64/8));var A=E.create({keySize:P+I}).compute(k,C),L=m.create(A.words.slice(P),I*4);return A.sigBytes=P*4,f.create({key:A,iv:L,salt:C})}},D=d.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:S}),encrypt:function(k,P,I,C){C=this.cfg.extend(C);var A=C.kdf.execute(I,k.keySize,k.ivSize);C.iv=A.iv;var L=v.encrypt.call(this,k,P,A.key,C);return L.mixIn(A),L},decrypt:function(k,P,I,C){C=this.cfg.extend(C),P=this._parse(P,C.format);var A=C.kdf.execute(I,k.keySize,k.ivSize,P.salt);C.iv=A.iv;var L=v.decrypt.call(this,k,P,A.key,C);return L}})}()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.createRequest=void 0;var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(12)),d=s.__importDefault(i(3)),h=s.__importDefault(i(7)),m=i(4),O=s.__importDefault(i(8)),w=s.__importDefault(i(2)),x=s.__importDefault(i(22)),l=o.getGlobalObject(),E=function(){},R=l._ablyjs_jsonp={};R._=function(c){return R["_"+c]||E};var M=1,b="jsonp";function y(c,a,v,g,S,D,k){return D=D||O.default.TIMEOUTS,new p(void 0,c,a,o.copy(v),g,S,D,k)}t.createRequest=y;var T=function(c){s.__extends(a,c);function a(v,g,S){var D=c.call(this,v,g,S)||this;return D.shortName=b,S.stream=!1,D}return a.isAvailable=function(){return d.default.Config.jsonpSupported&&d.default.Config.allowComet},a.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},a.prototype.createRequest=function(v,g,S,D,k,P,I){return P=(this===null||this===void 0?void 0:this.timeouts)||P||O.default.TIMEOUTS,y(v,g,S,D,k,P,I)},a}(u.default),p=function(c){s.__extends(a,c);function a(v,g,S,D,k,P,I,C){var A=c.call(this)||this;return v===void 0&&(v=M++),A.id=v,A.uri=g,A.params=D||{},A.params.rnd=o.cheapRandStr(),S&&(S["X-Ably-Version"]&&(A.params.v=S["X-Ably-Version"]),S["X-Ably-Lib"]&&(A.params.lib=S["X-Ably-Lib"])),A.body=k,A.method=C,A.requestMode=P,A.timeouts=I,A.requestComplete=!1,A}return a.prototype.exec=function(){var v=this,g=this.id,S=this.body,D=this.method,k=this.uri,P=this.params;P.callback="_ablyjs_jsonp._("+g+")",P.envelope="jsonp",S&&(P.body=S),D&&D!=="get"&&(P.method=D);var I=this.script=document.createElement("script"),C=k+o.toQueryString(P);I.src=C,I.src.split("/").slice(-1)[0]!==C.split("/").slice(-1)[0]&&w.default.logAction(w.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),I.async=!0,I.type="text/javascript",I.charset="UTF-8",I.onerror=function(U){v.complete(new m.PartialErrorInfo("JSONP script error (event: "+d.default.Config.inspect(U)+")",null,400))},R["_"+g]=function(U){if(U.statusCode){var B=U.response;if(U.statusCode==204)v.complete(null,null,null,U.statusCode);else if(!B)v.complete(new m.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(U.statusCode<400||o.isArray(B))v.complete(null,B,U.headers,U.statusCode);else{var $=B.error||new m.PartialErrorInfo("Error response received from server",null,U.statusCode);v.complete($)}}else v.complete(null,U)};var A=this.requestMode==x.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),A);var L=document.getElementsByTagName("head")[0];L.insertBefore(I,L.firstChild)},a.prototype.complete=function(v,g,S,D){if(S=S||{},!this.requestComplete){this.requestComplete=!0;var k=void 0;g&&(k=typeof g=="string"?"text/plain":"application/json",S["content-type"]=k,this.emit("data",g)),this.emit("complete",v,g,S,!0,D),this.dispose()}},a.prototype.abort=function(){this.dispose()},a.prototype.dispose=function(){var v=this.timer;v&&(clearTimeout(v),this.timer=null);var g=this.script;g.parentNode&&g.parentNode.removeChild(g),delete R[this.id],this.emit("disposed")},a}(h.default);t.Request=p;function f(c){return l.JSONPTransport=T,T.isAvailable()&&(c.supportedTransports[b]=T),T}t.default=f},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(2)),d=s.__importDefault(i(8)),h=s.__importDefault(i(18)),m=s.__importDefault(i(46)),O=s.__importDefault(i(20)),w=s.__importDefault(i(33)),x=s.__importDefault(i(4)),l=s.__importDefault(i(49)),E=s.__importDefault(i(19)),R=s.__importDefault(i(3)),M=s.__importDefault(i(9)),b=s.__importDefault(i(16)),y=s.__importDefault(i(15)),T=function(){},p=function(){function c(a){if(!a){var v="no options provided";throw u.default.logAction(u.default.LOG_ERROR,"Rest()",v),new Error(v)}var g=d.default.objectifyOptions(a);g.log?(u.default.setLog(g.log.level,g.log.handler),u.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):u.default.setLog(g.logLevel,g.logHandler),u.default.logAction(u.default.LOG_MICRO,"Rest()","initialized with clientOptions "+R.default.Config.inspect(a));var S=this.options=d.default.normaliseOptions(g);if(S.key){var D=S.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!D){var v="invalid key parameter";throw u.default.logAction(u.default.LOG_ERROR,"Rest()",v),new x.default(v,40400,404)}S.keyName=D[1],S.keySecret=D[2]}if("clientId"in S)if(typeof S.clientId=="string"||S.clientId===null){if(S.clientId==="*")throw new x.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new x.default("clientId must be either a string or null",40012,400);u.default.logAction(u.default.LOG_MINOR,"Rest()","started; version = "+d.default.version),this.baseUri=this.authority=function(k){return d.default.getHttpScheme(S)+k+":"+d.default.getPort(S,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new R.default.Http(S),this.auth=new h.default(this,S),this.channels=new f(this),this.push=new m.default(this)}return c.prototype.stats=function(a,v){if(v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.options.promises)return o.promisify(this,"stats",[a]);v=T}var g=o.defaultGetHeaders(this.options),S=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,D=this.http.supportsLinkHeaders?void 0:S;this.options.headers&&o.mixin(g,this.options.headers),new O.default(this,"/stats",g,D,function(k,P,I){for(var C=I?k:JSON.parse(k),A=0;A<C.length;A++)C[A]=l.default.fromValues(C[A]);return C}).get(a,v)},c.prototype.time=function(a,v){var g=this;if(v===void 0){if(typeof a=="function")v=a,a=null;else if(this.options.promises)return o.promisify(this,"time",[a])}var S=v||T,D=o.defaultGetHeaders(this.options);this.options.headers&&o.mixin(D,this.options.headers);var k=function(P){return g.authority(P)+"/time"};this.http.do(E.default.Get,this,k,D,null,a,function(P,I,C,A){if(P){S(P);return}A||(I=JSON.parse(I));var L=I[0];if(!L){S(new x.default("Internal error (unexpected result type from GET /time)",5e4,500));return}g.serverTimeOffset=L-o.now(),S(null,L)})},c.prototype.request=function(a,v,g,S,D,k){var P=this.options.useBinaryProtocol,I=P?R.default.Config.msgpack.encode:JSON.stringify,C=P?R.default.Config.msgpack.decode:JSON.parse,A=P?o.Format.msgpack:o.Format.json,L=this.http.supportsLinkHeaders?void 0:A;g=g||{};var U=a.toLowerCase(),B=U=="get"?o.defaultGetHeaders(this.options,A):o.defaultPostHeaders(this.options,A);if(k===void 0){if(this.options.promises)return o.promisify(this,"request",[a,v,g,S,D]);k=T}typeof S!="string"&&(S=I(S)),this.options.headers&&o.mixin(B,this.options.headers),D&&o.mixin(B,D);var $=new O.default(this,v,B,L,function(V,H,_){return o.ensureArray(_?V:C(V))},!0);if(!o.arrIn(R.default.Http.methods,U))throw new x.default("Unsupported method "+U,40500,405);o.arrIn(R.default.Http.methodsWithBody,U)?$[U](g,S,k):$[U](g,k)},c.prototype.batchPublish=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPublish",[a]);v=T}var g=v,S,D;o.isArray(a)?(S=a,D=!1):(S=[a],D=!0);var k=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,P=o.defaultPostHeaders(this.options,k);this.options.headers&&o.mixin(P,this.options.headers);var I=o.encodeBody(S,k);y.default.post(this,"/messages",I,P,{newBatchResponse:"true"},null,function(C,A,L,U){if(C){g(C);return}var B=U?A:o.decodeBody(A,k);D?g(null,B[0]):g(null,B)})},c.prototype.batchPresence=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPresence",[a]);v=T}var g=v,S=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,D=o.defaultPostHeaders(this.options,S);this.options.headers&&o.mixin(D,this.options.headers);var k=a.join(",");y.default.get(this,"/presence",D,{newBatchResponse:"true",channels:k},null,function(P,I,C,A){if(P){g(P);return}var L=A?I:o.decodeBody(I,S);g(null,L)})},c.prototype.setLog=function(a){u.default.setLog(a.level,a.handler)},c.Promise=function(a){return a=d.default.objectifyOptions(a),a.promises=!0,new c(a)},c.Callbacks=c,c.Platform=R.default,c.Message=M.default,c.PresenceMessage=b.default,c}(),f=function(){function c(a){this.rest=a,this.all=Object.create(null)}return c.prototype.get=function(a,v){a=String(a);var g=this.all[a];return g?v&&g.setOptions(v):this.all[a]=g=new w.default(this.rest,a,v),g},c.prototype.release=function(a){delete this.all[String(a)]},c}();t.default=p},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Utf8})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var u=s,d=u.lib,h=d.WordArray,m=d.Hasher,O=u.algo,w=[],x=[];(function(){function R(T){for(var p=o.sqrt(T),f=2;f<=p;f++)if(!(T%f))return!1;return!0}function M(T){return(T-(T|0))*4294967296|0}for(var b=2,y=0;y<64;)R(b)&&(y<8&&(w[y]=M(o.pow(b,1/2))),x[y]=M(o.pow(b,1/3)),y++),b++})();var l=[],E=O.SHA256=m.extend({_doReset:function(){this._hash=new h.init(w.slice(0))},_doProcessBlock:function(R,M){for(var b=this._hash.words,y=b[0],T=b[1],p=b[2],f=b[3],c=b[4],a=b[5],v=b[6],g=b[7],S=0;S<64;S++){if(S<16)l[S]=R[M+S]|0;else{var D=l[S-15],k=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,P=l[S-2],I=(P<<15|P>>>17)^(P<<13|P>>>19)^P>>>10;l[S]=k+l[S-7]+I+l[S-16]}var C=c&a^~c&v,A=y&T^y&p^T&p,L=(y<<30|y>>>2)^(y<<19|y>>>13)^(y<<10|y>>>22),U=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),B=g+U+C+x[S]+l[S],$=L+A;g=v,v=a,a=c,c=f+B|0,f=p,p=T,T=y,y=B+$|0}b[0]=b[0]+y|0,b[1]=b[1]+T|0,b[2]=b[2]+p|0,b[3]=b[3]+f|0,b[4]=b[4]+c|0,b[5]=b[5]+a|0,b[6]=b[6]+v|0,b[7]=b[7]+g|0},_doFinalize:function(){var R=this._data,M=R.words,b=this._nDataBytes*8,y=R.sigBytes*8;return M[y>>>5]|=128<<24-y%32,M[(y+64>>>9<<4)+14]=o.floor(b/4294967296),M[(y+64>>>9<<4)+15]=b,R.sigBytes=M.length*4,this._process(),this._hash},clone:function(){var R=m.clone.call(this);return R._hash=this._hash.clone(),R}});u.SHA256=m._createHelper(E),u.HmacSHA256=m._createHmacHelper(E)}(Math),s.SHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(7)),d=s.__importDefault(i(2)),h=s.__importDefault(i(34)),m=s.__importDefault(i(9)),O=s.__importDefault(i(4)),w=s.__importDefault(i(20)),x=s.__importDefault(i(15)),l=s.__importDefault(i(3));function E(){}var R=9;function M(T){return o.arrEvery(T,function(p){return!p.id})}function b(T){var p=T||{};if(p.cipher){if(!l.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var f=l.default.Crypto.getCipher(p.cipher);p.cipher=f.cipherParams,p.channelCipher=f.cipher}else"cipher"in p&&(p.cipher=void 0,p.channelCipher=null);return p}var y=function(T){s.__extends(p,T);function p(f,c,a){var v=T.call(this)||this;return d.default.logAction(d.default.LOG_MINOR,"Channel()","started; name = "+c),v.rest=f,v.name=c,v.basePath="/channels/"+encodeURIComponent(c),v.presence=new h.default(v),v.channelOptions=b(a),v}return p.prototype.setOptions=function(f){this.channelOptions=b(f)},p.prototype.history=function(f,c){if(d.default.logAction(d.default.LOG_MICRO,"Channel.history()","channel = "+this.name),c===void 0)if(typeof f=="function")c=f,f=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);c=E}this._history(f,c)},p.prototype._history=function(f,c){var a=this.rest,v=a.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,g=this.rest.http.supportsLinkHeaders?void 0:v,S=o.defaultGetHeaders(a.options,v);a.options.headers&&o.mixin(S,a.options.headers);var D=this.channelOptions;new w.default(a,this.basePath+"/messages",S,g,function(k,P,I){return m.default.fromResponseBody(k,D,I?void 0:v)}).get(f,c)},p.prototype.publish=function(){var f=this,c=arguments.length,a=arguments[0],v=arguments[1],g=arguments[c-1],S,D;if(typeof g!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);g=E}if(typeof a=="string"||a===null)S=[m.default.fromValues({name:a,data:v})],D=arguments[2];else if(o.isObject(a))S=[m.default.fromValues(a)],D=arguments[1];else if(o.isArray(a))S=m.default.fromValuesArray(a),D=arguments[1];else throw new O.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof D!="object"||!D)&&(D={});var k=this.rest,P=k.options,I=P.useBinaryProtocol?o.Format.msgpack:o.Format.json,C=k.options.idempotentRestPublishing,A=o.defaultPostHeaders(k.options,I);if(P.headers&&o.mixin(A,P.headers),C&&M(S)){var L=o.randomString(R);o.arrForEach(S,function(U,B){U.id=L+":"+B.toString()})}m.default.encodeArray(S,this.channelOptions,function(U){if(U){g(U);return}var B=m.default.getMessagesSize(S),$=P.maxMessageSize;if(B>$){g(new O.default("Maximum size of messages that can be published at once exceeded ( was "+B+" bytes; limit is "+$+" bytes)",40009,400));return}f._publish(m.default.serialize(S,I),A,D,g)})},p.prototype._publish=function(f,c,a,v){x.default.post(this.rest,this.basePath+"/messages",f,c,a,null,v)},p.prototype.status=function(f){if(typeof f!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var c=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,a=o.defaultPostHeaders(this.rest.options,c);x.default.get(this.rest,this.basePath,a,{},c,f||E)},p}(u.default);t.default=y},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(7)),d=s.__importDefault(i(2)),h=s.__importDefault(i(20)),m=s.__importDefault(i(16));function O(){}var w=function(x){s.__extends(l,x);function l(E){var R=x.call(this)||this;return R.channel=E,R.basePath=E.basePath+"/presence",R}return l.prototype.get=function(E,R){if(d.default.logAction(d.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),R===void 0)if(typeof E=="function")R=E,E=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);R=O}var M=this.channel.rest,b=M.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=this.channel.rest.http.supportsLinkHeaders?void 0:b,T=o.defaultGetHeaders(M.options,b);M.options.headers&&o.mixin(T,M.options.headers);var p=this.channel.channelOptions;new h.default(M,this.basePath,T,y,function(f,c,a){return m.default.fromResponseBody(f,p,a?void 0:b)}).get(E,R)},l.prototype.history=function(E,R){return d.default.logAction(d.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(E,R)},l.prototype._history=function(E,R){if(R===void 0)if(typeof E=="function")R=E,E=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",[E]);R=O}var M=this.channel.rest,b=M.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,y=this.channel.rest.http.supportsLinkHeaders?void 0:b,T=o.defaultGetHeaders(M.options,b);M.options.headers&&o.mixin(T,M.options.headers);var p=this.channel.channelOptions;new h.default(M,this.basePath+"/history",T,y,function(f,c,a){return m.default.fromResponseBody(f,p,a?void 0:b)}).get(E,R)},l}(u.default);t.default=w},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.TransportParams=void 0;var o=i(0),u=o.__importDefault(i(10)),d=o.__importStar(i(1)),h=o.__importStar(i(52)),m=o.__importStar(i(8)),O=o.__importDefault(i(3)),w=o.__importDefault(i(7)),x=o.__importDefault(i(36)),l=o.__importDefault(i(2)),E=o.__importDefault(i(37)),R=o.__importStar(i(21)),M=o.__importStar(i(4)),b=o.__importDefault(i(18)),y=o.__importDefault(i(9)),T=o.__importDefault(i(24)),p=o.__importDefault(i(53)),f=o.__importDefault(i(26)),c=o.__importDefault(i(14)),a=function(){var V;return typeof O.default.WebStorage<"u"&&((V=O.default.WebStorage)===null||V===void 0?void 0:V.localSupported)},v=function(){var V;return typeof O.default.WebStorage<"u"&&((V=O.default.WebStorage)===null||V===void 0?void 0:V.sessionSupported)},g=u.default.Action,S=function(){},D="ably-transport-preference",k="ably-connection-recovery";function P(){var V,H;return v()&&((H=(V=O.default.WebStorage)===null||V===void 0?void 0:V.getSession)===null||H===void 0?void 0:H.call(V,k))}function I(V){var H,_;return v()&&((_=(H=O.default.WebStorage)===null||H===void 0?void 0:H.setSession)===null||_===void 0?void 0:_.call(H,k,V))}function C(){var V,H;return v()&&((H=(V=O.default.WebStorage)===null||V===void 0?void 0:V.removeSession)===null||H===void 0?void 0:H.call(V,k))}function A(V,H){return d.arrIndexOf(O.default.Defaults.transportPreferenceOrder,V.shortName)>d.arrIndexOf(O.default.Defaults.transportPreferenceOrder,H.shortName)}function L(V,H,_){var N;if(V.channel!==H.channel||(N=V.action)!==g.PRESENCE&&N!==g.MESSAGE||N!==H.action)return!1;var F=N===g.PRESENCE?"presence":"messages",j=V[F].concat(H[F]),W=y.default.getMessagesSize(j);return W>_||!d.allSame(j,"clientId")||!d.arrEvery(j,function(J){return!J.id})?!1:(V[F]=j,!0)}function U(V){try{return JSON.parse(V)}catch{return null}}var B=function(){function V(H,_,N,F){this.options=H,this.host=_,this.mode=N,this.connectionKey=F,this.format=H.useBinaryProtocol?d.Format.msgpack:d.Format.json}return V.prototype.getConnectParams=function(H){var _=H?d.copy(H):{},N=this.options;switch(this.mode){case"upgrade":_.upgrade=this.connectionKey;break;case"resume":_.resume=this.connectionKey;break;case"recover":{var F=U(N.recover);F&&(_.recover=F.connectionKey);break}}return N.clientId!==void 0&&(_.clientId=N.clientId),N.echoMessages===!1&&(_.echo="false"),this.format!==void 0&&(_.format=this.format),this.stream!==void 0&&(_.stream=this.stream),this.heartbeats!==void 0&&(_.heartbeats=this.heartbeats),_.v=m.default.protocolVersion,_.agent=(0,m.getAgentString)(this.options),N.transportParams!==void 0&&d.mixin(_,N.transportParams),_},V.prototype.toString=function(){var H="[mode="+this.mode;return this.host&&(H+=",host="+this.host),this.connectionKey&&(H+=",connectionKey="+this.connectionKey),this.format&&(H+=",format="+this.format),H+="]",H},V}();t.TransportParams=B;var $=function(V){o.__extends(H,V);function H(_,N){var F=V.call(this)||this;F.disconnectedRetryCount=0,H.initTransports(),F.realtime=_,F.options=N;var j=N.timeouts,W=j.preferenceConnectTimeout+j.realtimeRequestTimeout;if(F.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:W,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:j.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:j.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},F.state=F.states.initialized,F.errorReason=null,F.queuedMessages=new x.default,F.msgSerial=0,F.connectionDetails=void 0,F.connectionId=void 0,F.connectionKey=void 0,F.connectionStateTtl=j.connectionStateTtl,F.maxIdleInterval=null,F.transports=d.intersect(N.transports||m.default.defaultTransports,H.supportedTransports),F.baseTransport=d.intersect(m.default.baseTransportOrder,F.transports)[0],F.upgradeTransports=d.intersect(F.transports,m.default.upgradeTransports),F.transportPreference=null,F.httpHosts=m.default.getHosts(N),F.activeProtocol=null,F.proposedTransports=[],F.pendingTransports=[],F.host=null,F.lastAutoReconnectAttempt=null,F.lastActivity=null,F.forceFallbackHost=!1,F.connectCounter=0,l.default.logAction(l.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||m.default.defaultTransports)+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+F.transports+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+F.httpHosts+"]"),!F.transports.length){var J="no requested transports available";throw l.default.logAction(l.default.LOG_ERROR,"realtime.ConnectionManager()",J),new Error(J)}var Y=O.default.Config.addEventListener;return Y&&(v()&&typeof N.recover=="function"&&Y("beforeunload",F.persistConnection.bind(F)),N.closeOnUnload===!0&&Y("beforeunload",function(){l.default.logAction(l.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),F.requestState({state:"closing"})}),Y("online",function(){F.state==F.states.disconnected||F.state==F.states.suspended?(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),F.requestState({state:"connecting"})):F.state==F.states.connecting&&(F.pendingTransports.forEach(function(X){X.off()}),F.disconnectAllTransports(),F.startConnect())}),Y("offline",function(){F.state==F.states.connected&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),F.disconnectAllTransports())})),F}return H.initTransports=function(){(0,p.default)(H),d.arrForEach(O.default.Transports,function(_){_(H)})},H.prototype.createTransportParams=function(_,N){return new B(this.options,_,N,this.connectionKey)},H.prototype.getTransportParams=function(_){var N=this,F=function(j){if(N.connectionKey){j("resume");return}if(typeof N.options.recover=="string"){j("recover");return}var W=N.options.recover,J=P();if(J&&typeof W=="function"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),W(J,function(Y){Y?(N.options.recover=J.recoveryKey,j("recover")):j("clean")});return}j("clean")};F(function(j){var W=N.createTransportParams(null,j);if(j==="recover"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var J=U(N.options.recover);J&&(N.msgSerial=J.msgSerial)}else l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+W.toString());_(W)})},H.prototype.tryATransport=function(_,N,F){var j=this;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),f.default.tryConnect(H.supportedTransports[N],this,this.realtime.auth,_,function(W,J){var Y=j.state;if(Y==j.states.closing||Y==j.states.closed||Y==j.states.failed){J&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+Y.state+" while we were attempting the transport; closing "+J),J.close()),F(!0);return}if(W){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+W.event+", err: "+W.error.toString()),b.default.isTokenErr(W.error)&&!(j.errorReason&&b.default.isTokenErr(j.errorReason))?(j.errorReason=W.error,j.realtime.auth._forceNewToken(null,null,function(X){if(X){j.actOnErrorFromAuthorize(X);return}j.tryATransport(_,N,F)})):W.event==="failed"?(j.notifyState({state:"failed",error:W.error}),F(!0)):W.event==="disconnected"&&((0,R.isRetriable)(W.error)?F(!1):(j.notifyState({state:j.states.connecting.failState,error:W.error}),F(!0)));return}l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),j.setTransportPending(J,_),F(null,J)})},H.prototype.setTransportPending=function(_,N){var F=this,j=N.mode;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+_+"; mode = "+j),d.arrDeleteValue(this.proposedTransports,_),this.pendingTransports.push(_);var W=O.default.Defaults.transportPreferenceOrder[O.default.Defaults.transportPreferenceOrder.length-1];_.once("connected",function(Y,X,ee){j=="upgrade"&&F.activeProtocol?_.shortName!==W&&d.arrIn(F.getUpgradePossibilities(),W)&&F.activeProtocol?setTimeout(function(){F.scheduleTransportActivation(Y,_,X,ee)},F.options.timeouts.parallelUpgradeDelay):F.scheduleTransportActivation(Y,_,X,ee):(F.activateTransport(Y,_,X,ee),O.default.Config.nextTick(function(){F.connectImpl(N)})),j==="recover"&&F.options.recover&&(F.options.recover=null,F.unpersistConnection())});var J=this;_.on(["disconnected","closed","failed"],function(Y){J.deactivateTransport(_,this.event,Y)}),this.emit("transport.pending",_)},H.prototype.scheduleTransportActivation=function(_,N,F,j){var W=this,J=this.activeProtocol&&this.activeProtocol.getTransport(),Y=function(){N.disconnect(),d.arrDeleteValue(W.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Y();return}if(J&&!A(N,J)){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+J.shortName+" - abandoning upgrade"),Y();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var X=null;if(!N.isConnected){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),Y();return}if(this.state===this.states.connected)l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,X=this.activeProtocol;else if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Y();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N);var ee=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),N.send(u.default.fromValues({action:g.ACTIVATE})),W.activateTransport(_,N,F,j),W.state===W.states.synchronizing?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),W.state=W.states.connected):l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+W.state.state+", so leaving unchanged"),W.state.sendEvents&&W.sendQueuedMessages()};X?X.onceIdle(ee):ee()},H.prototype.activateTransport=function(_,N,F,j){var W=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),_&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+_),F&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+F),j&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(j)),this.persistTransportPreference(N);var J=this.state,Y=this.states.connected.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+J.state),J.state==this.states.closing.state||J.state==this.states.closed.state||J.state==this.states.failed.state)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(d.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var X=this.activeProtocol;this.activeProtocol=new h.default(N),this.host=N.params.host;var ee=j.connectionKey;if(ee&&this.connectionKey!=ee&&this.setConnection(F,j,!!_),this.onConnectionDetailsUpdate(j,N),O.default.Config.nextTick(function(){N.on("connected",function(Q,ie,de){W.onConnectionDetailsUpdate(de,N),W.emit("update",new E.default(Y,Y,null,Q))})}),J.state===this.states.connected.state?_&&(this.errorReason=this.realtime.connection.errorReason=_,this.emit("update",new E.default(Y,Y,null,_))):(this.notifyState({state:"connected",error:_}),this.errorReason=this.realtime.connection.errorReason=_||null),this.emit("transport.active",N),X)if(X.messageQueue.count()>0&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+X.transport.shortName+", new one is "+N.shortName+") finishing with "+X.messageQueue.count()+" messages still pending"),X.transport===N){var re="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",re)}else X.finish();return d.safeArrForEach(this.pendingTransports,function(Q){if(Q===N){var ie="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",ie),d.arrDeleteValue(W.pendingTransports,N)}else Q.disconnect()}),d.safeArrForEach(this.proposedTransports,function(Q){Q===N?(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),d.arrDeleteValue(W.proposedTransports,N)):Q.dispose()}),!0},H.prototype.deactivateTransport=function(_,N,F){var j=this.activeProtocol,W=j&&j.getTransport()===_,J=d.arrDeleteValue(this.pendingTransports,_),Y=d.arrDeleteValue(this.proposedTransports,_),X=this.noTransportsScheduledForActivation();if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+_),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(W?"; was active":J?"; was pending":Y?"; was proposed":"")+(X?"":"; another transport is scheduled for activation")),F&&F.message&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+F.message),W&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(j.getPendingMessages()),O.default.Config.nextTick(function(){j.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",_),W&&X||W&&N==="failed"||N==="closed"||j===null&&J&&this.pendingTransports.length===0){if(N==="disconnected"&&F&&F.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:F,retryImmediately:!0});return}var ee=N==="failed"&&b.default.isTokenErr(F)?"disconnected":N;this.notifyState({state:ee,error:F});return}W&&N==="disconnected"&&this.state!==this.states.synchronizing&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:F}))},H.prototype.noTransportsScheduledForActivation=function(){return d.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(_){return!_.isConnected})},H.prototype.setConnection=function(_,N,F){var j=this.connectionId,W=j&&j!==_,J=!j&&F;(W||J)&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==_&&l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=_,this.realtime.connection.key=this.connectionKey=N.connectionKey},H.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},H.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},H.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var _=d.now()-this.lastActivity;_>this.connectionStateTtl+this.maxIdleInterval&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+_+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},H.prototype.persistConnection=function(){if(v()){var _=this.createRecoveryKey();_&&I({recoveryKey:_,disconnectedAt:d.now(),location:s.location,clientId:this.realtime.auth.clientId})}},H.prototype.unpersistConnection=function(){C()},H.prototype.getError=function(){return this.errorReason||this.getStateError()},H.prototype.getStateError=function(){var _,N;return(N=(_=R.default)[this.state.state])===null||N===void 0?void 0:N.call(_)},H.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},H.prototype.enactStateChange=function(_){var N=_.current==="failed"?l.default.LOG_ERROR:l.default.LOG_MAJOR;l.default.logAction(N,"Connection state",_.current+(_.reason?"; reason: "+_.reason:"")),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+_.current+"; reason = "+(_.reason&&_.reason.message));var F=this.state=this.states[_.current];_.reason&&(this.errorReason=_.reason,this.realtime.connection.errorReason=_.reason),(F.terminal||F.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",_)},H.prototype.startTransitionTimer=function(_){var N=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+_.state),this.transitionTimer&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager "+_.state+" timer expired","requesting new state: "+_.failState),N.notifyState({state:_.failState}))},_.retryDelay)},H.prototype.cancelTransitionTimer=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},H.prototype.startSuspendTimer=function(){var _=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){_.suspendTimer&&(_.suspendTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),_.states.connecting.failState="suspended",_.notifyState({state:"suspended"}))},this.connectionStateTtl))},H.prototype.checkSuspendTimer=function(_){_!=="disconnected"&&_!=="suspended"&&_!=="connecting"&&this.cancelSuspendTimer()},H.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},H.prototype.startRetryTimer=function(_){var N=this;this.retryTimer=setTimeout(function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},_)},H.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},H.prototype.notifyState=function(_){var N=this,F,j,W=_.state,J=W==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||_.retryImmediately||this.state===this.states.connecting&&_.error&&b.default.isTokenErr(_.error)&&!(this.errorReason&&b.default.isTokenErr(this.errorReason)));if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+W+(J?"; will retry connection immediately":"")),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(_.state),(W==="suspended"||W==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var Y=this.states[_.state],X=Y.retryDelay;Y.state==="disconnected"&&(this.disconnectedRetryCount++,X=d.getRetryTime(Y.retryDelay,this.disconnectedRetryCount));var ee=new E.default(this.state.state,Y.state,X,_.error||((j=(F=R.default)[Y.state])===null||j===void 0?void 0:j.call(F)));if(J){var re=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=d.now(),N.requestState({state:"connecting"}))},Q=this.lastAutoReconnectAttempt&&d.now()-this.lastAutoReconnectAttempt+1;Q&&Q<1e3?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+Q+"ms ago, waiting another "+(1e3-Q)+"ms before trying again"),setTimeout(re,1e3-Q)):O.default.Config.nextTick(re)}else(W==="disconnected"||W==="suspended")&&this.startRetryTimer(X);(W==="disconnected"&&!J||W==="suspended"||Y.terminal)&&O.default.Config.nextTick(function(){N.disconnectAllTransports()}),W=="connected"&&!this.activeProtocol&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ee),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(W,ee.reason),this.failQueuedMessages(ee.reason))}},H.prototype.requestState=function(_){var N=this,F,j,W=_.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+W+"; current state: "+this.state.state),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(W),!(W=="connecting"&&this.state.state=="connected")&&!(W=="closing"&&this.state.state=="closed"))){var J=this.states[W],Y=new E.default(this.state.state,J.state,null,_.error||((j=(F=R.default)[J.state])===null||j===void 0?void 0:j.call(F)));this.enactStateChange(Y),W=="connecting"&&O.default.Config.nextTick(function(){N.startConnect()}),W=="closing"&&this.closeImpl()}},H.prototype.startConnect=function(){var _=this;if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,F=++this.connectCounter,j=function(){_.checkConnectionStateFreshness(),_.getTransportParams(function(J){if(J.mode==="recover"&&J.options.recover){var Y=U(J.options.recover);Y&&_.realtime.channels.recoverChannels(Y.channelSerials)}F===_.connectCounter&&_.connectImpl(J,F)})};if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")j();else{var W=function(J){F===_.connectCounter&&(J?_.actOnErrorFromAuthorize(J):j())};this.errorReason&&b.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,W):N._ensureValidAuthCredentials(!1,W)}},H.prototype.connectImpl=function(_,N){var F=this.state.state;F!==this.states.connecting.state&&F!==this.states.connected.state?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+F):this.pendingTransports.length?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):F==this.states.connected.state?this.upgradeIfNeeded(_):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(_,N):this.connectBase(_,N)},H.prototype.connectPreference=function(_,N){var F=this,j=this.getTransportPreference(),W=!1;d.arrIn(this.transports,j)||(this.unpersistTransportPreference(),this.connectImpl(_,N)),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+j);var J=setTimeout(function(){W=!0,F.state.state!==F.states.connected.state&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+j+" failed; clearing preference and trying from scratch"),F.disconnectAllTransports(),F.unpersistTransportPreference()),F.connectImpl(_,N)},this.options.timeouts.preferenceConnectTimeout);_.host=this.httpHosts[0],this.tryATransport(_,j,function(Y,X){clearTimeout(J),W&&X?(X.off(),X.disconnect(),d.arrDeleteValue(F.pendingTransports,X)):!X&&!Y&&(F.unpersistTransportPreference(),F.connectImpl(_,N))})},H.prototype.connectBase=function(_,N){var F=this,j=function(ee){F.notifyState({state:F.states.connecting.failState,error:ee})},W=this.httpHosts.slice(),J=function(ee,re){N===F.connectCounter&&!re&&!ee&&X()};l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var Y=W.shift();if(!Y){j(new M.default("Unable to connect (no available host)",80003,404));return}_.host=Y;var X=function(){if(!W.length){j(new M.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!F.realtime.http.checkConnectivity){j(new M.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}F.realtime.http.checkConnectivity(function(ee,re){if(N===F.connectCounter){if(ee){j(ee);return}if(!re){j(new M.default("Unable to connect (network unreachable)",80003,404));return}_.host=d.arrPopRandomElement(W),F.tryATransport(_,F.baseTransport,J)}})};if(this.forceFallbackHost&&W.length){this.forceFallbackHost=!1,X();return}this.tryATransport(_,this.baseTransport,J)},H.prototype.getUpgradePossibilities=function(){var _=this.activeProtocol.getTransport().shortName,N=d.arrIndexOf(this.upgradeTransports,_);return this.upgradeTransports.slice(N+1)},H.prototype.upgradeIfNeeded=function(_){var N=this,F=this.getUpgradePossibilities();l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+O.default.Config.inspect(F)),F.length&&d.arrForEach(F,function(j){var W=N.createTransportParams(_.host,"upgrade");N.tryATransport(W,j,S)})},H.prototype.closeImpl=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),d.safeArrForEach(this.pendingTransports,function(_){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+_),_&&_.close()}),d.safeArrForEach(this.proposedTransports,function(_){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+_),_&&_.dispose()}),this.activeProtocol&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},H.prototype.onAuthUpdated=function(_,N){var F=this,j;switch(this.state.state){case"connected":{if(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var W=this.activeProtocol.getTransport().params;O.default.Config.nextTick(function(){F.state.state==="connected"&&F.upgradeIfNeeded(W)})}var J=(j=this.activeProtocol)===null||j===void 0?void 0:j.getTransport();J&&J.onAuthUpdated&&J.onAuthUpdated(_);var Y=u.default.fromValues({action:g.AUTH,auth:{accessToken:_.token}});this.send(Y);var X=function(){F.off(ee),N(null,_)},ee=function(Q){Q.current==="failed"&&(F.off(X),F.off(ee),N(Q.reason||F.getStateError()))};this.once("connectiondetails",X),this.on("connectionstate",ee);break}case"connecting":l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var re=function(Q){switch(Q.current){case"connected":F.off(re),N(null,_);break;case"failed":case"closed":case"suspended":F.off(re),N(Q.reason||F.getStateError());break}};this.on("connectionstate",re),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},H.prototype.disconnectAllTransports=function(_){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(_?" except the active transport":"")),this.connectCounter++,d.safeArrForEach(this.pendingTransports,function(N){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],d.safeArrForEach(this.proposedTransports,function(N){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!_&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},H.prototype.send=function(_,N,F){F=F||S;var j=this.state;if(j.sendEvents){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new h.PendingMessage(_,F));return}var W=N&&j.queueEvents||j.forceQueueEvents;if(!W){var J="rejecting event, queueEvent was "+N+", state was "+j.state;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()",J),F(this.errorReason||new M.default(J,9e4,400));return}l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+u.default.stringify(_)),this.queue(_,F)},H.prototype.sendImpl=function(_){var N=_.message;_.ackRequired&&!_.sendAttempted&&(N.msgSerial=this.msgSerial++);try{this.activeProtocol.send(_)}catch(F){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+F.stack)}},H.prototype.queue=function(_,N){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var F=this.queuedMessages.last(),j=this.options.maxMessageSize;F&&!F.sendAttempted&&L(F.message,_,j)?(F.merged||(F.callback=T.default.create([F.callback]),F.merged=!0),F.callback.push(N)):this.queuedMessages.push(new h.PendingMessage(_,N))},H.prototype.sendQueuedMessages=function(){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var _;_=this.queuedMessages.shift();)this.sendImpl(_)},H.prototype.queuePendingMessages=function(_){_&&_.length&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+_.length+" pending messages"),this.queuedMessages.prepend(_))},H.prototype.failQueuedMessages=function(_){var N=this.queuedMessages.count();N>0&&(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+d.inspectError(_)),this.queuedMessages.completeAllMessages(_))},H.prototype.onChannelMessage=function(_,N){var F=this.activeProtocol&&N===this.activeProtocol.getTransport(),j=d.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing;F||j?this.realtime.channels.onChannelMessage(_):d.arrIndexOf([g.ACK,g.NACK,g.ERROR],_.action)>-1?this.realtime.channels.onChannelMessage(_):l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(_)+"on defunct transport; discarding")},H.prototype.ping=function(_,N){var F=this;if(_){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+_);var j=function(){_.off("heartbeat",Y),N(new M.default("Timeout waiting for heartbeat response",5e4,500))},W=d.now(),J=d.cheapRandStr(),Y=function(ie){if(ie===J){_.off("heartbeat",Y),clearTimeout(X);var de=d.now()-W;N(null,de)}},X=setTimeout(j,this.options.timeouts.realtimeRequestTimeout);_.on("heartbeat",Y),_.ping(J);return}if(this.state.state!=="connected"){N(new M.default("Unable to ping service; not connected",4e4,400));return}var ee=!1,re=function(ie,de){F.off("transport.active",Q),ee||(ee=!0,N(ie,de))},Q=function(){ee||(ee=!0,O.default.Config.nextTick(function(){F.ping(null,N)}))};this.on("transport.active",Q),this.ping(this.activeProtocol.getTransport(),re)},H.prototype.abort=function(_){this.activeProtocol.getTransport().fail(_)},H.prototype.registerProposedTransport=function(_){this.proposedTransports.push(_)},H.prototype.getTransportPreference=function(){var _,N;return this.transportPreference||a()&&((N=(_=O.default.WebStorage)===null||_===void 0?void 0:_.get)===null||N===void 0?void 0:N.call(_,D))},H.prototype.persistTransportPreference=function(_){var N,F;d.arrIn(m.default.upgradeTransports,_.shortName)&&(this.transportPreference=_.shortName,a()&&((F=(N=O.default.WebStorage)===null||N===void 0?void 0:N.set)===null||F===void 0||F.call(N,D,_.shortName)))},H.prototype.unpersistTransportPreference=function(){var _,N;this.transportPreference=null,a()&&((N=(_=O.default.WebStorage)===null||_===void 0?void 0:_.remove)===null||N===void 0||N.call(_,D))},H.prototype.actOnErrorFromAuthorize=function(_){if(_.code===40171)this.notifyState({state:"failed",error:_});else if(_.code===40102)this.notifyState({state:"failed",error:_});else if(_.statusCode===c.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new M.default(N,80019,403,_)})}else{var N="Client configured authentication provider request failed";l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new M.default(N,80019,401,_)})}},H.prototype.onConnectionDetailsUpdate=function(_,N){if(_){this.connectionDetails=_,_.maxMessageSize&&(this.options.maxMessageSize=_.maxMessageSize);var F=_.clientId;if(F){var j=this.realtime.auth._uncheckedSetClientId(F);if(j){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",j.message),N.fail(j);return}}var W=_.connectionStateTtl;W&&(this.connectionStateTtl=W),this.maxIdleInterval=_.maxIdleInterval,this.emit("connectiondetails",_)}},H.supportedTransports={},H}(w.default);t.default=$}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(7)),u=s.__importDefault(i(2)),d=function(h){s.__extends(m,h);function m(){var O=h.call(this)||this;return O.messages=[],O}return m.prototype.count=function(){return this.messages.length},m.prototype.push=function(O){this.messages.push(O)},m.prototype.shift=function(){return this.messages.shift()},m.prototype.last=function(){return this.messages[this.messages.length-1]},m.prototype.copyAll=function(){return this.messages.slice()},m.prototype.append=function(O){this.messages.push.apply(this.messages,O)},m.prototype.prepend=function(O){this.messages.unshift.apply(this.messages,O)},m.prototype.completeMessages=function(O,w,x){u.default.logAction(u.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+O+"; count = "+w),x=x||null;var l=this.messages;if(l.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var E=l[0];if(E){var R=E.message.msgSerial,M=O+w;if(M>R)for(var b=l.splice(0,M-R),y=0,T=b;y<T.length;y++){var p=T[y];p.callback(x)}l.length==0&&this.emit("idle")}},m.prototype.completeAllMessages=function(O){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,O)},m.prototype.resetSendAttempted=function(){for(var O=0,w=this.messages;O<w.length;O++){var x=w[O];x.sendAttempted=!1}},m.prototype.clear=function(){u.default.logAction(u.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},m}(o.default);t.default=d},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(u,d,h,m){this.previous=u,this.current=d,h&&(this.retryIn=h),m&&(this.reason=m)}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),u=s.__importDefault(i(7)),d=s.__importStar(i(1)),h=s.__importDefault(i(33)),m=s.__importDefault(i(2)),O=s.__importDefault(i(54)),w=s.__importDefault(i(9)),x=s.__importDefault(i(39)),l=s.__importStar(i(4)),E=s.__importDefault(i(16)),R=s.__importDefault(i(21)),M=o.default.Action,b=function(){};function y(f){if(f&&"params"in f&&!d.isObject(f.params))return new l.default("options.params must be an object",4e4,400);if(f&&"modes"in f){if(!d.isArray(f.modes))return new l.default("options.modes must be an array",4e4,400);for(var c=0;c<f.modes.length;c++){var a=f.modes[c];if(!a||typeof a!="string"||!d.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(a)))return new l.default("Invalid channel mode: "+a,4e4,400)}}}var T=function(f){s.__extends(c,f);function c(a,v,g){var S=f.call(this,a,v,g)||this;return S.retryCount=0,S.history=function(D,k){if(m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),k===void 0)if(typeof D=="function")k=D,D=null;else{if(this.rest.options.promises)return d.promisify(this,"history",arguments);k=b}if(D&&D.untilAttach){if(this.state!=="attached"){k(new l.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){k(new l.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete D.untilAttach,D.from_serial=this.properties.attachSerial}h.default.prototype._history.call(this,D,k)},S.whenState=function(D,k){return u.default.prototype.whenState.call(S,D,S.state,k)},m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel()","started; name = "+v),S.realtime=a,S.presence=new O.default(S),S.connectionManager=a.connection.connectionManager,S.state="initialized",S.subscriptions=new u.default,S.syncChannelSerial=void 0,S.properties={attachSerial:void 0,channelSerial:void 0},S.setOptions(g),S.errorReason=null,S._requestedFlags=null,S._mode=null,S._attachResume=!1,S._decodingContext={channelOptions:S.channelOptions,plugins:a.options.plugins||{},baseEncodedPreviousPayload:void 0},S._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},S._allChannelChanges=new u.default,S}return c.prototype.invalidStateError=function(){return new l.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},c.processListenerArgs=function(a){return a=Array.prototype.slice.call(a),typeof a[0]=="function"&&a.unshift(null),a[a.length-1]==null&&a.pop(),a},c.prototype.setOptions=function(a,v){var g=this.channelOptions;if(!v&&this.rest.options.promises)return d.promisify(this,"setOptions",arguments);var S=v||function(k){k&&m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+k.toString())},D=y(a);if(D){S(D);return}h.default.prototype.setOptions.call(this,a),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(a,g)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(k){switch(this.event){case"update":case"attached":S==null||S(null);return;default:S==null||S(k.reason);return}})):S()},c.prototype._shouldReattachToSetOptions=function(a,v){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(a!=null&&a.params){var g=p(a.params),S=p(v.params);if(Object.keys(g).length!==Object.keys(S).length||!d.shallowEquals(S,g))return!0}return!!(a!=null&&a.modes&&(!v.modes||!d.arrEquals(a.modes,v.modes)))},c.prototype.publish=function(){for(var a=this,v=[],g=0;g<arguments.length;g++)v[g]=arguments[g];var S=v[0],D=v.length,k=v[D-1];if(typeof k!="function"){if(this.realtime.options.promises)return d.promisify(this,"publish",arguments);k=b,++D}if(!this.connectionManager.activeState()){k(this.connectionManager.getError());return}if(D==2)if(d.isObject(S))S=[w.default.fromValues(S)];else if(d.isArray(S))S=w.default.fromValuesArray(S);else throw new l.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else S=[w.default.fromValues({name:v[0],data:v[1]})];var P=this.realtime.options.maxMessageSize;w.default.encodeArray(S,this.channelOptions,function(I){if(I){k(I);return}var C=w.default.getMessagesSize(S);if(C>P){k(new l.default("Maximum size of messages that can be published at once exceeded ( was "+C+" bytes; limit is "+P+" bytes)",40009,400));return}a.__publish(S,k)})},c.prototype.__publish=function(a,v){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+a.length);var g=this.state;switch(g){case"failed":case"suspended":v(l.default.fromValues(this.invalidStateError()));break;default:{m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+g);var S=new o.default;S.action=M.MESSAGE,S.channel=this.name,S.messages=a,this.sendMessage(S,v);break}}},c.prototype.onEvent=function(a){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var v=this.subscriptions,g=0;g<a.length;g++){var S=a[g];v.emit(S.name,S)}},c.prototype.attach=function(a,v){var g;if(typeof a=="function"?(v=a,g=null):g=a,!v){if(this.realtime.options.promises)return d.promisify(this,"attach",arguments);v=function(S){S&&m.default.logAction(m.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+S.toString())}}if(g)m.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=g;else if(this.state==="attached"){v(null,null);return}this._attach(!1,null,v)},c.prototype._attach=function(a,v,g){g||(g=function(D){D&&m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+D.toString())});var S=this.connectionManager;if(!S.activeState()){g(S.getError());return}(this.state!=="attaching"||a)&&this.requestState("attaching",v),this.once(function(D){switch(this.event){case"attached":g==null||g(null,D);break;case"detached":case"suspended":case"failed":g==null||g(D.reason||S.getError()||new l.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":g==null||g(new l.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},c.prototype.attachImpl=function(){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var a=o.default.fromValues({action:M.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?a.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&a.encodeModesToFlags(d.allToUpperCase(this.channelOptions.modes)),this._attachResume&&a.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(a.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(a,b)},c.prototype.detach=function(a){if(!a){if(this.realtime.options.promises)return d.promisify(this,"detach",arguments);a=b}var v=this.connectionManager;if(!v.activeState()){a(v.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),a();break;case"detached":a();break;case"failed":a(new l.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(g){switch(this.event){case"detached":a();break;case"attached":case"suspended":case"failed":a(g.reason||v.getError()||new l.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":a(new l.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},c.prototype.detachImpl=function(a){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var v=o.default.fromValues({action:M.DETACH,channel:this.name});this.sendMessage(v,a||b)},c.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var g=c.processListenerArgs(a),S=g[0],D=g[1],k=g[2];if(!k&&this.realtime.options.promises)return d.promisify(this,"subscribe",[S,D]);if(this.state==="failed"){k==null||k(l.default.fromValues(this.invalidStateError()));return}return S&&typeof S=="object"&&!Array.isArray(S)?this._subscribeFilter(S,D):this.subscriptions.on(S,D),this.attach(k||b)},c.prototype._subscribeFilter=function(a,v){var g=function(S){var D,k,P,I,C,A,L={name:S.name,refTimeserial:(k=(D=S.extras)===null||D===void 0?void 0:D.ref)===null||k===void 0?void 0:k.timeserial,refType:(I=(P=S.extras)===null||P===void 0?void 0:P.ref)===null||I===void 0?void 0:I.type,isRef:!!(!((A=(C=S.extras)===null||C===void 0?void 0:C.ref)===null||A===void 0)&&A.timeserial),clientId:S.clientId};Object.entries(a).find(function(U){var B=U[0],$=U[1];return $!==void 0?L[B]!==$:!1})||v(S)};this._addFilteredSubscription(a,v,g),this.subscriptions.on(g)},c.prototype._addFilteredSubscription=function(a,v,g){var S;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(v)){var D=this.filteredSubscriptions.get(v);D.set(a,((S=D==null?void 0:D.get(a))===null||S===void 0?void 0:S.concat(g))||[g])}else this.filteredSubscriptions.set(v,new Map([[a,[g]]]))},c.prototype._getAndDeleteFilteredSubscriptions=function(a,v){var g=this;if(!this.filteredSubscriptions)return[];if(!v&&a)return Array.from(this.filteredSubscriptions.entries()).map(function(P){var I,C=P[0],A=P[1],L=A.get(a);return A.delete(a),A.size===0&&((I=g.filteredSubscriptions)===null||I===void 0||I.delete(C)),L}).reduce(function(P,I){var C;return I?(C=P).concat.apply(C,I):P},[]);if(!v||!this.filteredSubscriptions.has(v))return[];var S=this.filteredSubscriptions.get(v);if(!a){var D=Array.from(S.values()).reduce(function(P,I){return P.concat.apply(P,I)},[]);return this.filteredSubscriptions.delete(v),D}var k=S.get(a);return S.delete(a),k||[]},c.prototype.unsubscribe=function(){for(var a=this,v,g=[],S=0;S<arguments.length;S++)g[S]=arguments[S];var D=c.processListenerArgs(g),k=D[0],P=D[1];if(typeof k=="object"&&!P||!((v=this.filteredSubscriptions)===null||v===void 0)&&v.has(P)){this._getAndDeleteFilteredSubscriptions(k,P).forEach(function(I){return a.subscriptions.off(I)});return}this.subscriptions.off(k,P)},c.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new l.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var a=this.connectionManager;if(!a.activeState())throw a.getError();var v=o.default.fromValues({action:M.SYNC,channel:this.name});this.syncChannelSerial&&(v.channelSerial=this.syncChannelSerial),a.send(v)},c.prototype.sendMessage=function(a,v){this.connectionManager.send(a,this.realtime.options.queueMessages,v)},c.prototype.sendPresence=function(a,v){var g=o.default.fromValues({action:M.PRESENCE,channel:this.name,presence:d.isArray(a)?E.default.fromValuesArray(a):[E.default.fromValues(a)]});this.sendMessage(g,v)},c.prototype.onMessage=function(a){(a.action===M.ATTACHED||a.action===M.MESSAGE||a.action===M.PRESENCE)&&this.setChannelSerial(a.channelSerial);var v,g=!1;switch(a.action){case M.ATTACHED:{this.properties.attachSerial=a.channelSerial,this._mode=a.getMode(),this.params=a.params||{};var S=a.decodeModesFromFlags();this.modes=S&&d.allToLowerCase(S)||void 0;var D=a.hasFlag("RESUMED"),k=a.hasFlag("HAS_PRESENCE"),P=a.hasFlag("HAS_BACKLOG");if(this.state==="attached"){D||this.presence.onAttached(k);var I=new x.default(this.state,this.state,D,P,a.error);this._allChannelChanges.emit("update",I),(!D||this.channelOptions.updateOnAttached)&&this.emit("update",I)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",a.error,D,k,P);break}case M.DETACHED:{var C=a.error?l.default.fromValues(a.error):new l.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",C):this.state==="attaching"?this.notifyState("suspended",C):this.requestState("attaching",C);break}case M.SYNC:if(g=!0,v=this.syncChannelSerial=a.channelSerial,!a.presence)break;case M.PRESENCE:{for(var A=a.presence,L=a.id,U=a.connectionId,B=a.timestamp,$=this.channelOptions,V=void 0,H=0;H<A.length;H++)try{V=A[H],E.default.decode(V,$),V.connectionId||(V.connectionId=U),V.timestamp||(V.timestamp=B),V.id||(V.id=L+":"+H)}catch(J){m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()",J.toString())}this.presence.setPresence(A,g,v);break}case M.MESSAGE:{if(this.state!=="attached"){m.default.logAction(m.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+a.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var _=a.messages,N=_[0],F=_[_.length-1],L=a.id,U=a.connectionId,B=a.timestamp;if(N.extras&&N.extras.delta&&N.extras.delta.from!==this._lastPayload.messageId){var j='Delta message decode failure - previous message not available for message "'+a.id+'" on this channel "'+this.name+'".';m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()",j),this._startDecodeFailureRecovery(new l.default(j,40018,400));break}for(var H=0;H<_.length;H++){var j=_[H];try{w.default.decode(j,this._decodingContext)}catch(Q){switch(m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()",Q.toString()),Q.code){case 40018:this._startDecodeFailureRecovery(Q);return;case 40019:case 40021:this.notifyState("failed",Q);return}}j.connectionId||(j.connectionId=U),j.timestamp||(j.timestamp=B),j.id||(j.id=L+":"+H)}this._lastPayload.messageId=F.id,this._lastPayload.protocolMessageChannelSerial=a.channelSerial,this.onEvent(_);break}case M.ERROR:{var W=a.error;W&&W.code==80016?this.checkPendingState():this.notifyState("failed",l.default.fromValues(W));break}default:m.default.logAction(m.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+a.action+")"),this.connectionManager.abort(R.default.unknownChannelErr())}},c.prototype._startDecodeFailureRecovery=function(a){var v=this;this._lastPayload.decodeFailureRecoveryInProgress||(m.default.logAction(m.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,a,function(){v._lastPayload.decodeFailureRecoveryInProgress=!1}))},c.prototype.onAttached=function(){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},c.prototype.notifyState=function(a,v,g,S,D){if(m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+a),this.clearStateTimer(),d.arrIn(["detached","suspended","failed"],a)&&(this.properties.channelSerial=null),a!==this.state){this.presence.actOnChannelState(a,S,v),a==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),v&&(this.errorReason=v);var k=new x.default(this.state,a,g,D,v),P=a==="failed"?m.default.LOG_ERROR:m.default.LOG_MAJOR;m.default.logAction(P,'Channel state for channel "'+this.name+'"',a+(v?"; reason: "+v:"")),a!=="attaching"&&a!=="suspended"&&(this.retryCount=0),a==="attached"&&this.onAttached(),a==="attached"?this._attachResume=!0:(a==="detaching"||a==="failed")&&(this._attachResume=!1),this.state=a,this._allChannelChanges.emit(a,k),this.emit(a,k)}},c.prototype.requestState=function(a,v){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+a),this.notifyState(a,v),this.checkPendingState()},c.prototype.checkPendingState=function(){var a=this.connectionManager.state;if(!(a.sendEvents||a.forceQueueEvents)){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},c.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var a=new l.default("Channel attach timed out",90007,408);this.notifyState("suspended",a);break}case"detaching":{var a=new l.default("Channel detach timed out",90007,408);this.notifyState("attached",a);break}default:this.checkPendingState();break}},c.prototype.startStateTimerIfNotRunning=function(){var a=this;this.stateTimer||(this.stateTimer=setTimeout(function(){m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),a.stateTimer=null,a.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},c.prototype.clearStateTimer=function(){var a=this.stateTimer;a&&(clearTimeout(a),this.stateTimer=null)},c.prototype.startRetryTimer=function(){var a=this;if(!this.retryTimer){this.retryCount++;var v=d.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){a.state==="suspended"&&a.connectionManager.state.sendEvents&&(a.retryTimer=null,m.default.logAction(m.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),a.requestState("attaching"))},v)}},c.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},c.prototype.getReleaseErr=function(){var a=this.state;return a==="initialized"||a==="detached"||a==="failed"?null:new l.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+a,90001,400)},c.prototype.setChannelSerial=function(a){m.default.logAction(m.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+a+"; previous = "+this.properties.channelSerial),a&&(this.properties.channelSerial=a)},c}(h.default);function p(f){var c=f||{};c.agent;var a=s.__rest(c,["agent"]);return a}t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(u,d,h,m,O){this.previous=u,this.current=d,d==="attached"&&(this.resumed=h,this.hasBacklog=m),O&&(this.reason=O)}return o}();t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,u=o.lib,d=u.WordArray,h=u.Hasher,m=o.algo,O=[],w=m.SHA1=h.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(x,l){for(var E=this._hash.words,R=E[0],M=E[1],b=E[2],y=E[3],T=E[4],p=0;p<80;p++){if(p<16)O[p]=x[l+p]|0;else{var f=O[p-3]^O[p-8]^O[p-14]^O[p-16];O[p]=f<<1|f>>>31}var c=(R<<5|R>>>27)+T+O[p];p<20?c+=(M&b|~M&y)+1518500249:p<40?c+=(M^b^y)+1859775393:p<60?c+=(M&b|M&y|b&y)-1894007588:c+=(M^b^y)-899497514,T=y,y=b,b=M<<30|M>>>2,M=R,R=c}E[0]=E[0]+R|0,E[1]=E[1]+M|0,E[2]=E[2]+b|0,E[3]=E[3]+y|0,E[4]=E[4]+T|0},_doFinalize:function(){var x=this._data,l=x.words,E=this._nDataBytes*8,R=x.sigBytes*8;return l[R>>>5]|=128<<24-R%32,l[(R+64>>>9<<4)+14]=Math.floor(E/4294967296),l[(R+64>>>9<<4)+15]=E,x.sigBytes=l.length*4,this._process(),this._hash},clone:function(){var x=h.clone.call(this);return x._hash=this._hash.clone(),x}});o.SHA1=h._createHelper(w),o.HmacSHA1=h._createHmacHelper(w)}(),s.SHA1})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});function s(p){if(p===void 0)return"undefined";var f,c;if(p instanceof ArrayBuffer?(c="ArrayBuffer",f=new DataView(p)):p instanceof DataView&&(c="DataView",f=p),!f)return JSON.stringify(p);for(var a=[],v=0;v<p.byteLength;v++){if(v>20){a.push("...");break}var g=f.getUint8(v).toString(16);g.length===1&&(g="0"+g),a.push(g)}return"<"+c+" "+a.join(" ")+">"}function o(p,f,c){for(var a=0,v=c.length;a<v;a++){var g=c.charCodeAt(a);if(g<128){p.setUint8(f++,g>>>0&127|0);continue}if(g<2048){p.setUint8(f++,g>>>6&31|192),p.setUint8(f++,g>>>0&63|128);continue}if(g<65536){p.setUint8(f++,g>>>12&15|224),p.setUint8(f++,g>>>6&63|128),p.setUint8(f++,g>>>0&63|128);continue}if(g<1114112){p.setUint8(f++,g>>>18&7|240),p.setUint8(f++,g>>>12&63|128),p.setUint8(f++,g>>>6&63|128),p.setUint8(f++,g>>>0&63|128);continue}throw new Error("bad codepoint "+g)}}function u(p,f,c){for(var a="",v=f,g=f+c;v<g;v++){var S=p.getUint8(v);if(!(S&128)){a+=String.fromCharCode(S);continue}if((S&224)===192){a+=String.fromCharCode((S&15)<<6|p.getUint8(++v)&63);continue}if((S&240)===224){a+=String.fromCharCode((S&15)<<12|(p.getUint8(++v)&63)<<6|(p.getUint8(++v)&63)<<0);continue}if((S&248)===240){a+=String.fromCharCode((S&7)<<18|(p.getUint8(++v)&63)<<12|(p.getUint8(++v)&63)<<6|(p.getUint8(++v)&63)<<0);continue}throw new Error("Invalid byte "+S.toString(16))}return a}function d(p){for(var f=0,c=0,a=p.length;c<a;c++){var v=p.charCodeAt(c);if(v<128){f+=1;continue}if(v<2048){f+=2;continue}if(v<65536){f+=3;continue}if(v<1114112){f+=4;continue}throw new Error("bad codepoint "+v)}return f}function h(p,f){var c=T(p,f);if(c!==0){var a=new ArrayBuffer(c),v=new DataView(a);return y(p,v,0,f),a}}var m=65536*65536,O=1/m;function w(p,f){return f=f||0,p.getInt32(f)*m+p.getUint32(f+4)}function x(p,f){return f=f||0,p.getUint32(f)*m+p.getUint32(f+4)}function l(p,f,c){c<9223372036854776e3?(p.setInt32(f,Math.floor(c*O)),p.setInt32(f+4,c&-1)):(p.setUint32(f,2147483647),p.setUint32(f+4,2147483647))}function E(p,f,c){c<18446744073709552e3?(p.setUint32(f,Math.floor(c*O)),p.setInt32(f+4,c&-1)):(p.setUint32(f,4294967295),p.setUint32(f+4,4294967295))}var R=function(){function p(f,c){var a=this;this.map=function(v){for(var g={},S=0;S<v;S++){var D=a.parse();g[D]=a.parse()}return g},this.bin=function(v){var g=new ArrayBuffer(v);return new Uint8Array(g).set(new Uint8Array(a.view.buffer,a.offset,v),0),a.offset+=v,g},this.buf=this.bin,this.str=function(v){var g=u(a.view,a.offset,v);return a.offset+=v,g},this.array=function(v){for(var g=new Array(v),S=0;S<v;S++)g[S]=a.parse();return g},this.ext=function(v){return a.offset+=v,{type:a.view.getInt8(a.offset),data:a.buf(v)}},this.parse=function(){var v=a.view.getUint8(a.offset),g,S;if(!(v&128))return a.offset++,v;if((v&240)===128)return S=v&15,a.offset++,a.map(S);if((v&240)===144)return S=v&15,a.offset++,a.array(S);if((v&224)===160)return S=v&31,a.offset++,a.str(S);if((v&224)===224)return g=a.view.getInt8(a.offset),a.offset++,g;switch(v){case 192:return a.offset++,null;case 193:a.offset++;return;case 194:return a.offset++,!1;case 195:return a.offset++,!0;case 196:return S=a.view.getUint8(a.offset+1),a.offset+=2,a.bin(S);case 197:return S=a.view.getUint16(a.offset+1),a.offset+=3,a.bin(S);case 198:return S=a.view.getUint32(a.offset+1),a.offset+=5,a.bin(S);case 199:return S=a.view.getUint8(a.offset+1),a.offset+=2,a.ext(S);case 200:return S=a.view.getUint16(a.offset+1),a.offset+=3,a.ext(S);case 201:return S=a.view.getUint32(a.offset+1),a.offset+=5,a.ext(S);case 202:return g=a.view.getFloat32(a.offset+1),a.offset+=5,g;case 203:return g=a.view.getFloat64(a.offset+1),a.offset+=9,g;case 204:return g=a.view.getUint8(a.offset+1),a.offset+=2,g;case 205:return g=a.view.getUint16(a.offset+1),a.offset+=3,g;case 206:return g=a.view.getUint32(a.offset+1),a.offset+=5,g;case 207:return g=x(a.view,a.offset+1),a.offset+=9,g;case 208:return g=a.view.getInt8(a.offset+1),a.offset+=2,g;case 209:return g=a.view.getInt16(a.offset+1),a.offset+=3,g;case 210:return g=a.view.getInt32(a.offset+1),a.offset+=5,g;case 211:return g=w(a.view,a.offset+1),a.offset+=9,g;case 212:return S=1,a.offset++,a.ext(S);case 213:return S=2,a.offset++,a.ext(S);case 214:return S=4,a.offset++,a.ext(S);case 215:return S=8,a.offset++,a.ext(S);case 216:return S=16,a.offset++,a.ext(S);case 217:return S=a.view.getUint8(a.offset+1),a.offset+=2,a.str(S);case 218:return S=a.view.getUint16(a.offset+1),a.offset+=3,a.str(S);case 219:return S=a.view.getUint32(a.offset+1),a.offset+=5,a.str(S);case 220:return S=a.view.getUint16(a.offset+1),a.offset+=3,a.array(S);case 221:return S=a.view.getUint32(a.offset+1),a.offset+=5,a.array(S);case 222:return S=a.view.getUint16(a.offset+1),a.offset+=3,a.map(S);case 223:return S=a.view.getUint32(a.offset+1),a.offset+=5,a.map(S)}throw new Error("Unknown type 0x"+v.toString(16))},this.offset=c||0,this.view=f}return p}();function M(p){var f=new DataView(p),c=new R(f),a=c.parse();if(c.offset!==p.byteLength)throw new Error(p.byteLength-c.offset+" trailing bytes");return a}function b(p,f){return Object.keys(p).filter(function(c){var a=p[c],v=typeof a;return(!f||a!=null)&&(v!=="function"||!!a.toJSON)})}function y(p,f,c,a){var v=typeof p;if(typeof p=="string"){var g=d(p);if(g<32)return f.setUint8(c,g|160),o(f,c+1,p),1+g;if(g<256)return f.setUint8(c,217),f.setUint8(c+1,g),o(f,c+2,p),2+g;if(g<65536)return f.setUint8(c,218),f.setUint16(c+1,g),o(f,c+3,p),3+g;if(g<4294967296)return f.setUint8(c,219),f.setUint32(c+1,g),o(f,c+5,p),5+g}if(ArrayBuffer.isView&&ArrayBuffer.isView(p)&&(p=p.buffer),p instanceof ArrayBuffer){var S=p.byteLength;if(S<256)return f.setUint8(c,196),f.setUint8(c+1,S),new Uint8Array(f.buffer).set(new Uint8Array(p),c+2),2+S;if(S<65536)return f.setUint8(c,197),f.setUint16(c+1,S),new Uint8Array(f.buffer).set(new Uint8Array(p),c+3),3+S;if(S<4294967296)return f.setUint8(c,198),f.setUint32(c+1,S),new Uint8Array(f.buffer).set(new Uint8Array(p),c+5),5+S}if(typeof p=="number"){if(Math.floor(p)!==p)return f.setUint8(c,203),f.setFloat64(c+1,p),9;if(p>=0){if(p<128)return f.setUint8(c,p),1;if(p<256)return f.setUint8(c,204),f.setUint8(c+1,p),2;if(p<65536)return f.setUint8(c,205),f.setUint16(c+1,p),3;if(p<4294967296)return f.setUint8(c,206),f.setUint32(c+1,p),5;if(p<18446744073709552e3)return f.setUint8(c,207),E(f,c+1,p),9;throw new Error("Number too big 0x"+p.toString(16))}if(p>=-32)return f.setInt8(c,p),1;if(p>=-128)return f.setUint8(c,208),f.setInt8(c+1,p),2;if(p>=-32768)return f.setUint8(c,209),f.setInt16(c+1,p),3;if(p>=-2147483648)return f.setUint8(c,210),f.setInt32(c+1,p),5;if(p>=-9223372036854776e3)return f.setUint8(c,211),l(f,c+1,p),9;throw new Error("Number too small -0x"+(-p).toString(16).substr(1))}if(v==="undefined")return a?0:(f.setUint8(c,212),f.setUint8(c+1,0),f.setUint8(c+2,0),3);if(p===null)return a?0:(f.setUint8(c,192),1);if(v==="boolean")return f.setUint8(c,p?195:194),1;if(typeof p.toJSON=="function")return y(p.toJSON(),f,c,a);if(v==="object"){var D,k=0,P=void 0,I=Array.isArray(p);if(I?D=p.length:(P=b(p,a),D=P.length),D<16?(f.setUint8(c,D|(I?144:128)),k=1):D<65536?(f.setUint8(c,I?220:222),f.setUint16(c+1,D),k=3):D<4294967296&&(f.setUint8(c,I?221:223),f.setUint32(c+1,D),k=5),I)for(var C=0;C<D;C++)k+=y(p[C],f,c+k,a);else if(P)for(var C=0;C<D;C++){var A=P[C];k+=y(A,f,c+k),k+=y(p[A],f,c+k,a)}return k}if(v==="function")return 0;throw new Error("Unknown type "+v)}function T(p,f){var c=typeof p;if(c==="string"){var a=d(p);if(a<32)return 1+a;if(a<256)return 2+a;if(a<65536)return 3+a;if(a<4294967296)return 5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(p)&&(p=p.buffer),p instanceof ArrayBuffer){var v=p.byteLength;if(v<256)return 2+v;if(v<65536)return 3+v;if(v<4294967296)return 5+v}if(typeof p=="number"){if(Math.floor(p)!==p)return 9;if(p>=0){if(p<128)return 1;if(p<256)return 2;if(p<65536)return 3;if(p<4294967296)return 5;if(p<18446744073709552e3)return 9;throw new Error("Number too big 0x"+p.toString(16))}if(p>=-32)return 1;if(p>=-128)return 2;if(p>=-32768)return 3;if(p>=-2147483648)return 5;if(p>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+p.toString(16).substr(1))}if(c==="boolean")return 1;if(p===null)return f?0:1;if(p===void 0)return f?0:3;if(typeof p.toJSON=="function")return T(p.toJSON(),f);if(c==="object"){var g,S=0;if(Array.isArray(p)){g=p.length;for(var D=0;D<g;D++)S+=T(p[D],f)}else{var k=b(p,f);g=k.length;for(var D=0;D<g;D++){var P=k[D];S+=T(P)+T(p[P],f)}}if(g<16)return 1+S;if(g<65536)return 3+S;if(g<4294967296)return 5+S;throw new Error("Array or object too long 0x"+g.toString(16))}if(c==="function")return 0;throw new Error("Unknown type "+c)}t.default={encode:h,decode:M,inspect:s,utf8Write:o,utf8Read:u,utf8ByteCount:d}},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(30)),u=s.__importDefault(i(50)),d=s.__importDefault(i(3)),h=s.__importDefault(i(4)),m=s.__importDefault(i(55)),O=s.__importDefault(i(57)),w=s.__importDefault(i(62)),x=s.__importDefault(i(64)),l=s.__importDefault(i(68)),E=s.__importDefault(i(2)),R=i(8),M=s.__importDefault(i(65)),b=s.__importDefault(i(66)),y=s.__importDefault(i(41)),T=(0,O.default)(x.default,m.default);d.default.Crypto=T,d.default.BufferUtils=m.default,d.default.Http=w.default,d.default.Config=x.default,d.default.Transports=l.default,d.default.WebStorage=M.default,o.default.Crypto=T,u.default.Crypto=T,E.default.initLogHandlers(),d.default.Defaults=(0,R.getDefaults)(b.default),d.default.Config.agent&&(d.default.Defaults.agent+=" "+d.default.Config.agent),d.default.Config.noUpgrade&&(d.default.Defaults.upgradeTransports=[]),t.default={ErrorInfo:h.default,Rest:o.default,Realtime:u.default,msgpack:y.default}},function(n){n.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(n,t){},function(n,t,i){(function(s,o){n.exports=o(i(6),i(32),i(25))})(this,function(s){return s.HmacSHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(47)),d=s.__importDefault(i(15)),h=s.__importDefault(i(20)),m=s.__importDefault(i(4)),O=s.__importDefault(i(48)),w=function(){},x=function(){function M(b){this.rest=b,this.admin=new l(b)}return M}(),l=function(){function M(b){this.rest=b,this.deviceRegistrations=new E(b),this.channelSubscriptions=new R(b)}return M.prototype.publish=function(b,y,T){var p=this.rest,f=p.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultPostHeaders(p.options,f),a={},v=o.mixin({recipient:b},y);if(typeof T!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);T=w}p.options.headers&&o.mixin(c,p.options.headers),p.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var g=o.encodeBody(v,f);d.default.post(p,"/push/publish",g,c,a,null,function(S){return T(S)})},M}(),E=function(){function M(b){this.rest=b}return M.prototype.save=function(b,y){var T=this.rest,p=u.default.fromValues(b),f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultPostHeaders(T.options,f),a={};if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);y=w}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(p,f);d.default.put(T,"/push/deviceRegistrations/"+encodeURIComponent(b.id),v,c,a,null,function(g,S,D,k){y(g,g?void 0:u.default.fromResponseBody(S,k?void 0:f))})},M.prototype.get=function(b,y){var T=this.rest,p=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=o.defaultGetHeaders(T.options,p),c=b.id||b;if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);y=w}if(typeof c!="string"||!c.length){y(new m.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(f,T.options.headers),d.default.get(T,"/push/deviceRegistrations/"+encodeURIComponent(c),f,{},null,function(a,v,g,S){y(a,a?void 0:u.default.fromResponseBody(v,S?void 0:p))})},M.prototype.list=function(b,y){var T=this.rest,p=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=this.rest.http.supportsLinkHeaders?void 0:p,c=o.defaultGetHeaders(T.options,p);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);y=w}T.options.headers&&o.mixin(c,T.options.headers),new h.default(T,"/push/deviceRegistrations",c,f,function(a,v,g){return u.default.fromResponseBody(a,g?void 0:p)}).get(b,y)},M.prototype.remove=function(b,y){var T=this.rest,p=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=o.defaultGetHeaders(T.options,p),c={},a=b.id||b;if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);y=w}if(typeof a!="string"||!a.length){y(new m.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(f,T.options.headers),T.options.pushFullWait&&o.mixin(c,{fullWait:"true"}),d.default.delete(T,"/push/deviceRegistrations/"+encodeURIComponent(a),f,c,null,function(v){return y(v)})},M.prototype.removeWhere=function(b,y){var T=this.rest,p=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=o.defaultGetHeaders(T.options,p);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);y=w}T.options.headers&&o.mixin(f,T.options.headers),T.options.pushFullWait&&o.mixin(b,{fullWait:"true"}),d.default.delete(T,"/push/deviceRegistrations",f,b,null,function(c){return y(c)})},M}(),R=function(){function M(b){this.remove=M.prototype.removeWhere,this.rest=b}return M.prototype.save=function(b,y){var T=this.rest,p=O.default.fromValues(b),f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultPostHeaders(T.options,f),a={};if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);y=w}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(p,f);d.default.post(T,"/push/channelSubscriptions",v,c,a,null,function(g,S,D,k){y(g,!g&&O.default.fromResponseBody(S,k?void 0:f))})},M.prototype.list=function(b,y){var T=this.rest,p=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=this.rest.http.supportsLinkHeaders?void 0:p,c=o.defaultGetHeaders(T.options,p);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);y=w}T.options.headers&&o.mixin(c,T.options.headers),new h.default(T,"/push/channelSubscriptions",c,f,function(a,v,g){return O.default.fromResponseBody(a,g?void 0:p)}).get(b,y)},M.prototype.removeWhere=function(b,y){var T=this.rest,p=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=o.defaultGetHeaders(T.options,p);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);y=w}T.options.headers&&o.mixin(f,T.options.headers),T.options.pushFullWait&&o.mixin(b,{fullWait:"true"}),d.default.delete(T,"/push/channelSubscriptions",f,b,null,function(c){return y(c)})},M.prototype.listChannels=function(b,y){var T=this.rest,p=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,f=this.rest.http.supportsLinkHeaders?void 0:p,c=o.defaultGetHeaders(T.options,p);if(typeof y!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);y=w}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(b,{fullWait:"true"}),new h.default(T,"/push/channels",c,f,function(a,v,g){for(var S=!g&&p?o.decodeBody(a,p):a,D=0;D<S.length;D++)S[D]=String(S[D]);return S}).get(b,y)},M}();t.default=x},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(4)),d;(function(O){O.Phone="phone",O.Tablet="tablet",O.Desktop="desktop",O.TV="tv",O.Watch="watch",O.Car="car",O.Embedded="embedded",O.Other="other"})(d||(d={}));var h;(function(O){O.Android="android",O.IOS="ios",O.Browser="browser"})(h||(h={}));var m=function(){function O(){}return O.prototype.toJSON=function(){var w,x,l;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(w=this.push)===null||w===void 0?void 0:w.recipient,state:(x=this.push)===null||x===void 0?void 0:x.state,error:(l=this.push)===null||l===void 0?void 0:l.error}}},O.prototype.toString=function(){var w,x,l,E,R="[DeviceDetails";return this.id&&(R+="; id="+this.id),this.platform&&(R+="; platform="+this.platform),this.formFactor&&(R+="; formFactor="+this.formFactor),this.clientId&&(R+="; clientId="+this.clientId),this.metadata&&(R+="; metadata="+this.metadata),this.deviceIdentityToken&&(R+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((w=this.push)===null||w===void 0)&&w.recipient&&(R+="; push.recipient="+JSON.stringify(this.push.recipient)),!((x=this.push)===null||x===void 0)&&x.state&&(R+="; push.state="+this.push.state),!((l=this.push)===null||l===void 0)&&l.error&&(R+="; push.error="+JSON.stringify(this.push.error)),!((E=this.push)===null||E===void 0)&&E.metadata&&(R+="; push.metadata="+this.push.metadata),R+="]",R},O.fromResponseBody=function(w,x){return x&&(w=o.decodeBody(w,x)),o.isArray(w)?O.fromValuesArray(w):O.fromValues(w)},O.fromValues=function(w){return w.error=w.error&&u.default.fromValues(w.error),Object.assign(new O,w)},O.fromValuesArray=function(w){for(var x=w.length,l=new Array(x),E=0;E<x;E++)l[E]=O.fromValues(w[E]);return l},O.toRequestBody=o.encodeBody,O}();t.default=m},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=function(){function d(){}return d.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},d.prototype.toString=function(){var h="[PushChannelSubscription";return this.channel&&(h+="; channel="+this.channel),this.deviceId&&(h+="; deviceId="+this.deviceId),this.clientId&&(h+="; clientId="+this.clientId),h+="]",h},d.fromResponseBody=function(h,m){return m&&(h=o.decodeBody(h,m)),o.isArray(h)?d.fromValuesArray(h):d.fromValues(h)},d.fromValues=function(h){return Object.assign(new d,h)},d.fromValuesArray=function(h){for(var m=h.length,O=new Array(m),w=0;w<m;w++)O[w]=d.fromValues(h[w]);return O},d.toRequestBody=o.encodeBody,d}();t.default=u},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=function(){function T(p){this.count=p&&p.count||0,this.data=p&&p.data||0,this.uncompressedData=p&&p.uncompressedData||0,this.failed=p&&p.failed||0,this.refused=p&&p.refused||0}return T}(),d=function(T){s.__extends(p,T);function p(f){var c=T.call(this,f)||this;return f&&f.category&&(c.category={},o.forInOwnNonNullProperties(f.category,function(a){c.category[a]=new u(f.category[a])})),c}return p}(u),h=function(){function T(p){this.peak=p&&p.peak||0,this.min=p&&p.min||0,this.mean=p&&p.mean||0,this.opened=p&&p.opened||0,this.refused=p&&p.refused||0}return T}(),m=function(){function T(p){this.succeeded=p&&p.succeeded||0,this.failed=p&&p.failed||0,this.refused=p&&p.refused||0}return T}(),O=function(){function T(p){this.plain=new h(p&&p.plain),this.tls=new h(p&&p.tls),this.all=new h(p&&p.all)}return T}(),w=function(){function T(p){this.messages=new d(p&&p.messages),this.presence=new d(p&&p.presence),this.all=new d(p&&p.all)}return T}(),x=function(){function T(p){this.realtime=new w(p&&p.realtime),this.rest=new w(p&&p.rest),this.webhook=new w(p&&p.webhook),this.sharedQueue=new w(p&&p.sharedQueue),this.externalQueue=new w(p&&p.externalQueue),this.httpEvent=new w(p&&p.httpEvent),this.push=new w(p&&p.push),this.all=new w(p&&p.all)}return T}(),l=function(){function T(p){this.all=new w(p&&p.all),this.inbound=new x(p&&p.inbound),this.outbound=new x(p&&p.outbound)}return T}(),E=function(){function T(p){this.all=new w(p&&p.all),this.producerPaid=new l(p&&p.producerPaid),this.consumerPaid=new l(p&&p.consumerPaid)}return T}(),R=function(){function T(p){this.messages=p&&p.messages||0;var f=p&&p.notifications;this.notifications={invalid:f&&f.invalid||0,attempted:f&&f.attempted||0,successful:f&&f.successful||0,failed:f&&f.failed||0},this.directPublishes=p&&p.directPublishes||0}return T}(),M=function(){function T(p){this.succeeded=p&&p.succeeded||0,this.skipped=p&&p.skipped||0,this.failed=p&&p.failed||0}return T}(),b=function(){function T(p){var f=this;this.delta=void 0,p&&p.delta&&(this.delta={},o.forInOwnNonNullProperties(p.delta,function(c){f.delta[c]=new M(p.delta[c])}))}return T}(),y=function(T){s.__extends(p,T);function p(f){var c=T.call(this,f)||this;return c.persisted=new w(f&&f.persisted),c.connections=new O(f&&f.connections),c.channels=new h(f&&f.channels),c.apiRequests=new m(f&&f.apiRequests),c.tokenRequests=new m(f&&f.tokenRequests),c.xchgProducer=new E(f&&f.xchgProducer),c.xchgConsumer=new E(f&&f.xchgConsumer),c.push=new R(f&&f.pushStats),c.processed=new b(f&&f.processed),c.inProgress=f&&f.inProgress||void 0,c.unit=f&&f.unit||void 0,c.intervalId=f&&f.intervalId||void 0,c}return p.fromValues=function(f){return new p(f)},p}(l);t.default=y},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(30)),d=s.__importDefault(i(7)),h=s.__importDefault(i(2)),m=s.__importDefault(i(51)),O=s.__importDefault(i(38)),w=s.__importDefault(i(8)),x=s.__importDefault(i(4)),l=s.__importDefault(i(10)),E=s.__importDefault(i(35)),R=s.__importDefault(i(3)),M=s.__importDefault(i(9)),b=function(T){s.__extends(p,T);function p(f){var c=T.call(this,f)||this;return h.default.logAction(h.default.LOG_MINOR,"Realtime()",""),c.connection=new m.default(c,c.options),c.channels=new y(c),f.autoConnect!==!1&&c.connect(),c}return p.prototype.connect=function(){h.default.logAction(h.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},p.prototype.close=function(){h.default.logAction(h.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},p.Promise=function(f){return f=w.default.objectifyOptions(f),f.promises=!0,new p(f)},p.Callbacks=p,p.Utils=o,p.ConnectionManager=E.default,p.Platform=R.default,p.ProtocolMessage=l.default,p.Message=M.default,p}(u.default),y=function(T){s.__extends(p,T);function p(f){var c=T.call(this)||this;return c.realtime=f,c.all=Object.create(null),f.connection.connectionManager.on("transport.active",function(){c.onTransportActive()}),c}return p.prototype.channelSerials=function(){for(var f={},c=0,a=o.keysArray(this.all,!0);c<a.length;c++){var v=a[c],g=this.all[v];g.properties.channelSerial&&(f[v]=g.properties.channelSerial)}return f},p.prototype.recoverChannels=function(f){for(var c=0,a=o.keysArray(f,!0);c<a.length;c++){var v=a[c],g=this.get(v);g.properties.channelSerial=f[v]}},p.prototype.onChannelMessage=function(f){var c=f.channel;if(c===void 0){h.default.logAction(h.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+f.action);return}var a=this.all[c];if(!a){h.default.logAction(h.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+c);return}a.onMessage(f)},p.prototype.onTransportActive=function(){for(var f in this.all){var c=this.all[f];c.state==="attaching"||c.state==="detaching"?c.checkPendingState():c.state==="suspended"?c._attach(!1,null):c.state==="attached"&&c.requestState("attaching")}},p.prototype.propogateConnectionInterruption=function(f,c){var a={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},v=["attaching","attached","detaching","suspended"],g=a[f];for(var S in this.all){var D=this.all[S];o.arrIn(v,D.state)&&D.notifyState(g,c)}},p.prototype.get=function(f,c){f=String(f);var a=this.all[f];if(!a)a=this.all[f]=new O.default(this.realtime,f,c);else if(c){if(a._shouldReattachToSetOptions(c,a.channelOptions))throw new x.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);a.setOptions(c)}return a},p.prototype.getDerived=function(f,c,a){if(c.filter){var v=o.toBase64(c.filter),g=o.matchDerivedChannel(f);f="[filter=".concat(v).concat(g.qualifierParam,"]").concat(g.channelName)}return this.get(f,a)},p.prototype.release=function(f){f=String(f);var c=this.all[f];if(c){var a=c.getReleaseErr();if(a)throw a;delete this.all[f]}},p}(d.default);t.default=b},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(7)),d=s.__importDefault(i(35)),h=s.__importDefault(i(2)),m=s.__importDefault(i(37)),O=s.__importDefault(i(3));function w(){}var x=function(l){s.__extends(E,l);function E(R,M){var b=l.call(this)||this;return b.whenState=function(y,T){return u.default.prototype.whenState.call(b,y,b.state,T,new m.default(void 0,y))},b.ably=R,b.connectionManager=new d.default(R,M),b.state=b.connectionManager.state.state,b.key=void 0,b.id=void 0,b.errorReason=null,b.connectionManager.on("connectionstate",function(y){var T=b.state=y.current;O.default.Config.nextTick(function(){b.emit(T,y)})}),b.connectionManager.on("update",function(y){O.default.Config.nextTick(function(){b.emit("update",y)})}),b}return E.prototype.connect=function(){h.default.logAction(h.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},E.prototype.ping=function(R){if(h.default.logAction(h.default.LOG_MINOR,"Connection.ping()",""),!R){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);R=w}this.connectionManager.ping(null,R)},E.prototype.close=function(){h.default.logAction(h.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(E.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),E.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},E}(u.default);t.default=x},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PendingMessage=void 0;var s=i(0),o=s.__importDefault(i(10)),u=s.__importStar(i(1)),d=s.__importDefault(i(7)),h=s.__importDefault(i(2)),m=s.__importDefault(i(36)),O=s.__importDefault(i(4)),w=o.default.Action,x=function(){function E(R,M){this.message=R,this.callback=M,this.merged=!1;var b=R.action;this.sendAttempted=!1,this.ackRequired=b==w.MESSAGE||b==w.PRESENCE}return E}();t.PendingMessage=x;var l=function(E){s.__extends(R,E);function R(M){var b=E.call(this)||this;return b.transport=M,b.messageQueue=new m.default,M.on("ack",function(y,T){b.onAck(y,T)}),M.on("nack",function(y,T,p){b.onNack(y,T,p)}),b}return R.prototype.onAck=function(M,b){h.default.logAction(h.default.LOG_MICRO,"Protocol.onAck()","serial = "+M+"; count = "+b),this.messageQueue.completeMessages(M,b)},R.prototype.onNack=function(M,b,y){h.default.logAction(h.default.LOG_ERROR,"Protocol.onNack()","serial = "+M+"; count = "+b+"; err = "+u.inspectError(y)),y||(y=new O.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(M,b,y)},R.prototype.onceIdle=function(M){var b=this.messageQueue;if(b.count()===0){M();return}b.once("idle",M)},R.prototype.send=function(M){M.ackRequired&&this.messageQueue.push(M),h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(M.message)),M.sendAttempted=!0,this.transport.send(M.message)},R.prototype.getTransport=function(){return this.transport},R.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},R.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},R.prototype.finish=function(){var M=this.transport;this.onceIdle(function(){M.disconnect()})},R}(d.default);t.default=l},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),u=s.__importStar(i(1)),d=s.__importDefault(i(26)),h=s.__importDefault(i(8)),m=s.__importDefault(i(2)),O=s.__importDefault(i(10)),w=s.__importDefault(i(4)),x="web_socket";function l(M){return!!M.on}var E=function(M){s.__extends(b,M);function b(y,T,p){var f=M.call(this,y,T,p)||this;return f.shortName=x,p.heartbeats=o.default.Config.useProtocolHeartbeats,f.wsHost=h.default.getHost(p.options,p.host,!0),f}return b.isAvailable=function(){return!!o.default.Config.WebSocket},b.prototype.createWebSocket=function(y,T){return this.uri=y+u.toQueryString(T),new o.default.Config.WebSocket(this.uri)},b.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},b.prototype.connect=function(){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),d.default.prototype.connect.call(this);var y=this,T=this.params,p=T.options,f=p.tls?"wss://":"ws://",c=f+this.wsHost+":"+h.default.getPort(p)+"/";m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+c),this.auth.getAuthParams(function(a,v){if(!y.isDisposed){var g="";for(var S in v)g+=" "+S+": "+v[S]+";";if(m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+g+" err: "+a),a){y.disconnect(a);return}var D=T.getConnectParams(v);try{var k=y.wsConnection=y.createWebSocket(c,D);k.binaryType=o.default.Config.binaryType,k.onopen=function(){y.onWsOpen()},k.onclose=function(P){y.onWsClose(P)},k.onmessage=function(P){y.onWsData(P.data)},k.onerror=function(P){y.onWsError(P)},l(k)&&k.on("ping",function(){y.onActivity()})}catch(P){m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(P.stack||P.message)),y.disconnect(P)}}})},b.prototype.send=function(y){var T=this.wsConnection;if(!T){m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{T.send(O.default.serialize(y,this.params.format))}catch(f){var p="Exception from ws connection when trying to send: "+u.inspectError(f);m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.send()",p),this.finish("disconnected",new w.default(p,5e4,500))}},b.prototype.onWsData=function(y){m.default.logAction(m.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+y.length+"; type = "+typeof y);try{this.onProtocolMessage(O.default.deserialize(y,this.format))}catch(T){m.default.logAction(m.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+T.stack)}},b.prototype.onWsOpen=function(){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},b.prototype.onWsClose=function(y){var T,p;if(typeof y=="object"?(p=y.code,T=y.wasClean||p===1e3):(p=y,T=p==1e3),delete this.wsConnection,T){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var f=new w.default("Websocket closed",80003,400);this.finish("disconnected",f)}else{var c="Unclean disconnection of WebSocket ; code = "+p,f=new w.default(c,80003,400);m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onWsClose()",c),this.finish("disconnected",f)}this.emit("disposed")},b.prototype.onWsError=function(y){var T=this;m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+y.message),o.default.Config.nextTick(function(){T.disconnect(Error(y.message))})},b.prototype.dispose=function(){m.default.logAction(m.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var y=this.wsConnection;y&&(y.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(m.default.logAction(m.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!y)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");y.close()}))},b}(d.default);function R(M){return E.isAvailable()&&(M.supportedTransports[x]=E),E}t.default=R},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),u=s.__importDefault(i(34)),d=s.__importDefault(i(7)),h=s.__importDefault(i(2)),m=s.__importDefault(i(16)),O=s.__importStar(i(4)),w=s.__importDefault(i(38)),x=s.__importDefault(i(24)),l=s.__importDefault(i(39)),E=function(){};function R(f){return f.channel.realtime.auth.clientId}function M(f){var c=f.channel.realtime,a=c.auth.clientId;return(!a||a==="*")&&c.connection.state==="connected"}function b(f,c,a){switch(f.state){case"attached":case"suspended":a();break;case"initialized":case"detached":case"detaching":case"attaching":f.attach(function(v){v?c(v):a()});break;default:c(O.default.fromValues(f.invalidStateError()))}}function y(f,c){if(f.isSynthesized()||c.isSynthesized())return f.timestamp>=c.timestamp;var a=f.parseId(),v=c.parseId();return a.msgSerial===v.msgSerial?a.index>v.index:a.msgSerial>v.msgSerial}var T=function(f){s.__extends(c,f);function c(a){var v=f.call(this,a)||this;return v.channel=a,v.syncComplete=!1,v.members=new p(v,function(g){return g.clientId+":"+g.connectionId}),v._myMembers=new p(v,function(g){return g.clientId}),v.subscriptions=new d.default,v.pendingPresence=[],v}return c.prototype.enter=function(a,v){if(M(this))throw new O.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"enter",v)},c.prototype.update=function(a,v){if(M(this))throw new O.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"update",v)},c.prototype.enterClient=function(a,v,g){return this._enterOrUpdateClient(void 0,a,v,"enter",g)},c.prototype.updateClient=function(a,v,g){return this._enterOrUpdateClient(void 0,a,v,"update",g)},c.prototype._enterOrUpdateClient=function(a,v,g,S,D){var k=this;if(!D)if(typeof g=="function")D=g,g=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[a,v,g,S]);D=E}var P=this.channel;if(!P.connectionManager.activeState()){D(P.connectionManager.getError());return}h.default.logAction(h.default.LOG_MICRO,"RealtimePresence."+S+"Client()","channel = "+P.name+", id = "+a+", client = "+(v||"(implicit) "+R(this)));var I=m.default.fromData(g);I.action=S,a&&(I.id=a),v&&(I.clientId=v),m.default.encode(I,P.channelOptions,function(C){if(C){D(C);return}switch(P.state){case"attached":P.sendPresence(I,D);break;case"initialized":case"detached":P.attach();case"attaching":k.pendingPresence.push({presence:I,callback:D});break;default:C=new O.PartialErrorInfo("Unable to "+S+" presence channel while in "+P.state+" state",90001),C.code=90001,D(C)}})},c.prototype.leave=function(a,v){if(M(this))throw new O.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,a,v)},c.prototype.leaveClient=function(a,v,g){if(!g)if(typeof v=="function")g=v,v=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[a,v]);g=E}var S=this.channel;if(!S.connectionManager.activeState()){g==null||g(S.connectionManager.getError());return}h.default.logAction(h.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+a);var D=m.default.fromData(v);switch(D.action="leave",a&&(D.clientId=a),S.state){case"attached":S.sendPresence(D,g);break;case"attaching":this.pendingPresence.push({presence:D,callback:g});break;case"initialized":case"failed":{var k=new O.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);g==null||g(k);break}default:g==null||g(S.invalidStateError())}},c.prototype.get=function(a,v){var g=this,S=Array.prototype.slice.call(arguments);S.length==1&&typeof S[0]=="function"&&S.unshift(null),a=S[0],v=S[1];var D=!a||("waitForSync"in a?a.waitForSync:!0);if(!v){if(this.channel.realtime.options.promises)return o.promisify(this,"get",S);v=E}function k(P){v(null,a?P.list(a):P.values())}if(this.channel.state==="suspended"){D?v(O.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):k(this.members);return}b(this.channel,v,function(){var P=g.members;D?P.waitSync(function(){k(P)}):k(P)})},c.prototype.history=function(a,v){if(h.default.logAction(h.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);v=E}a&&a.untilAttach&&(this.channel.state==="attached"?(delete a.untilAttach,a.from_serial=this.channel.properties.attachSerial):v(new O.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),u.default.prototype._history.call(this,a,v)},c.prototype.setPresence=function(a,v,g){h.default.logAction(h.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+a.length+" participants; syncChannelSerial = "+g);var S,D,k=this.members,P=this._myMembers,I=[],C=this.channel.connectionManager.connectionId;v&&(this.members.startSync(),g&&(D=g.match(/^[\w-]+:(.*)$/))&&(S=D[1]));for(var A=0;A<a.length;A++){var L=m.default.fromValues(a[A]);switch(L.action){case"leave":k.remove(L)&&I.push(L),L.connectionId===C&&!L.isSynthesized()&&P.remove(L);break;case"enter":case"present":case"update":k.put(L)&&I.push(L),L.connectionId===C&&P.put(L);break}}v&&!S&&(k.endSync(),this.channel.syncChannelSerial=null);for(var A=0;A<I.length;A++){var L=I[A];this.subscriptions.emit(L.action,L)}},c.prototype.onAttached=function(a){h.default.logAction(h.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+a),a?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var v=this.pendingPresence,g=v.length;if(g){this.pendingPresence=[];var S=[],D=x.default.create();h.default.logAction(h.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+g+" queued presence messages");for(var k=0;k<g;k++){var P=v[k];S.push(P.presence),D.push(P.callback)}this.channel.sendPresence(S,D)}},c.prototype.actOnChannelState=function(a,v,g){switch(a){case"attached":this.onAttached(v);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(g);break}},c.prototype.failPendingPresence=function(a){if(this.pendingPresence.length){h.default.logAction(h.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(a));for(var v=0;v<this.pendingPresence.length;v++)try{this.pendingPresence[v].callback(a)}catch{}this.pendingPresence=[]}},c.prototype._clearMyMembers=function(){this._myMembers.clear()},c.prototype._ensureMyMembersPresent=function(){var a=this,v=this._myMembers,g=function(k){if(k){var P="Presence auto-re-enter failed: "+k.toString(),I=new O.default(P,91004,400);h.default.logAction(h.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",P);var C=new l.default(a.channel.state,a.channel.state,!0,!1,I);a.channel.emit("update",C)}};for(var S in v.map){var D=v.map[S];h.default.logAction(h.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+D.clientId+'" into the presence set'),this._enterOrUpdateClient(D.id,D.clientId,D.data,"enter",g)}},c.prototype._synthesizeLeaves=function(a){var v=this.subscriptions;o.arrForEach(a,function(g){var S=m.default.fromValues({action:"leave",connectionId:g.connectionId,clientId:g.clientId,data:g.data,encoding:g.encoding,timestamp:o.now()});v.emit("leave",S)})},c.prototype.on=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];h.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,a)},c.prototype.off=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];h.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,a)},c.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var g=w.default.processListenerArgs(a),S=g[0],D=g[1],k=g[2],P=this.channel;if(!k){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[S,D]);k=E}if(P.state==="failed"){k(O.default.fromValues(P.invalidStateError()));return}this.subscriptions.on(S,D),P.attach(k)},c.prototype.unsubscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var g=w.default.processListenerArgs(a),S=g[0],D=g[1];this.subscriptions.off(S,D)},c}(u.default),p=function(f){s.__extends(c,f);function c(a,v){var g=f.call(this)||this;return g.presence=a,g.map=Object.create(null),g.syncInProgress=!1,g.residualMembers=null,g.memberKey=v,g}return c.prototype.get=function(a){return this.map[a]},c.prototype.getClient=function(a){var v=this.map,g=[];for(var S in v){var D=v[S];D.clientId==a&&D.action!="absent"&&g.push(D)}return g},c.prototype.list=function(a){var v=this.map,g=a&&a.clientId,S=a&&a.connectionId,D=[];for(var k in v){var P=v[k];P.action!=="absent"&&(g&&g!=P.clientId||S&&S!=P.connectionId||D.push(P))}return D},c.prototype.put=function(a){(a.action==="enter"||a.action==="update")&&(a=m.default.fromValues(a),a.action="present");var v=this.map,g=this.memberKey(a);this.residualMembers&&delete this.residualMembers[g];var S=v[g];return S&&!y(a,S)?!1:(v[g]=a,!0)},c.prototype.values=function(){var a=this.map,v=[];for(var g in a){var S=a[g];S.action!="absent"&&v.push(S)}return v},c.prototype.remove=function(a){var v=this.map,g=this.memberKey(a),S=v[g];return S&&!y(a,S)?!1:(this.syncInProgress?(a=m.default.fromValues(a),a.action="absent",v[g]=a):delete v[g],!0)},c.prototype.startSync=function(){var a=this.map,v=this.syncInProgress;h.default.logAction(h.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),this.syncInProgress||(this.residualMembers=o.copy(a),this.setInProgress(!0))},c.prototype.endSync=function(){var a=this.map,v=this.syncInProgress;if(h.default.logAction(h.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),v){for(var g in a){var S=a[g];S.action==="absent"&&delete a[g]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var g in this.residualMembers)delete a[g];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},c.prototype.waitSync=function(a){var v=this.syncInProgress;if(h.default.logAction(h.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),!v){a();return}this.once("sync",a)},c.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},c.prototype.setInProgress=function(a){h.default.logAction(h.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+a),this.syncInProgress=a,this.presence.syncComplete=!a},c}(d.default);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=i(56),u=i(31),d=i(11),h=s.__importDefault(i(5)),m=s.__importDefault(i(3)),O=function(){function w(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return w.prototype.isWordArray=function(x){return x!=null&&x.sigBytes!==void 0},w.prototype.isArrayBuffer=function(x){return x!=null&&x.constructor===ArrayBuffer},w.prototype.isTypedArray=function(x){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(x)},w.prototype.uint8ViewToBase64=function(x){for(var l="",E=this.base64CharSet,R=x.byteLength,M=R%3,b=R-M,y,T,p,f,c,a=0;a<b;a=a+3)c=x[a]<<16|x[a+1]<<8|x[a+2],y=(c&16515072)>>18,T=(c&258048)>>12,p=(c&4032)>>6,f=c&63,l+=E[y]+E[T]+E[p]+E[f];return M==1?(c=x[b],y=(c&252)>>2,T=(c&3)<<4,l+=E[y]+E[T]+"=="):M==2&&(c=x[b]<<8|x[b+1],y=(c&64512)>>10,T=(c&1008)>>4,p=(c&15)<<2,l+=E[y]+E[T]+E[p]+"="),l},w.prototype.base64ToArrayBuffer=function(x){for(var l=atob==null?void 0:atob(x),E=l.length,R=new Uint8Array(E),M=0;M<E;M++){var b=l.charCodeAt(M);R[M]=b}return R.buffer},w.prototype.isBuffer=function(x){return this.isArrayBuffer(x)||this.isWordArray(x)||this.isTypedArray(x)},w.prototype.toBuffer=function(x){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(x))return new Uint8Array(x);if(this.isTypedArray(x))return new Uint8Array(x.buffer);if(this.isWordArray(x)){for(var l=new ArrayBuffer(x.sigBytes),E=new Uint8Array(l),R=0;R<x.sigBytes;R++)E[R]=x.words[R>>>2]>>>24-R%4*8&255;return E}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},w.prototype.toArrayBuffer=function(x){return this.isArrayBuffer(x)?x:this.toBuffer(x).buffer},w.prototype.toWordArray=function(x){return this.isTypedArray(x)&&(x=x.buffer),this.isWordArray(x)?x:h.default.create(x)},w.prototype.base64Encode=function(x){return this.isWordArray(x)?(0,d.stringify)(x):this.uint8ViewToBase64(this.toBuffer(x))},w.prototype.base64Decode=function(x){return ArrayBuffer&&m.default.Config.atob?this.base64ToArrayBuffer(x):(0,d.parse)(x)},w.prototype.hexEncode=function(x){return(0,o.stringify)(this.toWordArray(x))},w.prototype.hexDecode=function(x){var l=(0,o.parse)(x);return ArrayBuffer?this.toArrayBuffer(l):l},w.prototype.utf8Encode=function(x){return m.default.Config.TextEncoder?new m.default.Config.TextEncoder().encode(x).buffer:(0,u.parse)(x)},w.prototype.utf8Decode=function(x){if(!this.isBuffer(x))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(x)?new TextDecoder().decode(x):(x=this.toWordArray(x),(0,u.stringify)(x))},w.prototype.bufferCompare=function(x,l){if(!x)return-1;if(!l)return 1;var E=this.toWordArray(x),R=this.toWordArray(l);E.clamp(),R.clamp();var M=E.sigBytes-R.sigBytes;if(M!=0)return M;for(var b=E.words,y=R.words,T=0;T<b.length;T++)if(M=b[T]-y[T],M!=0)return M;return 0},w.prototype.byteLength=function(x){return this.isArrayBuffer(x)||this.isTypedArray(x)?x.byteLength:this.isWordArray(x)?x.sigBytes:-1},w.prototype.typedArrayToBuffer=function(x){return x.buffer},w}();t.default=new O},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Hex})},function(n,t,i){i.r(t);var s=i(5),o=i.n(s),u=i(11),d=i(23),h=i.n(d),m=i(2),O=i.n(m),w=i(4),x=i.n(w),l=function(E,R){var M="aes",b=256,y="cbc",T=16,p=4,f=4294967296,c=2147483648,a;if(E.getRandomWordArray)a=E.getRandomWordArray;else if(typeof Uint32Array<"u"&&E.getRandomValues){var v=new Uint32Array(p);a=function(A,L){var U=A/4,B=U==p?v:new Uint32Array(U);E.getRandomValues(B,function($){typeof L<"u"&&L($,R.toWordArray(B))})}}else a=function(A,L){O.a.logAction(O.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var U=A/4,B=new Array(U),$=0;$<U;$++)B[$]=Math.floor(Math.random()*f)-c;L(null,o.a.create(B))};function g(A){return A+T&-T}function S(A){if(A.algorithm==="aes"&&A.mode==="cbc"){if(A.keyLength===128||A.keyLength===256)return;throw new Error("Unsupported key length "+A.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function D(A){return A.replace("_","/").replace("-","+")}var k=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function P(){}function I(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}P.CipherParams=I,P.getDefaultParams=function(A){var L;if(typeof A=="function"||typeof A=="string"){if(O.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof A=="function")O.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),P.generateRandomKey(function(B){A(null,P.getDefaultParams({key:B}))});else if(typeof arguments[1]=="function")O.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,P.getDefaultParams({key:A}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!A.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof A.key=="string"?L=Object(u.parse)(D(A.key)):L=R.toWordArray(A.key);var U=new I;if(U.key=L,U.algorithm=A.algorithm||M,U.keyLength=L.words.length*(4*8),U.mode=A.mode||y,A.keyLength&&A.keyLength!==U.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+A.keyLength+" was specified, but the key actually has length "+U.keyLength);return S(U),U},P.generateRandomKey=function(A,L){arguments.length==1&&typeof A=="function"&&(L=A,A=void 0),a((A||b)/8,function(U,B){L!==void 0&&L(U?x.a.fromValues(U):null,B)})},P.getCipher=function(A){var L=A instanceof I?A:P.getDefaultParams(A);return{cipherParams:L,cipher:new C(L,p,A.iv)}};function C(A,L,U){this.algorithm=A.algorithm+"-"+String(A.keyLength)+"-"+A.mode,this.cjsAlgorithm=A.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=R.toWordArray(A.key),U&&(this.iv=R.toWordArray(U).clone()),this.blockLengthWords=L}return C.prototype.encrypt=function(A,L){O.a.logAction(O.a.LOG_MICRO,"CBCCipher.encrypt()",""),A=R.toWordArray(A);var U=A.sigBytes,B=g(U),$=this,V=function(){$.getIv(function(H,_){if(H){L(H);return}var N=$.encryptCipher.process(A.concat(k[B-U])),F=_.concat(N);L(null,F)})};this.encryptCipher?V():this.iv?(this.encryptCipher=h.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),V()):a(T,function(H,_){if(H){L(H);return}$.encryptCipher=h.a.algo[$.cjsAlgorithm].createEncryptor($.key,{iv:_}),$.iv=_,V()})},C.prototype.decrypt=function(A){O.a.logAction(O.a.LOG_MICRO,"CBCCipher.decrypt()",""),A=R.toWordArray(A);var L=this.blockLengthWords,U=A.words,B=o.a.create(U.slice(0,L)),$=o.a.create(U.slice(L)),V=h.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:B}),H=V.process($),_=V.finalize();return V.reset(),_&&_.sigBytes&&H.concat(_),H},C.prototype.getIv=function(A){if(this.iv){var L=this.iv;this.iv=null,A(null,L);return}var U=this;a(T,function(B,$){if(B){A(B);return}A(null,U.encryptCipher.process($))})},P};t.default=l},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,u=o.lib,d=u.WordArray,h=o.enc;h.Utf16=h.Utf16BE={stringify:function(O){for(var w=O.words,x=O.sigBytes,l=[],E=0;E<x;E+=2){var R=w[E>>>2]>>>16-E%4*8&65535;l.push(String.fromCharCode(R))}return l.join("")},parse:function(O){for(var w=O.length,x=[],l=0;l<w;l++)x[l>>>1]|=O.charCodeAt(l)<<16-l%2*16;return d.create(x,w*2)}},h.Utf16LE={stringify:function(O){for(var w=O.words,x=O.sigBytes,l=[],E=0;E<x;E+=2){var R=m(w[E>>>2]>>>16-E%4*8&65535);l.push(String.fromCharCode(R))}return l.join("")},parse:function(O){for(var w=O.length,x=[],l=0;l<w;l++)x[l>>>1]|=m(O.charCodeAt(l)<<16-l%2*16);return d.create(x,w*2)}};function m(O){return O<<8&4278255360|O>>>8&16711935}}(),s.enc.Utf16})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(28))})(this,function(s){return function(o){var u=s,d=u.lib,h=d.CipherParams,m=u.enc,O=m.Hex,w=u.format;w.Hex={stringify:function(x){return x.ciphertext.toString(O)},parse:function(x){var l=O.parse(x);return h.create({ciphertext:l})}}}(),s.format.Hex})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(11),i(61),i(27),i(28))})(this,function(s){return function(){var o=s,u=o.lib,d=u.BlockCipher,h=o.algo,m=[],O=[],w=[],x=[],l=[],E=[],R=[],M=[],b=[],y=[];(function(){for(var f=[],c=0;c<256;c++)c<128?f[c]=c<<1:f[c]=c<<1^283;for(var a=0,v=0,c=0;c<256;c++){var g=v^v<<1^v<<2^v<<3^v<<4;g=g>>>8^g&255^99,m[a]=g,O[g]=a;var S=f[a],D=f[S],k=f[D],P=f[g]*257^g*16843008;w[a]=P<<24|P>>>8,x[a]=P<<16|P>>>16,l[a]=P<<8|P>>>24,E[a]=P;var P=k*16843009^D*65537^S*257^a*16843008;R[g]=P<<24|P>>>8,M[g]=P<<16|P>>>16,b[g]=P<<8|P>>>24,y[g]=P,a?(a=S^f[f[f[k^S]]],v^=f[f[v]]):a=v=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],p=h.AES=d.extend({_doReset:function(){var f;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var c=this._keyPriorReset=this._key,a=c.words,v=c.sigBytes/4,g=this._nRounds=v+6,S=(g+1)*4,D=this._keySchedule=[],k=0;k<S;k++)k<v?D[k]=a[k]:(f=D[k-1],k%v?v>6&&k%v==4&&(f=m[f>>>24]<<24|m[f>>>16&255]<<16|m[f>>>8&255]<<8|m[f&255]):(f=f<<8|f>>>24,f=m[f>>>24]<<24|m[f>>>16&255]<<16|m[f>>>8&255]<<8|m[f&255],f^=T[k/v|0]<<24),D[k]=D[k-v]^f);for(var P=this._invKeySchedule=[],I=0;I<S;I++){var k=S-I;if(I%4)var f=D[k];else var f=D[k-4];I<4||k<=4?P[I]=f:P[I]=R[m[f>>>24]]^M[m[f>>>16&255]]^b[m[f>>>8&255]]^y[m[f&255]]}}},encryptBlock:function(f,c){this._doCryptBlock(f,c,this._keySchedule,w,x,l,E,m)},decryptBlock:function(f,c){var a=f[c+1];f[c+1]=f[c+3],f[c+3]=a,this._doCryptBlock(f,c,this._invKeySchedule,R,M,b,y,O);var a=f[c+1];f[c+1]=f[c+3],f[c+3]=a},_doCryptBlock:function(f,c,a,v,g,S,D,k){for(var P=this._nRounds,I=f[c]^a[0],C=f[c+1]^a[1],A=f[c+2]^a[2],L=f[c+3]^a[3],U=4,B=1;B<P;B++){var $=v[I>>>24]^g[C>>>16&255]^S[A>>>8&255]^D[L&255]^a[U++],V=v[C>>>24]^g[A>>>16&255]^S[L>>>8&255]^D[I&255]^a[U++],H=v[A>>>24]^g[L>>>16&255]^S[I>>>8&255]^D[C&255]^a[U++],_=v[L>>>24]^g[I>>>16&255]^S[C>>>8&255]^D[A&255]^a[U++];I=$,C=V,A=H,L=_}var $=(k[I>>>24]<<24|k[C>>>16&255]<<16|k[A>>>8&255]<<8|k[L&255])^a[U++],V=(k[C>>>24]<<24|k[A>>>16&255]<<16|k[L>>>8&255]<<8|k[I&255])^a[U++],H=(k[A>>>24]<<24|k[L>>>16&255]<<16|k[I>>>8&255]<<8|k[C&255])^a[U++],_=(k[L>>>24]<<24|k[I>>>16&255]<<16|k[C>>>8&255]<<8|k[A&255])^a[U++];f[c]=$,f[c+1]=V,f[c+2]=H,f[c+3]=_},keySize:256/32});o.AES=d._createHelper(p)}(),s.AES})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var u=s,d=u.lib,h=d.WordArray,m=d.Hasher,O=u.algo,w=[];(function(){for(var b=0;b<64;b++)w[b]=o.abs(o.sin(b+1))*4294967296|0})();var x=O.MD5=m.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(b,y){for(var T=0;T<16;T++){var p=y+T,f=b[p];b[p]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360}var c=this._hash.words,a=b[y+0],v=b[y+1],g=b[y+2],S=b[y+3],D=b[y+4],k=b[y+5],P=b[y+6],I=b[y+7],C=b[y+8],A=b[y+9],L=b[y+10],U=b[y+11],B=b[y+12],$=b[y+13],V=b[y+14],H=b[y+15],_=c[0],N=c[1],F=c[2],j=c[3];_=l(_,N,F,j,a,7,w[0]),j=l(j,_,N,F,v,12,w[1]),F=l(F,j,_,N,g,17,w[2]),N=l(N,F,j,_,S,22,w[3]),_=l(_,N,F,j,D,7,w[4]),j=l(j,_,N,F,k,12,w[5]),F=l(F,j,_,N,P,17,w[6]),N=l(N,F,j,_,I,22,w[7]),_=l(_,N,F,j,C,7,w[8]),j=l(j,_,N,F,A,12,w[9]),F=l(F,j,_,N,L,17,w[10]),N=l(N,F,j,_,U,22,w[11]),_=l(_,N,F,j,B,7,w[12]),j=l(j,_,N,F,$,12,w[13]),F=l(F,j,_,N,V,17,w[14]),N=l(N,F,j,_,H,22,w[15]),_=E(_,N,F,j,v,5,w[16]),j=E(j,_,N,F,P,9,w[17]),F=E(F,j,_,N,U,14,w[18]),N=E(N,F,j,_,a,20,w[19]),_=E(_,N,F,j,k,5,w[20]),j=E(j,_,N,F,L,9,w[21]),F=E(F,j,_,N,H,14,w[22]),N=E(N,F,j,_,D,20,w[23]),_=E(_,N,F,j,A,5,w[24]),j=E(j,_,N,F,V,9,w[25]),F=E(F,j,_,N,S,14,w[26]),N=E(N,F,j,_,C,20,w[27]),_=E(_,N,F,j,$,5,w[28]),j=E(j,_,N,F,g,9,w[29]),F=E(F,j,_,N,I,14,w[30]),N=E(N,F,j,_,B,20,w[31]),_=R(_,N,F,j,k,4,w[32]),j=R(j,_,N,F,C,11,w[33]),F=R(F,j,_,N,U,16,w[34]),N=R(N,F,j,_,V,23,w[35]),_=R(_,N,F,j,v,4,w[36]),j=R(j,_,N,F,D,11,w[37]),F=R(F,j,_,N,I,16,w[38]),N=R(N,F,j,_,L,23,w[39]),_=R(_,N,F,j,$,4,w[40]),j=R(j,_,N,F,a,11,w[41]),F=R(F,j,_,N,S,16,w[42]),N=R(N,F,j,_,P,23,w[43]),_=R(_,N,F,j,A,4,w[44]),j=R(j,_,N,F,B,11,w[45]),F=R(F,j,_,N,H,16,w[46]),N=R(N,F,j,_,g,23,w[47]),_=M(_,N,F,j,a,6,w[48]),j=M(j,_,N,F,I,10,w[49]),F=M(F,j,_,N,V,15,w[50]),N=M(N,F,j,_,k,21,w[51]),_=M(_,N,F,j,B,6,w[52]),j=M(j,_,N,F,S,10,w[53]),F=M(F,j,_,N,L,15,w[54]),N=M(N,F,j,_,v,21,w[55]),_=M(_,N,F,j,C,6,w[56]),j=M(j,_,N,F,H,10,w[57]),F=M(F,j,_,N,P,15,w[58]),N=M(N,F,j,_,$,21,w[59]),_=M(_,N,F,j,D,6,w[60]),j=M(j,_,N,F,U,10,w[61]),F=M(F,j,_,N,g,15,w[62]),N=M(N,F,j,_,A,21,w[63]),c[0]=c[0]+_|0,c[1]=c[1]+N|0,c[2]=c[2]+F|0,c[3]=c[3]+j|0},_doFinalize:function(){var b=this._data,y=b.words,T=this._nDataBytes*8,p=b.sigBytes*8;y[p>>>5]|=128<<24-p%32;var f=o.floor(T/4294967296),c=T;y[(p+64>>>9<<4)+15]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,y[(p+64>>>9<<4)+14]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,b.sigBytes=(y.length+1)*4,this._process();for(var a=this._hash,v=a.words,g=0;g<4;g++){var S=v[g];v[g]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}return a},clone:function(){var b=m.clone.call(this);return b._hash=this._hash.clone(),b}});function l(b,y,T,p,f,c,a){var v=b+(y&T|~y&p)+f+a;return(v<<c|v>>>32-c)+y}function E(b,y,T,p,f,c,a){var v=b+(y&p|T&~p)+f+a;return(v<<c|v>>>32-c)+y}function R(b,y,T,p,f,c,a){var v=b+(y^T^p)+f+a;return(v<<c|v>>>32-c)+y}function M(b,y,T,p,f,c,a){var v=b+(T^(y|~p))+f+a;return(v<<c|v>>>32-c)+y}u.MD5=m._createHelper(x),u.HmacMD5=m._createHmacHelper(x)}(Math),s.MD5})},function(n,t,i){var s;Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),u=o.__importDefault(i(3)),d=o.__importStar(i(1)),h=o.__importDefault(i(8)),m=i(4),O=o.__importDefault(i(19)),w=o.__importDefault(i(17)),x=o.__importDefault(i(22)),l=o.__importDefault(i(2)),E=i(29),R=o.__importDefault(i(63)),M=i(14);function b(p){var f=p.statusCode;return f===408&&!p.code||f===400&&!p.code||f>=500&&f<=504}function y(p){var f=p.connection,c=f&&f.connectionManager.host;return c?[c].concat(h.default.getFallbackHosts(p.options)):h.default.getHosts(p.options)}var T=(s=function(){function p(f){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=y,this.options=f||{};var c=this.options.connectivityCheckUrl||h.default.connectivityCheckUrl,a=this.options.connectivityCheckParams,v=!this.options.connectivityCheckUrl;u.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(g,S,D,k,P,I,C){var A=w.default.createRequest(D,k,P,I,x.default.REQ_SEND,S&&S.options.timeouts,g);return A.once("complete",C),A.exec(),A},this.options.disableConnectivityCheck?this.checkConnectivity=function(g){g(null,!0)}:this.checkConnectivity=function(g){l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+c),this.doUri(O.default.Get,null,c,null,null,a,function(S,D,k,P,I){var C=!1;v?C=!S&&(D==null?void 0:D.replace(/\n/,""))=="yes":C=!S&&(0,M.isSuccessCode)(I),l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+C),g(null,C)})}):u.default.Config.jsonpSupported?(this.Request=function(g,S,D,k,P,I,C){var A=(0,E.createRequest)(D,k,P,I,x.default.REQ_SEND,S&&S.options.timeouts,g);return A.once("complete",C),u.default.Config.nextTick(function(){A.exec()}),A},this.options.disableConnectivityCheck?this.checkConnectivity=function(g){g(null,!0)}:this.checkConnectivity=function(g){var S=this,D=h.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(g);return}this.checksInProgress=[g],l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+D);var k=new E.Request("isTheInternetUp",D,null,null,null,x.default.REQ_SEND,h.default.TIMEOUTS);k.once("complete",function(P,I){var C=!P&&I;l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+C);for(var A=0;A<S.checksInProgress.length;A++)S.checksInProgress[A](null,C);S.checksInProgress=null}),u.default.Config.nextTick(function(){k.exec()})}):u.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=R.default,this.checkConnectivity=function(g){l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+c),this.doUri(O.default.Get,null,c,null,null,null,function(S,D){var k=!S&&(D==null?void 0:D.replace(/\n/,""))=="yes";l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+k),g(null,k)})}):this.Request=function(g,S,D,k,P,I,C){C(new m.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return p.prototype.do=function(f,c,a,v,g,S,D){var k=this,P=typeof a=="function"?a:function(L){return c.baseUri(L)+a},I=c._currentFallback;if(I)if(I.validUntil>d.now()){if(!this.Request){D==null||D(new m.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(f,c,P(I.host),v,S,g,function(L){for(var U=[],B=1;B<arguments.length;B++)U[B-1]=arguments[B];if(L&&b(L)){c._currentFallback=null,k.do(f,c,a,v,g,S,D);return}D==null||D.apply(void 0,o.__spreadArray([L],U,!1))});return}else c._currentFallback=null;var C=y(c);if(C.length===1){this.doUri(f,c,P(C[0]),v,g,S,D);return}var A=function(L,U){var B=L.shift();k.doUri(f,c,P(B),v,g,S,function($){for(var V=[],H=1;H<arguments.length;H++)V[H-1]=arguments[H];if($&&b($)&&L.length){A(L,!0);return}U&&(c._currentFallback={host:B,validUntil:d.now()+c.options.timeouts.fallbackRetryTimeout}),D==null||D.apply(void 0,o.__spreadArray([$],V,!1))})};A(C)},p.prototype.doUri=function(f,c,a,v,g,S,D){if(!this.Request){D(new m.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(f,c,a,v,S,g,D)},p}(),s.methods=[O.default.Get,O.default.Delete,O.default.Post,O.default.Put,O.default.Patch],s.methodsWithoutBody=[O.default.Get,O.default.Delete],s.methodsWithBody=[O.default.Post,O.default.Put,O.default.Patch],s);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(4)),u=s.__importDefault(i(3)),d=s.__importDefault(i(8)),h=s.__importStar(i(1)),m=i(1);function O(l,E){return!!E.get("x-ably-errorcode")}function w(l,E){if(O(l,E))return l.error&&o.default.fromValues(l.error)}function x(l,E,R,M,b,y,T){var p=new Headers(M||{}),f=l?l.toUpperCase():h.isEmptyArg(y)?"GET":"POST",c=new AbortController,a=setTimeout(function(){c.abort(),T(new o.PartialErrorInfo("Request timed out",null,408))},E?E.options.timeouts.httpRequestTimeout:d.default.TIMEOUTS.httpRequestTimeout),v={method:f,headers:p,body:y};u.default.Config.isWebworker||(v.credentials=p.has("authorization")?"include":"same-origin"),(0,m.getGlobalObject)().fetch(R+"?"+new URLSearchParams(b||{}),v).then(function(g){clearTimeout(a);var S=g.headers.get("Content-Type"),D;S&&S.indexOf("application/x-msgpack")>-1?D=g.arrayBuffer():S&&S.indexOf("application/json")>-1?D=g.json():D=g.text(),D.then(function(k){var P=!!S&&S.indexOf("application/x-msgpack")===-1;if(g.ok)T(null,k,g.headers,P,g.status);else{var I=w(k,g.headers)||new o.PartialErrorInfo("Error response received from server: "+g.status+" body was: "+u.default.Config.inspect(k),null,g.status);T(I,k,g.headers,P,g.status)}})}).catch(function(g){clearTimeout(a),T(g)})}t.default=x},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(41)),u=s.__importStar(i(1)),d=u.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function h(){var x=d.location;return!d.WebSocket||!x||!x.origin||x.origin.indexOf("http")>-1}var m=d.navigator&&d.navigator.userAgent.toString(),O=d.location&&d.location.href,w={agent:"browser",logTimestamps:!0,userAgent:m,currentUrl:O,noUpgrade:m&&!!m.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:d.WebSocket,fetchSupported:!!d.fetch,xhrSupported:d.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:h(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!d.TextDecoder,preferBinary:!1,ArrayBuffer:d.ArrayBuffer,atob:d.atob,nextTick:typeof d.setImmediate<"u"?d.setImmediate.bind(d):function(x){setTimeout(x,0)},addEventListener:d.addEventListener,inspect:JSON.stringify,stringByteSize:function(x){return d.TextDecoder&&new d.TextEncoder().encode(x).length||x.length},TextEncoder:d.TextEncoder,TextDecoder:d.TextDecoder,Promise:d.Promise,getRandomValues:function(x){if(x!==void 0)return function(l,E){x.getRandomValues(l),E&&E(null)}}(d.crypto||msCrypto)};t.default=w},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),u=o.__importStar(i(1)),d="ablyjs-storage-test",h=function(){function m(){try{s.sessionStorage.setItem(d,d),s.sessionStorage.removeItem(d),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{s.localStorage.setItem(d,d),s.localStorage.removeItem(d),this.localSupported=!0}catch{this.localSupported=!1}}return m.prototype.get=function(O){return this._get(O,!1)},m.prototype.getSession=function(O){return this._get(O,!0)},m.prototype.remove=function(O){return this._remove(O,!1)},m.prototype.removeSession=function(O){return this._remove(O,!0)},m.prototype.set=function(O,w,x){return this._set(O,w,x,!1)},m.prototype.setSession=function(O,w,x){return this._set(O,w,x,!0)},m.prototype._set=function(O,w,x,l){var E={value:w};return x&&(E.expires=u.now()+x),this.storageInterface(l).setItem(O,JSON.stringify(E))},m.prototype._get=function(O,w){if(w&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!w&&!this.localSupported)throw new Error("Local Storage not supported");var x=this.storageInterface(w).getItem(O);if(!x)return null;var l=JSON.parse(x);return l.expires&&l.expires<u.now()?(this.storageInterface(w).removeItem(O),null):l.value},m.prototype._remove=function(O,w){return this.storageInterface(w).removeItem(O)},m.prototype.storageInterface=function(O){return O?s.sessionStorage:s.localStorage},m}();t.default=new h}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(67)),u={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};t.default=u},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(s||(s={})),t.default=s},function(n,t,i){i.r(t);var s=i(29),o=i.n(s),u=i(1),d=i(3),h=i.n(d),m=i(12),O=i.n(m),w=i(17),x=i.n(w),l=function(b){var y="xhr_polling";function T(p,f,c){c.stream=!1,O.a.call(this,p,f,c),this.shortName=y}return u.inherits(T,O.a),T.isAvailable=function(){return h.a.Config.xhrSupported&&h.a.Config.allowComet},T.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(p,f,c,a,v){return x.a.createRequest(p,f,c,a,v,this.timeouts)},typeof b<"u"&&T.isAvailable()&&(b.supportedTransports[y]=T),T},E=l,R=function(b){var y="xhr_streaming";function T(p,f,c){O.a.call(this,p,f,c),this.shortName=y}return u.inherits(T,O.a),T.isAvailable=function(){return h.a.Config.xhrSupported&&h.a.Config.streamingSupported&&h.a.Config.allowComet},T.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(p,f,c,a,v){return x.a.createRequest(p,f,c,a,v,this.timeouts)},typeof b<"u"&&T.isAvailable()&&(b.supportedTransports[y]=T),T},M=R;t.default=[o.a,E,M]}]).default})})(ii);var oi=ii.exports;const Vs=Pn(oi),ql=ji({__proto__:null,default:Vs},[oi]);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Re=function(){return Re=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Re.apply(this,arguments)},Ws=function(){function r(e){this.options=e,this.listeners={}}return r.prototype.on=function(e,n){var t=this.listeners[e]||[];this.listeners[e]=t.concat([n])},r.prototype.triggerEvent=function(e,n){var t=this,i=this.listeners[e]||[];i.forEach(function(s){return s({target:t,event:n})})},r}(),Ye;(function(r){r[r.Add=0]="Add",r[r.Remove=1]="Remove"})(Ye||(Ye={}));var zs=function(){function r(){this.notifications=[]}return r.prototype.push=function(e){this.notifications.push(e),this.updateFn(e,Ye.Add,this.notifications)},r.prototype.splice=function(e,n){var t=this.notifications.splice(e,n)[0];return this.updateFn(t,Ye.Remove,this.notifications),t},r.prototype.indexOf=function(e){return this.notifications.indexOf(e)},r.prototype.onUpdate=function(e){this.updateFn=e},r}(),Fe;(function(r){r.Dismiss="dismiss",r.Click="click"})(Fe||(Fe={}));var er={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},Ks=function(){function r(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var e=document.createDocumentFragment(),n=this._createHTMLElement({tagName:"div",className:"notyf"});e.appendChild(n),document.body.appendChild(e),this.container=n,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return r.prototype.on=function(e,n){var t;this.events=Re(Re({},this.events),(t={},t[e]=n,t))},r.prototype.update=function(e,n){n===Ye.Add?this.addNotification(e):n===Ye.Remove&&this.removeNotification(e)},r.prototype.removeNotification=function(e){var n=this,t=this._popRenderedNotification(e),i;if(t){i=t.node,i.classList.add("notyf__toast--disappear");var s;i.addEventListener(this.animationEndEventName,s=function(o){o.target===i&&(i.removeEventListener(n.animationEndEventName,s),n.container.removeChild(i))})}},r.prototype.addNotification=function(e){var n=this._renderNotification(e);this.notifications.push({notification:e,node:n}),this._announce(e.options.message||"Notification")},r.prototype._renderNotification=function(e){var n,t=this._buildNotificationCard(e),i=e.options.className;return i&&(n=t.classList).add.apply(n,i.split(" ")),this.container.appendChild(t),t},r.prototype._popRenderedNotification=function(e){for(var n=-1,t=0;t<this.notifications.length&&n<0;t++)this.notifications[t].notification===e&&(n=t);if(n!==-1)return this.notifications.splice(n,1)[0]},r.prototype.getXPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.x)||"right"},r.prototype.getYPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.y)||"bottom"},r.prototype.adjustContainerAlignment=function(e){var n=this.X_POSITION_FLEX_MAP[this.getXPosition(e)],t=this.Y_POSITION_FLEX_MAP[this.getYPosition(e)],i=this.container.style;i.setProperty("justify-content",t),i.setProperty("align-items",n)},r.prototype._buildNotificationCard=function(e){var n=this,t=e.options,i=t.icon;this.adjustContainerAlignment(t);var s=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),u=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),d=this._createHTMLElement({tagName:"div",className:"notyf__message"});d.innerHTML=t.message||"";var h=t.background||t.backgroundColor;if(i){var m=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof i=="string"||i instanceof String)&&(m.innerHTML=new String(i).valueOf()),typeof i=="object"){var O=i.tagName,w=O===void 0?"i":O,x=i.className,l=i.text,E=i.color,R=E===void 0?h:E,M=this._createHTMLElement({tagName:w,className:x,text:l});R&&(M.style.color=R),m.appendChild(M)}u.appendChild(m)}if(u.appendChild(d),s.appendChild(u),h&&(t.ripple?(o.style.background=h,s.appendChild(o)):s.style.background=h),t.dismissible){var b=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),y=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});b.appendChild(y),u.appendChild(b),s.classList.add("notyf__toast--dismissible"),y.addEventListener("click",function(p){var f,c;(c=(f=n.events)[Fe.Dismiss])===null||c===void 0||c.call(f,{target:e,event:p}),p.stopPropagation()})}s.addEventListener("click",function(p){var f,c;return(c=(f=n.events)[Fe.Click])===null||c===void 0?void 0:c.call(f,{target:e,event:p})});var T=this.getYPosition(t)==="top"?"upper":"lower";return s.classList.add("notyf__toast--"+T),s},r.prototype._createHTMLElement=function(e){var n=e.tagName,t=e.className,i=e.text,s=document.createElement(n);return t&&(s.className=t),s.textContent=i||null,s},r.prototype._createA11yContainer=function(){var e=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),e.style.border="0",e.style.clip="rect(0 0 0 0)",e.style.height="1px",e.style.margin="-1px",e.style.overflow="hidden",e.style.padding="0",e.style.position="absolute",e.style.width="1px",e.style.outline="0",document.body.appendChild(e),this.a11yContainer=e},r.prototype._announce=function(e){var n=this;this.a11yContainer.textContent="",setTimeout(function(){n.a11yContainer.textContent=e},100)},r.prototype._getAnimationEndEventName=function(){var e=document.createElement("_fake"),n={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},t;for(t in n)if(e.style[t]!==void 0)return n[t];return"animationend"},r}(),Jl=function(){function r(e){var n=this;this.dismiss=this._removeNotification,this.notifications=new zs,this.view=new Ks;var t=this.registerTypes(e);this.options=Re(Re({},er),e),this.options.types=t,this.notifications.onUpdate(function(i,s){return n.view.update(i,s)}),this.view.on(Fe.Dismiss,function(i){var s=i.target,o=i.event;n._removeNotification(s),s.triggerEvent(Fe.Dismiss,o)}),this.view.on(Fe.Click,function(i){var s=i.target,o=i.event;return s.triggerEvent(Fe.Click,o)})}return r.prototype.error=function(e){var n=this.normalizeOptions("error",e);return this.open(n)},r.prototype.success=function(e){var n=this.normalizeOptions("success",e);return this.open(n)},r.prototype.open=function(e){var n=this.options.types.find(function(s){var o=s.type;return o===e.type})||{},t=Re(Re({},n),e);this.assignProps(["ripple","position","dismissible"],t);var i=new Ws(t);return this._pushNotification(i),i},r.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},r.prototype.assignProps=function(e,n){var t=this;e.forEach(function(i){n[i]=n[i]==null?t.options[i]:n[i]})},r.prototype._pushNotification=function(e){var n=this;this.notifications.push(e);var t=e.options.duration!==void 0?e.options.duration:this.options.duration;t&&setTimeout(function(){return n._removeNotification(e)},t)},r.prototype._removeNotification=function(e){var n=this.notifications.indexOf(e);n!==-1&&this.notifications.splice(n,1)},r.prototype.normalizeOptions=function(e,n){var t={type:e};return typeof n=="string"?t.message=n:typeof n=="object"&&(t=Re(Re({},t),n)),t},r.prototype.registerTypes=function(e){var n=(e&&e.types||[]).slice(),t=er.types.map(function(i){var s=-1;n.forEach(function(u,d){u.type===i.type&&(s=d)});var o=s!==-1?n.splice(s,1)[0]:{};return Re(Re({},i),o)});return t.concat(n)},r}(),on={exports:{}},tr;function si(){return tr||(tr=1,function(r,e){(function(n,t){r.exports=t()})(dt,function(){var n=1e3,t=6e4,i=36e5,s="millisecond",o="second",u="minute",d="hour",h="day",m="week",O="month",w="quarter",x="year",l="date",E="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,M=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,b={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(P){var I=["th","st","nd","rd"],C=P%100;return"["+P+(I[(C-20)%10]||I[C]||I[0])+"]"}},y=function(P,I,C){var A=String(P);return!A||A.length>=I?P:""+Array(I+1-A.length).join(C)+P},T={s:y,z:function(P){var I=-P.utcOffset(),C=Math.abs(I),A=Math.floor(C/60),L=C%60;return(I<=0?"+":"-")+y(A,2,"0")+":"+y(L,2,"0")},m:function P(I,C){if(I.date()<C.date())return-P(C,I);var A=12*(C.year()-I.year())+(C.month()-I.month()),L=I.clone().add(A,O),U=C-L<0,B=I.clone().add(A+(U?-1:1),O);return+(-(A+(C-L)/(U?L-B:B-L))||0)},a:function(P){return P<0?Math.ceil(P)||0:Math.floor(P)},p:function(P){return{M:O,y:x,w:m,d:h,D:l,h:d,m:u,s:o,ms:s,Q:w}[P]||String(P||"").toLowerCase().replace(/s$/,"")},u:function(P){return P===void 0}},p="en",f={};f[p]=b;var c="$isDayjsObject",a=function(P){return P instanceof D||!(!P||!P[c])},v=function P(I,C,A){var L;if(!I)return p;if(typeof I=="string"){var U=I.toLowerCase();f[U]&&(L=U),C&&(f[U]=C,L=U);var B=I.split("-");if(!L&&B.length>1)return P(B[0])}else{var $=I.name;f[$]=I,L=$}return!A&&L&&(p=L),L||!A&&p},g=function(P,I){if(a(P))return P.clone();var C=typeof I=="object"?I:{};return C.date=P,C.args=arguments,new D(C)},S=T;S.l=v,S.i=a,S.w=function(P,I){return g(P,{locale:I.$L,utc:I.$u,x:I.$x,$offset:I.$offset})};var D=function(){function P(C){this.$L=v(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[c]=!0}var I=P.prototype;return I.parse=function(C){this.$d=function(A){var L=A.date,U=A.utc;if(L===null)return new Date(NaN);if(S.u(L))return new Date;if(L instanceof Date)return new Date(L);if(typeof L=="string"&&!/Z$/i.test(L)){var B=L.match(R);if(B){var $=B[2]-1||0,V=(B[7]||"0").substring(0,3);return U?new Date(Date.UTC(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)):new Date(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)}}return new Date(L)}(C),this.init()},I.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},I.$utils=function(){return S},I.isValid=function(){return this.$d.toString()!==E},I.isSame=function(C,A){var L=g(C);return this.startOf(A)<=L&&L<=this.endOf(A)},I.isAfter=function(C,A){return g(C)<this.startOf(A)},I.isBefore=function(C,A){return this.endOf(A)<g(C)},I.$g=function(C,A,L){return S.u(C)?this[A]:this.set(L,C)},I.unix=function(){return Math.floor(this.valueOf()/1e3)},I.valueOf=function(){return this.$d.getTime()},I.startOf=function(C,A){var L=this,U=!!S.u(A)||A,B=S.p(C),$=function(J,Y){var X=S.w(L.$u?Date.UTC(L.$y,Y,J):new Date(L.$y,Y,J),L);return U?X:X.endOf(h)},V=function(J,Y){return S.w(L.toDate()[J].apply(L.toDate("s"),(U?[0,0,0,0]:[23,59,59,999]).slice(Y)),L)},H=this.$W,_=this.$M,N=this.$D,F="set"+(this.$u?"UTC":"");switch(B){case x:return U?$(1,0):$(31,11);case O:return U?$(1,_):$(0,_+1);case m:var j=this.$locale().weekStart||0,W=(H<j?H+7:H)-j;return $(U?N-W:N+(6-W),_);case h:case l:return V(F+"Hours",0);case d:return V(F+"Minutes",1);case u:return V(F+"Seconds",2);case o:return V(F+"Milliseconds",3);default:return this.clone()}},I.endOf=function(C){return this.startOf(C,!1)},I.$set=function(C,A){var L,U=S.p(C),B="set"+(this.$u?"UTC":""),$=(L={},L[h]=B+"Date",L[l]=B+"Date",L[O]=B+"Month",L[x]=B+"FullYear",L[d]=B+"Hours",L[u]=B+"Minutes",L[o]=B+"Seconds",L[s]=B+"Milliseconds",L)[U],V=U===h?this.$D+(A-this.$W):A;if(U===O||U===x){var H=this.clone().set(l,1);H.$d[$](V),H.init(),this.$d=H.set(l,Math.min(this.$D,H.daysInMonth())).$d}else $&&this.$d[$](V);return this.init(),this},I.set=function(C,A){return this.clone().$set(C,A)},I.get=function(C){return this[S.p(C)]()},I.add=function(C,A){var L,U=this;C=Number(C);var B=S.p(A),$=function(_){var N=g(U);return S.w(N.date(N.date()+Math.round(_*C)),U)};if(B===O)return this.set(O,this.$M+C);if(B===x)return this.set(x,this.$y+C);if(B===h)return $(1);if(B===m)return $(7);var V=(L={},L[u]=t,L[d]=i,L[o]=n,L)[B]||1,H=this.$d.getTime()+C*V;return S.w(H,this)},I.subtract=function(C,A){return this.add(-1*C,A)},I.format=function(C){var A=this,L=this.$locale();if(!this.isValid())return L.invalidDate||E;var U=C||"YYYY-MM-DDTHH:mm:ssZ",B=S.z(this),$=this.$H,V=this.$m,H=this.$M,_=L.weekdays,N=L.months,F=L.meridiem,j=function(Y,X,ee,re){return Y&&(Y[X]||Y(A,U))||ee[X].slice(0,re)},W=function(Y){return S.s($%12||12,Y,"0")},J=F||function(Y,X,ee){var re=Y<12?"AM":"PM";return ee?re.toLowerCase():re};return U.replace(M,function(Y,X){return X||function(ee){switch(ee){case"YY":return String(A.$y).slice(-2);case"YYYY":return S.s(A.$y,4,"0");case"M":return H+1;case"MM":return S.s(H+1,2,"0");case"MMM":return j(L.monthsShort,H,N,3);case"MMMM":return j(N,H);case"D":return A.$D;case"DD":return S.s(A.$D,2,"0");case"d":return String(A.$W);case"dd":return j(L.weekdaysMin,A.$W,_,2);case"ddd":return j(L.weekdaysShort,A.$W,_,3);case"dddd":return _[A.$W];case"H":return String($);case"HH":return S.s($,2,"0");case"h":return W(1);case"hh":return W(2);case"a":return J($,V,!0);case"A":return J($,V,!1);case"m":return String(V);case"mm":return S.s(V,2,"0");case"s":return String(A.$s);case"ss":return S.s(A.$s,2,"0");case"SSS":return S.s(A.$ms,3,"0");case"Z":return B}return null}(Y)||B.replace(":","")})},I.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},I.diff=function(C,A,L){var U,B=this,$=S.p(A),V=g(C),H=(V.utcOffset()-this.utcOffset())*t,_=this-V,N=function(){return S.m(B,V)};switch($){case x:U=N()/12;break;case O:U=N();break;case w:U=N()/3;break;case m:U=(_-H)/6048e5;break;case h:U=(_-H)/864e5;break;case d:U=_/i;break;case u:U=_/t;break;case o:U=_/n;break;default:U=_}return L?U:S.a(U)},I.daysInMonth=function(){return this.endOf(O).$D},I.$locale=function(){return f[this.$L]},I.locale=function(C,A){if(!C)return this.$L;var L=this.clone(),U=v(C,A,!0);return U&&(L.$L=U),L},I.clone=function(){return S.w(this.$d,this)},I.toDate=function(){return new Date(this.valueOf())},I.toJSON=function(){return this.isValid()?this.toISOString():null},I.toISOString=function(){return this.$d.toISOString()},I.toString=function(){return this.$d.toUTCString()},P}(),k=D.prototype;return g.prototype=k,[["$ms",s],["$s",o],["$m",u],["$H",d],["$W",h],["$M",O],["$y",x],["$D",l]].forEach(function(P){k[P[1]]=function(I){return this.$g(I,P[0],P[1])}}),g.extend=function(P,I){return P.$i||(P(I,D,g),P.$i=!0),g},g.locale=v,g.isDayjs=a,g.unix=function(P){return g(1e3*P)},g.en=f[p],g.Ls=f,g.p={},g})}(on)),on.exports}var qs=si();const Yl=Pn(qs);var Js={exports:{}};(function(r,e){(function(n,t){r.exports=t(si())})(dt,function(n){function t(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var i=t(n),s={name:"id",weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),weekStart:1,formats:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},ordinal:function(o){return o+"."}};return i.default.locale(s,null,!0),s})})(Js);var ai={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(dt,function(){return function(n,t,i){n=n||{};var s=t.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function u(h,m,O,w){return s.fromToBase(h,m,O,w)}i.en.relativeTime=o,s.fromToBase=function(h,m,O,w,x){for(var l,E,R,M=O.$locale().relativeTime||o,b=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],y=b.length,T=0;T<y;T+=1){var p=b[T];p.d&&(l=w?i(h).diff(O,p.d,!0):O.diff(h,p.d,!0));var f=(n.rounding||Math.round)(Math.abs(l));if(R=l>0,f<=p.r||!p.r){f<=1&&T>0&&(p=b[T-1]);var c=M[p.l];x&&(f=x(""+f)),E=typeof c=="string"?c.replace("%d",f):c(f,m,p.l,R);break}}if(m)return E;var a=R?M.future:M.past;return typeof a=="function"?a(E):a.replace("%s",E)},s.to=function(h,m){return u(h,m,this,!0)},s.from=function(h,m){return u(h,m,this)};var d=function(h){return h.$u?i.utc():i()};s.toNow=function(h){return this.to(d(this),h)},s.fromNow=function(h){return this.from(d(this),h)}}})})(ai);var Ys=ai.exports;const Ql=Pn(Ys);function sn(r,e){r.split(/\s+/).forEach(n=>{e(n)})}class Qs{constructor(){this._events={}}on(e,n){sn(e,t=>{const i=this._events[t]||[];i.push(n),this._events[t]=i})}off(e,n){var t=arguments.length;if(t===0){this._events={};return}sn(e,i=>{if(t===1){delete this._events[i];return}const s=this._events[i];s!==void 0&&(s.splice(s.indexOf(n),1),this._events[i]=s)})}trigger(e,...n){var t=this;sn(e,i=>{const s=t._events[i];s!==void 0&&s.forEach(o=>{o.apply(t,n)})})}}function Xs(r){return r.plugins={},class extends r{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,n){r.plugins[e]={name:e,fn:n}}initializePlugins(e){var n,t;const i=this,s=[];if(Array.isArray(e))e.forEach(o=>{typeof o=="string"?s.push(o):(i.plugins.settings[o.name]=o.options,s.push(o.name))});else if(e)for(n in e)e.hasOwnProperty(n)&&(i.plugins.settings[n]=e[n],s.push(n));for(;t=s.shift();)i.require(t)}loadPlugin(e){var n=this,t=n.plugins,i=r.plugins[e];if(!r.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(n,[n.plugins.settings[e]||{}]),t.names.push(e)}require(e){var n=this,t=n.plugins;if(!n.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');n.loadPlugin(e)}return t.loaded[e]}}}const Yt=r=>(r=r.filter(Boolean),r.length<2?r[0]||"":ea(r)==1?"["+r.join("")+"]":"(?:"+r.join("|")+")"),ui=r=>{if(!Zs(r))return r.join("");let e="",n=0;const t=()=>{n>1&&(e+="{"+n+"}")};return r.forEach((i,s)=>{if(i===r[s-1]){n++;return}t(),e+=i,n=1}),t(),e},li=r=>{let e=Array.from(r);return Yt(e)},Zs=r=>new Set(r).size!==r.length,lt=r=>(r+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),ea=r=>r.reduce((e,n)=>Math.max(e,ta(n)),0),ta=r=>Array.from(r).length,ci=r=>{if(r.length===1)return[[r]];let e=[];const n=r.substring(1);return ci(n).forEach(function(i){let s=i.slice(0);s[0]=r.charAt(0)+s[0],e.push(s),s=i.slice(0),s.unshift(r.charAt(0)),e.push(s)}),e},na=[[0,65535]],ra="[-]";let Nt,fi;const ia=3,Ln={},nr={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let r in nr){let e=nr[r]||"";for(let n=0;n<e.length;n++){let t=e.substring(n,n+1);Ln[t]=r}}const oa=new RegExp(Object.keys(Ln).join("|")+"|"+ra,"gu"),sa=r=>{Nt===void 0&&(Nt=ca(na))},rr=(r,e="NFKD")=>r.normalize(e),Ut=r=>Array.from(r).reduce((e,n)=>e+aa(n),""),aa=r=>(r=rr(r).toLowerCase().replace(oa,e=>Ln[e]||""),rr(r,"NFC"));function*ua(r){for(const[e,n]of r)for(let t=e;t<=n;t++){let i=String.fromCharCode(t),s=Ut(i);s!=i.toLowerCase()&&(s.length>ia||s.length!=0&&(yield{folded:s,composed:i,code_point:t}))}}const la=r=>{const e={},n=(t,i)=>{const s=e[t]||new Set,o=new RegExp("^"+li(s)+"$","iu");i.match(o)||(s.add(lt(i)),e[t]=s)};for(let t of ua(r))n(t.folded,t.folded),n(t.folded,t.composed);return e},ca=r=>{const e=la(r),n={};let t=[];for(let s in e){let o=e[s];o&&(n[s]=li(o)),s.length>1&&t.push(lt(s))}t.sort((s,o)=>o.length-s.length);const i=Yt(t);return fi=new RegExp("^"+i,"u"),n},fa=(r,e=1)=>{let n=0;return r=r.map(t=>(Nt[t]&&(n+=t.length),Nt[t]||t)),n>=e?ui(r):""},da=(r,e=1)=>(e=Math.max(e,r.length-1),Yt(ci(r).map(n=>fa(n,e)))),ir=(r,e=!0)=>{let n=r.length>1?1:0;return Yt(r.map(t=>{let i=[];const s=e?t.length():t.length()-1;for(let o=0;o<s;o++)i.push(da(t.substrs[o]||"",n));return ui(i)}))},ha=(r,e)=>{for(const n of e){if(n.start!=r.start||n.end!=r.end||n.substrs.join("")!==r.substrs.join(""))continue;let t=r.parts;const i=o=>{for(const u of t){if(u.start===o.start&&u.substr===o.substr)return!1;if(!(o.length==1||u.length==1)&&(o.start<u.start&&o.end>u.start||u.start<o.start&&u.end>o.start))return!0}return!1};if(!(n.parts.filter(i).length>0))return!0}return!1};class Ft{constructor(){He(this,"parts");He(this,"substrs");He(this,"start");He(this,"end");this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,n){let t=new Ft,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const d of i)t.add(d);let o=n.substr.substring(0,e-s.start),u=o.length;return t.add({start:s.start,end:s.start+u,length:u,substr:o}),t}}const pa=r=>{sa(),r=Ut(r);let e="",n=[new Ft];for(let t=0;t<r.length;t++){let s=r.substring(t).match(fi);const o=r.substring(t,t+1),u=s?s[0]:null;let d=[],h=new Set;for(const m of n){const O=m.last();if(!O||O.length==1||O.end<=t)if(u){const w=u.length;m.add({start:t,end:t+w,length:w,substr:u}),h.add("1")}else m.add({start:t,end:t+1,length:1,substr:o}),h.add("2");else if(u){let w=m.clone(t,O);const x=u.length;w.add({start:t,end:t+x,length:x,substr:u}),d.push(w)}else h.add("3")}if(d.length>0){d=d.sort((m,O)=>m.length()-O.length());for(let m of d)ha(m,n)||n.push(m);continue}if(t>0&&h.size==1&&!h.has("3")){e+=ir(n,!1);let m=new Ft;const O=n[0];O&&m.add(O.last()),n=[m]}}return e+=ir(n,!0),e},ga=(r,e)=>{if(r)return r[e]},va=(r,e)=>{if(r){for(var n,t=e.split(".");(n=t.shift())&&(r=r[n]););return r}},an=(r,e,n)=>{var t,i;return!r||(r=r+"",e.regex==null)||(i=r.search(e.regex),i===-1)?0:(t=e.string.length/r.length,i===0&&(t+=.5),t*n)},un=(r,e)=>{var n=r[e];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(r[e]=[n])},vt=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},ma=(r,e)=>typeof r=="number"&&typeof e=="number"?r>e?1:r<e?-1:0:(r=Ut(r+"").toLowerCase(),e=Ut(e+"").toLowerCase(),r>e?1:e>r?-1:0);class ya{constructor(e,n){He(this,"items");He(this,"settings");this.items=e,this.settings=n||{diacritics:!0}}tokenize(e,n,t){if(!e||!e.length)return[];const i=[],s=e.split(/\s+/);var o;return t&&(o=new RegExp("^("+Object.keys(t).map(lt).join("|")+"):(.*)$")),s.forEach(u=>{let d,h=null,m=null;o&&(d=u.match(o))&&(h=d[1],u=d[2]),u.length>0&&(this.settings.diacritics?m=pa(u)||null:m=lt(u),m&&n&&(m="\\b"+m)),i.push({string:u,regex:m?new RegExp(m,"iu"):null,field:h})}),i}getScoreFunction(e,n){var t=this.prepareSearch(e,n);return this._getScoreFunction(t)}_getScoreFunction(e){const n=e.tokens,t=n.length;if(!t)return function(){return 0};const i=e.options.fields,s=e.weights,o=i.length,u=e.getAttrFn;if(!o)return function(){return 1};const d=function(){return o===1?function(h,m){const O=i[0].field;return an(u(m,O),h,s[O]||1)}:function(h,m){var O=0;if(h.field){const w=u(m,h.field);!h.regex&&w?O+=1/o:O+=an(w,h,1)}else vt(s,(w,x)=>{O+=an(u(m,x),h,w)});return O/o}}();return t===1?function(h){return d(n[0],h)}:e.options.conjunction==="and"?function(h){var m,O=0;for(let w of n){if(m=d(w,h),m<=0)return 0;O+=m}return O/t}:function(h){var m=0;return vt(n,O=>{m+=d(O,h)}),m/t}}getSortFunction(e,n){var t=this.prepareSearch(e,n);return this._getSortFunction(t)}_getSortFunction(e){var n,t=[];const i=this,s=e.options,o=!e.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof o=="function")return o.bind(this);const u=function(h,m){return h==="$score"?m.score:e.getAttrFn(i.items[m.id],h)};if(o)for(let h of o)(e.query||h.field!=="$score")&&t.push(h);if(e.query){n=!0;for(let h of t)if(h.field==="$score"){n=!1;break}n&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(h=>h.field!=="$score");return t.length?function(h,m){var O,w;for(let x of t)if(w=x.field,O=(x.direction==="desc"?-1:1)*ma(u(w,h),u(w,m)),O)return O;return 0}:null}prepareSearch(e,n){const t={};var i=Object.assign({},n);if(un(i,"sort"),un(i,"sort_empty"),i.fields){un(i,"fields");const s=[];i.fields.forEach(o=>{typeof o=="string"&&(o={field:o,weight:1}),s.push(o),t[o.field]="weight"in o?o.weight:1}),i.fields=s}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,t),total:0,items:[],weights:t,getAttrFn:i.nesting?va:ga}}search(e,n){var t=this,i,s;s=this.prepareSearch(e,n),n=s.options,e=s.query;const o=n.score||t._getScoreFunction(s);e.length?vt(t.items,(d,h)=>{i=o(d),(n.filter===!1||i>0)&&s.items.push({score:i,id:h})}):vt(t.items,(d,h)=>{s.items.push({score:1,id:h})});const u=t._getSortFunction(s);return u&&s.items.sort(u),s.total=s.items.length,typeof n.limit=="number"&&(s.items=s.items.slice(0,n.limit)),s}}const Ie=r=>typeof r>"u"||r===null?null:Mt(r),Mt=r=>typeof r=="boolean"?r?"1":"0":r+"",ln=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),ba=(r,e)=>e>0?window.setTimeout(r,e):(r.call(null),null),Oa=(r,e)=>{var n;return function(t,i){var s=this;n&&(s.loading=Math.max(s.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,s.loadedSearches[t]=!0,r.call(s,t,i)},e)}},or=(r,e,n)=>{var t,i=r.trigger,s={};r.trigger=function(){var o=arguments[0];if(e.indexOf(o)!==-1)s[o]=arguments;else return i.apply(r,arguments)},n.apply(r,[]),r.trigger=i;for(t of e)t in s&&i.apply(r,s[t])},Ca=r=>({start:r.selectionStart||0,length:(r.selectionEnd||0)-(r.selectionStart||0)}),ue=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},ye=(r,e,n,t)=>{r.addEventListener(e,n,t)},Ge=(r,e)=>{if(!e||!e[r])return!1;var n=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return n===1},cn=(r,e)=>{const n=r.getAttribute("id");return n||(r.setAttribute("id",e),e)},sr=r=>r.replace(/[\\"']/g,"\\$&"),$e=(r,e)=>{e&&r.append(e)},he=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Pe=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(di(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},di=r=>typeof r=="string"&&r.indexOf("<")>-1,Sa=r=>r.replace(/['"\\]/g,"\\$&"),fn=(r,e)=>{var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!1),r.dispatchEvent(n)},mt=(r,e)=>{Object.assign(r.style,e)},we=(r,...e)=>{var n=hi(e);r=pi(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Ue=(r,...e)=>{var n=hi(e);r=pi(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},hi=r=>{var e=[];return he(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},pi=r=>(Array.isArray(r)||(r=[r]),r),dn=(r,e,n)=>{if(!(n&&!n.contains(r)))for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},ar=(r,e=0)=>e>0?r[r.length-1]:r[0],Aa=r=>Object.keys(r).length===0,ur=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n},oe=(r,e)=>{he(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},An=(r,e)=>{r.parentNode&&r.parentNode.replaceChild(e,r)},wa=(r,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const n=s=>{var o=s.data.match(e);if(o&&s.data.length>0){var u=document.createElement("span");u.className="highlight";var d=s.splitText(o.index);d.splitText(o[0].length);var h=d.cloneNode(!0);return u.appendChild(h),An(d,u),1}return 0},t=s=>{s.nodeType===1&&s.childNodes&&!/(script|style)/i.test(s.tagName)&&(s.className!=="highlight"||s.tagName!=="SPAN")&&Array.from(s.childNodes).forEach(o=>{i(o)})},i=s=>s.nodeType===3?n(s):(t(s),0);i(r)},Ea=r=>{var e=r.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(n){var t=n.parentNode;t.replaceChild(n.firstChild,n),t.normalize()})},Ra=65,Ta=13,xa=27,Ia=37,Ma=38,_a=39,Pa=40,lr=8,La=46,cr=9,ka=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),yt=ka?"metaKey":"ctrlKey",fr={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(r){return r.length>0},render:{}};function dr(r,e){var n=Object.assign({},fr,e),t=n.dataAttr,i=n.labelField,s=n.valueField,o=n.disabledField,u=n.optgroupField,d=n.optgroupLabelField,h=n.optgroupValueField,m=r.tagName.toLowerCase(),O=r.getAttribute("placeholder")||r.getAttribute("data-placeholder");if(!O&&!n.allowEmptyOption){let E=r.querySelector('option[value=""]');E&&(O=E.textContent)}var w={placeholder:O,options:[],optgroups:[],items:[],maxItems:null},x=()=>{var E,R=w.options,M={},b=1;let y=0;var T=c=>{var a=Object.assign({},c.dataset),v=t&&a[t];return typeof v=="string"&&v.length&&(a=Object.assign(a,JSON.parse(v))),a},p=(c,a)=>{var v=Ie(c.value);if(v!=null&&!(!v&&!n.allowEmptyOption)){if(M.hasOwnProperty(v)){if(a){var g=M[v][u];g?Array.isArray(g)?g.push(a):M[v][u]=[g,a]:M[v][u]=a}}else{var S=T(c);S[i]=S[i]||c.textContent,S[s]=S[s]||v,S[o]=S[o]||c.disabled,S[u]=S[u]||a,S.$option=c,S.$order=S.$order||++y,M[v]=S,R.push(S)}c.selected&&w.items.push(v)}},f=c=>{var a,v;v=T(c),v[d]=v[d]||c.getAttribute("label")||"",v[h]=v[h]||b++,v[o]=v[o]||c.disabled,v.$order=v.$order||++y,w.optgroups.push(v),a=v[h],he(c.children,g=>{p(g,a)})};w.maxItems=r.hasAttribute("multiple")?null:1,he(r.children,c=>{E=c.tagName.toLowerCase(),E==="optgroup"?f(c):E==="option"&&p(c)})},l=()=>{const E=r.getAttribute(t);if(E)w.options=JSON.parse(E),he(w.options,M=>{w.items.push(M[s])});else{var R=r.value.trim()||"";if(!n.allowEmptyOption&&!R.length)return;const M=R.split(n.delimiter);he(M,b=>{const y={};y[i]=b,y[s]=b,w.options.push(y)}),w.items=M}};return m==="select"?x():l(),Object.assign({},fr,w,e)}var hr=0;class Ae extends Xs(Qs){constructor(e,n){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,hr++;var t,i=Pe(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s=window.getComputedStyle&&window.getComputedStyle(i,null);t=s.getPropertyValue("direction");const o=dr(i,n);this.settings=o,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(t),this.inputId=cn(i,"tomselect-"+hr),this.isRequired=i.required,this.sifter=new ya(this.options,{diacritics:o.diacritics}),o.mode=o.mode||(o.maxItems===1?"single":"multi"),typeof o.hideSelected!="boolean"&&(o.hideSelected=o.mode==="multi"),typeof o.hidePlaceholder!="boolean"&&(o.hidePlaceholder=o.mode!=="multi");var u=o.createFilter;typeof u!="function"&&(typeof u=="string"&&(u=new RegExp(u)),u instanceof RegExp?o.createFilter=R=>u.test(R):o.createFilter=R=>this.settings.duplicates||!this.options[R]),this.initializePlugins(o.plugins),this.setupCallbacks(),this.setupTemplates();const d=Pe("<div>"),h=Pe("<div>"),m=this._render("dropdown"),O=Pe('<div role="listbox" tabindex="-1">'),w=this.input.getAttribute("class")||"",x=o.mode;var l;if(we(d,o.wrapperClass,w,x),we(h,o.controlClass),$e(d,h),we(m,o.dropdownClass,x),o.copyClassesToDropdown&&we(m,w),we(O,o.dropdownContentClass),$e(m,O),Pe(o.dropdownParent||d).appendChild(m),di(o.controlInput)){l=Pe(o.controlInput);var E=["autocorrect","autocapitalize","autocomplete","spellcheck"];he(E,R=>{i.getAttribute(R)&&oe(l,{[R]:i.getAttribute(R)})}),l.tabIndex=-1,h.appendChild(l),this.focus_node=l}else o.controlInput?(l=Pe(o.controlInput),this.focus_node=l):(l=Pe("<input/>"),this.focus_node=h);this.wrapper=d,this.dropdown=m,this.dropdown_content=O,this.control=h,this.control_input=l,this.setup()}setup(){const e=this,n=e.settings,t=e.control_input,i=e.dropdown,s=e.dropdown_content,o=e.wrapper,u=e.control,d=e.input,h=e.focus_node,m={passive:!0},O=e.inputId+"-ts-dropdown";oe(s,{id:O}),oe(h,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":O});const w=cn(h,e.inputId+"-ts-control"),x="label[for='"+Sa(e.inputId)+"']",l=document.querySelector(x),E=e.focus.bind(e);if(l){ye(l,"click",E),oe(l,{for:w});const b=cn(l,e.inputId+"-ts-label");oe(h,{"aria-labelledby":b}),oe(s,{"aria-labelledby":b})}if(o.style.width=d.style.width,e.plugins.names.length){const b="plugin-"+e.plugins.names.join(" plugin-");we([o,i],b)}(n.maxItems===null||n.maxItems>1)&&e.is_select_tag&&oe(d,{multiple:"multiple"}),n.placeholder&&oe(t,{placeholder:n.placeholder}),!n.splitOn&&n.delimiter&&(n.splitOn=new RegExp("\\s*"+lt(n.delimiter)+"+\\s*")),n.load&&n.loadThrottle&&(n.load=Oa(n.load,n.loadThrottle)),ye(i,"mousemove",()=>{e.ignoreHover=!1}),ye(i,"mouseenter",b=>{var y=dn(b.target,"[data-selectable]",i);y&&e.onOptionHover(b,y)},{capture:!0}),ye(i,"click",b=>{const y=dn(b.target,"[data-selectable]");y&&(e.onOptionSelect(b,y),ue(b,!0))}),ye(u,"click",b=>{var y=dn(b.target,"[data-ts-item]",u);if(y&&e.onItemSelect(b,y)){ue(b,!0);return}t.value==""&&(e.onClick(),ue(b,!0))}),ye(h,"keydown",b=>e.onKeyDown(b)),ye(t,"keypress",b=>e.onKeyPress(b)),ye(t,"input",b=>e.onInput(b)),ye(h,"blur",b=>e.onBlur(b)),ye(h,"focus",b=>e.onFocus(b)),ye(t,"paste",b=>e.onPaste(b));const R=b=>{const y=b.composedPath()[0];if(!o.contains(y)&&!i.contains(y)){e.isFocused&&e.blur(),e.inputState();return}y==t&&e.isOpen?b.stopPropagation():ue(b,!0)},M=()=>{e.isOpen&&e.positionDropdown()};ye(document,"mousedown",R),ye(window,"scroll",M,m),ye(window,"resize",M,m),this._destroy=()=>{document.removeEventListener("mousedown",R),window.removeEventListener("scroll",M),window.removeEventListener("resize",M),l&&l.removeEventListener("click",E)},this.revertSettings={innerHTML:d.innerHTML,tabIndex:d.tabIndex},d.tabIndex=-1,d.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),n.items=[],delete n.optgroups,delete n.options,ye(d,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,d.disabled?e.disable():d.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),we(d,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),n.preload===!0&&e.preload()}setupOptions(e=[],n=[]){this.addOptions(e),he(n,t=>{this.registerOptionGroup(t)})}setupTemplates(){var e=this,n=e.settings.labelField,t=e.settings.optgroupLabelField,i={optgroup:s=>{let o=document.createElement("div");return o.className="optgroup",o.appendChild(s.options),o},optgroup_header:(s,o)=>'<div class="optgroup-header">'+o(s[t])+"</div>",option:(s,o)=>"<div>"+o(s[n])+"</div>",item:(s,o)=>"<div>"+o(s[n])+"</div>",option_create:(s,o)=>'<div class="create">Add <strong>'+o(s.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,n,t={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in t)n=this.settings[t[e]],n&&this.on(e,n)}sync(e=!0){const n=this,t=e?dr(n.input,{delimiter:n.settings.delimiter}):n.settings;n.setupOptions(t.options,t.optgroups),n.setValue(t.items||[],!0),n.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){fn(this.input,"input"),fn(this.input,"change")}onPaste(e){var n=this;if(n.isInputHidden||n.isLocked){ue(e);return}n.settings.splitOn&&setTimeout(()=>{var t=n.inputValue();if(t.match(n.settings.splitOn)){var i=t.trim().split(n.settings.splitOn);he(i,s=>{Ie(s)&&(this.options[s]?n.addItem(s):n.createItem(s))})}},0)}onKeyPress(e){var n=this;if(n.isLocked){ue(e);return}var t=String.fromCharCode(e.keyCode||e.which);if(n.settings.create&&n.settings.mode==="multi"&&t===n.settings.delimiter){n.createItem(),ue(e);return}}onKeyDown(e){var n=this;if(n.ignoreHover=!0,n.isLocked){e.keyCode!==cr&&ue(e);return}switch(e.keyCode){case Ra:if(Ge(yt,e)&&n.control_input.value==""){ue(e),n.selectAll();return}break;case xa:n.isOpen&&(ue(e,!0),n.close()),n.clearActiveItems();return;case Pa:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let t=n.getAdjacent(n.activeOption,1);t&&n.setActiveOption(t)}ue(e);return;case Ma:if(n.activeOption){let t=n.getAdjacent(n.activeOption,-1);t&&n.setActiveOption(t)}ue(e);return;case Ta:n.canSelect(n.activeOption)?(n.onOptionSelect(e,n.activeOption),ue(e)):(n.settings.create&&n.createItem()||document.activeElement==n.control_input&&n.isOpen)&&ue(e);return;case Ia:n.advanceSelection(-1,e);return;case _a:n.advanceSelection(1,e);return;case cr:n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(e,n.activeOption),ue(e)),n.settings.create&&n.createItem()&&ue(e));return;case lr:case La:n.deleteSelection(e);return}n.isInputHidden&&!Ge(yt,e)&&ue(e)}onInput(e){if(this.isLocked)return;const n=this.inputValue();if(this.lastValue!==n){if(this.lastValue=n,n==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=ba(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,n){this.ignoreHover||this.setActiveOption(n,!1)}onFocus(e){var n=this,t=n.isFocused;if(n.isDisabled||n.isReadOnly){n.blur(),ue(e);return}n.ignoreFocus||(n.isFocused=!0,n.settings.preload==="focus"&&n.preload(),t||n.trigger("focus"),n.activeItems.length||(n.inputState(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var n=this;if(n.isFocused){n.isFocused=!1,n.ignoreFocus=!1;var t=()=>{n.close(),n.setActiveItem(),n.setCaret(n.items.length),n.trigger("blur")};n.settings.create&&n.settings.createOnBlur?n.createItem(null,t):t()}}}onOptionSelect(e,n){var t,i=this;n.parentElement&&n.parentElement.matches("[data-disabled]")||(n.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(t=n.dataset.value,typeof t<"u"&&(i.lastQuery=null,i.addItem(t),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(n))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,n){var t=this;return!t.isLocked&&t.settings.mode==="multi"?(ue(e),t.setActiveItem(n,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const n=this;if(!n.canLoad(e))return;we(n.wrapper,n.settings.loadingClass),n.loading++;const t=n.loadCallback.bind(n);n.settings.load.call(n,e,t)}loadCallback(e,n){const t=this;t.loading=Math.max(t.loading-1,0),t.lastQuery=null,t.clearActiveOption(),t.setupOptions(e,n),t.refreshOptions(t.isFocused&&!t.isInputHidden),t.loading||Ue(t.wrapper,t.settings.loadingClass),t.trigger("load",e,n)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var n=this.control_input,t=n.value!==e;t&&(n.value=e,fn(n,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,n){var t=n?[]:["change"];or(this,t,()=>{this.clear(n),this.addItems(e,n)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,n){var t=this,i,s,o,u,d,h;if(t.settings.mode!=="single"){if(!e){t.clearActiveItems(),t.isFocused&&t.inputState();return}if(i=n&&n.type.toLowerCase(),i==="click"&&Ge("shiftKey",n)&&t.activeItems.length){for(h=t.getLastActive(),o=Array.prototype.indexOf.call(t.control.children,h),u=Array.prototype.indexOf.call(t.control.children,e),o>u&&(d=o,o=u,u=d),s=o;s<=u;s++)e=t.control.children[s],t.activeItems.indexOf(e)===-1&&t.setActiveItemClass(e);ue(n)}else i==="click"&&Ge(yt,n)||i==="keydown"&&Ge("shiftKey",n)?e.classList.contains("active")?t.removeActiveItem(e):t.setActiveItemClass(e):(t.clearActiveItems(),t.setActiveItemClass(e));t.inputState(),t.isFocused||t.focus()}}setActiveItemClass(e){const n=this,t=n.control.querySelector(".last-active");t&&Ue(t,"last-active"),we(e,"active last-active"),n.trigger("item_select",e),n.activeItems.indexOf(e)==-1&&n.activeItems.push(e)}removeActiveItem(e){var n=this.activeItems.indexOf(e);this.activeItems.splice(n,1),Ue(e,"active")}clearActiveItems(){Ue(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,n=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,oe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),oe(e,{"aria-selected":"true"}),we(e,"active"),n&&this.scrollToOption(e)))}scrollToOption(e,n){if(!e)return;const t=this.dropdown_content,i=t.clientHeight,s=t.scrollTop||0,o=e.offsetHeight,u=e.getBoundingClientRect().top-t.getBoundingClientRect().top+s;u+o>i+s?this.scroll(u-i+o,n):u<s&&this.scroll(u,n)}scroll(e,n){const t=this.dropdown_content;n&&(t.style.scrollBehavior=n),t.scrollTop=e,t.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(Ue(this.activeOption,"active"),oe(this.activeOption,{"aria-selected":null})),this.activeOption=null,oe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const n=e.controlChildren();n.length&&(e.inputState(),e.close(),e.activeItems=n,he(n,t=>{e.setActiveItemClass(t)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(oe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&oe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,n=e.sortField;return typeof e.sortField=="string"&&(n=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:n,nesting:e.nesting}}search(e){var n,t,i=this,s=this.getSearchOptions();if(i.settings.score&&(t=i.settings.score.call(i,e),typeof t!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,n=i.sifter.search(e,Object.assign(s,{score:t})),i.currentResults=n):n=Object.assign({},i.currentResults),i.settings.hideSelected&&(n.items=n.items.filter(o=>{let u=Ie(o.id);return!(u&&i.items.indexOf(u)!==-1)})),n}refreshOptions(e=!0){var n,t,i,s,o,u,d,h,m,O;const w={},x=[];var l=this,E=l.inputValue();const R=E===l.lastQuery||E==""&&l.lastQuery==null;var M=l.search(E),b=null,y=l.settings.shouldOpen||!1,T=l.dropdown_content;R&&(b=l.activeOption,b&&(m=b.closest("[data-group]"))),s=M.items.length,typeof l.settings.maxOptions=="number"&&(s=Math.min(s,l.settings.maxOptions)),s>0&&(y=!0);const p=(c,a)=>{let v=w[c];if(v!==void 0){let S=x[v];if(S!==void 0)return[v,S.fragment]}let g=document.createDocumentFragment();return v=x.length,x.push({fragment:g,order:a,optgroup:c}),[v,g]};for(n=0;n<s;n++){let c=M.items[n];if(!c)continue;let a=c.id,v=l.options[a];if(v===void 0)continue;let g=Mt(a),S=l.getOption(g,!0);for(l.settings.hideSelected||S.classList.toggle("selected",l.items.includes(g)),o=v[l.settings.optgroupField]||"",u=Array.isArray(o)?o:[o],t=0,i=u&&u.length;t<i;t++){o=u[t];let D=v.$order,k=l.optgroups[o];k===void 0?o="":D=k.$order;const[P,I]=p(o,D);t>0&&(S=S.cloneNode(!0),oe(S,{id:v.$id+"-clone-"+t,"aria-selected":null}),S.classList.add("ts-cloned"),Ue(S,"active"),l.activeOption&&l.activeOption.dataset.value==a&&m&&m.dataset.group===o.toString()&&(b=S)),I.appendChild(S),o!=""&&(w[o]=P)}}l.settings.lockOptgroupOrder&&x.sort((c,a)=>c.order-a.order),d=document.createDocumentFragment(),he(x,c=>{let a=c.fragment,v=c.optgroup;if(!a||!a.children.length)return;let g=l.optgroups[v];if(g!==void 0){let S=document.createDocumentFragment(),D=l.render("optgroup_header",g);$e(S,D),$e(S,a);let k=l.render("optgroup",{group:g,options:S});$e(d,k)}else $e(d,a)}),T.innerHTML="",$e(T,d),l.settings.highlight&&(Ea(T),M.query.length&&M.tokens.length&&he(M.tokens,c=>{wa(T,c.regex)}));var f=c=>{let a=l.render(c,{input:E});return a&&(y=!0,T.insertBefore(a,T.firstChild)),a};if(l.loading?f("loading"):l.settings.shouldLoad.call(l,E)?M.items.length===0&&f("no_results"):f("not_loading"),h=l.canCreate(E),h&&(O=f("option_create")),l.hasOptions=M.items.length>0||h,y){if(M.items.length>0){if(!b&&l.settings.mode==="single"&&l.items[0]!=null&&(b=l.getOption(l.items[0])),!T.contains(b)){let c=0;O&&!l.settings.addPrecedence&&(c=1),b=l.selectable()[c]}}else O&&(b=O);e&&!l.isOpen&&(l.open(),l.scrollToOption(b,"auto")),l.setActiveOption(b)}else l.clearActiveOption(),e&&l.isOpen&&l.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,n=!1){const t=this;if(Array.isArray(e))return t.addOptions(e,n),!1;const i=Ie(e[t.settings.valueField]);return i===null||t.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++t.order,e.$id=t.inputId+"-opt-"+e.$order,t.options[i]=e,t.lastQuery=null,n&&(t.userOptions[i]=n,t.trigger("option_add",i,e)),i)}addOptions(e,n=!1){he(e,t=>{this.addOption(t,n)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var n=Ie(e[this.settings.optgroupValueField]);return n===null?!1:(e.$order=e.$order||++this.order,this.optgroups[n]=e,n)}addOptionGroup(e,n){var t;n[this.settings.optgroupValueField]=e,(t=this.registerOptionGroup(n))&&this.trigger("optgroup_add",t,n)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,n){const t=this;var i,s;const o=Ie(e),u=Ie(n[t.settings.valueField]);if(o===null)return;const d=t.options[o];if(d==null)return;if(typeof u!="string")throw new Error("Value must be set in option data");const h=t.getOption(o),m=t.getItem(o);if(n.$order=n.$order||d.$order,delete t.options[o],t.uncacheValue(u),t.options[u]=n,h){if(t.dropdown_content.contains(h)){const O=t._render("option",n);An(h,O),t.activeOption===h&&t.setActiveOption(O)}h.remove()}m&&(s=t.items.indexOf(o),s!==-1&&t.items.splice(s,1,u),i=t._render("item",n),m.classList.contains("active")&&we(i,"active"),An(m,i)),t.lastQuery=null}removeOption(e,n){const t=this;e=Mt(e),t.uncacheValue(e),delete t.userOptions[e],delete t.options[e],t.lastQuery=null,t.trigger("option_remove",e),t.removeItem(e,n)}clearOptions(e){const n=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};he(this.options,(i,s)=>{n(i,s)&&(t[s]=i)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,n){return this.items.indexOf(n)>=0}getOption(e,n=!1){const t=Ie(e);if(t===null)return null;const i=this.options[t];if(i!=null){if(i.$div)return i.$div;if(n)return this._render("option",i)}return null}getAdjacent(e,n,t="option"){var i=this,s;if(!e)return null;t=="item"?s=i.controlChildren():s=i.dropdown_content.querySelectorAll("[data-selectable]");for(let o=0;o<s.length;o++)if(s[o]==e)return n>0?s[o+1]:s[o-1];return null}getItem(e){if(typeof e=="object")return e;var n=Ie(e);return n!==null?this.control.querySelector(`[data-value="${sr(n)}"]`):null}addItems(e,n){var t=this,i=Array.isArray(e)?e:[e];i=i.filter(o=>t.items.indexOf(o)===-1);const s=i[i.length-1];i.forEach(o=>{t.isPending=o!==s,t.addItem(o,n)})}addItem(e,n){var t=n?[]:["change","dropdown_close"];or(this,t,()=>{var i,s;const o=this,u=o.settings.mode,d=Ie(e);if(!(d&&o.items.indexOf(d)!==-1&&(u==="single"&&o.close(),u==="single"||!o.settings.duplicates))&&!(d===null||!o.options.hasOwnProperty(d))&&(u==="single"&&o.clear(n),!(u==="multi"&&o.isFull()))){if(i=o._render("item",o.options[d]),o.control.contains(i)&&(i=i.cloneNode(!0)),s=o.isFull(),o.items.splice(o.caretPos,0,d),o.insertAtCaret(i),o.isSetup){if(!o.isPending&&o.settings.hideSelected){let h=o.getOption(d),m=o.getAdjacent(h,1);m&&o.setActiveOption(m)}!o.isPending&&!o.settings.closeAfterSelect&&o.refreshOptions(o.isFocused&&u!=="single"),o.settings.closeAfterSelect!=!1&&o.isFull()?o.close():o.isPending||o.positionDropdown(),o.trigger("item_add",d,i),o.isPending||o.updateOriginalInput({silent:n})}(!o.isPending||!s&&o.isFull())&&(o.inputState(),o.refreshState())}})}removeItem(e=null,n){const t=this;if(e=t.getItem(e),!e)return;var i,s;const o=e.dataset.value;i=ur(e),e.remove(),e.classList.contains("active")&&(s=t.activeItems.indexOf(e),t.activeItems.splice(s,1),Ue(e,"active")),t.items.splice(i,1),t.lastQuery=null,!t.settings.persist&&t.userOptions.hasOwnProperty(o)&&t.removeOption(o,n),i<t.caretPos&&t.setCaret(t.caretPos-1),t.updateOriginalInput({silent:n}),t.refreshState(),t.positionDropdown(),t.trigger("item_remove",o,e)}createItem(e=null,n=()=>{}){arguments.length===3&&(n=arguments[2]),typeof n!="function"&&(n=()=>{});var t=this,i=t.caretPos,s;if(e=e||t.inputValue(),!t.canCreate(e))return n(),!1;t.lock();var o=!1,u=d=>{if(t.unlock(),!d||typeof d!="object")return n();var h=Ie(d[t.settings.valueField]);if(typeof h!="string")return n();t.setTextboxValue(),t.addOption(d,!0),t.setCaret(i),t.addItem(h),n(d),o=!0};return typeof t.settings.create=="function"?s=t.settings.create.call(this,e,u):s={[t.settings.labelField]:e,[t.settings.valueField]:e},o||u(s),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const n=e.isFull(),t=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",t),i.toggle("full",n),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",Aa(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const n=this;var t,i;const s=n.input.querySelector('option[value=""]');if(n.is_select_tag){let d=function(h,m,O){return h||(h=Pe('<option value="'+ln(m)+'">'+ln(O)+"</option>")),h!=s&&n.input.append(h),o.push(h),(h!=s||u>0)&&(h.selected=!0),h};const o=[],u=n.input.querySelectorAll("option:checked").length;n.input.querySelectorAll("option:checked").forEach(h=>{h.selected=!1}),n.items.length==0&&n.settings.mode=="single"?d(s,"",""):n.items.forEach(h=>{if(t=n.options[h],i=t[n.settings.labelField]||"",o.includes(t.$option)){const m=n.input.querySelector(`option[value="${sr(h)}"]:not(:checked)`);d(m,h,i)}else t.$option=d(t.$option,h,i)})}else n.input.value=n.getValue();n.isSetup&&(e.silent||n.trigger("change",n.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,oe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),mt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),mt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var n=this,t=n.isOpen;e&&(n.setTextboxValue(),n.settings.mode==="single"&&n.items.length&&n.inputState()),n.isOpen=!1,oe(n.focus_node,{"aria-expanded":"false"}),mt(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),t&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,n=e.getBoundingClientRect(),t=e.offsetHeight+n.top+window.scrollY,i=n.left+window.scrollX;mt(this.dropdown,{width:n.width+"px",top:t+"px",left:i+"px"})}}clear(e){var n=this;if(n.items.length){var t=n.controlChildren();he(t,i=>{n.removeItem(i,!0)}),n.inputState(),e||n.updateOriginalInput(),n.trigger("clear")}}insertAtCaret(e){const n=this,t=n.caretPos,i=n.control;i.insertBefore(e,i.children[t]||null),n.setCaret(t+1)}deleteSelection(e){var n,t,i,s,o=this;n=e&&e.keyCode===lr?-1:1,t=Ca(o.control_input);const u=[];if(o.activeItems.length)s=ar(o.activeItems,n),i=ur(s),n>0&&i++,he(o.activeItems,d=>u.push(d));else if((o.isFocused||o.settings.mode==="single")&&o.items.length){const d=o.controlChildren();let h;n<0&&t.start===0&&t.length===0?h=d[o.caretPos-1]:n>0&&t.start===o.inputValue().length&&(h=d[o.caretPos]),h!==void 0&&u.push(h)}if(!o.shouldDelete(u,e))return!1;for(ue(e,!0),typeof i<"u"&&o.setCaret(i);u.length;)o.removeItem(u.pop());return o.inputState(),o.positionDropdown(),o.refreshOptions(!1),!0}shouldDelete(e,n){const t=e.map(i=>i.dataset.value);return!(!t.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(t,n)===!1)}advanceSelection(e,n){var t,i,s=this;s.rtl&&(e*=-1),!s.inputValue().length&&(Ge(yt,n)||Ge("shiftKey",n)?(t=s.getLastActive(e),t?t.classList.contains("active")?i=s.getAdjacent(t,e,"item"):i=t:e>0?i=s.control_input.nextElementSibling:i=s.control_input.previousElementSibling,i&&(i.classList.contains("active")&&s.removeActiveItem(t),s.setActiveItemClass(i))):s.moveCaret(e))}moveCaret(e){}getLastActive(e){let n=this.control.querySelector(".last-active");if(n)return n;var t=this.control.querySelectorAll(".active");if(t)return ar(t,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,n=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=n.innerHTML,e.input.tabIndex=n.tabIndex,Ue(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,n){var t,i;const s=this;if(typeof this.settings.render[e]!="function"||(i=s.settings.render[e].call(this,n,ln),!i))return null;if(i=Pe(i),e==="option"||e==="option_create"?n[s.settings.disabledField]?oe(i,{"aria-disabled":"true"}):oe(i,{"data-selectable":""}):e==="optgroup"&&(t=n.group[s.settings.optgroupValueField],oe(i,{"data-group":t}),n.group[s.settings.disabledField]&&oe(i,{"data-disabled":""})),e==="option"||e==="item"){const o=Mt(n[s.settings.valueField]);oe(i,{"data-value":o}),e==="item"?(we(i,s.settings.itemClass),oe(i,{"data-ts-item":""})):(we(i,s.settings.optionClass),oe(i,{role:"option",id:n.$id}),n.$div=i,s.options[o]=n)}return i}_render(e,n){const t=this.render(e,n);if(t==null)throw"HTMLElement expected";return t}clearCache(){he(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const n=this.getOption(e);n&&n.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,n,t){var i=this,s=i[n];i[n]=function(){var o,u;return e==="after"&&(o=s.apply(i,arguments)),u=t.apply(i,arguments),e==="instead"?u:(e==="before"&&(o=s.apply(i,arguments)),o)}}}const Da=(r,e,n,t)=>{r.addEventListener(e,n,t)};function Na(){Da(this.input,"change",()=>{this.sync()})}const Ua=r=>typeof r>"u"||r===null?null:Fa(r),Fa=r=>typeof r=="boolean"?r?"1":"0":r+"",pr=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ba=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(ja(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},ja=r=>typeof r=="string"&&r.indexOf("<")>-1;function Ha(r){var e=this,n=e.onOptionSelect;e.settings.hideSelected=!1;const t=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},r);var i=function(u,d){d?(u.checked=!0,t.uncheckedClassNames&&u.classList.remove(...t.uncheckedClassNames),t.checkedClassNames&&u.classList.add(...t.checkedClassNames)):(u.checked=!1,t.checkedClassNames&&u.classList.remove(...t.checkedClassNames),t.uncheckedClassNames&&u.classList.add(...t.uncheckedClassNames))},s=function(u){setTimeout(()=>{var d=u.querySelector("input."+t.className);d instanceof HTMLInputElement&&i(d,u.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var o=e.settings.render.option;e.settings.render.option=(u,d)=>{var h=Ba(o.call(e,u,d)),m=document.createElement("input");t.className&&m.classList.add(t.className),m.addEventListener("click",function(w){pr(w)}),m.type="checkbox";const O=Ua(u[e.settings.valueField]);return i(m,!!(O&&e.items.indexOf(O)>-1)),h.prepend(m),h}}),e.on("item_remove",o=>{var u=e.getOption(o);u&&(u.classList.remove("selected"),s(u))}),e.on("item_add",o=>{var u=e.getOption(o);u&&s(u)}),e.hook("instead","onOptionSelect",(o,u)=>{if(u.classList.contains("selected")){u.classList.remove("selected"),e.removeItem(u.dataset.value),e.refreshOptions(),pr(o,!0);return}n.call(e,o,u),s(u)})}const Ga=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if($a(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},$a=r=>typeof r=="string"&&r.indexOf("<")>-1;function Va(r){const e=this,n=Object.assign({className:"clear-button",title:"Clear All",html:t=>`<div class="${t.className}" title="${t.title}">&#10799;</div>`},r);e.on("initialize",()=>{var t=Ga(n.html(n));t.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(t)})}const Wa=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ke=(r,e,n,t)=>{r.addEventListener(e,n,t)},za=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Ka=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(qa(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},qa=r=>typeof r=="string"&&r.indexOf("<")>-1,Ja=(r,e)=>{za(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},Ya=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r.nextSibling)},Qa=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r)},Xa=(r,e)=>{do{var n;if(e=(n=e)==null?void 0:n.previousElementSibling,r==e)return!0}while(e&&e.previousElementSibling);return!1};function Za(){var r=this;if(r.settings.mode!=="multi")return;var e=r.lock,n=r.unlock;let t=!0,i;r.hook("after","setupTemplates",()=>{var s=r.settings.render.item;r.settings.render.item=(o,u)=>{const d=Ka(s.call(r,o,u));Ja(d,{draggable:"true"});const h=E=>{t||Wa(E),E.stopPropagation()},m=E=>{i=d,setTimeout(()=>{d.classList.add("ts-dragging")},0)},O=E=>{E.preventDefault(),d.classList.add("ts-drag-over"),x(d,i)},w=()=>{d.classList.remove("ts-drag-over")},x=(E,R)=>{R!==void 0&&(Xa(R,d)?Ya(E,R):Qa(E,R))},l=()=>{var E;document.querySelectorAll(".ts-drag-over").forEach(M=>M.classList.remove("ts-drag-over")),(E=i)==null||E.classList.remove("ts-dragging"),i=void 0;var R=[];r.control.querySelectorAll("[data-value]").forEach(M=>{if(M.dataset.value){let b=M.dataset.value;b&&R.push(b)}}),r.setValue(R)};return Ke(d,"mousedown",h),Ke(d,"dragstart",m),Ke(d,"dragenter",O),Ke(d,"dragover",O),Ke(d,"dragleave",w),Ke(d,"dragend",l),d}}),r.hook("instead","lock",()=>(t=!1,e.call(r))),r.hook("instead","unlock",()=>(t=!0,n.call(r)))}const eu=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},tu=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(nu(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},nu=r=>typeof r=="string"&&r.indexOf("<")>-1;function ru(r){const e=this,n=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:t=>'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a class="'+t.closeClass+'">&times;</a></div></div>'},r);e.on("initialize",()=>{var t=tu(n.html(n)),i=t.querySelector("."+n.closeClass);i&&i.addEventListener("click",s=>{eu(s,!0),e.close()}),e.dropdown.insertBefore(t,e.dropdown.firstChild)})}const iu=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},ou=(r,...e)=>{var n=su(e);r=au(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},su=r=>{var e=[];return iu(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},au=r=>(Array.isArray(r)||(r=[r]),r),uu=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function lu(){var r=this;r.hook("instead","setCaret",e=>{r.settings.mode==="single"||!r.control.contains(r.control_input)?e=r.items.length:(e=Math.max(0,Math.min(r.items.length,e)),e!=r.caretPos&&!r.isPending&&r.controlChildren().forEach((n,t)=>{t<e?r.control_input.insertAdjacentElement("beforebegin",n):r.control.appendChild(n)})),r.caretPos=e}),r.hook("instead","moveCaret",e=>{if(!r.isFocused)return;const n=r.getLastActive(e);if(n){const t=uu(n);r.setCaret(e>0?t+1:t),r.setActiveItem(),ou(n,"last-active")}else r.setCaret(r.caretPos+e)})}const cu=27,fu=9,du=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},hu=(r,e,n,t)=>{r.addEventListener(e,n,t)},pu=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},gr=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(gu(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},gu=r=>typeof r=="string"&&r.indexOf("<")>-1,vu=(r,...e)=>{var n=mu(e);r=yu(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},mu=r=>{var e=[];return pu(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},yu=r=>(Array.isArray(r)||(r=[r]),r);function bu(){const r=this;r.settings.shouldOpen=!0,r.hook("before","setup",()=>{r.focus_node=r.control,vu(r.control_input,"dropdown-input");const e=gr('<div class="dropdown-input-wrap">');e.append(r.control_input),r.dropdown.insertBefore(e,r.dropdown.firstChild);const n=gr('<input class="items-placeholder" tabindex="-1" />');n.placeholder=r.settings.placeholder||"",r.control.append(n)}),r.on("initialize",()=>{r.control_input.addEventListener("keydown",n=>{switch(n.keyCode){case cu:r.isOpen&&(du(n,!0),r.close()),r.clearActiveItems();return;case fu:r.focus_node.tabIndex=-1;break}return r.onKeyDown.call(r,n)}),r.on("blur",()=>{r.focus_node.tabIndex=r.isDisabled?-1:r.tabIndex}),r.on("dropdown_open",()=>{r.control_input.focus()});const e=r.onBlur;r.hook("instead","onBlur",n=>{if(!(n&&n.relatedTarget==r.control_input))return e.call(r)}),hu(r.control_input,"blur",()=>r.onBlur()),r.hook("before","close",()=>{r.isOpen&&r.focus_node.focus({preventScroll:!0})})})}const bt=(r,e,n,t)=>{r.addEventListener(e,n,t)};function Ou(){var r=this;r.on("initialize",()=>{var e=document.createElement("span"),n=r.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",r.wrapper.appendChild(e);var t=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const s of t)e.style[s]=n.style[s];var i=()=>{e.textContent=n.value,n.style.width=e.clientWidth+"px"};i(),r.on("update item_add item_remove",i),bt(n,"input",i),bt(n,"keyup",i),bt(n,"blur",i),bt(n,"update",i)})}function Cu(){var r=this,e=r.deleteSelection;this.hook("instead","deleteSelection",n=>r.activeItems.length?e.call(r,n):!1)}function Su(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const vr=37,Au=39,wu=(r,e,n)=>{for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},Eu=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function Ru(){var r=this,e=r.onKeyDown;r.hook("instead","onKeyDown",n=>{var t,i,s,o;if(!r.isOpen||!(n.keyCode===vr||n.keyCode===Au))return e.call(r,n);r.ignoreHover=!0,o=wu(r.activeOption,"[data-group]"),t=Eu(r.activeOption,"[data-selectable]"),o&&(n.keyCode===vr?o=o.previousSibling:o=o.nextSibling,o&&(s=o.querySelectorAll("[data-selectable]"),i=s[Math.min(s.length-1,t)],i&&r.setActiveOption(i)))})}const Tu=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),mr=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},yr=(r,e,n,t)=>{r.addEventListener(e,n,t)},br=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(xu(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},xu=r=>typeof r=="string"&&r.indexOf("<")>-1;function Iu(r){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},r);var n=this;if(e.append){var t='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Tu(e.title)+'">'+e.label+"</a>";n.hook("after","setupTemplates",()=>{var i=n.settings.render.item;n.settings.render.item=(s,o)=>{var u=br(i.call(n,s,o)),d=br(t);return u.appendChild(d),yr(d,"mousedown",h=>{mr(h,!0)}),yr(d,"click",h=>{n.isLocked||(mr(h,!0),!n.isLocked&&n.shouldDelete([u],h)&&(n.removeItem(u),n.refreshOptions(!1),n.inputState()))}),u}})}}function Mu(r){const e=this,n=Object.assign({text:t=>t[e.settings.labelField]},r);e.on("item_remove",function(t){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[t];i&&e.setTextboxValue(n.text.call(e,i))}})}const _u=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Pu=(r,...e)=>{var n=Lu(e);r=ku(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Lu=r=>{var e=[];return _u(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},ku=r=>(Array.isArray(r)||(r=[r]),r);function Du(){const r=this,e=r.canLoad,n=r.clearActiveOption,t=r.loadCallback;var i={},s,o=!1,u,d=[];if(r.settings.shouldLoadMore||(r.settings.shouldLoadMore=()=>{if(s.clientHeight/(s.scrollHeight-s.scrollTop)>.9)return!0;if(r.activeOption){var w=r.selectable(),x=Array.from(w).indexOf(r.activeOption);if(x>=w.length-2)return!0}return!1}),!r.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";r.settings.sortField=[{field:"$order"},{field:"$score"}];const h=O=>typeof r.settings.maxOptions=="number"&&s.children.length>=r.settings.maxOptions?!1:!!(O in i&&i[O]),m=(O,w)=>r.items.indexOf(w)>=0||d.indexOf(w)>=0;r.setNextUrl=(O,w)=>{i[O]=w},r.getUrl=O=>{if(O in i){const w=i[O];return i[O]=!1,w}return r.clearPagination(),r.settings.firstUrl.call(r,O)},r.clearPagination=()=>{i={}},r.hook("instead","clearActiveOption",()=>{if(!o)return n.call(r)}),r.hook("instead","canLoad",O=>O in i?h(O):e.call(r,O)),r.hook("instead","loadCallback",(O,w)=>{if(!o)r.clearOptions(m);else if(u){const x=O[0];x!==void 0&&(u.dataset.value=x[r.settings.valueField])}t.call(r,O,w),o=!1}),r.hook("after","refreshOptions",()=>{const O=r.lastValue;var w;h(O)?(w=r.render("loading_more",{query:O}),w&&(w.setAttribute("data-selectable",""),u=w)):O in i&&!s.querySelector(".no-results")&&(w=r.render("no_more_results",{query:O})),w&&(Pu(w,r.settings.optionClass),s.append(w))}),r.on("initialize",()=>{d=Object.keys(r.options),s=r.dropdown_content,r.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},r.settings.render),s.addEventListener("scroll",()=>{r.settings.shouldLoadMore.call(r)&&h(r.lastValue)&&(o||(o=!0,r.load.call(r,r.lastValue)))})})}Ae.define("change_listener",Na);Ae.define("checkbox_options",Ha);Ae.define("clear_button",Va);Ae.define("drag_drop",Za);Ae.define("dropdown_header",ru);Ae.define("caret_position",lu);Ae.define("dropdown_input",bu);Ae.define("input_autogrow",Ou);Ae.define("no_backspace_delete",Cu);Ae.define("no_active_items",Su);Ae.define("optgroup_columns",Ru);Ae.define("remove_button",Iu);Ae.define("restore_on_backspace",Mu);Ae.define("virtual_scroll",Du);var Nu={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(dt,function(){const n=(u,d)=>{if(Array.isArray(u))u.forEach(d);else for(var h in u)u.hasOwnProperty(h)&&d(u[h],h)},t=(u,...d)=>{var h=i(d);u=s(u),u.map(m=>{h.map(O=>{m.classList.add(O)})})},i=u=>{var d=[];return n(u,h=>{typeof h=="string"&&(h=h.trim().split(/[\t\n\f\r\s]/)),Array.isArray(h)&&(d=d.concat(h))}),d.filter(Boolean)},s=u=>(Array.isArray(u)||(u=[u]),u);function o(){const u=this,d=u.canLoad,h=u.clearActiveOption,m=u.loadCallback;var O={},w,x=!1,l,E=[];if(u.settings.shouldLoadMore||(u.settings.shouldLoadMore=()=>{if(w.clientHeight/(w.scrollHeight-w.scrollTop)>.9)return!0;if(u.activeOption){var y=u.selectable(),T=Array.from(y).indexOf(u.activeOption);if(T>=y.length-2)return!0}return!1}),!u.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";u.settings.sortField=[{field:"$order"},{field:"$score"}];const R=b=>typeof u.settings.maxOptions=="number"&&w.children.length>=u.settings.maxOptions?!1:!!(b in O&&O[b]),M=(b,y)=>u.items.indexOf(y)>=0||E.indexOf(y)>=0;u.setNextUrl=(b,y)=>{O[b]=y},u.getUrl=b=>{if(b in O){const y=O[b];return O[b]=!1,y}return u.clearPagination(),u.settings.firstUrl.call(u,b)},u.clearPagination=()=>{O={}},u.hook("instead","clearActiveOption",()=>{if(!x)return h.call(u)}),u.hook("instead","canLoad",b=>b in O?R(b):d.call(u,b)),u.hook("instead","loadCallback",(b,y)=>{if(!x)u.clearOptions(M);else if(l){const T=b[0];T!==void 0&&(l.dataset.value=T[u.settings.valueField])}m.call(u,b,y),x=!1}),u.hook("after","refreshOptions",()=>{const b=u.lastValue;var y;R(b)?(y=u.render("loading_more",{query:b}),y&&(y.setAttribute("data-selectable",""),l=y)):b in O&&!w.querySelector(".no-results")&&(y=u.render("no_more_results",{query:b})),y&&(t(y,u.settings.optionClass),w.append(y))}),u.on("initialize",()=>{E=Object.keys(u.options),w=u.dropdown_content,u.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},u.settings.render),w.addEventListener("scroll",()=>{u.settings.shouldLoadMore.call(u)&&R(u.lastValue)&&(x||(x=!0,u.load.call(u,u.lastValue)))})})}return o})})(Nu);var Uu={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(dt,function(){const i=(u,d,h)=>{for(;u&&u.matches;){if(u.matches(d))return u;u=u.parentNode}},s=(u,d)=>{if(!u)return-1;d=d||u.nodeName;for(var h=0;u=u.previousElementSibling;)u.matches(d)&&h++;return h};function o(){var u=this,d=u.onKeyDown;u.hook("instead","onKeyDown",h=>{var m,O,w,x;if(!u.isOpen||!(h.keyCode===37||h.keyCode===39))return d.call(u,h);u.ignoreHover=!0,x=i(u.activeOption,"[data-group]"),m=s(u.activeOption,"[data-selectable]"),x&&(h.keyCode===37?x=x.previousSibling:x=x.nextSibling,x&&(w=x.querySelectorAll("[data-selectable]"),O=w[Math.min(w.length-1,m)],O&&u.setActiveOption(O)))})}return o})})(Uu);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function ht(r){return r+.5|0}const Be=(r,e,n)=>Math.max(Math.min(r,n),e);function nt(r){return Be(ht(r*2.55),0,255)}function je(r){return Be(ht(r*255),0,255)}function ke(r){return Be(ht(r/2.55)/100,0,1)}function Or(r){return Be(ht(r*100),0,100)}const Ee={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},wn=[..."0123456789ABCDEF"],Fu=r=>wn[r&15],Bu=r=>wn[(r&240)>>4]+wn[r&15],Ot=r=>(r&240)>>4===(r&15),ju=r=>Ot(r.r)&&Ot(r.g)&&Ot(r.b)&&Ot(r.a);function Hu(r){var e=r.length,n;return r[0]==="#"&&(e===4||e===5?n={r:255&Ee[r[1]]*17,g:255&Ee[r[2]]*17,b:255&Ee[r[3]]*17,a:e===5?Ee[r[4]]*17:255}:(e===7||e===9)&&(n={r:Ee[r[1]]<<4|Ee[r[2]],g:Ee[r[3]]<<4|Ee[r[4]],b:Ee[r[5]]<<4|Ee[r[6]],a:e===9?Ee[r[7]]<<4|Ee[r[8]]:255})),n}const Gu=(r,e)=>r<255?e(r):"";function $u(r){var e=ju(r)?Fu:Bu;return r?"#"+e(r.r)+e(r.g)+e(r.b)+Gu(r.a,e):void 0}const Vu=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function gi(r,e,n){const t=e*Math.min(n,1-n),i=(s,o=(s+r/30)%12)=>n-t*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function Wu(r,e,n){const t=(i,s=(i+r/60)%6)=>n-n*e*Math.max(Math.min(s,4-s,1),0);return[t(5),t(3),t(1)]}function zu(r,e,n){const t=gi(r,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)t[i]*=1-e-n,t[i]+=e;return t}function Ku(r,e,n,t,i){return r===i?(e-n)/t+(e<n?6:0):e===i?(n-r)/t+2:(r-e)/t+4}function kn(r){const n=r.r/255,t=r.g/255,i=r.b/255,s=Math.max(n,t,i),o=Math.min(n,t,i),u=(s+o)/2;let d,h,m;return s!==o&&(m=s-o,h=u>.5?m/(2-s-o):m/(s+o),d=Ku(n,t,i,m,s),d=d*60+.5),[d|0,h||0,u]}function Dn(r,e,n,t){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,n,t)).map(je)}function Nn(r,e,n){return Dn(gi,r,e,n)}function qu(r,e,n){return Dn(zu,r,e,n)}function Ju(r,e,n){return Dn(Wu,r,e,n)}function vi(r){return(r%360+360)%360}function Yu(r){const e=Vu.exec(r);let n=255,t;if(!e)return;e[5]!==t&&(n=e[6]?nt(+e[5]):je(+e[5]));const i=vi(+e[2]),s=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?t=qu(i,s,o):e[1]==="hsv"?t=Ju(i,s,o):t=Nn(i,s,o),{r:t[0],g:t[1],b:t[2],a:n}}function Qu(r,e){var n=kn(r);n[0]=vi(n[0]+e),n=Nn(n),r.r=n[0],r.g=n[1],r.b=n[2]}function Xu(r){if(!r)return;const e=kn(r),n=e[0],t=Or(e[1]),i=Or(e[2]);return r.a<255?`hsla(${n}, ${t}%, ${i}%, ${ke(r.a)})`:`hsl(${n}, ${t}%, ${i}%)`}const Cr={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Sr={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Zu(){const r={},e=Object.keys(Sr),n=Object.keys(Cr);let t,i,s,o,u;for(t=0;t<e.length;t++){for(o=u=e[t],i=0;i<n.length;i++)s=n[i],u=u.replace(s,Cr[s]);s=parseInt(Sr[o],16),r[u]=[s>>16&255,s>>8&255,s&255]}return r}let Ct;function el(r){Ct||(Ct=Zu(),Ct.transparent=[0,0,0,0]);const e=Ct[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const tl=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function nl(r){const e=tl.exec(r);let n=255,t,i,s;if(e){if(e[7]!==t){const o=+e[7];n=e[8]?nt(o):Be(o*255,0,255)}return t=+e[1],i=+e[3],s=+e[5],t=255&(e[2]?nt(t):Be(t,0,255)),i=255&(e[4]?nt(i):Be(i,0,255)),s=255&(e[6]?nt(s):Be(s,0,255)),{r:t,g:i,b:s,a:n}}}function rl(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${ke(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const hn=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,qe=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function il(r,e,n){const t=qe(ke(r.r)),i=qe(ke(r.g)),s=qe(ke(r.b));return{r:je(hn(t+n*(qe(ke(e.r))-t))),g:je(hn(i+n*(qe(ke(e.g))-i))),b:je(hn(s+n*(qe(ke(e.b))-s))),a:r.a+n*(e.a-r.a)}}function St(r,e,n){if(r){let t=kn(r);t[e]=Math.max(0,Math.min(t[e]+t[e]*n,e===0?360:1)),t=Nn(t),r.r=t[0],r.g=t[1],r.b=t[2]}}function mi(r,e){return r&&Object.assign(e||{},r)}function Ar(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=je(r[3]))):(e=mi(r,{r:0,g:0,b:0,a:1}),e.a=je(e.a)),e}function ol(r){return r.charAt(0)==="r"?nl(r):Yu(r)}class En{constructor(e){if(e instanceof En)return e;const n=typeof e;let t;n==="object"?t=Ar(e):n==="string"&&(t=Hu(e)||el(e)||ol(e)),this._rgb=t,this._valid=!!t}get valid(){return this._valid}get rgb(){var e=mi(this._rgb);return e&&(e.a=ke(e.a)),e}set rgb(e){this._rgb=Ar(e)}rgbString(){return this._valid?rl(this._rgb):void 0}hexString(){return this._valid?$u(this._rgb):void 0}hslString(){return this._valid?Xu(this._rgb):void 0}mix(e,n){if(e){const t=this.rgb,i=e.rgb;let s;const o=n===s?.5:n,u=2*o-1,d=t.a-i.a,h=((u*d===-1?u:(u+d)/(1+u*d))+1)/2;s=1-h,t.r=255&h*t.r+s*i.r+.5,t.g=255&h*t.g+s*i.g+.5,t.b=255&h*t.b+s*i.b+.5,t.a=o*t.a+(1-o)*i.a,this.rgb=t}return this}interpolate(e,n){return e&&(this._rgb=il(this._rgb,e._rgb,n)),this}clone(){return new En(this.rgb)}alpha(e){return this._rgb.a=je(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=ht(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return St(this._rgb,2,e),this}darken(e){return St(this._rgb,2,-e),this}saturate(e){return St(this._rgb,1,e),this}desaturate(e){return St(this._rgb,1,-e),this}rotate(e){return Qu(this._rgb,e),this}}/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var wr=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var r=window.screen;if(r)return(r.deviceXDPI||1)/(r.logicalXDPI||1)}return 1}(),it={toTextLines:function(r){var e=[],n;for(r=[].concat(r);r.length;)n=r.pop(),typeof n=="string"?e.unshift.apply(e,n.split(`
`)):Array.isArray(n)?r.push.apply(r,n):rt(r)||e.unshift(""+n);return e},textSize:function(r,e,n){var t=[].concat(e),i=t.length,s=r.font,o=0,u;for(r.font=n.string,u=0;u<i;++u)o=Math.max(r.measureText(t[u]).width,o);return r.font=s,{height:i*n.lineHeight,width:o}},bound:function(r,e,n){return Math.max(r,Math.min(e,n))},arrayDiff:function(r,e){var n=r.slice(),t=[],i,s,o,u;for(i=0,o=e.length;i<o;++i)u=e[i],s=n.indexOf(u),s===-1?t.push([u,1]):n.splice(s,1);for(i=0,o=n.length;i<o;++i)t.push([n[i],-1]);return t},rasterize:function(r){return Math.round(r*wr)/wr}};function pn(r,e){var n=e.x,t=e.y;if(n===null)return{x:0,y:-1};if(t===null)return{x:1,y:0};var i=r.x-n,s=r.y-t,o=Math.sqrt(i*i+s*s);return{x:o?i/o:0,y:o?s/o:-1}}function sl(r,e,n,t,i){switch(i){case"center":n=t=0;break;case"bottom":n=0,t=1;break;case"right":n=1,t=0;break;case"left":n=-1,t=0;break;case"top":n=0,t=-1;break;case"start":n=-n,t=-t;break;case"end":break;default:i*=Math.PI/180,n=Math.cos(i),t=Math.sin(i);break}return{x:r,y:e,vx:n,vy:t}}var al=0,yi=1,bi=2,Oi=4,Ci=8;function At(r,e,n){var t=al;return r<n.left?t|=yi:r>n.right&&(t|=bi),e<n.top?t|=Ci:e>n.bottom&&(t|=Oi),t}function ul(r,e){for(var n=r.x0,t=r.y0,i=r.x1,s=r.y1,o=At(n,t,e),u=At(i,s,e),d,h,m;!(!(o|u)||o&u);)d=o||u,d&Ci?(h=n+(i-n)*(e.top-t)/(s-t),m=e.top):d&Oi?(h=n+(i-n)*(e.bottom-t)/(s-t),m=e.bottom):d&bi?(m=t+(s-t)*(e.right-n)/(i-n),h=e.right):d&yi&&(m=t+(s-t)*(e.left-n)/(i-n),h=e.left),d===o?(n=h,t=m,o=At(n,t,e)):(i=h,s=m,u=At(i,s,e));return{x0:n,x1:i,y0:t,y1:s}}function wt(r,e){var n=e.anchor,t=r,i,s;return e.clamp&&(t=ul(t,e.area)),n==="start"?(i=t.x0,s=t.y0):n==="end"?(i=t.x1,s=t.y1):(i=(t.x0+t.x1)/2,s=(t.y0+t.y1)/2),sl(i,s,r.vx,r.vy,e.align)}var Et={arc:function(r,e){var n=(r.startAngle+r.endAngle)/2,t=Math.cos(n),i=Math.sin(n),s=r.innerRadius,o=r.outerRadius;return wt({x0:r.x+t*s,y0:r.y+i*s,x1:r.x+t*o,y1:r.y+i*o,vx:t,vy:i},e)},point:function(r,e){var n=pn(r,e.origin),t=n.x*r.options.radius,i=n.y*r.options.radius;return wt({x0:r.x-t,y0:r.y-i,x1:r.x+t,y1:r.y+i,vx:n.x,vy:n.y},e)},bar:function(r,e){var n=pn(r,e.origin),t=r.x,i=r.y,s=0,o=0;return r.horizontal?(t=Math.min(r.x,r.base),s=Math.abs(r.base-r.x)):(i=Math.min(r.y,r.base),o=Math.abs(r.base-r.y)),wt({x0:t,y0:i+o,x1:t+s,y1:i,vx:n.x,vy:n.y},e)},fallback:function(r,e){var n=pn(r,e.origin);return wt({x0:r.x,y0:r.y,x1:r.x+(r.width||0),y1:r.y+(r.height||0),vx:n.x,vy:n.y},e)}},Ne=it.rasterize;function ll(r){var e=r.borderWidth||0,n=r.padding,t=r.size.height,i=r.size.width,s=-i/2,o=-t/2;return{frame:{x:s-n.left-e,y:o-n.top-e,w:i+n.width+e*2,h:t+n.height+e*2},text:{x:s,y:o,w:i,h:t}}}function cl(r,e){var n=e.chart.getDatasetMeta(e.datasetIndex).vScale;if(!n)return null;if(n.xCenter!==void 0&&n.yCenter!==void 0)return{x:n.xCenter,y:n.yCenter};var t=n.getBasePixel();return r.horizontal?{x:t,y:null}:{x:null,y:t}}function fl(r){return r instanceof Ui?Et.arc:r instanceof Fi?Et.point:r instanceof Bi?Et.bar:Et.fallback}function dl(r,e,n,t,i,s){var o=Math.PI/2;if(s){var u=Math.min(s,i/2,t/2),d=e+u,h=n+u,m=e+t-u,O=n+i-u;r.moveTo(e,h),d<m&&h<O?(r.arc(d,h,u,-Math.PI,-o),r.arc(m,h,u,-o,0),r.arc(m,O,u,0,o),r.arc(d,O,u,o,Math.PI)):d<m?(r.moveTo(d,n),r.arc(m,h,u,-o,o),r.arc(d,h,u,o,Math.PI+o)):h<O?(r.arc(d,h,u,-Math.PI,0),r.arc(d,O,u,0,Math.PI)):r.arc(d,h,u,-Math.PI,Math.PI),r.closePath(),r.moveTo(e,n)}else r.rect(e,n,t,i)}function hl(r,e,n){var t=n.backgroundColor,i=n.borderColor,s=n.borderWidth;!t&&(!i||!s)||(r.beginPath(),dl(r,Ne(e.x)+s/2,Ne(e.y)+s/2,Ne(e.w)-s,Ne(e.h)-s,n.borderRadius),r.closePath(),t&&(r.fillStyle=t,r.fill()),i&&s&&(r.strokeStyle=i,r.lineWidth=s,r.lineJoin="miter",r.stroke()))}function pl(r,e,n){var t=n.lineHeight,i=r.w,s=r.x,o=r.y+t/2;return e==="center"?s+=i/2:(e==="end"||e==="right")&&(s+=i),{h:t,w:i,x:s,y:o}}function gl(r,e,n){var t=r.shadowBlur,i=n.stroked,s=Ne(n.x),o=Ne(n.y),u=Ne(n.w);i&&r.strokeText(e,s,o,u),n.filled&&(t&&i&&(r.shadowBlur=0),r.fillText(e,s,o,u),t&&i&&(r.shadowBlur=t))}function vl(r,e,n,t){var i=t.textAlign,s=t.color,o=!!s,u=t.font,d=e.length,h=t.textStrokeColor,m=t.textStrokeWidth,O=h&&m,w;if(!(!d||!o&&!O))for(n=pl(n,i,u),r.font=u.string,r.textAlign=i,r.textBaseline="middle",r.shadowBlur=t.textShadowBlur,r.shadowColor=t.textShadowColor,o&&(r.fillStyle=s),O&&(r.lineJoin="round",r.lineWidth=m,r.strokeStyle=h),w=0,d=e.length;w<d;++w)gl(r,e[w],{stroked:O,filled:o,w:n.w,x:n.x,y:n.y+n.h*w})}var Si=function(r,e,n,t){var i=this;i._config=r,i._index=t,i._model=null,i._rects=null,i._ctx=e,i._el=n};st(Si.prototype,{_modelize:function(r,e,n,t){var i=this,s=i._index,o=ki(le([n.font,{}],t,s)),u=le([n.color,Di.color],t,s);return{align:le([n.align,"center"],t,s),anchor:le([n.anchor,"center"],t,s),area:t.chart.chartArea,backgroundColor:le([n.backgroundColor,null],t,s),borderColor:le([n.borderColor,null],t,s),borderRadius:le([n.borderRadius,0],t,s),borderWidth:le([n.borderWidth,0],t,s),clamp:le([n.clamp,!1],t,s),clip:le([n.clip,!1],t,s),color:u,display:r,font:o,lines:e,offset:le([n.offset,4],t,s),opacity:le([n.opacity,1],t,s),origin:cl(i._el,t),padding:Ni(le([n.padding,4],t,s)),positioner:fl(i._el),rotation:le([n.rotation,0],t,s)*(Math.PI/180),size:it.textSize(i._ctx,e,o),textAlign:le([n.textAlign,"start"],t,s),textShadowBlur:le([n.textShadowBlur,0],t,s),textShadowColor:le([n.textShadowColor,u],t,s),textStrokeColor:le([n.textStrokeColor,u],t,s),textStrokeWidth:le([n.textStrokeWidth,0],t,s)}},update:function(r){var e=this,n=null,t=null,i=e._index,s=e._config,o,u,d,h=le([s.display,!0],r,i);h&&(o=r.dataset.data[i],u=Li(Rr(s.formatter,[o,r]),o),d=rt(u)?[]:it.toTextLines(u),d.length&&(n=e._modelize(h,d,s,r),t=ll(n))),e._model=n,e._rects=t},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(r,e){var n=this,t=r.ctx,i=n._model,s=n._rects,o;this.visible()&&(t.save(),i.clip&&(o=i.area,t.beginPath(),t.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),t.clip()),t.globalAlpha=it.bound(0,i.opacity,1),t.translate(Ne(e.x),Ne(e.y)),t.rotate(i.rotation),hl(t,s.frame,i),vl(t,i.lines,s.text,i),t.restore())}});var ml=Number.MIN_SAFE_INTEGER||-9007199254740991,yl=Number.MAX_SAFE_INTEGER||9007199254740991;function tt(r,e,n){var t=Math.cos(n),i=Math.sin(n),s=e.x,o=e.y;return{x:s+t*(r.x-s)-i*(r.y-o),y:o+i*(r.x-s)+t*(r.y-o)}}function Er(r,e){var n=yl,t=ml,i=e.origin,s,o,u,d,h;for(s=0;s<r.length;++s)o=r[s],u=o.x-i.x,d=o.y-i.y,h=e.vx*u+e.vy*d,n=Math.min(n,h),t=Math.max(t,h);return{min:n,max:t}}function Rt(r,e){var n=e.x-r.x,t=e.y-r.y,i=Math.sqrt(n*n+t*t);return{vx:(e.x-r.x)/i,vy:(e.y-r.y)/i,origin:r,ln:i}}var Ai=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};st(Ai.prototype,{center:function(){var r=this._rect;return{x:r.x+r.w/2,y:r.y+r.h/2}},update:function(r,e,n){this._rotation=n,this._rect={x:e.x+r.x,y:e.y+r.y,w:e.w,h:e.h}},contains:function(r){var e=this,n=1,t=e._rect;return r=tt(r,e.center(),-e._rotation),!(r.x<t.x-n||r.y<t.y-n||r.x>t.x+t.w+n*2||r.y>t.y+t.h+n*2)},intersects:function(r){var e=this._points(),n=r._points(),t=[Rt(e[0],e[1]),Rt(e[0],e[3])],i,s,o;for(this._rotation!==r._rotation&&t.push(Rt(n[0],n[1]),Rt(n[0],n[3])),i=0;i<t.length;++i)if(s=Er(e,t[i]),o=Er(n,t[i]),s.max<o.min||o.max<s.min)return!1;return!0},_points:function(){var r=this,e=r._rect,n=r._rotation,t=r.center();return[tt({x:e.x,y:e.y},t,n),tt({x:e.x+e.w,y:e.y},t,n),tt({x:e.x+e.w,y:e.y+e.h},t,n),tt({x:e.x,y:e.y+e.h},t,n)]}});function wi(r,e,n){var t=e.positioner(r,e),i=t.vx,s=t.vy;if(!i&&!s)return{x:t.x,y:t.y};var o=n.w,u=n.h,d=e.rotation,h=Math.abs(o/2*Math.cos(d))+Math.abs(u/2*Math.sin(d)),m=Math.abs(o/2*Math.sin(d))+Math.abs(u/2*Math.cos(d)),O=1/Math.max(Math.abs(i),Math.abs(s));return h*=i*O,m*=s*O,h+=e.offset*i,m+=e.offset*s,{x:t.x+h,y:t.y+m}}function bl(r,e){var n,t,i,s;for(n=r.length-1;n>=0;--n)for(i=r[n].$layout,t=n-1;t>=0&&i._visible;--t)s=r[t].$layout,s._visible&&i._box.intersects(s._box)&&e(i,s);return r}function Ol(r){var e,n,t,i,s,o,u;for(e=0,n=r.length;e<n;++e)t=r[e],i=t.$layout,i._visible&&(u=new Proxy(t._el,{get:(d,h)=>d.getProps([h],!0)[h]}),s=t.geometry(),o=wi(u,t.model(),s),i._box.update(o,s,t.rotation()));return bl(r,function(d,h){var m=d._hidable,O=h._hidable;m&&O||O?h._visible=!1:m&&(d._visible=!1)})}var ot={prepare:function(r){var e=[],n,t,i,s,o;for(n=0,i=r.length;n<i;++n)for(t=0,s=r[n].length;t<s;++t)o=r[n][t],e.push(o),o.$layout={_box:new Ai,_hidable:!1,_visible:!0,_set:n,_idx:o._index};return e.sort(function(u,d){var h=u.$layout,m=d.$layout;return h._idx===m._idx?m._set-h._set:m._idx-h._idx}),this.update(e),e},update:function(r){var e=!1,n,t,i,s,o;for(n=0,t=r.length;n<t;++n)i=r[n],s=i.model(),o=i.$layout,o._hidable=s&&s.display==="auto",o._visible=i.visible(),e|=o._hidable;e&&Ol(r)},lookup:function(r,e){var n,t;for(n=r.length-1;n>=0;--n)if(t=r[n].$layout,t&&t._visible&&t._box.contains(e))return r[n];return null},draw:function(r,e){var n,t,i,s,o,u;for(n=0,t=e.length;n<t;++n)i=e[n],s=i.$layout,s._visible&&(o=i.geometry(),u=wi(i._el,i.model(),o),s._box.update(u,o,i.rotation()),i.draw(r,u))}},Cl=function(r){if(rt(r))return null;var e=r,n,t,i;if(_i(r))if(!rt(r.label))e=r.label;else if(!rt(r.r))e=r.r;else for(e="",n=Object.keys(r),i=0,t=n.length;i<t;++i)e+=(i!==0?", ":"")+n[i]+": "+r[n[i]];return""+e},Sl={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:Cl,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},Oe="$datalabels",Ei="$default";function Al(r,e){var n=r.datalabels,t={},i=[],s,o;return n===!1?null:(n===!0&&(n={}),e=st({},[e,n]),s=e.labels||{},o=Object.keys(s),delete e.labels,o.length?o.forEach(function(u){s[u]&&i.push(st({},[e,s[u],{_key:u}]))}):i.push(e),t=i.reduce(function(u,d){return Pi(d.listeners||{},function(h,m){u[m]=u[m]||{},u[m][d._key||Ei]=h}),delete d.listeners,u},{}),{labels:i,listeners:t})}function Rn(r,e,n,t){if(e){var i=n.$context,s=n.$groups,o;e[s._set]&&(o=e[s._set][s._key],o&&Rr(o,[i,t])===!0&&(r[Oe]._dirty=!0,n.update(i)))}}function wl(r,e,n,t,i){var s,o;!n&&!t||(n?t?n!==t&&(o=s=!0):o=!0:s=!0,o&&Rn(r,e.leave,n,i),s&&Rn(r,e.enter,t,i))}function El(r,e){var n=r[Oe],t=n._listeners,i,s;if(!(!t.enter&&!t.leave)){if(e.type==="mousemove")s=ot.lookup(n._labels,e);else if(e.type!=="mouseout")return;i=n._hovered,n._hovered=s,wl(r,t,i,s,e)}}function Rl(r,e){var n=r[Oe],t=n._listeners.click,i=t&&ot.lookup(n._labels,e);i&&Rn(r,t,i,e)}var Xl={id:"datalabels",defaults:Sl,beforeInit:function(r){r[Oe]={_actives:[]}},beforeUpdate:function(r){var e=r[Oe];e._listened=!1,e._listeners={},e._datasets=[],e._labels=[]},afterDatasetUpdate:function(r,e,n){var t=e.index,i=r[Oe],s=i._datasets[t]=[],o=r.isDatasetVisible(t),u=r.data.datasets[t],d=Al(u,n),h=e.meta.data||[],m=r.ctx,O,w,x,l,E,R,M,b;for(m.save(),O=0,x=h.length;O<x;++O)if(M=h[O],M[Oe]=[],o&&M&&r.getDataVisibility(O)&&!M.skip)for(w=0,l=d.labels.length;w<l;++w)E=d.labels[w],R=E._key,b=new Si(E,m,M,O),b.$groups={_set:t,_key:R||Ei},b.$context={active:!1,chart:r,dataIndex:O,dataset:u,datasetIndex:t},b.update(b.$context),M[Oe].push(b),s.push(b);m.restore(),st(i._listeners,d.listeners,{merger:function(y,T,p){T[y]=T[y]||{},T[y][e.index]=p[y],i._listened=!0}})},afterUpdate:function(r){r[Oe]._labels=ot.prepare(r[Oe]._datasets)},afterDatasetsDraw:function(r){ot.draw(r,r[Oe]._labels)},beforeEvent:function(r,e){if(r[Oe]._listened){var n=e.event;switch(n.type){case"mousemove":case"mouseout":El(r,n);break;case"click":Rl(r,n);break}}},afterEvent:function(r){var e=r[Oe],n=e._actives,t=e._actives=r.getActiveElements(),i=it.arrayDiff(n,t),s,o,u,d,h,m,O;for(s=0,o=i.length;s<o;++s)if(h=i[s],h[1])for(O=h[0].element[Oe]||[],u=0,d=O.length;u<d;++u)m=O[u],m.$context.active=h[1]===1,m.update(m.$context);(e._dirty||i.length)&&(ot.update(e._labels),r.render()),delete e._dirty}};export{ql as A,En as C,Kl as E,Jl as N,Ae as T,ce as a,Yl as d,Xl as p,Ql as r};
