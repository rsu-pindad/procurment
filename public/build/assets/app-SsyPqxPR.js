function Br(r,e){for(var n=0;n<e.length;n++){const t=e[n];if(typeof t!="string"&&!Array.isArray(t)){for(const i in t)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(t,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>t[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}function qn(r,e){return function(){return r.apply(e,arguments)}}const{toString:Fr}=Object.prototype,{getPrototypeOf:Zt}=Object,{iterator:vt,toStringTag:Kn}=Symbol,mt=(r=>e=>{const n=Fr.call(e);return r[n]||(r[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Te=r=>(r=r.toLowerCase(),e=>mt(e)===r),yt=r=>e=>typeof e===r,{isArray:$e}=Array,qe=yt("undefined");function Hr(r){return r!==null&&!qe(r)&&r.constructor!==null&&!qe(r.constructor)&&Oe(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Jn=Te("ArrayBuffer");function Gr(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Jn(r.buffer),e}const $r=yt("string"),Oe=yt("function"),Qn=yt("number"),bt=r=>r!==null&&typeof r=="object",Vr=r=>r===!0||r===!1,it=r=>{if(mt(r)!=="object")return!1;const e=Zt(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Kn in r)&&!(vt in r)},zr=Te("Date"),Wr=Te("File"),qr=Te("Blob"),Kr=Te("FileList"),Jr=r=>bt(r)&&Oe(r.pipe),Qr=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Oe(r.append)&&((e=mt(r))==="formdata"||e==="object"&&Oe(r.toString)&&r.toString()==="[object FormData]"))},Xr=Te("URLSearchParams"),[Yr,Zr,ei,ti]=["ReadableStream","Request","Response","Headers"].map(Te),ni=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qe(r,e,{allOwnKeys:n=!1}={}){if(r===null||typeof r>"u")return;let t,i;if(typeof r!="object"&&(r=[r]),$e(r))for(t=0,i=r.length;t<i;t++)e.call(null,r[t],t,r);else{const s=n?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let g;for(t=0;t<o;t++)g=s[t],e.call(null,r[g],g,r)}}function Xn(r,e){e=e.toLowerCase();const n=Object.keys(r);let t=n.length,i;for(;t-- >0;)if(i=n[t],e===i.toLowerCase())return i;return null}const _e=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Yn=r=>!qe(r)&&r!==_e;function $t(){const{caseless:r}=Yn(this)&&this||{},e={},n=(t,i)=>{const s=r&&Xn(e,i)||i;it(e[s])&&it(t)?e[s]=$t(e[s],t):it(t)?e[s]=$t({},t):$e(t)?e[s]=t.slice():e[s]=t};for(let t=0,i=arguments.length;t<i;t++)arguments[t]&&Qe(arguments[t],n);return e}const ri=(r,e,n,{allOwnKeys:t}={})=>(Qe(e,(i,s)=>{n&&Oe(i)?r[s]=qn(i,n):r[s]=i},{allOwnKeys:t}),r),ii=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),oi=(r,e,n,t)=>{r.prototype=Object.create(e.prototype,t),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),n&&Object.assign(r.prototype,n)},si=(r,e,n,t)=>{let i,s,o;const g={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!t||t(o,r,e))&&!g[o]&&(e[o]=r[o],g[o]=!0);r=n!==!1&&Zt(r)}while(r&&(!n||n(r,e))&&r!==Object.prototype);return e},ai=(r,e,n)=>{r=String(r),(n===void 0||n>r.length)&&(n=r.length),n-=e.length;const t=r.indexOf(e,n);return t!==-1&&t===n},li=r=>{if(!r)return null;if($e(r))return r;let e=r.length;if(!Qn(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=r[e];return n},ui=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&Zt(Uint8Array)),ci=(r,e)=>{const t=(r&&r[vt]).call(r);let i;for(;(i=t.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},fi=(r,e)=>{let n;const t=[];for(;(n=r.exec(e))!==null;)t.push(n);return t},di=Te("HTMLFormElement"),hi=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,t,i){return t.toUpperCase()+i}),un=(({hasOwnProperty:r})=>(e,n)=>r.call(e,n))(Object.prototype),pi=Te("RegExp"),Zn=(r,e)=>{const n=Object.getOwnPropertyDescriptors(r),t={};Qe(n,(i,s)=>{let o;(o=e(i,s,r))!==!1&&(t[s]=o||i)}),Object.defineProperties(r,t)},gi=r=>{Zn(r,(e,n)=>{if(Oe(r)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const t=r[n];if(Oe(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},vi=(r,e)=>{const n={},t=i=>{i.forEach(s=>{n[s]=!0})};return $e(r)?t(r):t(String(r).split(e)),n},mi=()=>{},yi=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function bi(r){return!!(r&&Oe(r.append)&&r[Kn]==="FormData"&&r[vt])}const Oi=r=>{const e=new Array(10),n=(t,i)=>{if(bt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[i]=t;const s=$e(t)?[]:{};return Qe(t,(o,g)=>{const h=n(o,i+1);!qe(h)&&(s[g]=h)}),e[i]=void 0,s}}return t};return n(r,0)},Ci=Te("AsyncFunction"),wi=r=>r&&(bt(r)||Oe(r))&&Oe(r.then)&&Oe(r.catch),er=((r,e)=>r?setImmediate:e?((n,t)=>(_e.addEventListener("message",({source:i,data:s})=>{i===_e&&s===n&&t.length&&t.shift()()},!1),i=>{t.push(i),_e.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Oe(_e.postMessage)),Si=typeof queueMicrotask<"u"?queueMicrotask.bind(_e):typeof process<"u"&&process.nextTick||er,Ai=r=>r!=null&&Oe(r[vt]),W={isArray:$e,isArrayBuffer:Jn,isBuffer:Hr,isFormData:Qr,isArrayBufferView:Gr,isString:$r,isNumber:Qn,isBoolean:Vr,isObject:bt,isPlainObject:it,isReadableStream:Yr,isRequest:Zr,isResponse:ei,isHeaders:ti,isUndefined:qe,isDate:zr,isFile:Wr,isBlob:qr,isRegExp:pi,isFunction:Oe,isStream:Jr,isURLSearchParams:Xr,isTypedArray:ui,isFileList:Kr,forEach:Qe,merge:$t,extend:ri,trim:ni,stripBOM:ii,inherits:oi,toFlatObject:si,kindOf:mt,kindOfTest:Te,endsWith:ai,toArray:li,forEachEntry:ci,matchAll:fi,isHTMLForm:di,hasOwnProperty:un,hasOwnProp:un,reduceDescriptors:Zn,freezeMethods:gi,toObjectSet:vi,toCamelCase:hi,noop:mi,toFiniteNumber:yi,findKey:Xn,global:_e,isContextDefined:Yn,isSpecCompliantForm:bi,toJSONObject:Oi,isAsyncFn:Ci,isThenable:wi,setImmediate:er,asap:Si,isIterable:Ai};function te(r,e,n,t,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),t&&(this.request=t),i&&(this.response=i,this.status=i.status?i.status:null)}W.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:W.toJSONObject(this.config),code:this.code,status:this.status}}});const tr=te.prototype,nr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{nr[r]={value:r}});Object.defineProperties(te,nr);Object.defineProperty(tr,"isAxiosError",{value:!0});te.from=(r,e,n,t,i,s)=>{const o=Object.create(tr);return W.toFlatObject(r,o,function(h){return h!==Error.prototype},g=>g!=="isAxiosError"),te.call(o,r.message,e,n,t,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const Ei=null;function Vt(r){return W.isPlainObject(r)||W.isArray(r)}function rr(r){return W.endsWith(r,"[]")?r.slice(0,-2):r}function cn(r,e,n){return r?r.concat(e).map(function(i,s){return i=rr(i),!n&&s?"["+i+"]":i}).join(n?".":""):e}function Ri(r){return W.isArray(r)&&!r.some(Vt)}const Ti=W.toFlatObject(W,{},null,function(e){return/^is[A-Z]/.test(e)});function Ot(r,e,n){if(!W.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,n=W.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,R){return!W.isUndefined(R[E])});const t=n.metaTokens,i=n.visitor||w,s=n.dots,o=n.indexes,h=(n.Blob||typeof Blob<"u"&&Blob)&&W.isSpecCompliantForm(e);if(!W.isFunction(i))throw new TypeError("visitor must be a function");function p(l){if(l===null)return"";if(W.isDate(l))return l.toISOString();if(W.isBoolean(l))return l.toString();if(!h&&W.isBlob(l))throw new te("Blob is not supported. Use a Buffer instead.");return W.isArrayBuffer(l)||W.isTypedArray(l)?h&&typeof Blob=="function"?new Blob([l]):Buffer.from(l):l}function w(l,E,R){let x=l;if(l&&!R&&typeof l=="object"){if(W.endsWith(E,"{}"))E=t?E:E.slice(0,-2),l=JSON.stringify(l);else if(W.isArray(l)&&Ri(l)||(W.isFileList(l)||W.endsWith(E,"[]"))&&(x=W.toArray(l)))return E=rr(E),x.forEach(function(b,T){!(W.isUndefined(b)||b===null)&&e.append(o===!0?cn([E],T,s):o===null?E:E+"[]",p(b))}),!1}return Vt(l)?!0:(e.append(cn(R,E,s),p(l)),!1)}const S=[],A=Object.assign(Ti,{defaultVisitor:w,convertValue:p,isVisitable:Vt});function P(l,E){if(!W.isUndefined(l)){if(S.indexOf(l)!==-1)throw Error("Circular reference detected in "+E.join("."));S.push(l),W.forEach(l,function(x,C){(!(W.isUndefined(x)||x===null)&&i.call(e,x,W.isString(C)?C.trim():C,E,A))===!0&&P(x,E?E.concat(C):[C])}),S.pop()}}if(!W.isObject(r))throw new TypeError("data must be an object");return P(r),e}function fn(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function en(r,e){this._pairs=[],r&&Ot(r,this,e)}const ir=en.prototype;ir.append=function(e,n){this._pairs.push([e,n])};ir.toString=function(e){const n=e?function(t){return e.call(this,t,fn)}:fn;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function Ii(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function or(r,e,n){if(!e)return r;const t=n&&n.encode||Ii;W.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(i?s=i(e,n):s=W.isURLSearchParams(e)?e.toString():new en(e,n).toString(t),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class dn{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){W.forEach(this.handlers,function(t){t!==null&&e(t)})}}const sr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xi=typeof URLSearchParams<"u"?URLSearchParams:en,Pi=typeof FormData<"u"?FormData:null,Mi=typeof Blob<"u"?Blob:null,Li={isBrowser:!0,classes:{URLSearchParams:xi,FormData:Pi,Blob:Mi},protocols:["http","https","file","blob","url","data"]},tn=typeof window<"u"&&typeof document<"u",zt=typeof navigator=="object"&&navigator||void 0,ki=tn&&(!zt||["ReactNative","NativeScript","NS"].indexOf(zt.product)<0),Di=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ni=tn&&window.location.href||"http://localhost",_i=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:tn,hasStandardBrowserEnv:ki,hasStandardBrowserWebWorkerEnv:Di,navigator:zt,origin:Ni},Symbol.toStringTag,{value:"Module"})),ge={..._i,...Li};function ji(r,e){return Ot(r,new ge.classes.URLSearchParams,Object.assign({visitor:function(n,t,i,s){return ge.isNode&&W.isBuffer(n)?(this.append(t,n.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Ui(r){return W.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Bi(r){const e={},n=Object.keys(r);let t;const i=n.length;let s;for(t=0;t<i;t++)s=n[t],e[s]=r[s];return e}function ar(r){function e(n,t,i,s){let o=n[s++];if(o==="__proto__")return!0;const g=Number.isFinite(+o),h=s>=n.length;return o=!o&&W.isArray(i)?i.length:o,h?(W.hasOwnProp(i,o)?i[o]=[i[o],t]:i[o]=t,!g):((!i[o]||!W.isObject(i[o]))&&(i[o]=[]),e(n,t,i[o],s)&&W.isArray(i[o])&&(i[o]=Bi(i[o])),!g)}if(W.isFormData(r)&&W.isFunction(r.entries)){const n={};return W.forEachEntry(r,(t,i)=>{e(Ui(t),i,n,0)}),n}return null}function Fi(r,e,n){if(W.isString(r))try{return(e||JSON.parse)(r),W.trim(r)}catch(t){if(t.name!=="SyntaxError")throw t}return(n||JSON.stringify)(r)}const Xe={transitional:sr,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",i=t.indexOf("application/json")>-1,s=W.isObject(e);if(s&&W.isHTMLForm(e)&&(e=new FormData(e)),W.isFormData(e))return i?JSON.stringify(ar(e)):e;if(W.isArrayBuffer(e)||W.isBuffer(e)||W.isStream(e)||W.isFile(e)||W.isBlob(e)||W.isReadableStream(e))return e;if(W.isArrayBufferView(e))return e.buffer;if(W.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let g;if(s){if(t.indexOf("application/x-www-form-urlencoded")>-1)return ji(e,this.formSerializer).toString();if((g=W.isFileList(e))||t.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Ot(g?{"files[]":e}:e,h&&new h,this.formSerializer)}}return s||i?(n.setContentType("application/json",!1),Fi(e)):e}],transformResponse:[function(e){const n=this.transitional||Xe.transitional,t=n&&n.forcedJSONParsing,i=this.responseType==="json";if(W.isResponse(e)||W.isReadableStream(e))return e;if(e&&W.isString(e)&&(t&&!this.responseType||i)){const o=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(g){if(o)throw g.name==="SyntaxError"?te.from(g,te.ERR_BAD_RESPONSE,this,null,this.response):g}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ge.classes.FormData,Blob:ge.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};W.forEach(["delete","get","head","post","put","patch"],r=>{Xe.headers[r]={}});const Hi=W.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Gi=r=>{const e={};let n,t,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),n=o.substring(0,i).trim().toLowerCase(),t=o.substring(i+1).trim(),!(!n||e[n]&&Hi[n])&&(n==="set-cookie"?e[n]?e[n].push(t):e[n]=[t]:e[n]=e[n]?e[n]+", "+t:t)}),e},hn=Symbol("internals");function We(r){return r&&String(r).trim().toLowerCase()}function ot(r){return r===!1||r==null?r:W.isArray(r)?r.map(ot):String(r)}function $i(r){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=n.exec(r);)e[t[1]]=t[2];return e}const Vi=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Pt(r,e,n,t,i){if(W.isFunction(t))return t.call(this,e,n);if(i&&(e=n),!!W.isString(e)){if(W.isString(t))return e.indexOf(t)!==-1;if(W.isRegExp(t))return t.test(e)}}function zi(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}function Wi(r,e){const n=W.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(r,t+n,{value:function(i,s,o){return this[t].call(this,e,i,s,o)},configurable:!0})})}let Ce=class{constructor(e){e&&this.set(e)}set(e,n,t){const i=this;function s(g,h,p){const w=We(h);if(!w)throw new Error("header name must be a non-empty string");const S=W.findKey(i,w);(!S||i[S]===void 0||p===!0||p===void 0&&i[S]!==!1)&&(i[S||h]=ot(g))}const o=(g,h)=>W.forEach(g,(p,w)=>s(p,w,h));if(W.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(W.isString(e)&&(e=e.trim())&&!Vi(e))o(Gi(e),n);else if(W.isObject(e)&&W.isIterable(e)){let g={},h,p;for(const w of e){if(!W.isArray(w))throw TypeError("Object iterator must return a key-value pair");g[p=w[0]]=(h=g[p])?W.isArray(h)?[...h,w[1]]:[h,w[1]]:w[1]}o(g,n)}else e!=null&&s(n,e,t);return this}get(e,n){if(e=We(e),e){const t=W.findKey(this,e);if(t){const i=this[t];if(!n)return i;if(n===!0)return $i(i);if(W.isFunction(n))return n.call(this,i,t);if(W.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=We(e),e){const t=W.findKey(this,e);return!!(t&&this[t]!==void 0&&(!n||Pt(this,this[t],t,n)))}return!1}delete(e,n){const t=this;let i=!1;function s(o){if(o=We(o),o){const g=W.findKey(t,o);g&&(!n||Pt(t,t[g],g,n))&&(delete t[g],i=!0)}}return W.isArray(e)?e.forEach(s):s(e),i}clear(e){const n=Object.keys(this);let t=n.length,i=!1;for(;t--;){const s=n[t];(!e||Pt(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const n=this,t={};return W.forEach(this,(i,s)=>{const o=W.findKey(t,s);if(o){n[o]=ot(i),delete n[s];return}const g=e?zi(s):String(s).trim();g!==s&&delete n[s],n[g]=ot(i),t[g]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return W.forEach(this,(t,i)=>{t!=null&&t!==!1&&(n[i]=e&&W.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(i=>t.set(i)),t}static accessor(e){const t=(this[hn]=this[hn]={accessors:{}}).accessors,i=this.prototype;function s(o){const g=We(o);t[g]||(Wi(i,o),t[g]=!0)}return W.isArray(e)?e.forEach(s):s(e),this}};Ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);W.reduceDescriptors(Ce.prototype,({value:r},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(t){this[n]=t}}});W.freezeMethods(Ce);function Mt(r,e){const n=this||Xe,t=e||n,i=Ce.from(t.headers);let s=t.data;return W.forEach(r,function(g){s=g.call(n,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function lr(r){return!!(r&&r.__CANCEL__)}function Ve(r,e,n){te.call(this,r??"canceled",te.ERR_CANCELED,e,n),this.name="CanceledError"}W.inherits(Ve,te,{__CANCEL__:!0});function ur(r,e,n){const t=n.config.validateStatus;!n.status||!t||t(n.status)?r(n):e(new te("Request failed with status code "+n.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function qi(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function Ki(r,e){r=r||10;const n=new Array(r),t=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(h){const p=Date.now(),w=t[s];o||(o=p),n[i]=h,t[i]=p;let S=s,A=0;for(;S!==i;)A+=n[S++],S=S%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),p-o<e)return;const P=w&&p-w;return P?Math.round(A*1e3/P):void 0}}function Ji(r,e){let n=0,t=1e3/e,i,s;const o=(p,w=Date.now())=>{n=w,i=null,s&&(clearTimeout(s),s=null),r.apply(null,p)};return[(...p)=>{const w=Date.now(),S=w-n;S>=t?o(p,w):(i=p,s||(s=setTimeout(()=>{s=null,o(i)},t-S)))},()=>i&&o(i)]}const lt=(r,e,n=3)=>{let t=0;const i=Ki(50,250);return Ji(s=>{const o=s.loaded,g=s.lengthComputable?s.total:void 0,h=o-t,p=i(h),w=o<=g;t=o;const S={loaded:o,total:g,progress:g?o/g:void 0,bytes:h,rate:p||void 0,estimated:p&&g&&w?(g-o)/p:void 0,event:s,lengthComputable:g!=null,[e?"download":"upload"]:!0};r(S)},n)},pn=(r,e)=>{const n=r!=null;return[t=>e[0]({lengthComputable:n,total:r,loaded:t}),e[1]]},gn=r=>(...e)=>W.asap(()=>r(...e)),Qi=ge.hasStandardBrowserEnv?((r,e)=>n=>(n=new URL(n,ge.origin),r.protocol===n.protocol&&r.host===n.host&&(e||r.port===n.port)))(new URL(ge.origin),ge.navigator&&/(msie|trident)/i.test(ge.navigator.userAgent)):()=>!0,Xi=ge.hasStandardBrowserEnv?{write(r,e,n,t,i,s){const o=[r+"="+encodeURIComponent(e)];W.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),W.isString(t)&&o.push("path="+t),W.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Yi(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Zi(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function cr(r,e,n){let t=!Yi(e);return r&&(t||n==!1)?Zi(r,e):e}const vn=r=>r instanceof Ce?{...r}:r;function Ue(r,e){e=e||{};const n={};function t(p,w,S,A){return W.isPlainObject(p)&&W.isPlainObject(w)?W.merge.call({caseless:A},p,w):W.isPlainObject(w)?W.merge({},w):W.isArray(w)?w.slice():w}function i(p,w,S,A){if(W.isUndefined(w)){if(!W.isUndefined(p))return t(void 0,p,S,A)}else return t(p,w,S,A)}function s(p,w){if(!W.isUndefined(w))return t(void 0,w)}function o(p,w){if(W.isUndefined(w)){if(!W.isUndefined(p))return t(void 0,p)}else return t(void 0,w)}function g(p,w,S){if(S in e)return t(p,w);if(S in r)return t(void 0,p)}const h={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:g,headers:(p,w,S)=>i(vn(p),vn(w),S,!0)};return W.forEach(Object.keys(Object.assign({},r,e)),function(w){const S=h[w]||i,A=S(r[w],e[w],w);W.isUndefined(A)&&S!==g||(n[w]=A)}),n}const fr=r=>{const e=Ue({},r);let{data:n,withXSRFToken:t,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:g}=e;e.headers=o=Ce.from(o),e.url=or(cr(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),g&&o.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):"")));let h;if(W.isFormData(n)){if(ge.hasStandardBrowserEnv||ge.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((h=o.getContentType())!==!1){const[p,...w]=h?h.split(";").map(S=>S.trim()).filter(Boolean):[];o.setContentType([p||"multipart/form-data",...w].join("; "))}}if(ge.hasStandardBrowserEnv&&(t&&W.isFunction(t)&&(t=t(e)),t||t!==!1&&Qi(e.url))){const p=i&&s&&Xi.read(s);p&&o.set(i,p)}return e},eo=typeof XMLHttpRequest<"u",to=eo&&function(r){return new Promise(function(n,t){const i=fr(r);let s=i.data;const o=Ce.from(i.headers).normalize();let{responseType:g,onUploadProgress:h,onDownloadProgress:p}=i,w,S,A,P,l;function E(){P&&P(),l&&l(),i.cancelToken&&i.cancelToken.unsubscribe(w),i.signal&&i.signal.removeEventListener("abort",w)}let R=new XMLHttpRequest;R.open(i.method.toUpperCase(),i.url,!0),R.timeout=i.timeout;function x(){if(!R)return;const b=Ce.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),f={data:!g||g==="text"||g==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:b,config:r,request:R};ur(function(u){n(u),E()},function(u){t(u),E()},f),R=null}"onloadend"in R?R.onloadend=x:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(x)},R.onabort=function(){R&&(t(new te("Request aborted",te.ECONNABORTED,r,R)),R=null)},R.onerror=function(){t(new te("Network Error",te.ERR_NETWORK,r,R)),R=null},R.ontimeout=function(){let T=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const f=i.transitional||sr;i.timeoutErrorMessage&&(T=i.timeoutErrorMessage),t(new te(T,f.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,r,R)),R=null},s===void 0&&o.setContentType(null),"setRequestHeader"in R&&W.forEach(o.toJSON(),function(T,f){R.setRequestHeader(f,T)}),W.isUndefined(i.withCredentials)||(R.withCredentials=!!i.withCredentials),g&&g!=="json"&&(R.responseType=i.responseType),p&&([A,l]=lt(p,!0),R.addEventListener("progress",A)),h&&R.upload&&([S,P]=lt(h),R.upload.addEventListener("progress",S),R.upload.addEventListener("loadend",P)),(i.cancelToken||i.signal)&&(w=b=>{R&&(t(!b||b.type?new Ve(null,r,R):b),R.abort(),R=null)},i.cancelToken&&i.cancelToken.subscribe(w),i.signal&&(i.signal.aborted?w():i.signal.addEventListener("abort",w)));const C=qi(i.url);if(C&&ge.protocols.indexOf(C)===-1){t(new te("Unsupported protocol "+C+":",te.ERR_BAD_REQUEST,r));return}R.send(s||null)})},no=(r,e)=>{const{length:n}=r=r?r.filter(Boolean):[];if(e||n){let t=new AbortController,i;const s=function(p){if(!i){i=!0,g();const w=p instanceof Error?p:this.reason;t.abort(w instanceof te?w:new Ve(w instanceof Error?w.message:w))}};let o=e&&setTimeout(()=>{o=null,s(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const g=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(p=>{p.unsubscribe?p.unsubscribe(s):p.removeEventListener("abort",s)}),r=null)};r.forEach(p=>p.addEventListener("abort",s));const{signal:h}=t;return h.unsubscribe=()=>W.asap(g),h}},ro=function*(r,e){let n=r.byteLength;if(n<e){yield r;return}let t=0,i;for(;t<n;)i=t+e,yield r.slice(t,i),t=i},oo=async function*(r,e){for await(const n of so(r))yield*ro(n,e)},so=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:n,value:t}=await e.read();if(n)break;yield t}}finally{await e.cancel()}},mn=(r,e,n,t)=>{const i=oo(r,e);let s=0,o,g=h=>{o||(o=!0,t&&t(h))};return new ReadableStream({async pull(h){try{const{done:p,value:w}=await i.next();if(p){g(),h.close();return}let S=w.byteLength;if(n){let A=s+=S;n(A)}h.enqueue(new Uint8Array(w))}catch(p){throw g(p),p}},cancel(h){return g(h),i.return()}},{highWaterMark:2})},Ct=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",dr=Ct&&typeof ReadableStream=="function",ao=Ct&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),hr=(r,...e)=>{try{return!!r(...e)}catch{return!1}},lo=dr&&hr(()=>{let r=!1;const e=new Request(ge.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),yn=64*1024,Wt=dr&&hr(()=>W.isReadableStream(new Response("").body)),ut={stream:Wt&&(r=>r.body)};Ct&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ut[e]&&(ut[e]=W.isFunction(r[e])?n=>n[e]():(n,t)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,t)})})})(new Response);const uo=async r=>{if(r==null)return 0;if(W.isBlob(r))return r.size;if(W.isSpecCompliantForm(r))return(await new Request(ge.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(W.isArrayBufferView(r)||W.isArrayBuffer(r))return r.byteLength;if(W.isURLSearchParams(r)&&(r=r+""),W.isString(r))return(await ao(r)).byteLength},co=async(r,e)=>{const n=W.toFiniteNumber(r.getContentLength());return n??uo(e)},fo=Ct&&(async r=>{let{url:e,method:n,data:t,signal:i,cancelToken:s,timeout:o,onDownloadProgress:g,onUploadProgress:h,responseType:p,headers:w,withCredentials:S="same-origin",fetchOptions:A}=fr(r);p=p?(p+"").toLowerCase():"text";let P=no([i,s&&s.toAbortSignal()],o),l;const E=P&&P.unsubscribe&&(()=>{P.unsubscribe()});let R;try{if(h&&lo&&n!=="get"&&n!=="head"&&(R=await co(w,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),c;if(W.isFormData(t)&&(c=f.headers.get("content-type"))&&w.setContentType(c),f.body){const[u,a]=pn(R,lt(gn(h)));t=mn(f.body,yn,u,a)}}W.isString(S)||(S=S?"include":"omit");const x="credentials"in Request.prototype;l=new Request(e,{...A,signal:P,method:n.toUpperCase(),headers:w.normalize().toJSON(),body:t,duplex:"half",credentials:x?S:void 0});let C=await fetch(l,A);const b=Wt&&(p==="stream"||p==="response");if(Wt&&(g||b&&E)){const f={};["status","statusText","headers"].forEach(v=>{f[v]=C[v]});const c=W.toFiniteNumber(C.headers.get("content-length")),[u,a]=g&&pn(c,lt(gn(g),!0))||[];C=new Response(mn(C.body,yn,u,()=>{a&&a(),E&&E()}),f)}p=p||"text";let T=await ut[W.findKey(ut,p)||"text"](C,r);return!b&&E&&E(),await new Promise((f,c)=>{ur(f,c,{data:T,headers:Ce.from(C.headers),status:C.status,statusText:C.statusText,config:r,request:l})})}catch(x){throw E&&E(),x&&x.name==="TypeError"&&/Load failed|fetch/i.test(x.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,r,l),{cause:x.cause||x}):te.from(x,x&&x.code,r,l)}}),qt={http:Ei,xhr:to,fetch:fo};W.forEach(qt,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const bn=r=>`- ${r}`,ho=r=>W.isFunction(r)||r===null||r===!1,pr={getAdapter:r=>{r=W.isArray(r)?r:[r];const{length:e}=r;let n,t;const i={};for(let s=0;s<e;s++){n=r[s];let o;if(t=n,!ho(n)&&(t=qt[(o=String(n)).toLowerCase()],t===void 0))throw new te(`Unknown adapter '${o}'`);if(t)break;i[o||"#"+s]=t}if(!t){const s=Object.entries(i).map(([g,h])=>`adapter ${g} `+(h===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(bn).join(`
`):" "+bn(s[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return t},adapters:qt};function Lt(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Ve(null,r)}function On(r){return Lt(r),r.headers=Ce.from(r.headers),r.data=Mt.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),pr.getAdapter(r.adapter||Xe.adapter)(r).then(function(t){return Lt(r),t.data=Mt.call(r,r.transformResponse,t),t.headers=Ce.from(t.headers),t},function(t){return lr(t)||(Lt(r),t&&t.response&&(t.response.data=Mt.call(r,r.transformResponse,t.response),t.response.headers=Ce.from(t.response.headers))),Promise.reject(t)})}const gr="1.10.0",wt={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{wt[r]=function(t){return typeof t===r||"a"+(e<1?"n ":" ")+r}});const Cn={};wt.transitional=function(e,n,t){function i(s,o){return"[Axios v"+gr+"] Transitional option '"+s+"'"+o+(t?". "+t:"")}return(s,o,g)=>{if(e===!1)throw new te(i(o," has been removed"+(n?" in "+n:"")),te.ERR_DEPRECATED);return n&&!Cn[o]&&(Cn[o]=!0,console.warn(i(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(s,o,g):!0}};wt.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function po(r,e,n){if(typeof r!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const t=Object.keys(r);let i=t.length;for(;i-- >0;){const s=t[i],o=e[s];if(o){const g=r[s],h=g===void 0||o(g,s,r);if(h!==!0)throw new te("option "+s+" must be "+h,te.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new te("Unknown option "+s,te.ERR_BAD_OPTION)}}const st={assertOptions:po,validators:wt},Ie=st.validators;let je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new dn,response:new dn}}async request(e,n){try{return await this._request(e,n)}catch(t){if(t instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{t.stack?s&&!String(t.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+s):t.stack=s}catch{}}throw t}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Ue(this.defaults,n);const{transitional:t,paramsSerializer:i,headers:s}=n;t!==void 0&&st.assertOptions(t,{silentJSONParsing:Ie.transitional(Ie.boolean),forcedJSONParsing:Ie.transitional(Ie.boolean),clarifyTimeoutError:Ie.transitional(Ie.boolean)},!1),i!=null&&(W.isFunction(i)?n.paramsSerializer={serialize:i}:st.assertOptions(i,{encode:Ie.function,serialize:Ie.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),st.assertOptions(n,{baseUrl:Ie.spelling("baseURL"),withXsrfToken:Ie.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=s&&W.merge(s.common,s[n.method]);s&&W.forEach(["delete","get","head","post","put","patch","common"],l=>{delete s[l]}),n.headers=Ce.concat(o,s);const g=[];let h=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(n)===!1||(h=h&&E.synchronous,g.unshift(E.fulfilled,E.rejected))});const p=[];this.interceptors.response.forEach(function(E){p.push(E.fulfilled,E.rejected)});let w,S=0,A;if(!h){const l=[On.bind(this),void 0];for(l.unshift.apply(l,g),l.push.apply(l,p),A=l.length,w=Promise.resolve(n);S<A;)w=w.then(l[S++],l[S++]);return w}A=g.length;let P=n;for(S=0;S<A;){const l=g[S++],E=g[S++];try{P=l(P)}catch(R){E.call(this,R);break}}try{w=On.call(this,P)}catch(l){return Promise.reject(l)}for(S=0,A=p.length;S<A;)w=w.then(p[S++],p[S++]);return w}getUri(e){e=Ue(this.defaults,e);const n=cr(e.baseURL,e.url,e.allowAbsoluteUrls);return or(n,e.params,e.paramsSerializer)}};W.forEach(["delete","get","head","options"],function(e){je.prototype[e]=function(n,t){return this.request(Ue(t||{},{method:e,url:n,data:(t||{}).data}))}});W.forEach(["post","put","patch"],function(e){function n(t){return function(s,o,g){return this.request(Ue(g||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}je.prototype[e]=n(),je.prototype[e+"Form"]=n(!0)});let go=class vr{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const t=this;this.promise.then(i=>{if(!t._listeners)return;let s=t._listeners.length;for(;s-- >0;)t._listeners[s](i);t._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(g=>{t.subscribe(g),s=g}).then(i);return o.cancel=function(){t.unsubscribe(s)},o},e(function(s,o,g){t.reason||(t.reason=new Ve(s,o,g),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=t=>{e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new vr(function(i){e=i}),cancel:e}}};function vo(r){return function(n){return r.apply(null,n)}}function mo(r){return W.isObject(r)&&r.isAxiosError===!0}const Kt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Kt).forEach(([r,e])=>{Kt[e]=r});function mr(r){const e=new je(r),n=qn(je.prototype.request,e);return W.extend(n,je.prototype,e,{allOwnKeys:!0}),W.extend(n,e,null,{allOwnKeys:!0}),n.create=function(i){return mr(Ue(r,i))},n}const ue=mr(Xe);ue.Axios=je;ue.CanceledError=Ve;ue.CancelToken=go;ue.isCancel=lr;ue.VERSION=gr;ue.toFormData=Ot;ue.AxiosError=te;ue.Cancel=ue.CanceledError;ue.all=function(e){return Promise.all(e)};ue.spread=vo;ue.isAxiosError=mo;ue.mergeConfig=Ue;ue.AxiosHeaders=Ce;ue.formToJSON=r=>ar(W.isHTMLForm(r)?new FormData(r):r);ue.getAdapter=pr.getAdapter;ue.HttpStatusCode=Kt;ue.default=ue;const{Axios:al,AxiosError:ll,CanceledError:ul,isCancel:cl,CancelToken:fl,VERSION:dl,all:hl,Cancel:pl,isAxiosError:gl,spread:vl,toFormData:ml,AxiosHeaders:yl,HttpStatusCode:bl,formToJSON:Ol,getAdapter:Cl,mergeConfig:wl}=ue;function yo(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function he(r,e,n){return e=He(e),Oo(r,yr()?Reflect.construct(e,n||[],He(r).constructor):e.apply(r,n))}function se(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function bo(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,Ao(t.key),t)}}function ae(r,e,n){return e&&bo(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ae(){return Ae=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)({}).hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r},Ae.apply(null,arguments)}function Jt(){return Jt=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,n){var t=Co(r,e);if(t){var i=Object.getOwnPropertyDescriptor(t,e);return i.get?i.get.call(arguments.length<3?r:n):i.value}},Jt.apply(null,arguments)}function He(r){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},He(r)}function pe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&Qt(r,e)}function yr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yr=function(){return!!r})()}function Oo(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yo(r)}function Me(){Me=function(){return e};var r,e={},n=Object.prototype,t=n.hasOwnProperty,i=Object.defineProperty||function(m,O,k){m[O]=k.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",g=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function p(m,O,k){return Object.defineProperty(m,O,{value:k,enumerable:!0,configurable:!0,writable:!0}),m[O]}try{p({},"")}catch{p=function(O,k,j){return O[k]=j}}function w(m,O,k,j){var B=O&&O.prototype instanceof x?O:x,$=Object.create(B.prototype),V=new L(j||[]);return i($,"_invoke",{value:d(m,k,V)}),$}function S(m,O,k){try{return{type:"normal",arg:m.call(O,k)}}catch(j){return{type:"throw",arg:j}}}e.wrap=w;var A="suspendedStart",P="suspendedYield",l="executing",E="completed",R={};function x(){}function C(){}function b(){}var T={};p(T,o,function(){return this});var f=Object.getPrototypeOf,c=f&&f(f(I([])));c&&c!==n&&t.call(c,o)&&(T=c);var u=b.prototype=x.prototype=Object.create(T);function a(m){["next","throw","return"].forEach(function(O){p(m,O,function(k){return this._invoke(O,k)})})}function v(m,O){function k(B,$,V,H){var M=S(m[B],m,$);if(M.type!=="throw"){var _=M.arg,U=_.value;return U&&typeof U=="object"&&t.call(U,"__await")?O.resolve(U.__await).then(function(F){k("next",F,V,H)},function(F){k("throw",F,V,H)}):O.resolve(U).then(function(F){_.value=F,V(_)},function(F){return k("throw",F,V,H)})}H(M.arg)}var j;i(this,"_invoke",{value:function(B,$){function V(){return new O(function(H,M){k(B,$,H,M)})}return j=j?j.then(V,V):V()}})}function d(m,O,k){var j=A;return function(B,$){if(j===l)throw Error("Generator is already running");if(j===E){if(B==="throw")throw $;return{value:r,done:!0}}for(k.method=B,k.arg=$;;){var V=k.delegate;if(V){var H=y(V,k);if(H){if(H===R)continue;return H}}if(k.method==="next")k.sent=k._sent=k.arg;else if(k.method==="throw"){if(j===A)throw j=E,k.arg;k.dispatchException(k.arg)}else k.method==="return"&&k.abrupt("return",k.arg);j=l;var M=S(m,O,k);if(M.type==="normal"){if(j=k.done?E:P,M.arg===R)continue;return{value:M.arg,done:k.done}}M.type==="throw"&&(j=E,k.method="throw",k.arg=M.arg)}}}function y(m,O){var k=O.method,j=m.iterator[k];if(j===r)return O.delegate=null,k==="throw"&&m.iterator.return&&(O.method="return",O.arg=r,y(m,O),O.method==="throw")||k!=="return"&&(O.method="throw",O.arg=new TypeError("The iterator does not provide a '"+k+"' method")),R;var B=S(j,m.iterator,O.arg);if(B.type==="throw")return O.method="throw",O.arg=B.arg,O.delegate=null,R;var $=B.arg;return $?$.done?(O[m.resultName]=$.value,O.next=m.nextLoc,O.method!=="return"&&(O.method="next",O.arg=r),O.delegate=null,R):$:(O.method="throw",O.arg=new TypeError("iterator result is not an object"),O.delegate=null,R)}function N(m){var O={tryLoc:m[0]};1 in m&&(O.catchLoc=m[1]),2 in m&&(O.finallyLoc=m[2],O.afterLoc=m[3]),this.tryEntries.push(O)}function D(m){var O=m.completion||{};O.type="normal",delete O.arg,m.completion=O}function L(m){this.tryEntries=[{tryLoc:"root"}],m.forEach(N,this),this.reset(!0)}function I(m){if(m||m===""){var O=m[o];if(O)return O.call(m);if(typeof m.next=="function")return m;if(!isNaN(m.length)){var k=-1,j=function B(){for(;++k<m.length;)if(t.call(m,k))return B.value=m[k],B.done=!1,B;return B.value=r,B.done=!0,B};return j.next=j}}throw new TypeError(typeof m+" is not iterable")}return C.prototype=b,i(u,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:C,configurable:!0}),C.displayName=p(b,h,"GeneratorFunction"),e.isGeneratorFunction=function(m){var O=typeof m=="function"&&m.constructor;return!!O&&(O===C||(O.displayName||O.name)==="GeneratorFunction")},e.mark=function(m){return Object.setPrototypeOf?Object.setPrototypeOf(m,b):(m.__proto__=b,p(m,h,"GeneratorFunction")),m.prototype=Object.create(u),m},e.awrap=function(m){return{__await:m}},a(v.prototype),p(v.prototype,g,function(){return this}),e.AsyncIterator=v,e.async=function(m,O,k,j,B){B===void 0&&(B=Promise);var $=new v(w(m,O,k,j),B);return e.isGeneratorFunction(O)?$:$.next().then(function(V){return V.done?V.value:$.next()})},a(u),p(u,h,"Generator"),p(u,o,function(){return this}),p(u,"toString",function(){return"[object Generator]"}),e.keys=function(m){var O=Object(m),k=[];for(var j in O)k.push(j);return k.reverse(),function B(){for(;k.length;){var $=k.pop();if($ in O)return B.value=$,B.done=!1,B}return B.done=!0,B}},e.values=I,L.prototype={constructor:L,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(D),!m)for(var O in this)O.charAt(0)==="t"&&t.call(this,O)&&!isNaN(+O.slice(1))&&(this[O]=r)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var O=this;function k(M,_){return $.type="throw",$.arg=m,O.next=M,_&&(O.method="next",O.arg=r),!!_}for(var j=this.tryEntries.length-1;j>=0;--j){var B=this.tryEntries[j],$=B.completion;if(B.tryLoc==="root")return k("end");if(B.tryLoc<=this.prev){var V=t.call(B,"catchLoc"),H=t.call(B,"finallyLoc");if(V&&H){if(this.prev<B.catchLoc)return k(B.catchLoc,!0);if(this.prev<B.finallyLoc)return k(B.finallyLoc)}else if(V){if(this.prev<B.catchLoc)return k(B.catchLoc,!0)}else{if(!H)throw Error("try statement without catch or finally");if(this.prev<B.finallyLoc)return k(B.finallyLoc)}}}},abrupt:function(m,O){for(var k=this.tryEntries.length-1;k>=0;--k){var j=this.tryEntries[k];if(j.tryLoc<=this.prev&&t.call(j,"finallyLoc")&&this.prev<j.finallyLoc){var B=j;break}}B&&(m==="break"||m==="continue")&&B.tryLoc<=O&&O<=B.finallyLoc&&(B=null);var $=B?B.completion:{};return $.type=m,$.arg=O,B?(this.method="next",this.next=B.finallyLoc,R):this.complete($)},complete:function(m,O){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&O&&(this.next=O),R},finish:function(m){for(var O=this.tryEntries.length-1;O>=0;--O){var k=this.tryEntries[O];if(k.finallyLoc===m)return this.complete(k.completion,k.afterLoc),D(k),R}},catch:function(m){for(var O=this.tryEntries.length-1;O>=0;--O){var k=this.tryEntries[O];if(k.tryLoc===m){var j=k.completion;if(j.type==="throw"){var B=j.arg;D(k)}return B}}throw Error("illegal catch attempt")},delegateYield:function(m,O,k){return this.delegate={iterator:I(m),resultName:O,nextLoc:k},this.method==="next"&&(this.arg=r),R}},e}function Qt(r,e){return Qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},Qt(r,e)}function Co(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=He(r))!==null;);return r}function wo(r,e,n,t){var i=Jt(He(r.prototype),e,n);return typeof i=="function"?function(s){return i.apply(n,s)}:i}function So(r,e){if(typeof r!="object"||!r)return r;var n=r[Symbol.toPrimitive];if(n!==void 0){var t=n.call(r,e);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Ao(r){var e=So(r,"string");return typeof e=="symbol"?e:e+""}function Ke(r){"@babel/helpers - typeof";return Ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(r)}var St=function(){function r(){se(this,r)}return ae(r,[{key:"listenForWhisper",value:function(n,t){return this.listen(".client-"+n,t)}},{key:"notification",value:function(n){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",n)}},{key:"stopListeningForWhisper",value:function(n,t){return this.stopListening(".client-"+n,t)}}])}();function ct(r,e){var n={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.indexOf(t)<0&&(n[t]=r[t]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,t=Object.getOwnPropertySymbols(r);i<t.length;i++)e.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(r,t[i])&&(n[t[i]]=r[t[i]]);return n}function ft(r,e,n,t){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function g(w){try{p(t.next(w))}catch(S){o(S)}}function h(w){try{p(t.throw(w))}catch(S){o(S)}}function p(w){w.done?s(w.value):i(w.value).then(g,h)}p((t=t.apply(r,[])).next())})}var nn=function(){function r(e){se(this,r),this.namespace=e}return ae(r,[{key:"format",value:function(n){return[".","\\"].includes(n.charAt(0))?n.substring(1):(this.namespace&&(n=this.namespace+"."+n),n.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(n){this.namespace=n}}])}(),rn=function(r){function e(n,t,i){var s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return se(this,e),s=he(this,e),s._alertErrorListeners=function(g){g&&s.errorListeners.forEach(function(h){return h(g)})},s.name=t,s.ably=n,s.options=i,s.eventFormatter=new nn(s.options.namespace),s.subscribedListeners=[],s.errorListeners=[],s.channel=n.channels.get(t),s.callbacks=new Map,o&&s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){var t=this;this.channel.on(function(i){var s=i.previous,o=i.current,g=i.reason;s!=="attached"&&o=="attached"?t.subscribedListeners.forEach(function(h){return h()}):g&&t._alertErrorListeners(i)}),this.channel.attach(this._alertErrorListeners)}},{key:"unsubscribe",value:function(){this.channel.unsubscribe(),this.callbacks.clear(),this.unregisterError(),this.unregisterSubscribed(),this.channel.off(),this.channel.detach()}},{key:"listen",value:function(t,i){return this.callbacks.set(i,function(s){var o=s.data,g=ct(s,["data"]);return i(o,g)}),this.channel.subscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this}},{key:"listenToAll",value:function(t){var i=this;return this.callbacks.set(t,function(s){var o=s.name,g=s.data,h=ct(s,["name","data"]),p=i.options.namespace.replace(/\./g,"\\"),w=o.startsWith(p)?o.substring(p.length+1):"."+o;t(w,g,h)}),this.channel.subscribe(this.callbacks.get(t)),this}},{key:"stopListening",value:function(t,i){return i?(this.channel.unsubscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this.callbacks.delete(i)):this.channel.unsubscribe(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?(this.channel.unsubscribe(this.callbacks.get(t)),this.callbacks.delete(t)):this.channel.unsubscribe(),this}},{key:"subscribed",value:function(t){return this.subscribedListeners.push(t),this}},{key:"error",value:function(t){return this.errorListeners.push(t),this}},{key:"unregisterSubscribed",value:function(t){return t?this.subscribedListeners=this.subscribedListeners.filter(function(i){return i!=t}):this.subscribedListeners=[],this}},{key:"unregisterError",value:function(t){return t?this.errorListeners=this.errorListeners.filter(function(i){return i!=t}):this.errorListeners=[],this}}])}(St),Eo=function(r){function e(n,t,i,s){var o;return se(this,e),o=he(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.subscribe(),o}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(rn),br=function(r){function e(n,t,i,s){var o;return se(this,e),o=he(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.channel.on("attached",function(){return o.enter(o.presenceData,o._alertErrorListeners)}),o.subscribe(),o}return pe(e,r),ae(e,[{key:"unsubscribe",value:function(){this.leave(this.presenceData,this._alertErrorListeners),this.channel.presence.unsubscribe(),wo(e,"unsubscribe",this)([])}},{key:"here",value:function(t){var i=this;return this.channel.presence.subscribe(["enter","update","leave"],function(){return i.channel.presence.get(function(s,o){return t(o.map(function(g){var h=g.data;return h}),s)})}),this}},{key:"joining",value:function(t){return this.channel.presence.subscribe(["enter","update"],function(i){var s=i.data,o=ct(i,["data"]);t(s,o)}),this}},{key:"leaving",value:function(t){return this.channel.presence.subscribe("leave",function(i){var s=i.data,o=ct(i,["data"]);t(s,o)}),this}},{key:"enter",value:function(t,i){return this.channel.presence.enter(t,i),this}},{key:"leave",value:function(t,i){return this.channel.presence.leave(t,i),this}},{key:"update",value:function(t,i){return this.channel.presence.update(t,i),this}},{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(rn),Ro=function(e){return e==null||e===void 0},Or=function(e){var n=e.split(".")[0],t=n.replace("-","+").replace("_","/"),i=JSON.parse(wn(t)),s=e.split(".")[1],o=s.replace("-","+").replace("_","/"),g=JSON.parse(wn(o));return{header:i,payload:g}},kt=function(e){var n=Or(e),t=n.payload;return{clientId:t["x-ably-clientId"],expires:t.exp*1e3,issued:t.iat*1e3,token:e}},At=(typeof window>"u"?"undefined":Ke(window))==="object",wn=function(e){var n=e.replace(/-/g,"+").replace(/_/g,"/"),t=e.length%4===0?"":"=".repeat(4-e.length%4),i=n+t;return At?atob(i):Buffer.from(i,"base64").toString()},To=function(e){var n="";return At?n=btoa(e):n=Buffer.from(e).toString("base64"),n.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},Io=function(e){return e&&e.indexOf("http://")===0||e.indexOf("https://")===0},xo=function(e){var n,t,i;if(!Io(e)&&typeof window<"u"){var s=(n=window==null?void 0:window.location)===null||n===void 0?void 0:n.hostname,o=(t=window==null?void 0:window.location)===null||t===void 0?void 0:t.port,g=(i=window==null?void 0:window.location)===null||i===void 0?void 0:i.protocol.replace(":","");if(s&&o&&g)return g+"://"+s+":"+o+e}return e},Dt;function Po(r,e){Dt||(Dt=new Ably.Rest.Platform.Http),At?delete r.headers["Content-Length"]:r.method=r.method.toLowerCase(),Dt.doUri(r.method,null,r.uri,r.headers,r.body,r.paramsIfNoHeaders||{},e)}var Mo=function(e){return new Promise(function(n,t){Po(e,function(i,s){if(i)t(i);else if(typeof s=="string")n(JSON.parse(s));else if(!At&&Buffer.isBuffer(s))try{n(JSON.parse(s.toString()))}catch{n(s)}else n(s)})})},Sn=!1,Lo=function(e,n){var t=e.channels.get("dummy");if(t.__proto__.authorizeChannel=n,Sn)return;var i=t.__proto__._attach;if(Ro(i)){console.warn("Failed to enable authorize for pre-attach, please check for right library version");return}function s(o,g,h){var p=this;if(!this.authorizing){this.authorizing=!0;var w=i.bind(this);this.authorizeChannel(this,function(S){if(p.authorizing=!1,S){h?h(S):console.error("channel ".concat(p.name," auth error => ").concat(S));return}else w(o,g,h)})}}t.__proto__._attach=s,Sn=!0},ko=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;se(this,r),this.execute=function(i){return new Promise(function(s,o){e.queue.run(function(){return ft(e,void 0,void 0,Me().mark(function g(){var h,p,w;return Me().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,i(this.cachedToken);case 3:h=A.sent,p=h.token,w=h.info,this.cachedToken=p,s({token:p,info:w}),A.next=13;break;case 10:A.prev=10,A.t0=A.catch(0),o(A.t0);case 13:case"end":return A.stop()}},g,this,[[0,10]])}))})})},this.request=function(i){return e.execute(function(s){return e.requestTokenFn(i,s)})},this.cachedToken=n,this.requestTokenFn=t,this.queue=new Do}),Do=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;se(this,r),this.canRunNext=function(){return e.running.length<e.count&&e.todo.length},this.run=function(i){return ft(e,void 0,void 0,Me().mark(function s(){var o;return Me().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:i&&this.todo.push(i);case 1:if(!this.canRunNext()){h.next=9;break}return o=this.todo.shift(),this.running.push(o),h.next=6,o();case 6:this.running.shift(),h.next=1;break;case 9:case"end":return h.stop()}},s,this)}))},this.total=n.length,this.todo=n,this.running=[],this.count=t}),No=ae(function r(e,n){var t=this;se(this,r),this.expiredAuthChannels=new Set,this.setExpired=function(h){return t.expiredAuthChannels.add(h)},this.isExpired=function(h){return t.expiredAuthChannels.has(h)},this.removeExpired=function(h){return t.expiredAuthChannels.delete(h)},this.options={queryTime:!0,useTokenAuth:!0,authCallback:function(p,w){return ft(t,void 0,void 0,Me().mark(function S(){var A,P,l;return Me().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.prev=0,R.next=3,this.authRequestExecuter.request(null);case 3:A=R.sent,P=A.token,l=kt(P),w(null,l),R.next=12;break;case 9:R.prev=9,R.t0=R.catch(0),w(R.t0,null);case 12:case"end":return R.stop()}},S,this,[[0,9]])}))},echoMessages:!1},this.requestToken=function(h,p){return ft(t,void 0,void 0,Me().mark(function w(){var S,A;return Me().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return S=JSON.stringify({channel_name:h,token:p}),A={uri:this.authEndpoint,method:"POST",headers:Ae({Accept:"application/json","Content-Type":"application/json","Content-Length":S.length},this.authHeaders),body:S},l.next=4,Mo(A);case 4:return l.abrupt("return",l.sent);case 5:case"end":return l.stop()}},w,this)}))},this.ablyClient=function(){return t.ablyConnector.ably},this.existingToken=function(){return t.ablyClient().auth.tokenDetails},this.getChannel=function(h){return t.ablyConnector.channels[h]},this.enableAuthorizeBeforeChannelAttach=function(){var h=t.ablyClient();h.auth.getTimestamp(t.options.queryTime,function(){}),Lo(h,function(p,w){var S=p.name;if(S.startsWith("public:")){w(null);return}var A=t.existingToken();if(A&&!t.isExpired(S)){var P=Or(A.token).payload["x-ably-capability"],l=P.includes("".concat(S,'"'));if(l&&A.expires>h.auth.getTimestampUsingOffset()){w(null);return}}t.authRequestExecuter.request(S).then(function(E){var R=E.token,x=E.info,C=t.getChannel(S);t.setPresenceInfo(C,x),t.tryAuthorizeOnSameConnection(Ae(Ae({},t.options),{token:kt(R)}),function(b,T){b?w(b):(t.removeExpired(S),w(null))})}).catch(function(E){return w(E)})})},this.allowReconnectOnUserLogin=function(){var h=t.ablyClient().connection,p=function(S){S.reason.code==40102&&(h.off(p),console.warn("User login detected, re-connecting again!"),t.onClientIdChanged())};h.on("failed",p)},this.onClientIdChanged=function(){t.ablyClient().connect();for(var h=0,p=Object.values(t.ablyConnector.channels);h<p.length;h++){var w=p[h];w.channel.attach(w._alertErrorListeners)}},this.tryAuthorizeOnSameConnection=function(h,p){t.ablyClient().auth.authorize(null,h,p)},this.onChannelFailed=function(h){return function(p){var w;((w=p.reason)===null||w===void 0?void 0:w.code)==40160&&t.handleChannelAuthError(h)}},this.handleChannelAuthError=function(h){if(!h.skipAuth){var p=h.name;t.authRequestExecuter.request(p).then(function(w){var S=w.token,A=w.info;t.setPresenceInfo(h,A),t.tryAuthorizeOnSameConnection(Ae(Ae({},t.options),{token:kt(S)}),function(P,l){P?h._alertErrorListeners(P):(h.skipAuth=!0,h.channel.once("attached",function(){h.skipAuth=!1}),h.channel.attach(h._alertErrorListeners))})}).catch(function(w){return h._alertErrorListeners(w)})}},this.setPresenceInfo=function(h,p){h instanceof br&&(h.presenceData=p)},this.ablyConnector=e;var i=n.authEndpoint,s=n.auth.headers,o=n.token,g=n.requestTokenFn;this.authEndpoint=xo(i),this.authHeaders=s,this.authRequestExecuter=new ko(o,g??this.requestToken)}),Et=function(r){function e(n,t,i){var s;return se(this,e),s=he(this,e),s.name=t,s.pusher=n,s.options=i,s.eventFormatter=new nn(s.options.namespace),s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"listenToAll",value:function(t){var i=this;return this.subscription.bind_global(function(s,o){if(!s.startsWith("pusher:")){var g=i.options.namespace.replace(/\./g,"\\"),h=s.startsWith(g)?s.substring(g.length+1):"."+s;t(h,o)}}),this}},{key:"stopListening",value:function(t,i){return i?this.subscription.unbind(this.eventFormatter.format(t),i):this.subscription.unbind(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?this.subscription.unbind_global(t):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(t){return this.on("pusher:subscription_succeeded",function(){t()}),this}},{key:"error",value:function(t){return this.on("pusher:subscription_error",function(i){t(i)}),this}},{key:"on",value:function(t,i){return this.subscription.bind(t,i),this}}])}(St),_o=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(Et),jo=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(Et),Uo=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this.on("pusher:subscription_succeeded",function(i){t(Object.keys(i.members).map(function(s){return i.members[s]}))}),this}},{key:"joining",value:function(t){return this.on("pusher:member_added",function(i){t(i.info)}),this}},{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}},{key:"leaving",value:function(t){return this.on("pusher:member_removed",function(i){t(i.info)}),this}}])}(Et),Cr=function(r){function e(n,t,i){var s;return se(this,e),s=he(this,e),s.events={},s.listeners={},s.name=t,s.socket=n,s.options=i,s.eventFormatter=new nn(s.options.namespace),s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"stopListening",value:function(t,i){return this.unbindEvent(this.eventFormatter.format(t),i),this}},{key:"subscribed",value:function(t){return this.on("connect",function(i){t(i)}),this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){var s=this;return this.listeners[t]=this.listeners[t]||[],this.events[t]||(this.events[t]=function(o,g){s.name===o&&s.listeners[t]&&s.listeners[t].forEach(function(h){return h(g)})},this.socket.on(t,this.events[t])),this.listeners[t].push(i),this}},{key:"unbind",value:function(){var t=this;Object.keys(this.events).forEach(function(i){t.unbindEvent(i)})}},{key:"unbindEvent",value:function(t,i){this.listeners[t]=this.listeners[t]||[],i&&(this.listeners[t]=this.listeners[t].filter(function(s){return s!==i})),(!i||this.listeners[t].length===0)&&(this.events[t]&&(this.socket.removeListener(t,this.events[t]),delete this.events[t]),delete this.listeners[t])}}])}(St),wr=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}}])}(Cr),Bo=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this.on("presence:subscribed",function(i){t(i.map(function(s){return s.user_info}))}),this}},{key:"joining",value:function(t){return this.on("presence:joining",function(i){return t(i.user_info)}),this}},{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}},{key:"leaving",value:function(t){return this.on("presence:leaving",function(i){return t(i.user_info)}),this}}])}(wr),dt=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(t,i){return this}},{key:"listenToAll",value:function(t){return this}},{key:"stopListening",value:function(t,i){return this}},{key:"subscribed",value:function(t){return this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){return this}}])}(St),An=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this}}])}(dt),Fo=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this}},{key:"joining",value:function(t){return this}},{key:"whisper",value:function(t,i){return this}},{key:"leaving",value:function(t){return this}}])}(dt),Rt=function(){function r(e){se(this,r),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(e),this.connect()}return ae(r,[{key:"setOptions",value:function(n){this.options=Ae(this._defaultOptions,n);var t=this.csrfToken();return t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),t=this.options.bearerToken,t&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t),n}},{key:"csrfToken",value:function(){var n;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(n=document.querySelector('meta[name="csrf-token"]'))?n.getAttribute("content"):null}}])}(),En=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new Et(this.pusher,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new _o(this.pusher,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"encryptedPrivateChannel",value:function(t){return this.channels["private-encrypted-"+t]||(this.channels["private-encrypted-"+t]=new jo(this.pusher,"private-encrypted-"+t,this.options)),this.channels["private-encrypted-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new Uo(this.pusher,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"private-encrypted-"+t,"presence-"+t];s.forEach(function(o,g){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}])}(Rt),Ho=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){var t=this,i=this.getSocketIO();return this.socket=i(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(t.channels).forEach(function(s){s.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new Cr(this.socket,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new wr(this.socket,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new Bo(this.socket,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"presence-"+t];s.forEach(function(o){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}])}(Rt),Go=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){}},{key:"listen",value:function(t,i,s){return new dt}},{key:"channel",value:function(t){return new dt}},{key:"privateChannel",value:function(t){return new An}},{key:"encryptedPrivateChannel",value:function(t){return new An}},{key:"presenceChannel",value:function(t){return new Fo}},{key:"leave",value:function(t){}},{key:"leaveChannel",value:function(t){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}])}(Rt),Sr=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.ably=this.options.client:(this.ablyAuth=new No(this,this.options),this.options.agents||(this.options.agents={}),this.options.agents["laravel-echo"]=e.LIB_VERSION,this.ably=new Ably.Realtime(Ae(Ae({},this.ablyAuth.options),this.options)),this.ablyAuth.enableAuthorizeBeforeChannelAttach(),this.ablyAuth.allowReconnectOnUserLogin())}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){var i="public:".concat(t);return this.channels[i]||(this.channels[i]=new rn(this.ably,i,this.options)),this.channels[i]}},{key:"privateChannel",value:function(t){var i="private:".concat(t);return this.channels[i]||(this.channels[i]=new Eo(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"presenceChannel",value:function(t){var i="presence:".concat(t);return this.channels[i]||(this.channels[i]=new br(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"leave",value:function(t){var i=this,s=["public:".concat(t),"private:".concat(t),"presence:".concat(t)];s.forEach(function(o,g){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){if(t.indexOf("public:")!==0&&t.indexOf("private:")!==0&&t.indexOf("presence:")!==0)throw new Error("Error leaving ".concat(t,', name should be prefixed with either "public:", "private:" or "presence:"'));this.channels[t]&&(this.channels[t].unsubscribe(),this.ablyAuth.setExpired(t),delete this.channels[t])}},{key:"socketId",value:function(){var t,i={connectionKey:this.ably.connection.key,clientId:(t=this.ably.auth.clientId)!==null&&t!==void 0?t:null};return To(JSON.stringify(i))}},{key:"disconnect",value:function(){this.ably.close()}}])}(Rt);Sr.LIB_VERSION="1.0.6";var $o=function(){function r(e){se(this,r),this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return ae(r,[{key:"channel",value:function(n){return this.connector.channel(n)}},{key:"connect",value:function(){if(this.options.broadcaster=="ably")this.connector=new Sr(this.options);else if(this.options.broadcaster=="reverb")this.connector=new En(Ae(Ae({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new En(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new Ho(this.options);else if(this.options.broadcaster=="null")this.connector=new Go(this.options);else if(typeof this.options.broadcaster=="function")this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(Ke(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(n){return this.connector.presenceChannel(n)}},{key:"leave",value:function(n){this.connector.leave(n)}},{key:"leaveChannel",value:function(n){this.connector.leaveChannel(n)}},{key:"leaveAllChannels",value:function(){for(var n in this.connector.channels)this.leaveChannel(n)}},{key:"listen",value:function(n,t,i){return this.connector.listen(n,t,i)}},{key:"private",value:function(n){return this.connector.privateChannel(n)}},{key:"encryptedPrivate",value:function(n){return this.connector.encryptedPrivateChannel(n)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":Ke(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var n=this;Vue.http.interceptors.push(function(t,i){n.socketId()&&t.headers.set("X-Socket-ID",n.socketId()),i()})}},{key:"registerAxiosRequestInterceptor",value:function(){var n=this;axios.interceptors.request.use(function(t){return n.socketId()&&(t.headers["X-Socket-Id"]=n.socketId()),t})}},{key:"registerjQueryAjaxSetup",value:function(){var n=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(t,i,s){n.socketId()&&s.setRequestHeader("X-Socket-Id",n.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var n=this;document.addEventListener("turbo:before-fetch-request",function(t){t.detail.fetchOptions.headers["X-Socket-Id"]=n.socketId()})}}])}(),on=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sn(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ar={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(r,e){(function(t,i){r.exports=i()})(window,function(){return function(n){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=t,i.d=function(s,o,g){i.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:g})},i.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,o){if(o&1&&(s=i(s)),o&8||o&4&&typeof s=="object"&&s&&s.__esModule)return s;var g=Object.create(null);if(i.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:s}),o&2&&typeof s!="string")for(var h in s)i.d(g,h,(function(p){return s[p]}).bind(null,h));return g},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=42)}([function(n,t,i){i.r(t),i.d(t,"__extends",function(){return o}),i.d(t,"__assign",function(){return g}),i.d(t,"__rest",function(){return h}),i.d(t,"__decorate",function(){return p}),i.d(t,"__param",function(){return w}),i.d(t,"__metadata",function(){return S}),i.d(t,"__awaiter",function(){return A}),i.d(t,"__generator",function(){return P}),i.d(t,"__createBinding",function(){return l}),i.d(t,"__exportStar",function(){return E}),i.d(t,"__values",function(){return R}),i.d(t,"__read",function(){return x}),i.d(t,"__spread",function(){return C}),i.d(t,"__spreadArrays",function(){return b}),i.d(t,"__spreadArray",function(){return T}),i.d(t,"__await",function(){return f}),i.d(t,"__asyncGenerator",function(){return c}),i.d(t,"__asyncDelegator",function(){return u}),i.d(t,"__asyncValues",function(){return a}),i.d(t,"__makeTemplateObject",function(){return v}),i.d(t,"__importStar",function(){return y}),i.d(t,"__importDefault",function(){return N}),i.d(t,"__classPrivateFieldGet",function(){return D}),i.d(t,"__classPrivateFieldSet",function(){return L});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var s=function(I,m){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(O,k){O.__proto__=k}||function(O,k){for(var j in k)Object.prototype.hasOwnProperty.call(k,j)&&(O[j]=k[j])},s(I,m)};function o(I,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");s(I,m);function O(){this.constructor=I}I.prototype=m===null?Object.create(m):(O.prototype=m.prototype,new O)}var g=function(){return g=Object.assign||function(m){for(var O,k=1,j=arguments.length;k<j;k++){O=arguments[k];for(var B in O)Object.prototype.hasOwnProperty.call(O,B)&&(m[B]=O[B])}return m},g.apply(this,arguments)};function h(I,m){var O={};for(var k in I)Object.prototype.hasOwnProperty.call(I,k)&&m.indexOf(k)<0&&(O[k]=I[k]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var j=0,k=Object.getOwnPropertySymbols(I);j<k.length;j++)m.indexOf(k[j])<0&&Object.prototype.propertyIsEnumerable.call(I,k[j])&&(O[k[j]]=I[k[j]]);return O}function p(I,m,O,k){var j=arguments.length,B=j<3?m:k===null?k=Object.getOwnPropertyDescriptor(m,O):k,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(I,m,O,k);else for(var V=I.length-1;V>=0;V--)($=I[V])&&(B=(j<3?$(B):j>3?$(m,O,B):$(m,O))||B);return j>3&&B&&Object.defineProperty(m,O,B),B}function w(I,m){return function(O,k){m(O,k,I)}}function S(I,m){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(I,m)}function A(I,m,O,k){function j(B){return B instanceof O?B:new O(function($){$(B)})}return new(O||(O=Promise))(function(B,$){function V(_){try{M(k.next(_))}catch(U){$(U)}}function H(_){try{M(k.throw(_))}catch(U){$(U)}}function M(_){_.done?B(_.value):j(_.value).then(V,H)}M((k=k.apply(I,m||[])).next())})}function P(I,m){var O={label:0,sent:function(){if(B[0]&1)throw B[1];return B[1]},trys:[],ops:[]},k,j,B,$;return $={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function V(M){return function(_){return H([M,_])}}function H(M){if(k)throw new TypeError("Generator is already executing.");for(;O;)try{if(k=1,j&&(B=M[0]&2?j.return:M[0]?j.throw||((B=j.return)&&B.call(j),0):j.next)&&!(B=B.call(j,M[1])).done)return B;switch(j=0,B&&(M=[M[0]&2,B.value]),M[0]){case 0:case 1:B=M;break;case 4:return O.label++,{value:M[1],done:!1};case 5:O.label++,j=M[1],M=[0];continue;case 7:M=O.ops.pop(),O.trys.pop();continue;default:if(B=O.trys,!(B=B.length>0&&B[B.length-1])&&(M[0]===6||M[0]===2)){O=0;continue}if(M[0]===3&&(!B||M[1]>B[0]&&M[1]<B[3])){O.label=M[1];break}if(M[0]===6&&O.label<B[1]){O.label=B[1],B=M;break}if(B&&O.label<B[2]){O.label=B[2],O.ops.push(M);break}B[2]&&O.ops.pop(),O.trys.pop();continue}M=m.call(I,O)}catch(_){M=[6,_],j=0}finally{k=B=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}}var l=Object.create?function(I,m,O,k){k===void 0&&(k=O),Object.defineProperty(I,k,{enumerable:!0,get:function(){return m[O]}})}:function(I,m,O,k){k===void 0&&(k=O),I[k]=m[O]};function E(I,m){for(var O in I)O!=="default"&&!Object.prototype.hasOwnProperty.call(m,O)&&l(m,I,O)}function R(I){var m=typeof Symbol=="function"&&Symbol.iterator,O=m&&I[m],k=0;if(O)return O.call(I);if(I&&typeof I.length=="number")return{next:function(){return I&&k>=I.length&&(I=void 0),{value:I&&I[k++],done:!I}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(I,m){var O=typeof Symbol=="function"&&I[Symbol.iterator];if(!O)return I;var k=O.call(I),j,B=[],$;try{for(;(m===void 0||m-- >0)&&!(j=k.next()).done;)B.push(j.value)}catch(V){$={error:V}}finally{try{j&&!j.done&&(O=k.return)&&O.call(k)}finally{if($)throw $.error}}return B}function C(){for(var I=[],m=0;m<arguments.length;m++)I=I.concat(x(arguments[m]));return I}function b(){for(var I=0,m=0,O=arguments.length;m<O;m++)I+=arguments[m].length;for(var k=Array(I),j=0,m=0;m<O;m++)for(var B=arguments[m],$=0,V=B.length;$<V;$++,j++)k[j]=B[$];return k}function T(I,m,O){if(O||arguments.length===2)for(var k=0,j=m.length,B;k<j;k++)(B||!(k in m))&&(B||(B=Array.prototype.slice.call(m,0,k)),B[k]=m[k]);return I.concat(B||Array.prototype.slice.call(m))}function f(I){return this instanceof f?(this.v=I,this):new f(I)}function c(I,m,O){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var k=O.apply(I,m||[]),j,B=[];return j={},$("next"),$("throw"),$("return"),j[Symbol.asyncIterator]=function(){return this},j;function $(F){k[F]&&(j[F]=function(z){return new Promise(function(J,Q){B.push([F,z,J,Q])>1||V(F,z)})})}function V(F,z){try{H(k[F](z))}catch(J){U(B[0][3],J)}}function H(F){F.value instanceof f?Promise.resolve(F.value.v).then(M,_):U(B[0][2],F)}function M(F){V("next",F)}function _(F){V("throw",F)}function U(F,z){F(z),B.shift(),B.length&&V(B[0][0],B[0][1])}}function u(I){var m,O;return m={},k("next"),k("throw",function(j){throw j}),k("return"),m[Symbol.iterator]=function(){return this},m;function k(j,B){m[j]=I[j]?function($){return(O=!O)?{value:f(I[j]($)),done:j==="return"}:B?B($):$}:B}}function a(I){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=I[Symbol.asyncIterator],O;return m?m.call(I):(I=typeof R=="function"?R(I):I[Symbol.iterator](),O={},k("next"),k("throw"),k("return"),O[Symbol.asyncIterator]=function(){return this},O);function k(B){O[B]=I[B]&&function($){return new Promise(function(V,H){$=I[B]($),j(V,H,$.done,$.value)})}}function j(B,$,V,H){Promise.resolve(H).then(function(M){B({value:M,done:V})},$)}}function v(I,m){return Object.defineProperty?Object.defineProperty(I,"raw",{value:m}):I.raw=m,I}var d=Object.create?function(I,m){Object.defineProperty(I,"default",{enumerable:!0,value:m})}:function(I,m){I.default=m};function y(I){if(I&&I.__esModule)return I;var m={};if(I!=null)for(var O in I)O!=="default"&&Object.prototype.hasOwnProperty.call(I,O)&&l(m,I,O);return d(m,I),m}function N(I){return I&&I.__esModule?I:{default:I}}function D(I,m,O,k){if(O==="a"&&!k)throw new TypeError("Private accessor was defined without a getter");if(typeof m=="function"?I!==m||!k:!m.has(I))throw new TypeError("Cannot read private member from an object whose class did not declare it");return O==="m"?k:O==="a"?k.call(I):k?k.value:m.get(I)}function L(I,m,O,k,j){if(k==="m")throw new TypeError("Private method is not writable");if(k==="a"&&!j)throw new TypeError("Private accessor was defined without a setter");if(typeof m=="function"?I!==m||!j:!m.has(I))throw new TypeError("Cannot write private member to an object whose class did not declare it");return k==="a"?j.call(I,O):j?j.value=O:m.set(I,O),O}},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.allToUpperCase=t.allToLowerCase=t.encodeBody=t.decodeBody=t.Format=t.promisify=t.trim=t.arrChooseN=t.randomHexString=t.randomString=t.cheapRandStr=t.dataSizeBytes=t.inspectBody=t.inspectError=t.isErrorInfoOrPartialErrorInfo=t.now=t.parseQueryString=t.toQueryString=t.arrPopRandomElement=t.defaultPostHeaders=t.defaultGetHeaders=t.allSame=t.arrEvery=t.arrFilter=t.arrMap=t.safeArrForEach=t.arrForEach=t.forInOwnNonNullProperties=t.valuesArray=t.keysArray=t.arrWithoutValue=t.arrDeleteValue=t.arrIn=t.arrIndexOf=t.arrSubtract=t.arrIntersectOb=t.arrIntersect=t.intersect=t.containsValue=t.inherits=t.prototypicalClone=t.shallowClone=t.isEmptyArg=t.isOnlyPropIn=t.isEmpty=t.isObject=t.ensureArray=t.isArray=t.copy=t.mixin=void 0,t.arrEquals=t.toBase64=t.matchDerivedChannel=t.shallowEquals=t.getGlobalObject=t.getRetryTime=t.getJitterCoefficient=t.getBackoffCoefficient=void 0;var o=i(0),g=o.__importDefault(i(3)),h=o.__importStar(i(8)),p=o.__importDefault(i(4)),w=i(11),S=i(31);function A(G){return Math.floor(Math.random()*G.length)}function P(G){for(var q=[],K=1;K<arguments.length;K++)q[K-1]=arguments[K];for(var Z=0;Z<q.length;Z++){var ne=q[Z];if(!ne)break;var be=Object.prototype.hasOwnProperty;for(var ze in ne)(!be||be.call(ne,ze))&&(G[ze]=ne[ze])}return G}t.mixin=P;function l(G){return P({},G)}t.copy=l,t.isArray=Array.isArray||function(G){return Object.prototype.toString.call(G)=="[object Array]"};function E(G){return b(G)?[]:(0,t.isArray)(G)?G:[G]}t.ensureArray=E;function R(G){return Object.prototype.toString.call(G)=="[object Object]"}t.isObject=R;function x(G){for(var q in G)return!1;return!0}t.isEmpty=x;function C(G,q){for(var K in G)if(K!==q)return!1;return!0}t.isOnlyPropIn=C;function b(G){return G==null}t.isEmptyArg=b;function T(G){var q=new Object;for(var K in G)q[K]=G[K];return q}t.shallowClone=T;function f(G,q){var K=function(){function ne(){}return ne}();K.prototype=G;var Z=new K;return q&&P(Z,q),Z}t.prototypicalClone=f;var c=function(G,q){if(g.default.Config.inherits){g.default.Config.inherits(G,q);return}G.super_=q,G.prototype=f(q.prototype,{constructor:G})};t.inherits=c;function u(G,q){for(var K in G)if(G[K]==q)return!0;return!1}t.containsValue=u;function a(G,q){return(0,t.isArray)(q)?v(G,q):d(G,q)}t.intersect=a;function v(G,q){for(var K=[],Z=0;Z<G.length;Z++){var ne=G[Z];(0,t.arrIndexOf)(q,ne)!=-1&&K.push(ne)}return K}t.arrIntersect=v;function d(G,q){for(var K=[],Z=0;Z<G.length;Z++){var ne=G[Z];ne in q&&K.push(ne)}return K}t.arrIntersectOb=d;function y(G,q){for(var K=[],Z=0;Z<G.length;Z++){var ne=G[Z];(0,t.arrIndexOf)(q,ne)==-1&&K.push(ne)}return K}t.arrSubtract=y,t.arrIndexOf=Array.prototype.indexOf?function(G,q,K){return G.indexOf(q,K)}:function(G,q,K){K=K||0;for(var Z=G.length;K<Z;K++)if(G[K]===q)return K;return-1};function N(G,q){return(0,t.arrIndexOf)(G,q)!==-1}t.arrIn=N;function D(G,q){var K=(0,t.arrIndexOf)(G,q),Z=K!=-1;return Z&&G.splice(K,1),Z}t.arrDeleteValue=D;function L(G,q){var K=G.slice();return D(K,q),K}t.arrWithoutValue=L;function I(G,q){var K=[];for(var Z in G)q&&!Object.prototype.hasOwnProperty.call(G,Z)||K.push(Z);return K}t.keysArray=I;function m(G,q){var K=[];for(var Z in G)q&&!Object.prototype.hasOwnProperty.call(G,Z)||K.push(G[Z]);return K}t.valuesArray=m;function O(G,q){for(var K in G)Object.prototype.hasOwnProperty.call(G,K)&&G[K]&&q(K)}t.forInOwnNonNullProperties=O,t.arrForEach=Array.prototype.forEach?function(G,q){G.forEach(q)}:function(G,q){for(var K=G.length,Z=0;Z<K;Z++)q(G[Z],Z,G)};function k(G,q){return(0,t.arrForEach)(G.slice(),q)}t.safeArrForEach=k,t.arrMap=Array.prototype.map?function(G,q){return G.map(q)}:function(G,q){for(var K=[],Z=G.length,ne=0;ne<Z;ne++)K.push(q(G[ne],ne,G));return K},t.arrFilter=Array.prototype.filter?function(G,q){return G.filter(q)}:function(G,q){for(var K=[],Z=G.length,ne=0;ne<Z;ne++)q(G[ne])&&K.push(G[ne]);return K},t.arrEvery=Array.prototype.every?function(G,q){return G.every(q)}:function(G,q){for(var K=G.length,Z=0;Z<K;Z++)if(!q(G[Z],Z,G))return!1;return!0};function j(G,q){if(G.length===0)return!0;var K=G[0][q];return(0,t.arrEvery)(G,function(Z){return Z[q]===K})}t.allSame=j;var B={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function $(G,q){var K=B[q||ie.json];return{accept:K,"X-Ably-Version":h.default.protocolVersion.toString(),"Ably-Agent":(0,h.getAgentString)(G)}}t.defaultGetHeaders=$;function V(G,q){var K,Z=K=B[q||ie.json];return{accept:Z,"content-type":K,"X-Ably-Version":h.default.protocolVersion.toString(),"Ably-Agent":(0,h.getAgentString)(G)}}t.defaultPostHeaders=V;function H(G){return G.splice(A(G),1)[0]}t.arrPopRandomElement=H;function M(G){var q=[];if(G)for(var K in G)q.push(encodeURIComponent(K)+"="+encodeURIComponent(G[K]));return q.length?"?"+q.join("&"):""}t.toQueryString=M;function _(G){for(var q,K=/([^?&=]+)=?([^&]*)/g,Z={};q=K.exec(G);)Z[decodeURIComponent(q[1])]=decodeURIComponent(q[2]);return Z}t.parseQueryString=_,t.now=Date.now||function(){return new Date().getTime()};function U(G){return typeof G=="object"&&G!==null&&(G.constructor.name=="ErrorInfo"||G.constructor.name=="PartialErrorInfo")}t.isErrorInfoOrPartialErrorInfo=U;function F(G){var q,K;return G instanceof Error||((q=G==null?void 0:G.constructor)===null||q===void 0?void 0:q.name)==="ErrorInfo"||((K=G==null?void 0:G.constructor)===null||K===void 0?void 0:K.name)==="PartialErrorInfo"?G.toString():g.default.Config.inspect(G)}t.inspectError=F;function z(G){return g.default.BufferUtils.isBuffer(G)?G.toString():typeof G=="string"?G:g.default.Config.inspect(G)}t.inspectBody=z;function J(G){if(g.default.BufferUtils.isBuffer(G))return g.default.BufferUtils.byteLength(G);if(typeof G=="string")return g.default.Config.stringByteSize(G);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof G)}t.dataSizeBytes=J;function Q(){return String(Math.random()).substr(2)}t.cheapRandStr=Q;var Y=function(G){if(g.default.Config.getRandomValues&&typeof Uint8Array<"u"){var q=new Uint8Array(G);return g.default.Config.getRandomValues(q),g.default.BufferUtils.base64Encode(q)}for(var K=g.default.BufferUtils.base64CharSet,Z=Math.round(G*4/3),ne="",be=0;be<Z;be++)ne+=K[A(K)];return ne};t.randomString=Y;var ee=function(G){if(g.default.Config.getRandomValues&&typeof Uint8Array<"u"){var q=new Uint8Array(G);return g.default.Config.getRandomValues(q),g.default.BufferUtils.hexEncode(q)}for(var K=g.default.BufferUtils.hexCharSet,Z=G*2,ne="",be=0;be<Z;be++)ne+=K[A(K)];return ne};t.randomHexString=ee;function re(G,q){for(var K=Math.min(q,G.length),Z=G.slice(),ne=[],be=0;be<K;be++)ne.push(H(Z));return ne}t.arrChooseN=re,t.trim=String.prototype.trim?function(G){return G.trim()}:function(G){return G.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function X(G,q,K){return new Promise(function(Z,ne){G[q].apply(G,o.__spreadArray(o.__spreadArray([],K,!1),[function(be,ze){be?ne(be):Z(ze)}],!1))})}t.promisify=X;var ie;(function(G){G.msgpack="msgpack",G.json="json"})(ie=t.Format||(t.Format={}));function fe(G,q){return q=="msgpack"?g.default.Config.msgpack.decode(G):JSON.parse(String(G))}t.decodeBody=fe;function ve(G,q){return q=="msgpack"?g.default.Config.msgpack.encode(G,!0):JSON.stringify(G)}t.encodeBody=ve;function ce(G){return G.map(function(q){return q&&q.toLowerCase()})}t.allToLowerCase=ce;function Pe(G){return G.map(function(q){return q&&q.toUpperCase()})}t.allToUpperCase=Pe;function Ye(G){return Math.min((G+2)/3,2)}t.getBackoffCoefficient=Ye;function Ee(){return 1-Math.random()*.2}t.getJitterCoefficient=Ee;function Ze(G,q){return G*Ye(q)*Ee()}t.getRetryTime=Ze;function It(){return s||(typeof window<"u"?window:self)}t.getGlobalObject=It;function xt(G,q){return Object.keys(G).every(function(K){return G[K]===q[K]})&&Object.keys(q).every(function(K){return q[K]===G[K]})}t.shallowEquals=xt;function _r(G){var q=/^(\[([^?]*)(?:(.*))\])?(.+)$/,K=G.match(q);if(!K||!K.length||K.length<5)throw new p.default("regex match failed",400,40010);if(K[2])throw new p.default("cannot use a derived option with a ".concat(K[2]," channel"),400,40010);return{qualifierParam:K[3]||"",channelName:K[4]}}t.matchDerivedChannel=_r;function jr(G){return g.default.Config.createHmac?Buffer.from(G,"ascii").toString("base64"):(0,w.stringify)((0,S.parse)(G))}t.toBase64=jr;function Ur(G,q){return G.length===q.length&&(0,t.arrEvery)(G,function(K,Z){return K===q[Z]})}t.arrEquals=Ur}).call(this,i(13))},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),g=o.__importDefault(i(3)),h=s||(typeof window<"u"?window:self),p;(function(l){l[l.None=0]="None",l[l.Error=1]="Error",l[l.Major=2]="Major",l[l.Minor=3]="Minor",l[l.Micro=4]="Micro"})(p||(p={}));function w(l,E){return"".concat(l).padStart(E?3:2,"0")}function S(l){return g.default.Config.logTimestamps?function(E){var R=new Date;l(w(R.getHours())+":"+w(R.getMinutes())+":"+w(R.getSeconds())+"."+w(R.getMilliseconds(),1)+" "+E)}:l}var A=function(){var l,E,R,x;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((E=(l=h==null?void 0:h.console)===null||l===void 0?void 0:l.log)===null||E===void 0?void 0:E.apply)=="function"?(R=function(){for(var C=[],b=0;b<arguments.length;b++)C[b]=arguments[b];console.log.apply(console,C)},x=console.warn?function(){for(var C=[],b=0;b<arguments.length;b++)C[b]=arguments[b];console.warn.apply(console,C)}:R):h!=null&&h.console.log?R=x=function(){Function.prototype.apply.call(console.log,console,arguments)}:R=x=function(){},[R,x].map(S)},P=function(){function l(){l.logLevel=l.LOG_DEFAULT}return l.initLogHandlers=function(){var E=A(),R=E[0],x=E[1];this.logHandler=R,this.logErrorHandler=x},l.renamedClientOption=function(E,R){l.deprecationWarning("The `".concat(E,"` client option has been renamed to `").concat(R,"`. Please update your code to use `").concat(R,"` instead. `").concat(E,"` will be removed in a future version."))},l.renamedMethod=function(E,R,x){l.deprecationWarning("`".concat(E,"`s `").concat(R,"` method has been renamed to `").concat(x,"`. Please update your code to use `").concat(x,"` instead. `").concat(R,"` will be removed in a future version."))},l.deprecationWarning=function(E){l.shouldLog(p.Error)&&l.logErrorHandler("Ably: Deprecation warning - ".concat(E))},l.logLevel=p.Error,l.LOG_NONE=p.None,l.LOG_ERROR=p.Error,l.LOG_MAJOR=p.Major,l.LOG_MINOR=p.Minor,l.LOG_MICRO=p.Micro,l.LOG_DEFAULT=p.Error,l.LOG_DEBUG=p.Micro,l.logAction=function(E,R,x){l.shouldLog(E)&&(E===p.Error?l.logErrorHandler:l.logHandler)("Ably: "+R+": "+x)},l.deprecated=function(E,R){l.deprecationWarning("".concat(E," is deprecated and will be removed in a future version. ").concat(R))},l.shouldLog=function(E){return E<=l.logLevel},l.setLog=function(E,R){E!==void 0&&(l.logLevel=E),R!==void 0&&(l.logHandler=l.logErrorHandler=R)},l}();t.default=P}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(){}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartialErrorInfo=void 0;var s=i(0),o=s.__importDefault(i(3)),g=s.__importStar(i(1));function h(S){var A="["+S.constructor.name;return S.message&&(A+=": "+S.message),S.statusCode&&(A+="; statusCode="+S.statusCode),S.code&&(A+="; code="+S.code),S.cause&&(A+="; cause="+g.inspectError(S.cause)),S.href&&!(S.message&&S.message.indexOf("help.ably.io")>-1)&&(A+="; see "+S.href+" "),A+="]",A}var p=function(S){s.__extends(A,S);function A(P,l,E,R){var x=S.call(this,P)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(x,A.prototype),x.code=l,x.statusCode=E,x.cause=R,x}return A.prototype.toString=function(){return h(this)},A.fromValues=function(P){var l=P,E=l.message,R=l.code,x=l.statusCode;if(typeof E!="string"||typeof R!="number"||typeof x!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(P));var C=Object.assign(new A(E,R,x),P);return C.code&&!C.href&&(C.href="https://help.ably.io/error/"+C.code),C},A}(Error);t.default=p;var w=function(S){s.__extends(A,S);function A(P,l,E,R){var x=S.call(this,P)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(x,A.prototype),x.code=l,x.statusCode=E,x.cause=R,x}return A.prototype.toString=function(){return h(this)},A}(Error);t.PartialErrorInfo=w},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var o=s,g=o.lib,h=g.WordArray,p=h.init,w=h.init=function(S){if(S instanceof ArrayBuffer&&(S=new Uint8Array(S)),(S instanceof Int8Array||typeof Uint8ClampedArray<"u"&&S instanceof Uint8ClampedArray||S instanceof Int16Array||S instanceof Uint16Array||S instanceof Int32Array||S instanceof Uint32Array||S instanceof Float32Array||S instanceof Float64Array)&&(S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength)),S instanceof Uint8Array){for(var A=S.byteLength,P=[],l=0;l<A;l++)P[l>>>2]|=S[l]<<24-l%4*8;p.call(this,P,A)}else p.apply(this,arguments)};w.prototype=h}}(),s.lib.WordArray})},function(n,t,i){(function(s){(function(o,g){n.exports=g()})(this,function(){var o=o||function(g,h){var p;if(typeof window<"u"&&window.crypto&&(p=window.crypto),!p&&typeof window<"u"&&window.msCrypto&&(p=window.msCrypto),!p&&typeof s<"u"&&s.crypto&&(p=s.crypto),!p)try{p=i(44)}catch{}var w=function(){if(p){if(typeof p.getRandomValues=="function")try{return p.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof p.randomBytes=="function")try{return p.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},S=Object.create||function(){function c(){}return function(u){var a;return c.prototype=u,a=new c,c.prototype=null,a}}(),A={},P=A.lib={},l=P.Base=function(){return{extend:function(c){var u=S(this);return c&&u.mixIn(c),(!u.hasOwnProperty("init")||this.init===u.init)&&(u.init=function(){u.$super.init.apply(this,arguments)}),u.init.prototype=u,u.$super=this,u},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var u in c)c.hasOwnProperty(u)&&(this[u]=c[u]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),E=P.WordArray=l.extend({init:function(c,u){c=this.words=c||[],u!=h?this.sigBytes=u:this.sigBytes=c.length*4},toString:function(c){return(c||x).stringify(this)},concat:function(c){var u=this.words,a=c.words,v=this.sigBytes,d=c.sigBytes;if(this.clamp(),v%4)for(var y=0;y<d;y++){var N=a[y>>>2]>>>24-y%4*8&255;u[v+y>>>2]|=N<<24-(v+y)%4*8}else for(var y=0;y<d;y+=4)u[v+y>>>2]=a[y>>>2];return this.sigBytes+=d,this},clamp:function(){var c=this.words,u=this.sigBytes;c[u>>>2]&=4294967295<<32-u%4*8,c.length=g.ceil(u/4)},clone:function(){var c=l.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var u=[],a=0;a<c;a+=4)u.push(w());return new E.init(u,c)}}),R=A.enc={},x=R.Hex={stringify:function(c){for(var u=c.words,a=c.sigBytes,v=[],d=0;d<a;d++){var y=u[d>>>2]>>>24-d%4*8&255;v.push((y>>>4).toString(16)),v.push((y&15).toString(16))}return v.join("")},parse:function(c){for(var u=c.length,a=[],v=0;v<u;v+=2)a[v>>>3]|=parseInt(c.substr(v,2),16)<<24-v%8*4;return new E.init(a,u/2)}},C=R.Latin1={stringify:function(c){for(var u=c.words,a=c.sigBytes,v=[],d=0;d<a;d++){var y=u[d>>>2]>>>24-d%4*8&255;v.push(String.fromCharCode(y))}return v.join("")},parse:function(c){for(var u=c.length,a=[],v=0;v<u;v++)a[v>>>2]|=(c.charCodeAt(v)&255)<<24-v%4*8;return new E.init(a,u)}},b=R.Utf8={stringify:function(c){try{return decodeURIComponent(escape(C.stringify(c)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(c){return C.parse(unescape(encodeURIComponent(c)))}},T=P.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new E.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=b.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var u,a=this._data,v=a.words,d=a.sigBytes,y=this.blockSize,N=y*4,D=d/N;c?D=g.ceil(D):D=g.max((D|0)-this._minBufferSize,0);var L=D*y,I=g.min(L*4,d);if(L){for(var m=0;m<L;m+=y)this._doProcessBlock(v,m);u=v.splice(0,L),a.sigBytes-=I}return new E.init(u,I)},clone:function(){var c=l.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});P.Hasher=T.extend({cfg:l.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){c&&this._append(c);var u=this._doFinalize();return u},blockSize:16,_createHelper:function(c){return function(u,a){return new c.init(a).finalize(u)}},_createHmacHelper:function(c){return function(u,a){return new f.HMAC.init(c,a).finalize(u)}}});var f=A.algo={};return A}(Math);return o})}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(2)),h=s.__importDefault(i(3));function p(A,P,l){try{P.apply(A,l)}catch(E){g.default.logAction(g.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+E+"; stack = "+(E&&E.stack))}}function w(A,P,l){for(var E,R,x,C=0;C<A.length;C++)if(E=A[C],l&&(E=E[l]),o.isArray(E)){for(;(R=o.arrIndexOf(E,P))!==-1;)E.splice(R,1);l&&E.length===0&&delete A[C][l]}else if(o.isObject(E))for(x in E)Object.prototype.hasOwnProperty.call(E,x)&&o.isArray(E[x])&&w([E],P,x)}var S=function(){function A(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return A.prototype.on=function(){for(var P=this,l=[],E=0;E<arguments.length;E++)l[E]=arguments[E];if(l.length===1){var R=l[0];if(typeof R=="function")this.any.push(R);else throw new Error("EventListener.on(): Invalid arguments: "+h.default.Config.inspect(l))}if(l.length===2){var x=l[0],C=l[1];if(typeof C!="function")throw new Error("EventListener.on(): Invalid arguments: "+h.default.Config.inspect(l));if(o.isEmptyArg(x))this.any.push(C);else if(o.isArray(x))x.forEach(function(T){P.on(T,C)});else{if(typeof x!="string")throw new Error("EventListener.on(): Invalid arguments: "+h.default.Config.inspect(l));var b=this.events[x]||(this.events[x]=[]);b.push(C)}}},A.prototype.off=function(){for(var P,l=this,E=[],R=0;R<arguments.length;R++)E[R]=arguments[R];if(E.length==0||o.isEmptyArg(E[0])&&o.isEmptyArg(E[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var x=E[0],C=E[1],b=null,T=null;if(E.length===1||!C)typeof x=="function"?b=x:T=x;else{if(typeof C!="function")throw new Error("EventEmitter.off(): invalid arguments:"+h.default.Config.inspect(E));P=[x,C],T=P[0],b=P[1]}if(b&&o.isEmptyArg(T)){w([this.any,this.events,this.anyOnce,this.eventsOnce],b);return}if(o.isArray(T)){T.forEach(function(f){l.off(f,b)});return}if(typeof T!="string")throw new Error("EventEmitter.off(): invalid arguments:"+h.default.Config.inspect(E));b?w([this.events,this.eventsOnce],b,T):(delete this.events[T],delete this.eventsOnce[T])},A.prototype.listeners=function(P){if(P){var l=this.events[P]||[];return this.eventsOnce[P]&&Array.prototype.push.apply(l,this.eventsOnce[P]),l.length?l:null}return this.any.length?this.any:null},A.prototype.emit=function(P){for(var l=[],E=1;E<arguments.length;E++)l[E-1]=arguments[E];var R={event:P},x=[];this.anyOnce.length&&(Array.prototype.push.apply(x,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(x,this.any);var C=this.eventsOnce[P];C&&(Array.prototype.push.apply(x,C),delete this.eventsOnce[P]);var b=this.events[P];b&&Array.prototype.push.apply(x,b),o.arrForEach(x,function(T){p(R,T,l)})},A.prototype.once=function(){for(var P=this,l=[],E=0;E<arguments.length;E++)l[E]=arguments[E];var R=l.length;if((R===0||R===1&&typeof l[0]!="function")&&h.default.Config.Promise){var x=l[0];return new h.default.Config.Promise(function(u){P.once(x,u)})}var C=l[0],b=l[1];if(l.length===1&&typeof C=="function")this.anyOnce.push(C);else if(o.isEmptyArg(C)){if(typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+h.default.Config.inspect(l));this.anyOnce.push(b)}else if(o.isArray(C)){var T=this,f=function(){var u=Array.prototype.slice.call(arguments);if(o.arrForEach(C,function(a){T.off(a,f)}),typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+h.default.Config.inspect(l));b.apply(this,u)};o.arrForEach(C,function(u){T.on(u,f)})}else{if(typeof C!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+h.default.Config.inspect(l));var c=this.eventsOnce[C]||(this.eventsOnce[C]=[]);if(b){if(typeof b!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+h.default.Config.inspect(l));c.push(b)}}},A.prototype.whenState=function(P,l,E){for(var R=this,x=[],C=3;C<arguments.length;C++)x[C-3]=arguments[C];var b={event:P};if(typeof P!="string"||typeof l!="string")throw"whenState requires a valid event String argument";if(typeof E!="function"&&h.default.Config.Promise)return new h.default.Config.Promise(function(T){A.prototype.whenState.apply(R,[P,l,T].concat(x))});P===l?p(b,E,x):this.once(P,E)},A}();t.default=S},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaults=t.normaliseOptions=t.objectifyOptions=t.getAgentString=t.getHosts=t.getFallbackHosts=t.environmentFallbackHosts=t.getHttpScheme=t.getPort=t.getHost=void 0;var s=i(0),o=s.__importDefault(i(3)),g=s.__importStar(i(1)),h=s.__importDefault(i(2)),p=s.__importDefault(i(4)),w=i(43),S="ably-js/"+w.version,A={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:w.version,protocolVersion:2,agent:S,getHost:P,getPort:l,getHttpScheme:E,environmentFallbackHosts:R,getFallbackHosts:x,getHosts:C,checkHost:b,objectifyOptions:u,normaliseOptions:a};function P(d,y,N){return N?y=y==d.restHost&&d.realtimeHost||y||d.realtimeHost:y=y||d.restHost,y}t.getHost=P;function l(d,y){return y||d.tls?d.tlsPort:d.port}t.getPort=l;function E(d){return d.tls?"https://":"http://"}t.getHttpScheme=E;function R(d){return[d+"-a-fallback.ably-realtime.com",d+"-b-fallback.ably-realtime.com",d+"-c-fallback.ably-realtime.com",d+"-d-fallback.ably-realtime.com",d+"-e-fallback.ably-realtime.com"]}t.environmentFallbackHosts=R;function x(d){var y=d.fallbackHosts,N=typeof d.httpMaxRetryCount<"u"?d.httpMaxRetryCount:A.httpMaxRetryCount;return y?g.arrChooseN(y,N):[]}t.getFallbackHosts=x;function C(d){return[d.restHost].concat(x(d))}t.getHosts=C;function b(d){if(typeof d!="string")throw new p.default("host must be a string; was a "+typeof d,4e4,400);if(!d.length)throw new p.default("host must not be zero-length",4e4,400)}function T(d,y,N){return d.realtimeHost?d.realtimeHost:d.restHost?(h.default.logAction(h.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+d.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+d.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),d.restHost):y?A.REALTIME_HOST:N+"-"+A.REALTIME_HOST}function f(d){var y={};for(var N in A.TIMEOUTS)y[N]=d[N]||A.TIMEOUTS[N];return y}function c(d){var y=A.agent;if(d.agents)for(var N in d.agents)y+=" "+N+"/"+d.agents[N];return y}t.getAgentString=c;function u(d){return typeof d=="string"?d.indexOf(":")==-1?{token:d}:{key:d}:d}t.objectifyOptions=u;function a(d){if(d.host&&(h.default.renamedClientOption("host","restHost"),d.restHost=d.host),d.wsHost&&(h.default.renamedClientOption("wsHost","realtimeHost"),d.realtimeHost=d.wsHost),d.queueEvents&&(h.default.renamedClientOption("queueEvents","queueMessages"),d.queueMessages=d.queueEvents),d.headers&&h.default.deprecated("the `headers` client option",""),d.fallbackHostsUseDefault){if(d.fallbackHosts){var y="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw h.default.logAction(h.default.LOG_ERROR,"Defaults.normaliseOptions",y),new p.default(y,4e4,400)}if(d.port||d.tlsPort){var y="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw h.default.logAction(h.default.LOG_ERROR,"Defaults.normaliseOptions",y),new p.default(y,4e4,400)}d.environment?h.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):h.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youre not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if youre using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),d.fallbackHosts=A.FALLBACK_HOSTS}d.recover===!0&&(h.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),d.recover=function(H,M){M(!0)}),typeof d.recover=="function"&&d.closeOnUnload===!0&&(h.default.logAction(h.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),d.recover=void 0),"closeOnUnload"in d||(d.closeOnUnload=!d.recover),d.transports&&g.arrIn(d.transports,"xhr")&&(h.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),g.arrDeleteValue(d.transports,"xhr"),d.transports.push("xhr_streaming")),"queueMessages"in d||(d.queueMessages=!0);var N=d.environment&&String(d.environment).toLowerCase()||A.ENVIRONMENT,D=!N||N==="production";!d.fallbackHosts&&!d.restHost&&!d.realtimeHost&&!d.port&&!d.tlsPort&&(d.fallbackHosts=D?A.FALLBACK_HOSTS:R(N));var L=d.restHost||(D?A.REST_HOST:N+"-"+A.REST_HOST),I=T(d,D,N);g.arrForEach((d.fallbackHosts||[]).concat(L,I),b),d.port=d.port||A.PORT,d.tlsPort=d.tlsPort||A.TLS_PORT,"tls"in d||(d.tls=!0);var m=f(d);if("useBinaryProtocol"in d?d.useBinaryProtocol=o.default.Config.supportsBinary&&d.useBinaryProtocol:d.useBinaryProtocol=o.default.Config.preferBinary,d.clientId){var O=d.headers=d.headers||{};O["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(d.clientId))}"idempotentRestPublishing"in d||(d.idempotentRestPublishing=!0),d.promises&&!o.default.Config.Promise&&(h.default.logAction(h.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),d.promises=!1);var k=null,j=d.connectivityCheckUrl;if(d.connectivityCheckUrl){var B=d.connectivityCheckUrl.split("?"),$=B[0],V=B[1];k=V?g.parseQueryString(V):{},$.indexOf("://")===-1&&($="https://"+$),j=$}return s.__assign(s.__assign({},d),{useBinaryProtocol:"useBinaryProtocol"in d?o.default.Config.supportsBinary&&d.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:I,restHost:L,maxMessageSize:d.maxMessageSize||A.maxMessageSize,timeouts:m,connectivityCheckParams:k,connectivityCheckUrl:j})}t.normaliseOptions=a,t.default=A;function v(d){return Object.assign(A,d)}t.getDefaults=v},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),g=s.__importDefault(i(2)),h=s.__importDefault(i(4)),p=s.__importStar(i(1));function w(l){return!l||!l.channelOptions?{channelOptions:l,plugins:{},baseEncodedPreviousPayload:void 0}:l}function S(l){if(l&&l.cipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var E=o.default.Crypto.getCipher(l.cipher);return{cipher:E.cipherParams,channelCipher:E.cipher}}return l??{}}function A(l){var E=0;return l.name&&(E+=l.name.length),l.clientId&&(E+=l.clientId.length),l.extras&&(E+=JSON.stringify(l.extras).length),l.data&&(E+=p.dataSizeBytes(l.data)),E}var P=function(){function l(){}return l.prototype.toJSON=function(){var E=this.encoding,R=this.data;return R&&o.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(E=E?E+"/base64":"base64",R=o.default.BufferUtils.base64Encode(R)):R=o.default.BufferUtils.toBuffer(R)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:E,data:R}},l.prototype.toString=function(){var E="[Message";return this.name&&(E+="; name="+this.name),this.id&&(E+="; id="+this.id),this.timestamp&&(E+="; timestamp="+this.timestamp),this.clientId&&(E+="; clientId="+this.clientId),this.connectionId&&(E+="; connectionId="+this.connectionId),this.encoding&&(E+="; encoding="+this.encoding),this.extras&&(E+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?E+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?E+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):E+="; data (json)="+JSON.stringify(this.data)),this.extras&&(E+="; extras="+JSON.stringify(this.extras)),E+="]",E},l.encrypt=function(E,R,x){var C=E.data,b=E.encoding,T=R.channelCipher;b=b?b+"/":"",o.default.BufferUtils.isBuffer(C)||(C=o.default.BufferUtils.utf8Encode(String(C)),b=b+"utf-8/"),T.encrypt(C,function(f,c){if(f){x(f);return}E.data=c,E.encoding=b+"cipher+"+T.algorithm,x(null,E)})},l.encode=function(E,R,x){var C=E.data,b=typeof C=="string"||o.default.BufferUtils.isBuffer(C)||C===null||C===void 0;if(!b)if(p.isObject(C)||p.isArray(C))E.data=JSON.stringify(C),E.encoding=E.encoding?E.encoding+"/json":"json";else throw new h.default("Data type is unsupported",40013,400);R!=null&&R.cipher?l.encrypt(E,R,x):x(null,E)},l.encodeArray=function(E,R,x){for(var C=0,b=0;b<E.length;b++)l.encode(E[b],R,function(T){if(T){x(T);return}C++,C==E.length&&x(null,E)})},l.decode=function(E,R){var x=w(R),C=E.data,b=E.encoding;if(b){var T=b.split("/"),f=void 0,c=T.length,u=E.data,a="";try{for(;(f=c)>0;){var v=T[--c].match(/([-\w]+)(\+([\w-]+))?/);if(!v)break;switch(a=v[1],a){case"base64":u=o.default.BufferUtils.base64Decode(String(u)),f==T.length&&(C=u);continue;case"utf-8":u=o.default.BufferUtils.utf8Decode(u);continue;case"json":u=JSON.parse(u);continue;case"cipher":if(x.channelOptions!=null&&x.channelOptions.cipher&&x.channelOptions.channelCipher){var d=v[3],y=x.channelOptions.channelCipher;if(d!=y.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");u=y.decrypt(u);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!x.plugins||!x.plugins.vcdiff)throw new h.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new h.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var N=x.baseEncodedPreviousPayload;typeof N=="string"&&(N=o.default.BufferUtils.utf8Encode(N)),N=o.default.BufferUtils.toBuffer(N),u=o.default.BufferUtils.toBuffer(u),u=o.default.BufferUtils.typedArrayToBuffer(x.plugins.vcdiff.decode(u,N)),C=u}catch(L){throw new h.default("Vcdiff delta decode failed with "+L,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(L){var D=L;throw new h.default("Error processing the "+a+" encoding, decoder returned "+D.message+"",D.code||40013,400)}finally{E.encoding=f<=0?null:T.slice(0,f).join("/"),E.data=u}}x.baseEncodedPreviousPayload=C},l.fromResponseBody=function(E,R,x){x&&(E=p.decodeBody(E,x));for(var C=0;C<E.length;C++){var b=E[C]=l.fromValues(E[C]);try{l.decode(b,R)}catch(T){g.default.logAction(g.default.LOG_ERROR,"Message.fromResponseBody()",T.toString())}}return E},l.fromValues=function(E){return Object.assign(new l,E)},l.fromValuesArray=function(E){for(var R=E.length,x=new Array(R),C=0;C<R;C++)x[C]=l.fromValues(E[C]);return x},l.fromEncoded=function(E,R){var x=l.fromValues(E),C=S(R??null);try{l.decode(x,C)}catch(b){g.default.logAction(g.default.LOG_ERROR,"Message.fromEncoded()",b.toString())}return x},l.fromEncodedArray=function(E,R){return E.map(function(x){return l.fromEncoded(x,R)})},l.getMessagesSize=function(E){for(var R,x=0,C=0;C<E.length;C++)R=E[C],x+=R.size||(R.size=A(R));return x},l.serialize=p.encodeBody,l}();t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(4)),h=s.__importDefault(i(9)),p=s.__importDefault(i(16)),w={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},S=[];Object.keys(w).forEach(function(x){S[w[x]]=x});var A={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},P=Object.keys(A);A.MODE_ALL=A.PRESENCE|A.PUBLISH|A.SUBSCRIBE|A.PRESENCE_SUBSCRIBE;function l(x){var C=[];if(x)for(var b=0;b<x.length;b++)C.push(x[b].toString());return"[ "+C.join(", ")+" ]"}var E="id channel channelSerial connectionId count msgSerial timestamp".split(" "),R=function(){function x(){var C=this;this.hasFlag=function(b){return(C.flags&A[b])>0}}return x.prototype.setFlag=function(C){return this.flags=this.flags|A[C]},x.prototype.getMode=function(){return this.flags&&this.flags&A.MODE_ALL},x.prototype.encodeModesToFlags=function(C){var b=this;C.forEach(function(T){return b.setFlag(T)})},x.prototype.decodeModesFromFlags=function(){var C=this,b=[];return x.channelModes.forEach(function(T){C.hasFlag(T)&&b.push(T)}),b.length>0?b:void 0},x.fromValues=function(C){return Object.assign(new x,C)},x.Action=w,x.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],x.ActionName=S,x.serialize=o.encodeBody,x.deserialize=function(C,b){var T=o.decodeBody(C,b);return x.fromDeserialized(T)},x.fromDeserialized=function(C){var b=C.error;b&&(C.error=g.default.fromValues(b));var T=C.messages;if(T)for(var f=0;f<T.length;f++)T[f]=h.default.fromValues(T[f]);var c=C.presence;if(c)for(var f=0;f<c.length;f++)c[f]=p.default.fromValues(c[f],!0);return Object.assign(new x,C)},x.stringify=function(C){var b="[ProtocolMessage";C.action!==void 0&&(b+="; action="+x.ActionName[C.action]||!1);for(var T,f=0;f<E.length;f++)T=E[f],C[T]!==void 0&&(b+="; "+T+"="+C[T]);if(C.messages&&(b+="; messages="+l(h.default.fromValuesArray(C.messages))),C.presence&&(b+="; presence="+l(p.default.fromValuesArray(C.presence))),C.error&&(b+="; error="+g.default.fromValues(C.error).toString()),C.auth&&C.auth.accessToken&&(b+="; token="+C.auth.accessToken),C.flags&&(b+="; flags="+P.filter(C.hasFlag).join(",")),C.params){var c="";o.forInOwnNonNullProperties(C.params,function(u){c.length>0&&(c+="; "),c+=u+"="+C.params[u]}),c.length>0&&(b+="; params=["+c+"]")}return b+="]",b},x}();t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,g=o.lib,h=g.WordArray,p=o.enc;p.Base64={stringify:function(S){var A=S.words,P=S.sigBytes,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";S.clamp();for(var E=[],R=0;R<P;R+=3)for(var x=A[R>>>2]>>>24-R%4*8&255,C=A[R+1>>>2]>>>24-(R+1)%4*8&255,b=A[R+2>>>2]>>>24-(R+2)%4*8&255,T=x<<16|C<<8|b,f=0;f<4&&R+f*.75<P;f++)E.push(l.charAt(T>>>6*(3-f)&63));var c=l.charAt(64);if(c)for(;E.length%4;)E.push(c);return E.join("")},parse:function(S){var A=S.length,P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=this._reverseMap;if(!l){l=this._reverseMap=[];for(var E=0;E<P.length;E++)l[P.charCodeAt(E)]=E}var R=P.charAt(64);if(R){var x=S.indexOf(R);x!==-1&&(A=x)}return w(S,A,l)}};function w(S,A,P){for(var l=[],E=0,R=0;R<A;R++)if(R%4){var x=P[S.charCodeAt(R-1)]<<R%4*2,C=P[S.charCodeAt(R)]>>>6-R%4*2,b=x|C;l[E>>>2]|=b<<24-E%4*8,E++}return h.create(l,E)}}(),s.enc.Base64})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(10)),h=s.__importDefault(i(26)),p=s.__importDefault(i(2)),w=s.__importDefault(i(8)),S=s.__importDefault(i(21)),A=s.__importDefault(i(18)),P=s.__importDefault(i(4)),l=s.__importDefault(i(22)),E=s.__importDefault(i(3));function R(b){var T=[80015,80017,80030];return b.code?A.default.isTokenErr(b)?!1:o.arrIn(T,b.code)?!0:b.code>=4e4&&b.code<5e4:!1}function x(b){return R(b)?[g.default.fromValues({action:g.default.Action.ERROR,error:b})]:[g.default.fromValues({action:g.default.Action.DISCONNECTED,error:b})]}var C=function(b){s.__extends(T,b);function T(f,c,u){var a=b.call(this,f,c,u,!0)||this;return a.onAuthUpdated=function(v){a.authParams={access_token:v.token}},a.stream="stream"in u?u.stream:!0,a.sendRequest=null,a.recvRequest=null,a.pendingCallback=null,a.pendingItems=null,a}return T.prototype.connect=function(){var f=this;p.default.logAction(p.default.LOG_MINOR,"CometTransport.connect()","starting"),h.default.prototype.connect.call(this);var c=this.params,u=c.options,a=w.default.getHost(u,c.host),v=w.default.getPort(u),d=u.tls?"https://":"http://";this.baseUri=d+a+":"+v+"/comet/";var y=this.baseUri+"connect";p.default.logAction(p.default.LOG_MINOR,"CometTransport.connect()","uri: "+y),this.auth.getAuthParams(function(N,D){if(N){f.disconnect(N);return}if(!f.isDisposed){f.authParams=D;var L=f.params.getConnectParams(D);"stream"in L&&(f.stream=L.stream),p.default.logAction(p.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(L));var I=!1,m=f.recvRequest=f.createRequest(y,null,L,null,f.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV);m.on("data",function(O){f.recvRequest&&(I||(I=!0,f.emit("preconnect")),f.onData(O))}),m.on("complete",function(O){if(f.recvRequest||(O=O||new P.default("Request cancelled",80003,400)),f.recvRequest=null,!I&&!O&&(I=!0,f.emit("preconnect")),f.onActivity(),O){O.code?f.onData(x(O)):f.disconnect(O);return}E.default.Config.nextTick(function(){f.recv()})}),m.exec()}})},T.prototype.requestClose=function(){p.default.logAction(p.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},T.prototype.requestDisconnect=function(){p.default.logAction(p.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},T.prototype._requestCloseOrDisconnect=function(f){var c=this,u=f?this.closeUri:this.disconnectUri;if(u){var a=this.createRequest(u,null,this.authParams,null,l.default.REQ_SEND);a.on("complete",function(v){v&&(p.default.logAction(p.default.LOG_ERROR,"CometTransport.request"+(f?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(v)),c.finish("disconnected",v))}),a.exec()}},T.prototype.dispose=function(){var f=this;p.default.logAction(p.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(p.default.logAction(p.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",S.default.disconnected()),E.default.Config.nextTick(function(){f.emit("disposed")}))},T.prototype.onConnect=function(f){var c;if(!this.isDisposed){var u=(c=f.connectionDetails)===null||c===void 0?void 0:c.connectionKey;h.default.prototype.onConnect.call(this,f);var a=this.baseUri+u;p.default.logAction(p.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+a),this.sendUri=a+"/send",this.recvUri=a+"/recv",this.closeUri=a+"/close",this.disconnectUri=a+"/disconnect"}},T.prototype.send=function(f){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(f);return}var c=this.pendingItems||[];c.push(f),this.pendingItems=null,this.sendItems(c)},T.prototype.sendAnyPending=function(){var f=this.pendingItems;f&&(this.pendingItems=null,this.sendItems(f))},T.prototype.sendItems=function(f){var c=this,u=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(f),l.default.REQ_SEND);u.on("complete",function(a,v){if(a&&p.default.logAction(p.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(a)),c.sendRequest=null,a){a.code?c.onData(x(a)):c.disconnect(a);return}v&&c.onData(v),c.pendingItems&&E.default.Config.nextTick(function(){c.sendRequest||c.sendAnyPending()})}),u.exec()},T.prototype.recv=function(){var f=this;if(!this.recvRequest&&this.isConnected){var c=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?l.default.REQ_RECV_STREAM:l.default.REQ_RECV_POLL);c.on("data",function(u){f.onData(u)}),c.on("complete",function(u){if(f.recvRequest=null,f.onActivity(),u){u.code?f.onData(x(u)):f.disconnect(u);return}E.default.Config.nextTick(function(){f.recv()})}),c.exec()}},T.prototype.onData=function(f){try{var c=this.decodeResponse(f);if(c&&c.length)for(var u=0;u<c.length;u++)this.onProtocolMessage(g.default.fromDeserialized(c[u]))}catch(a){p.default.logAction(p.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+a.stack)}},T.prototype.encodeRequest=function(f){return JSON.stringify(f)},T.prototype.decodeResponse=function(f){return typeof f=="string"?JSON.parse(f):f},T}(h.default);t.default=C},function(n,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}n.exports=i},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isSuccessCode=void 0;var s;(function(g){g[g.Success=200]="Success",g[g.NoContent=204]="NoContent",g[g.BadRequest=400]="BadRequest",g[g.Unauthorized=401]="Unauthorized",g[g.Forbidden=403]="Forbidden",g[g.RequestTimeout=408]="RequestTimeout",g[g.InternalServerError=500]="InternalServerError"})(s||(s={}));function o(g){return g>=s.Success&&g<s.BadRequest}t.isSuccessCode=o,t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),g=s.__importStar(i(1)),h=s.__importDefault(i(2)),p=s.__importDefault(i(18)),w=s.__importDefault(i(19)),S=i(4),A=s.__importDefault(i(14));function P(b,T,f,c,u){b.http.supportsAuthHeaders?b.auth.getAuthHeaders(function(a,v){a?c(a):u(g.mixin(v,T),f)}):b.auth.getAuthParams(function(a,v){a?c(a):u(T,g.mixin(v,f))})}function l(b,T){return function(f,c,u,a,v){if(f&&!c){b(f);return}if(v===A.default.NoContent){b(f,[],u,!0,v);return}if(!a)try{c=g.decodeBody(c,T)}catch(I){g.isErrorInfoOrPartialErrorInfo(I)?b(I):b(new S.PartialErrorInfo(g.inspectError(I),null));return}if(!c){b(new S.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var d=c,y=d.statusCode,N=d.response,D=d.headers;if(y===void 0){b(f,c,u,!0,v);return}if(y<200||y>=300){var L=N&&N.error||f;L||(L=new Error("Error in unenveloping "+c),L.statusCode=y),b(L,N,D,!0,y);return}b(f,N,D,!0,y)}}function E(b){var T=[];if(b)for(var f in b)T.push(f+"="+b[f]);return T.join("&")}function R(b,T){return b+(T?"?":"")+E(T)}function x(b,T,f,c){return function(u,a,v,d,y){u?h.default.logAction(h.default.LOG_MICRO,"Resource."+T+"()","Received Error; "+R(f,c)+"; Error: "+g.inspectError(u)):h.default.logAction(h.default.LOG_MICRO,"Resource."+T+"()","Received; "+R(f,c)+"; Headers: "+E(v)+"; StatusCode: "+y+"; Body: "+(o.default.BufferUtils.isBuffer(a)?a.toString():a)),b&&b(u,a,v,d,y)}}var C=function(){function b(){}return b.get=function(T,f,c,u,a,v){b.do(w.default.Get,T,f,null,c,u,a,v)},b.delete=function(T,f,c,u,a,v){b.do(w.default.Delete,T,f,null,c,u,a,v)},b.post=function(T,f,c,u,a,v,d){b.do(w.default.Post,T,f,c,u,a,v,d)},b.patch=function(T,f,c,u,a,v,d){b.do(w.default.Patch,T,f,c,u,a,v,d)},b.put=function(T,f,c,u,a,v,d){b.do(w.default.Put,T,f,c,u,a,v,d)},b.do=function(T,f,c,u,a,v,d,y){h.default.shouldLog(h.default.LOG_MICRO)&&(y=x(y,T,c,v)),d&&(y=y&&l(y,d),(v=v||{}).envelope=d);function N(D,L){var I;if(h.default.shouldLog(h.default.LOG_MICRO)&&h.default.logAction(h.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(c,L)),h.default.shouldLog(h.default.LOG_MICRO)){var m=u;if(((I=D["content-type"])===null||I===void 0?void 0:I.indexOf("msgpack"))>0)try{m=o.default.Config.msgpack.decode(u)}catch(O){h.default.logAction(h.default.LOG_MICRO,"Resource."+T+"()","Sending MsgPack Decoding Error: "+g.inspectError(O))}h.default.logAction(h.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(c,L)+"; Body: "+m)}f.http.do(T,f,c,D,u,L,function(O,k,j,B,$){if(O&&p.default.isTokenErr(O)){f.auth.authorize(null,null,function(V){if(V){y(V);return}P(f,D,L,y,N)});return}y(O,k,j,B,$)})}P(f,a,v,y,N)},b}();t.default=C},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),g=s.__importDefault(i(3)),h=s.__importDefault(i(9)),p=s.__importStar(i(1));function w(A){return S.Actions.indexOf(A)}var S=function(){function A(){}return A.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},A.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var P=this.id.split(":");return{connectionId:P[0],msgSerial:parseInt(P[1],10),index:parseInt(P[2],10)}},A.prototype.toJSON=function(){var P=this.data,l=this.encoding;return P&&g.default.BufferUtils.isBuffer(P)&&(arguments.length>0?(l=l?l+"/base64":"base64",P=g.default.BufferUtils.base64Encode(P)):P=g.default.BufferUtils.toBuffer(P)),{id:this.id,clientId:this.clientId,action:w(this.action),data:P,encoding:l,extras:this.extras}},A.prototype.toString=function(){var P="[PresenceMessage";return P+="; action="+this.action,this.id&&(P+="; id="+this.id),this.timestamp&&(P+="; timestamp="+this.timestamp),this.clientId&&(P+="; clientId="+this.clientId),this.connectionId&&(P+="; connectionId="+this.connectionId),this.encoding&&(P+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?P+="; data="+this.data:g.default.BufferUtils.isBuffer(this.data)?P+="; data (buffer)="+g.default.BufferUtils.base64Encode(this.data):P+="; data (json)="+JSON.stringify(this.data)),this.extras&&(P+="; extras="+JSON.stringify(this.extras)),P+="]",P},A.fromResponseBody=function(P,l,E){var R=[];E&&(P=p.decodeBody(P,E));for(var x=0;x<P.length;x++){var C=R[x]=A.fromValues(P[x],!0);try{A.decode(C,l)}catch(b){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",b.toString())}}return R},A.fromValues=function(P,l){return l&&(P.action=A.Actions[P.action]),Object.assign(new A,P)},A.fromValuesArray=function(P){for(var l=P.length,E=new Array(l),R=0;R<l;R++)E[R]=A.fromValues(P[R]);return E},A.fromEncoded=function(P,l){var E=A.fromValues(P,!0);try{A.decode(E,l??{})}catch(R){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",R.toString())}return E},A.fromEncodedArray=function(P,l){return P.map(function(E){return A.fromEncoded(E,l)})},A.fromData=function(P){return P instanceof A?P:A.fromValues({data:P})},A.Actions=["absent","present","enter","leave","update"],A.encode=h.default.encode,A.decode=h.default.decode,A.getMessagesSize=h.default.getMessagesSize,A}();t.default=S},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),g=o.__importStar(i(1)),h=o.__importDefault(i(7)),p=o.__importStar(i(4)),w=o.__importDefault(i(2)),S=o.__importDefault(i(8)),A=o.__importDefault(i(22)),P=o.__importDefault(i(3));function l(d,y){return g.arrIn(g.allToLowerCase(g.keysArray(y)),"x-ably-errorcode")}function E(d,y){if(l(d,y))return d.error&&p.default.fromValues(d.error)}var R=function(){},x=0,C={},b=typeof s<"u"&&s.XDomainRequest;function T(){var d=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return d&&Number(d[1])}function f(){var d;return b&&(d=T())&&d===10}function c(d,y){return d.getResponseHeader&&d.getResponseHeader(y)}function u(d){return d.getResponseHeader&&(d.getResponseHeader("transfer-encoding")||!d.getResponseHeader("content-length"))}function a(d){for(var y=g.trim(d.getAllResponseHeaders()).split(`\r
`),N={},D=0;D<y.length;D++){var L=y[D].split(":").map(g.trim);N[L[0].toLowerCase()]=L[1]}return N}var v=function(d){o.__extends(y,d);function y(N,D,L,I,m,O,k){var j=d.call(this)||this;return L=L||{},L.rnd=g.cheapRandStr(),f()&&!L.envelope&&(L.envelope="json"),j.uri=N+g.toQueryString(L),j.headers=D||{},j.body=I,j.method=k?k.toUpperCase():g.isEmptyArg(I)?"GET":"POST",j.requestMode=m,j.timeouts=O,j.timedOut=!1,j.requestComplete=!1,j.id=String(++x),C[j.id]=j,j}return y.createRequest=function(N,D,L,I,m,O,k){var j=O||S.default.TIMEOUTS;return new y(N,D,g.copy(L),I,m,j,k)},y.prototype.complete=function(N,D,L,I,m){this.requestComplete||(this.requestComplete=!0,!N&&D&&this.emit("data",D),this.emit("complete",N,D,L,I,m),this.dispose())},y.prototype.abort=function(){this.dispose()},y.prototype.exec=function(){var N=this,D=this.headers,L=this.requestMode==A.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,I=this.timer=setTimeout(function(){N.timedOut=!0,O.abort()},L),m=this.method,O=this.xhr=new XMLHttpRequest,k=D.accept,j=this.body,B="text";if(k?k.indexOf("application/x-msgpack")===0&&(B="arraybuffer"):D.accept="application/json",j){var $=D["content-type"]||(D["content-type"]="application/json");$.indexOf("application/json")>-1&&typeof j!="string"&&(j=JSON.stringify(j))}O.open(m,this.uri,!0),O.responseType=B,"authorization"in D&&(O.withCredentials=!0);for(var V in D)O.setRequestHeader(V,D[V]);var H=function(X,ie,fe,ve){var ce,Pe=ie+" (event type: "+X.type+")";!((ce=N==null?void 0:N.xhr)===null||ce===void 0)&&ce.statusText&&(Pe+=", current statusText is "+N.xhr.statusText),w.default.logAction(w.default.LOG_ERROR,"Request.on"+X.type+"()",Pe),N.complete(new p.PartialErrorInfo(Pe,fe,ve))};O.onerror=function(X){H(X,"XHR error occurred",null,400)},O.onabort=function(X){N.timedOut?H(X,"Request aborted due to request timeout expiring",null,408):H(X,"Request cancelled",null,400)},O.ontimeout=function(X){H(X,"Request timed out",null,408)};var M,_,U,F=0,z=!1,J=function(){if(clearTimeout(I),U=_<400,_==204){N.complete(null,null,null,null,_);return}M=N.requestMode==A.default.REQ_RECV_STREAM&&U&&u(O)},Q=function(){var X;try{var ie=c(O,"content-type"),fe=ie?ie.indexOf("application/json")>=0:O.responseType=="text";if(fe){var ve=O.responseType==="arraybuffer"?P.default.BufferUtils.utf8Decode(O.response):String(O.responseText);ve.length?X=JSON.parse(ve):X=ve,z=!0}else X=O.response;X.response!==void 0?(_=X.statusCode,U=_<400,D=X.headers,X=X.response):D=a(O)}catch(Pe){N.complete(new p.PartialErrorInfo("Malformed response body from server: "+Pe.message,null,400));return}if(U||g.isArray(X)){N.complete(null,X,D,z,_);return}var ce=E(X,D);ce||(ce=new p.PartialErrorInfo("Error response received from server: "+_+" body was: "+P.default.Config.inspect(X),null,_)),N.complete(ce,X,D,z,_)};function Y(){for(var X=O.responseText,ie=X.length-1,fe,ve;F<ie&&(fe=X.indexOf(`
`,F))>-1;)ve=X.slice(F,fe),F=fe+1,ee(ve)}var ee=function(X){try{X=JSON.parse(X)}catch(ie){N.complete(new p.PartialErrorInfo("Malformed response body from server: "+ie.message,null,400));return}N.emit("data",X)},re=function(){Y(),N.streamComplete=!0,P.default.Config.nextTick(function(){N.complete()})};O.onreadystatechange=function(){var X=O.readyState;X<3||O.status!==0&&(_===void 0&&(_=O.status,_===1223&&(_=204),J()),X==3&&M?Y():X==4&&(M?re():Q()))},O.send(j)},y.prototype.dispose=function(){var N=this.xhr;if(N){N.onreadystatechange=N.onerror=N.onabort=N.ontimeout=R,this.xhr=null;var D=this.timer;D&&(clearTimeout(D),this.timer=null),this.requestComplete||N.abort()}delete C[this.id]},y}(h.default);t.default=v}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),g=s.__importStar(i(1)),h=s.__importDefault(i(24)),p=s.__importDefault(i(4)),w=s.__importDefault(i(45)),S=i(11),A=s.__importDefault(i(19)),P=s.__importDefault(i(14)),l=s.__importDefault(i(3)),E=s.__importDefault(i(15)),R=Math.pow(2,17);function x(){}function C(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function b(L){return!!L.connection}function T(L){return g.isErrorInfoOrPartialErrorInfo(L)?(L.code||(L.statusCode===403?L.code=40300:(L.code=40170,L.statusCode=401)),L):new p.default(g.inspectError(L),L.code||40170,L.statusCode||401)}var f=function(L,I){if(l.default.Config.createHmac){var m=l.default.Config.createHmac("SHA256",I);return m.update(L),m.digest("base64")}return(0,S.stringify)((0,w.default)(L,I))};function c(L){if(!L)return"";typeof L=="string"&&(L=JSON.parse(L));var I=Object.create(null),m=g.keysArray(L,!0);if(!m)return"";m.sort();for(var O=0;O<m.length;O++)I[m[O]]=L[m[O]].sort();return JSON.stringify(I)}function u(L){if(L.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(L.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(L.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(L.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var I="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",I),new Error(I)}}function a(L){return"useTokenAuth"in L&&!L.useTokenAuth}function v(L){return L.useTokenAuth||!a(L)&&(L.authCallback||L.authUrl||L.token||L.tokenDetails)}function d(L){return!L.key&&!L.authCallback&&!L.authUrl}var y=0;function N(){return y++}var D=function(){function L(I,m){if(this.authOptions={},this.client=I,this.tokenParams=m.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,v(m)){if(m.key&&!f){var O="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",O),new Error(O)}d(m)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(m.defaultTokenParams,m),u(this.authOptions)}else{if(!m.key){var O="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",O),new p.default(O,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(m)}}return L.prototype.authorize=function(I,m,O){var k=this,j;if(typeof I=="function"&&!O?(O=I,j=I=null):typeof m=="function"&&!O?(O=m,j=null):j=m,!O&&this.client.options.promises)return g.promisify(this,"authorize",arguments);if(j&&j.key&&this.authOptions.key!==j.key)throw new p.default("Unable to update auth options with incompatible key",40102,401);j&&"force"in j&&(o.default.deprecated("The `force` auth option","If youre using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the librarys stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if youre currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),g.isOnlyPropIn(j,"force")&&(j=null)),this._forceNewToken(I,j,function(B,$){if(B){k.client.connection&&B.statusCode===P.default.Forbidden&&k.client.connection.connectionManager.actOnErrorFromAuthorize(B),O==null||O(B);return}b(k.client)?k.client.connection.connectionManager.onAuthUpdated($,O||x):O==null||O(null,$)})},L.prototype.authorise=function(I,m,O){o.default.renamedMethod("Auth","authorise","authorize"),this.authorize(I,m,O)},L.prototype._forceNewToken=function(I,m,O){var k=this;this.tokenDetails=null,this._saveTokenOptions(I,m),u(this.authOptions),this._ensureValidAuthCredentials(!0,function(j,B){delete k.tokenParams.timestamp,delete k.authOptions.queryTime,O(j,B)})},L.prototype.requestToken=function(I,m,O){var k=this;if(typeof I=="function"&&!O?(O=I,m=I=null):typeof m=="function"&&!O&&(O=m,m=null),!O&&this.client.options.promises)return g.promisify(this,"requestToken",arguments);m=m||this.authOptions,I=I||g.copy(this.tokenParams);var j=O||x,B,$=this.client;if(m.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),B=m.authCallback;else if(m.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),B=function(F,z){var J=g.mixin({accept:"application/json, text/plain"},m.authHeaders),Q=m.authMethod&&m.authMethod.toLowerCase()==="post",Y,ee=m.authUrl.indexOf("?");ee>-1&&(Y=g.parseQueryString(m.authUrl.slice(ee)),m.authUrl=m.authUrl.slice(0,ee),Q||(m.authParams=g.mixin(Y,m.authParams)));var re=g.mixin({},m.authParams||{},F),X=function(ve,ce,Pe,Ye){var Ee;if(ve?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+g.inspectError(ve)):(Ee=Pe["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+Ee+"; body: "+g.inspectBody(ce))),ve||Ye)return z(ve,ce);if(l.default.BufferUtils.isBuffer(ce)&&(ce=ce.toString()),!Ee){z(new p.default("authUrl response is missing a content-type header",40170,401));return}var Ze=Ee.indexOf("application/json")>-1,It=Ee.indexOf("text/plain")>-1||Ee.indexOf("application/jwt")>-1;if(!Ze&&!It){z(new p.default("authUrl responded with unacceptable content-type "+Ee+", should be either text/plain, application/jwt or application/json",40170,401));return}if(Ze){if(ce.length>R){z(new p.default("authUrl response exceeded max permitted length",40170,401));return}try{ce=JSON.parse(ce)}catch(xt){z(new p.default("Unexpected error processing authURL response; err = "+xt.message,40170,401));return}}z(null,ce,Ee)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+m.authUrl+"; Params: "+JSON.stringify(re)+"; method: "+(Q?"POST":"GET")),Q){var ie=J||{};ie["content-type"]="application/x-www-form-urlencoded";var fe=g.toQueryString(re).slice(1);k.client.http.doUri(A.default.Post,$,m.authUrl,ie,fe,Y,X)}else k.client.http.doUri(A.default.Get,$,m.authUrl,J||{},null,re,X)};else if(m.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),B=function(F,z){k.createTokenRequest(F,m,z)};else{var V="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),j(new p.default(V,40171,403));return}"capability"in I&&(I.capability=c(I.capability));var H=function(F,z){var J=F.keyName,Q="/keys/"+J+"/requestToken",Y=function(re){return $.baseUri(re)+Q},ee=g.defaultPostHeaders(k.client.options);m.requestHeaders&&g.mixin(ee,m.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+Q+"; Token params: "+JSON.stringify(F)),k.client.http.do(A.default.Post,$,Y,ee,JSON.stringify(F),null,z)},M=!1,_=this.client.options.timeouts.realtimeRequestTimeout,U=setTimeout(function(){M=!0;var F="Token request callback timed out after "+_/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",F),j(new p.default(F,40170,401))},_);B(I,function(F,z,J){if(!M){if(clearTimeout(U),F){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+g.inspectError(F)),j(T(F));return}if(typeof z=="string"){z.length===0?j(new p.default("Token string is empty",40170,401)):z.length>R?j(new p.default("Token string exceeded max permitted length (was "+z.length+" bytes)",40170,401)):z==="undefined"||z==="null"?j(new p.default("Token string was literal null/undefined",40170,401)):z[0]==="{"&&!(J&&J.indexOf("application/jwt")>-1)?j(new p.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):j(null,{token:z});return}if(typeof z!="object"){var Q="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof z;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),j(new p.default(Q,40170,401));return}var Y=JSON.stringify(z).length;if(Y>R&&!m.suppressMaxLengthCheck){j(new p.default("Token request/details object exceeded max permitted stringified size (was "+Y+" bytes)",40170,401));return}if("issued"in z){j(null,z);return}if(!("keyName"in z)){var Q="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),j(new p.default(Q,40170,401));return}H(z,function(ee,re,X,ie){if(ee){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+g.inspectError(ee)),j(T(ee));return}ie||(re=JSON.parse(re)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),j(null,re)})}})},L.prototype.createTokenRequest=function(I,m,O){var k=this;if(typeof I=="function"&&!O?(O=I,m=I=null):typeof m=="function"&&!O&&(O=m,m=null),!O&&this.client.options.promises)return g.promisify(this,"createTokenRequest",arguments);m=m||this.authOptions,I=I||g.copy(this.tokenParams);var j=m.key;if(!j){O(new p.default("No key specified",40101,403));return}var B=j.split(":"),$=B[0],V=B[1];if(!V){O(new p.default("Invalid key specified",40101,403));return}if(I.clientId===""){O(new p.default("clientId cant be an empty string",40012,400));return}"capability"in I&&(I.capability=c(I.capability));var H=g.mixin({keyName:$},I),M=I.clientId||"",_=I.ttl||"",U=I.capability||"";(function(F){if(H.timestamp){F();return}k.getTimestamp(m&&m.queryTime,function(z,J){if(z){O(z);return}H.timestamp=J,F()})})(function(){var F=H.nonce||(H.nonce=C()),z=H.timestamp,J=H.keyName+`
`+_+`
`+U+`
`+M+`
`+z+`
`+F+`
`;H.mac=H.mac||f(J,V),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),O(null,H)})},L.prototype.getAuthParams=function(I){this.method=="basic"?I(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(m,O){if(m){I(m);return}if(!O)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");I(null,{access_token:O.token})})},L.prototype.getAuthHeaders=function(I){this.method=="basic"?I(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(m,O){if(m){I(m);return}if(!O)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");I(null,{authorization:"Bearer "+g.toBase64(O.token)})})},L.prototype.getTimestamp=function(I,m){!this.isTimeOffsetSet()&&(I||this.authOptions.queryTime)?this.client.time(m):m(null,this.getTimestampUsingOffset())},L.prototype.getTimestampUsingOffset=function(){return g.now()+(this.client.serverTimeOffset||0)},L.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},L.prototype._saveBasicOptions=function(I){this.method="basic",this.key=I.key,this.basicKey=g.toBase64(I.key),this.authOptions=I||{},"clientId"in I&&this._userSetClientId(I.clientId)},L.prototype._saveTokenOptions=function(I,m){this.method="token",I&&(this.tokenParams=I),m&&(m.token&&(m.tokenDetails=typeof m.token=="string"?{token:m.token}:m.token),m.tokenDetails&&(this.tokenDetails=m.tokenDetails),"clientId"in m&&this._userSetClientId(m.clientId),this.authOptions=m)},L.prototype._ensureValidAuthCredentials=function(I,m){var O=this,k=this.tokenDetails;if(k){if(this._tokenClientIdMismatch(k.clientId)){m(new p.default("Mismatch between clientId in token ("+k.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!k.expires||k.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+k.expires),m(null,k);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=h.default.create())).push(m),!(this.currentTokenRequestId!==null&&!I)){var j=this.currentTokenRequestId=N();this.requestToken(this.tokenParams,this.authOptions,function(B,$){if(O.currentTokenRequestId>j){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}O.currentTokenRequestId=null;var V=O.waitingForTokenRequest||x;if(O.waitingForTokenRequest=null,B){V(B);return}V(null,O.tokenDetails=$)})}},L.prototype._userSetClientId=function(I){if(typeof I=="string"||I===null){if(I==="*")throw new p.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var m=this._uncheckedSetClientId(I);if(m)throw m}else throw new p.default("clientId must be either a string or null",40012,400)},L.prototype._uncheckedSetClientId=function(I){if(this._tokenClientIdMismatch(I)){var m="Unexpected clientId mismatch: client has "+this.clientId+", requested "+I,O=new p.default(m,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",m),O}else return this.clientId=this.tokenParams.clientId=I,null},L.prototype._tokenClientIdMismatch=function(I){return!!(this.clientId&&this.clientId!=="*"&&I&&I!=="*"&&this.clientId!==I)},L.isTokenErr=function(I){return I.code&&I.code>=40140&&I.code<40150},L.prototype.revokeTokens=function(I,m,O){if(v(this.client.options))throw new p.default("Cannot revoke tokens when using token auth",40162,401);var k=this.client.options.keyName,j;if(typeof m=="function"?(O=m,j={}):j=m??{},O===void 0){if(this.client.options.promises)return g.promisify(this,"revokeTokens",[I,j]);O=x}var B=O,$=s.__assign({targets:I.map(function(_){return"".concat(_.type,":").concat(_.value)})},j),V=this.client.options.useBinaryProtocol?g.Format.msgpack:g.Format.json,H=g.defaultPostHeaders(this.client.options,V);this.client.options.headers&&g.mixin(H,this.client.options.headers);var M=g.encodeBody($,V);E.default.post(this.client,"/keys/".concat(k,"/revokeTokens"),M,H,{newBatchResponse:"true"},null,function(_,U,F,z){if(_){B(_);return}var J=z?U:g.decodeBody(U,V);B(null,J)})},L}();t.default=D},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(s||(s={})),t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.HttpPaginatedResponse=t.PaginatedResult=void 0;var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(2)),h=s.__importDefault(i(15)),p=s.__importDefault(i(14));function w(R){var x=R.match(/^\.\/(\w+)\?(.*)$/);return x&&x[2]&&o.parseQueryString(x[2])}function S(R){typeof R=="string"&&(R=R.split(","));for(var x={},C=0;C<R.length;C++){var b=R[C].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(b){var T=w(b[1]);T&&(x[b[2]]=T)}}return x}function A(R,x,C){return!(C&&(x||typeof R.code=="number"))}var P=function(){function R(x,C,b,T,f,c){this.rest=x,this.path=C,this.headers=b,this.envelope=T??null,this.bodyHandler=f,this.useHttpPaginatedResponse=c||!1}return R.prototype.get=function(x,C){var b=this;h.default.get(this.rest,this.path,this.headers,x,this.envelope,function(T,f,c,u,a){b.handlePage(T,f,c,u,a,C)})},R.prototype.delete=function(x,C){var b=this;h.default.delete(this.rest,this.path,this.headers,x,this.envelope,function(T,f,c,u,a){b.handlePage(T,f,c,u,a,C)})},R.prototype.post=function(x,C,b){var T=this;h.default.post(this.rest,this.path,C,this.headers,x,this.envelope,function(f,c,u,a,v){b&&T.handlePage(f,c,u,a,v,b)})},R.prototype.put=function(x,C,b){var T=this;h.default.put(this.rest,this.path,C,this.headers,x,this.envelope,function(f,c,u,a,v){b&&T.handlePage(f,c,u,a,v,b)})},R.prototype.patch=function(x,C,b){var T=this;h.default.patch(this.rest,this.path,C,this.headers,x,this.envelope,function(f,c,u,a,v){b&&T.handlePage(f,c,u,a,v,b)})},R.prototype.handlePage=function(x,C,b,T,f,c){if(x&&A(x,C,this.useHttpPaginatedResponse)){g.default.logAction(g.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(x)),c==null||c(x);return}var u,a,v;try{u=f==p.default.NoContent?[]:this.bodyHandler(C,b||{},T)}catch(d){c==null||c(x||d);return}b&&(a=b.Link||b.link)&&(v=S(a)),this.useHttpPaginatedResponse?c(null,new E(this,u,b||{},f,v,x)):c(null,new l(this,u,v))},R}(),l=function(){function R(x,C,b){var T=this;this.resource=x,this.items=C;var f=this;b&&("first"in b&&(this.first=function(c){if(!c&&f.resource.rest.options.promises)return o.promisify(f,"first",[]);f.get(b.first,c)}),"current"in b&&(this.current=function(c){if(!c&&f.resource.rest.options.promises)return o.promisify(f,"current",[]);f.get(b.current,c)}),this.next=function(c){if(!c&&f.resource.rest.options.promises)return o.promisify(f,"next",[]);"next"in b?f.get(b.next,c):c(null,null)},this.hasNext=function(){return"next"in b},this.isLast=function(){var c;return!(!((c=T.hasNext)===null||c===void 0)&&c.call(T))})}return R.prototype.get=function(x,C){var b=this.resource;h.default.get(b.rest,b.path,b.headers,x,b.envelope,function(T,f,c,u,a){b.handlePage(T,f,c,u,a,C)})},R}();t.PaginatedResult=l;var E=function(R){s.__extends(x,R);function x(C,b,T,f,c,u){var a=R.call(this,C,b,c)||this;return a.statusCode=f,a.success=f<300&&f>=200,a.headers=T,a.errorCode=u&&u.code,a.errorMessage=u&&u.message,a}return x.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},x}(l);t.HttpPaginatedResponse=E,t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isRetriable=void 0;var s=i(0),o=s.__importDefault(i(4)),g={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},h={disconnected:function(){return o.default.fromValues({statusCode:400,code:g.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return o.default.fromValues({statusCode:400,code:g.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return o.default.fromValues({statusCode:400,code:g.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return o.default.fromValues({statusCode:400,code:g.CLOSING,message:"Connection closing"})},closed:function(){return o.default.fromValues({statusCode:400,code:g.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return o.default.fromValues({statusCode:500,code:g.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return o.default.fromValues({statusCode:500,code:g.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function p(w){return!w.statusCode||!w.code||w.statusCode>=500?!0:Object.values(g).includes(w.code)}t.isRetriable=p,t.default=h},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6),i(5),i(58),i(11),i(40),i(32),i(25),i(27),i(28),i(59),i(60))})(this,function(s){return s})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),g=function(){function h(p){this.members=p||[]}return h.prototype.call=function(){for(var p=[],w=0;w<arguments.length;w++)p[w]=arguments[w];for(var S=0,A=this.members;S<A.length;S++){var P=A[S];if(P)try{P.apply(void 0,p)}catch(l){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+l+"; stack = "+l.stack)}}},h.prototype.push=function(){for(var p,w=[],S=0;S<arguments.length;S++)w[S]=arguments[S];(p=this.members).push.apply(p,w)},h.create=function(p){var w=new h(p);return Object.assign(function(){for(var S=[],A=0;A<arguments.length;A++)S[A]=arguments[A];return w.call.apply(w,S)},{push:function(S){return w.push(S)}})},h}();t.default=g},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){(function(){var o=s,g=o.lib,h=g.Base,p=o.enc,w=p.Utf8,S=o.algo;S.HMAC=h.extend({init:function(A,P){A=this._hasher=new A.init,typeof P=="string"&&(P=w.parse(P));var l=A.blockSize,E=l*4;P.sigBytes>E&&(P=A.finalize(P)),P.clamp();for(var R=this._oKey=P.clone(),x=this._iKey=P.clone(),C=R.words,b=x.words,T=0;T<l;T++)C[T]^=1549556828,b[T]^=909522486;R.sigBytes=x.sigBytes=E,this.reset()},reset:function(){var A=this._hasher;A.reset(),A.update(this._iKey)},update:function(A){return this._hasher.update(A),this},finalize:function(A){var P=this._hasher,l=P.finalize(A);P.reset();var E=P.finalize(this._oKey.clone().concat(l));return E}})})()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),g=s.__importStar(i(1)),h=s.__importDefault(i(7)),p=s.__importDefault(i(2)),w=s.__importDefault(i(21)),S=s.__importDefault(i(4)),A=s.__importDefault(i(3)),P=o.default.Action,l=o.default.fromValues({action:P.CLOSE}),E=o.default.fromValues({action:P.DISCONNECT}),R=function(x){s.__extends(C,x);function C(b,T,f,c){var u=x.call(this)||this;return c&&(f.format=void 0,f.heartbeats=!0),u.connectionManager=b,b.registerProposedTransport(u),u.auth=T,u.params=f,u.timeouts=f.options.timeouts,u.format=f.format,u.isConnected=!1,u.isFinished=!1,u.isDisposed=!1,u.maxIdleInterval=null,u.idleTimer=null,u.lastActivity=null,u}return C.prototype.connect=function(){},C.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",w.default.closed())},C.prototype.disconnect=function(b){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",b||w.default.disconnected())},C.prototype.fail=function(b){this.isConnected&&this.requestDisconnect(),this.finish("failed",b||w.default.failed())},C.prototype.finish=function(b,T){var f;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((f=this.idleTimer)!==null&&f!==void 0?f:void 0),this.idleTimer=null,this.emit(b,T),this.dispose())},C.prototype.onProtocolMessage=function(b){switch(p.default.shouldLog(p.default.LOG_MICRO)&&p.default.logAction(p.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(b)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),b.action){case P.HEARTBEAT:p.default.logAction(p.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",b.id);break;case P.CONNECTED:this.onConnect(b),this.emit("connected",b.error,b.connectionId,b.connectionDetails,b);break;case P.CLOSED:this.onClose(b);break;case P.DISCONNECTED:this.onDisconnect(b);break;case P.ACK:this.emit("ack",b.msgSerial,b.count);break;case P.NACK:this.emit("nack",b.msgSerial,b.count,b.error);break;case P.SYNC:this.connectionManager.onChannelMessage(b,this);break;case P.ACTIVATE:break;case P.AUTH:this.auth.authorize(function(T){T&&p.default.logAction(p.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+g.inspectError(T))});break;case P.ERROR:if(p.default.logAction(p.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+A.default.Config.inspect(b.error)+(b.channel?", channel: "+b.channel:"")),b.channel===void 0){this.onFatalError(b);break}this.connectionManager.onChannelMessage(b,this);break;default:this.connectionManager.onChannelMessage(b,this)}},C.prototype.onConnect=function(b){if(this.isConnected=!0,!b.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var T=b.connectionDetails.maxIdleInterval;T&&(this.maxIdleInterval=T+this.timeouts.realtimeRequestTimeout,this.onActivity())},C.prototype.onDisconnect=function(b){var T=b&&b.error;p.default.logAction(p.default.LOG_MINOR,"Transport.onDisconnect()","err = "+g.inspectError(T)),this.finish("disconnected",T)},C.prototype.onFatalError=function(b){var T=b&&b.error;p.default.logAction(p.default.LOG_MINOR,"Transport.onFatalError()","err = "+g.inspectError(T)),this.finish("failed",T)},C.prototype.onClose=function(b){var T=b&&b.error;p.default.logAction(p.default.LOG_MINOR,"Transport.onClose()","err = "+g.inspectError(T)),this.finish("closed",T)},C.prototype.requestClose=function(){p.default.logAction(p.default.LOG_MINOR,"Transport.requestClose()",""),this.send(l)},C.prototype.requestDisconnect=function(){p.default.logAction(p.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(E)},C.prototype.ping=function(b){var T={action:o.default.Action.HEARTBEAT};b&&(T.id=b),this.send(o.default.fromValues(T))},C.prototype.dispose=function(){p.default.logAction(p.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},C.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=g.now(),this.setIdleTimer(this.maxIdleInterval+100))},C.prototype.setIdleTimer=function(b){var T=this;this.idleTimer||(this.idleTimer=setTimeout(function(){T.onIdleTimerExpire()},b))},C.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var b=g.now()-this.lastActivity,T=this.maxIdleInterval-b;if(T<=0){var f="No activity seen from realtime in "+b+"ms; assuming connection has dropped";p.default.logAction(p.default.LOG_ERROR,"Transport.onIdleTimerExpire()",f),this.disconnect(new S.default(f,80003,408))}else this.setIdleTimer(T+100)},C.tryConnect=function(b,T,f,c,u){var a=new b(T,f,c),v,d=function(N){clearTimeout(v),u({event:this.event,error:N})},y=T.options.timeouts.realtimeRequestTimeout;v=setTimeout(function(){a.off(["preconnect","disconnected","failed"]),a.dispose(),d.call({event:"disconnected"},new S.default("Timeout waiting for transport to indicate itself viable",5e4,500))},y),a.on(["failed","disconnected"],d),a.on("preconnect",function(){p.default.logAction(p.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+a),clearTimeout(v),a.off(["failed","disconnected"],d),u(null,a)}),a.connect()},C}(h.default);t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6),i(40),i(25))})(this,function(s){return function(){var o=s,g=o.lib,h=g.Base,p=g.WordArray,w=o.algo,S=w.MD5,A=w.EvpKDF=h.extend({cfg:h.extend({keySize:128/32,hasher:S,iterations:1}),init:function(P){this.cfg=this.cfg.extend(P)},compute:function(P,l){for(var E,R=this.cfg,x=R.hasher.create(),C=p.create(),b=C.words,T=R.keySize,f=R.iterations;b.length<T;){E&&x.update(E),E=x.update(P).finalize(l),x.reset();for(var c=1;c<f;c++)E=x.finalize(E),x.reset();C.concat(E)}return C.sigBytes=T*4,C}});o.EvpKDF=function(P,l,E){return A.create(E).compute(P,l)}}(),s.EvpKDF})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(27))})(this,function(s){s.lib.Cipher||function(o){var g=s,h=g.lib,p=h.Base,w=h.WordArray,S=h.BufferedBlockAlgorithm,A=g.enc;A.Utf8;var P=A.Base64,l=g.algo,E=l.EvpKDF,R=h.Cipher=S.extend({cfg:p.extend(),createEncryptor:function(D,L){return this.create(this._ENC_XFORM_MODE,D,L)},createDecryptor:function(D,L){return this.create(this._DEC_XFORM_MODE,D,L)},init:function(D,L,I){this.cfg=this.cfg.extend(I),this._xformMode=D,this._key=L,this.reset()},reset:function(){S.reset.call(this),this._doReset()},process:function(D){return this._append(D),this._process()},finalize:function(D){D&&this._append(D);var L=this._doFinalize();return L},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function D(L){return typeof L=="string"?N:v}return function(L){return{encrypt:function(I,m,O){return D(m).encrypt(L,I,m,O)},decrypt:function(I,m,O){return D(m).decrypt(L,I,m,O)}}}}()});h.StreamCipher=R.extend({_doFinalize:function(){var D=this._process(!0);return D},blockSize:1});var x=g.mode={},C=h.BlockCipherMode=p.extend({createEncryptor:function(D,L){return this.Encryptor.create(D,L)},createDecryptor:function(D,L){return this.Decryptor.create(D,L)},init:function(D,L){this._cipher=D,this._iv=L}}),b=x.CBC=function(){var D=C.extend();D.Encryptor=D.extend({processBlock:function(I,m){var O=this._cipher,k=O.blockSize;L.call(this,I,m,k),O.encryptBlock(I,m),this._prevBlock=I.slice(m,m+k)}}),D.Decryptor=D.extend({processBlock:function(I,m){var O=this._cipher,k=O.blockSize,j=I.slice(m,m+k);O.decryptBlock(I,m),L.call(this,I,m,k),this._prevBlock=j}});function L(I,m,O){var k,j=this._iv;j?(k=j,this._iv=o):k=this._prevBlock;for(var B=0;B<O;B++)I[m+B]^=k[B]}return D}(),T=g.pad={},f=T.Pkcs7={pad:function(D,L){for(var I=L*4,m=I-D.sigBytes%I,O=m<<24|m<<16|m<<8|m,k=[],j=0;j<m;j+=4)k.push(O);var B=w.create(k,m);D.concat(B)},unpad:function(D){var L=D.words[D.sigBytes-1>>>2]&255;D.sigBytes-=L}};h.BlockCipher=R.extend({cfg:R.cfg.extend({mode:b,padding:f}),reset:function(){var D;R.reset.call(this);var L=this.cfg,I=L.iv,m=L.mode;this._xformMode==this._ENC_XFORM_MODE?D=m.createEncryptor:(D=m.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==D?this._mode.init(this,I&&I.words):(this._mode=D.call(m,this,I&&I.words),this._mode.__creator=D)},_doProcessBlock:function(D,L){this._mode.processBlock(D,L)},_doFinalize:function(){var D,L=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(L.pad(this._data,this.blockSize),D=this._process(!0)):(D=this._process(!0),L.unpad(D)),D},blockSize:128/32});var c=h.CipherParams=p.extend({init:function(D){this.mixIn(D)},toString:function(D){return(D||this.formatter).stringify(this)}}),u=g.format={},a=u.OpenSSL={stringify:function(D){var L,I=D.ciphertext,m=D.salt;return m?L=w.create([1398893684,1701076831]).concat(m).concat(I):L=I,L.toString(P)},parse:function(D){var L,I=P.parse(D),m=I.words;return m[0]==1398893684&&m[1]==1701076831&&(L=w.create(m.slice(2,4)),m.splice(0,4),I.sigBytes-=16),c.create({ciphertext:I,salt:L})}},v=h.SerializableCipher=p.extend({cfg:p.extend({format:a}),encrypt:function(D,L,I,m){m=this.cfg.extend(m);var O=D.createEncryptor(I,m),k=O.finalize(L),j=O.cfg;return c.create({ciphertext:k,key:I,iv:j.iv,algorithm:D,mode:j.mode,padding:j.padding,blockSize:D.blockSize,formatter:m.format})},decrypt:function(D,L,I,m){m=this.cfg.extend(m),L=this._parse(L,m.format);var O=D.createDecryptor(I,m).finalize(L.ciphertext);return O},_parse:function(D,L){return typeof D=="string"?L.parse(D,this):D}}),d=g.kdf={},y=d.OpenSSL={execute:function(D,L,I,m){m||(m=w.random(64/8));var O=E.create({keySize:L+I}).compute(D,m),k=w.create(O.words.slice(L),I*4);return O.sigBytes=L*4,c.create({key:O,iv:k,salt:m})}},N=h.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:y}),encrypt:function(D,L,I,m){m=this.cfg.extend(m);var O=m.kdf.execute(I,D.keySize,D.ivSize);m.iv=O.iv;var k=v.encrypt.call(this,D,L,O.key,m);return k.mixIn(O),k},decrypt:function(D,L,I,m){m=this.cfg.extend(m),L=this._parse(L,m.format);var O=m.kdf.execute(I,D.keySize,D.ivSize,L.salt);m.iv=O.iv;var k=v.decrypt.call(this,D,L,O.key,m);return k}})}()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.createRequest=void 0;var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(12)),h=s.__importDefault(i(3)),p=s.__importDefault(i(7)),w=i(4),S=s.__importDefault(i(8)),A=s.__importDefault(i(2)),P=s.__importDefault(i(22)),l=o.getGlobalObject(),E=function(){},R=l._ablyjs_jsonp={};R._=function(u){return R["_"+u]||E};var x=1,C="jsonp";function b(u,a,v,d,y,N,D){return N=N||S.default.TIMEOUTS,new f(void 0,u,a,o.copy(v),d,y,N,D)}t.createRequest=b;var T=function(u){s.__extends(a,u);function a(v,d,y){var N=u.call(this,v,d,y)||this;return N.shortName=C,y.stream=!1,N}return a.isAvailable=function(){return h.default.Config.jsonpSupported&&h.default.Config.allowComet},a.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},a.prototype.createRequest=function(v,d,y,N,D,L,I){return L=(this===null||this===void 0?void 0:this.timeouts)||L||S.default.TIMEOUTS,b(v,d,y,N,D,L,I)},a}(g.default),f=function(u){s.__extends(a,u);function a(v,d,y,N,D,L,I,m){var O=u.call(this)||this;return v===void 0&&(v=x++),O.id=v,O.uri=d,O.params=N||{},O.params.rnd=o.cheapRandStr(),y&&(y["X-Ably-Version"]&&(O.params.v=y["X-Ably-Version"]),y["X-Ably-Lib"]&&(O.params.lib=y["X-Ably-Lib"])),O.body=D,O.method=m,O.requestMode=L,O.timeouts=I,O.requestComplete=!1,O}return a.prototype.exec=function(){var v=this,d=this.id,y=this.body,N=this.method,D=this.uri,L=this.params;L.callback="_ablyjs_jsonp._("+d+")",L.envelope="jsonp",y&&(L.body=y),N&&N!=="get"&&(L.method=N);var I=this.script=document.createElement("script"),m=D+o.toQueryString(L);I.src=m,I.src.split("/").slice(-1)[0]!==m.split("/").slice(-1)[0]&&A.default.logAction(A.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),I.async=!0,I.type="text/javascript",I.charset="UTF-8",I.onerror=function(j){v.complete(new w.PartialErrorInfo("JSONP script error (event: "+h.default.Config.inspect(j)+")",null,400))},R["_"+d]=function(j){if(j.statusCode){var B=j.response;if(j.statusCode==204)v.complete(null,null,null,j.statusCode);else if(!B)v.complete(new w.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(j.statusCode<400||o.isArray(B))v.complete(null,B,j.headers,j.statusCode);else{var $=B.error||new w.PartialErrorInfo("Error response received from server",null,j.statusCode);v.complete($)}}else v.complete(null,j)};var O=this.requestMode==P.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),O);var k=document.getElementsByTagName("head")[0];k.insertBefore(I,k.firstChild)},a.prototype.complete=function(v,d,y,N){if(y=y||{},!this.requestComplete){this.requestComplete=!0;var D=void 0;d&&(D=typeof d=="string"?"text/plain":"application/json",y["content-type"]=D,this.emit("data",d)),this.emit("complete",v,d,y,!0,N),this.dispose()}},a.prototype.abort=function(){this.dispose()},a.prototype.dispose=function(){var v=this.timer;v&&(clearTimeout(v),this.timer=null);var d=this.script;d.parentNode&&d.parentNode.removeChild(d),delete R[this.id],this.emit("disposed")},a}(p.default);t.Request=f;function c(u){return l.JSONPTransport=T,T.isAvailable()&&(u.supportedTransports[C]=T),T}t.default=c},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(2)),h=s.__importDefault(i(8)),p=s.__importDefault(i(18)),w=s.__importDefault(i(46)),S=s.__importDefault(i(20)),A=s.__importDefault(i(33)),P=s.__importDefault(i(4)),l=s.__importDefault(i(49)),E=s.__importDefault(i(19)),R=s.__importDefault(i(3)),x=s.__importDefault(i(9)),C=s.__importDefault(i(16)),b=s.__importDefault(i(15)),T=function(){},f=function(){function u(a){if(!a){var v="no options provided";throw g.default.logAction(g.default.LOG_ERROR,"Rest()",v),new Error(v)}var d=h.default.objectifyOptions(a);d.log?(g.default.setLog(d.log.level,d.log.handler),g.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):g.default.setLog(d.logLevel,d.logHandler),g.default.logAction(g.default.LOG_MICRO,"Rest()","initialized with clientOptions "+R.default.Config.inspect(a));var y=this.options=h.default.normaliseOptions(d);if(y.key){var N=y.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!N){var v="invalid key parameter";throw g.default.logAction(g.default.LOG_ERROR,"Rest()",v),new P.default(v,40400,404)}y.keyName=N[1],y.keySecret=N[2]}if("clientId"in y)if(typeof y.clientId=="string"||y.clientId===null){if(y.clientId==="*")throw new P.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new P.default("clientId must be either a string or null",40012,400);g.default.logAction(g.default.LOG_MINOR,"Rest()","started; version = "+h.default.version),this.baseUri=this.authority=function(D){return h.default.getHttpScheme(y)+D+":"+h.default.getPort(y,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new R.default.Http(y),this.auth=new p.default(this,y),this.channels=new c(this),this.push=new w.default(this)}return u.prototype.stats=function(a,v){if(v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.options.promises)return o.promisify(this,"stats",[a]);v=T}var d=o.defaultGetHeaders(this.options),y=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,N=this.http.supportsLinkHeaders?void 0:y;this.options.headers&&o.mixin(d,this.options.headers),new S.default(this,"/stats",d,N,function(D,L,I){for(var m=I?D:JSON.parse(D),O=0;O<m.length;O++)m[O]=l.default.fromValues(m[O]);return m}).get(a,v)},u.prototype.time=function(a,v){var d=this;if(v===void 0){if(typeof a=="function")v=a,a=null;else if(this.options.promises)return o.promisify(this,"time",[a])}var y=v||T,N=o.defaultGetHeaders(this.options);this.options.headers&&o.mixin(N,this.options.headers);var D=function(L){return d.authority(L)+"/time"};this.http.do(E.default.Get,this,D,N,null,a,function(L,I,m,O){if(L){y(L);return}O||(I=JSON.parse(I));var k=I[0];if(!k){y(new P.default("Internal error (unexpected result type from GET /time)",5e4,500));return}d.serverTimeOffset=k-o.now(),y(null,k)})},u.prototype.request=function(a,v,d,y,N,D){var L=this.options.useBinaryProtocol,I=L?R.default.Config.msgpack.encode:JSON.stringify,m=L?R.default.Config.msgpack.decode:JSON.parse,O=L?o.Format.msgpack:o.Format.json,k=this.http.supportsLinkHeaders?void 0:O;d=d||{};var j=a.toLowerCase(),B=j=="get"?o.defaultGetHeaders(this.options,O):o.defaultPostHeaders(this.options,O);if(D===void 0){if(this.options.promises)return o.promisify(this,"request",[a,v,d,y,N]);D=T}typeof y!="string"&&(y=I(y)),this.options.headers&&o.mixin(B,this.options.headers),N&&o.mixin(B,N);var $=new S.default(this,v,B,k,function(V,H,M){return o.ensureArray(M?V:m(V))},!0);if(!o.arrIn(R.default.Http.methods,j))throw new P.default("Unsupported method "+j,40500,405);o.arrIn(R.default.Http.methodsWithBody,j)?$[j](d,y,D):$[j](d,D)},u.prototype.batchPublish=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPublish",[a]);v=T}var d=v,y,N;o.isArray(a)?(y=a,N=!1):(y=[a],N=!0);var D=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,L=o.defaultPostHeaders(this.options,D);this.options.headers&&o.mixin(L,this.options.headers);var I=o.encodeBody(y,D);b.default.post(this,"/messages",I,L,{newBatchResponse:"true"},null,function(m,O,k,j){if(m){d(m);return}var B=j?O:o.decodeBody(O,D);N?d(null,B[0]):d(null,B)})},u.prototype.batchPresence=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPresence",[a]);v=T}var d=v,y=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,N=o.defaultPostHeaders(this.options,y);this.options.headers&&o.mixin(N,this.options.headers);var D=a.join(",");b.default.get(this,"/presence",N,{newBatchResponse:"true",channels:D},null,function(L,I,m,O){if(L){d(L);return}var k=O?I:o.decodeBody(I,y);d(null,k)})},u.prototype.setLog=function(a){g.default.setLog(a.level,a.handler)},u.Promise=function(a){return a=h.default.objectifyOptions(a),a.promises=!0,new u(a)},u.Callbacks=u,u.Platform=R.default,u.Message=x.default,u.PresenceMessage=C.default,u}(),c=function(){function u(a){this.rest=a,this.all=Object.create(null)}return u.prototype.get=function(a,v){a=String(a);var d=this.all[a];return d?v&&d.setOptions(v):this.all[a]=d=new A.default(this.rest,a,v),d},u.prototype.release=function(a){delete this.all[String(a)]},u}();t.default=f},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Utf8})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var g=s,h=g.lib,p=h.WordArray,w=h.Hasher,S=g.algo,A=[],P=[];(function(){function R(T){for(var f=o.sqrt(T),c=2;c<=f;c++)if(!(T%c))return!1;return!0}function x(T){return(T-(T|0))*4294967296|0}for(var C=2,b=0;b<64;)R(C)&&(b<8&&(A[b]=x(o.pow(C,1/2))),P[b]=x(o.pow(C,1/3)),b++),C++})();var l=[],E=S.SHA256=w.extend({_doReset:function(){this._hash=new p.init(A.slice(0))},_doProcessBlock:function(R,x){for(var C=this._hash.words,b=C[0],T=C[1],f=C[2],c=C[3],u=C[4],a=C[5],v=C[6],d=C[7],y=0;y<64;y++){if(y<16)l[y]=R[x+y]|0;else{var N=l[y-15],D=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,L=l[y-2],I=(L<<15|L>>>17)^(L<<13|L>>>19)^L>>>10;l[y]=D+l[y-7]+I+l[y-16]}var m=u&a^~u&v,O=b&T^b&f^T&f,k=(b<<30|b>>>2)^(b<<19|b>>>13)^(b<<10|b>>>22),j=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),B=d+j+m+P[y]+l[y],$=k+O;d=v,v=a,a=u,u=c+B|0,c=f,f=T,T=b,b=B+$|0}C[0]=C[0]+b|0,C[1]=C[1]+T|0,C[2]=C[2]+f|0,C[3]=C[3]+c|0,C[4]=C[4]+u|0,C[5]=C[5]+a|0,C[6]=C[6]+v|0,C[7]=C[7]+d|0},_doFinalize:function(){var R=this._data,x=R.words,C=this._nDataBytes*8,b=R.sigBytes*8;return x[b>>>5]|=128<<24-b%32,x[(b+64>>>9<<4)+14]=o.floor(C/4294967296),x[(b+64>>>9<<4)+15]=C,R.sigBytes=x.length*4,this._process(),this._hash},clone:function(){var R=w.clone.call(this);return R._hash=this._hash.clone(),R}});g.SHA256=w._createHelper(E),g.HmacSHA256=w._createHmacHelper(E)}(Math),s.SHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(7)),h=s.__importDefault(i(2)),p=s.__importDefault(i(34)),w=s.__importDefault(i(9)),S=s.__importDefault(i(4)),A=s.__importDefault(i(20)),P=s.__importDefault(i(15)),l=s.__importDefault(i(3));function E(){}var R=9;function x(T){return o.arrEvery(T,function(f){return!f.id})}function C(T){var f=T||{};if(f.cipher){if(!l.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var c=l.default.Crypto.getCipher(f.cipher);f.cipher=c.cipherParams,f.channelCipher=c.cipher}else"cipher"in f&&(f.cipher=void 0,f.channelCipher=null);return f}var b=function(T){s.__extends(f,T);function f(c,u,a){var v=T.call(this)||this;return h.default.logAction(h.default.LOG_MINOR,"Channel()","started; name = "+u),v.rest=c,v.name=u,v.basePath="/channels/"+encodeURIComponent(u),v.presence=new p.default(v),v.channelOptions=C(a),v}return f.prototype.setOptions=function(c){this.channelOptions=C(c)},f.prototype.history=function(c,u){if(h.default.logAction(h.default.LOG_MICRO,"Channel.history()","channel = "+this.name),u===void 0)if(typeof c=="function")u=c,c=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);u=E}this._history(c,u)},f.prototype._history=function(c,u){var a=this.rest,v=a.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,d=this.rest.http.supportsLinkHeaders?void 0:v,y=o.defaultGetHeaders(a.options,v);a.options.headers&&o.mixin(y,a.options.headers);var N=this.channelOptions;new A.default(a,this.basePath+"/messages",y,d,function(D,L,I){return w.default.fromResponseBody(D,N,I?void 0:v)}).get(c,u)},f.prototype.publish=function(){var c=this,u=arguments.length,a=arguments[0],v=arguments[1],d=arguments[u-1],y,N;if(typeof d!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);d=E}if(typeof a=="string"||a===null)y=[w.default.fromValues({name:a,data:v})],N=arguments[2];else if(o.isObject(a))y=[w.default.fromValues(a)],N=arguments[1];else if(o.isArray(a))y=w.default.fromValuesArray(a),N=arguments[1];else throw new S.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof N!="object"||!N)&&(N={});var D=this.rest,L=D.options,I=L.useBinaryProtocol?o.Format.msgpack:o.Format.json,m=D.options.idempotentRestPublishing,O=o.defaultPostHeaders(D.options,I);if(L.headers&&o.mixin(O,L.headers),m&&x(y)){var k=o.randomString(R);o.arrForEach(y,function(j,B){j.id=k+":"+B.toString()})}w.default.encodeArray(y,this.channelOptions,function(j){if(j){d(j);return}var B=w.default.getMessagesSize(y),$=L.maxMessageSize;if(B>$){d(new S.default("Maximum size of messages that can be published at once exceeded ( was "+B+" bytes; limit is "+$+" bytes)",40009,400));return}c._publish(w.default.serialize(y,I),O,N,d)})},f.prototype._publish=function(c,u,a,v){P.default.post(this.rest,this.basePath+"/messages",c,u,a,null,v)},f.prototype.status=function(c){if(typeof c!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var u=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,a=o.defaultPostHeaders(this.rest.options,u);P.default.get(this.rest,this.basePath,a,{},u,c||E)},f}(g.default);t.default=b},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(7)),h=s.__importDefault(i(2)),p=s.__importDefault(i(20)),w=s.__importDefault(i(16));function S(){}var A=function(P){s.__extends(l,P);function l(E){var R=P.call(this)||this;return R.channel=E,R.basePath=E.basePath+"/presence",R}return l.prototype.get=function(E,R){if(h.default.logAction(h.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),R===void 0)if(typeof E=="function")R=E,E=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);R=S}var x=this.channel.rest,C=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,b=this.channel.rest.http.supportsLinkHeaders?void 0:C,T=o.defaultGetHeaders(x.options,C);x.options.headers&&o.mixin(T,x.options.headers);var f=this.channel.channelOptions;new p.default(x,this.basePath,T,b,function(c,u,a){return w.default.fromResponseBody(c,f,a?void 0:C)}).get(E,R)},l.prototype.history=function(E,R){return h.default.logAction(h.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(E,R)},l.prototype._history=function(E,R){if(R===void 0)if(typeof E=="function")R=E,E=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",[E]);R=S}var x=this.channel.rest,C=x.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,b=this.channel.rest.http.supportsLinkHeaders?void 0:C,T=o.defaultGetHeaders(x.options,C);x.options.headers&&o.mixin(T,x.options.headers);var f=this.channel.channelOptions;new p.default(x,this.basePath+"/history",T,b,function(c,u,a){return w.default.fromResponseBody(c,f,a?void 0:C)}).get(E,R)},l}(g.default);t.default=A},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.TransportParams=void 0;var o=i(0),g=o.__importDefault(i(10)),h=o.__importStar(i(1)),p=o.__importStar(i(52)),w=o.__importStar(i(8)),S=o.__importDefault(i(3)),A=o.__importDefault(i(7)),P=o.__importDefault(i(36)),l=o.__importDefault(i(2)),E=o.__importDefault(i(37)),R=o.__importStar(i(21)),x=o.__importStar(i(4)),C=o.__importDefault(i(18)),b=o.__importDefault(i(9)),T=o.__importDefault(i(24)),f=o.__importDefault(i(53)),c=o.__importDefault(i(26)),u=o.__importDefault(i(14)),a=function(){var V;return typeof S.default.WebStorage<"u"&&((V=S.default.WebStorage)===null||V===void 0?void 0:V.localSupported)},v=function(){var V;return typeof S.default.WebStorage<"u"&&((V=S.default.WebStorage)===null||V===void 0?void 0:V.sessionSupported)},d=g.default.Action,y=function(){},N="ably-transport-preference",D="ably-connection-recovery";function L(){var V,H;return v()&&((H=(V=S.default.WebStorage)===null||V===void 0?void 0:V.getSession)===null||H===void 0?void 0:H.call(V,D))}function I(V){var H,M;return v()&&((M=(H=S.default.WebStorage)===null||H===void 0?void 0:H.setSession)===null||M===void 0?void 0:M.call(H,D,V))}function m(){var V,H;return v()&&((H=(V=S.default.WebStorage)===null||V===void 0?void 0:V.removeSession)===null||H===void 0?void 0:H.call(V,D))}function O(V,H){return h.arrIndexOf(S.default.Defaults.transportPreferenceOrder,V.shortName)>h.arrIndexOf(S.default.Defaults.transportPreferenceOrder,H.shortName)}function k(V,H,M){var _;if(V.channel!==H.channel||(_=V.action)!==d.PRESENCE&&_!==d.MESSAGE||_!==H.action)return!1;var U=_===d.PRESENCE?"presence":"messages",F=V[U].concat(H[U]),z=b.default.getMessagesSize(F);return z>M||!h.allSame(F,"clientId")||!h.arrEvery(F,function(J){return!J.id})?!1:(V[U]=F,!0)}function j(V){try{return JSON.parse(V)}catch{return null}}var B=function(){function V(H,M,_,U){this.options=H,this.host=M,this.mode=_,this.connectionKey=U,this.format=H.useBinaryProtocol?h.Format.msgpack:h.Format.json}return V.prototype.getConnectParams=function(H){var M=H?h.copy(H):{},_=this.options;switch(this.mode){case"upgrade":M.upgrade=this.connectionKey;break;case"resume":M.resume=this.connectionKey;break;case"recover":{var U=j(_.recover);U&&(M.recover=U.connectionKey);break}}return _.clientId!==void 0&&(M.clientId=_.clientId),_.echoMessages===!1&&(M.echo="false"),this.format!==void 0&&(M.format=this.format),this.stream!==void 0&&(M.stream=this.stream),this.heartbeats!==void 0&&(M.heartbeats=this.heartbeats),M.v=w.default.protocolVersion,M.agent=(0,w.getAgentString)(this.options),_.transportParams!==void 0&&h.mixin(M,_.transportParams),M},V.prototype.toString=function(){var H="[mode="+this.mode;return this.host&&(H+=",host="+this.host),this.connectionKey&&(H+=",connectionKey="+this.connectionKey),this.format&&(H+=",format="+this.format),H+="]",H},V}();t.TransportParams=B;var $=function(V){o.__extends(H,V);function H(M,_){var U=V.call(this)||this;U.disconnectedRetryCount=0,H.initTransports(),U.realtime=M,U.options=_;var F=_.timeouts,z=F.preferenceConnectTimeout+F.realtimeRequestTimeout;if(U.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:z,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:F.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:F.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:F.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},U.state=U.states.initialized,U.errorReason=null,U.queuedMessages=new P.default,U.msgSerial=0,U.connectionDetails=void 0,U.connectionId=void 0,U.connectionKey=void 0,U.connectionStateTtl=F.connectionStateTtl,U.maxIdleInterval=null,U.transports=h.intersect(_.transports||w.default.defaultTransports,H.supportedTransports),U.baseTransport=h.intersect(w.default.baseTransportOrder,U.transports)[0],U.upgradeTransports=h.intersect(U.transports,w.default.upgradeTransports),U.transportPreference=null,U.httpHosts=w.default.getHosts(_),U.activeProtocol=null,U.proposedTransports=[],U.pendingTransports=[],U.host=null,U.lastAutoReconnectAttempt=null,U.lastActivity=null,U.forceFallbackHost=!1,U.connectCounter=0,l.default.logAction(l.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(_.transports||w.default.defaultTransports)+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+U.transports+"]"),l.default.logAction(l.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+U.httpHosts+"]"),!U.transports.length){var J="no requested transports available";throw l.default.logAction(l.default.LOG_ERROR,"realtime.ConnectionManager()",J),new Error(J)}var Q=S.default.Config.addEventListener;return Q&&(v()&&typeof _.recover=="function"&&Q("beforeunload",U.persistConnection.bind(U)),_.closeOnUnload===!0&&Q("beforeunload",function(){l.default.logAction(l.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),U.requestState({state:"closing"})}),Q("online",function(){U.state==U.states.disconnected||U.state==U.states.suspended?(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),U.requestState({state:"connecting"})):U.state==U.states.connecting&&(U.pendingTransports.forEach(function(Y){Y.off()}),U.disconnectAllTransports(),U.startConnect())}),Q("offline",function(){U.state==U.states.connected&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),U.disconnectAllTransports())})),U}return H.initTransports=function(){(0,f.default)(H),h.arrForEach(S.default.Transports,function(M){M(H)})},H.prototype.createTransportParams=function(M,_){return new B(this.options,M,_,this.connectionKey)},H.prototype.getTransportParams=function(M){var _=this,U=function(F){if(_.connectionKey){F("resume");return}if(typeof _.options.recover=="string"){F("recover");return}var z=_.options.recover,J=L();if(J&&typeof z=="function"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),z(J,function(Q){Q?(_.options.recover=J.recoveryKey,F("recover")):F("clean")});return}F("clean")};U(function(F){var z=_.createTransportParams(null,F);if(F==="recover"){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+_.options.recover);var J=j(_.options.recover);J&&(_.msgSerial=J.msgSerial)}else l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+z.toString());M(z)})},H.prototype.tryATransport=function(M,_,U){var F=this;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+_),c.default.tryConnect(H.supportedTransports[_],this,this.realtime.auth,M,function(z,J){var Q=F.state;if(Q==F.states.closing||Q==F.states.closed||Q==F.states.failed){J&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+Q.state+" while we were attempting the transport; closing "+J),J.close()),U(!0);return}if(z){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+_+" "+z.event+", err: "+z.error.toString()),C.default.isTokenErr(z.error)&&!(F.errorReason&&C.default.isTokenErr(F.errorReason))?(F.errorReason=z.error,F.realtime.auth._forceNewToken(null,null,function(Y){if(Y){F.actOnErrorFromAuthorize(Y);return}F.tryATransport(M,_,U)})):z.event==="failed"?(F.notifyState({state:"failed",error:z.error}),U(!0)):z.event==="disconnected"&&((0,R.isRetriable)(z.error)?U(!1):(F.notifyState({state:F.states.connecting.failState,error:z.error}),U(!0)));return}l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+_+"; setting pending"),F.setTransportPending(J,M),U(null,J)})},H.prototype.setTransportPending=function(M,_){var U=this,F=_.mode;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+M+"; mode = "+F),h.arrDeleteValue(this.proposedTransports,M),this.pendingTransports.push(M);var z=S.default.Defaults.transportPreferenceOrder[S.default.Defaults.transportPreferenceOrder.length-1];M.once("connected",function(Q,Y,ee){F=="upgrade"&&U.activeProtocol?M.shortName!==z&&h.arrIn(U.getUpgradePossibilities(),z)&&U.activeProtocol?setTimeout(function(){U.scheduleTransportActivation(Q,M,Y,ee)},U.options.timeouts.parallelUpgradeDelay):U.scheduleTransportActivation(Q,M,Y,ee):(U.activateTransport(Q,M,Y,ee),S.default.Config.nextTick(function(){U.connectImpl(_)})),F==="recover"&&U.options.recover&&(U.options.recover=null,U.unpersistConnection())});var J=this;M.on(["disconnected","closed","failed"],function(Q){J.deactivateTransport(M,this.event,Q)}),this.emit("transport.pending",M)},H.prototype.scheduleTransportActivation=function(M,_,U,F){var z=this,J=this.activeProtocol&&this.activeProtocol.getTransport(),Q=function(){_.disconnect(),h.arrDeleteValue(z.pendingTransports,_)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+_.shortName),Q();return}if(J&&!O(_,J)){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+_.shortName+" is no better than current active transport "+J.shortName+" - abandoning upgrade"),Q();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+_);var Y=null;if(!_.isConnected){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+_.shortName+"is no longer connected; abandoning upgrade"),Q();return}if(this.state===this.states.connected)l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Y=this.activeProtocol;else if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+_.shortName),Q();return}l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+_);var ee=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+_),_.send(g.default.fromValues({action:d.ACTIVATE})),z.activateTransport(M,_,U,F),z.state===z.states.synchronizing?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+_),z.state=z.states.connected):l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+z.state.state+", so leaving unchanged"),z.state.sendEvents&&z.sendQueuedMessages()};Y?Y.onceIdle(ee):ee()},H.prototype.activateTransport=function(M,_,U,F){var z=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+_),M&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+M),U&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+U),F&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(F)),this.persistTransportPreference(_);var J=this.state,Q=this.states.connected.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+J.state),J.state==this.states.closing.state||J.state==this.states.closed.state||J.state==this.states.failed.state)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),_.disconnect(),!1;if(h.arrDeleteValue(this.pendingTransports,_),!_.isConnected)return l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+_+" since it appears to no longer be connected"),!1;var Y=this.activeProtocol;this.activeProtocol=new p.default(_),this.host=_.params.host;var ee=F.connectionKey;if(ee&&this.connectionKey!=ee&&this.setConnection(U,F,!!M),this.onConnectionDetailsUpdate(F,_),S.default.Config.nextTick(function(){_.on("connected",function(X,ie,fe){z.onConnectionDetailsUpdate(fe,_),z.emit("update",new E.default(Q,Q,null,X))})}),J.state===this.states.connected.state?M&&(this.errorReason=this.realtime.connection.errorReason=M,this.emit("update",new E.default(Q,Q,null,M))):(this.notifyState({state:"connected",error:M}),this.errorReason=this.realtime.connection.errorReason=M||null),this.emit("transport.active",_),Y)if(Y.messageQueue.count()>0&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Y.transport.shortName+", new one is "+_.shortName+") finishing with "+Y.messageQueue.count()+" messages still pending"),Y.transport===_){var re="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+_.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",re)}else Y.finish();return h.safeArrForEach(this.pendingTransports,function(X){if(X===_){var ie="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+_.shortName+"; stack = "+new Error().stack;l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()",ie),h.arrDeleteValue(z.pendingTransports,_)}else X.disconnect()}),h.safeArrForEach(this.proposedTransports,function(X){X===_?(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+_.shortName+"; stack = "+new Error().stack),h.arrDeleteValue(z.proposedTransports,_)):X.dispose()}),!0},H.prototype.deactivateTransport=function(M,_,U){var F=this.activeProtocol,z=F&&F.getTransport()===M,J=h.arrDeleteValue(this.pendingTransports,M),Q=h.arrDeleteValue(this.proposedTransports,M),Y=this.noTransportsScheduledForActivation();if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+M),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+_+(z?"; was active":J?"; was pending":Q?"; was proposed":"")+(Y?"":"; another transport is scheduled for activation")),U&&U.message&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+U.message),z&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(F.getPendingMessages()),S.default.Config.nextTick(function(){F.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",M),z&&Y||z&&_==="failed"||_==="closed"||F===null&&J&&this.pendingTransports.length===0){if(_==="disconnected"&&U&&U.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:_,error:U,retryImmediately:!0});return}var ee=_==="failed"&&C.default.isTokenErr(U)?"disconnected":_;this.notifyState({state:ee,error:U});return}z&&_==="disconnected"&&this.state!==this.states.synchronizing&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:U}))},H.prototype.noTransportsScheduledForActivation=function(){return h.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(M){return!M.isConnected})},H.prototype.setConnection=function(M,_,U){var F=this.connectionId,z=F&&F!==M,J=!F&&U;(z||J)&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==M&&l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=M,this.realtime.connection.key=this.connectionKey=_.connectionKey},H.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},H.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},H.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var M=h.now()-this.lastActivity;M>this.connectionStateTtl+this.maxIdleInterval&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+M+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},H.prototype.persistConnection=function(){if(v()){var M=this.createRecoveryKey();M&&I({recoveryKey:M,disconnectedAt:h.now(),location:s.location,clientId:this.realtime.auth.clientId})}},H.prototype.unpersistConnection=function(){m()},H.prototype.getError=function(){return this.errorReason||this.getStateError()},H.prototype.getStateError=function(){var M,_;return(_=(M=R.default)[this.state.state])===null||_===void 0?void 0:_.call(M)},H.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},H.prototype.enactStateChange=function(M){var _=M.current==="failed"?l.default.LOG_ERROR:l.default.LOG_MAJOR;l.default.logAction(_,"Connection state",M.current+(M.reason?"; reason: "+M.reason:"")),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+M.current+"; reason = "+(M.reason&&M.reason.message));var U=this.state=this.states[M.current];M.reason&&(this.errorReason=M.reason,this.realtime.connection.errorReason=M.reason),(U.terminal||U.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",M)},H.prototype.startTransitionTimer=function(M){var _=this;l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+M.state),this.transitionTimer&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){_.transitionTimer&&(_.transitionTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager "+M.state+" timer expired","requesting new state: "+M.failState),_.notifyState({state:M.failState}))},M.retryDelay)},H.prototype.cancelTransitionTimer=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},H.prototype.startSuspendTimer=function(){var M=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){M.suspendTimer&&(M.suspendTimer=null,l.default.logAction(l.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),M.states.connecting.failState="suspended",M.notifyState({state:"suspended"}))},this.connectionStateTtl))},H.prototype.checkSuspendTimer=function(M){M!=="disconnected"&&M!=="suspended"&&M!=="connecting"&&this.cancelSuspendTimer()},H.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},H.prototype.startRetryTimer=function(M){var _=this;this.retryTimer=setTimeout(function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),_.retryTimer=null,_.requestState({state:"connecting"})},M)},H.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},H.prototype.notifyState=function(M){var _=this,U,F,z=M.state,J=z==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||M.retryImmediately||this.state===this.states.connecting&&M.error&&C.default.isTokenErr(M.error)&&!(this.errorReason&&C.default.isTokenErr(this.errorReason)));if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+z+(J?"; will retry connection immediately":"")),z!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(M.state),(z==="suspended"||z==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var Q=this.states[M.state],Y=Q.retryDelay;Q.state==="disconnected"&&(this.disconnectedRetryCount++,Y=h.getRetryTime(Q.retryDelay,this.disconnectedRetryCount));var ee=new E.default(this.state.state,Q.state,Y,M.error||((F=(U=R.default)[Q.state])===null||F===void 0?void 0:F.call(U)));if(J){var re=function(){_.state===_.states.disconnected&&(_.lastAutoReconnectAttempt=h.now(),_.requestState({state:"connecting"}))},X=this.lastAutoReconnectAttempt&&h.now()-this.lastAutoReconnectAttempt+1;X&&X<1e3?(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+X+"ms ago, waiting another "+(1e3-X)+"ms before trying again"),setTimeout(re,1e3-X)):S.default.Config.nextTick(re)}else(z==="disconnected"||z==="suspended")&&this.startRetryTimer(Y);(z==="disconnected"&&!J||z==="suspended"||Q.terminal)&&S.default.Config.nextTick(function(){_.disconnectAllTransports()}),z=="connected"&&!this.activeProtocol&&l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ee),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(z,ee.reason),this.failQueuedMessages(ee.reason))}},H.prototype.requestState=function(M){var _=this,U,F,z=M.state;if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+z+"; current state: "+this.state.state),z!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(z),!(z=="connecting"&&this.state.state=="connected")&&!(z=="closing"&&this.state.state=="closed"))){var J=this.states[z],Q=new E.default(this.state.state,J.state,null,M.error||((F=(U=R.default)[J.state])===null||F===void 0?void 0:F.call(U)));this.enactStateChange(Q),z=="connecting"&&S.default.Config.nextTick(function(){_.startConnect()}),z=="closing"&&this.closeImpl()}},H.prototype.startConnect=function(){var M=this;if(this.state!==this.states.connecting){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var _=this.realtime.auth,U=++this.connectCounter,F=function(){M.checkConnectionStateFreshness(),M.getTransportParams(function(J){if(J.mode==="recover"&&J.options.recover){var Q=j(J.options.recover);Q&&M.realtime.channels.recoverChannels(Q.channelSerials)}U===M.connectCounter&&M.connectImpl(J,U)})};if(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),_.method==="basic")F();else{var z=function(J){U===M.connectCounter&&(J?M.actOnErrorFromAuthorize(J):F())};this.errorReason&&C.default.isTokenErr(this.errorReason)?_._forceNewToken(null,null,z):_._ensureValidAuthCredentials(!1,z)}},H.prototype.connectImpl=function(M,_){var U=this.state.state;U!==this.states.connecting.state&&U!==this.states.connected.state?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+U):this.pendingTransports.length?l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):U==this.states.connected.state?this.upgradeIfNeeded(M):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(M,_):this.connectBase(M,_)},H.prototype.connectPreference=function(M,_){var U=this,F=this.getTransportPreference(),z=!1;h.arrIn(this.transports,F)||(this.unpersistTransportPreference(),this.connectImpl(M,_)),l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+F);var J=setTimeout(function(){z=!0,U.state.state!==U.states.connected.state&&(l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+F+" failed; clearing preference and trying from scratch"),U.disconnectAllTransports(),U.unpersistTransportPreference()),U.connectImpl(M,_)},this.options.timeouts.preferenceConnectTimeout);M.host=this.httpHosts[0],this.tryATransport(M,F,function(Q,Y){clearTimeout(J),z&&Y?(Y.off(),Y.disconnect(),h.arrDeleteValue(U.pendingTransports,Y)):!Y&&!Q&&(U.unpersistTransportPreference(),U.connectImpl(M,_))})},H.prototype.connectBase=function(M,_){var U=this,F=function(ee){U.notifyState({state:U.states.connecting.failState,error:ee})},z=this.httpHosts.slice(),J=function(ee,re){_===U.connectCounter&&!re&&!ee&&Y()};l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var Q=z.shift();if(!Q){F(new x.default("Unable to connect (no available host)",80003,404));return}M.host=Q;var Y=function(){if(!z.length){F(new x.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!U.realtime.http.checkConnectivity){F(new x.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}U.realtime.http.checkConnectivity(function(ee,re){if(_===U.connectCounter){if(ee){F(ee);return}if(!re){F(new x.default("Unable to connect (network unreachable)",80003,404));return}M.host=h.arrPopRandomElement(z),U.tryATransport(M,U.baseTransport,J)}})};if(this.forceFallbackHost&&z.length){this.forceFallbackHost=!1,Y();return}this.tryATransport(M,this.baseTransport,J)},H.prototype.getUpgradePossibilities=function(){var M=this.activeProtocol.getTransport().shortName,_=h.arrIndexOf(this.upgradeTransports,M);return this.upgradeTransports.slice(_+1)},H.prototype.upgradeIfNeeded=function(M){var _=this,U=this.getUpgradePossibilities();l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+S.default.Config.inspect(U)),U.length&&h.arrForEach(U,function(F){var z=_.createTransportParams(M.host,"upgrade");_.tryATransport(z,F,y)})},H.prototype.closeImpl=function(){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),h.safeArrForEach(this.pendingTransports,function(M){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+M),M&&M.close()}),h.safeArrForEach(this.proposedTransports,function(M){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+M),M&&M.dispose()}),this.activeProtocol&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},H.prototype.onAuthUpdated=function(M,_){var U=this,F;switch(this.state.state){case"connected":{if(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var z=this.activeProtocol.getTransport().params;S.default.Config.nextTick(function(){U.state.state==="connected"&&U.upgradeIfNeeded(z)})}var J=(F=this.activeProtocol)===null||F===void 0?void 0:F.getTransport();J&&J.onAuthUpdated&&J.onAuthUpdated(M);var Q=g.default.fromValues({action:d.AUTH,auth:{accessToken:M.token}});this.send(Q);var Y=function(){U.off(ee),_(null,M)},ee=function(X){X.current==="failed"&&(U.off(Y),U.off(ee),_(X.reason||U.getStateError()))};this.once("connectiondetails",Y),this.on("connectionstate",ee);break}case"connecting":l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var re=function(X){switch(X.current){case"connected":U.off(re),_(null,M);break;case"failed":case"closed":case"suspended":U.off(re),_(X.reason||U.getStateError());break}};this.on("connectionstate",re),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},H.prototype.disconnectAllTransports=function(M){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(M?" except the active transport":"")),this.connectCounter++,h.safeArrForEach(this.pendingTransports,function(_){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+_),_&&_.disconnect()}),this.pendingTransports=[],h.safeArrForEach(this.proposedTransports,function(_){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+_),_&&_.dispose()}),this.proposedTransports=[],this.activeProtocol&&!M&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},H.prototype.send=function(M,_,U){U=U||y;var F=this.state;if(F.sendEvents){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new p.PendingMessage(M,U));return}var z=_&&F.queueEvents||F.forceQueueEvents;if(!z){var J="rejecting event, queueEvent was "+_+", state was "+F.state;l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()",J),U(this.errorReason||new x.default(J,9e4,400));return}l.default.shouldLog(l.default.LOG_MICRO)&&l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+g.default.stringify(M)),this.queue(M,U)},H.prototype.sendImpl=function(M){var _=M.message;M.ackRequired&&!M.sendAttempted&&(_.msgSerial=this.msgSerial++);try{this.activeProtocol.send(M)}catch(U){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+U.stack)}},H.prototype.queue=function(M,_){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var U=this.queuedMessages.last(),F=this.options.maxMessageSize;U&&!U.sendAttempted&&k(U.message,M,F)?(U.merged||(U.callback=T.default.create([U.callback]),U.merged=!0),U.callback.push(_)):this.queuedMessages.push(new p.PendingMessage(M,_))},H.prototype.sendQueuedMessages=function(){l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var M;M=this.queuedMessages.shift();)this.sendImpl(M)},H.prototype.queuePendingMessages=function(M){M&&M.length&&(l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+M.length+" pending messages"),this.queuedMessages.prepend(M))},H.prototype.failQueuedMessages=function(M){var _=this.queuedMessages.count();_>0&&(l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+_+" queued messages, err = "+h.inspectError(M)),this.queuedMessages.completeAllMessages(M))},H.prototype.onChannelMessage=function(M,_){var U=this.activeProtocol&&_===this.activeProtocol.getTransport(),F=h.arrIn(this.pendingTransports,_)&&this.state==this.states.synchronizing;U||F?this.realtime.channels.onChannelMessage(M):h.arrIndexOf([d.ACK,d.NACK,d.ERROR],M.action)>-1?this.realtime.channels.onChannelMessage(M):l.default.logAction(l.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(M)+"on defunct transport; discarding")},H.prototype.ping=function(M,_){var U=this;if(M){l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+M);var F=function(){M.off("heartbeat",Q),_(new x.default("Timeout waiting for heartbeat response",5e4,500))},z=h.now(),J=h.cheapRandStr(),Q=function(ie){if(ie===J){M.off("heartbeat",Q),clearTimeout(Y);var fe=h.now()-z;_(null,fe)}},Y=setTimeout(F,this.options.timeouts.realtimeRequestTimeout);M.on("heartbeat",Q),M.ping(J);return}if(this.state.state!=="connected"){_(new x.default("Unable to ping service; not connected",4e4,400));return}var ee=!1,re=function(ie,fe){U.off("transport.active",X),ee||(ee=!0,_(ie,fe))},X=function(){ee||(ee=!0,S.default.Config.nextTick(function(){U.ping(null,_)}))};this.on("transport.active",X),this.ping(this.activeProtocol.getTransport(),re)},H.prototype.abort=function(M){this.activeProtocol.getTransport().fail(M)},H.prototype.registerProposedTransport=function(M){this.proposedTransports.push(M)},H.prototype.getTransportPreference=function(){var M,_;return this.transportPreference||a()&&((_=(M=S.default.WebStorage)===null||M===void 0?void 0:M.get)===null||_===void 0?void 0:_.call(M,N))},H.prototype.persistTransportPreference=function(M){var _,U;h.arrIn(w.default.upgradeTransports,M.shortName)&&(this.transportPreference=M.shortName,a()&&((U=(_=S.default.WebStorage)===null||_===void 0?void 0:_.set)===null||U===void 0||U.call(_,N,M.shortName)))},H.prototype.unpersistTransportPreference=function(){var M,_;this.transportPreference=null,a()&&((_=(M=S.default.WebStorage)===null||M===void 0?void 0:M.remove)===null||_===void 0||_.call(M,N))},H.prototype.actOnErrorFromAuthorize=function(M){if(M.code===40171)this.notifyState({state:"failed",error:M});else if(M.code===40102)this.notifyState({state:"failed",error:M});else if(M.statusCode===u.default.Forbidden){var _="Client configured authentication provider returned 403; failing the connection";l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",_),this.notifyState({state:"failed",error:new x.default(_,80019,403,M)})}else{var _="Client configured authentication provider request failed";l.default.logAction(l.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",_),this.notifyState({state:this.state.failState,error:new x.default(_,80019,401,M)})}},H.prototype.onConnectionDetailsUpdate=function(M,_){if(M){this.connectionDetails=M,M.maxMessageSize&&(this.options.maxMessageSize=M.maxMessageSize);var U=M.clientId;if(U){var F=this.realtime.auth._uncheckedSetClientId(U);if(F){l.default.logAction(l.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",F.message),_.fail(F);return}}var z=M.connectionStateTtl;z&&(this.connectionStateTtl=z),this.maxIdleInterval=M.maxIdleInterval,this.emit("connectiondetails",M)}},H.supportedTransports={},H}(A.default);t.default=$}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(7)),g=s.__importDefault(i(2)),h=function(p){s.__extends(w,p);function w(){var S=p.call(this)||this;return S.messages=[],S}return w.prototype.count=function(){return this.messages.length},w.prototype.push=function(S){this.messages.push(S)},w.prototype.shift=function(){return this.messages.shift()},w.prototype.last=function(){return this.messages[this.messages.length-1]},w.prototype.copyAll=function(){return this.messages.slice()},w.prototype.append=function(S){this.messages.push.apply(this.messages,S)},w.prototype.prepend=function(S){this.messages.unshift.apply(this.messages,S)},w.prototype.completeMessages=function(S,A,P){g.default.logAction(g.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+S+"; count = "+A),P=P||null;var l=this.messages;if(l.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var E=l[0];if(E){var R=E.message.msgSerial,x=S+A;if(x>R)for(var C=l.splice(0,x-R),b=0,T=C;b<T.length;b++){var f=T[b];f.callback(P)}l.length==0&&this.emit("idle")}},w.prototype.completeAllMessages=function(S){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,S)},w.prototype.resetSendAttempted=function(){for(var S=0,A=this.messages;S<A.length;S++){var P=A[S];P.sendAttempted=!1}},w.prototype.clear=function(){g.default.logAction(g.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},w}(o.default);t.default=h},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(g,h,p,w){this.previous=g,this.current=h,p&&(this.retryIn=p),w&&(this.reason=w)}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),g=s.__importDefault(i(7)),h=s.__importStar(i(1)),p=s.__importDefault(i(33)),w=s.__importDefault(i(2)),S=s.__importDefault(i(54)),A=s.__importDefault(i(9)),P=s.__importDefault(i(39)),l=s.__importStar(i(4)),E=s.__importDefault(i(16)),R=s.__importDefault(i(21)),x=o.default.Action,C=function(){};function b(c){if(c&&"params"in c&&!h.isObject(c.params))return new l.default("options.params must be an object",4e4,400);if(c&&"modes"in c){if(!h.isArray(c.modes))return new l.default("options.modes must be an array",4e4,400);for(var u=0;u<c.modes.length;u++){var a=c.modes[u];if(!a||typeof a!="string"||!h.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(a)))return new l.default("Invalid channel mode: "+a,4e4,400)}}}var T=function(c){s.__extends(u,c);function u(a,v,d){var y=c.call(this,a,v,d)||this;return y.retryCount=0,y.history=function(N,D){if(w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),D===void 0)if(typeof N=="function")D=N,N=null;else{if(this.rest.options.promises)return h.promisify(this,"history",arguments);D=C}if(N&&N.untilAttach){if(this.state!=="attached"){D(new l.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){D(new l.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete N.untilAttach,N.from_serial=this.properties.attachSerial}p.default.prototype._history.call(this,N,D)},y.whenState=function(N,D){return g.default.prototype.whenState.call(y,N,y.state,D)},w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel()","started; name = "+v),y.realtime=a,y.presence=new S.default(y),y.connectionManager=a.connection.connectionManager,y.state="initialized",y.subscriptions=new g.default,y.syncChannelSerial=void 0,y.properties={attachSerial:void 0,channelSerial:void 0},y.setOptions(d),y.errorReason=null,y._requestedFlags=null,y._mode=null,y._attachResume=!1,y._decodingContext={channelOptions:y.channelOptions,plugins:a.options.plugins||{},baseEncodedPreviousPayload:void 0},y._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},y._allChannelChanges=new g.default,y}return u.prototype.invalidStateError=function(){return new l.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},u.processListenerArgs=function(a){return a=Array.prototype.slice.call(a),typeof a[0]=="function"&&a.unshift(null),a[a.length-1]==null&&a.pop(),a},u.prototype.setOptions=function(a,v){var d=this.channelOptions;if(!v&&this.rest.options.promises)return h.promisify(this,"setOptions",arguments);var y=v||function(D){D&&w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+D.toString())},N=b(a);if(N){y(N);return}p.default.prototype.setOptions.call(this,a),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(a,d)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(D){switch(this.event){case"update":case"attached":y==null||y(null);return;default:y==null||y(D.reason);return}})):y()},u.prototype._shouldReattachToSetOptions=function(a,v){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(a!=null&&a.params){var d=f(a.params),y=f(v.params);if(Object.keys(d).length!==Object.keys(y).length||!h.shallowEquals(y,d))return!0}return!!(a!=null&&a.modes&&(!v.modes||!h.arrEquals(a.modes,v.modes)))},u.prototype.publish=function(){for(var a=this,v=[],d=0;d<arguments.length;d++)v[d]=arguments[d];var y=v[0],N=v.length,D=v[N-1];if(typeof D!="function"){if(this.realtime.options.promises)return h.promisify(this,"publish",arguments);D=C,++N}if(!this.connectionManager.activeState()){D(this.connectionManager.getError());return}if(N==2)if(h.isObject(y))y=[A.default.fromValues(y)];else if(h.isArray(y))y=A.default.fromValuesArray(y);else throw new l.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else y=[A.default.fromValues({name:v[0],data:v[1]})];var L=this.realtime.options.maxMessageSize;A.default.encodeArray(y,this.channelOptions,function(I){if(I){D(I);return}var m=A.default.getMessagesSize(y);if(m>L){D(new l.default("Maximum size of messages that can be published at once exceeded ( was "+m+" bytes; limit is "+L+" bytes)",40009,400));return}a.__publish(y,D)})},u.prototype.__publish=function(a,v){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+a.length);var d=this.state;switch(d){case"failed":case"suspended":v(l.default.fromValues(this.invalidStateError()));break;default:{w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+d);var y=new o.default;y.action=x.MESSAGE,y.channel=this.name,y.messages=a,this.sendMessage(y,v);break}}},u.prototype.onEvent=function(a){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var v=this.subscriptions,d=0;d<a.length;d++){var y=a[d];v.emit(y.name,y)}},u.prototype.attach=function(a,v){var d;if(typeof a=="function"?(v=a,d=null):d=a,!v){if(this.realtime.options.promises)return h.promisify(this,"attach",arguments);v=function(y){y&&w.default.logAction(w.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+y.toString())}}if(d)w.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=d;else if(this.state==="attached"){v(null,null);return}this._attach(!1,null,v)},u.prototype._attach=function(a,v,d){d||(d=function(N){N&&w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+N.toString())});var y=this.connectionManager;if(!y.activeState()){d(y.getError());return}(this.state!=="attaching"||a)&&this.requestState("attaching",v),this.once(function(N){switch(this.event){case"attached":d==null||d(null,N);break;case"detached":case"suspended":case"failed":d==null||d(N.reason||y.getError()||new l.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":d==null||d(new l.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},u.prototype.attachImpl=function(){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var a=o.default.fromValues({action:x.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?a.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&a.encodeModesToFlags(h.allToUpperCase(this.channelOptions.modes)),this._attachResume&&a.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(a.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(a,C)},u.prototype.detach=function(a){if(!a){if(this.realtime.options.promises)return h.promisify(this,"detach",arguments);a=C}var v=this.connectionManager;if(!v.activeState()){a(v.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),a();break;case"detached":a();break;case"failed":a(new l.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(d){switch(this.event){case"detached":a();break;case"attached":case"suspended":case"failed":a(d.reason||v.getError()||new l.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":a(new l.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},u.prototype.detachImpl=function(a){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var v=o.default.fromValues({action:x.DETACH,channel:this.name});this.sendMessage(v,a||C)},u.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var d=u.processListenerArgs(a),y=d[0],N=d[1],D=d[2];if(!D&&this.realtime.options.promises)return h.promisify(this,"subscribe",[y,N]);if(this.state==="failed"){D==null||D(l.default.fromValues(this.invalidStateError()));return}return y&&typeof y=="object"&&!Array.isArray(y)?this._subscribeFilter(y,N):this.subscriptions.on(y,N),this.attach(D||C)},u.prototype._subscribeFilter=function(a,v){var d=function(y){var N,D,L,I,m,O,k={name:y.name,refTimeserial:(D=(N=y.extras)===null||N===void 0?void 0:N.ref)===null||D===void 0?void 0:D.timeserial,refType:(I=(L=y.extras)===null||L===void 0?void 0:L.ref)===null||I===void 0?void 0:I.type,isRef:!!(!((O=(m=y.extras)===null||m===void 0?void 0:m.ref)===null||O===void 0)&&O.timeserial),clientId:y.clientId};Object.entries(a).find(function(j){var B=j[0],$=j[1];return $!==void 0?k[B]!==$:!1})||v(y)};this._addFilteredSubscription(a,v,d),this.subscriptions.on(d)},u.prototype._addFilteredSubscription=function(a,v,d){var y;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(v)){var N=this.filteredSubscriptions.get(v);N.set(a,((y=N==null?void 0:N.get(a))===null||y===void 0?void 0:y.concat(d))||[d])}else this.filteredSubscriptions.set(v,new Map([[a,[d]]]))},u.prototype._getAndDeleteFilteredSubscriptions=function(a,v){var d=this;if(!this.filteredSubscriptions)return[];if(!v&&a)return Array.from(this.filteredSubscriptions.entries()).map(function(L){var I,m=L[0],O=L[1],k=O.get(a);return O.delete(a),O.size===0&&((I=d.filteredSubscriptions)===null||I===void 0||I.delete(m)),k}).reduce(function(L,I){var m;return I?(m=L).concat.apply(m,I):L},[]);if(!v||!this.filteredSubscriptions.has(v))return[];var y=this.filteredSubscriptions.get(v);if(!a){var N=Array.from(y.values()).reduce(function(L,I){return L.concat.apply(L,I)},[]);return this.filteredSubscriptions.delete(v),N}var D=y.get(a);return y.delete(a),D||[]},u.prototype.unsubscribe=function(){for(var a=this,v,d=[],y=0;y<arguments.length;y++)d[y]=arguments[y];var N=u.processListenerArgs(d),D=N[0],L=N[1];if(typeof D=="object"&&!L||!((v=this.filteredSubscriptions)===null||v===void 0)&&v.has(L)){this._getAndDeleteFilteredSubscriptions(D,L).forEach(function(I){return a.subscriptions.off(I)});return}this.subscriptions.off(D,L)},u.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new l.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var a=this.connectionManager;if(!a.activeState())throw a.getError();var v=o.default.fromValues({action:x.SYNC,channel:this.name});this.syncChannelSerial&&(v.channelSerial=this.syncChannelSerial),a.send(v)},u.prototype.sendMessage=function(a,v){this.connectionManager.send(a,this.realtime.options.queueMessages,v)},u.prototype.sendPresence=function(a,v){var d=o.default.fromValues({action:x.PRESENCE,channel:this.name,presence:h.isArray(a)?E.default.fromValuesArray(a):[E.default.fromValues(a)]});this.sendMessage(d,v)},u.prototype.onMessage=function(a){(a.action===x.ATTACHED||a.action===x.MESSAGE||a.action===x.PRESENCE)&&this.setChannelSerial(a.channelSerial);var v,d=!1;switch(a.action){case x.ATTACHED:{this.properties.attachSerial=a.channelSerial,this._mode=a.getMode(),this.params=a.params||{};var y=a.decodeModesFromFlags();this.modes=y&&h.allToLowerCase(y)||void 0;var N=a.hasFlag("RESUMED"),D=a.hasFlag("HAS_PRESENCE"),L=a.hasFlag("HAS_BACKLOG");if(this.state==="attached"){N||this.presence.onAttached(D);var I=new P.default(this.state,this.state,N,L,a.error);this._allChannelChanges.emit("update",I),(!N||this.channelOptions.updateOnAttached)&&this.emit("update",I)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",a.error,N,D,L);break}case x.DETACHED:{var m=a.error?l.default.fromValues(a.error):new l.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",m):this.state==="attaching"?this.notifyState("suspended",m):this.requestState("attaching",m);break}case x.SYNC:if(d=!0,v=this.syncChannelSerial=a.channelSerial,!a.presence)break;case x.PRESENCE:{for(var O=a.presence,k=a.id,j=a.connectionId,B=a.timestamp,$=this.channelOptions,V=void 0,H=0;H<O.length;H++)try{V=O[H],E.default.decode(V,$),V.connectionId||(V.connectionId=j),V.timestamp||(V.timestamp=B),V.id||(V.id=k+":"+H)}catch(J){w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()",J.toString())}this.presence.setPresence(O,d,v);break}case x.MESSAGE:{if(this.state!=="attached"){w.default.logAction(w.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+a.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var M=a.messages,_=M[0],U=M[M.length-1],k=a.id,j=a.connectionId,B=a.timestamp;if(_.extras&&_.extras.delta&&_.extras.delta.from!==this._lastPayload.messageId){var F='Delta message decode failure - previous message not available for message "'+a.id+'" on this channel "'+this.name+'".';w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()",F),this._startDecodeFailureRecovery(new l.default(F,40018,400));break}for(var H=0;H<M.length;H++){var F=M[H];try{A.default.decode(F,this._decodingContext)}catch(X){switch(w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()",X.toString()),X.code){case 40018:this._startDecodeFailureRecovery(X);return;case 40019:case 40021:this.notifyState("failed",X);return}}F.connectionId||(F.connectionId=j),F.timestamp||(F.timestamp=B),F.id||(F.id=k+":"+H)}this._lastPayload.messageId=U.id,this._lastPayload.protocolMessageChannelSerial=a.channelSerial,this.onEvent(M);break}case x.ERROR:{var z=a.error;z&&z.code==80016?this.checkPendingState():this.notifyState("failed",l.default.fromValues(z));break}default:w.default.logAction(w.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+a.action+")"),this.connectionManager.abort(R.default.unknownChannelErr())}},u.prototype._startDecodeFailureRecovery=function(a){var v=this;this._lastPayload.decodeFailureRecoveryInProgress||(w.default.logAction(w.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,a,function(){v._lastPayload.decodeFailureRecoveryInProgress=!1}))},u.prototype.onAttached=function(){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},u.prototype.notifyState=function(a,v,d,y,N){if(w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+a),this.clearStateTimer(),h.arrIn(["detached","suspended","failed"],a)&&(this.properties.channelSerial=null),a!==this.state){this.presence.actOnChannelState(a,y,v),a==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),v&&(this.errorReason=v);var D=new P.default(this.state,a,d,N,v),L=a==="failed"?w.default.LOG_ERROR:w.default.LOG_MAJOR;w.default.logAction(L,'Channel state for channel "'+this.name+'"',a+(v?"; reason: "+v:"")),a!=="attaching"&&a!=="suspended"&&(this.retryCount=0),a==="attached"&&this.onAttached(),a==="attached"?this._attachResume=!0:(a==="detaching"||a==="failed")&&(this._attachResume=!1),this.state=a,this._allChannelChanges.emit(a,D),this.emit(a,D)}},u.prototype.requestState=function(a,v){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+a),this.notifyState(a,v),this.checkPendingState()},u.prototype.checkPendingState=function(){var a=this.connectionManager.state;if(!(a.sendEvents||a.forceQueueEvents)){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},u.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var a=new l.default("Channel attach timed out",90007,408);this.notifyState("suspended",a);break}case"detaching":{var a=new l.default("Channel detach timed out",90007,408);this.notifyState("attached",a);break}default:this.checkPendingState();break}},u.prototype.startStateTimerIfNotRunning=function(){var a=this;this.stateTimer||(this.stateTimer=setTimeout(function(){w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),a.stateTimer=null,a.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},u.prototype.clearStateTimer=function(){var a=this.stateTimer;a&&(clearTimeout(a),this.stateTimer=null)},u.prototype.startRetryTimer=function(){var a=this;if(!this.retryTimer){this.retryCount++;var v=h.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){a.state==="suspended"&&a.connectionManager.state.sendEvents&&(a.retryTimer=null,w.default.logAction(w.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),a.requestState("attaching"))},v)}},u.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},u.prototype.getReleaseErr=function(){var a=this.state;return a==="initialized"||a==="detached"||a==="failed"?null:new l.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+a,90001,400)},u.prototype.setChannelSerial=function(a){w.default.logAction(w.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+a+"; previous = "+this.properties.channelSerial),a&&(this.properties.channelSerial=a)},u}(p.default);function f(c){var u=c||{};u.agent;var a=s.__rest(u,["agent"]);return a}t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(g,h,p,w,S){this.previous=g,this.current=h,h==="attached"&&(this.resumed=p,this.hasBacklog=w),S&&(this.reason=S)}return o}();t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,g=o.lib,h=g.WordArray,p=g.Hasher,w=o.algo,S=[],A=w.SHA1=p.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(P,l){for(var E=this._hash.words,R=E[0],x=E[1],C=E[2],b=E[3],T=E[4],f=0;f<80;f++){if(f<16)S[f]=P[l+f]|0;else{var c=S[f-3]^S[f-8]^S[f-14]^S[f-16];S[f]=c<<1|c>>>31}var u=(R<<5|R>>>27)+T+S[f];f<20?u+=(x&C|~x&b)+1518500249:f<40?u+=(x^C^b)+1859775393:f<60?u+=(x&C|x&b|C&b)-1894007588:u+=(x^C^b)-899497514,T=b,b=C,C=x<<30|x>>>2,x=R,R=u}E[0]=E[0]+R|0,E[1]=E[1]+x|0,E[2]=E[2]+C|0,E[3]=E[3]+b|0,E[4]=E[4]+T|0},_doFinalize:function(){var P=this._data,l=P.words,E=this._nDataBytes*8,R=P.sigBytes*8;return l[R>>>5]|=128<<24-R%32,l[(R+64>>>9<<4)+14]=Math.floor(E/4294967296),l[(R+64>>>9<<4)+15]=E,P.sigBytes=l.length*4,this._process(),this._hash},clone:function(){var P=p.clone.call(this);return P._hash=this._hash.clone(),P}});o.SHA1=p._createHelper(A),o.HmacSHA1=p._createHmacHelper(A)}(),s.SHA1})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});function s(f){if(f===void 0)return"undefined";var c,u;if(f instanceof ArrayBuffer?(u="ArrayBuffer",c=new DataView(f)):f instanceof DataView&&(u="DataView",c=f),!c)return JSON.stringify(f);for(var a=[],v=0;v<f.byteLength;v++){if(v>20){a.push("...");break}var d=c.getUint8(v).toString(16);d.length===1&&(d="0"+d),a.push(d)}return"<"+u+" "+a.join(" ")+">"}function o(f,c,u){for(var a=0,v=u.length;a<v;a++){var d=u.charCodeAt(a);if(d<128){f.setUint8(c++,d>>>0&127|0);continue}if(d<2048){f.setUint8(c++,d>>>6&31|192),f.setUint8(c++,d>>>0&63|128);continue}if(d<65536){f.setUint8(c++,d>>>12&15|224),f.setUint8(c++,d>>>6&63|128),f.setUint8(c++,d>>>0&63|128);continue}if(d<1114112){f.setUint8(c++,d>>>18&7|240),f.setUint8(c++,d>>>12&63|128),f.setUint8(c++,d>>>6&63|128),f.setUint8(c++,d>>>0&63|128);continue}throw new Error("bad codepoint "+d)}}function g(f,c,u){for(var a="",v=c,d=c+u;v<d;v++){var y=f.getUint8(v);if(!(y&128)){a+=String.fromCharCode(y);continue}if((y&224)===192){a+=String.fromCharCode((y&15)<<6|f.getUint8(++v)&63);continue}if((y&240)===224){a+=String.fromCharCode((y&15)<<12|(f.getUint8(++v)&63)<<6|(f.getUint8(++v)&63)<<0);continue}if((y&248)===240){a+=String.fromCharCode((y&7)<<18|(f.getUint8(++v)&63)<<12|(f.getUint8(++v)&63)<<6|(f.getUint8(++v)&63)<<0);continue}throw new Error("Invalid byte "+y.toString(16))}return a}function h(f){for(var c=0,u=0,a=f.length;u<a;u++){var v=f.charCodeAt(u);if(v<128){c+=1;continue}if(v<2048){c+=2;continue}if(v<65536){c+=3;continue}if(v<1114112){c+=4;continue}throw new Error("bad codepoint "+v)}return c}function p(f,c){var u=T(f,c);if(u!==0){var a=new ArrayBuffer(u),v=new DataView(a);return b(f,v,0,c),a}}var w=65536*65536,S=1/w;function A(f,c){return c=c||0,f.getInt32(c)*w+f.getUint32(c+4)}function P(f,c){return c=c||0,f.getUint32(c)*w+f.getUint32(c+4)}function l(f,c,u){u<9223372036854776e3?(f.setInt32(c,Math.floor(u*S)),f.setInt32(c+4,u&-1)):(f.setUint32(c,2147483647),f.setUint32(c+4,2147483647))}function E(f,c,u){u<18446744073709552e3?(f.setUint32(c,Math.floor(u*S)),f.setInt32(c+4,u&-1)):(f.setUint32(c,4294967295),f.setUint32(c+4,4294967295))}var R=function(){function f(c,u){var a=this;this.map=function(v){for(var d={},y=0;y<v;y++){var N=a.parse();d[N]=a.parse()}return d},this.bin=function(v){var d=new ArrayBuffer(v);return new Uint8Array(d).set(new Uint8Array(a.view.buffer,a.offset,v),0),a.offset+=v,d},this.buf=this.bin,this.str=function(v){var d=g(a.view,a.offset,v);return a.offset+=v,d},this.array=function(v){for(var d=new Array(v),y=0;y<v;y++)d[y]=a.parse();return d},this.ext=function(v){return a.offset+=v,{type:a.view.getInt8(a.offset),data:a.buf(v)}},this.parse=function(){var v=a.view.getUint8(a.offset),d,y;if(!(v&128))return a.offset++,v;if((v&240)===128)return y=v&15,a.offset++,a.map(y);if((v&240)===144)return y=v&15,a.offset++,a.array(y);if((v&224)===160)return y=v&31,a.offset++,a.str(y);if((v&224)===224)return d=a.view.getInt8(a.offset),a.offset++,d;switch(v){case 192:return a.offset++,null;case 193:a.offset++;return;case 194:return a.offset++,!1;case 195:return a.offset++,!0;case 196:return y=a.view.getUint8(a.offset+1),a.offset+=2,a.bin(y);case 197:return y=a.view.getUint16(a.offset+1),a.offset+=3,a.bin(y);case 198:return y=a.view.getUint32(a.offset+1),a.offset+=5,a.bin(y);case 199:return y=a.view.getUint8(a.offset+1),a.offset+=2,a.ext(y);case 200:return y=a.view.getUint16(a.offset+1),a.offset+=3,a.ext(y);case 201:return y=a.view.getUint32(a.offset+1),a.offset+=5,a.ext(y);case 202:return d=a.view.getFloat32(a.offset+1),a.offset+=5,d;case 203:return d=a.view.getFloat64(a.offset+1),a.offset+=9,d;case 204:return d=a.view.getUint8(a.offset+1),a.offset+=2,d;case 205:return d=a.view.getUint16(a.offset+1),a.offset+=3,d;case 206:return d=a.view.getUint32(a.offset+1),a.offset+=5,d;case 207:return d=P(a.view,a.offset+1),a.offset+=9,d;case 208:return d=a.view.getInt8(a.offset+1),a.offset+=2,d;case 209:return d=a.view.getInt16(a.offset+1),a.offset+=3,d;case 210:return d=a.view.getInt32(a.offset+1),a.offset+=5,d;case 211:return d=A(a.view,a.offset+1),a.offset+=9,d;case 212:return y=1,a.offset++,a.ext(y);case 213:return y=2,a.offset++,a.ext(y);case 214:return y=4,a.offset++,a.ext(y);case 215:return y=8,a.offset++,a.ext(y);case 216:return y=16,a.offset++,a.ext(y);case 217:return y=a.view.getUint8(a.offset+1),a.offset+=2,a.str(y);case 218:return y=a.view.getUint16(a.offset+1),a.offset+=3,a.str(y);case 219:return y=a.view.getUint32(a.offset+1),a.offset+=5,a.str(y);case 220:return y=a.view.getUint16(a.offset+1),a.offset+=3,a.array(y);case 221:return y=a.view.getUint32(a.offset+1),a.offset+=5,a.array(y);case 222:return y=a.view.getUint16(a.offset+1),a.offset+=3,a.map(y);case 223:return y=a.view.getUint32(a.offset+1),a.offset+=5,a.map(y)}throw new Error("Unknown type 0x"+v.toString(16))},this.offset=u||0,this.view=c}return f}();function x(f){var c=new DataView(f),u=new R(c),a=u.parse();if(u.offset!==f.byteLength)throw new Error(f.byteLength-u.offset+" trailing bytes");return a}function C(f,c){return Object.keys(f).filter(function(u){var a=f[u],v=typeof a;return(!c||a!=null)&&(v!=="function"||!!a.toJSON)})}function b(f,c,u,a){var v=typeof f;if(typeof f=="string"){var d=h(f);if(d<32)return c.setUint8(u,d|160),o(c,u+1,f),1+d;if(d<256)return c.setUint8(u,217),c.setUint8(u+1,d),o(c,u+2,f),2+d;if(d<65536)return c.setUint8(u,218),c.setUint16(u+1,d),o(c,u+3,f),3+d;if(d<4294967296)return c.setUint8(u,219),c.setUint32(u+1,d),o(c,u+5,f),5+d}if(ArrayBuffer.isView&&ArrayBuffer.isView(f)&&(f=f.buffer),f instanceof ArrayBuffer){var y=f.byteLength;if(y<256)return c.setUint8(u,196),c.setUint8(u+1,y),new Uint8Array(c.buffer).set(new Uint8Array(f),u+2),2+y;if(y<65536)return c.setUint8(u,197),c.setUint16(u+1,y),new Uint8Array(c.buffer).set(new Uint8Array(f),u+3),3+y;if(y<4294967296)return c.setUint8(u,198),c.setUint32(u+1,y),new Uint8Array(c.buffer).set(new Uint8Array(f),u+5),5+y}if(typeof f=="number"){if(Math.floor(f)!==f)return c.setUint8(u,203),c.setFloat64(u+1,f),9;if(f>=0){if(f<128)return c.setUint8(u,f),1;if(f<256)return c.setUint8(u,204),c.setUint8(u+1,f),2;if(f<65536)return c.setUint8(u,205),c.setUint16(u+1,f),3;if(f<4294967296)return c.setUint8(u,206),c.setUint32(u+1,f),5;if(f<18446744073709552e3)return c.setUint8(u,207),E(c,u+1,f),9;throw new Error("Number too big 0x"+f.toString(16))}if(f>=-32)return c.setInt8(u,f),1;if(f>=-128)return c.setUint8(u,208),c.setInt8(u+1,f),2;if(f>=-32768)return c.setUint8(u,209),c.setInt16(u+1,f),3;if(f>=-2147483648)return c.setUint8(u,210),c.setInt32(u+1,f),5;if(f>=-9223372036854776e3)return c.setUint8(u,211),l(c,u+1,f),9;throw new Error("Number too small -0x"+(-f).toString(16).substr(1))}if(v==="undefined")return a?0:(c.setUint8(u,212),c.setUint8(u+1,0),c.setUint8(u+2,0),3);if(f===null)return a?0:(c.setUint8(u,192),1);if(v==="boolean")return c.setUint8(u,f?195:194),1;if(typeof f.toJSON=="function")return b(f.toJSON(),c,u,a);if(v==="object"){var N,D=0,L=void 0,I=Array.isArray(f);if(I?N=f.length:(L=C(f,a),N=L.length),N<16?(c.setUint8(u,N|(I?144:128)),D=1):N<65536?(c.setUint8(u,I?220:222),c.setUint16(u+1,N),D=3):N<4294967296&&(c.setUint8(u,I?221:223),c.setUint32(u+1,N),D=5),I)for(var m=0;m<N;m++)D+=b(f[m],c,u+D,a);else if(L)for(var m=0;m<N;m++){var O=L[m];D+=b(O,c,u+D),D+=b(f[O],c,u+D,a)}return D}if(v==="function")return 0;throw new Error("Unknown type "+v)}function T(f,c){var u=typeof f;if(u==="string"){var a=h(f);if(a<32)return 1+a;if(a<256)return 2+a;if(a<65536)return 3+a;if(a<4294967296)return 5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(f)&&(f=f.buffer),f instanceof ArrayBuffer){var v=f.byteLength;if(v<256)return 2+v;if(v<65536)return 3+v;if(v<4294967296)return 5+v}if(typeof f=="number"){if(Math.floor(f)!==f)return 9;if(f>=0){if(f<128)return 1;if(f<256)return 2;if(f<65536)return 3;if(f<4294967296)return 5;if(f<18446744073709552e3)return 9;throw new Error("Number too big 0x"+f.toString(16))}if(f>=-32)return 1;if(f>=-128)return 2;if(f>=-32768)return 3;if(f>=-2147483648)return 5;if(f>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+f.toString(16).substr(1))}if(u==="boolean")return 1;if(f===null)return c?0:1;if(f===void 0)return c?0:3;if(typeof f.toJSON=="function")return T(f.toJSON(),c);if(u==="object"){var d,y=0;if(Array.isArray(f)){d=f.length;for(var N=0;N<d;N++)y+=T(f[N],c)}else{var D=C(f,c);d=D.length;for(var N=0;N<d;N++){var L=D[N];y+=T(L)+T(f[L],c)}}if(d<16)return 1+y;if(d<65536)return 3+y;if(d<4294967296)return 5+y;throw new Error("Array or object too long 0x"+d.toString(16))}if(u==="function")return 0;throw new Error("Unknown type "+u)}t.default={encode:p,decode:x,inspect:s,utf8Write:o,utf8Read:g,utf8ByteCount:h}},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(30)),g=s.__importDefault(i(50)),h=s.__importDefault(i(3)),p=s.__importDefault(i(4)),w=s.__importDefault(i(55)),S=s.__importDefault(i(57)),A=s.__importDefault(i(62)),P=s.__importDefault(i(64)),l=s.__importDefault(i(68)),E=s.__importDefault(i(2)),R=i(8),x=s.__importDefault(i(65)),C=s.__importDefault(i(66)),b=s.__importDefault(i(41)),T=(0,S.default)(P.default,w.default);h.default.Crypto=T,h.default.BufferUtils=w.default,h.default.Http=A.default,h.default.Config=P.default,h.default.Transports=l.default,h.default.WebStorage=x.default,o.default.Crypto=T,g.default.Crypto=T,E.default.initLogHandlers(),h.default.Defaults=(0,R.getDefaults)(C.default),h.default.Config.agent&&(h.default.Defaults.agent+=" "+h.default.Config.agent),h.default.Config.noUpgrade&&(h.default.Defaults.upgradeTransports=[]),t.default={ErrorInfo:p.default,Rest:o.default,Realtime:g.default,msgpack:b.default}},function(n){n.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(n,t){},function(n,t,i){(function(s,o){n.exports=o(i(6),i(32),i(25))})(this,function(s){return s.HmacSHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(47)),h=s.__importDefault(i(15)),p=s.__importDefault(i(20)),w=s.__importDefault(i(4)),S=s.__importDefault(i(48)),A=function(){},P=function(){function x(C){this.rest=C,this.admin=new l(C)}return x}(),l=function(){function x(C){this.rest=C,this.deviceRegistrations=new E(C),this.channelSubscriptions=new R(C)}return x.prototype.publish=function(C,b,T){var f=this.rest,c=f.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,u=o.defaultPostHeaders(f.options,c),a={},v=o.mixin({recipient:C},b);if(typeof T!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);T=A}f.options.headers&&o.mixin(u,f.options.headers),f.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var d=o.encodeBody(v,c);h.default.post(f,"/push/publish",d,u,a,null,function(y){return T(y)})},x}(),E=function(){function x(C){this.rest=C}return x.prototype.save=function(C,b){var T=this.rest,f=g.default.fromValues(C),c=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,u=o.defaultPostHeaders(T.options,c),a={};if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);b=A}T.options.headers&&o.mixin(u,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(f,c);h.default.put(T,"/push/deviceRegistrations/"+encodeURIComponent(C.id),v,u,a,null,function(d,y,N,D){b(d,d?void 0:g.default.fromResponseBody(y,D?void 0:c))})},x.prototype.get=function(C,b){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f),u=C.id||C;if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);b=A}if(typeof u!="string"||!u.length){b(new w.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(c,T.options.headers),h.default.get(T,"/push/deviceRegistrations/"+encodeURIComponent(u),c,{},null,function(a,v,d,y){b(a,a?void 0:g.default.fromResponseBody(v,y?void 0:f))})},x.prototype.list=function(C,b){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:f,u=o.defaultGetHeaders(T.options,f);if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);b=A}T.options.headers&&o.mixin(u,T.options.headers),new p.default(T,"/push/deviceRegistrations",u,c,function(a,v,d){return g.default.fromResponseBody(a,d?void 0:f)}).get(C,b)},x.prototype.remove=function(C,b){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f),u={},a=C.id||C;if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);b=A}if(typeof a!="string"||!a.length){b(new w.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(u,{fullWait:"true"}),h.default.delete(T,"/push/deviceRegistrations/"+encodeURIComponent(a),c,u,null,function(v){return b(v)})},x.prototype.removeWhere=function(C,b){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f);if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);b=A}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),h.default.delete(T,"/push/deviceRegistrations",c,C,null,function(u){return b(u)})},x}(),R=function(){function x(C){this.remove=x.prototype.removeWhere,this.rest=C}return x.prototype.save=function(C,b){var T=this.rest,f=S.default.fromValues(C),c=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,u=o.defaultPostHeaders(T.options,c),a={};if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);b=A}T.options.headers&&o.mixin(u,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(f,c);h.default.post(T,"/push/channelSubscriptions",v,u,a,null,function(d,y,N,D){b(d,!d&&S.default.fromResponseBody(y,D?void 0:c))})},x.prototype.list=function(C,b){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:f,u=o.defaultGetHeaders(T.options,f);if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);b=A}T.options.headers&&o.mixin(u,T.options.headers),new p.default(T,"/push/channelSubscriptions",u,c,function(a,v,d){return S.default.fromResponseBody(a,d?void 0:f)}).get(C,b)},x.prototype.removeWhere=function(C,b){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,f);if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);b=A}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),h.default.delete(T,"/push/channelSubscriptions",c,C,null,function(u){return b(u)})},x.prototype.listChannels=function(C,b){var T=this.rest,f=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:f,u=o.defaultGetHeaders(T.options,f);if(typeof b!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);b=A}T.options.headers&&o.mixin(u,T.options.headers),T.options.pushFullWait&&o.mixin(C,{fullWait:"true"}),new p.default(T,"/push/channels",u,c,function(a,v,d){for(var y=!d&&f?o.decodeBody(a,f):a,N=0;N<y.length;N++)y[N]=String(y[N]);return y}).get(C,b)},x}();t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(4)),h;(function(S){S.Phone="phone",S.Tablet="tablet",S.Desktop="desktop",S.TV="tv",S.Watch="watch",S.Car="car",S.Embedded="embedded",S.Other="other"})(h||(h={}));var p;(function(S){S.Android="android",S.IOS="ios",S.Browser="browser"})(p||(p={}));var w=function(){function S(){}return S.prototype.toJSON=function(){var A,P,l;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(A=this.push)===null||A===void 0?void 0:A.recipient,state:(P=this.push)===null||P===void 0?void 0:P.state,error:(l=this.push)===null||l===void 0?void 0:l.error}}},S.prototype.toString=function(){var A,P,l,E,R="[DeviceDetails";return this.id&&(R+="; id="+this.id),this.platform&&(R+="; platform="+this.platform),this.formFactor&&(R+="; formFactor="+this.formFactor),this.clientId&&(R+="; clientId="+this.clientId),this.metadata&&(R+="; metadata="+this.metadata),this.deviceIdentityToken&&(R+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((A=this.push)===null||A===void 0)&&A.recipient&&(R+="; push.recipient="+JSON.stringify(this.push.recipient)),!((P=this.push)===null||P===void 0)&&P.state&&(R+="; push.state="+this.push.state),!((l=this.push)===null||l===void 0)&&l.error&&(R+="; push.error="+JSON.stringify(this.push.error)),!((E=this.push)===null||E===void 0)&&E.metadata&&(R+="; push.metadata="+this.push.metadata),R+="]",R},S.fromResponseBody=function(A,P){return P&&(A=o.decodeBody(A,P)),o.isArray(A)?S.fromValuesArray(A):S.fromValues(A)},S.fromValues=function(A){return A.error=A.error&&g.default.fromValues(A.error),Object.assign(new S,A)},S.fromValuesArray=function(A){for(var P=A.length,l=new Array(P),E=0;E<P;E++)l[E]=S.fromValues(A[E]);return l},S.toRequestBody=o.encodeBody,S}();t.default=w},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=function(){function h(){}return h.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},h.prototype.toString=function(){var p="[PushChannelSubscription";return this.channel&&(p+="; channel="+this.channel),this.deviceId&&(p+="; deviceId="+this.deviceId),this.clientId&&(p+="; clientId="+this.clientId),p+="]",p},h.fromResponseBody=function(p,w){return w&&(p=o.decodeBody(p,w)),o.isArray(p)?h.fromValuesArray(p):h.fromValues(p)},h.fromValues=function(p){return Object.assign(new h,p)},h.fromValuesArray=function(p){for(var w=p.length,S=new Array(w),A=0;A<w;A++)S[A]=h.fromValues(p[A]);return S},h.toRequestBody=o.encodeBody,h}();t.default=g},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=function(){function T(f){this.count=f&&f.count||0,this.data=f&&f.data||0,this.uncompressedData=f&&f.uncompressedData||0,this.failed=f&&f.failed||0,this.refused=f&&f.refused||0}return T}(),h=function(T){s.__extends(f,T);function f(c){var u=T.call(this,c)||this;return c&&c.category&&(u.category={},o.forInOwnNonNullProperties(c.category,function(a){u.category[a]=new g(c.category[a])})),u}return f}(g),p=function(){function T(f){this.peak=f&&f.peak||0,this.min=f&&f.min||0,this.mean=f&&f.mean||0,this.opened=f&&f.opened||0,this.refused=f&&f.refused||0}return T}(),w=function(){function T(f){this.succeeded=f&&f.succeeded||0,this.failed=f&&f.failed||0,this.refused=f&&f.refused||0}return T}(),S=function(){function T(f){this.plain=new p(f&&f.plain),this.tls=new p(f&&f.tls),this.all=new p(f&&f.all)}return T}(),A=function(){function T(f){this.messages=new h(f&&f.messages),this.presence=new h(f&&f.presence),this.all=new h(f&&f.all)}return T}(),P=function(){function T(f){this.realtime=new A(f&&f.realtime),this.rest=new A(f&&f.rest),this.webhook=new A(f&&f.webhook),this.sharedQueue=new A(f&&f.sharedQueue),this.externalQueue=new A(f&&f.externalQueue),this.httpEvent=new A(f&&f.httpEvent),this.push=new A(f&&f.push),this.all=new A(f&&f.all)}return T}(),l=function(){function T(f){this.all=new A(f&&f.all),this.inbound=new P(f&&f.inbound),this.outbound=new P(f&&f.outbound)}return T}(),E=function(){function T(f){this.all=new A(f&&f.all),this.producerPaid=new l(f&&f.producerPaid),this.consumerPaid=new l(f&&f.consumerPaid)}return T}(),R=function(){function T(f){this.messages=f&&f.messages||0;var c=f&&f.notifications;this.notifications={invalid:c&&c.invalid||0,attempted:c&&c.attempted||0,successful:c&&c.successful||0,failed:c&&c.failed||0},this.directPublishes=f&&f.directPublishes||0}return T}(),x=function(){function T(f){this.succeeded=f&&f.succeeded||0,this.skipped=f&&f.skipped||0,this.failed=f&&f.failed||0}return T}(),C=function(){function T(f){var c=this;this.delta=void 0,f&&f.delta&&(this.delta={},o.forInOwnNonNullProperties(f.delta,function(u){c.delta[u]=new x(f.delta[u])}))}return T}(),b=function(T){s.__extends(f,T);function f(c){var u=T.call(this,c)||this;return u.persisted=new A(c&&c.persisted),u.connections=new S(c&&c.connections),u.channels=new p(c&&c.channels),u.apiRequests=new w(c&&c.apiRequests),u.tokenRequests=new w(c&&c.tokenRequests),u.xchgProducer=new E(c&&c.xchgProducer),u.xchgConsumer=new E(c&&c.xchgConsumer),u.push=new R(c&&c.pushStats),u.processed=new C(c&&c.processed),u.inProgress=c&&c.inProgress||void 0,u.unit=c&&c.unit||void 0,u.intervalId=c&&c.intervalId||void 0,u}return f.fromValues=function(c){return new f(c)},f}(l);t.default=b},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(30)),h=s.__importDefault(i(7)),p=s.__importDefault(i(2)),w=s.__importDefault(i(51)),S=s.__importDefault(i(38)),A=s.__importDefault(i(8)),P=s.__importDefault(i(4)),l=s.__importDefault(i(10)),E=s.__importDefault(i(35)),R=s.__importDefault(i(3)),x=s.__importDefault(i(9)),C=function(T){s.__extends(f,T);function f(c){var u=T.call(this,c)||this;return p.default.logAction(p.default.LOG_MINOR,"Realtime()",""),u.connection=new w.default(u,u.options),u.channels=new b(u),c.autoConnect!==!1&&u.connect(),u}return f.prototype.connect=function(){p.default.logAction(p.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},f.prototype.close=function(){p.default.logAction(p.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},f.Promise=function(c){return c=A.default.objectifyOptions(c),c.promises=!0,new f(c)},f.Callbacks=f,f.Utils=o,f.ConnectionManager=E.default,f.Platform=R.default,f.ProtocolMessage=l.default,f.Message=x.default,f}(g.default),b=function(T){s.__extends(f,T);function f(c){var u=T.call(this)||this;return u.realtime=c,u.all=Object.create(null),c.connection.connectionManager.on("transport.active",function(){u.onTransportActive()}),u}return f.prototype.channelSerials=function(){for(var c={},u=0,a=o.keysArray(this.all,!0);u<a.length;u++){var v=a[u],d=this.all[v];d.properties.channelSerial&&(c[v]=d.properties.channelSerial)}return c},f.prototype.recoverChannels=function(c){for(var u=0,a=o.keysArray(c,!0);u<a.length;u++){var v=a[u],d=this.get(v);d.properties.channelSerial=c[v]}},f.prototype.onChannelMessage=function(c){var u=c.channel;if(u===void 0){p.default.logAction(p.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+c.action);return}var a=this.all[u];if(!a){p.default.logAction(p.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+u);return}a.onMessage(c)},f.prototype.onTransportActive=function(){for(var c in this.all){var u=this.all[c];u.state==="attaching"||u.state==="detaching"?u.checkPendingState():u.state==="suspended"?u._attach(!1,null):u.state==="attached"&&u.requestState("attaching")}},f.prototype.propogateConnectionInterruption=function(c,u){var a={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},v=["attaching","attached","detaching","suspended"],d=a[c];for(var y in this.all){var N=this.all[y];o.arrIn(v,N.state)&&N.notifyState(d,u)}},f.prototype.get=function(c,u){c=String(c);var a=this.all[c];if(!a)a=this.all[c]=new S.default(this.realtime,c,u);else if(u){if(a._shouldReattachToSetOptions(u,a.channelOptions))throw new P.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);a.setOptions(u)}return a},f.prototype.getDerived=function(c,u,a){if(u.filter){var v=o.toBase64(u.filter),d=o.matchDerivedChannel(c);c="[filter=".concat(v).concat(d.qualifierParam,"]").concat(d.channelName)}return this.get(c,a)},f.prototype.release=function(c){c=String(c);var u=this.all[c];if(u){var a=u.getReleaseErr();if(a)throw a;delete this.all[c]}},f}(h.default);t.default=C},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(7)),h=s.__importDefault(i(35)),p=s.__importDefault(i(2)),w=s.__importDefault(i(37)),S=s.__importDefault(i(3));function A(){}var P=function(l){s.__extends(E,l);function E(R,x){var C=l.call(this)||this;return C.whenState=function(b,T){return g.default.prototype.whenState.call(C,b,C.state,T,new w.default(void 0,b))},C.ably=R,C.connectionManager=new h.default(R,x),C.state=C.connectionManager.state.state,C.key=void 0,C.id=void 0,C.errorReason=null,C.connectionManager.on("connectionstate",function(b){var T=C.state=b.current;S.default.Config.nextTick(function(){C.emit(T,b)})}),C.connectionManager.on("update",function(b){S.default.Config.nextTick(function(){C.emit("update",b)})}),C}return E.prototype.connect=function(){p.default.logAction(p.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},E.prototype.ping=function(R){if(p.default.logAction(p.default.LOG_MINOR,"Connection.ping()",""),!R){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);R=A}this.connectionManager.ping(null,R)},E.prototype.close=function(){p.default.logAction(p.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(E.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),E.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},E}(g.default);t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PendingMessage=void 0;var s=i(0),o=s.__importDefault(i(10)),g=s.__importStar(i(1)),h=s.__importDefault(i(7)),p=s.__importDefault(i(2)),w=s.__importDefault(i(36)),S=s.__importDefault(i(4)),A=o.default.Action,P=function(){function E(R,x){this.message=R,this.callback=x,this.merged=!1;var C=R.action;this.sendAttempted=!1,this.ackRequired=C==A.MESSAGE||C==A.PRESENCE}return E}();t.PendingMessage=P;var l=function(E){s.__extends(R,E);function R(x){var C=E.call(this)||this;return C.transport=x,C.messageQueue=new w.default,x.on("ack",function(b,T){C.onAck(b,T)}),x.on("nack",function(b,T,f){C.onNack(b,T,f)}),C}return R.prototype.onAck=function(x,C){p.default.logAction(p.default.LOG_MICRO,"Protocol.onAck()","serial = "+x+"; count = "+C),this.messageQueue.completeMessages(x,C)},R.prototype.onNack=function(x,C,b){p.default.logAction(p.default.LOG_ERROR,"Protocol.onNack()","serial = "+x+"; count = "+C+"; err = "+g.inspectError(b)),b||(b=new S.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(x,C,b)},R.prototype.onceIdle=function(x){var C=this.messageQueue;if(C.count()===0){x();return}C.once("idle",x)},R.prototype.send=function(x){x.ackRequired&&this.messageQueue.push(x),p.default.shouldLog(p.default.LOG_MICRO)&&p.default.logAction(p.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(x.message)),x.sendAttempted=!0,this.transport.send(x.message)},R.prototype.getTransport=function(){return this.transport},R.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},R.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},R.prototype.finish=function(){var x=this.transport;this.onceIdle(function(){x.disconnect()})},R}(h.default);t.default=l},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),g=s.__importStar(i(1)),h=s.__importDefault(i(26)),p=s.__importDefault(i(8)),w=s.__importDefault(i(2)),S=s.__importDefault(i(10)),A=s.__importDefault(i(4)),P="web_socket";function l(x){return!!x.on}var E=function(x){s.__extends(C,x);function C(b,T,f){var c=x.call(this,b,T,f)||this;return c.shortName=P,f.heartbeats=o.default.Config.useProtocolHeartbeats,c.wsHost=p.default.getHost(f.options,f.host,!0),c}return C.isAvailable=function(){return!!o.default.Config.WebSocket},C.prototype.createWebSocket=function(b,T){return this.uri=b+g.toQueryString(T),new o.default.Config.WebSocket(this.uri)},C.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},C.prototype.connect=function(){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),h.default.prototype.connect.call(this);var b=this,T=this.params,f=T.options,c=f.tls?"wss://":"ws://",u=c+this.wsHost+":"+p.default.getPort(f)+"/";w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+u),this.auth.getAuthParams(function(a,v){if(!b.isDisposed){var d="";for(var y in v)d+=" "+y+": "+v[y]+";";if(w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+d+" err: "+a),a){b.disconnect(a);return}var N=T.getConnectParams(v);try{var D=b.wsConnection=b.createWebSocket(u,N);D.binaryType=o.default.Config.binaryType,D.onopen=function(){b.onWsOpen()},D.onclose=function(L){b.onWsClose(L)},D.onmessage=function(L){b.onWsData(L.data)},D.onerror=function(L){b.onWsError(L)},l(D)&&D.on("ping",function(){b.onActivity()})}catch(L){w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(L.stack||L.message)),b.disconnect(L)}}})},C.prototype.send=function(b){var T=this.wsConnection;if(!T){w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{T.send(S.default.serialize(b,this.params.format))}catch(c){var f="Exception from ws connection when trying to send: "+g.inspectError(c);w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.send()",f),this.finish("disconnected",new A.default(f,5e4,500))}},C.prototype.onWsData=function(b){w.default.logAction(w.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+b.length+"; type = "+typeof b);try{this.onProtocolMessage(S.default.deserialize(b,this.format))}catch(T){w.default.logAction(w.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+T.stack)}},C.prototype.onWsOpen=function(){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},C.prototype.onWsClose=function(b){var T,f;if(typeof b=="object"?(f=b.code,T=b.wasClean||f===1e3):(f=b,T=f==1e3),delete this.wsConnection,T){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var c=new A.default("Websocket closed",80003,400);this.finish("disconnected",c)}else{var u="Unclean disconnection of WebSocket ; code = "+f,c=new A.default(u,80003,400);w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onWsClose()",u),this.finish("disconnected",c)}this.emit("disposed")},C.prototype.onWsError=function(b){var T=this;w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+b.message),o.default.Config.nextTick(function(){T.disconnect(Error(b.message))})},C.prototype.dispose=function(){w.default.logAction(w.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var b=this.wsConnection;b&&(b.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(w.default.logAction(w.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!b)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");b.close()}))},C}(h.default);function R(x){return E.isAvailable()&&(x.supportedTransports[P]=E),E}t.default=R},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),g=s.__importDefault(i(34)),h=s.__importDefault(i(7)),p=s.__importDefault(i(2)),w=s.__importDefault(i(16)),S=s.__importStar(i(4)),A=s.__importDefault(i(38)),P=s.__importDefault(i(24)),l=s.__importDefault(i(39)),E=function(){};function R(c){return c.channel.realtime.auth.clientId}function x(c){var u=c.channel.realtime,a=u.auth.clientId;return(!a||a==="*")&&u.connection.state==="connected"}function C(c,u,a){switch(c.state){case"attached":case"suspended":a();break;case"initialized":case"detached":case"detaching":case"attaching":c.attach(function(v){v?u(v):a()});break;default:u(S.default.fromValues(c.invalidStateError()))}}function b(c,u){if(c.isSynthesized()||u.isSynthesized())return c.timestamp>=u.timestamp;var a=c.parseId(),v=u.parseId();return a.msgSerial===v.msgSerial?a.index>v.index:a.msgSerial>v.msgSerial}var T=function(c){s.__extends(u,c);function u(a){var v=c.call(this,a)||this;return v.channel=a,v.syncComplete=!1,v.members=new f(v,function(d){return d.clientId+":"+d.connectionId}),v._myMembers=new f(v,function(d){return d.clientId}),v.subscriptions=new h.default,v.pendingPresence=[],v}return u.prototype.enter=function(a,v){if(x(this))throw new S.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"enter",v)},u.prototype.update=function(a,v){if(x(this))throw new S.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"update",v)},u.prototype.enterClient=function(a,v,d){return this._enterOrUpdateClient(void 0,a,v,"enter",d)},u.prototype.updateClient=function(a,v,d){return this._enterOrUpdateClient(void 0,a,v,"update",d)},u.prototype._enterOrUpdateClient=function(a,v,d,y,N){var D=this;if(!N)if(typeof d=="function")N=d,d=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[a,v,d,y]);N=E}var L=this.channel;if(!L.connectionManager.activeState()){N(L.connectionManager.getError());return}p.default.logAction(p.default.LOG_MICRO,"RealtimePresence."+y+"Client()","channel = "+L.name+", id = "+a+", client = "+(v||"(implicit) "+R(this)));var I=w.default.fromData(d);I.action=y,a&&(I.id=a),v&&(I.clientId=v),w.default.encode(I,L.channelOptions,function(m){if(m){N(m);return}switch(L.state){case"attached":L.sendPresence(I,N);break;case"initialized":case"detached":L.attach();case"attaching":D.pendingPresence.push({presence:I,callback:N});break;default:m=new S.PartialErrorInfo("Unable to "+y+" presence channel while in "+L.state+" state",90001),m.code=90001,N(m)}})},u.prototype.leave=function(a,v){if(x(this))throw new S.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,a,v)},u.prototype.leaveClient=function(a,v,d){if(!d)if(typeof v=="function")d=v,v=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[a,v]);d=E}var y=this.channel;if(!y.connectionManager.activeState()){d==null||d(y.connectionManager.getError());return}p.default.logAction(p.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+a);var N=w.default.fromData(v);switch(N.action="leave",a&&(N.clientId=a),y.state){case"attached":y.sendPresence(N,d);break;case"attaching":this.pendingPresence.push({presence:N,callback:d});break;case"initialized":case"failed":{var D=new S.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);d==null||d(D);break}default:d==null||d(y.invalidStateError())}},u.prototype.get=function(a,v){var d=this,y=Array.prototype.slice.call(arguments);y.length==1&&typeof y[0]=="function"&&y.unshift(null),a=y[0],v=y[1];var N=!a||("waitForSync"in a?a.waitForSync:!0);if(!v){if(this.channel.realtime.options.promises)return o.promisify(this,"get",y);v=E}function D(L){v(null,a?L.list(a):L.values())}if(this.channel.state==="suspended"){N?v(S.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):D(this.members);return}C(this.channel,v,function(){var L=d.members;N?L.waitSync(function(){D(L)}):D(L)})},u.prototype.history=function(a,v){if(p.default.logAction(p.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);v=E}a&&a.untilAttach&&(this.channel.state==="attached"?(delete a.untilAttach,a.from_serial=this.channel.properties.attachSerial):v(new S.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),g.default.prototype._history.call(this,a,v)},u.prototype.setPresence=function(a,v,d){p.default.logAction(p.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+a.length+" participants; syncChannelSerial = "+d);var y,N,D=this.members,L=this._myMembers,I=[],m=this.channel.connectionManager.connectionId;v&&(this.members.startSync(),d&&(N=d.match(/^[\w-]+:(.*)$/))&&(y=N[1]));for(var O=0;O<a.length;O++){var k=w.default.fromValues(a[O]);switch(k.action){case"leave":D.remove(k)&&I.push(k),k.connectionId===m&&!k.isSynthesized()&&L.remove(k);break;case"enter":case"present":case"update":D.put(k)&&I.push(k),k.connectionId===m&&L.put(k);break}}v&&!y&&(D.endSync(),this.channel.syncChannelSerial=null);for(var O=0;O<I.length;O++){var k=I[O];this.subscriptions.emit(k.action,k)}},u.prototype.onAttached=function(a){p.default.logAction(p.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+a),a?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var v=this.pendingPresence,d=v.length;if(d){this.pendingPresence=[];var y=[],N=P.default.create();p.default.logAction(p.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+d+" queued presence messages");for(var D=0;D<d;D++){var L=v[D];y.push(L.presence),N.push(L.callback)}this.channel.sendPresence(y,N)}},u.prototype.actOnChannelState=function(a,v,d){switch(a){case"attached":this.onAttached(v);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(d);break}},u.prototype.failPendingPresence=function(a){if(this.pendingPresence.length){p.default.logAction(p.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(a));for(var v=0;v<this.pendingPresence.length;v++)try{this.pendingPresence[v].callback(a)}catch{}this.pendingPresence=[]}},u.prototype._clearMyMembers=function(){this._myMembers.clear()},u.prototype._ensureMyMembersPresent=function(){var a=this,v=this._myMembers,d=function(D){if(D){var L="Presence auto-re-enter failed: "+D.toString(),I=new S.default(L,91004,400);p.default.logAction(p.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",L);var m=new l.default(a.channel.state,a.channel.state,!0,!1,I);a.channel.emit("update",m)}};for(var y in v.map){var N=v.map[y];p.default.logAction(p.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+N.clientId+'" into the presence set'),this._enterOrUpdateClient(N.id,N.clientId,N.data,"enter",d)}},u.prototype._synthesizeLeaves=function(a){var v=this.subscriptions;o.arrForEach(a,function(d){var y=w.default.fromValues({action:"leave",connectionId:d.connectionId,clientId:d.clientId,data:d.data,encoding:d.encoding,timestamp:o.now()});v.emit("leave",y)})},u.prototype.on=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];p.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,a)},u.prototype.off=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];p.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,a)},u.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var d=A.default.processListenerArgs(a),y=d[0],N=d[1],D=d[2],L=this.channel;if(!D){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[y,N]);D=E}if(L.state==="failed"){D(S.default.fromValues(L.invalidStateError()));return}this.subscriptions.on(y,N),L.attach(D)},u.prototype.unsubscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var d=A.default.processListenerArgs(a),y=d[0],N=d[1];this.subscriptions.off(y,N)},u}(g.default),f=function(c){s.__extends(u,c);function u(a,v){var d=c.call(this)||this;return d.presence=a,d.map=Object.create(null),d.syncInProgress=!1,d.residualMembers=null,d.memberKey=v,d}return u.prototype.get=function(a){return this.map[a]},u.prototype.getClient=function(a){var v=this.map,d=[];for(var y in v){var N=v[y];N.clientId==a&&N.action!="absent"&&d.push(N)}return d},u.prototype.list=function(a){var v=this.map,d=a&&a.clientId,y=a&&a.connectionId,N=[];for(var D in v){var L=v[D];L.action!=="absent"&&(d&&d!=L.clientId||y&&y!=L.connectionId||N.push(L))}return N},u.prototype.put=function(a){(a.action==="enter"||a.action==="update")&&(a=w.default.fromValues(a),a.action="present");var v=this.map,d=this.memberKey(a);this.residualMembers&&delete this.residualMembers[d];var y=v[d];return y&&!b(a,y)?!1:(v[d]=a,!0)},u.prototype.values=function(){var a=this.map,v=[];for(var d in a){var y=a[d];y.action!="absent"&&v.push(y)}return v},u.prototype.remove=function(a){var v=this.map,d=this.memberKey(a),y=v[d];return y&&!b(a,y)?!1:(this.syncInProgress?(a=w.default.fromValues(a),a.action="absent",v[d]=a):delete v[d],!0)},u.prototype.startSync=function(){var a=this.map,v=this.syncInProgress;p.default.logAction(p.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),this.syncInProgress||(this.residualMembers=o.copy(a),this.setInProgress(!0))},u.prototype.endSync=function(){var a=this.map,v=this.syncInProgress;if(p.default.logAction(p.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),v){for(var d in a){var y=a[d];y.action==="absent"&&delete a[d]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var d in this.residualMembers)delete a[d];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},u.prototype.waitSync=function(a){var v=this.syncInProgress;if(p.default.logAction(p.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),!v){a();return}this.once("sync",a)},u.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},u.prototype.setInProgress=function(a){p.default.logAction(p.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+a),this.syncInProgress=a,this.presence.syncComplete=!a},u}(h.default);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=i(56),g=i(31),h=i(11),p=s.__importDefault(i(5)),w=s.__importDefault(i(3)),S=function(){function A(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return A.prototype.isWordArray=function(P){return P!=null&&P.sigBytes!==void 0},A.prototype.isArrayBuffer=function(P){return P!=null&&P.constructor===ArrayBuffer},A.prototype.isTypedArray=function(P){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(P)},A.prototype.uint8ViewToBase64=function(P){for(var l="",E=this.base64CharSet,R=P.byteLength,x=R%3,C=R-x,b,T,f,c,u,a=0;a<C;a=a+3)u=P[a]<<16|P[a+1]<<8|P[a+2],b=(u&16515072)>>18,T=(u&258048)>>12,f=(u&4032)>>6,c=u&63,l+=E[b]+E[T]+E[f]+E[c];return x==1?(u=P[C],b=(u&252)>>2,T=(u&3)<<4,l+=E[b]+E[T]+"=="):x==2&&(u=P[C]<<8|P[C+1],b=(u&64512)>>10,T=(u&1008)>>4,f=(u&15)<<2,l+=E[b]+E[T]+E[f]+"="),l},A.prototype.base64ToArrayBuffer=function(P){for(var l=atob==null?void 0:atob(P),E=l.length,R=new Uint8Array(E),x=0;x<E;x++){var C=l.charCodeAt(x);R[x]=C}return R.buffer},A.prototype.isBuffer=function(P){return this.isArrayBuffer(P)||this.isWordArray(P)||this.isTypedArray(P)},A.prototype.toBuffer=function(P){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(P))return new Uint8Array(P);if(this.isTypedArray(P))return new Uint8Array(P.buffer);if(this.isWordArray(P)){for(var l=new ArrayBuffer(P.sigBytes),E=new Uint8Array(l),R=0;R<P.sigBytes;R++)E[R]=P.words[R>>>2]>>>24-R%4*8&255;return E}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},A.prototype.toArrayBuffer=function(P){return this.isArrayBuffer(P)?P:this.toBuffer(P).buffer},A.prototype.toWordArray=function(P){return this.isTypedArray(P)&&(P=P.buffer),this.isWordArray(P)?P:p.default.create(P)},A.prototype.base64Encode=function(P){return this.isWordArray(P)?(0,h.stringify)(P):this.uint8ViewToBase64(this.toBuffer(P))},A.prototype.base64Decode=function(P){return ArrayBuffer&&w.default.Config.atob?this.base64ToArrayBuffer(P):(0,h.parse)(P)},A.prototype.hexEncode=function(P){return(0,o.stringify)(this.toWordArray(P))},A.prototype.hexDecode=function(P){var l=(0,o.parse)(P);return ArrayBuffer?this.toArrayBuffer(l):l},A.prototype.utf8Encode=function(P){return w.default.Config.TextEncoder?new w.default.Config.TextEncoder().encode(P).buffer:(0,g.parse)(P)},A.prototype.utf8Decode=function(P){if(!this.isBuffer(P))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(P)?new TextDecoder().decode(P):(P=this.toWordArray(P),(0,g.stringify)(P))},A.prototype.bufferCompare=function(P,l){if(!P)return-1;if(!l)return 1;var E=this.toWordArray(P),R=this.toWordArray(l);E.clamp(),R.clamp();var x=E.sigBytes-R.sigBytes;if(x!=0)return x;for(var C=E.words,b=R.words,T=0;T<C.length;T++)if(x=C[T]-b[T],x!=0)return x;return 0},A.prototype.byteLength=function(P){return this.isArrayBuffer(P)||this.isTypedArray(P)?P.byteLength:this.isWordArray(P)?P.sigBytes:-1},A.prototype.typedArrayToBuffer=function(P){return P.buffer},A}();t.default=new S},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Hex})},function(n,t,i){i.r(t);var s=i(5),o=i.n(s),g=i(11),h=i(23),p=i.n(h),w=i(2),S=i.n(w),A=i(4),P=i.n(A),l=function(E,R){var x="aes",C=256,b="cbc",T=16,f=4,c=4294967296,u=2147483648,a;if(E.getRandomWordArray)a=E.getRandomWordArray;else if(typeof Uint32Array<"u"&&E.getRandomValues){var v=new Uint32Array(f);a=function(O,k){var j=O/4,B=j==f?v:new Uint32Array(j);E.getRandomValues(B,function($){typeof k<"u"&&k($,R.toWordArray(B))})}}else a=function(O,k){S.a.logAction(S.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var j=O/4,B=new Array(j),$=0;$<j;$++)B[$]=Math.floor(Math.random()*c)-u;k(null,o.a.create(B))};function d(O){return O+T&-T}function y(O){if(O.algorithm==="aes"&&O.mode==="cbc"){if(O.keyLength===128||O.keyLength===256)return;throw new Error("Unsupported key length "+O.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function N(O){return O.replace("_","/").replace("-","+")}var D=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function L(){}function I(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}L.CipherParams=I,L.getDefaultParams=function(O){var k;if(typeof O=="function"||typeof O=="string"){if(S.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof O=="function")S.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),L.generateRandomKey(function(B){O(null,L.getDefaultParams({key:B}))});else if(typeof arguments[1]=="function")S.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,L.getDefaultParams({key:O}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!O.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof O.key=="string"?k=Object(g.parse)(N(O.key)):k=R.toWordArray(O.key);var j=new I;if(j.key=k,j.algorithm=O.algorithm||x,j.keyLength=k.words.length*(4*8),j.mode=O.mode||b,O.keyLength&&O.keyLength!==j.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+O.keyLength+" was specified, but the key actually has length "+j.keyLength);return y(j),j},L.generateRandomKey=function(O,k){arguments.length==1&&typeof O=="function"&&(k=O,O=void 0),a((O||C)/8,function(j,B){k!==void 0&&k(j?P.a.fromValues(j):null,B)})},L.getCipher=function(O){var k=O instanceof I?O:L.getDefaultParams(O);return{cipherParams:k,cipher:new m(k,f,O.iv)}};function m(O,k,j){this.algorithm=O.algorithm+"-"+String(O.keyLength)+"-"+O.mode,this.cjsAlgorithm=O.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=R.toWordArray(O.key),j&&(this.iv=R.toWordArray(j).clone()),this.blockLengthWords=k}return m.prototype.encrypt=function(O,k){S.a.logAction(S.a.LOG_MICRO,"CBCCipher.encrypt()",""),O=R.toWordArray(O);var j=O.sigBytes,B=d(j),$=this,V=function(){$.getIv(function(H,M){if(H){k(H);return}var _=$.encryptCipher.process(O.concat(D[B-j])),U=M.concat(_);k(null,U)})};this.encryptCipher?V():this.iv?(this.encryptCipher=p.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),V()):a(T,function(H,M){if(H){k(H);return}$.encryptCipher=p.a.algo[$.cjsAlgorithm].createEncryptor($.key,{iv:M}),$.iv=M,V()})},m.prototype.decrypt=function(O){S.a.logAction(S.a.LOG_MICRO,"CBCCipher.decrypt()",""),O=R.toWordArray(O);var k=this.blockLengthWords,j=O.words,B=o.a.create(j.slice(0,k)),$=o.a.create(j.slice(k)),V=p.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:B}),H=V.process($),M=V.finalize();return V.reset(),M&&M.sigBytes&&H.concat(M),H},m.prototype.getIv=function(O){if(this.iv){var k=this.iv;this.iv=null,O(null,k);return}var j=this;a(T,function(B,$){if(B){O(B);return}O(null,j.encryptCipher.process($))})},L};t.default=l},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,g=o.lib,h=g.WordArray,p=o.enc;p.Utf16=p.Utf16BE={stringify:function(S){for(var A=S.words,P=S.sigBytes,l=[],E=0;E<P;E+=2){var R=A[E>>>2]>>>16-E%4*8&65535;l.push(String.fromCharCode(R))}return l.join("")},parse:function(S){for(var A=S.length,P=[],l=0;l<A;l++)P[l>>>1]|=S.charCodeAt(l)<<16-l%2*16;return h.create(P,A*2)}},p.Utf16LE={stringify:function(S){for(var A=S.words,P=S.sigBytes,l=[],E=0;E<P;E+=2){var R=w(A[E>>>2]>>>16-E%4*8&65535);l.push(String.fromCharCode(R))}return l.join("")},parse:function(S){for(var A=S.length,P=[],l=0;l<A;l++)P[l>>>1]|=w(S.charCodeAt(l)<<16-l%2*16);return h.create(P,A*2)}};function w(S){return S<<8&4278255360|S>>>8&16711935}}(),s.enc.Utf16})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(28))})(this,function(s){return function(o){var g=s,h=g.lib,p=h.CipherParams,w=g.enc,S=w.Hex,A=g.format;A.Hex={stringify:function(P){return P.ciphertext.toString(S)},parse:function(P){var l=S.parse(P);return p.create({ciphertext:l})}}}(),s.format.Hex})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(11),i(61),i(27),i(28))})(this,function(s){return function(){var o=s,g=o.lib,h=g.BlockCipher,p=o.algo,w=[],S=[],A=[],P=[],l=[],E=[],R=[],x=[],C=[],b=[];(function(){for(var c=[],u=0;u<256;u++)u<128?c[u]=u<<1:c[u]=u<<1^283;for(var a=0,v=0,u=0;u<256;u++){var d=v^v<<1^v<<2^v<<3^v<<4;d=d>>>8^d&255^99,w[a]=d,S[d]=a;var y=c[a],N=c[y],D=c[N],L=c[d]*257^d*16843008;A[a]=L<<24|L>>>8,P[a]=L<<16|L>>>16,l[a]=L<<8|L>>>24,E[a]=L;var L=D*16843009^N*65537^y*257^a*16843008;R[d]=L<<24|L>>>8,x[d]=L<<16|L>>>16,C[d]=L<<8|L>>>24,b[d]=L,a?(a=y^c[c[c[D^y]]],v^=c[c[v]]):a=v=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],f=p.AES=h.extend({_doReset:function(){var c;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var u=this._keyPriorReset=this._key,a=u.words,v=u.sigBytes/4,d=this._nRounds=v+6,y=(d+1)*4,N=this._keySchedule=[],D=0;D<y;D++)D<v?N[D]=a[D]:(c=N[D-1],D%v?v>6&&D%v==4&&(c=w[c>>>24]<<24|w[c>>>16&255]<<16|w[c>>>8&255]<<8|w[c&255]):(c=c<<8|c>>>24,c=w[c>>>24]<<24|w[c>>>16&255]<<16|w[c>>>8&255]<<8|w[c&255],c^=T[D/v|0]<<24),N[D]=N[D-v]^c);for(var L=this._invKeySchedule=[],I=0;I<y;I++){var D=y-I;if(I%4)var c=N[D];else var c=N[D-4];I<4||D<=4?L[I]=c:L[I]=R[w[c>>>24]]^x[w[c>>>16&255]]^C[w[c>>>8&255]]^b[w[c&255]]}}},encryptBlock:function(c,u){this._doCryptBlock(c,u,this._keySchedule,A,P,l,E,w)},decryptBlock:function(c,u){var a=c[u+1];c[u+1]=c[u+3],c[u+3]=a,this._doCryptBlock(c,u,this._invKeySchedule,R,x,C,b,S);var a=c[u+1];c[u+1]=c[u+3],c[u+3]=a},_doCryptBlock:function(c,u,a,v,d,y,N,D){for(var L=this._nRounds,I=c[u]^a[0],m=c[u+1]^a[1],O=c[u+2]^a[2],k=c[u+3]^a[3],j=4,B=1;B<L;B++){var $=v[I>>>24]^d[m>>>16&255]^y[O>>>8&255]^N[k&255]^a[j++],V=v[m>>>24]^d[O>>>16&255]^y[k>>>8&255]^N[I&255]^a[j++],H=v[O>>>24]^d[k>>>16&255]^y[I>>>8&255]^N[m&255]^a[j++],M=v[k>>>24]^d[I>>>16&255]^y[m>>>8&255]^N[O&255]^a[j++];I=$,m=V,O=H,k=M}var $=(D[I>>>24]<<24|D[m>>>16&255]<<16|D[O>>>8&255]<<8|D[k&255])^a[j++],V=(D[m>>>24]<<24|D[O>>>16&255]<<16|D[k>>>8&255]<<8|D[I&255])^a[j++],H=(D[O>>>24]<<24|D[k>>>16&255]<<16|D[I>>>8&255]<<8|D[m&255])^a[j++],M=(D[k>>>24]<<24|D[I>>>16&255]<<16|D[m>>>8&255]<<8|D[O&255])^a[j++];c[u]=$,c[u+1]=V,c[u+2]=H,c[u+3]=M},keySize:256/32});o.AES=h._createHelper(f)}(),s.AES})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var g=s,h=g.lib,p=h.WordArray,w=h.Hasher,S=g.algo,A=[];(function(){for(var C=0;C<64;C++)A[C]=o.abs(o.sin(C+1))*4294967296|0})();var P=S.MD5=w.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,b){for(var T=0;T<16;T++){var f=b+T,c=C[f];C[f]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}var u=this._hash.words,a=C[b+0],v=C[b+1],d=C[b+2],y=C[b+3],N=C[b+4],D=C[b+5],L=C[b+6],I=C[b+7],m=C[b+8],O=C[b+9],k=C[b+10],j=C[b+11],B=C[b+12],$=C[b+13],V=C[b+14],H=C[b+15],M=u[0],_=u[1],U=u[2],F=u[3];M=l(M,_,U,F,a,7,A[0]),F=l(F,M,_,U,v,12,A[1]),U=l(U,F,M,_,d,17,A[2]),_=l(_,U,F,M,y,22,A[3]),M=l(M,_,U,F,N,7,A[4]),F=l(F,M,_,U,D,12,A[5]),U=l(U,F,M,_,L,17,A[6]),_=l(_,U,F,M,I,22,A[7]),M=l(M,_,U,F,m,7,A[8]),F=l(F,M,_,U,O,12,A[9]),U=l(U,F,M,_,k,17,A[10]),_=l(_,U,F,M,j,22,A[11]),M=l(M,_,U,F,B,7,A[12]),F=l(F,M,_,U,$,12,A[13]),U=l(U,F,M,_,V,17,A[14]),_=l(_,U,F,M,H,22,A[15]),M=E(M,_,U,F,v,5,A[16]),F=E(F,M,_,U,L,9,A[17]),U=E(U,F,M,_,j,14,A[18]),_=E(_,U,F,M,a,20,A[19]),M=E(M,_,U,F,D,5,A[20]),F=E(F,M,_,U,k,9,A[21]),U=E(U,F,M,_,H,14,A[22]),_=E(_,U,F,M,N,20,A[23]),M=E(M,_,U,F,O,5,A[24]),F=E(F,M,_,U,V,9,A[25]),U=E(U,F,M,_,y,14,A[26]),_=E(_,U,F,M,m,20,A[27]),M=E(M,_,U,F,$,5,A[28]),F=E(F,M,_,U,d,9,A[29]),U=E(U,F,M,_,I,14,A[30]),_=E(_,U,F,M,B,20,A[31]),M=R(M,_,U,F,D,4,A[32]),F=R(F,M,_,U,m,11,A[33]),U=R(U,F,M,_,j,16,A[34]),_=R(_,U,F,M,V,23,A[35]),M=R(M,_,U,F,v,4,A[36]),F=R(F,M,_,U,N,11,A[37]),U=R(U,F,M,_,I,16,A[38]),_=R(_,U,F,M,k,23,A[39]),M=R(M,_,U,F,$,4,A[40]),F=R(F,M,_,U,a,11,A[41]),U=R(U,F,M,_,y,16,A[42]),_=R(_,U,F,M,L,23,A[43]),M=R(M,_,U,F,O,4,A[44]),F=R(F,M,_,U,B,11,A[45]),U=R(U,F,M,_,H,16,A[46]),_=R(_,U,F,M,d,23,A[47]),M=x(M,_,U,F,a,6,A[48]),F=x(F,M,_,U,I,10,A[49]),U=x(U,F,M,_,V,15,A[50]),_=x(_,U,F,M,D,21,A[51]),M=x(M,_,U,F,B,6,A[52]),F=x(F,M,_,U,y,10,A[53]),U=x(U,F,M,_,k,15,A[54]),_=x(_,U,F,M,v,21,A[55]),M=x(M,_,U,F,m,6,A[56]),F=x(F,M,_,U,H,10,A[57]),U=x(U,F,M,_,L,15,A[58]),_=x(_,U,F,M,$,21,A[59]),M=x(M,_,U,F,N,6,A[60]),F=x(F,M,_,U,j,10,A[61]),U=x(U,F,M,_,d,15,A[62]),_=x(_,U,F,M,O,21,A[63]),u[0]=u[0]+M|0,u[1]=u[1]+_|0,u[2]=u[2]+U|0,u[3]=u[3]+F|0},_doFinalize:function(){var C=this._data,b=C.words,T=this._nDataBytes*8,f=C.sigBytes*8;b[f>>>5]|=128<<24-f%32;var c=o.floor(T/4294967296),u=T;b[(f+64>>>9<<4)+15]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,b[(f+64>>>9<<4)+14]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360,C.sigBytes=(b.length+1)*4,this._process();for(var a=this._hash,v=a.words,d=0;d<4;d++){var y=v[d];v[d]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}return a},clone:function(){var C=w.clone.call(this);return C._hash=this._hash.clone(),C}});function l(C,b,T,f,c,u,a){var v=C+(b&T|~b&f)+c+a;return(v<<u|v>>>32-u)+b}function E(C,b,T,f,c,u,a){var v=C+(b&f|T&~f)+c+a;return(v<<u|v>>>32-u)+b}function R(C,b,T,f,c,u,a){var v=C+(b^T^f)+c+a;return(v<<u|v>>>32-u)+b}function x(C,b,T,f,c,u,a){var v=C+(T^(b|~f))+c+a;return(v<<u|v>>>32-u)+b}g.MD5=w._createHelper(P),g.HmacMD5=w._createHmacHelper(P)}(Math),s.MD5})},function(n,t,i){var s;Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),g=o.__importDefault(i(3)),h=o.__importStar(i(1)),p=o.__importDefault(i(8)),w=i(4),S=o.__importDefault(i(19)),A=o.__importDefault(i(17)),P=o.__importDefault(i(22)),l=o.__importDefault(i(2)),E=i(29),R=o.__importDefault(i(63)),x=i(14);function C(f){var c=f.statusCode;return c===408&&!f.code||c===400&&!f.code||c>=500&&c<=504}function b(f){var c=f.connection,u=c&&c.connectionManager.host;return u?[u].concat(p.default.getFallbackHosts(f.options)):p.default.getHosts(f.options)}var T=(s=function(){function f(c){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=b,this.options=c||{};var u=this.options.connectivityCheckUrl||p.default.connectivityCheckUrl,a=this.options.connectivityCheckParams,v=!this.options.connectivityCheckUrl;g.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(d,y,N,D,L,I,m){var O=A.default.createRequest(N,D,L,I,P.default.REQ_SEND,y&&y.options.timeouts,d);return O.once("complete",m),O.exec(),O},this.options.disableConnectivityCheck?this.checkConnectivity=function(d){d(null,!0)}:this.checkConnectivity=function(d){l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+u),this.doUri(S.default.Get,null,u,null,null,a,function(y,N,D,L,I){var m=!1;v?m=!y&&(N==null?void 0:N.replace(/\n/,""))=="yes":m=!y&&(0,x.isSuccessCode)(I),l.default.logAction(l.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+m),d(null,m)})}):g.default.Config.jsonpSupported?(this.Request=function(d,y,N,D,L,I,m){var O=(0,E.createRequest)(N,D,L,I,P.default.REQ_SEND,y&&y.options.timeouts,d);return O.once("complete",m),g.default.Config.nextTick(function(){O.exec()}),O},this.options.disableConnectivityCheck?this.checkConnectivity=function(d){d(null,!0)}:this.checkConnectivity=function(d){var y=this,N=p.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(d);return}this.checksInProgress=[d],l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+N);var D=new E.Request("isTheInternetUp",N,null,null,null,P.default.REQ_SEND,p.default.TIMEOUTS);D.once("complete",function(L,I){var m=!L&&I;l.default.logAction(l.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+m);for(var O=0;O<y.checksInProgress.length;O++)y.checksInProgress[O](null,m);y.checksInProgress=null}),g.default.Config.nextTick(function(){D.exec()})}):g.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=R.default,this.checkConnectivity=function(d){l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+u),this.doUri(S.default.Get,null,u,null,null,null,function(y,N){var D=!y&&(N==null?void 0:N.replace(/\n/,""))=="yes";l.default.logAction(l.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+D),d(null,D)})}):this.Request=function(d,y,N,D,L,I,m){m(new w.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return f.prototype.do=function(c,u,a,v,d,y,N){var D=this,L=typeof a=="function"?a:function(k){return u.baseUri(k)+a},I=u._currentFallback;if(I)if(I.validUntil>h.now()){if(!this.Request){N==null||N(new w.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,u,L(I.host),v,y,d,function(k){for(var j=[],B=1;B<arguments.length;B++)j[B-1]=arguments[B];if(k&&C(k)){u._currentFallback=null,D.do(c,u,a,v,d,y,N);return}N==null||N.apply(void 0,o.__spreadArray([k],j,!1))});return}else u._currentFallback=null;var m=b(u);if(m.length===1){this.doUri(c,u,L(m[0]),v,d,y,N);return}var O=function(k,j){var B=k.shift();D.doUri(c,u,L(B),v,d,y,function($){for(var V=[],H=1;H<arguments.length;H++)V[H-1]=arguments[H];if($&&C($)&&k.length){O(k,!0);return}j&&(u._currentFallback={host:B,validUntil:h.now()+u.options.timeouts.fallbackRetryTimeout}),N==null||N.apply(void 0,o.__spreadArray([$],V,!1))})};O(m)},f.prototype.doUri=function(c,u,a,v,d,y,N){if(!this.Request){N(new w.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,u,a,v,y,d,N)},f}(),s.methods=[S.default.Get,S.default.Delete,S.default.Post,S.default.Put,S.default.Patch],s.methodsWithoutBody=[S.default.Get,S.default.Delete],s.methodsWithBody=[S.default.Post,S.default.Put,S.default.Patch],s);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(4)),g=s.__importDefault(i(3)),h=s.__importDefault(i(8)),p=s.__importStar(i(1)),w=i(1);function S(l,E){return!!E.get("x-ably-errorcode")}function A(l,E){if(S(l,E))return l.error&&o.default.fromValues(l.error)}function P(l,E,R,x,C,b,T){var f=new Headers(x||{}),c=l?l.toUpperCase():p.isEmptyArg(b)?"GET":"POST",u=new AbortController,a=setTimeout(function(){u.abort(),T(new o.PartialErrorInfo("Request timed out",null,408))},E?E.options.timeouts.httpRequestTimeout:h.default.TIMEOUTS.httpRequestTimeout),v={method:c,headers:f,body:b};g.default.Config.isWebworker||(v.credentials=f.has("authorization")?"include":"same-origin"),(0,w.getGlobalObject)().fetch(R+"?"+new URLSearchParams(C||{}),v).then(function(d){clearTimeout(a);var y=d.headers.get("Content-Type"),N;y&&y.indexOf("application/x-msgpack")>-1?N=d.arrayBuffer():y&&y.indexOf("application/json")>-1?N=d.json():N=d.text(),N.then(function(D){var L=!!y&&y.indexOf("application/x-msgpack")===-1;if(d.ok)T(null,D,d.headers,L,d.status);else{var I=A(D,d.headers)||new o.PartialErrorInfo("Error response received from server: "+d.status+" body was: "+g.default.Config.inspect(D),null,d.status);T(I,D,d.headers,L,d.status)}})}).catch(function(d){clearTimeout(a),T(d)})}t.default=P},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(41)),g=s.__importStar(i(1)),h=g.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function p(){var P=h.location;return!h.WebSocket||!P||!P.origin||P.origin.indexOf("http")>-1}var w=h.navigator&&h.navigator.userAgent.toString(),S=h.location&&h.location.href,A={agent:"browser",logTimestamps:!0,userAgent:w,currentUrl:S,noUpgrade:w&&!!w.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:h.WebSocket,fetchSupported:!!h.fetch,xhrSupported:h.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:p(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!h.TextDecoder,preferBinary:!1,ArrayBuffer:h.ArrayBuffer,atob:h.atob,nextTick:typeof h.setImmediate<"u"?h.setImmediate.bind(h):function(P){setTimeout(P,0)},addEventListener:h.addEventListener,inspect:JSON.stringify,stringByteSize:function(P){return h.TextDecoder&&new h.TextEncoder().encode(P).length||P.length},TextEncoder:h.TextEncoder,TextDecoder:h.TextDecoder,Promise:h.Promise,getRandomValues:function(P){if(P!==void 0)return function(l,E){P.getRandomValues(l),E&&E(null)}}(h.crypto||msCrypto)};t.default=A},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),g=o.__importStar(i(1)),h="ablyjs-storage-test",p=function(){function w(){try{s.sessionStorage.setItem(h,h),s.sessionStorage.removeItem(h),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{s.localStorage.setItem(h,h),s.localStorage.removeItem(h),this.localSupported=!0}catch{this.localSupported=!1}}return w.prototype.get=function(S){return this._get(S,!1)},w.prototype.getSession=function(S){return this._get(S,!0)},w.prototype.remove=function(S){return this._remove(S,!1)},w.prototype.removeSession=function(S){return this._remove(S,!0)},w.prototype.set=function(S,A,P){return this._set(S,A,P,!1)},w.prototype.setSession=function(S,A,P){return this._set(S,A,P,!0)},w.prototype._set=function(S,A,P,l){var E={value:A};return P&&(E.expires=g.now()+P),this.storageInterface(l).setItem(S,JSON.stringify(E))},w.prototype._get=function(S,A){if(A&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!A&&!this.localSupported)throw new Error("Local Storage not supported");var P=this.storageInterface(A).getItem(S);if(!P)return null;var l=JSON.parse(P);return l.expires&&l.expires<g.now()?(this.storageInterface(A).removeItem(S),null):l.value},w.prototype._remove=function(S,A){return this.storageInterface(A).removeItem(S)},w.prototype.storageInterface=function(S){return S?s.sessionStorage:s.localStorage},w}();t.default=new p}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(67)),g={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};t.default=g},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(s||(s={})),t.default=s},function(n,t,i){i.r(t);var s=i(29),o=i.n(s),g=i(1),h=i(3),p=i.n(h),w=i(12),S=i.n(w),A=i(17),P=i.n(A),l=function(C){var b="xhr_polling";function T(f,c,u){u.stream=!1,S.a.call(this,f,c,u),this.shortName=b}return g.inherits(T,S.a),T.isAvailable=function(){return p.a.Config.xhrSupported&&p.a.Config.allowComet},T.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(f,c,u,a,v){return P.a.createRequest(f,c,u,a,v,this.timeouts)},typeof C<"u"&&T.isAvailable()&&(C.supportedTransports[b]=T),T},E=l,R=function(C){var b="xhr_streaming";function T(f,c,u){S.a.call(this,f,c,u),this.shortName=b}return g.inherits(T,S.a),T.isAvailable=function(){return p.a.Config.xhrSupported&&p.a.Config.streamingSupported&&p.a.Config.allowComet},T.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(f,c,u,a,v){return P.a.createRequest(f,c,u,a,v,this.timeouts)},typeof C<"u"&&T.isAvailable()&&(C.supportedTransports[b]=T),T},x=R;t.default=[o.a,E,x]}]).default})})(Ar);var Er=Ar.exports;const Vo=sn(Er),zo=Br({__proto__:null,default:Vo},[Er]);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Se=function(){return Se=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Se.apply(this,arguments)},Wo=function(){function r(e){this.options=e,this.listeners={}}return r.prototype.on=function(e,n){var t=this.listeners[e]||[];this.listeners[e]=t.concat([n])},r.prototype.triggerEvent=function(e,n){var t=this,i=this.listeners[e]||[];i.forEach(function(s){return s({target:t,event:n})})},r}(),Ge;(function(r){r[r.Add=0]="Add",r[r.Remove=1]="Remove"})(Ge||(Ge={}));var qo=function(){function r(){this.notifications=[]}return r.prototype.push=function(e){this.notifications.push(e),this.updateFn(e,Ge.Add,this.notifications)},r.prototype.splice=function(e,n){var t=this.notifications.splice(e,n)[0];return this.updateFn(t,Ge.Remove,this.notifications),t},r.prototype.indexOf=function(e){return this.notifications.indexOf(e)},r.prototype.onUpdate=function(e){this.updateFn=e},r}(),ke;(function(r){r.Dismiss="dismiss",r.Click="click"})(ke||(ke={}));var Rn={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},Ko=function(){function r(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var e=document.createDocumentFragment(),n=this._createHTMLElement({tagName:"div",className:"notyf"});e.appendChild(n),document.body.appendChild(e),this.container=n,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return r.prototype.on=function(e,n){var t;this.events=Se(Se({},this.events),(t={},t[e]=n,t))},r.prototype.update=function(e,n){n===Ge.Add?this.addNotification(e):n===Ge.Remove&&this.removeNotification(e)},r.prototype.removeNotification=function(e){var n=this,t=this._popRenderedNotification(e),i;if(t){i=t.node,i.classList.add("notyf__toast--disappear");var s;i.addEventListener(this.animationEndEventName,s=function(o){o.target===i&&(i.removeEventListener(n.animationEndEventName,s),n.container.removeChild(i))})}},r.prototype.addNotification=function(e){var n=this._renderNotification(e);this.notifications.push({notification:e,node:n}),this._announce(e.options.message||"Notification")},r.prototype._renderNotification=function(e){var n,t=this._buildNotificationCard(e),i=e.options.className;return i&&(n=t.classList).add.apply(n,i.split(" ")),this.container.appendChild(t),t},r.prototype._popRenderedNotification=function(e){for(var n=-1,t=0;t<this.notifications.length&&n<0;t++)this.notifications[t].notification===e&&(n=t);if(n!==-1)return this.notifications.splice(n,1)[0]},r.prototype.getXPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.x)||"right"},r.prototype.getYPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.y)||"bottom"},r.prototype.adjustContainerAlignment=function(e){var n=this.X_POSITION_FLEX_MAP[this.getXPosition(e)],t=this.Y_POSITION_FLEX_MAP[this.getYPosition(e)],i=this.container.style;i.setProperty("justify-content",t),i.setProperty("align-items",n)},r.prototype._buildNotificationCard=function(e){var n=this,t=e.options,i=t.icon;this.adjustContainerAlignment(t);var s=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),g=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),h=this._createHTMLElement({tagName:"div",className:"notyf__message"});h.innerHTML=t.message||"";var p=t.background||t.backgroundColor;if(i){var w=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof i=="string"||i instanceof String)&&(w.innerHTML=new String(i).valueOf()),typeof i=="object"){var S=i.tagName,A=S===void 0?"i":S,P=i.className,l=i.text,E=i.color,R=E===void 0?p:E,x=this._createHTMLElement({tagName:A,className:P,text:l});R&&(x.style.color=R),w.appendChild(x)}g.appendChild(w)}if(g.appendChild(h),s.appendChild(g),p&&(t.ripple?(o.style.background=p,s.appendChild(o)):s.style.background=p),t.dismissible){var C=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),b=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});C.appendChild(b),g.appendChild(C),s.classList.add("notyf__toast--dismissible"),b.addEventListener("click",function(f){var c,u;(u=(c=n.events)[ke.Dismiss])===null||u===void 0||u.call(c,{target:e,event:f}),f.stopPropagation()})}s.addEventListener("click",function(f){var c,u;return(u=(c=n.events)[ke.Click])===null||u===void 0?void 0:u.call(c,{target:e,event:f})});var T=this.getYPosition(t)==="top"?"upper":"lower";return s.classList.add("notyf__toast--"+T),s},r.prototype._createHTMLElement=function(e){var n=e.tagName,t=e.className,i=e.text,s=document.createElement(n);return t&&(s.className=t),s.textContent=i||null,s},r.prototype._createA11yContainer=function(){var e=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),e.style.border="0",e.style.clip="rect(0 0 0 0)",e.style.height="1px",e.style.margin="-1px",e.style.overflow="hidden",e.style.padding="0",e.style.position="absolute",e.style.width="1px",e.style.outline="0",document.body.appendChild(e),this.a11yContainer=e},r.prototype._announce=function(e){var n=this;this.a11yContainer.textContent="",setTimeout(function(){n.a11yContainer.textContent=e},100)},r.prototype._getAnimationEndEventName=function(){var e=document.createElement("_fake"),n={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},t;for(t in n)if(e.style[t]!==void 0)return n[t];return"animationend"},r}(),Jo=function(){function r(e){var n=this;this.dismiss=this._removeNotification,this.notifications=new qo,this.view=new Ko;var t=this.registerTypes(e);this.options=Se(Se({},Rn),e),this.options.types=t,this.notifications.onUpdate(function(i,s){return n.view.update(i,s)}),this.view.on(ke.Dismiss,function(i){var s=i.target,o=i.event;n._removeNotification(s),s.triggerEvent(ke.Dismiss,o)}),this.view.on(ke.Click,function(i){var s=i.target,o=i.event;return s.triggerEvent(ke.Click,o)})}return r.prototype.error=function(e){var n=this.normalizeOptions("error",e);return this.open(n)},r.prototype.success=function(e){var n=this.normalizeOptions("success",e);return this.open(n)},r.prototype.open=function(e){var n=this.options.types.find(function(s){var o=s.type;return o===e.type})||{},t=Se(Se({},n),e);this.assignProps(["ripple","position","dismissible"],t);var i=new Wo(t);return this._pushNotification(i),i},r.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},r.prototype.assignProps=function(e,n){var t=this;e.forEach(function(i){n[i]=n[i]==null?t.options[i]:n[i]})},r.prototype._pushNotification=function(e){var n=this;this.notifications.push(e);var t=e.options.duration!==void 0?e.options.duration:this.options.duration;t&&setTimeout(function(){return n._removeNotification(e)},t)},r.prototype._removeNotification=function(e){var n=this.notifications.indexOf(e);n!==-1&&this.notifications.splice(n,1)},r.prototype.normalizeOptions=function(e,n){var t={type:e};return typeof n=="string"?t.message=n:typeof n=="object"&&(t=Se(Se({},t),n)),t},r.prototype.registerTypes=function(e){var n=(e&&e.types||[]).slice(),t=Rn.types.map(function(i){var s=-1;n.forEach(function(g,h){g.type===i.type&&(s=h)});var o=s!==-1?n.splice(s,1)[0]:{};return Se(Se({},i),o)});return t.concat(n)},r}();window.Notyf=Jo;window.Ably=zo;window.Echo=new $o({broadcaster:"ably",tls:!0,disableStats:!0,authEndpoint:"/broadcasting/auth",auth:{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}});window.Echo.connector.ably.connection.on(r=>{r.current==="connected"&&console.log("connected to ably server")});window.Echo.connector.ably.connection.on("stateChange",r=>{r.current==="connected"?console.log("Connected to Ably server"):r.current==="failed"&&console.error("Failed to connect to Ably server:",r.reason)});window.axios=ue;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";let Tn=document.head.querySelector('meta[name="csrf-token"]');Tn?window.axios.defaults.headers.common["X-CSRF-TOKEN"]=Tn.content:console.error("CSRF token not found!");var Qo=Object.defineProperty,Xo=(r,e,n)=>e in r?Qo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,Fe=(r,e,n)=>Xo(r,typeof e!="symbol"?e+"":e,n);document.addEventListener("alpine:init",()=>{window.Alpine.store("editOnClickValidation",{pending:[],set(r,e){this.pending=this.pending.filter(n=>n.value!==r),this.pending.push({value:r,textContent:e})},has(r){return this.pending.some(e=>e.value===r)},get(r){return this.pending.find(e=>e.value===r)},notContains(r){return this.pending.length>0&&!this.has(r)},clear(){this.pending=[]},getTextContent(r){const e=this.pending.find(n=>n.value===r);return e?e.textContent:null}}),window.editOnClickValidation=window.Alpine.store("editOnClickValidation")});document.addEventListener("alpine:init",()=>{window.Alpine.store("pgBulkActions",{selected:[],init(){window.addEventListener("pgBulkActions::addMore",r=>{const e=r.__livewire.params[0];typeof this.selected[e.tableName]>"u"&&(this.selected[e.tableName]=[]),this.selected[e.tableName].push(e.value)}),window.addEventListener("pgBulkActions::clear",r=>{this.clear(r.detail)}),window.addEventListener("pgBulkActions::clearAll",()=>{this.clearAll()})},add(r,e){if(typeof this.selected[e]>"u"&&(this.selected[e]=[]),!this.selected[e].includes(r)){this.selected[e].push(r);return}this.remove(r,e)},remove(r,e){const n=this.selected[e].indexOf(r);n>-1&&this.selected[e].splice(n,1)},get(r){return this.selected[r]??""},count(r){return typeof this.selected[r]>"u"?0:this.selected[r].length},clear(r){this.selected[r]=[]},clearAll(){this.selected=[]}}),window.pgBulkActions=window.Alpine.store("pgBulkActions")});const Yo=r=>({field:r.field??null,tableName:r.tableName??null,enabled:r.enabled??!1,id:r.id,trueValue:r.trueValue,falseValue:r.falseValue,toggle:r.toggle,save(){this.toggle=this.toggle===0?1:0,this.$wire.dispatch("pg:toggleable-"+this.tableName,{id:this.id,field:this.field,value:this.toggle})}}),Zo=(r,e,n)=>{const t=r[e];return t?typeof t=="function"?t():Promise.resolve(t):new Promise((i,s)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(s.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})},es=r=>({dataField:r.dataField,tableName:r.tableName,label:r.label??null,locale:r.locale??{locale:"default",dateFormat:"Y-m-d H:i",time_24hr:!1,enableTime:!0},onlyFuture:r.onlyFuture??!1,noWeekEnds:r.noWeekEnds??!1,customConfig:r.customConfig??null,type:r.type,element:null,selectedDates:null,async init(){typeof flatpickr>"u"&&(console.log("%c%s","color: #f59e0c; font-size: 1.2em; font-weight: bold; line-height: 1.5"," PowerGrid"),console.error("%c%s","font-size: 1em; line-height: 1.5",`
Failed to mount filter: Filter::datetime('${this.dataField}') on table ['${this.tableName}']

 Install flatpickr: npm install flatpickr

 Add 'import flatpickr from "flatpickr"' in resources/js/app.js file
  `)),window.addEventListener(`pg:clear_flatpickr::${this.tableName}:${this.dataField}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()}),window.addEventListener(`pg:clear_all_flatpickr::${this.tableName}`,()=>{this.$refs.rangeInput&&this.element&&this.element.clear()});try{const n=await Zo(Object.assign({}),`./flatpickr/dist/l10n/${this.locale.locale}.js`,5);flatpickr.localize(n.default||n)}catch{}const e=this.getOptions();this.$refs.rangeInput&&typeof flatpickr<"u"&&(this.element=flatpickr(this.$refs.rangeInput,e),this.selectedDates=this.$wire.get(`filters.${this.type}.${this.dataField}.formatted`),this.element.setDate(this.selectedDates))},getOptions(){const e={mode:"range",defaultHour:0,...this.locale,...this.customConfig};return this.onlyFuture&&(e.minDate="today"),this.noWeekEnds&&(e.disable=[function(n){return n.getDay()===0||n.getDay()===6}]),e.onClose=(n,t,i)=>{n=n.map(s=>this.element.formatDate(s,"Y-m-d")),n.length>0&&this.selectedDates!==t&&Livewire.dispatch("pg:datePicker-"+this.tableName,{selectedDates:n,dateStr:t,timezone:this.customConfig.timezone??new Date().toString().match(/([-\+][0-9]+)\s/)[1],type:this.type,field:this.dataField,label:this.label})},e}}),ts=r=>({theme:r.theme,id:r.id??null,dataField:r.dataField??null,content:r.content,fallback:r.fallback,inputClass:r.inputClass,saveOnMouseOut:r.saveOnMouseOut,oldContent:null,editable:!1,hash:null,hashError:!0,showEditable:!1,editableInput:"",init(){this.content.length===0&&this.fallback&&(this.content=this.htmlSpecialChars(this.fallback)),this.hash=this.dataField+"-"+this.id,window.addEventListener("toggle-"+this.hash,()=>{this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.click(),this.observe(()=>document.getElementById("editable-"+this.hash),n=>{setTimeout(()=>this.setFocusToEnd(n),100)})})}),this.$watch("editable",e=>{if(e){let n=!1;if(this.showEditable=!1,this.content=this.htmlSpecialChars(this.content),this.oldContent=this.content,this.hashError=this.store().notContains(this.hash),this.observe(()=>document.getElementById("editable-"+this.hash),t=>{setTimeout(()=>{this.setFocusToEnd(t),this.store().getTextContent(this.hash)&&(t.textContent=this.store().getTextContent(this.hash))},30)}),this.hashError){const t=this.store().get(this.hash),i=document.getElementById("clickable-"+t);i&&i.click()}n=!0,this.editableInput=`
                <div
                    x-ref="editable"
                    x-text="content"
                    value="${this.content}"
                    placeholder="${this.content}"
                    contenteditable
                    class="pg-single-line ${this.inputClass}"
                    ${this.saveOnMouseOut?'x-on:mousedown.outside="save()"':""}
                    x-on:keydown.enter="save()"
                    id="${"editable-"+this.dataField+"-"+this.id}"
                    x-on:keydown.esc="cancel"
                >
                </div>`,this.$nextTick(()=>setTimeout(()=>{this.showEditable=n,this.focus()},150))}}),this.content=this.htmlSpecialChars(this.content)},store(){return window.editOnClickValidation},save(){this.store().clear(),this.store().set(this.hash,this.$el.textContent),this.observe(()=>document.getElementById("clickable-"+this.hash),e=>{e.textContent=this.$el.textContent}),window.addEventListener("pg:editable-close-"+this.id,()=>{this.store().clear(),this.editable=!1,this.showEditable=!1}),this.store().has(this.hash)||this.store().set(this.hash,this.$el.textContent),this.$wire.dispatch("pg:editable-"+this.$wire.tableName,{id:this.id,value:this.$el.textContent,field:this.dataField}),this.oldContent=this.store().getTextContent(this.hash),this.$nextTick(()=>{this.focus(),this.$el.setAttribute("value","")}),this.content=this.htmlSpecialChars(this.$el.textContent)},focus(){this.setFocusToEnd(this.$el)},cancel(){this.store().clear(),this.$refs.editable.textContent=this.oldContent,this.content=this.oldContent,this.editable=!1,this.showEditable=!1,this.$refs.error&&(this.$refs.error.innerHTML="")},htmlSpecialChars(e){const n=document.createElement("div");return n.innerHTML=e,n.textContent},observe(e,n){new MutationObserver((t,i)=>{for(let s of t)if(s.type==="childList"){const o=e();if(o){n(o),i.disconnect();break}}}).observe(document.body,{childList:!0,subtree:!0})},setFocusToEnd(e){if(!e)return;const n=window.getSelection(),t=document.createRange();t.selectNodeContents(e),t.collapse(!1),n.removeAllRanges(),n.addRange(t),e.focus()}});function ns(r){r.querySelectorAll("tbody tr td").forEach(e=>{e.classList.remove("hidden")}),r.querySelectorAll("thead tr th").forEach(e=>{e.classList.remove("hidden")})}function rs(r){let e=0;const n=r.querySelectorAll("table thead tr:nth-child(1) th[fixed]"),t=Xt(r);return n.forEach(i=>{e+=Xt(i)}),t-e}function is(r,e){const n=[].slice.call(r.querySelectorAll("table thead tr:nth-child(1) th")),t=[].slice.call(n).sort(function(g,h){const p=g.getAttribute("sort_order")??999,w=h.getAttribute("sort_order")??999;return p-w});let i=0,s=!0;const o=[];return t.forEach(g=>{const h=Xt(g);g.getAttribute("fixed")===null&&(s&&i<=e&&i+h<=e?i+=h:(o.push(n.indexOf(g)+1),s=!1))}),o}function os(r,e){for(const n of e)r.querySelectorAll(`tbody:not(tbody[expand]) tr td:nth-child(${n})`).forEach(t=>{t.classList.add("hidden")}),r.querySelectorAll(`thead tr th:nth-child(${n})`).forEach(t=>{t.classList.add("hidden")})}function ss(r,e){var n,t;if(r.querySelectorAll("table tbody[expand] tr td div").length){for(const i of r.querySelectorAll("table tbody[expand] tr td div"))i.innerHTML="";if(e.length)for(const i of e){const s=r.querySelectorAll("table tbody:not(tbody[expand])");for(const o of s){const g=(n=o.nextElementSibling)==null?void 0:n.querySelector("tr td div");if(!g)continue;let h=r.querySelector(`table thead tr th:nth-child(${i}) span[data-value]`).textContent;const p=(t=o.querySelector(`tr:last-child td:nth-child(${i})`))==null?void 0:t.innerHTML;h.length&&(h+=":"),g.querySelector(`div[data-expand-item-${i}]`)||(g.innerHTML+=`<div class="responsive-row-expand-item-container" data-expand-item-${i}>
                    <span class="font-bold responsive-row-expand-item-name">${h}</span>
                    <span class="responsive-row-expand-item-value">${p}</span>
                </div>`)}}}}function Xt(r){return parseFloat(r.getBoundingClientRect().width.toFixed(2))}function as(r){ns(r);const e=rs(r),n=is(r,e);ss(r,n),os(r,n)}const ls=()=>({running:!1,expanded:null,element:null,hasHiddenElements:!1,size:0,toggleExpanded(r){this.expanded=this.expanded==r?null:r},init(){this.$nextTick(()=>{this.handleResize(),this.observeElement(),window.addEventListener("pg-livewire-request-finished",()=>{setTimeout(()=>this.handleResize(),5)})})},handleResize(){var r;const e=this.$el;as(e),this.hasHiddenElements=(r=e.querySelector("table tbody[expand] tr td div"))==null?void 0:r.innerHTML,this.hasHiddenElements||(this.expanded=null)},observeElement(){new ResizeObserver(r=>{r.forEach(e=>{if(e.contentRect.width>0){if(this.size===this.$el.getBoundingClientRect().width)return;this.size=this.$el.getBoundingClientRect().width,this.handleResize()}})}).observe(this.$el)}}),us=(r,e,n)=>{Livewire.dispatch(`${r}-${e.tableName}`,{label:e.label,field:e.dataField,values:n})},Rr=(r,e)=>{us("pg:multiSelect",r,e)};function Nt(r,e){r.split(/\s+/).forEach(n=>{e(n)})}class cs{constructor(){this._events={}}on(e,n){Nt(e,t=>{const i=this._events[t]||[];i.push(n),this._events[t]=i})}off(e,n){var t=arguments.length;if(t===0){this._events={};return}Nt(e,i=>{if(t===1){delete this._events[i];return}const s=this._events[i];s!==void 0&&(s.splice(s.indexOf(n),1),this._events[i]=s)})}trigger(e,...n){var t=this;Nt(e,i=>{const s=t._events[i];s!==void 0&&s.forEach(o=>{o.apply(t,n)})})}}function fs(r){return r.plugins={},class extends r{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,n){r.plugins[e]={name:e,fn:n}}initializePlugins(e){var n,t;const i=this,s=[];if(Array.isArray(e))e.forEach(o=>{typeof o=="string"?s.push(o):(i.plugins.settings[o.name]=o.options,s.push(o.name))});else if(e)for(n in e)e.hasOwnProperty(n)&&(i.plugins.settings[n]=e[n],s.push(n));for(;t=s.shift();)i.require(t)}loadPlugin(e){var n=this,t=n.plugins,i=r.plugins[e];if(!r.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(n,[n.plugins.settings[e]||{}]),t.names.push(e)}require(e){var n=this,t=n.plugins;if(!n.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');n.loadPlugin(e)}return t.loaded[e]}}}const Tt=r=>(r=r.filter(Boolean),r.length<2?r[0]||"":hs(r)==1?"["+r.join("")+"]":"(?:"+r.join("|")+")"),Tr=r=>{if(!ds(r))return r.join("");let e="",n=0;const t=()=>{n>1&&(e+="{"+n+"}")};return r.forEach((i,s)=>{if(i===r[s-1]){n++;return}t(),e+=i,n=1}),t(),e},Ir=r=>{let e=Array.from(r);return Tt(e)},ds=r=>new Set(r).size!==r.length,Je=r=>(r+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),hs=r=>r.reduce((e,n)=>Math.max(e,ps(n)),0),ps=r=>Array.from(r).length,xr=r=>{if(r.length===1)return[[r]];let e=[];const n=r.substring(1);return xr(n).forEach(function(t){let i=t.slice(0);i[0]=r.charAt(0)+i[0],e.push(i),i=t.slice(0),i.unshift(r.charAt(0)),e.push(i)}),e},gs=[[0,65535]],vs="[-]";let ht,Pr;const ms=3,an={},In={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let r in In){let e=In[r]||"";for(let n=0;n<e.length;n++){let t=e.substring(n,n+1);an[t]=r}}const ys=new RegExp(Object.keys(an).join("|")+"|"+vs,"gu"),bs=r=>{ht===void 0&&(ht=Ss(gs))},xn=(r,e="NFKD")=>r.normalize(e),pt=r=>Array.from(r).reduce((e,n)=>e+Os(n),""),Os=r=>(r=xn(r).toLowerCase().replace(ys,e=>an[e]||""),xn(r,"NFC"));function*Cs(r){for(const[e,n]of r)for(let t=e;t<=n;t++){let i=String.fromCharCode(t),s=pt(i);s!=i.toLowerCase()&&(s.length>ms||s.length!=0&&(yield{folded:s,composed:i,code_point:t}))}}const ws=r=>{const e={},n=(t,i)=>{const s=e[t]||new Set,o=new RegExp("^"+Ir(s)+"$","iu");i.match(o)||(s.add(Je(i)),e[t]=s)};for(let t of Cs(r))n(t.folded,t.folded),n(t.folded,t.composed);return e},Ss=r=>{const e=ws(r),n={};let t=[];for(let s in e){let o=e[s];o&&(n[s]=Ir(o)),s.length>1&&t.push(Je(s))}t.sort((s,o)=>o.length-s.length);const i=Tt(t);return Pr=new RegExp("^"+i,"u"),n},As=(r,e=1)=>{let n=0;return r=r.map(t=>(ht[t]&&(n+=t.length),ht[t]||t)),n>=e?Tr(r):""},Es=(r,e=1)=>(e=Math.max(e,r.length-1),Tt(xr(r).map(n=>As(n,e)))),Pn=(r,e=!0)=>{let n=r.length>1?1:0;return Tt(r.map(t=>{let i=[];const s=e?t.length():t.length()-1;for(let o=0;o<s;o++)i.push(Es(t.substrs[o]||"",n));return Tr(i)}))},Rs=(r,e)=>{for(const n of e){if(n.start!=r.start||n.end!=r.end||n.substrs.join("")!==r.substrs.join(""))continue;let t=r.parts;const i=s=>{for(const o of t){if(o.start===s.start&&o.substr===s.substr)return!1;if(!(s.length==1||o.length==1)&&(s.start<o.start&&s.end>o.start||o.start<s.start&&o.end>s.start))return!0}return!1};if(!(n.parts.filter(i).length>0))return!0}return!1};class gt{constructor(){Fe(this,"parts"),Fe(this,"substrs"),Fe(this,"start"),Fe(this,"end"),this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,n){let t=new gt,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const h of i)t.add(h);let o=n.substr.substring(0,e-s.start),g=o.length;return t.add({start:s.start,end:s.start+g,length:g,substr:o}),t}}const Ts=r=>{bs(),r=pt(r);let e="",n=[new gt];for(let t=0;t<r.length;t++){let i=r.substring(t).match(Pr);const s=r.substring(t,t+1),o=i?i[0]:null;let g=[],h=new Set;for(const p of n){const w=p.last();if(!w||w.length==1||w.end<=t)if(o){const S=o.length;p.add({start:t,end:t+S,length:S,substr:o}),h.add("1")}else p.add({start:t,end:t+1,length:1,substr:s}),h.add("2");else if(o){let S=p.clone(t,w);const A=o.length;S.add({start:t,end:t+A,length:A,substr:o}),g.push(S)}else h.add("3")}if(g.length>0){g=g.sort((p,w)=>p.length()-w.length());for(let p of g)Rs(p,n)||n.push(p);continue}if(t>0&&h.size==1&&!h.has("3")){e+=Pn(n,!1);let p=new gt;const w=n[0];w&&p.add(w.last()),n=[p]}}return e+=Pn(n,!0),e},Is=(r,e)=>{if(r)return r[e]},xs=(r,e)=>{if(r){for(var n,t=e.split(".");(n=t.shift())&&(r=r[n]););return r}},_t=(r,e,n)=>{var t,i;return!r||(r=r+"",e.regex==null)||(i=r.search(e.regex),i===-1)?0:(t=e.string.length/r.length,i===0&&(t+=.5),t*n)},jt=(r,e)=>{var n=r[e];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(r[e]=[n])},et=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Ps=(r,e)=>typeof r=="number"&&typeof e=="number"?r>e?1:r<e?-1:0:(r=pt(r+"").toLowerCase(),e=pt(e+"").toLowerCase(),r>e?1:e>r?-1:0);class Ms{constructor(e,n){Fe(this,"items"),Fe(this,"settings"),this.items=e,this.settings=n||{diacritics:!0}}tokenize(e,n,t){if(!e||!e.length)return[];const i=[],s=e.split(/\s+/);var o;return t&&(o=new RegExp("^("+Object.keys(t).map(Je).join("|")+"):(.*)$")),s.forEach(g=>{let h,p=null,w=null;o&&(h=g.match(o))&&(p=h[1],g=h[2]),g.length>0&&(this.settings.diacritics?w=Ts(g)||null:w=Je(g),w&&n&&(w="\\b"+w)),i.push({string:g,regex:w?new RegExp(w,"iu"):null,field:p})}),i}getScoreFunction(e,n){var t=this.prepareSearch(e,n);return this._getScoreFunction(t)}_getScoreFunction(e){const n=e.tokens,t=n.length;if(!t)return function(){return 0};const i=e.options.fields,s=e.weights,o=i.length,g=e.getAttrFn;if(!o)return function(){return 1};const h=function(){return o===1?function(p,w){const S=i[0].field;return _t(g(w,S),p,s[S]||1)}:function(p,w){var S=0;if(p.field){const A=g(w,p.field);!p.regex&&A?S+=1/o:S+=_t(A,p,1)}else et(s,(A,P)=>{S+=_t(g(w,P),p,A)});return S/o}}();return t===1?function(p){return h(n[0],p)}:e.options.conjunction==="and"?function(p){var w,S=0;for(let A of n){if(w=h(A,p),w<=0)return 0;S+=w}return S/t}:function(p){var w=0;return et(n,S=>{w+=h(S,p)}),w/t}}getSortFunction(e,n){var t=this.prepareSearch(e,n);return this._getSortFunction(t)}_getSortFunction(e){var n,t=[];const i=this,s=e.options,o=!e.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof o=="function")return o.bind(this);const g=function(h,p){return h==="$score"?p.score:e.getAttrFn(i.items[p.id],h)};if(o)for(let h of o)(e.query||h.field!=="$score")&&t.push(h);if(e.query){n=!0;for(let h of t)if(h.field==="$score"){n=!1;break}n&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(h=>h.field!=="$score");return t.length?function(h,p){var w,S;for(let A of t)if(S=A.field,w=(A.direction==="desc"?-1:1)*Ps(g(S,h),g(S,p)),w)return w;return 0}:null}prepareSearch(e,n){const t={};var i=Object.assign({},n);if(jt(i,"sort"),jt(i,"sort_empty"),i.fields){jt(i,"fields");const s=[];i.fields.forEach(o=>{typeof o=="string"&&(o={field:o,weight:1}),s.push(o),t[o.field]="weight"in o?o.weight:1}),i.fields=s}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,t),total:0,items:[],weights:t,getAttrFn:i.nesting?xs:Is}}search(e,n){var t=this,i,s;s=this.prepareSearch(e,n),n=s.options,e=s.query;const o=n.score||t._getScoreFunction(s);e.length?et(t.items,(h,p)=>{i=o(h),(n.filter===!1||i>0)&&s.items.push({score:i,id:p})}):et(t.items,(h,p)=>{s.items.push({score:1,id:p})});const g=t._getSortFunction(s);return g&&s.items.sort(g),s.total=s.items.length,typeof n.limit=="number"&&(s.items=s.items.slice(0,n.limit)),s}}const Re=r=>typeof r>"u"||r===null?null:at(r),at=r=>typeof r=="boolean"?r?"1":"0":r+"",Ut=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Ls=(r,e)=>e>0?window.setTimeout(r,e):(r.call(null),null),ks=(r,e)=>{var n;return function(t,i){var s=this;n&&(s.loading=Math.max(s.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,s.loadedSearches[t]=!0,r.call(s,t,i)},e)}},Mn=(r,e,n)=>{var t,i=r.trigger,s={};r.trigger=function(){var o=arguments[0];if(e.indexOf(o)!==-1)s[o]=arguments;else return i.apply(r,arguments)},n.apply(r,[]),r.trigger=i;for(t of e)t in s&&i.apply(r,s[t])},Ds=r=>({start:r.selectionStart||0,length:(r.selectionEnd||0)-(r.selectionStart||0)}),le=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},me=(r,e,n,t)=>{r.addEventListener(e,n,t)},De=(r,e)=>{if(!e||!e[r])return!1;var n=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return n===1},Bt=(r,e)=>r.getAttribute("id")||(r.setAttribute("id",e),e),Ln=r=>r.replace(/[\\"']/g,"\\$&"),Ne=(r,e)=>{e&&r.append(e)},de=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},xe=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Mr(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Mr=r=>typeof r=="string"&&r.indexOf("<")>-1,Ns=r=>r.replace(/['"\\]/g,"\\$&"),Ft=(r,e)=>{var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!1),r.dispatchEvent(n)},tt=(r,e)=>{Object.assign(r.style,e)},we=(r,...e)=>{var n=Lr(e);r=kr(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Le=(r,...e)=>{var n=Lr(e);r=kr(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},Lr=r=>{var e=[];return de(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},kr=r=>(Array.isArray(r)||(r=[r]),r),Ht=(r,e,n)=>{if(!(n&&!n.contains(r)))for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},kn=(r,e=0)=>e>0?r[r.length-1]:r[0],_s=r=>Object.keys(r).length===0,Dn=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n},oe=(r,e)=>{de(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},Yt=(r,e)=>{r.parentNode&&r.parentNode.replaceChild(e,r)},js=(r,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const n=s=>{var o=s.data.match(e);if(o&&s.data.length>0){var g=document.createElement("span");g.className="highlight";var h=s.splitText(o.index);h.splitText(o[0].length);var p=h.cloneNode(!0);return g.appendChild(p),Yt(h,g),1}return 0},t=s=>{s.nodeType===1&&s.childNodes&&!/(script|style)/i.test(s.tagName)&&(s.className!=="highlight"||s.tagName!=="SPAN")&&Array.from(s.childNodes).forEach(o=>{i(o)})},i=s=>s.nodeType===3?n(s):(t(s),0);i(r)},Us=r=>{var e=r.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(n){var t=n.parentNode;t.replaceChild(n.firstChild,n),t.normalize()})},Bs=65,Fs=13,Hs=27,Gs=37,$s=38,Vs=39,zs=40,Nn=8,Ws=46,_n=9,qs=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),nt=qs?"metaKey":"ctrlKey",jn={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(r){return r.length>0},render:{}};function Un(r,e){var n=Object.assign({},jn,e),t=n.dataAttr,i=n.labelField,s=n.valueField,o=n.disabledField,g=n.optgroupField,h=n.optgroupLabelField,p=n.optgroupValueField,w=r.tagName.toLowerCase(),S=r.getAttribute("placeholder")||r.getAttribute("data-placeholder");if(!S&&!n.allowEmptyOption){let E=r.querySelector('option[value=""]');E&&(S=E.textContent)}var A={placeholder:S,options:[],optgroups:[],items:[],maxItems:null},P=()=>{var E,R=A.options,x={},C=1;let b=0;var T=u=>{var a=Object.assign({},u.dataset),v=t&&a[t];return typeof v=="string"&&v.length&&(a=Object.assign(a,JSON.parse(v))),a},f=(u,a)=>{var v=Re(u.value);if(v!=null&&!(!v&&!n.allowEmptyOption)){if(x.hasOwnProperty(v)){if(a){var d=x[v][g];d?Array.isArray(d)?d.push(a):x[v][g]=[d,a]:x[v][g]=a}}else{var y=T(u);y[i]=y[i]||u.textContent,y[s]=y[s]||v,y[o]=y[o]||u.disabled,y[g]=y[g]||a,y.$option=u,y.$order=y.$order||++b,x[v]=y,R.push(y)}u.selected&&A.items.push(v)}},c=u=>{var a,v;v=T(u),v[h]=v[h]||u.getAttribute("label")||"",v[p]=v[p]||C++,v[o]=v[o]||u.disabled,v.$order=v.$order||++b,A.optgroups.push(v),a=v[p],de(u.children,d=>{f(d,a)})};A.maxItems=r.hasAttribute("multiple")?null:1,de(r.children,u=>{E=u.tagName.toLowerCase(),E==="optgroup"?c(u):E==="option"&&f(u)})},l=()=>{const E=r.getAttribute(t);if(E)A.options=JSON.parse(E),de(A.options,x=>{A.items.push(x[s])});else{var R=r.value.trim()||"";if(!n.allowEmptyOption&&!R.length)return;const x=R.split(n.delimiter);de(x,C=>{const b={};b[i]=C,b[s]=C,A.options.push(b)}),A.items=x}};return w==="select"?P():l(),Object.assign({},jn,A,e)}var Bn=0;class ye extends fs(cs){constructor(e,n){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Bn++;var t,i=xe(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s=window.getComputedStyle&&window.getComputedStyle(i,null);t=s.getPropertyValue("direction");const o=Un(i,n);this.settings=o,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(t),this.inputId=Bt(i,"tomselect-"+Bn),this.isRequired=i.required,this.sifter=new Ms(this.options,{diacritics:o.diacritics}),o.mode=o.mode||(o.maxItems===1?"single":"multi"),typeof o.hideSelected!="boolean"&&(o.hideSelected=o.mode==="multi"),typeof o.hidePlaceholder!="boolean"&&(o.hidePlaceholder=o.mode!=="multi");var g=o.createFilter;typeof g!="function"&&(typeof g=="string"&&(g=new RegExp(g)),g instanceof RegExp?o.createFilter=R=>g.test(R):o.createFilter=R=>this.settings.duplicates||!this.options[R]),this.initializePlugins(o.plugins),this.setupCallbacks(),this.setupTemplates();const h=xe("<div>"),p=xe("<div>"),w=this._render("dropdown"),S=xe('<div role="listbox" tabindex="-1">'),A=this.input.getAttribute("class")||"",P=o.mode;var l;if(we(h,o.wrapperClass,A,P),we(p,o.controlClass),Ne(h,p),we(w,o.dropdownClass,P),o.copyClassesToDropdown&&we(w,A),we(S,o.dropdownContentClass),Ne(w,S),xe(o.dropdownParent||h).appendChild(w),Mr(o.controlInput)){l=xe(o.controlInput);var E=["autocorrect","autocapitalize","autocomplete","spellcheck"];de(E,R=>{i.getAttribute(R)&&oe(l,{[R]:i.getAttribute(R)})}),l.tabIndex=-1,p.appendChild(l),this.focus_node=l}else o.controlInput?(l=xe(o.controlInput),this.focus_node=l):(l=xe("<input/>"),this.focus_node=p);this.wrapper=h,this.dropdown=w,this.dropdown_content=S,this.control=p,this.control_input=l,this.setup()}setup(){const e=this,n=e.settings,t=e.control_input,i=e.dropdown,s=e.dropdown_content,o=e.wrapper,g=e.control,h=e.input,p=e.focus_node,w={passive:!0},S=e.inputId+"-ts-dropdown";oe(s,{id:S}),oe(p,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":S});const A=Bt(p,e.inputId+"-ts-control"),P="label[for='"+Ns(e.inputId)+"']",l=document.querySelector(P),E=e.focus.bind(e);if(l){me(l,"click",E),oe(l,{for:A});const C=Bt(l,e.inputId+"-ts-label");oe(p,{"aria-labelledby":C}),oe(s,{"aria-labelledby":C})}if(o.style.width=h.style.width,e.plugins.names.length){const C="plugin-"+e.plugins.names.join(" plugin-");we([o,i],C)}(n.maxItems===null||n.maxItems>1)&&e.is_select_tag&&oe(h,{multiple:"multiple"}),n.placeholder&&oe(t,{placeholder:n.placeholder}),!n.splitOn&&n.delimiter&&(n.splitOn=new RegExp("\\s*"+Je(n.delimiter)+"+\\s*")),n.load&&n.loadThrottle&&(n.load=ks(n.load,n.loadThrottle)),me(i,"mousemove",()=>{e.ignoreHover=!1}),me(i,"mouseenter",C=>{var b=Ht(C.target,"[data-selectable]",i);b&&e.onOptionHover(C,b)},{capture:!0}),me(i,"click",C=>{const b=Ht(C.target,"[data-selectable]");b&&(e.onOptionSelect(C,b),le(C,!0))}),me(g,"click",C=>{var b=Ht(C.target,"[data-ts-item]",g);if(b&&e.onItemSelect(C,b)){le(C,!0);return}t.value==""&&(e.onClick(),le(C,!0))}),me(p,"keydown",C=>e.onKeyDown(C)),me(t,"keypress",C=>e.onKeyPress(C)),me(t,"input",C=>e.onInput(C)),me(p,"blur",C=>e.onBlur(C)),me(p,"focus",C=>e.onFocus(C)),me(t,"paste",C=>e.onPaste(C));const R=C=>{const b=C.composedPath()[0];if(!o.contains(b)&&!i.contains(b)){e.isFocused&&e.blur(),e.inputState();return}b==t&&e.isOpen?C.stopPropagation():le(C,!0)},x=()=>{e.isOpen&&e.positionDropdown()};me(document,"mousedown",R),me(window,"scroll",x,w),me(window,"resize",x,w),this._destroy=()=>{document.removeEventListener("mousedown",R),window.removeEventListener("scroll",x),window.removeEventListener("resize",x),l&&l.removeEventListener("click",E)},this.revertSettings={innerHTML:h.innerHTML,tabIndex:h.tabIndex},h.tabIndex=-1,h.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),n.items=[],delete n.optgroups,delete n.options,me(h,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,h.disabled?e.disable():h.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),we(h,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),n.preload===!0&&e.preload()}setupOptions(e=[],n=[]){this.addOptions(e),de(n,t=>{this.registerOptionGroup(t)})}setupTemplates(){var e=this,n=e.settings.labelField,t=e.settings.optgroupLabelField,i={optgroup:s=>{let o=document.createElement("div");return o.className="optgroup",o.appendChild(s.options),o},optgroup_header:(s,o)=>'<div class="optgroup-header">'+o(s[t])+"</div>",option:(s,o)=>"<div>"+o(s[n])+"</div>",item:(s,o)=>"<div>"+o(s[n])+"</div>",option_create:(s,o)=>'<div class="create">Add <strong>'+o(s.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,n,t={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in t)n=this.settings[t[e]],n&&this.on(e,n)}sync(e=!0){const n=this,t=e?Un(n.input,{delimiter:n.settings.delimiter}):n.settings;n.setupOptions(t.options,t.optgroups),n.setValue(t.items||[],!0),n.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Ft(this.input,"input"),Ft(this.input,"change")}onPaste(e){var n=this;if(n.isInputHidden||n.isLocked){le(e);return}n.settings.splitOn&&setTimeout(()=>{var t=n.inputValue();if(t.match(n.settings.splitOn)){var i=t.trim().split(n.settings.splitOn);de(i,s=>{Re(s)&&(this.options[s]?n.addItem(s):n.createItem(s))})}},0)}onKeyPress(e){var n=this;if(n.isLocked){le(e);return}var t=String.fromCharCode(e.keyCode||e.which);if(n.settings.create&&n.settings.mode==="multi"&&t===n.settings.delimiter){n.createItem(),le(e);return}}onKeyDown(e){var n=this;if(n.ignoreHover=!0,n.isLocked){e.keyCode!==_n&&le(e);return}switch(e.keyCode){case Bs:if(De(nt,e)&&n.control_input.value==""){le(e),n.selectAll();return}break;case Hs:n.isOpen&&(le(e,!0),n.close()),n.clearActiveItems();return;case zs:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let t=n.getAdjacent(n.activeOption,1);t&&n.setActiveOption(t)}le(e);return;case $s:if(n.activeOption){let t=n.getAdjacent(n.activeOption,-1);t&&n.setActiveOption(t)}le(e);return;case Fs:n.canSelect(n.activeOption)?(n.onOptionSelect(e,n.activeOption),le(e)):(n.settings.create&&n.createItem()||document.activeElement==n.control_input&&n.isOpen)&&le(e);return;case Gs:n.advanceSelection(-1,e);return;case Vs:n.advanceSelection(1,e);return;case _n:n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(e,n.activeOption),le(e)),n.settings.create&&n.createItem()&&le(e));return;case Nn:case Ws:n.deleteSelection(e);return}n.isInputHidden&&!De(nt,e)&&le(e)}onInput(e){if(this.isLocked)return;const n=this.inputValue();if(this.lastValue!==n){if(this.lastValue=n,n==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=Ls(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,n){this.ignoreHover||this.setActiveOption(n,!1)}onFocus(e){var n=this,t=n.isFocused;if(n.isDisabled||n.isReadOnly){n.blur(),le(e);return}n.ignoreFocus||(n.isFocused=!0,n.settings.preload==="focus"&&n.preload(),t||n.trigger("focus"),n.activeItems.length||(n.inputState(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var n=this;if(n.isFocused){n.isFocused=!1,n.ignoreFocus=!1;var t=()=>{n.close(),n.setActiveItem(),n.setCaret(n.items.length),n.trigger("blur")};n.settings.create&&n.settings.createOnBlur?n.createItem(null,t):t()}}}onOptionSelect(e,n){var t,i=this;n.parentElement&&n.parentElement.matches("[data-disabled]")||(n.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(t=n.dataset.value,typeof t<"u"&&(i.lastQuery=null,i.addItem(t),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(n))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,n){var t=this;return!t.isLocked&&t.settings.mode==="multi"?(le(e),t.setActiveItem(n,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const n=this;if(!n.canLoad(e))return;we(n.wrapper,n.settings.loadingClass),n.loading++;const t=n.loadCallback.bind(n);n.settings.load.call(n,e,t)}loadCallback(e,n){const t=this;t.loading=Math.max(t.loading-1,0),t.lastQuery=null,t.clearActiveOption(),t.setupOptions(e,n),t.refreshOptions(t.isFocused&&!t.isInputHidden),t.loading||Le(t.wrapper,t.settings.loadingClass),t.trigger("load",e,n)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var n=this.control_input,t=n.value!==e;t&&(n.value=e,Ft(n,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,n){var t=n?[]:["change"];Mn(this,t,()=>{this.clear(n),this.addItems(e,n)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,n){var t=this,i,s,o,g,h,p;if(t.settings.mode!=="single"){if(!e){t.clearActiveItems(),t.isFocused&&t.inputState();return}if(i=n&&n.type.toLowerCase(),i==="click"&&De("shiftKey",n)&&t.activeItems.length){for(p=t.getLastActive(),o=Array.prototype.indexOf.call(t.control.children,p),g=Array.prototype.indexOf.call(t.control.children,e),o>g&&(h=o,o=g,g=h),s=o;s<=g;s++)e=t.control.children[s],t.activeItems.indexOf(e)===-1&&t.setActiveItemClass(e);le(n)}else i==="click"&&De(nt,n)||i==="keydown"&&De("shiftKey",n)?e.classList.contains("active")?t.removeActiveItem(e):t.setActiveItemClass(e):(t.clearActiveItems(),t.setActiveItemClass(e));t.inputState(),t.isFocused||t.focus()}}setActiveItemClass(e){const n=this,t=n.control.querySelector(".last-active");t&&Le(t,"last-active"),we(e,"active last-active"),n.trigger("item_select",e),n.activeItems.indexOf(e)==-1&&n.activeItems.push(e)}removeActiveItem(e){var n=this.activeItems.indexOf(e);this.activeItems.splice(n,1),Le(e,"active")}clearActiveItems(){Le(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,n=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,oe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),oe(e,{"aria-selected":"true"}),we(e,"active"),n&&this.scrollToOption(e)))}scrollToOption(e,n){if(!e)return;const t=this.dropdown_content,i=t.clientHeight,s=t.scrollTop||0,o=e.offsetHeight,g=e.getBoundingClientRect().top-t.getBoundingClientRect().top+s;g+o>i+s?this.scroll(g-i+o,n):g<s&&this.scroll(g,n)}scroll(e,n){const t=this.dropdown_content;n&&(t.style.scrollBehavior=n),t.scrollTop=e,t.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(Le(this.activeOption,"active"),oe(this.activeOption,{"aria-selected":null})),this.activeOption=null,oe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const n=e.controlChildren();n.length&&(e.inputState(),e.close(),e.activeItems=n,de(n,t=>{e.setActiveItemClass(t)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(oe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&oe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,n=e.sortField;return typeof e.sortField=="string"&&(n=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:n,nesting:e.nesting}}search(e){var n,t,i=this,s=this.getSearchOptions();if(i.settings.score&&(t=i.settings.score.call(i,e),typeof t!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,n=i.sifter.search(e,Object.assign(s,{score:t})),i.currentResults=n):n=Object.assign({},i.currentResults),i.settings.hideSelected&&(n.items=n.items.filter(o=>{let g=Re(o.id);return!(g&&i.items.indexOf(g)!==-1)})),n}refreshOptions(e=!0){var n,t,i,s,o,g,h,p,w,S;const A={},P=[];var l=this,E=l.inputValue();const R=E===l.lastQuery||E==""&&l.lastQuery==null;var x=l.search(E),C=null,b=l.settings.shouldOpen||!1,T=l.dropdown_content;R&&(C=l.activeOption,C&&(w=C.closest("[data-group]"))),s=x.items.length,typeof l.settings.maxOptions=="number"&&(s=Math.min(s,l.settings.maxOptions)),s>0&&(b=!0);const f=(u,a)=>{let v=A[u];if(v!==void 0){let y=P[v];if(y!==void 0)return[v,y.fragment]}let d=document.createDocumentFragment();return v=P.length,P.push({fragment:d,order:a,optgroup:u}),[v,d]};for(n=0;n<s;n++){let u=x.items[n];if(!u)continue;let a=u.id,v=l.options[a];if(v===void 0)continue;let d=at(a),y=l.getOption(d,!0);for(l.settings.hideSelected||y.classList.toggle("selected",l.items.includes(d)),o=v[l.settings.optgroupField]||"",g=Array.isArray(o)?o:[o],t=0,i=g&&g.length;t<i;t++){o=g[t];let N=v.$order,D=l.optgroups[o];D===void 0?o="":N=D.$order;const[L,I]=f(o,N);t>0&&(y=y.cloneNode(!0),oe(y,{id:v.$id+"-clone-"+t,"aria-selected":null}),y.classList.add("ts-cloned"),Le(y,"active"),l.activeOption&&l.activeOption.dataset.value==a&&w&&w.dataset.group===o.toString()&&(C=y)),I.appendChild(y),o!=""&&(A[o]=L)}}l.settings.lockOptgroupOrder&&P.sort((u,a)=>u.order-a.order),h=document.createDocumentFragment(),de(P,u=>{let a=u.fragment,v=u.optgroup;if(!a||!a.children.length)return;let d=l.optgroups[v];if(d!==void 0){let y=document.createDocumentFragment(),N=l.render("optgroup_header",d);Ne(y,N),Ne(y,a);let D=l.render("optgroup",{group:d,options:y});Ne(h,D)}else Ne(h,a)}),T.innerHTML="",Ne(T,h),l.settings.highlight&&(Us(T),x.query.length&&x.tokens.length&&de(x.tokens,u=>{js(T,u.regex)}));var c=u=>{let a=l.render(u,{input:E});return a&&(b=!0,T.insertBefore(a,T.firstChild)),a};if(l.loading?c("loading"):l.settings.shouldLoad.call(l,E)?x.items.length===0&&c("no_results"):c("not_loading"),p=l.canCreate(E),p&&(S=c("option_create")),l.hasOptions=x.items.length>0||p,b){if(x.items.length>0){if(!C&&l.settings.mode==="single"&&l.items[0]!=null&&(C=l.getOption(l.items[0])),!T.contains(C)){let u=0;S&&!l.settings.addPrecedence&&(u=1),C=l.selectable()[u]}}else S&&(C=S);e&&!l.isOpen&&(l.open(),l.scrollToOption(C,"auto")),l.setActiveOption(C)}else l.clearActiveOption(),e&&l.isOpen&&l.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,n=!1){const t=this;if(Array.isArray(e))return t.addOptions(e,n),!1;const i=Re(e[t.settings.valueField]);return i===null||t.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++t.order,e.$id=t.inputId+"-opt-"+e.$order,t.options[i]=e,t.lastQuery=null,n&&(t.userOptions[i]=n,t.trigger("option_add",i,e)),i)}addOptions(e,n=!1){de(e,t=>{this.addOption(t,n)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var n=Re(e[this.settings.optgroupValueField]);return n===null?!1:(e.$order=e.$order||++this.order,this.optgroups[n]=e,n)}addOptionGroup(e,n){var t;n[this.settings.optgroupValueField]=e,(t=this.registerOptionGroup(n))&&this.trigger("optgroup_add",t,n)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,n){const t=this;var i,s;const o=Re(e),g=Re(n[t.settings.valueField]);if(o===null)return;const h=t.options[o];if(h==null)return;if(typeof g!="string")throw new Error("Value must be set in option data");const p=t.getOption(o),w=t.getItem(o);if(n.$order=n.$order||h.$order,delete t.options[o],t.uncacheValue(g),t.options[g]=n,p){if(t.dropdown_content.contains(p)){const S=t._render("option",n);Yt(p,S),t.activeOption===p&&t.setActiveOption(S)}p.remove()}w&&(s=t.items.indexOf(o),s!==-1&&t.items.splice(s,1,g),i=t._render("item",n),w.classList.contains("active")&&we(i,"active"),Yt(w,i)),t.lastQuery=null}removeOption(e,n){const t=this;e=at(e),t.uncacheValue(e),delete t.userOptions[e],delete t.options[e],t.lastQuery=null,t.trigger("option_remove",e),t.removeItem(e,n)}clearOptions(e){const n=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};de(this.options,(i,s)=>{n(i,s)&&(t[s]=i)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,n){return this.items.indexOf(n)>=0}getOption(e,n=!1){const t=Re(e);if(t===null)return null;const i=this.options[t];if(i!=null){if(i.$div)return i.$div;if(n)return this._render("option",i)}return null}getAdjacent(e,n,t="option"){var i=this,s;if(!e)return null;t=="item"?s=i.controlChildren():s=i.dropdown_content.querySelectorAll("[data-selectable]");for(let o=0;o<s.length;o++)if(s[o]==e)return n>0?s[o+1]:s[o-1];return null}getItem(e){if(typeof e=="object")return e;var n=Re(e);return n!==null?this.control.querySelector(`[data-value="${Ln(n)}"]`):null}addItems(e,n){var t=this,i=Array.isArray(e)?e:[e];i=i.filter(o=>t.items.indexOf(o)===-1);const s=i[i.length-1];i.forEach(o=>{t.isPending=o!==s,t.addItem(o,n)})}addItem(e,n){var t=n?[]:["change","dropdown_close"];Mn(this,t,()=>{var i,s;const o=this,g=o.settings.mode,h=Re(e);if(!(h&&o.items.indexOf(h)!==-1&&(g==="single"&&o.close(),g==="single"||!o.settings.duplicates))&&!(h===null||!o.options.hasOwnProperty(h))&&(g==="single"&&o.clear(n),!(g==="multi"&&o.isFull()))){if(i=o._render("item",o.options[h]),o.control.contains(i)&&(i=i.cloneNode(!0)),s=o.isFull(),o.items.splice(o.caretPos,0,h),o.insertAtCaret(i),o.isSetup){if(!o.isPending&&o.settings.hideSelected){let p=o.getOption(h),w=o.getAdjacent(p,1);w&&o.setActiveOption(w)}!o.isPending&&!o.settings.closeAfterSelect&&o.refreshOptions(o.isFocused&&g!=="single"),o.settings.closeAfterSelect!=!1&&o.isFull()?o.close():o.isPending||o.positionDropdown(),o.trigger("item_add",h,i),o.isPending||o.updateOriginalInput({silent:n})}(!o.isPending||!s&&o.isFull())&&(o.inputState(),o.refreshState())}})}removeItem(e=null,n){const t=this;if(e=t.getItem(e),!e)return;var i,s;const o=e.dataset.value;i=Dn(e),e.remove(),e.classList.contains("active")&&(s=t.activeItems.indexOf(e),t.activeItems.splice(s,1),Le(e,"active")),t.items.splice(i,1),t.lastQuery=null,!t.settings.persist&&t.userOptions.hasOwnProperty(o)&&t.removeOption(o,n),i<t.caretPos&&t.setCaret(t.caretPos-1),t.updateOriginalInput({silent:n}),t.refreshState(),t.positionDropdown(),t.trigger("item_remove",o,e)}createItem(e=null,n=()=>{}){arguments.length===3&&(n=arguments[2]),typeof n!="function"&&(n=()=>{});var t=this,i=t.caretPos,s;if(e=e||t.inputValue(),!t.canCreate(e))return n(),!1;t.lock();var o=!1,g=h=>{if(t.unlock(),!h||typeof h!="object")return n();var p=Re(h[t.settings.valueField]);if(typeof p!="string")return n();t.setTextboxValue(),t.addOption(h,!0),t.setCaret(i),t.addItem(p),n(h),o=!0};return typeof t.settings.create=="function"?s=t.settings.create.call(this,e,g):s={[t.settings.labelField]:e,[t.settings.valueField]:e},o||g(s),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const n=e.isFull(),t=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",t),i.toggle("full",n),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",_s(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const n=this;var t,i;const s=n.input.querySelector('option[value=""]');if(n.is_select_tag){let o=function(p,w,S){return p||(p=xe('<option value="'+Ut(w)+'">'+Ut(S)+"</option>")),p!=s&&n.input.append(p),g.push(p),(p!=s||h>0)&&(p.selected=!0),p};const g=[],h=n.input.querySelectorAll("option:checked").length;n.input.querySelectorAll("option:checked").forEach(p=>{p.selected=!1}),n.items.length==0&&n.settings.mode=="single"?o(s,"",""):n.items.forEach(p=>{if(t=n.options[p],i=t[n.settings.labelField]||"",g.includes(t.$option)){const w=n.input.querySelector(`option[value="${Ln(p)}"]:not(:checked)`);o(w,p,i)}else t.$option=o(t.$option,p,i)})}else n.input.value=n.getValue();n.isSetup&&(e.silent||n.trigger("change",n.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,oe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),tt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),tt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var n=this,t=n.isOpen;e&&(n.setTextboxValue(),n.settings.mode==="single"&&n.items.length&&n.inputState()),n.isOpen=!1,oe(n.focus_node,{"aria-expanded":"false"}),tt(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),t&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,n=e.getBoundingClientRect(),t=e.offsetHeight+n.top+window.scrollY,i=n.left+window.scrollX;tt(this.dropdown,{width:n.width+"px",top:t+"px",left:i+"px"})}}clear(e){var n=this;if(n.items.length){var t=n.controlChildren();de(t,i=>{n.removeItem(i,!0)}),n.inputState(),e||n.updateOriginalInput(),n.trigger("clear")}}insertAtCaret(e){const n=this,t=n.caretPos,i=n.control;i.insertBefore(e,i.children[t]||null),n.setCaret(t+1)}deleteSelection(e){var n,t,i,s,o=this;n=e&&e.keyCode===Nn?-1:1,t=Ds(o.control_input);const g=[];if(o.activeItems.length)s=kn(o.activeItems,n),i=Dn(s),n>0&&i++,de(o.activeItems,h=>g.push(h));else if((o.isFocused||o.settings.mode==="single")&&o.items.length){const h=o.controlChildren();let p;n<0&&t.start===0&&t.length===0?p=h[o.caretPos-1]:n>0&&t.start===o.inputValue().length&&(p=h[o.caretPos]),p!==void 0&&g.push(p)}if(!o.shouldDelete(g,e))return!1;for(le(e,!0),typeof i<"u"&&o.setCaret(i);g.length;)o.removeItem(g.pop());return o.inputState(),o.positionDropdown(),o.refreshOptions(!1),!0}shouldDelete(e,n){const t=e.map(i=>i.dataset.value);return!(!t.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(t,n)===!1)}advanceSelection(e,n){var t,i,s=this;s.rtl&&(e*=-1),!s.inputValue().length&&(De(nt,n)||De("shiftKey",n)?(t=s.getLastActive(e),t?t.classList.contains("active")?i=s.getAdjacent(t,e,"item"):i=t:e>0?i=s.control_input.nextElementSibling:i=s.control_input.previousElementSibling,i&&(i.classList.contains("active")&&s.removeActiveItem(t),s.setActiveItemClass(i))):s.moveCaret(e))}moveCaret(e){}getLastActive(e){let n=this.control.querySelector(".last-active");if(n)return n;var t=this.control.querySelectorAll(".active");if(t)return kn(t,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,n=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=n.innerHTML,e.input.tabIndex=n.tabIndex,Le(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,n){var t,i;const s=this;if(typeof this.settings.render[e]!="function"||(i=s.settings.render[e].call(this,n,Ut),!i))return null;if(i=xe(i),e==="option"||e==="option_create"?n[s.settings.disabledField]?oe(i,{"aria-disabled":"true"}):oe(i,{"data-selectable":""}):e==="optgroup"&&(t=n.group[s.settings.optgroupValueField],oe(i,{"data-group":t}),n.group[s.settings.disabledField]&&oe(i,{"data-disabled":""})),e==="option"||e==="item"){const o=at(n[s.settings.valueField]);oe(i,{"data-value":o}),e==="item"?(we(i,s.settings.itemClass),oe(i,{"data-ts-item":""})):(we(i,s.settings.optionClass),oe(i,{role:"option",id:n.$id}),n.$div=i,s.options[o]=n)}return i}_render(e,n){const t=this.render(e,n);if(t==null)throw"HTMLElement expected";return t}clearCache(){de(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const n=this.getOption(e);n&&n.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,n,t){var i=this,s=i[n];i[n]=function(){var o,g;return e==="after"&&(o=s.apply(i,arguments)),g=t.apply(i,arguments),e==="instead"?g:(e==="before"&&(o=s.apply(i,arguments)),o)}}}const Ks=(r,e,n,t)=>{r.addEventListener(e,n,t)};function Js(){Ks(this.input,"change",()=>{this.sync()})}const Qs=r=>typeof r>"u"||r===null?null:Xs(r),Xs=r=>typeof r=="boolean"?r?"1":"0":r+"",Fn=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ys=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Zs(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Zs=r=>typeof r=="string"&&r.indexOf("<")>-1;function ea(r){var e=this,n=e.onOptionSelect;e.settings.hideSelected=!1;const t=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},r);var i=function(o,g){g?(o.checked=!0,t.uncheckedClassNames&&o.classList.remove(...t.uncheckedClassNames),t.checkedClassNames&&o.classList.add(...t.checkedClassNames)):(o.checked=!1,t.checkedClassNames&&o.classList.remove(...t.checkedClassNames),t.uncheckedClassNames&&o.classList.add(...t.uncheckedClassNames))},s=function(o){setTimeout(()=>{var g=o.querySelector("input."+t.className);g instanceof HTMLInputElement&&i(g,o.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var o=e.settings.render.option;e.settings.render.option=(g,h)=>{var p=Ys(o.call(e,g,h)),w=document.createElement("input");t.className&&w.classList.add(t.className),w.addEventListener("click",function(A){Fn(A)}),w.type="checkbox";const S=Qs(g[e.settings.valueField]);return i(w,!!(S&&e.items.indexOf(S)>-1)),p.prepend(w),p}}),e.on("item_remove",o=>{var g=e.getOption(o);g&&(g.classList.remove("selected"),s(g))}),e.on("item_add",o=>{var g=e.getOption(o);g&&s(g)}),e.hook("instead","onOptionSelect",(o,g)=>{if(g.classList.contains("selected")){g.classList.remove("selected"),e.removeItem(g.dataset.value),e.refreshOptions(),Fn(o,!0);return}n.call(e,o,g),s(g)})}const ta=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(na(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},na=r=>typeof r=="string"&&r.indexOf("<")>-1;function ra(r){const e=this,n=Object.assign({className:"clear-button",title:"Clear All",html:t=>`<div class="${t.className}" title="${t.title}">&#10799;</div>`},r);e.on("initialize",()=>{var t=ta(n.html(n));t.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(t)})}const ia=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Be=(r,e,n,t)=>{r.addEventListener(e,n,t)},oa=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},sa=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(aa(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},aa=r=>typeof r=="string"&&r.indexOf("<")>-1,la=(r,e)=>{oa(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},ua=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r.nextSibling)},ca=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r)},fa=(r,e)=>{do{var n;if(e=(n=e)==null?void 0:n.previousElementSibling,r==e)return!0}while(e&&e.previousElementSibling);return!1};function da(){var r=this;if(r.settings.mode!=="multi")return;var e=r.lock,n=r.unlock;let t=!0,i;r.hook("after","setupTemplates",()=>{var s=r.settings.render.item;r.settings.render.item=(o,g)=>{const h=sa(s.call(r,o,g));la(h,{draggable:"true"});const p=E=>{t||ia(E),E.stopPropagation()},w=E=>{i=h,setTimeout(()=>{h.classList.add("ts-dragging")},0)},S=E=>{E.preventDefault(),h.classList.add("ts-drag-over"),P(h,i)},A=()=>{h.classList.remove("ts-drag-over")},P=(E,R)=>{R!==void 0&&(fa(R,h)?ua(E,R):ca(E,R))},l=()=>{var E;document.querySelectorAll(".ts-drag-over").forEach(x=>x.classList.remove("ts-drag-over")),(E=i)==null||E.classList.remove("ts-dragging"),i=void 0;var R=[];r.control.querySelectorAll("[data-value]").forEach(x=>{if(x.dataset.value){let C=x.dataset.value;C&&R.push(C)}}),r.setValue(R)};return Be(h,"mousedown",p),Be(h,"dragstart",w),Be(h,"dragenter",S),Be(h,"dragover",S),Be(h,"dragleave",A),Be(h,"dragend",l),h}}),r.hook("instead","lock",()=>(t=!1,e.call(r))),r.hook("instead","unlock",()=>(t=!0,n.call(r)))}const ha=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},pa=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(ga(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},ga=r=>typeof r=="string"&&r.indexOf("<")>-1;function va(r){const e=this,n=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:t=>'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a class="'+t.closeClass+'">&times;</a></div></div>'},r);e.on("initialize",()=>{var t=pa(n.html(n)),i=t.querySelector("."+n.closeClass);i&&i.addEventListener("click",s=>{ha(s,!0),e.close()}),e.dropdown.insertBefore(t,e.dropdown.firstChild)})}const ma=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},ya=(r,...e)=>{var n=ba(e);r=Oa(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},ba=r=>{var e=[];return ma(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Oa=r=>(Array.isArray(r)||(r=[r]),r),Ca=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function wa(){var r=this;r.hook("instead","setCaret",e=>{r.settings.mode==="single"||!r.control.contains(r.control_input)?e=r.items.length:(e=Math.max(0,Math.min(r.items.length,e)),e!=r.caretPos&&!r.isPending&&r.controlChildren().forEach((n,t)=>{t<e?r.control_input.insertAdjacentElement("beforebegin",n):r.control.appendChild(n)})),r.caretPos=e}),r.hook("instead","moveCaret",e=>{if(!r.isFocused)return;const n=r.getLastActive(e);if(n){const t=Ca(n);r.setCaret(e>0?t+1:t),r.setActiveItem(),ya(n,"last-active")}else r.setCaret(r.caretPos+e)})}const Sa=27,Aa=9,Ea=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ra=(r,e,n,t)=>{r.addEventListener(e,n,t)},Ta=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Hn=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Ia(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Ia=r=>typeof r=="string"&&r.indexOf("<")>-1,xa=(r,...e)=>{var n=Pa(e);r=Ma(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Pa=r=>{var e=[];return Ta(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Ma=r=>(Array.isArray(r)||(r=[r]),r);function La(){const r=this;r.settings.shouldOpen=!0,r.hook("before","setup",()=>{r.focus_node=r.control,xa(r.control_input,"dropdown-input");const e=Hn('<div class="dropdown-input-wrap">');e.append(r.control_input),r.dropdown.insertBefore(e,r.dropdown.firstChild);const n=Hn('<input class="items-placeholder" tabindex="-1" />');n.placeholder=r.settings.placeholder||"",r.control.append(n)}),r.on("initialize",()=>{r.control_input.addEventListener("keydown",n=>{switch(n.keyCode){case Sa:r.isOpen&&(Ea(n,!0),r.close()),r.clearActiveItems();return;case Aa:r.focus_node.tabIndex=-1;break}return r.onKeyDown.call(r,n)}),r.on("blur",()=>{r.focus_node.tabIndex=r.isDisabled?-1:r.tabIndex}),r.on("dropdown_open",()=>{r.control_input.focus()});const e=r.onBlur;r.hook("instead","onBlur",n=>{if(!(n&&n.relatedTarget==r.control_input))return e.call(r)}),Ra(r.control_input,"blur",()=>r.onBlur()),r.hook("before","close",()=>{r.isOpen&&r.focus_node.focus({preventScroll:!0})})})}const rt=(r,e,n,t)=>{r.addEventListener(e,n,t)};function ka(){var r=this;r.on("initialize",()=>{var e=document.createElement("span"),n=r.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",r.wrapper.appendChild(e);var t=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const s of t)e.style[s]=n.style[s];var i=()=>{e.textContent=n.value,n.style.width=e.clientWidth+"px"};i(),r.on("update item_add item_remove",i),rt(n,"input",i),rt(n,"keyup",i),rt(n,"blur",i),rt(n,"update",i)})}function Da(){var r=this,e=r.deleteSelection;this.hook("instead","deleteSelection",n=>r.activeItems.length?e.call(r,n):!1)}function Na(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const Gn=37,_a=39,ja=(r,e,n)=>{for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},Ua=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function Ba(){var r=this,e=r.onKeyDown;r.hook("instead","onKeyDown",n=>{var t,i,s,o;if(!r.isOpen||!(n.keyCode===Gn||n.keyCode===_a))return e.call(r,n);r.ignoreHover=!0,o=ja(r.activeOption,"[data-group]"),t=Ua(r.activeOption,"[data-selectable]"),o&&(n.keyCode===Gn?o=o.previousSibling:o=o.nextSibling,o&&(s=o.querySelectorAll("[data-selectable]"),i=s[Math.min(s.length-1,t)],i&&r.setActiveOption(i)))})}const Fa=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),$n=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Vn=(r,e,n,t)=>{r.addEventListener(e,n,t)},zn=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Ha(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Ha=r=>typeof r=="string"&&r.indexOf("<")>-1;function Ga(r){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},r);var n=this;if(e.append){var t='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Fa(e.title)+'">'+e.label+"</a>";n.hook("after","setupTemplates",()=>{var i=n.settings.render.item;n.settings.render.item=(s,o)=>{var g=zn(i.call(n,s,o)),h=zn(t);return g.appendChild(h),Vn(h,"mousedown",p=>{$n(p,!0)}),Vn(h,"click",p=>{n.isLocked||($n(p,!0),!n.isLocked&&n.shouldDelete([g],p)&&(n.removeItem(g),n.refreshOptions(!1),n.inputState()))}),g}})}}function $a(r){const e=this,n=Object.assign({text:t=>t[e.settings.labelField]},r);e.on("item_remove",function(t){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[t];i&&e.setTextboxValue(n.text.call(e,i))}})}const Va=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},za=(r,...e)=>{var n=Wa(e);r=qa(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Wa=r=>{var e=[];return Va(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},qa=r=>(Array.isArray(r)||(r=[r]),r);function Ka(){const r=this,e=r.canLoad,n=r.clearActiveOption,t=r.loadCallback;var i={},s,o=!1,g,h=[];if(r.settings.shouldLoadMore||(r.settings.shouldLoadMore=()=>{if(s.clientHeight/(s.scrollHeight-s.scrollTop)>.9)return!0;if(r.activeOption){var S=r.selectable(),A=Array.from(S).indexOf(r.activeOption);if(A>=S.length-2)return!0}return!1}),!r.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";r.settings.sortField=[{field:"$order"},{field:"$score"}];const p=S=>typeof r.settings.maxOptions=="number"&&s.children.length>=r.settings.maxOptions?!1:!!(S in i&&i[S]),w=(S,A)=>r.items.indexOf(A)>=0||h.indexOf(A)>=0;r.setNextUrl=(S,A)=>{i[S]=A},r.getUrl=S=>{if(S in i){const A=i[S];return i[S]=!1,A}return r.clearPagination(),r.settings.firstUrl.call(r,S)},r.clearPagination=()=>{i={}},r.hook("instead","clearActiveOption",()=>{if(!o)return n.call(r)}),r.hook("instead","canLoad",S=>S in i?p(S):e.call(r,S)),r.hook("instead","loadCallback",(S,A)=>{if(!o)r.clearOptions(w);else if(g){const P=S[0];P!==void 0&&(g.dataset.value=P[r.settings.valueField])}t.call(r,S,A),o=!1}),r.hook("after","refreshOptions",()=>{const S=r.lastValue;var A;p(S)?(A=r.render("loading_more",{query:S}),A&&(A.setAttribute("data-selectable",""),g=A)):S in i&&!s.querySelector(".no-results")&&(A=r.render("no_more_results",{query:S})),A&&(za(A,r.settings.optionClass),s.append(A))}),r.on("initialize",()=>{h=Object.keys(r.options),s=r.dropdown_content,r.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},r.settings.render),s.addEventListener("scroll",()=>{r.settings.shouldLoadMore.call(r)&&p(r.lastValue)&&(o||(o=!0,r.load.call(r,r.lastValue)))})})}ye.define("change_listener",Js);ye.define("checkbox_options",ea);ye.define("clear_button",ra);ye.define("drag_drop",da);ye.define("dropdown_header",va);ye.define("caret_position",wa);ye.define("dropdown_input",La);ye.define("input_autogrow",ka);ye.define("no_backspace_delete",Da);ye.define("no_active_items",Na);ye.define("optgroup_columns",Ba);ye.define("remove_button",Ga);ye.define("restore_on_backspace",$a);ye.define("virtual_scroll",Ka);const Ja=r=>({init(){const e=this.$refs[`select_picker_${r.dataField}_${r.tableName}`],n={items:r.initialValues,...r.framework,onChange:s=>{Rr(r,s)},onInitialize:()=>{window.addEventListener(`pg:clear_multi_select::${r.tableName}:${r.dataField}`,()=>{e&&e.tomselect.clear(!0)}),window.addEventListener(`pg:clear_all_multi_select::${r.tableName}`,()=>{e&&e.tomselect.clear(!0)})}},t={valueField:r.optionValue,labelField:r.optionLabel,searchField:r.optionLabel,load:async function(s,o){function g(h,p){var w;const{method:S,url:A}=h,P=new Request(A,{method:S,body:S.toLowerCase()==="post"?JSON.stringify({search:p,...i}):void 0});P.headers.set("Content-Type","application/json"),P.headers.set("Accept","application/json"),P.headers.set("X-Requested-With","XMLHttpRequest");const l=(w=document.head.querySelector('[name="csrf-token"]'))==null?void 0:w.getAttribute("content");return l&&P.headers.set("X-CSRF-TOKEN",l),P}fetch(g(r.asyncData,s)).then(h=>h.json()).then(h=>{o(h)}).catch(()=>{o()})},render:{option:function(s,o){return`<div class="py-2 mb-1"><span>${o(s[r.optionLabel])}</span></div>`},item:function(s,o){return`<div class="py-2 mb-1"><span>${o(s[r.optionLabel])}</span></div>`}}};let i=n;r.hasOwnProperty("asyncData")&&(i=Object.assign(n,t)),new ye(e,i)}}),Qa=r=>({initialValues:r.initialValues,framework:r.framework,init(){const e=this.$refs["select_picker_"+r.dataField+"_"+r.tableName],n=this.deepCopy(this.framework);new window.SlimSelect({select:e,...n,events:{afterChange:t=>{let i=t.map(s=>s.value);Rr(r,i)}}})},deepCopy(e){if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(this.deepCopy);const n={};for(const t in e)e.hasOwnProperty(t)&&(n[t]=this.deepCopy(e[t]));return n}}),Xa=()=>({init(){Livewire.on("pg:scrollTop",r=>{setTimeout(()=>{document.querySelector("body").scrollIntoView({behavior:"auto"})},0)}),new IntersectionObserver(r=>{r[0].isIntersecting&&this.$wire.call("loadMore")},{rootMargin:"300px"}).observe(this.$el)}}),Ya=r=>({rowId:(r==null?void 0:r.rowId)??null,parentId:(r==null?void 0:r.parentId)??null,toHtml(){let e=null;const n=this.parentId??this.$wire.id;if(this.rowId){const i=window[`pgActions_${n}`];i&&i[this.rowId]!==void 0&&(e=i[this.rowId])}else e=window[`pgActionsHeader_${n}`];if(typeof e!="object"||e===null)return"";let t="";return e.forEach(i=>{let s=this.shouldHideAction(i),o=this.getReplaceHtml(i);if(!s)if(o)t+=o;else{let g=this.buildAttributesString(i);if(i.icon){let h=this.processIcon(i);if(!h)return;t+=this.buildActionHtmlWithIcon(i,g,h)}else t+=this.buildActionHtml(i,g)}}),t},shouldHideAction(e){if(e.can===!1)return!0;let n=!1;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(t=>{t.action.includes(e.action)&&t.apply&&t.rule.hide&&(n=!0)}),n},getReplaceHtml(e){let n=null;return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(t=>{t.apply&&t.action.includes(e.action)&&t.replaceHtml&&(n=t.replaceHtml)}),n},buildAttributesString(e){let n=e.attributes??[];return e.rules&&Object.values(e.rules).length>0&&Object.values(e.rules).forEach(t=>{t.apply&&t.action.includes(e.action)&&t.rule.setAttribute&&t.rule.setAttribute.length>0&&Object.values(t.rule.setAttribute).forEach(i=>{n[i.attribute]=i.value})}),Object.entries(n).map(([t,i])=>` ${t}="${i}"`).join("")},processIcon(e){const n=Object.entries(e.iconAttributes??[]).map(([i,s])=>` ${i}="${s}"`).join("");let t=window.pgResourceIcons[e.icon];return typeof t>"u"?(console.warn(`PowerGrid: Unable to load icons in javascript window in row: [${this.rowId}]`),null):this.replaceIconAttributes(t,n)},replaceIconAttributes(e,n){return e.replace(/<([^\s>]+)([^>]*)>/,(t,i,s)=>{let o=s.trim();const g=n.replace(/class="([^"]*)"/,(h,p)=>(o.includes("class=")?o=o.replace(/class="([^"]*)"/,(w,S)=>`class="${S} ${p.trim()}"`):o+=` ${h}`,""));return`<${i} ${o} ${g}>`})},buildActionHtmlWithIcon(e,n,t){return e.slot?`<${e.tag??"button"} ${n}>${t} ${e.slot}</${e.tag??"button"}>`:`<${e.tag??"button"} ${n}>${t}</${e.tag??"button"}>`},buildActionHtml(e,n){return`<${e.tag??"button"} ${n}>${e.slot}</${e.tag??"button"}>`}}),Za=r=>({templateContent:(r==null?void 0:r.templateContent)??null,rendered:null,parentId:(r==null?void 0:r.parentId)??null,init(){const e=Object.keys(this.templateContent)[0],n=window[`pgRowTemplates_${this.parentId??this.$wire.id}`][e],t=this.templateContent[e];if(t){let i=n;for(const[s,o]of Object.entries(t)){const g=`{{ ${s} }}`,h=String(o).replace(/'/g,"\\'");i=i.replaceAll(g,h)}this.rendered=i}}}),el=r=>({rowId:r.rowId,rules:r.rules,defaultClasses:r.defaultClasses,attributes:[],theme:[],init(){this.rules&&Object.values(this.rules).forEach(e=>{(e.applyLoop||e.apply)&&e!=null&&e.attributes&&this.attributes.push(e.attributes)})},getAttributes(){let e={class:this.defaultClasses};return this.attributes.forEach(n=>{Object.keys(n).forEach(t=>{e[t]+=e[t]?` ${n[t]}`:n[t]})}),e}});window.pgToggleable=Yo;window.pgFlatpickr=es;window.pgEditable=ts;window.pgResponsive=ls;window.pgTomSelect=Ja;window.pgSlimSelect=Qa;window.pgLoadMore=Xa;window.pgRenderActions=Ya;window.pgRowAttributes=el;window.pgRenderRowTemplate=Za;document.addEventListener("DOMContentLoaded",()=>{Livewire.hook("commit",({component:r,succeed:e,fail:n})=>{r.ephemeral.setUp&&r.ephemeral.setUp.hasOwnProperty("responsive")&&(e(()=>{queueMicrotask(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))})}),n(()=>{window.dispatchEvent(new CustomEvent("pg-livewire-request-finished"))}))})});document.addEventListener("DOMContentLoaded",()=>{window.Alpine.directive("multisort-shift-click",(r,{expression:e})=>{r.addEventListener("click",n=>{window.Livewire.find(e).set("multiSort",n.shiftKey)})})});var Gt={exports:{}},Wn;function Dr(){return Wn||(Wn=1,function(r,e){(function(n,t){r.exports=t()})(on,function(){var n=1e3,t=6e4,i=36e5,s="millisecond",o="second",g="minute",h="hour",p="day",w="week",S="month",A="quarter",P="year",l="date",E="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,x=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,C={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(L){var I=["th","st","nd","rd"],m=L%100;return"["+L+(I[(m-20)%10]||I[m]||I[0])+"]"}},b=function(L,I,m){var O=String(L);return!O||O.length>=I?L:""+Array(I+1-O.length).join(m)+L},T={s:b,z:function(L){var I=-L.utcOffset(),m=Math.abs(I),O=Math.floor(m/60),k=m%60;return(I<=0?"+":"-")+b(O,2,"0")+":"+b(k,2,"0")},m:function L(I,m){if(I.date()<m.date())return-L(m,I);var O=12*(m.year()-I.year())+(m.month()-I.month()),k=I.clone().add(O,S),j=m-k<0,B=I.clone().add(O+(j?-1:1),S);return+(-(O+(m-k)/(j?k-B:B-k))||0)},a:function(L){return L<0?Math.ceil(L)||0:Math.floor(L)},p:function(L){return{M:S,y:P,w,d:p,D:l,h,m:g,s:o,ms:s,Q:A}[L]||String(L||"").toLowerCase().replace(/s$/,"")},u:function(L){return L===void 0}},f="en",c={};c[f]=C;var u="$isDayjsObject",a=function(L){return L instanceof N||!(!L||!L[u])},v=function L(I,m,O){var k;if(!I)return f;if(typeof I=="string"){var j=I.toLowerCase();c[j]&&(k=j),m&&(c[j]=m,k=j);var B=I.split("-");if(!k&&B.length>1)return L(B[0])}else{var $=I.name;c[$]=I,k=$}return!O&&k&&(f=k),k||!O&&f},d=function(L,I){if(a(L))return L.clone();var m=typeof I=="object"?I:{};return m.date=L,m.args=arguments,new N(m)},y=T;y.l=v,y.i=a,y.w=function(L,I){return d(L,{locale:I.$L,utc:I.$u,x:I.$x,$offset:I.$offset})};var N=function(){function L(m){this.$L=v(m.locale,null,!0),this.parse(m),this.$x=this.$x||m.x||{},this[u]=!0}var I=L.prototype;return I.parse=function(m){this.$d=function(O){var k=O.date,j=O.utc;if(k===null)return new Date(NaN);if(y.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var B=k.match(R);if(B){var $=B[2]-1||0,V=(B[7]||"0").substring(0,3);return j?new Date(Date.UTC(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)):new Date(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)}}return new Date(k)}(m),this.init()},I.init=function(){var m=this.$d;this.$y=m.getFullYear(),this.$M=m.getMonth(),this.$D=m.getDate(),this.$W=m.getDay(),this.$H=m.getHours(),this.$m=m.getMinutes(),this.$s=m.getSeconds(),this.$ms=m.getMilliseconds()},I.$utils=function(){return y},I.isValid=function(){return this.$d.toString()!==E},I.isSame=function(m,O){var k=d(m);return this.startOf(O)<=k&&k<=this.endOf(O)},I.isAfter=function(m,O){return d(m)<this.startOf(O)},I.isBefore=function(m,O){return this.endOf(O)<d(m)},I.$g=function(m,O,k){return y.u(m)?this[O]:this.set(k,m)},I.unix=function(){return Math.floor(this.valueOf()/1e3)},I.valueOf=function(){return this.$d.getTime()},I.startOf=function(m,O){var k=this,j=!!y.u(O)||O,B=y.p(m),$=function(J,Q){var Y=y.w(k.$u?Date.UTC(k.$y,Q,J):new Date(k.$y,Q,J),k);return j?Y:Y.endOf(p)},V=function(J,Q){return y.w(k.toDate()[J].apply(k.toDate("s"),(j?[0,0,0,0]:[23,59,59,999]).slice(Q)),k)},H=this.$W,M=this.$M,_=this.$D,U="set"+(this.$u?"UTC":"");switch(B){case P:return j?$(1,0):$(31,11);case S:return j?$(1,M):$(0,M+1);case w:var F=this.$locale().weekStart||0,z=(H<F?H+7:H)-F;return $(j?_-z:_+(6-z),M);case p:case l:return V(U+"Hours",0);case h:return V(U+"Minutes",1);case g:return V(U+"Seconds",2);case o:return V(U+"Milliseconds",3);default:return this.clone()}},I.endOf=function(m){return this.startOf(m,!1)},I.$set=function(m,O){var k,j=y.p(m),B="set"+(this.$u?"UTC":""),$=(k={},k[p]=B+"Date",k[l]=B+"Date",k[S]=B+"Month",k[P]=B+"FullYear",k[h]=B+"Hours",k[g]=B+"Minutes",k[o]=B+"Seconds",k[s]=B+"Milliseconds",k)[j],V=j===p?this.$D+(O-this.$W):O;if(j===S||j===P){var H=this.clone().set(l,1);H.$d[$](V),H.init(),this.$d=H.set(l,Math.min(this.$D,H.daysInMonth())).$d}else $&&this.$d[$](V);return this.init(),this},I.set=function(m,O){return this.clone().$set(m,O)},I.get=function(m){return this[y.p(m)]()},I.add=function(m,O){var k,j=this;m=Number(m);var B=y.p(O),$=function(M){var _=d(j);return y.w(_.date(_.date()+Math.round(M*m)),j)};if(B===S)return this.set(S,this.$M+m);if(B===P)return this.set(P,this.$y+m);if(B===p)return $(1);if(B===w)return $(7);var V=(k={},k[g]=t,k[h]=i,k[o]=n,k)[B]||1,H=this.$d.getTime()+m*V;return y.w(H,this)},I.subtract=function(m,O){return this.add(-1*m,O)},I.format=function(m){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||E;var j=m||"YYYY-MM-DDTHH:mm:ssZ",B=y.z(this),$=this.$H,V=this.$m,H=this.$M,M=k.weekdays,_=k.months,U=k.meridiem,F=function(Q,Y,ee,re){return Q&&(Q[Y]||Q(O,j))||ee[Y].slice(0,re)},z=function(Q){return y.s($%12||12,Q,"0")},J=U||function(Q,Y,ee){var re=Q<12?"AM":"PM";return ee?re.toLowerCase():re};return j.replace(x,function(Q,Y){return Y||function(ee){switch(ee){case"YY":return String(O.$y).slice(-2);case"YYYY":return y.s(O.$y,4,"0");case"M":return H+1;case"MM":return y.s(H+1,2,"0");case"MMM":return F(k.monthsShort,H,_,3);case"MMMM":return F(_,H);case"D":return O.$D;case"DD":return y.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return F(k.weekdaysMin,O.$W,M,2);case"ddd":return F(k.weekdaysShort,O.$W,M,3);case"dddd":return M[O.$W];case"H":return String($);case"HH":return y.s($,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return J($,V,!0);case"A":return J($,V,!1);case"m":return String(V);case"mm":return y.s(V,2,"0");case"s":return String(O.$s);case"ss":return y.s(O.$s,2,"0");case"SSS":return y.s(O.$ms,3,"0");case"Z":return B}return null}(Q)||B.replace(":","")})},I.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},I.diff=function(m,O,k){var j,B=this,$=y.p(O),V=d(m),H=(V.utcOffset()-this.utcOffset())*t,M=this-V,_=function(){return y.m(B,V)};switch($){case P:j=_()/12;break;case S:j=_();break;case A:j=_()/3;break;case w:j=(M-H)/6048e5;break;case p:j=(M-H)/864e5;break;case h:j=M/i;break;case g:j=M/t;break;case o:j=M/n;break;default:j=M}return k?j:y.a(j)},I.daysInMonth=function(){return this.endOf(S).$D},I.$locale=function(){return c[this.$L]},I.locale=function(m,O){if(!m)return this.$L;var k=this.clone(),j=v(m,O,!0);return j&&(k.$L=j),k},I.clone=function(){return y.w(this.$d,this)},I.toDate=function(){return new Date(this.valueOf())},I.toJSON=function(){return this.isValid()?this.toISOString():null},I.toISOString=function(){return this.$d.toISOString()},I.toString=function(){return this.$d.toUTCString()},L}(),D=N.prototype;return d.prototype=D,[["$ms",s],["$s",o],["$m",g],["$H",h],["$W",p],["$M",S],["$y",P],["$D",l]].forEach(function(L){D[L[1]]=function(I){return this.$g(I,L[0],L[1])}}),d.extend=function(L,I){return L.$i||(L(I,N,d),L.$i=!0),d},d.locale=v,d.isDayjs=a,d.unix=function(L){return d(1e3*L)},d.en=c[f],d.Ls=c,d.p={},d})}(Gt)),Gt.exports}var tl=Dr();const ln=sn(tl);var nl={exports:{}};(function(r,e){(function(n,t){r.exports=t(Dr())})(on,function(n){function t(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var i=t(n),s={name:"id",weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),weekStart:1,formats:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},ordinal:function(o){return o+"."}};return i.default.locale(s,null,!0),s})})(nl);var Nr={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(on,function(){return function(n,t,i){n=n||{};var s=t.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function g(p,w,S,A){return s.fromToBase(p,w,S,A)}i.en.relativeTime=o,s.fromToBase=function(p,w,S,A,P){for(var l,E,R,x=S.$locale().relativeTime||o,C=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],b=C.length,T=0;T<b;T+=1){var f=C[T];f.d&&(l=A?i(p).diff(S,f.d,!0):S.diff(p,f.d,!0));var c=(n.rounding||Math.round)(Math.abs(l));if(R=l>0,c<=f.r||!f.r){c<=1&&T>0&&(f=C[T-1]);var u=x[f.l];P&&(c=P(""+c)),E=typeof u=="string"?u.replace("%d",c):u(c,w,f.l,R);break}}if(w)return E;var a=R?x.future:x.past;return typeof a=="function"?a(E):a.replace("%s",E)},s.to=function(p,w){return g(p,w,this,!0)},s.from=function(p,w){return g(p,w,this)};var h=function(p){return p.$u?i.utc():i()};s.toNow=function(p){return this.to(h(this),p)},s.fromNow=function(p){return this.from(h(this),p)}}})})(Nr);var rl=Nr.exports;const il=sn(rl);ln.extend(il);ln.locale("id");window.dayjs=ln;
