var ii=Object.defineProperty;var oi=(r,e,n)=>e in r?ii(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var Fe=(r,e,n)=>oi(r,typeof e!="symbol"?e+"":e,n);function si(r,e){for(var n=0;n<e.length;n++){const t=e[n];if(typeof t!="string"&&!Array.isArray(t)){for(const i in t)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(t,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>t[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}function cr(r,e){return function(){return r.apply(e,arguments)}}const{toString:ai}=Object.prototype,{getPrototypeOf:hn}=Object,{iterator:Tt,toStringTag:fr}=Symbol,It=(r=>e=>{const n=ai.call(e);return r[n]||(r[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ie=r=>(r=r.toLowerCase(),e=>It(e)===r),xt=r=>e=>typeof e===r,{isArray:qe}=Array,Ze=xt("undefined");function ui(r){return r!==null&&!Ze(r)&&r.constructor!==null&&!Ze(r.constructor)&&be(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const dr=Ie("ArrayBuffer");function li(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&dr(r.buffer),e}const ci=xt("string"),be=xt("function"),hr=xt("number"),Pt=r=>r!==null&&typeof r=="object",fi=r=>r===!0||r===!1,gt=r=>{if(It(r)!=="object")return!1;const e=hn(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(fr in r)&&!(Tt in r)},di=Ie("Date"),hi=Ie("File"),pi=Ie("Blob"),gi=Ie("FileList"),vi=r=>Pt(r)&&be(r.pipe),mi=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||be(r.append)&&((e=It(r))==="formdata"||e==="object"&&be(r.toString)&&r.toString()==="[object FormData]"))},yi=Ie("URLSearchParams"),[bi,Oi,Ci,Si]=["ReadableStream","Request","Response","Headers"].map(Ie),Ai=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nt(r,e,{allOwnKeys:n=!1}={}){if(r===null||typeof r>"u")return;let t,i;if(typeof r!="object"&&(r=[r]),qe(r))for(t=0,i=r.length;t<i;t++)e.call(null,r[t],t,r);else{const s=n?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length;let f;for(t=0;t<o;t++)f=s[t],e.call(null,r[f],f,r)}}function pr(r,e){e=e.toLowerCase();const n=Object.keys(r);let t=n.length,i;for(;t-- >0;)if(i=n[t],e===i.toLowerCase())return i;return null}const He=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,gr=r=>!Ze(r)&&r!==He;function tn(){const{caseless:r}=gr(this)&&this||{},e={},n=(t,i)=>{const s=r&&pr(e,i)||i;gt(e[s])&&gt(t)?e[s]=tn(e[s],t):gt(t)?e[s]=tn({},t):qe(t)?e[s]=t.slice():e[s]=t};for(let t=0,i=arguments.length;t<i;t++)arguments[t]&&nt(arguments[t],n);return e}const Ei=(r,e,n,{allOwnKeys:t}={})=>(nt(e,(i,s)=>{n&&be(i)?r[s]=cr(i,n):r[s]=i},{allOwnKeys:t}),r),wi=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Ri=(r,e,n,t)=>{r.prototype=Object.create(e.prototype,t),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),n&&Object.assign(r.prototype,n)},Ti=(r,e,n,t)=>{let i,s,o;const f={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!t||t(o,r,e))&&!f[o]&&(e[o]=r[o],f[o]=!0);r=n!==!1&&hn(r)}while(r&&(!n||n(r,e))&&r!==Object.prototype);return e},Ii=(r,e,n)=>{r=String(r),(n===void 0||n>r.length)&&(n=r.length),n-=e.length;const t=r.indexOf(e,n);return t!==-1&&t===n},xi=r=>{if(!r)return null;if(qe(r))return r;let e=r.length;if(!hr(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=r[e];return n},Pi=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&hn(Uint8Array)),Mi=(r,e)=>{const t=(r&&r[Tt]).call(r);let i;for(;(i=t.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},_i=(r,e)=>{let n;const t=[];for(;(n=r.exec(e))!==null;)t.push(n);return t},Li=Ie("HTMLFormElement"),Di=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,t,i){return t.toUpperCase()+i}),An=(({hasOwnProperty:r})=>(e,n)=>r.call(e,n))(Object.prototype),ki=Ie("RegExp"),vr=(r,e)=>{const n=Object.getOwnPropertyDescriptors(r),t={};nt(n,(i,s)=>{let o;(o=e(i,s,r))!==!1&&(t[s]=o||i)}),Object.defineProperties(r,t)},Ni=r=>{vr(r,(e,n)=>{if(be(r)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const t=r[n];if(be(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Ui=(r,e)=>{const n={},t=i=>{i.forEach(s=>{n[s]=!0})};return qe(r)?t(r):t(String(r).split(e)),n},Fi=()=>{},ji=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function Bi(r){return!!(r&&be(r.append)&&r[fr]==="FormData"&&r[Tt])}const Hi=r=>{const e=new Array(10),n=(t,i)=>{if(Pt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[i]=t;const s=qe(t)?[]:{};return nt(t,(o,f)=>{const p=n(o,i+1);!Ze(p)&&(s[f]=p)}),e[i]=void 0,s}}return t};return n(r,0)},Gi=Ie("AsyncFunction"),$i=r=>r&&(Pt(r)||be(r))&&be(r.then)&&be(r.catch),mr=((r,e)=>r?setImmediate:e?((n,t)=>(He.addEventListener("message",({source:i,data:s})=>{i===He&&s===n&&t.length&&t.shift()()},!1),i=>{t.push(i),He.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",be(He.postMessage)),Vi=typeof queueMicrotask<"u"?queueMicrotask.bind(He):typeof process<"u"&&process.nextTick||mr,Wi=r=>r!=null&&be(r[Tt]),z={isArray:qe,isArrayBuffer:dr,isBuffer:ui,isFormData:mi,isArrayBufferView:li,isString:ci,isNumber:hr,isBoolean:fi,isObject:Pt,isPlainObject:gt,isReadableStream:bi,isRequest:Oi,isResponse:Ci,isHeaders:Si,isUndefined:Ze,isDate:di,isFile:hi,isBlob:pi,isRegExp:ki,isFunction:be,isStream:vi,isURLSearchParams:yi,isTypedArray:Pi,isFileList:gi,forEach:nt,merge:tn,extend:Ei,trim:Ai,stripBOM:wi,inherits:Ri,toFlatObject:Ti,kindOf:It,kindOfTest:Ie,endsWith:Ii,toArray:xi,forEachEntry:Mi,matchAll:_i,isHTMLForm:Li,hasOwnProperty:An,hasOwnProp:An,reduceDescriptors:vr,freezeMethods:Ni,toObjectSet:Ui,toCamelCase:Di,noop:Fi,toFiniteNumber:ji,findKey:pr,global:He,isContextDefined:gr,isSpecCompliantForm:Bi,toJSONObject:Hi,isAsyncFn:Gi,isThenable:$i,setImmediate:mr,asap:Vi,isIterable:Wi};function te(r,e,n,t,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),t&&(this.request=t),i&&(this.response=i,this.status=i.status?i.status:null)}z.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:z.toJSONObject(this.config),code:this.code,status:this.status}}});const yr=te.prototype,br={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{br[r]={value:r}});Object.defineProperties(te,br);Object.defineProperty(yr,"isAxiosError",{value:!0});te.from=(r,e,n,t,i,s)=>{const o=Object.create(yr);return z.toFlatObject(r,o,function(p){return p!==Error.prototype},f=>f!=="isAxiosError"),te.call(o,r.message,e,n,t,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};const zi=null;function nn(r){return z.isPlainObject(r)||z.isArray(r)}function Or(r){return z.endsWith(r,"[]")?r.slice(0,-2):r}function En(r,e,n){return r?r.concat(e).map(function(i,s){return i=Or(i),!n&&s?"["+i+"]":i}).join(n?".":""):e}function Ki(r){return z.isArray(r)&&!r.some(nn)}const qi=z.toFlatObject(z,{},null,function(e){return/^is[A-Z]/.test(e)});function Mt(r,e,n){if(!z.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,n=z.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,R){return!z.isUndefined(R[w])});const t=n.metaTokens,i=n.visitor||C,s=n.dots,o=n.indexes,p=(n.Blob||typeof Blob<"u"&&Blob)&&z.isSpecCompliantForm(e);if(!z.isFunction(i))throw new TypeError("visitor must be a function");function g(u){if(u===null)return"";if(z.isDate(u))return u.toISOString();if(z.isBoolean(u))return u.toString();if(!p&&z.isBlob(u))throw new te("Blob is not supported. Use a Buffer instead.");return z.isArrayBuffer(u)||z.isTypedArray(u)?p&&typeof Blob=="function"?new Blob([u]):Buffer.from(u):u}function C(u,w,R){let P=u;if(u&&!R&&typeof u=="object"){if(z.endsWith(w,"{}"))w=t?w:w.slice(0,-2),u=JSON.stringify(u);else if(z.isArray(u)&&Ki(u)||(z.isFileList(u)||z.endsWith(w,"[]"))&&(P=z.toArray(u)))return w=Or(w),P.forEach(function(m,T){!(z.isUndefined(m)||m===null)&&e.append(o===!0?En([w],T,s):o===null?w:w+"[]",g(m))}),!1}return nn(u)?!0:(e.append(En(R,w,s),g(u)),!1)}const E=[],A=Object.assign(qi,{defaultVisitor:C,convertValue:g,isVisitable:nn});function I(u,w){if(!z.isUndefined(u)){if(E.indexOf(u)!==-1)throw Error("Circular reference detected in "+w.join("."));E.push(u),z.forEach(u,function(P,y){(!(z.isUndefined(P)||P===null)&&i.call(e,P,z.isString(y)?y.trim():y,w,A))===!0&&I(P,w?w.concat(y):[y])}),E.pop()}}if(!z.isObject(r))throw new TypeError("data must be an object");return I(r),e}function wn(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function pn(r,e){this._pairs=[],r&&Mt(r,this,e)}const Cr=pn.prototype;Cr.append=function(e,n){this._pairs.push([e,n])};Cr.toString=function(e){const n=e?function(t){return e.call(this,t,wn)}:wn;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function Ji(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Sr(r,e,n){if(!e)return r;const t=n&&n.encode||Ji;z.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let s;if(i?s=i(e,n):s=z.isURLSearchParams(e)?e.toString():new pn(e,n).toString(t),s){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class Rn{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){z.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Ar={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qi=typeof URLSearchParams<"u"?URLSearchParams:pn,Yi=typeof FormData<"u"?FormData:null,Xi=typeof Blob<"u"?Blob:null,Zi={isBrowser:!0,classes:{URLSearchParams:Qi,FormData:Yi,Blob:Xi},protocols:["http","https","file","blob","url","data"]},gn=typeof window<"u"&&typeof document<"u",rn=typeof navigator=="object"&&navigator||void 0,eo=gn&&(!rn||["ReactNative","NativeScript","NS"].indexOf(rn.product)<0),to=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",no=gn&&window.location.href||"http://localhost",ro=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:gn,hasStandardBrowserEnv:eo,hasStandardBrowserWebWorkerEnv:to,navigator:rn,origin:no},Symbol.toStringTag,{value:"Module"})),ge={...ro,...Zi};function oo(r,e){return Mt(r,new ge.classes.URLSearchParams,Object.assign({visitor:function(n,t,i,s){return ge.isNode&&z.isBuffer(n)?(this.append(t,n.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function so(r){return z.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ao(r){const e={},n=Object.keys(r);let t;const i=n.length;let s;for(t=0;t<i;t++)s=n[t],e[s]=r[s];return e}function Er(r){function e(n,t,i,s){let o=n[s++];if(o==="__proto__")return!0;const f=Number.isFinite(+o),p=s>=n.length;return o=!o&&z.isArray(i)?i.length:o,p?(z.hasOwnProp(i,o)?i[o]=[i[o],t]:i[o]=t,!f):((!i[o]||!z.isObject(i[o]))&&(i[o]=[]),e(n,t,i[o],s)&&z.isArray(i[o])&&(i[o]=ao(i[o])),!f)}if(z.isFormData(r)&&z.isFunction(r.entries)){const n={};return z.forEachEntry(r,(t,i)=>{e(so(t),i,n,0)}),n}return null}function uo(r,e,n){if(z.isString(r))try{return(e||JSON.parse)(r),z.trim(r)}catch(t){if(t.name!=="SyntaxError")throw t}return(n||JSON.stringify)(r)}const rt={transitional:Ar,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",i=t.indexOf("application/json")>-1,s=z.isObject(e);if(s&&z.isHTMLForm(e)&&(e=new FormData(e)),z.isFormData(e))return i?JSON.stringify(Er(e)):e;if(z.isArrayBuffer(e)||z.isBuffer(e)||z.isStream(e)||z.isFile(e)||z.isBlob(e)||z.isReadableStream(e))return e;if(z.isArrayBufferView(e))return e.buffer;if(z.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let f;if(s){if(t.indexOf("application/x-www-form-urlencoded")>-1)return oo(e,this.formSerializer).toString();if((f=z.isFileList(e))||t.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return Mt(f?{"files[]":e}:e,p&&new p,this.formSerializer)}}return s||i?(n.setContentType("application/json",!1),uo(e)):e}],transformResponse:[function(e){const n=this.transitional||rt.transitional,t=n&&n.forcedJSONParsing,i=this.responseType==="json";if(z.isResponse(e)||z.isReadableStream(e))return e;if(e&&z.isString(e)&&(t&&!this.responseType||i)){const o=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(f){if(o)throw f.name==="SyntaxError"?te.from(f,te.ERR_BAD_RESPONSE,this,null,this.response):f}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ge.classes.FormData,Blob:ge.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};z.forEach(["delete","get","head","post","put","patch"],r=>{rt.headers[r]={}});const lo=z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),co=r=>{const e={};let n,t,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),n=o.substring(0,i).trim().toLowerCase(),t=o.substring(i+1).trim(),!(!n||e[n]&&lo[n])&&(n==="set-cookie"?e[n]?e[n].push(t):e[n]=[t]:e[n]=e[n]?e[n]+", "+t:t)}),e},Tn=Symbol("internals");function Ye(r){return r&&String(r).trim().toLowerCase()}function vt(r){return r===!1||r==null?r:z.isArray(r)?r.map(vt):String(r)}function fo(r){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=n.exec(r);)e[t[1]]=t[2];return e}const ho=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Ht(r,e,n,t,i){if(z.isFunction(t))return t.call(this,e,n);if(i&&(e=n),!!z.isString(e)){if(z.isString(t))return e.indexOf(t)!==-1;if(z.isRegExp(t))return t.test(e)}}function po(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}function go(r,e){const n=z.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(r,t+n,{value:function(i,s,o){return this[t].call(this,e,i,s,o)},configurable:!0})})}let Oe=class{constructor(e){e&&this.set(e)}set(e,n,t){const i=this;function s(f,p,g){const C=Ye(p);if(!C)throw new Error("header name must be a non-empty string");const E=z.findKey(i,C);(!E||i[E]===void 0||g===!0||g===void 0&&i[E]!==!1)&&(i[E||p]=vt(f))}const o=(f,p)=>z.forEach(f,(g,C)=>s(g,C,p));if(z.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(z.isString(e)&&(e=e.trim())&&!ho(e))o(co(e),n);else if(z.isObject(e)&&z.isIterable(e)){let f={},p,g;for(const C of e){if(!z.isArray(C))throw TypeError("Object iterator must return a key-value pair");f[g=C[0]]=(p=f[g])?z.isArray(p)?[...p,C[1]]:[p,C[1]]:C[1]}o(f,n)}else e!=null&&s(n,e,t);return this}get(e,n){if(e=Ye(e),e){const t=z.findKey(this,e);if(t){const i=this[t];if(!n)return i;if(n===!0)return fo(i);if(z.isFunction(n))return n.call(this,i,t);if(z.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Ye(e),e){const t=z.findKey(this,e);return!!(t&&this[t]!==void 0&&(!n||Ht(this,this[t],t,n)))}return!1}delete(e,n){const t=this;let i=!1;function s(o){if(o=Ye(o),o){const f=z.findKey(t,o);f&&(!n||Ht(t,t[f],f,n))&&(delete t[f],i=!0)}}return z.isArray(e)?e.forEach(s):s(e),i}clear(e){const n=Object.keys(this);let t=n.length,i=!1;for(;t--;){const s=n[t];(!e||Ht(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const n=this,t={};return z.forEach(this,(i,s)=>{const o=z.findKey(t,s);if(o){n[o]=vt(i),delete n[s];return}const f=e?po(s):String(s).trim();f!==s&&delete n[s],n[f]=vt(i),t[f]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return z.forEach(this,(t,i)=>{t!=null&&t!==!1&&(n[i]=e&&z.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(i=>t.set(i)),t}static accessor(e){const t=(this[Tn]=this[Tn]={accessors:{}}).accessors,i=this.prototype;function s(o){const f=Ye(o);t[f]||(go(i,o),t[f]=!0)}return z.isArray(e)?e.forEach(s):s(e),this}};Oe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);z.reduceDescriptors(Oe.prototype,({value:r},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(t){this[n]=t}}});z.freezeMethods(Oe);function Gt(r,e){const n=this||rt,t=e||n,i=Oe.from(t.headers);let s=t.data;return z.forEach(r,function(f){s=f.call(n,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function wr(r){return!!(r&&r.__CANCEL__)}function Je(r,e,n){te.call(this,r??"canceled",te.ERR_CANCELED,e,n),this.name="CanceledError"}z.inherits(Je,te,{__CANCEL__:!0});function Rr(r,e,n){const t=n.config.validateStatus;!n.status||!t||t(n.status)?r(n):e(new te("Request failed with status code "+n.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function vo(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function mo(r,e){r=r||10;const n=new Array(r),t=new Array(r);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(p){const g=Date.now(),C=t[s];o||(o=g),n[i]=p,t[i]=g;let E=s,A=0;for(;E!==i;)A+=n[E++],E=E%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),g-o<e)return;const I=C&&g-C;return I?Math.round(A*1e3/I):void 0}}function yo(r,e){let n=0,t=1e3/e,i,s;const o=(g,C=Date.now())=>{n=C,i=null,s&&(clearTimeout(s),s=null),r.apply(null,g)};return[(...g)=>{const C=Date.now(),E=C-n;E>=t?o(g,C):(i=g,s||(s=setTimeout(()=>{s=null,o(i)},t-E)))},()=>i&&o(i)]}const bt=(r,e,n=3)=>{let t=0;const i=mo(50,250);return yo(s=>{const o=s.loaded,f=s.lengthComputable?s.total:void 0,p=o-t,g=i(p),C=o<=f;t=o;const E={loaded:o,total:f,progress:f?o/f:void 0,bytes:p,rate:g||void 0,estimated:g&&f&&C?(f-o)/g:void 0,event:s,lengthComputable:f!=null,[e?"download":"upload"]:!0};r(E)},n)},In=(r,e)=>{const n=r!=null;return[t=>e[0]({lengthComputable:n,total:r,loaded:t}),e[1]]},xn=r=>(...e)=>z.asap(()=>r(...e)),bo=ge.hasStandardBrowserEnv?((r,e)=>n=>(n=new URL(n,ge.origin),r.protocol===n.protocol&&r.host===n.host&&(e||r.port===n.port)))(new URL(ge.origin),ge.navigator&&/(msie|trident)/i.test(ge.navigator.userAgent)):()=>!0,Oo=ge.hasStandardBrowserEnv?{write(r,e,n,t,i,s){const o=[r+"="+encodeURIComponent(e)];z.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),z.isString(t)&&o.push("path="+t),z.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Co(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function So(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function Tr(r,e,n){let t=!Co(e);return r&&(t||n==!1)?So(r,e):e}const Pn=r=>r instanceof Oe?{...r}:r;function $e(r,e){e=e||{};const n={};function t(g,C,E,A){return z.isPlainObject(g)&&z.isPlainObject(C)?z.merge.call({caseless:A},g,C):z.isPlainObject(C)?z.merge({},C):z.isArray(C)?C.slice():C}function i(g,C,E,A){if(z.isUndefined(C)){if(!z.isUndefined(g))return t(void 0,g,E,A)}else return t(g,C,E,A)}function s(g,C){if(!z.isUndefined(C))return t(void 0,C)}function o(g,C){if(z.isUndefined(C)){if(!z.isUndefined(g))return t(void 0,g)}else return t(void 0,C)}function f(g,C,E){if(E in e)return t(g,C);if(E in r)return t(void 0,g)}const p={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:f,headers:(g,C,E)=>i(Pn(g),Pn(C),E,!0)};return z.forEach(Object.keys(Object.assign({},r,e)),function(C){const E=p[C]||i,A=E(r[C],e[C],C);z.isUndefined(A)&&E!==f||(n[C]=A)}),n}const Ir=r=>{const e=$e({},r);let{data:n,withXSRFToken:t,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:f}=e;e.headers=o=Oe.from(o),e.url=Sr(Tr(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),f&&o.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):"")));let p;if(z.isFormData(n)){if(ge.hasStandardBrowserEnv||ge.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((p=o.getContentType())!==!1){const[g,...C]=p?p.split(";").map(E=>E.trim()).filter(Boolean):[];o.setContentType([g||"multipart/form-data",...C].join("; "))}}if(ge.hasStandardBrowserEnv&&(t&&z.isFunction(t)&&(t=t(e)),t||t!==!1&&bo(e.url))){const g=i&&s&&Oo.read(s);g&&o.set(i,g)}return e},Ao=typeof XMLHttpRequest<"u",Eo=Ao&&function(r){return new Promise(function(n,t){const i=Ir(r);let s=i.data;const o=Oe.from(i.headers).normalize();let{responseType:f,onUploadProgress:p,onDownloadProgress:g}=i,C,E,A,I,u;function w(){I&&I(),u&&u(),i.cancelToken&&i.cancelToken.unsubscribe(C),i.signal&&i.signal.removeEventListener("abort",C)}let R=new XMLHttpRequest;R.open(i.method.toUpperCase(),i.url,!0),R.timeout=i.timeout;function P(){if(!R)return;const m=Oe.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders()),d={data:!f||f==="text"||f==="json"?R.responseText:R.response,status:R.status,statusText:R.statusText,headers:m,config:r,request:R};Rr(function(l){n(l),w()},function(l){t(l),w()},d),R=null}"onloadend"in R?R.onloadend=P:R.onreadystatechange=function(){!R||R.readyState!==4||R.status===0&&!(R.responseURL&&R.responseURL.indexOf("file:")===0)||setTimeout(P)},R.onabort=function(){R&&(t(new te("Request aborted",te.ECONNABORTED,r,R)),R=null)},R.onerror=function(){t(new te("Network Error",te.ERR_NETWORK,r,R)),R=null},R.ontimeout=function(){let T=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const d=i.transitional||Ar;i.timeoutErrorMessage&&(T=i.timeoutErrorMessage),t(new te(T,d.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,r,R)),R=null},s===void 0&&o.setContentType(null),"setRequestHeader"in R&&z.forEach(o.toJSON(),function(T,d){R.setRequestHeader(d,T)}),z.isUndefined(i.withCredentials)||(R.withCredentials=!!i.withCredentials),f&&f!=="json"&&(R.responseType=i.responseType),g&&([A,u]=bt(g,!0),R.addEventListener("progress",A)),p&&R.upload&&([E,I]=bt(p),R.upload.addEventListener("progress",E),R.upload.addEventListener("loadend",I)),(i.cancelToken||i.signal)&&(C=m=>{R&&(t(!m||m.type?new Je(null,r,R):m),R.abort(),R=null)},i.cancelToken&&i.cancelToken.subscribe(C),i.signal&&(i.signal.aborted?C():i.signal.addEventListener("abort",C)));const y=vo(i.url);if(y&&ge.protocols.indexOf(y)===-1){t(new te("Unsupported protocol "+y+":",te.ERR_BAD_REQUEST,r));return}R.send(s||null)})},wo=(r,e)=>{const{length:n}=r=r?r.filter(Boolean):[];if(e||n){let t=new AbortController,i;const s=function(g){if(!i){i=!0,f();const C=g instanceof Error?g:this.reason;t.abort(C instanceof te?C:new Je(C instanceof Error?C.message:C))}};let o=e&&setTimeout(()=>{o=null,s(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const f=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(g=>{g.unsubscribe?g.unsubscribe(s):g.removeEventListener("abort",s)}),r=null)};r.forEach(g=>g.addEventListener("abort",s));const{signal:p}=t;return p.unsubscribe=()=>z.asap(f),p}},Ro=function*(r,e){let n=r.byteLength;if(n<e){yield r;return}let t=0,i;for(;t<n;)i=t+e,yield r.slice(t,i),t=i},To=async function*(r,e){for await(const n of Io(r))yield*Ro(n,e)},Io=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:n,value:t}=await e.read();if(n)break;yield t}}finally{await e.cancel()}},Mn=(r,e,n,t)=>{const i=To(r,e);let s=0,o,f=p=>{o||(o=!0,t&&t(p))};return new ReadableStream({async pull(p){try{const{done:g,value:C}=await i.next();if(g){f(),p.close();return}let E=C.byteLength;if(n){let A=s+=E;n(A)}p.enqueue(new Uint8Array(C))}catch(g){throw f(g),g}},cancel(p){return f(p),i.return()}},{highWaterMark:2})},_t=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",xr=_t&&typeof ReadableStream=="function",xo=_t&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),Pr=(r,...e)=>{try{return!!r(...e)}catch{return!1}},Po=xr&&Pr(()=>{let r=!1;const e=new Request(ge.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),_n=64*1024,on=xr&&Pr(()=>z.isReadableStream(new Response("").body)),Ot={stream:on&&(r=>r.body)};_t&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ot[e]&&(Ot[e]=z.isFunction(r[e])?n=>n[e]():(n,t)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,t)})})})(new Response);const Mo=async r=>{if(r==null)return 0;if(z.isBlob(r))return r.size;if(z.isSpecCompliantForm(r))return(await new Request(ge.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(z.isArrayBufferView(r)||z.isArrayBuffer(r))return r.byteLength;if(z.isURLSearchParams(r)&&(r=r+""),z.isString(r))return(await xo(r)).byteLength},_o=async(r,e)=>{const n=z.toFiniteNumber(r.getContentLength());return n??Mo(e)},Lo=_t&&(async r=>{let{url:e,method:n,data:t,signal:i,cancelToken:s,timeout:o,onDownloadProgress:f,onUploadProgress:p,responseType:g,headers:C,withCredentials:E="same-origin",fetchOptions:A}=Ir(r);g=g?(g+"").toLowerCase():"text";let I=wo([i,s&&s.toAbortSignal()],o),u;const w=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let R;try{if(p&&Po&&n!=="get"&&n!=="head"&&(R=await _o(C,t))!==0){let d=new Request(e,{method:"POST",body:t,duplex:"half"}),c;if(z.isFormData(t)&&(c=d.headers.get("content-type"))&&C.setContentType(c),d.body){const[l,a]=In(R,bt(xn(p)));t=Mn(d.body,_n,l,a)}}z.isString(E)||(E=E?"include":"omit");const P="credentials"in Request.prototype;u=new Request(e,{...A,signal:I,method:n.toUpperCase(),headers:C.normalize().toJSON(),body:t,duplex:"half",credentials:P?E:void 0});let y=await fetch(u,A);const m=on&&(g==="stream"||g==="response");if(on&&(f||m&&w)){const d={};["status","statusText","headers"].forEach(v=>{d[v]=y[v]});const c=z.toFiniteNumber(y.headers.get("content-length")),[l,a]=f&&In(c,bt(xn(f),!0))||[];y=new Response(Mn(y.body,_n,l,()=>{a&&a(),w&&w()}),d)}g=g||"text";let T=await Ot[z.findKey(Ot,g)||"text"](y,r);return!m&&w&&w(),await new Promise((d,c)=>{Rr(d,c,{data:T,headers:Oe.from(y.headers),status:y.status,statusText:y.statusText,config:r,request:u})})}catch(P){throw w&&w(),P&&P.name==="TypeError"&&/Load failed|fetch/i.test(P.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,r,u),{cause:P.cause||P}):te.from(P,P&&P.code,r,u)}}),sn={http:zi,xhr:Eo,fetch:Lo};z.forEach(sn,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const Ln=r=>`- ${r}`,Do=r=>z.isFunction(r)||r===null||r===!1,Mr={getAdapter:r=>{r=z.isArray(r)?r:[r];const{length:e}=r;let n,t;const i={};for(let s=0;s<e;s++){n=r[s];let o;if(t=n,!Do(n)&&(t=sn[(o=String(n)).toLowerCase()],t===void 0))throw new te(`Unknown adapter '${o}'`);if(t)break;i[o||"#"+s]=t}if(!t){const s=Object.entries(i).map(([f,p])=>`adapter ${f} `+(p===!1?"is not supported by the environment":"is not available in the build"));let o=e?s.length>1?`since :
`+s.map(Ln).join(`
`):" "+Ln(s[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return t},adapters:sn};function $t(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Je(null,r)}function Dn(r){return $t(r),r.headers=Oe.from(r.headers),r.data=Gt.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),Mr.getAdapter(r.adapter||rt.adapter)(r).then(function(t){return $t(r),t.data=Gt.call(r,r.transformResponse,t),t.headers=Oe.from(t.headers),t},function(t){return wr(t)||($t(r),t&&t.response&&(t.response.data=Gt.call(r,r.transformResponse,t.response),t.response.headers=Oe.from(t.response.headers))),Promise.reject(t)})}const _r="1.10.0",Lt={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Lt[r]=function(t){return typeof t===r||"a"+(e<1?"n ":" ")+r}});const kn={};Lt.transitional=function(e,n,t){function i(s,o){return"[Axios v"+_r+"] Transitional option '"+s+"'"+o+(t?". "+t:"")}return(s,o,f)=>{if(e===!1)throw new te(i(o," has been removed"+(n?" in "+n:"")),te.ERR_DEPRECATED);return n&&!kn[o]&&(kn[o]=!0,console.warn(i(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(s,o,f):!0}};Lt.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function ko(r,e,n){if(typeof r!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const t=Object.keys(r);let i=t.length;for(;i-- >0;){const s=t[i],o=e[s];if(o){const f=r[s],p=f===void 0||o(f,s,r);if(p!==!0)throw new te("option "+s+" must be "+p,te.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new te("Unknown option "+s,te.ERR_BAD_OPTION)}}const mt={assertOptions:ko,validators:Lt},xe=mt.validators;let Ge=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Rn,response:new Rn}}async request(e,n){try{return await this._request(e,n)}catch(t){if(t instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{t.stack?s&&!String(t.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+s):t.stack=s}catch{}}throw t}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=$e(this.defaults,n);const{transitional:t,paramsSerializer:i,headers:s}=n;t!==void 0&&mt.assertOptions(t,{silentJSONParsing:xe.transitional(xe.boolean),forcedJSONParsing:xe.transitional(xe.boolean),clarifyTimeoutError:xe.transitional(xe.boolean)},!1),i!=null&&(z.isFunction(i)?n.paramsSerializer={serialize:i}:mt.assertOptions(i,{encode:xe.function,serialize:xe.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),mt.assertOptions(n,{baseUrl:xe.spelling("baseURL"),withXsrfToken:xe.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=s&&z.merge(s.common,s[n.method]);s&&z.forEach(["delete","get","head","post","put","patch","common"],u=>{delete s[u]}),n.headers=Oe.concat(o,s);const f=[];let p=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(n)===!1||(p=p&&w.synchronous,f.unshift(w.fulfilled,w.rejected))});const g=[];this.interceptors.response.forEach(function(w){g.push(w.fulfilled,w.rejected)});let C,E=0,A;if(!p){const u=[Dn.bind(this),void 0];for(u.unshift.apply(u,f),u.push.apply(u,g),A=u.length,C=Promise.resolve(n);E<A;)C=C.then(u[E++],u[E++]);return C}A=f.length;let I=n;for(E=0;E<A;){const u=f[E++],w=f[E++];try{I=u(I)}catch(R){w.call(this,R);break}}try{C=Dn.call(this,I)}catch(u){return Promise.reject(u)}for(E=0,A=g.length;E<A;)C=C.then(g[E++],g[E++]);return C}getUri(e){e=$e(this.defaults,e);const n=Tr(e.baseURL,e.url,e.allowAbsoluteUrls);return Sr(n,e.params,e.paramsSerializer)}};z.forEach(["delete","get","head","options"],function(e){Ge.prototype[e]=function(n,t){return this.request($e(t||{},{method:e,url:n,data:(t||{}).data}))}});z.forEach(["post","put","patch"],function(e){function n(t){return function(s,o,f){return this.request($e(f||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Ge.prototype[e]=n(),Ge.prototype[e+"Form"]=n(!0)});let No=class Lr{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const t=this;this.promise.then(i=>{if(!t._listeners)return;let s=t._listeners.length;for(;s-- >0;)t._listeners[s](i);t._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(f=>{t.subscribe(f),s=f}).then(i);return o.cancel=function(){t.unsubscribe(s)},o},e(function(s,o,f){t.reason||(t.reason=new Je(s,o,f),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=t=>{e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Lr(function(i){e=i}),cancel:e}}};function Uo(r){return function(n){return r.apply(null,n)}}function Fo(r){return z.isObject(r)&&r.isAxiosError===!0}const an={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(an).forEach(([r,e])=>{an[e]=r});function Dr(r){const e=new Ge(r),n=cr(Ge.prototype.request,e);return z.extend(n,Ge.prototype,e,{allOwnKeys:!0}),z.extend(n,e,null,{allOwnKeys:!0}),n.create=function(i){return Dr($e(r,i))},n}const le=Dr(rt);le.Axios=Ge;le.CanceledError=Je;le.CancelToken=No;le.isCancel=wr;le.VERSION=_r;le.toFormData=Mt;le.AxiosError=te;le.Cancel=le.CanceledError;le.all=function(e){return Promise.all(e)};le.spread=Uo;le.isAxiosError=Fo;le.mergeConfig=$e;le.AxiosHeaders=Oe;le.formToJSON=r=>Er(z.isHTMLForm(r)?new FormData(r):r);le.getAdapter=Mr.getAdapter;le.HttpStatusCode=an;le.default=le;const{Axios:xu,AxiosError:Pu,CanceledError:Mu,isCancel:_u,CancelToken:Lu,VERSION:Du,all:ku,Cancel:Nu,isAxiosError:Uu,spread:Fu,toFormData:ju,AxiosHeaders:Bu,HttpStatusCode:Hu,formToJSON:Gu,getAdapter:$u,mergeConfig:Vu}=le;function jo(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function he(r,e,n){return e=ze(e),Ho(r,kr()?Reflect.construct(e,n||[],ze(r).constructor):e.apply(r,n))}function se(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Bo(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,Wo(t.key),t)}}function ae(r,e,n){return e&&Bo(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function we(){return we=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)({}).hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r},we.apply(null,arguments)}function un(){return un=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,n){var t=Go(r,e);if(t){var i=Object.getOwnPropertyDescriptor(t,e);return i.get?i.get.call(arguments.length<3?r:n):i.value}},un.apply(null,arguments)}function ze(r){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ze(r)}function pe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&ln(r,e)}function kr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kr=function(){return!!r})()}function Ho(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jo(r)}function Le(){Le=function(){return e};var r,e={},n=Object.prototype,t=n.hasOwnProperty,i=Object.defineProperty||function(b,S,L){b[S]=L.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",f=s.asyncIterator||"@@asyncIterator",p=s.toStringTag||"@@toStringTag";function g(b,S,L){return Object.defineProperty(b,S,{value:L,enumerable:!0,configurable:!0,writable:!0}),b[S]}try{g({},"")}catch{g=function(S,L,U){return S[L]=U}}function C(b,S,L,U){var j=S&&S.prototype instanceof P?S:P,$=Object.create(j.prototype),V=new _(U||[]);return i($,"_invoke",{value:h(b,L,V)}),$}function E(b,S,L){try{return{type:"normal",arg:b.call(S,L)}}catch(U){return{type:"throw",arg:U}}}e.wrap=C;var A="suspendedStart",I="suspendedYield",u="executing",w="completed",R={};function P(){}function y(){}function m(){}var T={};g(T,o,function(){return this});var d=Object.getPrototypeOf,c=d&&d(d(x([])));c&&c!==n&&t.call(c,o)&&(T=c);var l=m.prototype=P.prototype=Object.create(T);function a(b){["next","throw","return"].forEach(function(S){g(b,S,function(L){return this._invoke(S,L)})})}function v(b,S){function L(j,$,V,H){var M=E(b[j],b,$);if(M.type!=="throw"){var N=M.arg,F=N.value;return F&&typeof F=="object"&&t.call(F,"__await")?S.resolve(F.__await).then(function(B){L("next",B,V,H)},function(B){L("throw",B,V,H)}):S.resolve(F).then(function(B){N.value=B,V(N)},function(B){return L("throw",B,V,H)})}H(M.arg)}var U;i(this,"_invoke",{value:function(j,$){function V(){return new S(function(H,M){L(j,$,H,M)})}return U=U?U.then(V,V):V()}})}function h(b,S,L){var U=A;return function(j,$){if(U===u)throw Error("Generator is already running");if(U===w){if(j==="throw")throw $;return{value:r,done:!0}}for(L.method=j,L.arg=$;;){var V=L.delegate;if(V){var H=O(V,L);if(H){if(H===R)continue;return H}}if(L.method==="next")L.sent=L._sent=L.arg;else if(L.method==="throw"){if(U===A)throw U=w,L.arg;L.dispatchException(L.arg)}else L.method==="return"&&L.abrupt("return",L.arg);U=u;var M=E(b,S,L);if(M.type==="normal"){if(U=L.done?w:I,M.arg===R)continue;return{value:M.arg,done:L.done}}M.type==="throw"&&(U=w,L.method="throw",L.arg=M.arg)}}}function O(b,S){var L=S.method,U=b.iterator[L];if(U===r)return S.delegate=null,L==="throw"&&b.iterator.return&&(S.method="return",S.arg=r,O(b,S),S.method==="throw")||L!=="return"&&(S.method="throw",S.arg=new TypeError("The iterator does not provide a '"+L+"' method")),R;var j=E(U,b.iterator,S.arg);if(j.type==="throw")return S.method="throw",S.arg=j.arg,S.delegate=null,R;var $=j.arg;return $?$.done?(S[b.resultName]=$.value,S.next=b.nextLoc,S.method!=="return"&&(S.method="next",S.arg=r),S.delegate=null,R):$:(S.method="throw",S.arg=new TypeError("iterator result is not an object"),S.delegate=null,R)}function k(b){var S={tryLoc:b[0]};1 in b&&(S.catchLoc=b[1]),2 in b&&(S.finallyLoc=b[2],S.afterLoc=b[3]),this.tryEntries.push(S)}function D(b){var S=b.completion||{};S.type="normal",delete S.arg,b.completion=S}function _(b){this.tryEntries=[{tryLoc:"root"}],b.forEach(k,this),this.reset(!0)}function x(b){if(b||b===""){var S=b[o];if(S)return S.call(b);if(typeof b.next=="function")return b;if(!isNaN(b.length)){var L=-1,U=function j(){for(;++L<b.length;)if(t.call(b,L))return j.value=b[L],j.done=!1,j;return j.value=r,j.done=!0,j};return U.next=U}}throw new TypeError(typeof b+" is not iterable")}return y.prototype=m,i(l,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:y,configurable:!0}),y.displayName=g(m,p,"GeneratorFunction"),e.isGeneratorFunction=function(b){var S=typeof b=="function"&&b.constructor;return!!S&&(S===y||(S.displayName||S.name)==="GeneratorFunction")},e.mark=function(b){return Object.setPrototypeOf?Object.setPrototypeOf(b,m):(b.__proto__=m,g(b,p,"GeneratorFunction")),b.prototype=Object.create(l),b},e.awrap=function(b){return{__await:b}},a(v.prototype),g(v.prototype,f,function(){return this}),e.AsyncIterator=v,e.async=function(b,S,L,U,j){j===void 0&&(j=Promise);var $=new v(C(b,S,L,U),j);return e.isGeneratorFunction(S)?$:$.next().then(function(V){return V.done?V.value:$.next()})},a(l),g(l,p,"Generator"),g(l,o,function(){return this}),g(l,"toString",function(){return"[object Generator]"}),e.keys=function(b){var S=Object(b),L=[];for(var U in S)L.push(U);return L.reverse(),function j(){for(;L.length;){var $=L.pop();if($ in S)return j.value=$,j.done=!1,j}return j.done=!0,j}},e.values=x,_.prototype={constructor:_,reset:function(b){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(D),!b)for(var S in this)S.charAt(0)==="t"&&t.call(this,S)&&!isNaN(+S.slice(1))&&(this[S]=r)},stop:function(){this.done=!0;var b=this.tryEntries[0].completion;if(b.type==="throw")throw b.arg;return this.rval},dispatchException:function(b){if(this.done)throw b;var S=this;function L(M,N){return $.type="throw",$.arg=b,S.next=M,N&&(S.method="next",S.arg=r),!!N}for(var U=this.tryEntries.length-1;U>=0;--U){var j=this.tryEntries[U],$=j.completion;if(j.tryLoc==="root")return L("end");if(j.tryLoc<=this.prev){var V=t.call(j,"catchLoc"),H=t.call(j,"finallyLoc");if(V&&H){if(this.prev<j.catchLoc)return L(j.catchLoc,!0);if(this.prev<j.finallyLoc)return L(j.finallyLoc)}else if(V){if(this.prev<j.catchLoc)return L(j.catchLoc,!0)}else{if(!H)throw Error("try statement without catch or finally");if(this.prev<j.finallyLoc)return L(j.finallyLoc)}}}},abrupt:function(b,S){for(var L=this.tryEntries.length-1;L>=0;--L){var U=this.tryEntries[L];if(U.tryLoc<=this.prev&&t.call(U,"finallyLoc")&&this.prev<U.finallyLoc){var j=U;break}}j&&(b==="break"||b==="continue")&&j.tryLoc<=S&&S<=j.finallyLoc&&(j=null);var $=j?j.completion:{};return $.type=b,$.arg=S,j?(this.method="next",this.next=j.finallyLoc,R):this.complete($)},complete:function(b,S){if(b.type==="throw")throw b.arg;return b.type==="break"||b.type==="continue"?this.next=b.arg:b.type==="return"?(this.rval=this.arg=b.arg,this.method="return",this.next="end"):b.type==="normal"&&S&&(this.next=S),R},finish:function(b){for(var S=this.tryEntries.length-1;S>=0;--S){var L=this.tryEntries[S];if(L.finallyLoc===b)return this.complete(L.completion,L.afterLoc),D(L),R}},catch:function(b){for(var S=this.tryEntries.length-1;S>=0;--S){var L=this.tryEntries[S];if(L.tryLoc===b){var U=L.completion;if(U.type==="throw"){var j=U.arg;D(L)}return j}}throw Error("illegal catch attempt")},delegateYield:function(b,S,L){return this.delegate={iterator:x(b),resultName:S,nextLoc:L},this.method==="next"&&(this.arg=r),R}},e}function ln(r,e){return ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,t){return n.__proto__=t,n},ln(r,e)}function Go(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=ze(r))!==null;);return r}function $o(r,e,n,t){var i=un(ze(r.prototype),e,n);return typeof i=="function"?function(s){return i.apply(n,s)}:i}function Vo(r,e){if(typeof r!="object"||!r)return r;var n=r[Symbol.toPrimitive];if(n!==void 0){var t=n.call(r,e);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Wo(r){var e=Vo(r,"string");return typeof e=="symbol"?e:e+""}function et(r){"@babel/helpers - typeof";return et=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},et(r)}var Dt=function(){function r(){se(this,r)}return ae(r,[{key:"listenForWhisper",value:function(n,t){return this.listen(".client-"+n,t)}},{key:"notification",value:function(n){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",n)}},{key:"stopListeningForWhisper",value:function(n,t){return this.stopListening(".client-"+n,t)}}])}();function Ct(r,e){var n={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.indexOf(t)<0&&(n[t]=r[t]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,t=Object.getOwnPropertySymbols(r);i<t.length;i++)e.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(r,t[i])&&(n[t[i]]=r[t[i]]);return n}function St(r,e,n,t){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function f(C){try{g(t.next(C))}catch(E){o(E)}}function p(C){try{g(t.throw(C))}catch(E){o(E)}}function g(C){C.done?s(C.value):i(C.value).then(f,p)}g((t=t.apply(r,[])).next())})}var vn=function(){function r(e){se(this,r),this.namespace=e}return ae(r,[{key:"format",value:function(n){return[".","\\"].includes(n.charAt(0))?n.substring(1):(this.namespace&&(n=this.namespace+"."+n),n.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(n){this.namespace=n}}])}(),mn=function(r){function e(n,t,i){var s,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return se(this,e),s=he(this,e),s._alertErrorListeners=function(f){f&&s.errorListeners.forEach(function(p){return p(f)})},s.name=t,s.ably=n,s.options=i,s.eventFormatter=new vn(s.options.namespace),s.subscribedListeners=[],s.errorListeners=[],s.channel=n.channels.get(t),s.callbacks=new Map,o&&s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){var t=this;this.channel.on(function(i){var s=i.previous,o=i.current,f=i.reason;s!=="attached"&&o=="attached"?t.subscribedListeners.forEach(function(p){return p()}):f&&t._alertErrorListeners(i)}),this.channel.attach(this._alertErrorListeners)}},{key:"unsubscribe",value:function(){this.channel.unsubscribe(),this.callbacks.clear(),this.unregisterError(),this.unregisterSubscribed(),this.channel.off(),this.channel.detach()}},{key:"listen",value:function(t,i){return this.callbacks.set(i,function(s){var o=s.data,f=Ct(s,["data"]);return i(o,f)}),this.channel.subscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this}},{key:"listenToAll",value:function(t){var i=this;return this.callbacks.set(t,function(s){var o=s.name,f=s.data,p=Ct(s,["name","data"]),g=i.options.namespace.replace(/\./g,"\\"),C=o.startsWith(g)?o.substring(g.length+1):"."+o;t(C,f,p)}),this.channel.subscribe(this.callbacks.get(t)),this}},{key:"stopListening",value:function(t,i){return i?(this.channel.unsubscribe(this.eventFormatter.format(t),this.callbacks.get(i)),this.callbacks.delete(i)):this.channel.unsubscribe(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?(this.channel.unsubscribe(this.callbacks.get(t)),this.callbacks.delete(t)):this.channel.unsubscribe(),this}},{key:"subscribed",value:function(t){return this.subscribedListeners.push(t),this}},{key:"error",value:function(t){return this.errorListeners.push(t),this}},{key:"unregisterSubscribed",value:function(t){return t?this.subscribedListeners=this.subscribedListeners.filter(function(i){return i!=t}):this.subscribedListeners=[],this}},{key:"unregisterError",value:function(t){return t?this.errorListeners=this.errorListeners.filter(function(i){return i!=t}):this.errorListeners=[],this}}])}(Dt),zo=function(r){function e(n,t,i,s){var o;return se(this,e),o=he(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.subscribe(),o}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(mn),Nr=function(r){function e(n,t,i,s){var o;return se(this,e),o=he(this,e,[n,t,i,!1]),o.channel.on("failed",s.onChannelFailed(o)),o.channel.on("attached",function(){return o.enter(o.presenceData,o._alertErrorListeners)}),o.subscribe(),o}return pe(e,r),ae(e,[{key:"unsubscribe",value:function(){this.leave(this.presenceData,this._alertErrorListeners),this.channel.presence.unsubscribe(),$o(e,"unsubscribe",this)([])}},{key:"here",value:function(t){var i=this;return this.channel.presence.subscribe(["enter","update","leave"],function(){return i.channel.presence.get(function(s,o){return t(o.map(function(f){var p=f.data;return p}),s)})}),this}},{key:"joining",value:function(t){return this.channel.presence.subscribe(["enter","update"],function(i){var s=i.data,o=Ct(i,["data"]);t(s,o)}),this}},{key:"leaving",value:function(t){return this.channel.presence.subscribe("leave",function(i){var s=i.data,o=Ct(i,["data"]);t(s,o)}),this}},{key:"enter",value:function(t,i){return this.channel.presence.enter(t,i),this}},{key:"leave",value:function(t,i){return this.channel.presence.leave(t,i),this}},{key:"update",value:function(t,i){return this.channel.presence.update(t,i),this}},{key:"whisper",value:function(t,i,s){return s?this.channel.publish("client-".concat(t),i,s):this.channel.publish("client-".concat(t),i),this}}])}(mn),Ko=function(e){return e==null||e===void 0},Ur=function(e){var n=e.split(".")[0],t=n.replace("-","+").replace("_","/"),i=JSON.parse(Nn(t)),s=e.split(".")[1],o=s.replace("-","+").replace("_","/"),f=JSON.parse(Nn(o));return{header:i,payload:f}},Vt=function(e){var n=Ur(e),t=n.payload;return{clientId:t["x-ably-clientId"],expires:t.exp*1e3,issued:t.iat*1e3,token:e}},kt=(typeof window>"u"?"undefined":et(window))==="object",Nn=function(e){var n=e.replace(/-/g,"+").replace(/_/g,"/"),t=e.length%4===0?"":"=".repeat(4-e.length%4),i=n+t;return kt?atob(i):Buffer.from(i,"base64").toString()},qo=function(e){var n="";return kt?n=btoa(e):n=Buffer.from(e).toString("base64"),n.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},Jo=function(e){return e&&e.indexOf("http://")===0||e.indexOf("https://")===0},Qo=function(e){var n,t,i;if(!Jo(e)&&typeof window<"u"){var s=(n=window==null?void 0:window.location)===null||n===void 0?void 0:n.hostname,o=(t=window==null?void 0:window.location)===null||t===void 0?void 0:t.port,f=(i=window==null?void 0:window.location)===null||i===void 0?void 0:i.protocol.replace(":","");if(s&&o&&f)return f+"://"+s+":"+o+e}return e},Wt;function Yo(r,e){Wt||(Wt=new Ably.Rest.Platform.Http),kt?delete r.headers["Content-Length"]:r.method=r.method.toLowerCase(),Wt.doUri(r.method,null,r.uri,r.headers,r.body,r.paramsIfNoHeaders||{},e)}var Xo=function(e){return new Promise(function(n,t){Yo(e,function(i,s){if(i)t(i);else if(typeof s=="string")n(JSON.parse(s));else if(!kt&&Buffer.isBuffer(s))try{n(JSON.parse(s.toString()))}catch{n(s)}else n(s)})})},Un=!1,Zo=function(e,n){var t=e.channels.get("dummy");if(t.__proto__.authorizeChannel=n,Un)return;var i=t.__proto__._attach;if(Ko(i)){console.warn("Failed to enable authorize for pre-attach, please check for right library version");return}function s(o,f,p){var g=this;if(!this.authorizing){this.authorizing=!0;var C=i.bind(this);this.authorizeChannel(this,function(E){if(g.authorizing=!1,E){p?p(E):console.error("channel ".concat(g.name," auth error => ").concat(E));return}else C(o,f,p)})}}t.__proto__._attach=s,Un=!0},es=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;se(this,r),this.execute=function(i){return new Promise(function(s,o){e.queue.run(function(){return St(e,void 0,void 0,Le().mark(function f(){var p,g,C;return Le().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,i(this.cachedToken);case 3:p=A.sent,g=p.token,C=p.info,this.cachedToken=g,s({token:g,info:C}),A.next=13;break;case 10:A.prev=10,A.t0=A.catch(0),o(A.t0);case 13:case"end":return A.stop()}},f,this,[[0,10]])}))})})},this.request=function(i){return e.execute(function(s){return e.requestTokenFn(i,s)})},this.cachedToken=n,this.requestTokenFn=t,this.queue=new ts}),ts=ae(function r(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;se(this,r),this.canRunNext=function(){return e.running.length<e.count&&e.todo.length},this.run=function(i){return St(e,void 0,void 0,Le().mark(function s(){var o;return Le().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:i&&this.todo.push(i);case 1:if(!this.canRunNext()){p.next=9;break}return o=this.todo.shift(),this.running.push(o),p.next=6,o();case 6:this.running.shift(),p.next=1;break;case 9:case"end":return p.stop()}},s,this)}))},this.total=n.length,this.todo=n,this.running=[],this.count=t}),ns=ae(function r(e,n){var t=this;se(this,r),this.expiredAuthChannels=new Set,this.setExpired=function(p){return t.expiredAuthChannels.add(p)},this.isExpired=function(p){return t.expiredAuthChannels.has(p)},this.removeExpired=function(p){return t.expiredAuthChannels.delete(p)},this.options={queryTime:!0,useTokenAuth:!0,authCallback:function(g,C){return St(t,void 0,void 0,Le().mark(function E(){var A,I,u;return Le().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.prev=0,R.next=3,this.authRequestExecuter.request(null);case 3:A=R.sent,I=A.token,u=Vt(I),C(null,u),R.next=12;break;case 9:R.prev=9,R.t0=R.catch(0),C(R.t0,null);case 12:case"end":return R.stop()}},E,this,[[0,9]])}))},echoMessages:!1},this.requestToken=function(p,g){return St(t,void 0,void 0,Le().mark(function C(){var E,A;return Le().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return E=JSON.stringify({channel_name:p,token:g}),A={uri:this.authEndpoint,method:"POST",headers:we({Accept:"application/json","Content-Type":"application/json","Content-Length":E.length},this.authHeaders),body:E},u.next=4,Xo(A);case 4:return u.abrupt("return",u.sent);case 5:case"end":return u.stop()}},C,this)}))},this.ablyClient=function(){return t.ablyConnector.ably},this.existingToken=function(){return t.ablyClient().auth.tokenDetails},this.getChannel=function(p){return t.ablyConnector.channels[p]},this.enableAuthorizeBeforeChannelAttach=function(){var p=t.ablyClient();p.auth.getTimestamp(t.options.queryTime,function(){}),Zo(p,function(g,C){var E=g.name;if(E.startsWith("public:")){C(null);return}var A=t.existingToken();if(A&&!t.isExpired(E)){var I=Ur(A.token).payload["x-ably-capability"],u=I.includes("".concat(E,'"'));if(u&&A.expires>p.auth.getTimestampUsingOffset()){C(null);return}}t.authRequestExecuter.request(E).then(function(w){var R=w.token,P=w.info,y=t.getChannel(E);t.setPresenceInfo(y,P),t.tryAuthorizeOnSameConnection(we(we({},t.options),{token:Vt(R)}),function(m,T){m?C(m):(t.removeExpired(E),C(null))})}).catch(function(w){return C(w)})})},this.allowReconnectOnUserLogin=function(){var p=t.ablyClient().connection,g=function(E){E.reason.code==40102&&(p.off(g),console.warn("User login detected, re-connecting again!"),t.onClientIdChanged())};p.on("failed",g)},this.onClientIdChanged=function(){t.ablyClient().connect();for(var p=0,g=Object.values(t.ablyConnector.channels);p<g.length;p++){var C=g[p];C.channel.attach(C._alertErrorListeners)}},this.tryAuthorizeOnSameConnection=function(p,g){t.ablyClient().auth.authorize(null,p,g)},this.onChannelFailed=function(p){return function(g){var C;((C=g.reason)===null||C===void 0?void 0:C.code)==40160&&t.handleChannelAuthError(p)}},this.handleChannelAuthError=function(p){if(!p.skipAuth){var g=p.name;t.authRequestExecuter.request(g).then(function(C){var E=C.token,A=C.info;t.setPresenceInfo(p,A),t.tryAuthorizeOnSameConnection(we(we({},t.options),{token:Vt(E)}),function(I,u){I?p._alertErrorListeners(I):(p.skipAuth=!0,p.channel.once("attached",function(){p.skipAuth=!1}),p.channel.attach(p._alertErrorListeners))})}).catch(function(C){return p._alertErrorListeners(C)})}},this.setPresenceInfo=function(p,g){p instanceof Nr&&(p.presenceData=g)},this.ablyConnector=e;var i=n.authEndpoint,s=n.auth.headers,o=n.token,f=n.requestTokenFn;this.authEndpoint=Qo(i),this.authHeaders=s,this.authRequestExecuter=new es(o,f??this.requestToken)}),Nt=function(r){function e(n,t,i){var s;return se(this,e),s=he(this,e),s.name=t,s.pusher=n,s.options=i,s.eventFormatter=new vn(s.options.namespace),s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"listenToAll",value:function(t){var i=this;return this.subscription.bind_global(function(s,o){if(!s.startsWith("pusher:")){var f=i.options.namespace.replace(/\./g,"\\"),p=s.startsWith(f)?s.substring(f.length+1):"."+s;t(p,o)}}),this}},{key:"stopListening",value:function(t,i){return i?this.subscription.unbind(this.eventFormatter.format(t),i):this.subscription.unbind(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?this.subscription.unbind_global(t):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(t){return this.on("pusher:subscription_succeeded",function(){t()}),this}},{key:"error",value:function(t){return this.on("pusher:subscription_error",function(i){t(i)}),this}},{key:"on",value:function(t,i){return this.subscription.bind(t,i),this}}])}(Dt),rs=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(Nt),is=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}}])}(Nt),os=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this.on("pusher:subscription_succeeded",function(i){t(Object.keys(i.members).map(function(s){return i.members[s]}))}),this}},{key:"joining",value:function(t){return this.on("pusher:member_added",function(i){t(i.info)}),this}},{key:"whisper",value:function(t,i){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),i),this}},{key:"leaving",value:function(t){return this.on("pusher:member_removed",function(i){t(i.info)}),this}}])}(Nt),Fr=function(r){function e(n,t,i){var s;return se(this,e),s=he(this,e),s.events={},s.listeners={},s.name=t,s.socket=n,s.options=i,s.eventFormatter=new vn(s.options.namespace),s.subscribe(),s}return pe(e,r),ae(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(t,i){return this.on(this.eventFormatter.format(t),i),this}},{key:"stopListening",value:function(t,i){return this.unbindEvent(this.eventFormatter.format(t),i),this}},{key:"subscribed",value:function(t){return this.on("connect",function(i){t(i)}),this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){var s=this;return this.listeners[t]=this.listeners[t]||[],this.events[t]||(this.events[t]=function(o,f){s.name===o&&s.listeners[t]&&s.listeners[t].forEach(function(p){return p(f)})},this.socket.on(t,this.events[t])),this.listeners[t].push(i),this}},{key:"unbind",value:function(){var t=this;Object.keys(this.events).forEach(function(i){t.unbindEvent(i)})}},{key:"unbindEvent",value:function(t,i){this.listeners[t]=this.listeners[t]||[],i&&(this.listeners[t]=this.listeners[t].filter(function(s){return s!==i})),(!i||this.listeners[t].length===0)&&(this.events[t]&&(this.socket.removeListener(t,this.events[t]),delete this.events[t]),delete this.listeners[t])}}])}(Dt),jr=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}}])}(Fr),ss=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this.on("presence:subscribed",function(i){t(i.map(function(s){return s.user_info}))}),this}},{key:"joining",value:function(t){return this.on("presence:joining",function(i){return t(i.user_info)}),this}},{key:"whisper",value:function(t,i){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:i}),this}},{key:"leaving",value:function(t){return this.on("presence:leaving",function(i){return t(i.user_info)}),this}}])}(jr),At=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(t,i){return this}},{key:"listenToAll",value:function(t){return this}},{key:"stopListening",value:function(t,i){return this}},{key:"subscribed",value:function(t){return this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,i){return this}}])}(Dt),Fn=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"whisper",value:function(t,i){return this}}])}(At),as=function(r){function e(){return se(this,e),he(this,e,arguments)}return pe(e,r),ae(e,[{key:"here",value:function(t){return this}},{key:"joining",value:function(t){return this}},{key:"whisper",value:function(t,i){return this}},{key:"leaving",value:function(t){return this}}])}(At),Ut=function(){function r(e){se(this,r),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(e),this.connect()}return ae(r,[{key:"setOptions",value:function(n){this.options=we(this._defaultOptions,n);var t=this.csrfToken();return t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),t=this.options.bearerToken,t&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t),n}},{key:"csrfToken",value:function(){var n;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(n=document.querySelector('meta[name="csrf-token"]'))?n.getAttribute("content"):null}}])}(),jn=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new Nt(this.pusher,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new rs(this.pusher,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"encryptedPrivateChannel",value:function(t){return this.channels["private-encrypted-"+t]||(this.channels["private-encrypted-"+t]=new is(this.pusher,"private-encrypted-"+t,this.options)),this.channels["private-encrypted-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new os(this.pusher,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"private-encrypted-"+t,"presence-"+t];s.forEach(function(o,f){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}])}(Ut),us=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){var t=this,i=this.getSocketIO();return this.socket=i(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(t.channels).forEach(function(s){s.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new Fr(this.socket,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new jr(this.socket,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new ss(this.socket,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var i=this,s=[t,"private-"+t,"presence-"+t];s.forEach(function(o){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}])}(Ut),ls=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){}},{key:"listen",value:function(t,i,s){return new At}},{key:"channel",value:function(t){return new At}},{key:"privateChannel",value:function(t){return new Fn}},{key:"encryptedPrivateChannel",value:function(t){return new Fn}},{key:"presenceChannel",value:function(t){return new as}},{key:"leave",value:function(t){}},{key:"leaveChannel",value:function(t){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}])}(Ut),Br=function(r){function e(){var n;return se(this,e),n=he(this,e,arguments),n.channels={},n}return pe(e,r),ae(e,[{key:"connect",value:function(){typeof this.options.client<"u"?this.ably=this.options.client:(this.ablyAuth=new ns(this,this.options),this.options.agents||(this.options.agents={}),this.options.agents["laravel-echo"]=e.LIB_VERSION,this.ably=new Ably.Realtime(we(we({},this.ablyAuth.options),this.options)),this.ablyAuth.enableAuthorizeBeforeChannelAttach(),this.ablyAuth.allowReconnectOnUserLogin())}},{key:"listen",value:function(t,i,s){return this.channel(t).listen(i,s)}},{key:"channel",value:function(t){var i="public:".concat(t);return this.channels[i]||(this.channels[i]=new mn(this.ably,i,this.options)),this.channels[i]}},{key:"privateChannel",value:function(t){var i="private:".concat(t);return this.channels[i]||(this.channels[i]=new zo(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"presenceChannel",value:function(t){var i="presence:".concat(t);return this.channels[i]||(this.channels[i]=new Nr(this.ably,i,this.options,this.ablyAuth)),this.channels[i]}},{key:"leave",value:function(t){var i=this,s=["public:".concat(t),"private:".concat(t),"presence:".concat(t)];s.forEach(function(o,f){i.leaveChannel(o)})}},{key:"leaveChannel",value:function(t){if(t.indexOf("public:")!==0&&t.indexOf("private:")!==0&&t.indexOf("presence:")!==0)throw new Error("Error leaving ".concat(t,', name should be prefixed with either "public:", "private:" or "presence:"'));this.channels[t]&&(this.channels[t].unsubscribe(),this.ablyAuth.setExpired(t),delete this.channels[t])}},{key:"socketId",value:function(){var t,i={connectionKey:this.ably.connection.key,clientId:(t=this.ably.auth.clientId)!==null&&t!==void 0?t:null};return qo(JSON.stringify(i))}},{key:"disconnect",value:function(){this.ably.close()}}])}(Ut);Br.LIB_VERSION="1.0.6";var Wu=function(){function r(e){se(this,r),this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return ae(r,[{key:"channel",value:function(n){return this.connector.channel(n)}},{key:"connect",value:function(){if(this.options.broadcaster=="ably")this.connector=new Br(this.options);else if(this.options.broadcaster=="reverb")this.connector=new jn(we(we({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new jn(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new us(this.options);else if(this.options.broadcaster=="null")this.connector=new ls(this.options);else if(typeof this.options.broadcaster=="function")this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(et(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(n){return this.connector.presenceChannel(n)}},{key:"leave",value:function(n){this.connector.leave(n)}},{key:"leaveChannel",value:function(n){this.connector.leaveChannel(n)}},{key:"leaveAllChannels",value:function(){for(var n in this.connector.channels)this.leaveChannel(n)}},{key:"listen",value:function(n,t,i){return this.connector.listen(n,t,i)}},{key:"private",value:function(n){return this.connector.privateChannel(n)}},{key:"encryptedPrivate",value:function(n){return this.connector.encryptedPrivateChannel(n)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":et(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var n=this;Vue.http.interceptors.push(function(t,i){n.socketId()&&t.headers.set("X-Socket-ID",n.socketId()),i()})}},{key:"registerAxiosRequestInterceptor",value:function(){var n=this;axios.interceptors.request.use(function(t){return n.socketId()&&(t.headers["X-Socket-Id"]=n.socketId()),t})}},{key:"registerjQueryAjaxSetup",value:function(){var n=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(t,i,s){n.socketId()&&s.setRequestHeader("X-Socket-Id",n.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var n=this;document.addEventListener("turbo:before-fetch-request",function(t){t.detail.fetchOptions.headers["X-Socket-Id"]=n.socketId()})}}])}(),it=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yn(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Hr={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.50
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(r,e){(function(t,i){r.exports=i()})(window,function(){return function(n){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=t,i.d=function(s,o,f){i.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:f})},i.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},i.t=function(s,o){if(o&1&&(s=i(s)),o&8||o&4&&typeof s=="object"&&s&&s.__esModule)return s;var f=Object.create(null);if(i.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:s}),o&2&&typeof s!="string")for(var p in s)i.d(f,p,(function(g){return s[g]}).bind(null,p));return f},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=42)}([function(n,t,i){i.r(t),i.d(t,"__extends",function(){return o}),i.d(t,"__assign",function(){return f}),i.d(t,"__rest",function(){return p}),i.d(t,"__decorate",function(){return g}),i.d(t,"__param",function(){return C}),i.d(t,"__metadata",function(){return E}),i.d(t,"__awaiter",function(){return A}),i.d(t,"__generator",function(){return I}),i.d(t,"__createBinding",function(){return u}),i.d(t,"__exportStar",function(){return w}),i.d(t,"__values",function(){return R}),i.d(t,"__read",function(){return P}),i.d(t,"__spread",function(){return y}),i.d(t,"__spreadArrays",function(){return m}),i.d(t,"__spreadArray",function(){return T}),i.d(t,"__await",function(){return d}),i.d(t,"__asyncGenerator",function(){return c}),i.d(t,"__asyncDelegator",function(){return l}),i.d(t,"__asyncValues",function(){return a}),i.d(t,"__makeTemplateObject",function(){return v}),i.d(t,"__importStar",function(){return O}),i.d(t,"__importDefault",function(){return k}),i.d(t,"__classPrivateFieldGet",function(){return D}),i.d(t,"__classPrivateFieldSet",function(){return _});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var s=function(x,b){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,L){S.__proto__=L}||function(S,L){for(var U in L)Object.prototype.hasOwnProperty.call(L,U)&&(S[U]=L[U])},s(x,b)};function o(x,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");s(x,b);function S(){this.constructor=x}x.prototype=b===null?Object.create(b):(S.prototype=b.prototype,new S)}var f=function(){return f=Object.assign||function(b){for(var S,L=1,U=arguments.length;L<U;L++){S=arguments[L];for(var j in S)Object.prototype.hasOwnProperty.call(S,j)&&(b[j]=S[j])}return b},f.apply(this,arguments)};function p(x,b){var S={};for(var L in x)Object.prototype.hasOwnProperty.call(x,L)&&b.indexOf(L)<0&&(S[L]=x[L]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var U=0,L=Object.getOwnPropertySymbols(x);U<L.length;U++)b.indexOf(L[U])<0&&Object.prototype.propertyIsEnumerable.call(x,L[U])&&(S[L[U]]=x[L[U]]);return S}function g(x,b,S,L){var U=arguments.length,j=U<3?b:L===null?L=Object.getOwnPropertyDescriptor(b,S):L,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(x,b,S,L);else for(var V=x.length-1;V>=0;V--)($=x[V])&&(j=(U<3?$(j):U>3?$(b,S,j):$(b,S))||j);return U>3&&j&&Object.defineProperty(b,S,j),j}function C(x,b){return function(S,L){b(S,L,x)}}function E(x,b){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(x,b)}function A(x,b,S,L){function U(j){return j instanceof S?j:new S(function($){$(j)})}return new(S||(S=Promise))(function(j,$){function V(N){try{M(L.next(N))}catch(F){$(F)}}function H(N){try{M(L.throw(N))}catch(F){$(F)}}function M(N){N.done?j(N.value):U(N.value).then(V,H)}M((L=L.apply(x,b||[])).next())})}function I(x,b){var S={label:0,sent:function(){if(j[0]&1)throw j[1];return j[1]},trys:[],ops:[]},L,U,j,$;return $={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function V(M){return function(N){return H([M,N])}}function H(M){if(L)throw new TypeError("Generator is already executing.");for(;S;)try{if(L=1,U&&(j=M[0]&2?U.return:M[0]?U.throw||((j=U.return)&&j.call(U),0):U.next)&&!(j=j.call(U,M[1])).done)return j;switch(U=0,j&&(M=[M[0]&2,j.value]),M[0]){case 0:case 1:j=M;break;case 4:return S.label++,{value:M[1],done:!1};case 5:S.label++,U=M[1],M=[0];continue;case 7:M=S.ops.pop(),S.trys.pop();continue;default:if(j=S.trys,!(j=j.length>0&&j[j.length-1])&&(M[0]===6||M[0]===2)){S=0;continue}if(M[0]===3&&(!j||M[1]>j[0]&&M[1]<j[3])){S.label=M[1];break}if(M[0]===6&&S.label<j[1]){S.label=j[1],j=M;break}if(j&&S.label<j[2]){S.label=j[2],S.ops.push(M);break}j[2]&&S.ops.pop(),S.trys.pop();continue}M=b.call(x,S)}catch(N){M=[6,N],U=0}finally{L=j=0}if(M[0]&5)throw M[1];return{value:M[0]?M[1]:void 0,done:!0}}}var u=Object.create?function(x,b,S,L){L===void 0&&(L=S),Object.defineProperty(x,L,{enumerable:!0,get:function(){return b[S]}})}:function(x,b,S,L){L===void 0&&(L=S),x[L]=b[S]};function w(x,b){for(var S in x)S!=="default"&&!Object.prototype.hasOwnProperty.call(b,S)&&u(b,x,S)}function R(x){var b=typeof Symbol=="function"&&Symbol.iterator,S=b&&x[b],L=0;if(S)return S.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&L>=x.length&&(x=void 0),{value:x&&x[L++],done:!x}}};throw new TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function P(x,b){var S=typeof Symbol=="function"&&x[Symbol.iterator];if(!S)return x;var L=S.call(x),U,j=[],$;try{for(;(b===void 0||b-- >0)&&!(U=L.next()).done;)j.push(U.value)}catch(V){$={error:V}}finally{try{U&&!U.done&&(S=L.return)&&S.call(L)}finally{if($)throw $.error}}return j}function y(){for(var x=[],b=0;b<arguments.length;b++)x=x.concat(P(arguments[b]));return x}function m(){for(var x=0,b=0,S=arguments.length;b<S;b++)x+=arguments[b].length;for(var L=Array(x),U=0,b=0;b<S;b++)for(var j=arguments[b],$=0,V=j.length;$<V;$++,U++)L[U]=j[$];return L}function T(x,b,S){if(S||arguments.length===2)for(var L=0,U=b.length,j;L<U;L++)(j||!(L in b))&&(j||(j=Array.prototype.slice.call(b,0,L)),j[L]=b[L]);return x.concat(j||Array.prototype.slice.call(b))}function d(x){return this instanceof d?(this.v=x,this):new d(x)}function c(x,b,S){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var L=S.apply(x,b||[]),U,j=[];return U={},$("next"),$("throw"),$("return"),U[Symbol.asyncIterator]=function(){return this},U;function $(B){L[B]&&(U[B]=function(W){return new Promise(function(J,Q){j.push([B,W,J,Q])>1||V(B,W)})})}function V(B,W){try{H(L[B](W))}catch(J){F(j[0][3],J)}}function H(B){B.value instanceof d?Promise.resolve(B.value.v).then(M,N):F(j[0][2],B)}function M(B){V("next",B)}function N(B){V("throw",B)}function F(B,W){B(W),j.shift(),j.length&&V(j[0][0],j[0][1])}}function l(x){var b,S;return b={},L("next"),L("throw",function(U){throw U}),L("return"),b[Symbol.iterator]=function(){return this},b;function L(U,j){b[U]=x[U]?function($){return(S=!S)?{value:d(x[U]($)),done:U==="return"}:j?j($):$}:j}}function a(x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b=x[Symbol.asyncIterator],S;return b?b.call(x):(x=typeof R=="function"?R(x):x[Symbol.iterator](),S={},L("next"),L("throw"),L("return"),S[Symbol.asyncIterator]=function(){return this},S);function L(j){S[j]=x[j]&&function($){return new Promise(function(V,H){$=x[j]($),U(V,H,$.done,$.value)})}}function U(j,$,V,H){Promise.resolve(H).then(function(M){j({value:M,done:V})},$)}}function v(x,b){return Object.defineProperty?Object.defineProperty(x,"raw",{value:b}):x.raw=b,x}var h=Object.create?function(x,b){Object.defineProperty(x,"default",{enumerable:!0,value:b})}:function(x,b){x.default=b};function O(x){if(x&&x.__esModule)return x;var b={};if(x!=null)for(var S in x)S!=="default"&&Object.prototype.hasOwnProperty.call(x,S)&&u(b,x,S);return h(b,x),b}function k(x){return x&&x.__esModule?x:{default:x}}function D(x,b,S,L){if(S==="a"&&!L)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!L:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?L:S==="a"?L.call(x):L?L.value:b.get(x)}function _(x,b,S,L,U){if(L==="m")throw new TypeError("Private method is not writable");if(L==="a"&&!U)throw new TypeError("Private accessor was defined without a setter");if(typeof b=="function"?x!==b||!U:!b.has(x))throw new TypeError("Cannot write private member to an object whose class did not declare it");return L==="a"?U.call(x,S):U?U.value=S:b.set(x,S),S}},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.allToUpperCase=t.allToLowerCase=t.encodeBody=t.decodeBody=t.Format=t.promisify=t.trim=t.arrChooseN=t.randomHexString=t.randomString=t.cheapRandStr=t.dataSizeBytes=t.inspectBody=t.inspectError=t.isErrorInfoOrPartialErrorInfo=t.now=t.parseQueryString=t.toQueryString=t.arrPopRandomElement=t.defaultPostHeaders=t.defaultGetHeaders=t.allSame=t.arrEvery=t.arrFilter=t.arrMap=t.safeArrForEach=t.arrForEach=t.forInOwnNonNullProperties=t.valuesArray=t.keysArray=t.arrWithoutValue=t.arrDeleteValue=t.arrIn=t.arrIndexOf=t.arrSubtract=t.arrIntersectOb=t.arrIntersect=t.intersect=t.containsValue=t.inherits=t.prototypicalClone=t.shallowClone=t.isEmptyArg=t.isOnlyPropIn=t.isEmpty=t.isObject=t.ensureArray=t.isArray=t.copy=t.mixin=void 0,t.arrEquals=t.toBase64=t.matchDerivedChannel=t.shallowEquals=t.getGlobalObject=t.getRetryTime=t.getJitterCoefficient=t.getBackoffCoefficient=void 0;var o=i(0),f=o.__importDefault(i(3)),p=o.__importStar(i(8)),g=o.__importDefault(i(4)),C=i(11),E=i(31);function A(G){return Math.floor(Math.random()*G.length)}function I(G){for(var K=[],q=1;q<arguments.length;q++)K[q-1]=arguments[q];for(var Z=0;Z<K.length;Z++){var ne=K[Z];if(!ne)break;var ye=Object.prototype.hasOwnProperty;for(var Qe in ne)(!ye||ye.call(ne,Qe))&&(G[Qe]=ne[Qe])}return G}t.mixin=I;function u(G){return I({},G)}t.copy=u,t.isArray=Array.isArray||function(G){return Object.prototype.toString.call(G)=="[object Array]"};function w(G){return m(G)?[]:(0,t.isArray)(G)?G:[G]}t.ensureArray=w;function R(G){return Object.prototype.toString.call(G)=="[object Object]"}t.isObject=R;function P(G){for(var K in G)return!1;return!0}t.isEmpty=P;function y(G,K){for(var q in G)if(q!==K)return!1;return!0}t.isOnlyPropIn=y;function m(G){return G==null}t.isEmptyArg=m;function T(G){var K=new Object;for(var q in G)K[q]=G[q];return K}t.shallowClone=T;function d(G,K){var q=function(){function ne(){}return ne}();q.prototype=G;var Z=new q;return K&&I(Z,K),Z}t.prototypicalClone=d;var c=function(G,K){if(f.default.Config.inherits){f.default.Config.inherits(G,K);return}G.super_=K,G.prototype=d(K.prototype,{constructor:G})};t.inherits=c;function l(G,K){for(var q in G)if(G[q]==K)return!0;return!1}t.containsValue=l;function a(G,K){return(0,t.isArray)(K)?v(G,K):h(G,K)}t.intersect=a;function v(G,K){for(var q=[],Z=0;Z<G.length;Z++){var ne=G[Z];(0,t.arrIndexOf)(K,ne)!=-1&&q.push(ne)}return q}t.arrIntersect=v;function h(G,K){for(var q=[],Z=0;Z<G.length;Z++){var ne=G[Z];ne in K&&q.push(ne)}return q}t.arrIntersectOb=h;function O(G,K){for(var q=[],Z=0;Z<G.length;Z++){var ne=G[Z];(0,t.arrIndexOf)(K,ne)==-1&&q.push(ne)}return q}t.arrSubtract=O,t.arrIndexOf=Array.prototype.indexOf?function(G,K,q){return G.indexOf(K,q)}:function(G,K,q){q=q||0;for(var Z=G.length;q<Z;q++)if(G[q]===K)return q;return-1};function k(G,K){return(0,t.arrIndexOf)(G,K)!==-1}t.arrIn=k;function D(G,K){var q=(0,t.arrIndexOf)(G,K),Z=q!=-1;return Z&&G.splice(q,1),Z}t.arrDeleteValue=D;function _(G,K){var q=G.slice();return D(q,K),q}t.arrWithoutValue=_;function x(G,K){var q=[];for(var Z in G)K&&!Object.prototype.hasOwnProperty.call(G,Z)||q.push(Z);return q}t.keysArray=x;function b(G,K){var q=[];for(var Z in G)K&&!Object.prototype.hasOwnProperty.call(G,Z)||q.push(G[Z]);return q}t.valuesArray=b;function S(G,K){for(var q in G)Object.prototype.hasOwnProperty.call(G,q)&&G[q]&&K(q)}t.forInOwnNonNullProperties=S,t.arrForEach=Array.prototype.forEach?function(G,K){G.forEach(K)}:function(G,K){for(var q=G.length,Z=0;Z<q;Z++)K(G[Z],Z,G)};function L(G,K){return(0,t.arrForEach)(G.slice(),K)}t.safeArrForEach=L,t.arrMap=Array.prototype.map?function(G,K){return G.map(K)}:function(G,K){for(var q=[],Z=G.length,ne=0;ne<Z;ne++)q.push(K(G[ne],ne,G));return q},t.arrFilter=Array.prototype.filter?function(G,K){return G.filter(K)}:function(G,K){for(var q=[],Z=G.length,ne=0;ne<Z;ne++)K(G[ne])&&q.push(G[ne]);return q},t.arrEvery=Array.prototype.every?function(G,K){return G.every(K)}:function(G,K){for(var q=G.length,Z=0;Z<q;Z++)if(!K(G[Z],Z,G))return!1;return!0};function U(G,K){if(G.length===0)return!0;var q=G[0][K];return(0,t.arrEvery)(G,function(Z){return Z[K]===q})}t.allSame=U;var j={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function $(G,K){var q=j[K||ie.json];return{accept:q,"X-Ably-Version":p.default.protocolVersion.toString(),"Ably-Agent":(0,p.getAgentString)(G)}}t.defaultGetHeaders=$;function V(G,K){var q,Z=q=j[K||ie.json];return{accept:Z,"content-type":q,"X-Ably-Version":p.default.protocolVersion.toString(),"Ably-Agent":(0,p.getAgentString)(G)}}t.defaultPostHeaders=V;function H(G){return G.splice(A(G),1)[0]}t.arrPopRandomElement=H;function M(G){var K=[];if(G)for(var q in G)K.push(encodeURIComponent(q)+"="+encodeURIComponent(G[q]));return K.length?"?"+K.join("&"):""}t.toQueryString=M;function N(G){for(var K,q=/([^?&=]+)=?([^&]*)/g,Z={};K=q.exec(G);)Z[decodeURIComponent(K[1])]=decodeURIComponent(K[2]);return Z}t.parseQueryString=N,t.now=Date.now||function(){return new Date().getTime()};function F(G){return typeof G=="object"&&G!==null&&(G.constructor.name=="ErrorInfo"||G.constructor.name=="PartialErrorInfo")}t.isErrorInfoOrPartialErrorInfo=F;function B(G){var K,q;return G instanceof Error||((K=G==null?void 0:G.constructor)===null||K===void 0?void 0:K.name)==="ErrorInfo"||((q=G==null?void 0:G.constructor)===null||q===void 0?void 0:q.name)==="PartialErrorInfo"?G.toString():f.default.Config.inspect(G)}t.inspectError=B;function W(G){return f.default.BufferUtils.isBuffer(G)?G.toString():typeof G=="string"?G:f.default.Config.inspect(G)}t.inspectBody=W;function J(G){if(f.default.BufferUtils.isBuffer(G))return f.default.BufferUtils.byteLength(G);if(typeof G=="string")return f.default.Config.stringByteSize(G);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof G)}t.dataSizeBytes=J;function Q(){return String(Math.random()).substr(2)}t.cheapRandStr=Q;var X=function(G){if(f.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(G);return f.default.Config.getRandomValues(K),f.default.BufferUtils.base64Encode(K)}for(var q=f.default.BufferUtils.base64CharSet,Z=Math.round(G*4/3),ne="",ye=0;ye<Z;ye++)ne+=q[A(q)];return ne};t.randomString=X;var ee=function(G){if(f.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(G);return f.default.Config.getRandomValues(K),f.default.BufferUtils.hexEncode(K)}for(var q=f.default.BufferUtils.hexCharSet,Z=G*2,ne="",ye=0;ye<Z;ye++)ne+=q[A(q)];return ne};t.randomHexString=ee;function re(G,K){for(var q=Math.min(K,G.length),Z=G.slice(),ne=[],ye=0;ye<q;ye++)ne.push(H(Z));return ne}t.arrChooseN=re,t.trim=String.prototype.trim?function(G){return G.trim()}:function(G){return G.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Y(G,K,q){return new Promise(function(Z,ne){G[K].apply(G,o.__spreadArray(o.__spreadArray([],q,!1),[function(ye,Qe){ye?ne(ye):Z(Qe)}],!1))})}t.promisify=Y;var ie;(function(G){G.msgpack="msgpack",G.json="json"})(ie=t.Format||(t.Format={}));function fe(G,K){return K=="msgpack"?f.default.Config.msgpack.decode(G):JSON.parse(String(G))}t.decodeBody=fe;function ve(G,K){return K=="msgpack"?f.default.Config.msgpack.encode(G,!0):JSON.stringify(G)}t.encodeBody=ve;function ce(G){return G.map(function(K){return K&&K.toLowerCase()})}t.allToLowerCase=ce;function Me(G){return G.map(function(K){return K&&K.toUpperCase()})}t.allToUpperCase=Me;function st(G){return Math.min((G+2)/3,2)}t.getBackoffCoefficient=st;function Re(){return 1-Math.random()*.2}t.getJitterCoefficient=Re;function at(G,K){return G*st(K)*Re()}t.getRetryTime=at;function jt(){return s||(typeof window<"u"?window:self)}t.getGlobalObject=jt;function Bt(G,K){return Object.keys(G).every(function(q){return G[q]===K[q]})&&Object.keys(K).every(function(q){return K[q]===G[q]})}t.shallowEquals=Bt;function ti(G){var K=/^(\[([^?]*)(?:(.*))\])?(.+)$/,q=G.match(K);if(!q||!q.length||q.length<5)throw new g.default("regex match failed",400,40010);if(q[2])throw new g.default("cannot use a derived option with a ".concat(q[2]," channel"),400,40010);return{qualifierParam:q[3]||"",channelName:q[4]}}t.matchDerivedChannel=ti;function ni(G){return f.default.Config.createHmac?Buffer.from(G,"ascii").toString("base64"):(0,C.stringify)((0,E.parse)(G))}t.toBase64=ni;function ri(G,K){return G.length===K.length&&(0,t.arrEvery)(G,function(q,Z){return q===K[Z]})}t.arrEquals=ri}).call(this,i(13))},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),f=o.__importDefault(i(3)),p=s||(typeof window<"u"?window:self),g;(function(u){u[u.None=0]="None",u[u.Error=1]="Error",u[u.Major=2]="Major",u[u.Minor=3]="Minor",u[u.Micro=4]="Micro"})(g||(g={}));function C(u,w){return"".concat(u).padStart(w?3:2,"0")}function E(u){return f.default.Config.logTimestamps?function(w){var R=new Date;u(C(R.getHours())+":"+C(R.getMinutes())+":"+C(R.getSeconds())+"."+C(R.getMilliseconds(),1)+" "+w)}:u}var A=function(){var u,w,R,P;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((w=(u=p==null?void 0:p.console)===null||u===void 0?void 0:u.log)===null||w===void 0?void 0:w.apply)=="function"?(R=function(){for(var y=[],m=0;m<arguments.length;m++)y[m]=arguments[m];console.log.apply(console,y)},P=console.warn?function(){for(var y=[],m=0;m<arguments.length;m++)y[m]=arguments[m];console.warn.apply(console,y)}:R):p!=null&&p.console.log?R=P=function(){Function.prototype.apply.call(console.log,console,arguments)}:R=P=function(){},[R,P].map(E)},I=function(){function u(){u.logLevel=u.LOG_DEFAULT}return u.initLogHandlers=function(){var w=A(),R=w[0],P=w[1];this.logHandler=R,this.logErrorHandler=P},u.renamedClientOption=function(w,R){u.deprecationWarning("The `".concat(w,"` client option has been renamed to `").concat(R,"`. Please update your code to use `").concat(R,"` instead. `").concat(w,"` will be removed in a future version."))},u.renamedMethod=function(w,R,P){u.deprecationWarning("`".concat(w,"`s `").concat(R,"` method has been renamed to `").concat(P,"`. Please update your code to use `").concat(P,"` instead. `").concat(R,"` will be removed in a future version."))},u.deprecationWarning=function(w){u.shouldLog(g.Error)&&u.logErrorHandler("Ably: Deprecation warning - ".concat(w))},u.logLevel=g.Error,u.LOG_NONE=g.None,u.LOG_ERROR=g.Error,u.LOG_MAJOR=g.Major,u.LOG_MINOR=g.Minor,u.LOG_MICRO=g.Micro,u.LOG_DEFAULT=g.Error,u.LOG_DEBUG=g.Micro,u.logAction=function(w,R,P){u.shouldLog(w)&&(w===g.Error?u.logErrorHandler:u.logHandler)("Ably: "+R+": "+P)},u.deprecated=function(w,R){u.deprecationWarning("".concat(w," is deprecated and will be removed in a future version. ").concat(R))},u.shouldLog=function(w){return w<=u.logLevel},u.setLog=function(w,R){w!==void 0&&(u.logLevel=w),R!==void 0&&(u.logHandler=u.logErrorHandler=R)},u}();t.default=I}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(){}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartialErrorInfo=void 0;var s=i(0),o=s.__importDefault(i(3)),f=s.__importStar(i(1));function p(E){var A="["+E.constructor.name;return E.message&&(A+=": "+E.message),E.statusCode&&(A+="; statusCode="+E.statusCode),E.code&&(A+="; code="+E.code),E.cause&&(A+="; cause="+f.inspectError(E.cause)),E.href&&!(E.message&&E.message.indexOf("help.ably.io")>-1)&&(A+="; see "+E.href+" "),A+="]",A}var g=function(E){s.__extends(A,E);function A(I,u,w,R){var P=E.call(this,I)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(P,A.prototype),P.code=u,P.statusCode=w,P.cause=R,P}return A.prototype.toString=function(){return p(this)},A.fromValues=function(I){var u=I,w=u.message,R=u.code,P=u.statusCode;if(typeof w!="string"||typeof R!="number"||typeof P!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+o.default.Config.inspect(I));var y=Object.assign(new A(w,R,P),I);return y.code&&!y.href&&(y.href="https://help.ably.io/error/"+y.code),y},A}(Error);t.default=g;var C=function(E){s.__extends(A,E);function A(I,u,w,R){var P=E.call(this,I)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(P,A.prototype),P.code=u,P.statusCode=w,P.cause=R,P}return A.prototype.toString=function(){return p(this)},A}(Error);t.PartialErrorInfo=C},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){if(typeof ArrayBuffer=="function"){var o=s,f=o.lib,p=f.WordArray,g=p.init,C=p.init=function(E){if(E instanceof ArrayBuffer&&(E=new Uint8Array(E)),(E instanceof Int8Array||typeof Uint8ClampedArray<"u"&&E instanceof Uint8ClampedArray||E instanceof Int16Array||E instanceof Uint16Array||E instanceof Int32Array||E instanceof Uint32Array||E instanceof Float32Array||E instanceof Float64Array)&&(E=new Uint8Array(E.buffer,E.byteOffset,E.byteLength)),E instanceof Uint8Array){for(var A=E.byteLength,I=[],u=0;u<A;u++)I[u>>>2]|=E[u]<<24-u%4*8;g.call(this,I,A)}else g.apply(this,arguments)};C.prototype=p}}(),s.lib.WordArray})},function(n,t,i){(function(s){(function(o,f){n.exports=f()})(this,function(){var o=o||function(f,p){var g;if(typeof window<"u"&&window.crypto&&(g=window.crypto),!g&&typeof window<"u"&&window.msCrypto&&(g=window.msCrypto),!g&&typeof s<"u"&&s.crypto&&(g=s.crypto),!g)try{g=i(44)}catch{}var C=function(){if(g){if(typeof g.getRandomValues=="function")try{return g.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof g.randomBytes=="function")try{return g.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},E=Object.create||function(){function c(){}return function(l){var a;return c.prototype=l,a=new c,c.prototype=null,a}}(),A={},I=A.lib={},u=I.Base=function(){return{extend:function(c){var l=E(this);return c&&l.mixIn(c),(!l.hasOwnProperty("init")||this.init===l.init)&&(l.init=function(){l.$super.init.apply(this,arguments)}),l.init.prototype=l,l.$super=this,l},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var l in c)c.hasOwnProperty(l)&&(this[l]=c[l]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),w=I.WordArray=u.extend({init:function(c,l){c=this.words=c||[],l!=p?this.sigBytes=l:this.sigBytes=c.length*4},toString:function(c){return(c||P).stringify(this)},concat:function(c){var l=this.words,a=c.words,v=this.sigBytes,h=c.sigBytes;if(this.clamp(),v%4)for(var O=0;O<h;O++){var k=a[O>>>2]>>>24-O%4*8&255;l[v+O>>>2]|=k<<24-(v+O)%4*8}else for(var O=0;O<h;O+=4)l[v+O>>>2]=a[O>>>2];return this.sigBytes+=h,this},clamp:function(){var c=this.words,l=this.sigBytes;c[l>>>2]&=4294967295<<32-l%4*8,c.length=f.ceil(l/4)},clone:function(){var c=u.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var l=[],a=0;a<c;a+=4)l.push(C());return new w.init(l,c)}}),R=A.enc={},P=R.Hex={stringify:function(c){for(var l=c.words,a=c.sigBytes,v=[],h=0;h<a;h++){var O=l[h>>>2]>>>24-h%4*8&255;v.push((O>>>4).toString(16)),v.push((O&15).toString(16))}return v.join("")},parse:function(c){for(var l=c.length,a=[],v=0;v<l;v+=2)a[v>>>3]|=parseInt(c.substr(v,2),16)<<24-v%8*4;return new w.init(a,l/2)}},y=R.Latin1={stringify:function(c){for(var l=c.words,a=c.sigBytes,v=[],h=0;h<a;h++){var O=l[h>>>2]>>>24-h%4*8&255;v.push(String.fromCharCode(O))}return v.join("")},parse:function(c){for(var l=c.length,a=[],v=0;v<l;v++)a[v>>>2]|=(c.charCodeAt(v)&255)<<24-v%4*8;return new w.init(a,l)}},m=R.Utf8={stringify:function(c){try{return decodeURIComponent(escape(y.stringify(c)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(c){return y.parse(unescape(encodeURIComponent(c)))}},T=I.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new w.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=m.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var l,a=this._data,v=a.words,h=a.sigBytes,O=this.blockSize,k=O*4,D=h/k;c?D=f.ceil(D):D=f.max((D|0)-this._minBufferSize,0);var _=D*O,x=f.min(_*4,h);if(_){for(var b=0;b<_;b+=O)this._doProcessBlock(v,b);l=v.splice(0,_),a.sigBytes-=x}return new w.init(l,x)},clone:function(){var c=u.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});I.Hasher=T.extend({cfg:u.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){c&&this._append(c);var l=this._doFinalize();return l},blockSize:16,_createHelper:function(c){return function(l,a){return new c.init(a).finalize(l)}},_createHmacHelper:function(c){return function(l,a){return new d.HMAC.init(c,a).finalize(l)}}});var d=A.algo={};return A}(Math);return o})}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(2)),p=s.__importDefault(i(3));function g(A,I,u){try{I.apply(A,u)}catch(w){f.default.logAction(f.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+w+"; stack = "+(w&&w.stack))}}function C(A,I,u){for(var w,R,P,y=0;y<A.length;y++)if(w=A[y],u&&(w=w[u]),o.isArray(w)){for(;(R=o.arrIndexOf(w,I))!==-1;)w.splice(R,1);u&&w.length===0&&delete A[y][u]}else if(o.isObject(w))for(P in w)Object.prototype.hasOwnProperty.call(w,P)&&o.isArray(w[P])&&C([w],I,P)}var E=function(){function A(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return A.prototype.on=function(){for(var I=this,u=[],w=0;w<arguments.length;w++)u[w]=arguments[w];if(u.length===1){var R=u[0];if(typeof R=="function")this.any.push(R);else throw new Error("EventListener.on(): Invalid arguments: "+p.default.Config.inspect(u))}if(u.length===2){var P=u[0],y=u[1];if(typeof y!="function")throw new Error("EventListener.on(): Invalid arguments: "+p.default.Config.inspect(u));if(o.isEmptyArg(P))this.any.push(y);else if(o.isArray(P))P.forEach(function(T){I.on(T,y)});else{if(typeof P!="string")throw new Error("EventListener.on(): Invalid arguments: "+p.default.Config.inspect(u));var m=this.events[P]||(this.events[P]=[]);m.push(y)}}},A.prototype.off=function(){for(var I,u=this,w=[],R=0;R<arguments.length;R++)w[R]=arguments[R];if(w.length==0||o.isEmptyArg(w[0])&&o.isEmptyArg(w[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var P=w[0],y=w[1],m=null,T=null;if(w.length===1||!y)typeof P=="function"?m=P:T=P;else{if(typeof y!="function")throw new Error("EventEmitter.off(): invalid arguments:"+p.default.Config.inspect(w));I=[P,y],T=I[0],m=I[1]}if(m&&o.isEmptyArg(T)){C([this.any,this.events,this.anyOnce,this.eventsOnce],m);return}if(o.isArray(T)){T.forEach(function(d){u.off(d,m)});return}if(typeof T!="string")throw new Error("EventEmitter.off(): invalid arguments:"+p.default.Config.inspect(w));m?C([this.events,this.eventsOnce],m,T):(delete this.events[T],delete this.eventsOnce[T])},A.prototype.listeners=function(I){if(I){var u=this.events[I]||[];return this.eventsOnce[I]&&Array.prototype.push.apply(u,this.eventsOnce[I]),u.length?u:null}return this.any.length?this.any:null},A.prototype.emit=function(I){for(var u=[],w=1;w<arguments.length;w++)u[w-1]=arguments[w];var R={event:I},P=[];this.anyOnce.length&&(Array.prototype.push.apply(P,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(P,this.any);var y=this.eventsOnce[I];y&&(Array.prototype.push.apply(P,y),delete this.eventsOnce[I]);var m=this.events[I];m&&Array.prototype.push.apply(P,m),o.arrForEach(P,function(T){g(R,T,u)})},A.prototype.once=function(){for(var I=this,u=[],w=0;w<arguments.length;w++)u[w]=arguments[w];var R=u.length;if((R===0||R===1&&typeof u[0]!="function")&&p.default.Config.Promise){var P=u[0];return new p.default.Config.Promise(function(l){I.once(P,l)})}var y=u[0],m=u[1];if(u.length===1&&typeof y=="function")this.anyOnce.push(y);else if(o.isEmptyArg(y)){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+p.default.Config.inspect(u));this.anyOnce.push(m)}else if(o.isArray(y)){var T=this,d=function(){var l=Array.prototype.slice.call(arguments);if(o.arrForEach(y,function(a){T.off(a,d)}),typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+p.default.Config.inspect(u));m.apply(this,l)};o.arrForEach(y,function(l){T.on(l,d)})}else{if(typeof y!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+p.default.Config.inspect(u));var c=this.eventsOnce[y]||(this.eventsOnce[y]=[]);if(m){if(typeof m!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+p.default.Config.inspect(u));c.push(m)}}},A.prototype.whenState=function(I,u,w){for(var R=this,P=[],y=3;y<arguments.length;y++)P[y-3]=arguments[y];var m={event:I};if(typeof I!="string"||typeof u!="string")throw"whenState requires a valid event String argument";if(typeof w!="function"&&p.default.Config.Promise)return new p.default.Config.Promise(function(T){A.prototype.whenState.apply(R,[I,u,T].concat(P))});I===u?g(m,w,P):this.once(I,w)},A}();t.default=E},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaults=t.normaliseOptions=t.objectifyOptions=t.getAgentString=t.getHosts=t.getFallbackHosts=t.environmentFallbackHosts=t.getHttpScheme=t.getPort=t.getHost=void 0;var s=i(0),o=s.__importDefault(i(3)),f=s.__importStar(i(1)),p=s.__importDefault(i(2)),g=s.__importDefault(i(4)),C=i(43),E="ably-js/"+C.version,A={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:C.version,protocolVersion:2,agent:E,getHost:I,getPort:u,getHttpScheme:w,environmentFallbackHosts:R,getFallbackHosts:P,getHosts:y,checkHost:m,objectifyOptions:l,normaliseOptions:a};function I(h,O,k){return k?O=O==h.restHost&&h.realtimeHost||O||h.realtimeHost:O=O||h.restHost,O}t.getHost=I;function u(h,O){return O||h.tls?h.tlsPort:h.port}t.getPort=u;function w(h){return h.tls?"https://":"http://"}t.getHttpScheme=w;function R(h){return[h+"-a-fallback.ably-realtime.com",h+"-b-fallback.ably-realtime.com",h+"-c-fallback.ably-realtime.com",h+"-d-fallback.ably-realtime.com",h+"-e-fallback.ably-realtime.com"]}t.environmentFallbackHosts=R;function P(h){var O=h.fallbackHosts,k=typeof h.httpMaxRetryCount<"u"?h.httpMaxRetryCount:A.httpMaxRetryCount;return O?f.arrChooseN(O,k):[]}t.getFallbackHosts=P;function y(h){return[h.restHost].concat(P(h))}t.getHosts=y;function m(h){if(typeof h!="string")throw new g.default("host must be a string; was a "+typeof h,4e4,400);if(!h.length)throw new g.default("host must not be zero-length",4e4,400)}function T(h,O,k){return h.realtimeHost?h.realtimeHost:h.restHost?(p.default.logAction(p.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+h.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+h.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),h.restHost):O?A.REALTIME_HOST:k+"-"+A.REALTIME_HOST}function d(h){var O={};for(var k in A.TIMEOUTS)O[k]=h[k]||A.TIMEOUTS[k];return O}function c(h){var O=A.agent;if(h.agents)for(var k in h.agents)O+=" "+k+"/"+h.agents[k];return O}t.getAgentString=c;function l(h){return typeof h=="string"?h.indexOf(":")==-1?{token:h}:{key:h}:h}t.objectifyOptions=l;function a(h){if(h.host&&(p.default.renamedClientOption("host","restHost"),h.restHost=h.host),h.wsHost&&(p.default.renamedClientOption("wsHost","realtimeHost"),h.realtimeHost=h.wsHost),h.queueEvents&&(p.default.renamedClientOption("queueEvents","queueMessages"),h.queueMessages=h.queueEvents),h.headers&&p.default.deprecated("the `headers` client option",""),h.fallbackHostsUseDefault){if(h.fallbackHosts){var O="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw p.default.logAction(p.default.LOG_ERROR,"Defaults.normaliseOptions",O),new g.default(O,4e4,400)}if(h.port||h.tlsPort){var O="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw p.default.logAction(p.default.LOG_ERROR,"Defaults.normaliseOptions",O),new g.default(O,4e4,400)}h.environment?p.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youve set the `environment` client option, then this is no longer necessary: remove your usage of the `fallbackHostsUseDefault` client option and the library will then automatically choose the correct fallback hosts to use for the specified environment."):p.default.deprecated("The `fallbackHostsUseDefault` client option","If youre using this client option to force the library to make use of fallback hosts even though youre not using the primary Ably environment, then stop using `fallbackHostsUseDefault`, and update your code to either pass the `environment` client option (in which case the library will automatically choose the correct fallback hosts to use for the specified environment), or to pass the `fallbackHosts` client option to specify a custom list of fallback hosts to use (for example, if youre using a custom CNAME, in which case Ably will have provided you with an explicit list of fallback hosts)."),h.fallbackHosts=A.FALLBACK_HOSTS}h.recover===!0&&(p.default.deprecated("The ability to use a boolean value for the `recover` client option","If you wish for the connection to always be recovered, replace `{ recover: true }` with a function that always passes `true` to its callback: `{ recover: function(lastConnectionDetails, cb) { cb(true); } }`"),h.recover=function(H,M){M(!0)}),typeof h.recover=="function"&&h.closeOnUnload===!0&&(p.default.logAction(p.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),h.recover=void 0),"closeOnUnload"in h||(h.closeOnUnload=!h.recover),h.transports&&f.arrIn(h.transports,"xhr")&&(p.default.deprecationWarning('The "xhr" transport has been renamed to "xhr_streaming". Please update your client options code to use `transports: ["xhr_streaming"]` instead. The ability to use `transports: ["xhr"]` will be removed in a future version.'),f.arrDeleteValue(h.transports,"xhr"),h.transports.push("xhr_streaming")),"queueMessages"in h||(h.queueMessages=!0);var k=h.environment&&String(h.environment).toLowerCase()||A.ENVIRONMENT,D=!k||k==="production";!h.fallbackHosts&&!h.restHost&&!h.realtimeHost&&!h.port&&!h.tlsPort&&(h.fallbackHosts=D?A.FALLBACK_HOSTS:R(k));var _=h.restHost||(D?A.REST_HOST:k+"-"+A.REST_HOST),x=T(h,D,k);f.arrForEach((h.fallbackHosts||[]).concat(_,x),m),h.port=h.port||A.PORT,h.tlsPort=h.tlsPort||A.TLS_PORT,"tls"in h||(h.tls=!0);var b=d(h);if("useBinaryProtocol"in h?h.useBinaryProtocol=o.default.Config.supportsBinary&&h.useBinaryProtocol:h.useBinaryProtocol=o.default.Config.preferBinary,h.clientId){var S=h.headers=h.headers||{};S["X-Ably-ClientId"]=o.default.BufferUtils.base64Encode(o.default.BufferUtils.utf8Encode(h.clientId))}"idempotentRestPublishing"in h||(h.idempotentRestPublishing=!0),h.promises&&!o.default.Config.Promise&&(p.default.logAction(p.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),h.promises=!1);var L=null,U=h.connectivityCheckUrl;if(h.connectivityCheckUrl){var j=h.connectivityCheckUrl.split("?"),$=j[0],V=j[1];L=V?f.parseQueryString(V):{},$.indexOf("://")===-1&&($="https://"+$),U=$}return s.__assign(s.__assign({},h),{useBinaryProtocol:"useBinaryProtocol"in h?o.default.Config.supportsBinary&&h.useBinaryProtocol:o.default.Config.preferBinary,realtimeHost:x,restHost:_,maxMessageSize:h.maxMessageSize||A.maxMessageSize,timeouts:b,connectivityCheckParams:L,connectivityCheckUrl:U})}t.normaliseOptions=a,t.default=A;function v(h){return Object.assign(A,h)}t.getDefaults=v},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),f=s.__importDefault(i(2)),p=s.__importDefault(i(4)),g=s.__importStar(i(1));function C(u){return!u||!u.channelOptions?{channelOptions:u,plugins:{},baseEncodedPreviousPayload:void 0}:u}function E(u){if(u&&u.cipher){if(!o.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var w=o.default.Crypto.getCipher(u.cipher);return{cipher:w.cipherParams,channelCipher:w.cipher}}return u??{}}function A(u){var w=0;return u.name&&(w+=u.name.length),u.clientId&&(w+=u.clientId.length),u.extras&&(w+=JSON.stringify(u.extras).length),u.data&&(w+=g.dataSizeBytes(u.data)),w}var I=function(){function u(){}return u.prototype.toJSON=function(){var w=this.encoding,R=this.data;return R&&o.default.BufferUtils.isBuffer(R)&&(arguments.length>0?(w=w?w+"/base64":"base64",R=o.default.BufferUtils.base64Encode(R)):R=o.default.BufferUtils.toBuffer(R)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:w,data:R}},u.prototype.toString=function(){var w="[Message";return this.name&&(w+="; name="+this.name),this.id&&(w+="; id="+this.id),this.timestamp&&(w+="; timestamp="+this.timestamp),this.clientId&&(w+="; clientId="+this.clientId),this.connectionId&&(w+="; connectionId="+this.connectionId),this.encoding&&(w+="; encoding="+this.encoding),this.extras&&(w+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?w+="; data="+this.data:o.default.BufferUtils.isBuffer(this.data)?w+="; data (buffer)="+o.default.BufferUtils.base64Encode(this.data):w+="; data (json)="+JSON.stringify(this.data)),this.extras&&(w+="; extras="+JSON.stringify(this.extras)),w+="]",w},u.encrypt=function(w,R,P){var y=w.data,m=w.encoding,T=R.channelCipher;m=m?m+"/":"",o.default.BufferUtils.isBuffer(y)||(y=o.default.BufferUtils.utf8Encode(String(y)),m=m+"utf-8/"),T.encrypt(y,function(d,c){if(d){P(d);return}w.data=c,w.encoding=m+"cipher+"+T.algorithm,P(null,w)})},u.encode=function(w,R,P){var y=w.data,m=typeof y=="string"||o.default.BufferUtils.isBuffer(y)||y===null||y===void 0;if(!m)if(g.isObject(y)||g.isArray(y))w.data=JSON.stringify(y),w.encoding=w.encoding?w.encoding+"/json":"json";else throw new p.default("Data type is unsupported",40013,400);R!=null&&R.cipher?u.encrypt(w,R,P):P(null,w)},u.encodeArray=function(w,R,P){for(var y=0,m=0;m<w.length;m++)u.encode(w[m],R,function(T){if(T){P(T);return}y++,y==w.length&&P(null,w)})},u.decode=function(w,R){var P=C(R),y=w.data,m=w.encoding;if(m){var T=m.split("/"),d=void 0,c=T.length,l=w.data,a="";try{for(;(d=c)>0;){var v=T[--c].match(/([-\w]+)(\+([\w-]+))?/);if(!v)break;switch(a=v[1],a){case"base64":l=o.default.BufferUtils.base64Decode(String(l)),d==T.length&&(y=l);continue;case"utf-8":l=o.default.BufferUtils.utf8Decode(l);continue;case"json":l=JSON.parse(l);continue;case"cipher":if(P.channelOptions!=null&&P.channelOptions.cipher&&P.channelOptions.channelCipher){var h=v[3],O=P.channelOptions.channelCipher;if(h!=O.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");l=O.decrypt(l);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!P.plugins||!P.plugins.vcdiff)throw new p.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new p.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var k=P.baseEncodedPreviousPayload;typeof k=="string"&&(k=o.default.BufferUtils.utf8Encode(k)),k=o.default.BufferUtils.toBuffer(k),l=o.default.BufferUtils.toBuffer(l),l=o.default.BufferUtils.typedArrayToBuffer(P.plugins.vcdiff.decode(l,k)),y=l}catch(_){throw new p.default("Vcdiff delta decode failed with "+_,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(_){var D=_;throw new p.default("Error processing the "+a+" encoding, decoder returned "+D.message+"",D.code||40013,400)}finally{w.encoding=d<=0?null:T.slice(0,d).join("/"),w.data=l}}P.baseEncodedPreviousPayload=y},u.fromResponseBody=function(w,R,P){P&&(w=g.decodeBody(w,P));for(var y=0;y<w.length;y++){var m=w[y]=u.fromValues(w[y]);try{u.decode(m,R)}catch(T){f.default.logAction(f.default.LOG_ERROR,"Message.fromResponseBody()",T.toString())}}return w},u.fromValues=function(w){return Object.assign(new u,w)},u.fromValuesArray=function(w){for(var R=w.length,P=new Array(R),y=0;y<R;y++)P[y]=u.fromValues(w[y]);return P},u.fromEncoded=function(w,R){var P=u.fromValues(w),y=E(R??null);try{u.decode(P,y)}catch(m){f.default.logAction(f.default.LOG_ERROR,"Message.fromEncoded()",m.toString())}return P},u.fromEncodedArray=function(w,R){return w.map(function(P){return u.fromEncoded(P,R)})},u.getMessagesSize=function(w){for(var R,P=0,y=0;y<w.length;y++)R=w[y],P+=R.size||(R.size=A(R));return P},u.serialize=g.encodeBody,u}();t.default=I},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(4)),p=s.__importDefault(i(9)),g=s.__importDefault(i(16)),C={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},E=[];Object.keys(C).forEach(function(P){E[C[P]]=P});var A={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},I=Object.keys(A);A.MODE_ALL=A.PRESENCE|A.PUBLISH|A.SUBSCRIBE|A.PRESENCE_SUBSCRIBE;function u(P){var y=[];if(P)for(var m=0;m<P.length;m++)y.push(P[m].toString());return"[ "+y.join(", ")+" ]"}var w="id channel channelSerial connectionId count msgSerial timestamp".split(" "),R=function(){function P(){var y=this;this.hasFlag=function(m){return(y.flags&A[m])>0}}return P.prototype.setFlag=function(y){return this.flags=this.flags|A[y]},P.prototype.getMode=function(){return this.flags&&this.flags&A.MODE_ALL},P.prototype.encodeModesToFlags=function(y){var m=this;y.forEach(function(T){return m.setFlag(T)})},P.prototype.decodeModesFromFlags=function(){var y=this,m=[];return P.channelModes.forEach(function(T){y.hasFlag(T)&&m.push(T)}),m.length>0?m:void 0},P.fromValues=function(y){return Object.assign(new P,y)},P.Action=C,P.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],P.ActionName=E,P.serialize=o.encodeBody,P.deserialize=function(y,m){var T=o.decodeBody(y,m);return P.fromDeserialized(T)},P.fromDeserialized=function(y){var m=y.error;m&&(y.error=f.default.fromValues(m));var T=y.messages;if(T)for(var d=0;d<T.length;d++)T[d]=p.default.fromValues(T[d]);var c=y.presence;if(c)for(var d=0;d<c.length;d++)c[d]=g.default.fromValues(c[d],!0);return Object.assign(new P,y)},P.stringify=function(y){var m="[ProtocolMessage";y.action!==void 0&&(m+="; action="+P.ActionName[y.action]||!1);for(var T,d=0;d<w.length;d++)T=w[d],y[T]!==void 0&&(m+="; "+T+"="+y[T]);if(y.messages&&(m+="; messages="+u(p.default.fromValuesArray(y.messages))),y.presence&&(m+="; presence="+u(g.default.fromValuesArray(y.presence))),y.error&&(m+="; error="+f.default.fromValues(y.error).toString()),y.auth&&y.auth.accessToken&&(m+="; token="+y.auth.accessToken),y.flags&&(m+="; flags="+I.filter(y.hasFlag).join(",")),y.params){var c="";o.forInOwnNonNullProperties(y.params,function(l){c.length>0&&(c+="; "),c+=l+"="+y.params[l]}),c.length>0&&(m+="; params=["+c+"]")}return m+="]",m},P}();t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,f=o.lib,p=f.WordArray,g=o.enc;g.Base64={stringify:function(E){var A=E.words,I=E.sigBytes,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";E.clamp();for(var w=[],R=0;R<I;R+=3)for(var P=A[R>>>2]>>>24-R%4*8&255,y=A[R+1>>>2]>>>24-(R+1)%4*8&255,m=A[R+2>>>2]>>>24-(R+2)%4*8&255,T=P<<16|y<<8|m,d=0;d<4&&R+d*.75<I;d++)w.push(u.charAt(T>>>6*(3-d)&63));var c=u.charAt(64);if(c)for(;w.length%4;)w.push(c);return w.join("")},parse:function(E){var A=E.length,I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=this._reverseMap;if(!u){u=this._reverseMap=[];for(var w=0;w<I.length;w++)u[I.charCodeAt(w)]=w}var R=I.charAt(64);if(R){var P=E.indexOf(R);P!==-1&&(A=P)}return C(E,A,u)}};function C(E,A,I){for(var u=[],w=0,R=0;R<A;R++)if(R%4){var P=I[E.charCodeAt(R-1)]<<R%4*2,y=I[E.charCodeAt(R)]>>>6-R%4*2,m=P|y;u[w>>>2]|=m<<24-w%4*8,w++}return p.create(u,w)}}(),s.enc.Base64})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(10)),p=s.__importDefault(i(26)),g=s.__importDefault(i(2)),C=s.__importDefault(i(8)),E=s.__importDefault(i(21)),A=s.__importDefault(i(18)),I=s.__importDefault(i(4)),u=s.__importDefault(i(22)),w=s.__importDefault(i(3));function R(m){var T=[80015,80017,80030];return m.code?A.default.isTokenErr(m)?!1:o.arrIn(T,m.code)?!0:m.code>=4e4&&m.code<5e4:!1}function P(m){return R(m)?[f.default.fromValues({action:f.default.Action.ERROR,error:m})]:[f.default.fromValues({action:f.default.Action.DISCONNECTED,error:m})]}var y=function(m){s.__extends(T,m);function T(d,c,l){var a=m.call(this,d,c,l,!0)||this;return a.onAuthUpdated=function(v){a.authParams={access_token:v.token}},a.stream="stream"in l?l.stream:!0,a.sendRequest=null,a.recvRequest=null,a.pendingCallback=null,a.pendingItems=null,a}return T.prototype.connect=function(){var d=this;g.default.logAction(g.default.LOG_MINOR,"CometTransport.connect()","starting"),p.default.prototype.connect.call(this);var c=this.params,l=c.options,a=C.default.getHost(l,c.host),v=C.default.getPort(l),h=l.tls?"https://":"http://";this.baseUri=h+a+":"+v+"/comet/";var O=this.baseUri+"connect";g.default.logAction(g.default.LOG_MINOR,"CometTransport.connect()","uri: "+O),this.auth.getAuthParams(function(k,D){if(k){d.disconnect(k);return}if(!d.isDisposed){d.authParams=D;var _=d.params.getConnectParams(D);"stream"in _&&(d.stream=_.stream),g.default.logAction(g.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(_));var x=!1,b=d.recvRequest=d.createRequest(O,null,_,null,d.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV);b.on("data",function(S){d.recvRequest&&(x||(x=!0,d.emit("preconnect")),d.onData(S))}),b.on("complete",function(S){if(d.recvRequest||(S=S||new I.default("Request cancelled",80003,400)),d.recvRequest=null,!x&&!S&&(x=!0,d.emit("preconnect")),d.onActivity(),S){S.code?d.onData(P(S)):d.disconnect(S);return}w.default.Config.nextTick(function(){d.recv()})}),b.exec()}})},T.prototype.requestClose=function(){g.default.logAction(g.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},T.prototype.requestDisconnect=function(){g.default.logAction(g.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},T.prototype._requestCloseOrDisconnect=function(d){var c=this,l=d?this.closeUri:this.disconnectUri;if(l){var a=this.createRequest(l,null,this.authParams,null,u.default.REQ_SEND);a.on("complete",function(v){v&&(g.default.logAction(g.default.LOG_ERROR,"CometTransport.request"+(d?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(v)),c.finish("disconnected",v))}),a.exec()}},T.prototype.dispose=function(){var d=this;g.default.logAction(g.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(g.default.logAction(g.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",E.default.disconnected()),w.default.Config.nextTick(function(){d.emit("disposed")}))},T.prototype.onConnect=function(d){var c;if(!this.isDisposed){var l=(c=d.connectionDetails)===null||c===void 0?void 0:c.connectionKey;p.default.prototype.onConnect.call(this,d);var a=this.baseUri+l;g.default.logAction(g.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+a),this.sendUri=a+"/send",this.recvUri=a+"/recv",this.closeUri=a+"/close",this.disconnectUri=a+"/disconnect"}},T.prototype.send=function(d){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(d);return}var c=this.pendingItems||[];c.push(d),this.pendingItems=null,this.sendItems(c)},T.prototype.sendAnyPending=function(){var d=this.pendingItems;d&&(this.pendingItems=null,this.sendItems(d))},T.prototype.sendItems=function(d){var c=this,l=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(d),u.default.REQ_SEND);l.on("complete",function(a,v){if(a&&g.default.logAction(g.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(a)),c.sendRequest=null,a){a.code?c.onData(P(a)):c.disconnect(a);return}v&&c.onData(v),c.pendingItems&&w.default.Config.nextTick(function(){c.sendRequest||c.sendAnyPending()})}),l.exec()},T.prototype.recv=function(){var d=this;if(!this.recvRequest&&this.isConnected){var c=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?u.default.REQ_RECV_STREAM:u.default.REQ_RECV_POLL);c.on("data",function(l){d.onData(l)}),c.on("complete",function(l){if(d.recvRequest=null,d.onActivity(),l){l.code?d.onData(P(l)):d.disconnect(l);return}w.default.Config.nextTick(function(){d.recv()})}),c.exec()}},T.prototype.onData=function(d){try{var c=this.decodeResponse(d);if(c&&c.length)for(var l=0;l<c.length;l++)this.onProtocolMessage(f.default.fromDeserialized(c[l]))}catch(a){g.default.logAction(g.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+a.stack)}},T.prototype.encodeRequest=function(d){return JSON.stringify(d)},T.prototype.decodeResponse=function(d){return typeof d=="string"?JSON.parse(d):d},T}(p.default);t.default=y},function(n,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}n.exports=i},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isSuccessCode=void 0;var s;(function(f){f[f.Success=200]="Success",f[f.NoContent=204]="NoContent",f[f.BadRequest=400]="BadRequest",f[f.Unauthorized=401]="Unauthorized",f[f.Forbidden=403]="Forbidden",f[f.RequestTimeout=408]="RequestTimeout",f[f.InternalServerError=500]="InternalServerError"})(s||(s={}));function o(f){return f>=s.Success&&f<s.BadRequest}t.isSuccessCode=o,t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),f=s.__importStar(i(1)),p=s.__importDefault(i(2)),g=s.__importDefault(i(18)),C=s.__importDefault(i(19)),E=i(4),A=s.__importDefault(i(14));function I(m,T,d,c,l){m.http.supportsAuthHeaders?m.auth.getAuthHeaders(function(a,v){a?c(a):l(f.mixin(v,T),d)}):m.auth.getAuthParams(function(a,v){a?c(a):l(T,f.mixin(v,d))})}function u(m,T){return function(d,c,l,a,v){if(d&&!c){m(d);return}if(v===A.default.NoContent){m(d,[],l,!0,v);return}if(!a)try{c=f.decodeBody(c,T)}catch(x){f.isErrorInfoOrPartialErrorInfo(x)?m(x):m(new E.PartialErrorInfo(f.inspectError(x),null));return}if(!c){m(new E.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var h=c,O=h.statusCode,k=h.response,D=h.headers;if(O===void 0){m(d,c,l,!0,v);return}if(O<200||O>=300){var _=k&&k.error||d;_||(_=new Error("Error in unenveloping "+c),_.statusCode=O),m(_,k,D,!0,O);return}m(d,k,D,!0,O)}}function w(m){var T=[];if(m)for(var d in m)T.push(d+"="+m[d]);return T.join("&")}function R(m,T){return m+(T?"?":"")+w(T)}function P(m,T,d,c){return function(l,a,v,h,O){l?p.default.logAction(p.default.LOG_MICRO,"Resource."+T+"()","Received Error; "+R(d,c)+"; Error: "+f.inspectError(l)):p.default.logAction(p.default.LOG_MICRO,"Resource."+T+"()","Received; "+R(d,c)+"; Headers: "+w(v)+"; StatusCode: "+O+"; Body: "+(o.default.BufferUtils.isBuffer(a)?a.toString():a)),m&&m(l,a,v,h,O)}}var y=function(){function m(){}return m.get=function(T,d,c,l,a,v){m.do(C.default.Get,T,d,null,c,l,a,v)},m.delete=function(T,d,c,l,a,v){m.do(C.default.Delete,T,d,null,c,l,a,v)},m.post=function(T,d,c,l,a,v,h){m.do(C.default.Post,T,d,c,l,a,v,h)},m.patch=function(T,d,c,l,a,v,h){m.do(C.default.Patch,T,d,c,l,a,v,h)},m.put=function(T,d,c,l,a,v,h){m.do(C.default.Put,T,d,c,l,a,v,h)},m.do=function(T,d,c,l,a,v,h,O){p.default.shouldLog(p.default.LOG_MICRO)&&(O=P(O,T,c,v)),h&&(O=O&&u(O,h),(v=v||{}).envelope=h);function k(D,_){var x;if(p.default.shouldLog(p.default.LOG_MICRO)&&p.default.logAction(p.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(c,_)),p.default.shouldLog(p.default.LOG_MICRO)){var b=l;if(((x=D["content-type"])===null||x===void 0?void 0:x.indexOf("msgpack"))>0)try{b=o.default.Config.msgpack.decode(l)}catch(S){p.default.logAction(p.default.LOG_MICRO,"Resource."+T+"()","Sending MsgPack Decoding Error: "+f.inspectError(S))}p.default.logAction(p.default.LOG_MICRO,"Resource."+T+"()","Sending; "+R(c,_)+"; Body: "+b)}d.http.do(T,d,c,D,l,_,function(S,L,U,j,$){if(S&&g.default.isTokenErr(S)){d.auth.authorize(null,null,function(V){if(V){O(V);return}I(d,D,_,O,k)});return}O(S,L,U,j,$)})}I(d,a,v,O,k)},m}();t.default=y},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),f=s.__importDefault(i(3)),p=s.__importDefault(i(9)),g=s.__importStar(i(1));function C(A){return E.Actions.indexOf(A)}var E=function(){function A(){}return A.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},A.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var I=this.id.split(":");return{connectionId:I[0],msgSerial:parseInt(I[1],10),index:parseInt(I[2],10)}},A.prototype.toJSON=function(){var I=this.data,u=this.encoding;return I&&f.default.BufferUtils.isBuffer(I)&&(arguments.length>0?(u=u?u+"/base64":"base64",I=f.default.BufferUtils.base64Encode(I)):I=f.default.BufferUtils.toBuffer(I)),{id:this.id,clientId:this.clientId,action:C(this.action),data:I,encoding:u,extras:this.extras}},A.prototype.toString=function(){var I="[PresenceMessage";return I+="; action="+this.action,this.id&&(I+="; id="+this.id),this.timestamp&&(I+="; timestamp="+this.timestamp),this.clientId&&(I+="; clientId="+this.clientId),this.connectionId&&(I+="; connectionId="+this.connectionId),this.encoding&&(I+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?I+="; data="+this.data:f.default.BufferUtils.isBuffer(this.data)?I+="; data (buffer)="+f.default.BufferUtils.base64Encode(this.data):I+="; data (json)="+JSON.stringify(this.data)),this.extras&&(I+="; extras="+JSON.stringify(this.extras)),I+="]",I},A.fromResponseBody=function(I,u,w){var R=[];w&&(I=g.decodeBody(I,w));for(var P=0;P<I.length;P++){var y=R[P]=A.fromValues(I[P],!0);try{A.decode(y,u)}catch(m){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",m.toString())}}return R},A.fromValues=function(I,u){return u&&(I.action=A.Actions[I.action]),Object.assign(new A,I)},A.fromValuesArray=function(I){for(var u=I.length,w=new Array(u),R=0;R<u;R++)w[R]=A.fromValues(I[R]);return w},A.fromEncoded=function(I,u){var w=A.fromValues(I,!0);try{A.decode(w,u??{})}catch(R){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",R.toString())}return w},A.fromEncodedArray=function(I,u){return I.map(function(w){return A.fromEncoded(w,u)})},A.fromData=function(I){return I instanceof A?I:A.fromValues({data:I})},A.Actions=["absent","present","enter","leave","update"],A.encode=p.default.encode,A.decode=p.default.decode,A.getMessagesSize=p.default.getMessagesSize,A}();t.default=E},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),f=o.__importStar(i(1)),p=o.__importDefault(i(7)),g=o.__importStar(i(4)),C=o.__importDefault(i(2)),E=o.__importDefault(i(8)),A=o.__importDefault(i(22)),I=o.__importDefault(i(3));function u(h,O){return f.arrIn(f.allToLowerCase(f.keysArray(O)),"x-ably-errorcode")}function w(h,O){if(u(h,O))return h.error&&g.default.fromValues(h.error)}var R=function(){},P=0,y={},m=typeof s<"u"&&s.XDomainRequest;function T(){var h=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return h&&Number(h[1])}function d(){var h;return m&&(h=T())&&h===10}function c(h,O){return h.getResponseHeader&&h.getResponseHeader(O)}function l(h){return h.getResponseHeader&&(h.getResponseHeader("transfer-encoding")||!h.getResponseHeader("content-length"))}function a(h){for(var O=f.trim(h.getAllResponseHeaders()).split(`\r
`),k={},D=0;D<O.length;D++){var _=O[D].split(":").map(f.trim);k[_[0].toLowerCase()]=_[1]}return k}var v=function(h){o.__extends(O,h);function O(k,D,_,x,b,S,L){var U=h.call(this)||this;return _=_||{},_.rnd=f.cheapRandStr(),d()&&!_.envelope&&(_.envelope="json"),U.uri=k+f.toQueryString(_),U.headers=D||{},U.body=x,U.method=L?L.toUpperCase():f.isEmptyArg(x)?"GET":"POST",U.requestMode=b,U.timeouts=S,U.timedOut=!1,U.requestComplete=!1,U.id=String(++P),y[U.id]=U,U}return O.createRequest=function(k,D,_,x,b,S,L){var U=S||E.default.TIMEOUTS;return new O(k,D,f.copy(_),x,b,U,L)},O.prototype.complete=function(k,D,_,x,b){this.requestComplete||(this.requestComplete=!0,!k&&D&&this.emit("data",D),this.emit("complete",k,D,_,x,b),this.dispose())},O.prototype.abort=function(){this.dispose()},O.prototype.exec=function(){var k=this,D=this.headers,_=this.requestMode==A.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,x=this.timer=setTimeout(function(){k.timedOut=!0,S.abort()},_),b=this.method,S=this.xhr=new XMLHttpRequest,L=D.accept,U=this.body,j="text";if(L?L.indexOf("application/x-msgpack")===0&&(j="arraybuffer"):D.accept="application/json",U){var $=D["content-type"]||(D["content-type"]="application/json");$.indexOf("application/json")>-1&&typeof U!="string"&&(U=JSON.stringify(U))}S.open(b,this.uri,!0),S.responseType=j,"authorization"in D&&(S.withCredentials=!0);for(var V in D)S.setRequestHeader(V,D[V]);var H=function(Y,ie,fe,ve){var ce,Me=ie+" (event type: "+Y.type+")";!((ce=k==null?void 0:k.xhr)===null||ce===void 0)&&ce.statusText&&(Me+=", current statusText is "+k.xhr.statusText),C.default.logAction(C.default.LOG_ERROR,"Request.on"+Y.type+"()",Me),k.complete(new g.PartialErrorInfo(Me,fe,ve))};S.onerror=function(Y){H(Y,"XHR error occurred",null,400)},S.onabort=function(Y){k.timedOut?H(Y,"Request aborted due to request timeout expiring",null,408):H(Y,"Request cancelled",null,400)},S.ontimeout=function(Y){H(Y,"Request timed out",null,408)};var M,N,F,B=0,W=!1,J=function(){if(clearTimeout(x),F=N<400,N==204){k.complete(null,null,null,null,N);return}M=k.requestMode==A.default.REQ_RECV_STREAM&&F&&l(S)},Q=function(){var Y;try{var ie=c(S,"content-type"),fe=ie?ie.indexOf("application/json")>=0:S.responseType=="text";if(fe){var ve=S.responseType==="arraybuffer"?I.default.BufferUtils.utf8Decode(S.response):String(S.responseText);ve.length?Y=JSON.parse(ve):Y=ve,W=!0}else Y=S.response;Y.response!==void 0?(N=Y.statusCode,F=N<400,D=Y.headers,Y=Y.response):D=a(S)}catch(Me){k.complete(new g.PartialErrorInfo("Malformed response body from server: "+Me.message,null,400));return}if(F||f.isArray(Y)){k.complete(null,Y,D,W,N);return}var ce=w(Y,D);ce||(ce=new g.PartialErrorInfo("Error response received from server: "+N+" body was: "+I.default.Config.inspect(Y),null,N)),k.complete(ce,Y,D,W,N)};function X(){for(var Y=S.responseText,ie=Y.length-1,fe,ve;B<ie&&(fe=Y.indexOf(`
`,B))>-1;)ve=Y.slice(B,fe),B=fe+1,ee(ve)}var ee=function(Y){try{Y=JSON.parse(Y)}catch(ie){k.complete(new g.PartialErrorInfo("Malformed response body from server: "+ie.message,null,400));return}k.emit("data",Y)},re=function(){X(),k.streamComplete=!0,I.default.Config.nextTick(function(){k.complete()})};S.onreadystatechange=function(){var Y=S.readyState;Y<3||S.status!==0&&(N===void 0&&(N=S.status,N===1223&&(N=204),J()),Y==3&&M?X():Y==4&&(M?re():Q()))},S.send(U)},O.prototype.dispose=function(){var k=this.xhr;if(k){k.onreadystatechange=k.onerror=k.onabort=k.ontimeout=R,this.xhr=null;var D=this.timer;D&&(clearTimeout(D),this.timer=null),this.requestComplete||k.abort()}delete y[this.id]},O}(p.default);t.default=v}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),f=s.__importStar(i(1)),p=s.__importDefault(i(24)),g=s.__importDefault(i(4)),C=s.__importDefault(i(45)),E=i(11),A=s.__importDefault(i(19)),I=s.__importDefault(i(14)),u=s.__importDefault(i(3)),w=s.__importDefault(i(15)),R=Math.pow(2,17);function P(){}function y(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function m(_){return!!_.connection}function T(_){return f.isErrorInfoOrPartialErrorInfo(_)?(_.code||(_.statusCode===403?_.code=40300:(_.code=40170,_.statusCode=401)),_):new g.default(f.inspectError(_),_.code||40170,_.statusCode||401)}var d=function(_,x){if(u.default.Config.createHmac){var b=u.default.Config.createHmac("SHA256",x);return b.update(_),b.digest("base64")}return(0,E.stringify)((0,C.default)(_,x))};function c(_){if(!_)return"";typeof _=="string"&&(_=JSON.parse(_));var x=Object.create(null),b=f.keysArray(_,!0);if(!b)return"";b.sort();for(var S=0;S<b.length;S++)x[b[S]]=_[b[S]].sort();return JSON.stringify(x)}function l(_){if(_.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(_.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(_.key)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(_.tokenDetails)o.default.logAction(o.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var x="authOptions must include valid authentication parameters";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",x),new Error(x)}}function a(_){return"useTokenAuth"in _&&!_.useTokenAuth}function v(_){return _.useTokenAuth||!a(_)&&(_.authCallback||_.authUrl||_.token||_.tokenDetails)}function h(_){return!_.key&&!_.authCallback&&!_.authUrl}var O=0;function k(){return O++}var D=function(){function _(x,b){if(this.authOptions={},this.client=x,this.tokenParams=b.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,v(b)){if(b.key&&!d){var S="client-side token request signing not supported";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",S),new Error(S)}h(b)&&o.default.logAction(o.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(b.defaultTokenParams,b),l(this.authOptions)}else{if(!b.key){var S="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw o.default.logAction(o.default.LOG_ERROR,"Auth()",S),new g.default(S,40160,401)}o.default.logAction(o.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(b)}}return _.prototype.authorize=function(x,b,S){var L=this,U;if(typeof x=="function"&&!S?(S=x,U=x=null):typeof b=="function"&&!S?(S=b,U=null):U=b,!S&&this.client.options.promises)return f.promisify(this,"authorize",arguments);if(U&&U.key&&this.authOptions.key!==U.key)throw new g.default("Unable to update auth options with incompatible key",40102,401);U&&"force"in U&&(o.default.deprecated("The `force` auth option","If youre using this option to force `authorize()` to fetch a new token even if the current token has not expired, this is no longer necessary, as `authorize()` now always fetches a new token. Update your code to no longer pass the `force` auth option. Note that, in general, passing an auth options argument to `authorize()` will overwrite the librarys stored auth options, which may not be what you want. The library currently contains a special case behavior where passing an auth options object which only contains `{ force: true }` will _not_ overwrite the stored options. This special case behavior will be removed alongside support for the `force` option, so if youre currently passing `authorize()` an auth options object which only contains `{ force: true }`, you should stop passing it an auth options object entirely."),f.isOnlyPropIn(U,"force")&&(U=null)),this._forceNewToken(x,U,function(j,$){if(j){L.client.connection&&j.statusCode===I.default.Forbidden&&L.client.connection.connectionManager.actOnErrorFromAuthorize(j),S==null||S(j);return}m(L.client)?L.client.connection.connectionManager.onAuthUpdated($,S||P):S==null||S(null,$)})},_.prototype.authorise=function(x,b,S){o.default.renamedMethod("Auth","authorise","authorize"),this.authorize(x,b,S)},_.prototype._forceNewToken=function(x,b,S){var L=this;this.tokenDetails=null,this._saveTokenOptions(x,b),l(this.authOptions),this._ensureValidAuthCredentials(!0,function(U,j){delete L.tokenParams.timestamp,delete L.authOptions.queryTime,S(U,j)})},_.prototype.requestToken=function(x,b,S){var L=this;if(typeof x=="function"&&!S?(S=x,b=x=null):typeof b=="function"&&!S&&(S=b,b=null),!S&&this.client.options.promises)return f.promisify(this,"requestToken",arguments);b=b||this.authOptions,x=x||f.copy(this.tokenParams);var U=S||P,j,$=this.client;if(b.authCallback)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),j=b.authCallback;else if(b.authUrl)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),j=function(B,W){var J=f.mixin({accept:"application/json, text/plain"},b.authHeaders),Q=b.authMethod&&b.authMethod.toLowerCase()==="post",X,ee=b.authUrl.indexOf("?");ee>-1&&(X=f.parseQueryString(b.authUrl.slice(ee)),b.authUrl=b.authUrl.slice(0,ee),Q||(b.authParams=f.mixin(X,b.authParams)));var re=f.mixin({},b.authParams||{},B),Y=function(ve,ce,Me,st){var Re;if(ve?o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+f.inspectError(ve)):(Re=Me["content-type"],o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+Re+"; body: "+f.inspectBody(ce))),ve||st)return W(ve,ce);if(u.default.BufferUtils.isBuffer(ce)&&(ce=ce.toString()),!Re){W(new g.default("authUrl response is missing a content-type header",40170,401));return}var at=Re.indexOf("application/json")>-1,jt=Re.indexOf("text/plain")>-1||Re.indexOf("application/jwt")>-1;if(!at&&!jt){W(new g.default("authUrl responded with unacceptable content-type "+Re+", should be either text/plain, application/jwt or application/json",40170,401));return}if(at){if(ce.length>R){W(new g.default("authUrl response exceeded max permitted length",40170,401));return}try{ce=JSON.parse(ce)}catch(Bt){W(new g.default("Unexpected error processing authURL response; err = "+Bt.message,40170,401));return}}W(null,ce,Re)};if(o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+b.authUrl+"; Params: "+JSON.stringify(re)+"; method: "+(Q?"POST":"GET")),Q){var ie=J||{};ie["content-type"]="application/x-www-form-urlencoded";var fe=f.toQueryString(re).slice(1);L.client.http.doUri(A.default.Post,$,b.authUrl,ie,fe,X,Y)}else L.client.http.doUri(A.default.Get,$,b.authUrl,J||{},null,re,Y)};else if(b.key)o.default.logAction(o.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),j=function(B,W){L.createTokenRequest(B,b,W)};else{var V="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";o.default.logAction(o.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),U(new g.default(V,40171,403));return}"capability"in x&&(x.capability=c(x.capability));var H=function(B,W){var J=B.keyName,Q="/keys/"+J+"/requestToken",X=function(re){return $.baseUri(re)+Q},ee=f.defaultPostHeaders(L.client.options);b.requestHeaders&&f.mixin(ee,b.requestHeaders),o.default.logAction(o.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+Q+"; Token params: "+JSON.stringify(B)),L.client.http.do(A.default.Post,$,X,ee,JSON.stringify(B),null,W)},M=!1,N=this.client.options.timeouts.realtimeRequestTimeout,F=setTimeout(function(){M=!0;var B="Token request callback timed out after "+N/1e3+" seconds";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",B),U(new g.default(B,40170,401))},N);j(x,function(B,W,J){if(!M){if(clearTimeout(F),B){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+f.inspectError(B)),U(T(B));return}if(typeof W=="string"){W.length===0?U(new g.default("Token string is empty",40170,401)):W.length>R?U(new g.default("Token string exceeded max permitted length (was "+W.length+" bytes)",40170,401)):W==="undefined"||W==="null"?U(new g.default("Token string was literal null/undefined",40170,401)):W[0]==="{"&&!(J&&J.indexOf("application/jwt")>-1)?U(new g.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):U(null,{token:W});return}if(typeof W!="object"){var Q="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof W;o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),U(new g.default(Q,40170,401));return}var X=JSON.stringify(W).length;if(X>R&&!b.suppressMaxLengthCheck){U(new g.default("Token request/details object exceeded max permitted stringified size (was "+X+" bytes)",40170,401));return}if("issued"in W){U(null,W);return}if(!("keyName"in W)){var Q="Expected token request callback to call back with a token string, token request object, or token details object";o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()",Q),U(new g.default(Q,40170,401));return}H(W,function(ee,re,Y,ie){if(ee){o.default.logAction(o.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+f.inspectError(ee)),U(T(ee));return}ie||(re=JSON.parse(re)),o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","token received"),U(null,re)})}})},_.prototype.createTokenRequest=function(x,b,S){var L=this;if(typeof x=="function"&&!S?(S=x,b=x=null):typeof b=="function"&&!S&&(S=b,b=null),!S&&this.client.options.promises)return f.promisify(this,"createTokenRequest",arguments);b=b||this.authOptions,x=x||f.copy(this.tokenParams);var U=b.key;if(!U){S(new g.default("No key specified",40101,403));return}var j=U.split(":"),$=j[0],V=j[1];if(!V){S(new g.default("Invalid key specified",40101,403));return}if(x.clientId===""){S(new g.default("clientId cant be an empty string",40012,400));return}"capability"in x&&(x.capability=c(x.capability));var H=f.mixin({keyName:$},x),M=x.clientId||"",N=x.ttl||"",F=x.capability||"";(function(B){if(H.timestamp){B();return}L.getTimestamp(b&&b.queryTime,function(W,J){if(W){S(W);return}H.timestamp=J,B()})})(function(){var B=H.nonce||(H.nonce=y()),W=H.timestamp,J=H.keyName+`
`+N+`
`+F+`
`+M+`
`+W+`
`+B+`
`;H.mac=H.mac||d(J,V),o.default.logAction(o.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),S(null,H)})},_.prototype.getAuthParams=function(x){this.method=="basic"?x(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(b,S){if(b){x(b);return}if(!S)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");x(null,{access_token:S.token})})},_.prototype.getAuthHeaders=function(x){this.method=="basic"?x(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(b,S){if(b){x(b);return}if(!S)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");x(null,{authorization:"Bearer "+f.toBase64(S.token)})})},_.prototype.getTimestamp=function(x,b){!this.isTimeOffsetSet()&&(x||this.authOptions.queryTime)?this.client.time(b):b(null,this.getTimestampUsingOffset())},_.prototype.getTimestampUsingOffset=function(){return f.now()+(this.client.serverTimeOffset||0)},_.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},_.prototype._saveBasicOptions=function(x){this.method="basic",this.key=x.key,this.basicKey=f.toBase64(x.key),this.authOptions=x||{},"clientId"in x&&this._userSetClientId(x.clientId)},_.prototype._saveTokenOptions=function(x,b){this.method="token",x&&(this.tokenParams=x),b&&(b.token&&(b.tokenDetails=typeof b.token=="string"?{token:b.token}:b.token),b.tokenDetails&&(this.tokenDetails=b.tokenDetails),"clientId"in b&&this._userSetClientId(b.clientId),this.authOptions=b)},_.prototype._ensureValidAuthCredentials=function(x,b){var S=this,L=this.tokenDetails;if(L){if(this._tokenClientIdMismatch(L.clientId)){b(new g.default("Mismatch between clientId in token ("+L.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!L.expires||L.expires>=this.getTimestampUsingOffset()){o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+L.expires),b(null,L);return}o.default.logAction(o.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=p.default.create())).push(b),!(this.currentTokenRequestId!==null&&!x)){var U=this.currentTokenRequestId=k();this.requestToken(this.tokenParams,this.authOptions,function(j,$){if(S.currentTokenRequestId>U){o.default.logAction(o.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}S.currentTokenRequestId=null;var V=S.waitingForTokenRequest||P;if(S.waitingForTokenRequest=null,j){V(j);return}V(null,S.tokenDetails=$)})}},_.prototype._userSetClientId=function(x){if(typeof x=="string"||x===null){if(x==="*")throw new g.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var b=this._uncheckedSetClientId(x);if(b)throw b}else throw new g.default("clientId must be either a string or null",40012,400)},_.prototype._uncheckedSetClientId=function(x){if(this._tokenClientIdMismatch(x)){var b="Unexpected clientId mismatch: client has "+this.clientId+", requested "+x,S=new g.default(b,40102,401);return o.default.logAction(o.default.LOG_ERROR,"Auth._uncheckedSetClientId()",b),S}else return this.clientId=this.tokenParams.clientId=x,null},_.prototype._tokenClientIdMismatch=function(x){return!!(this.clientId&&this.clientId!=="*"&&x&&x!=="*"&&this.clientId!==x)},_.isTokenErr=function(x){return x.code&&x.code>=40140&&x.code<40150},_.prototype.revokeTokens=function(x,b,S){if(v(this.client.options))throw new g.default("Cannot revoke tokens when using token auth",40162,401);var L=this.client.options.keyName,U;if(typeof b=="function"?(S=b,U={}):U=b??{},S===void 0){if(this.client.options.promises)return f.promisify(this,"revokeTokens",[x,U]);S=P}var j=S,$=s.__assign({targets:x.map(function(N){return"".concat(N.type,":").concat(N.value)})},U),V=this.client.options.useBinaryProtocol?f.Format.msgpack:f.Format.json,H=f.defaultPostHeaders(this.client.options,V);this.client.options.headers&&f.mixin(H,this.client.options.headers);var M=f.encodeBody($,V);w.default.post(this.client,"/keys/".concat(L,"/revokeTokens"),M,H,{newBatchResponse:"true"},null,function(N,F,B,W){if(N){j(N);return}var J=W?F:f.decodeBody(F,V);j(null,J)})},_}();t.default=D},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.Get="get",o.Delete="delete",o.Post="post",o.Put="put",o.Patch="patch"})(s||(s={})),t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.HttpPaginatedResponse=t.PaginatedResult=void 0;var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(2)),p=s.__importDefault(i(15)),g=s.__importDefault(i(14));function C(R){var P=R.match(/^\.\/(\w+)\?(.*)$/);return P&&P[2]&&o.parseQueryString(P[2])}function E(R){typeof R=="string"&&(R=R.split(","));for(var P={},y=0;y<R.length;y++){var m=R[y].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(m){var T=C(m[1]);T&&(P[m[2]]=T)}}return P}function A(R,P,y){return!(y&&(P||typeof R.code=="number"))}var I=function(){function R(P,y,m,T,d,c){this.rest=P,this.path=y,this.headers=m,this.envelope=T??null,this.bodyHandler=d,this.useHttpPaginatedResponse=c||!1}return R.prototype.get=function(P,y){var m=this;p.default.get(this.rest,this.path,this.headers,P,this.envelope,function(T,d,c,l,a){m.handlePage(T,d,c,l,a,y)})},R.prototype.delete=function(P,y){var m=this;p.default.delete(this.rest,this.path,this.headers,P,this.envelope,function(T,d,c,l,a){m.handlePage(T,d,c,l,a,y)})},R.prototype.post=function(P,y,m){var T=this;p.default.post(this.rest,this.path,y,this.headers,P,this.envelope,function(d,c,l,a,v){m&&T.handlePage(d,c,l,a,v,m)})},R.prototype.put=function(P,y,m){var T=this;p.default.put(this.rest,this.path,y,this.headers,P,this.envelope,function(d,c,l,a,v){m&&T.handlePage(d,c,l,a,v,m)})},R.prototype.patch=function(P,y,m){var T=this;p.default.patch(this.rest,this.path,y,this.headers,P,this.envelope,function(d,c,l,a,v){m&&T.handlePage(d,c,l,a,v,m)})},R.prototype.handlePage=function(P,y,m,T,d,c){if(P&&A(P,y,this.useHttpPaginatedResponse)){f.default.logAction(f.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(P)),c==null||c(P);return}var l,a,v;try{l=d==g.default.NoContent?[]:this.bodyHandler(y,m||{},T)}catch(h){c==null||c(P||h);return}m&&(a=m.Link||m.link)&&(v=E(a)),this.useHttpPaginatedResponse?c(null,new w(this,l,m||{},d,v,P)):c(null,new u(this,l,v))},R}(),u=function(){function R(P,y,m){var T=this;this.resource=P,this.items=y;var d=this;m&&("first"in m&&(this.first=function(c){if(!c&&d.resource.rest.options.promises)return o.promisify(d,"first",[]);d.get(m.first,c)}),"current"in m&&(this.current=function(c){if(!c&&d.resource.rest.options.promises)return o.promisify(d,"current",[]);d.get(m.current,c)}),this.next=function(c){if(!c&&d.resource.rest.options.promises)return o.promisify(d,"next",[]);"next"in m?d.get(m.next,c):c(null,null)},this.hasNext=function(){return"next"in m},this.isLast=function(){var c;return!(!((c=T.hasNext)===null||c===void 0)&&c.call(T))})}return R.prototype.get=function(P,y){var m=this.resource;p.default.get(m.rest,m.path,m.headers,P,m.envelope,function(T,d,c,l,a){m.handlePage(T,d,c,l,a,y)})},R}();t.PaginatedResult=u;var w=function(R){s.__extends(P,R);function P(y,m,T,d,c,l){var a=R.call(this,y,m,c)||this;return a.statusCode=d,a.success=d<300&&d>=200,a.headers=T,a.errorCode=l&&l.code,a.errorMessage=l&&l.message,a}return P.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},P}(u);t.HttpPaginatedResponse=w,t.default=I},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isRetriable=void 0;var s=i(0),o=s.__importDefault(i(4)),f={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},p={disconnected:function(){return o.default.fromValues({statusCode:400,code:f.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return o.default.fromValues({statusCode:400,code:f.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return o.default.fromValues({statusCode:400,code:f.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return o.default.fromValues({statusCode:400,code:f.CLOSING,message:"Connection closing"})},closed:function(){return o.default.fromValues({statusCode:400,code:f.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return o.default.fromValues({statusCode:500,code:f.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return o.default.fromValues({statusCode:500,code:f.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function g(C){return!C.statusCode||!C.code||C.statusCode>=500?!0:Object.values(f).includes(C.code)}t.isRetriable=g,t.default=p},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o[o.REQ_SEND=0]="REQ_SEND",o[o.REQ_RECV=1]="REQ_RECV",o[o.REQ_RECV_POLL=2]="REQ_RECV_POLL",o[o.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(s||(s={})),t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6),i(5),i(58),i(11),i(40),i(32),i(25),i(27),i(28),i(59),i(60))})(this,function(s){return s})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(2)),f=function(){function p(g){this.members=g||[]}return p.prototype.call=function(){for(var g=[],C=0;C<arguments.length;C++)g[C]=arguments[C];for(var E=0,A=this.members;E<A.length;E++){var I=A[E];if(I)try{I.apply(void 0,g)}catch(u){o.default.logAction(o.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+u+"; stack = "+u.stack)}}},p.prototype.push=function(){for(var g,C=[],E=0;E<arguments.length;E++)C[E]=arguments[E];(g=this.members).push.apply(g,C)},p.create=function(g){var C=new p(g);return Object.assign(function(){for(var E=[],A=0;A<arguments.length;A++)E[A]=arguments[A];return C.call.apply(C,E)},{push:function(E){return C.push(E)}})},p}();t.default=f},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){(function(){var o=s,f=o.lib,p=f.Base,g=o.enc,C=g.Utf8,E=o.algo;E.HMAC=p.extend({init:function(A,I){A=this._hasher=new A.init,typeof I=="string"&&(I=C.parse(I));var u=A.blockSize,w=u*4;I.sigBytes>w&&(I=A.finalize(I)),I.clamp();for(var R=this._oKey=I.clone(),P=this._iKey=I.clone(),y=R.words,m=P.words,T=0;T<u;T++)y[T]^=1549556828,m[T]^=909522486;R.sigBytes=P.sigBytes=w,this.reset()},reset:function(){var A=this._hasher;A.reset(),A.update(this._iKey)},update:function(A){return this._hasher.update(A),this},finalize:function(A){var I=this._hasher,u=I.finalize(A);I.reset();var w=I.finalize(this._oKey.clone().concat(u));return w}})})()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),f=s.__importStar(i(1)),p=s.__importDefault(i(7)),g=s.__importDefault(i(2)),C=s.__importDefault(i(21)),E=s.__importDefault(i(4)),A=s.__importDefault(i(3)),I=o.default.Action,u=o.default.fromValues({action:I.CLOSE}),w=o.default.fromValues({action:I.DISCONNECT}),R=function(P){s.__extends(y,P);function y(m,T,d,c){var l=P.call(this)||this;return c&&(d.format=void 0,d.heartbeats=!0),l.connectionManager=m,m.registerProposedTransport(l),l.auth=T,l.params=d,l.timeouts=d.options.timeouts,l.format=d.format,l.isConnected=!1,l.isFinished=!1,l.isDisposed=!1,l.maxIdleInterval=null,l.idleTimer=null,l.lastActivity=null,l}return y.prototype.connect=function(){},y.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",C.default.closed())},y.prototype.disconnect=function(m){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",m||C.default.disconnected())},y.prototype.fail=function(m){this.isConnected&&this.requestDisconnect(),this.finish("failed",m||C.default.failed())},y.prototype.finish=function(m,T){var d;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((d=this.idleTimer)!==null&&d!==void 0?d:void 0),this.idleTimer=null,this.emit(m,T),this.dispose())},y.prototype.onProtocolMessage=function(m){switch(g.default.shouldLog(g.default.LOG_MICRO)&&g.default.logAction(g.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(m)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),m.action){case I.HEARTBEAT:g.default.logAction(g.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",m.id);break;case I.CONNECTED:this.onConnect(m),this.emit("connected",m.error,m.connectionId,m.connectionDetails,m);break;case I.CLOSED:this.onClose(m);break;case I.DISCONNECTED:this.onDisconnect(m);break;case I.ACK:this.emit("ack",m.msgSerial,m.count);break;case I.NACK:this.emit("nack",m.msgSerial,m.count,m.error);break;case I.SYNC:this.connectionManager.onChannelMessage(m,this);break;case I.ACTIVATE:break;case I.AUTH:this.auth.authorize(function(T){T&&g.default.logAction(g.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+f.inspectError(T))});break;case I.ERROR:if(g.default.logAction(g.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+A.default.Config.inspect(m.error)+(m.channel?", channel: "+m.channel:"")),m.channel===void 0){this.onFatalError(m);break}this.connectionManager.onChannelMessage(m,this);break;default:this.connectionManager.onChannelMessage(m,this)}},y.prototype.onConnect=function(m){if(this.isConnected=!0,!m.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var T=m.connectionDetails.maxIdleInterval;T&&(this.maxIdleInterval=T+this.timeouts.realtimeRequestTimeout,this.onActivity())},y.prototype.onDisconnect=function(m){var T=m&&m.error;g.default.logAction(g.default.LOG_MINOR,"Transport.onDisconnect()","err = "+f.inspectError(T)),this.finish("disconnected",T)},y.prototype.onFatalError=function(m){var T=m&&m.error;g.default.logAction(g.default.LOG_MINOR,"Transport.onFatalError()","err = "+f.inspectError(T)),this.finish("failed",T)},y.prototype.onClose=function(m){var T=m&&m.error;g.default.logAction(g.default.LOG_MINOR,"Transport.onClose()","err = "+f.inspectError(T)),this.finish("closed",T)},y.prototype.requestClose=function(){g.default.logAction(g.default.LOG_MINOR,"Transport.requestClose()",""),this.send(u)},y.prototype.requestDisconnect=function(){g.default.logAction(g.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(w)},y.prototype.ping=function(m){var T={action:o.default.Action.HEARTBEAT};m&&(T.id=m),this.send(o.default.fromValues(T))},y.prototype.dispose=function(){g.default.logAction(g.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},y.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=f.now(),this.setIdleTimer(this.maxIdleInterval+100))},y.prototype.setIdleTimer=function(m){var T=this;this.idleTimer||(this.idleTimer=setTimeout(function(){T.onIdleTimerExpire()},m))},y.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var m=f.now()-this.lastActivity,T=this.maxIdleInterval-m;if(T<=0){var d="No activity seen from realtime in "+m+"ms; assuming connection has dropped";g.default.logAction(g.default.LOG_ERROR,"Transport.onIdleTimerExpire()",d),this.disconnect(new E.default(d,80003,408))}else this.setIdleTimer(T+100)},y.tryConnect=function(m,T,d,c,l){var a=new m(T,d,c),v,h=function(k){clearTimeout(v),l({event:this.event,error:k})},O=T.options.timeouts.realtimeRequestTimeout;v=setTimeout(function(){a.off(["preconnect","disconnected","failed"]),a.dispose(),h.call({event:"disconnected"},new E.default("Timeout waiting for transport to indicate itself viable",5e4,500))},O),a.on(["failed","disconnected"],h),a.on("preconnect",function(){g.default.logAction(g.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+a),clearTimeout(v),a.off(["failed","disconnected"],h),l(null,a)}),a.connect()},y}(p.default);t.default=R},function(n,t,i){(function(s,o){n.exports=o(i(6),i(40),i(25))})(this,function(s){return function(){var o=s,f=o.lib,p=f.Base,g=f.WordArray,C=o.algo,E=C.MD5,A=C.EvpKDF=p.extend({cfg:p.extend({keySize:128/32,hasher:E,iterations:1}),init:function(I){this.cfg=this.cfg.extend(I)},compute:function(I,u){for(var w,R=this.cfg,P=R.hasher.create(),y=g.create(),m=y.words,T=R.keySize,d=R.iterations;m.length<T;){w&&P.update(w),w=P.update(I).finalize(u),P.reset();for(var c=1;c<d;c++)w=P.finalize(w),P.reset();y.concat(w)}return y.sigBytes=T*4,y}});o.EvpKDF=function(I,u,w){return A.create(w).compute(I,u)}}(),s.EvpKDF})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(27))})(this,function(s){s.lib.Cipher||function(o){var f=s,p=f.lib,g=p.Base,C=p.WordArray,E=p.BufferedBlockAlgorithm,A=f.enc;A.Utf8;var I=A.Base64,u=f.algo,w=u.EvpKDF,R=p.Cipher=E.extend({cfg:g.extend(),createEncryptor:function(D,_){return this.create(this._ENC_XFORM_MODE,D,_)},createDecryptor:function(D,_){return this.create(this._DEC_XFORM_MODE,D,_)},init:function(D,_,x){this.cfg=this.cfg.extend(x),this._xformMode=D,this._key=_,this.reset()},reset:function(){E.reset.call(this),this._doReset()},process:function(D){return this._append(D),this._process()},finalize:function(D){D&&this._append(D);var _=this._doFinalize();return _},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function D(_){return typeof _=="string"?k:v}return function(_){return{encrypt:function(x,b,S){return D(b).encrypt(_,x,b,S)},decrypt:function(x,b,S){return D(b).decrypt(_,x,b,S)}}}}()});p.StreamCipher=R.extend({_doFinalize:function(){var D=this._process(!0);return D},blockSize:1});var P=f.mode={},y=p.BlockCipherMode=g.extend({createEncryptor:function(D,_){return this.Encryptor.create(D,_)},createDecryptor:function(D,_){return this.Decryptor.create(D,_)},init:function(D,_){this._cipher=D,this._iv=_}}),m=P.CBC=function(){var D=y.extend();D.Encryptor=D.extend({processBlock:function(x,b){var S=this._cipher,L=S.blockSize;_.call(this,x,b,L),S.encryptBlock(x,b),this._prevBlock=x.slice(b,b+L)}}),D.Decryptor=D.extend({processBlock:function(x,b){var S=this._cipher,L=S.blockSize,U=x.slice(b,b+L);S.decryptBlock(x,b),_.call(this,x,b,L),this._prevBlock=U}});function _(x,b,S){var L,U=this._iv;U?(L=U,this._iv=o):L=this._prevBlock;for(var j=0;j<S;j++)x[b+j]^=L[j]}return D}(),T=f.pad={},d=T.Pkcs7={pad:function(D,_){for(var x=_*4,b=x-D.sigBytes%x,S=b<<24|b<<16|b<<8|b,L=[],U=0;U<b;U+=4)L.push(S);var j=C.create(L,b);D.concat(j)},unpad:function(D){var _=D.words[D.sigBytes-1>>>2]&255;D.sigBytes-=_}};p.BlockCipher=R.extend({cfg:R.cfg.extend({mode:m,padding:d}),reset:function(){var D;R.reset.call(this);var _=this.cfg,x=_.iv,b=_.mode;this._xformMode==this._ENC_XFORM_MODE?D=b.createEncryptor:(D=b.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==D?this._mode.init(this,x&&x.words):(this._mode=D.call(b,this,x&&x.words),this._mode.__creator=D)},_doProcessBlock:function(D,_){this._mode.processBlock(D,_)},_doFinalize:function(){var D,_=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(_.pad(this._data,this.blockSize),D=this._process(!0)):(D=this._process(!0),_.unpad(D)),D},blockSize:128/32});var c=p.CipherParams=g.extend({init:function(D){this.mixIn(D)},toString:function(D){return(D||this.formatter).stringify(this)}}),l=f.format={},a=l.OpenSSL={stringify:function(D){var _,x=D.ciphertext,b=D.salt;return b?_=C.create([1398893684,1701076831]).concat(b).concat(x):_=x,_.toString(I)},parse:function(D){var _,x=I.parse(D),b=x.words;return b[0]==1398893684&&b[1]==1701076831&&(_=C.create(b.slice(2,4)),b.splice(0,4),x.sigBytes-=16),c.create({ciphertext:x,salt:_})}},v=p.SerializableCipher=g.extend({cfg:g.extend({format:a}),encrypt:function(D,_,x,b){b=this.cfg.extend(b);var S=D.createEncryptor(x,b),L=S.finalize(_),U=S.cfg;return c.create({ciphertext:L,key:x,iv:U.iv,algorithm:D,mode:U.mode,padding:U.padding,blockSize:D.blockSize,formatter:b.format})},decrypt:function(D,_,x,b){b=this.cfg.extend(b),_=this._parse(_,b.format);var S=D.createDecryptor(x,b).finalize(_.ciphertext);return S},_parse:function(D,_){return typeof D=="string"?_.parse(D,this):D}}),h=f.kdf={},O=h.OpenSSL={execute:function(D,_,x,b){b||(b=C.random(64/8));var S=w.create({keySize:_+x}).compute(D,b),L=C.create(S.words.slice(_),x*4);return S.sigBytes=_*4,c.create({key:S,iv:L,salt:b})}},k=p.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:O}),encrypt:function(D,_,x,b){b=this.cfg.extend(b);var S=b.kdf.execute(x,D.keySize,D.ivSize);b.iv=S.iv;var L=v.encrypt.call(this,D,_,S.key,b);return L.mixIn(S),L},decrypt:function(D,_,x,b){b=this.cfg.extend(b),_=this._parse(_,b.format);var S=b.kdf.execute(x,D.keySize,D.ivSize,_.salt);b.iv=S.iv;var L=v.decrypt.call(this,D,_,S.key,b);return L}})}()})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.createRequest=void 0;var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(12)),p=s.__importDefault(i(3)),g=s.__importDefault(i(7)),C=i(4),E=s.__importDefault(i(8)),A=s.__importDefault(i(2)),I=s.__importDefault(i(22)),u=o.getGlobalObject(),w=function(){},R=u._ablyjs_jsonp={};R._=function(l){return R["_"+l]||w};var P=1,y="jsonp";function m(l,a,v,h,O,k,D){return k=k||E.default.TIMEOUTS,new d(void 0,l,a,o.copy(v),h,O,k,D)}t.createRequest=m;var T=function(l){s.__extends(a,l);function a(v,h,O){var k=l.call(this,v,h,O)||this;return k.shortName=y,O.stream=!1,k}return a.isAvailable=function(){return p.default.Config.jsonpSupported&&p.default.Config.allowComet},a.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},a.prototype.createRequest=function(v,h,O,k,D,_,x){return _=(this===null||this===void 0?void 0:this.timeouts)||_||E.default.TIMEOUTS,m(v,h,O,k,D,_,x)},a}(f.default),d=function(l){s.__extends(a,l);function a(v,h,O,k,D,_,x,b){var S=l.call(this)||this;return v===void 0&&(v=P++),S.id=v,S.uri=h,S.params=k||{},S.params.rnd=o.cheapRandStr(),O&&(O["X-Ably-Version"]&&(S.params.v=O["X-Ably-Version"]),O["X-Ably-Lib"]&&(S.params.lib=O["X-Ably-Lib"])),S.body=D,S.method=b,S.requestMode=_,S.timeouts=x,S.requestComplete=!1,S}return a.prototype.exec=function(){var v=this,h=this.id,O=this.body,k=this.method,D=this.uri,_=this.params;_.callback="_ablyjs_jsonp._("+h+")",_.envelope="jsonp",O&&(_.body=O),k&&k!=="get"&&(_.method=k);var x=this.script=document.createElement("script"),b=D+o.toQueryString(_);x.src=b,x.src.split("/").slice(-1)[0]!==b.split("/").slice(-1)[0]&&A.default.logAction(A.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),x.async=!0,x.type="text/javascript",x.charset="UTF-8",x.onerror=function(U){v.complete(new C.PartialErrorInfo("JSONP script error (event: "+p.default.Config.inspect(U)+")",null,400))},R["_"+h]=function(U){if(U.statusCode){var j=U.response;if(U.statusCode==204)v.complete(null,null,null,U.statusCode);else if(!j)v.complete(new C.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(U.statusCode<400||o.isArray(j))v.complete(null,j,U.headers,U.statusCode);else{var $=j.error||new C.PartialErrorInfo("Error response received from server",null,U.statusCode);v.complete($)}}else v.complete(null,U)};var S=this.requestMode==I.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),S);var L=document.getElementsByTagName("head")[0];L.insertBefore(x,L.firstChild)},a.prototype.complete=function(v,h,O,k){if(O=O||{},!this.requestComplete){this.requestComplete=!0;var D=void 0;h&&(D=typeof h=="string"?"text/plain":"application/json",O["content-type"]=D,this.emit("data",h)),this.emit("complete",v,h,O,!0,k),this.dispose()}},a.prototype.abort=function(){this.dispose()},a.prototype.dispose=function(){var v=this.timer;v&&(clearTimeout(v),this.timer=null);var h=this.script;h.parentNode&&h.parentNode.removeChild(h),delete R[this.id],this.emit("disposed")},a}(g.default);t.Request=d;function c(l){return u.JSONPTransport=T,T.isAvailable()&&(l.supportedTransports[y]=T),T}t.default=c},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(2)),p=s.__importDefault(i(8)),g=s.__importDefault(i(18)),C=s.__importDefault(i(46)),E=s.__importDefault(i(20)),A=s.__importDefault(i(33)),I=s.__importDefault(i(4)),u=s.__importDefault(i(49)),w=s.__importDefault(i(19)),R=s.__importDefault(i(3)),P=s.__importDefault(i(9)),y=s.__importDefault(i(16)),m=s.__importDefault(i(15)),T=function(){},d=function(){function l(a){if(!a){var v="no options provided";throw f.default.logAction(f.default.LOG_ERROR,"Rest()",v),new Error(v)}var h=p.default.objectifyOptions(a);h.log?(f.default.setLog(h.log.level,h.log.handler),f.default.deprecated("The `log` client option","Equivalent functionality is provided by the `logLevel` and `logHandler` client options. Update your client options code of the form `{ log: { level: logLevel, handler: logHandler } }` to instead be `{ logLevel, logHandler }`.")):f.default.setLog(h.logLevel,h.logHandler),f.default.logAction(f.default.LOG_MICRO,"Rest()","initialized with clientOptions "+R.default.Config.inspect(a));var O=this.options=p.default.normaliseOptions(h);if(O.key){var k=O.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!k){var v="invalid key parameter";throw f.default.logAction(f.default.LOG_ERROR,"Rest()",v),new I.default(v,40400,404)}O.keyName=k[1],O.keySecret=k[2]}if("clientId"in O)if(typeof O.clientId=="string"||O.clientId===null){if(O.clientId==="*")throw new I.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new I.default("clientId must be either a string or null",40012,400);f.default.logAction(f.default.LOG_MINOR,"Rest()","started; version = "+p.default.version),this.baseUri=this.authority=function(D){return p.default.getHttpScheme(O)+D+":"+p.default.getPort(O,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new R.default.Http(O),this.auth=new g.default(this,O),this.channels=new c(this),this.push=new C.default(this)}return l.prototype.stats=function(a,v){if(v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.options.promises)return o.promisify(this,"stats",[a]);v=T}var h=o.defaultGetHeaders(this.options),O=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,k=this.http.supportsLinkHeaders?void 0:O;this.options.headers&&o.mixin(h,this.options.headers),new E.default(this,"/stats",h,k,function(D,_,x){for(var b=x?D:JSON.parse(D),S=0;S<b.length;S++)b[S]=u.default.fromValues(b[S]);return b}).get(a,v)},l.prototype.time=function(a,v){var h=this;if(v===void 0){if(typeof a=="function")v=a,a=null;else if(this.options.promises)return o.promisify(this,"time",[a])}var O=v||T,k=o.defaultGetHeaders(this.options);this.options.headers&&o.mixin(k,this.options.headers);var D=function(_){return h.authority(_)+"/time"};this.http.do(w.default.Get,this,D,k,null,a,function(_,x,b,S){if(_){O(_);return}S||(x=JSON.parse(x));var L=x[0];if(!L){O(new I.default("Internal error (unexpected result type from GET /time)",5e4,500));return}h.serverTimeOffset=L-o.now(),O(null,L)})},l.prototype.request=function(a,v,h,O,k,D){var _=this.options.useBinaryProtocol,x=_?R.default.Config.msgpack.encode:JSON.stringify,b=_?R.default.Config.msgpack.decode:JSON.parse,S=_?o.Format.msgpack:o.Format.json,L=this.http.supportsLinkHeaders?void 0:S;h=h||{};var U=a.toLowerCase(),j=U=="get"?o.defaultGetHeaders(this.options,S):o.defaultPostHeaders(this.options,S);if(D===void 0){if(this.options.promises)return o.promisify(this,"request",[a,v,h,O,k]);D=T}typeof O!="string"&&(O=x(O)),this.options.headers&&o.mixin(j,this.options.headers),k&&o.mixin(j,k);var $=new E.default(this,v,j,L,function(V,H,M){return o.ensureArray(M?V:b(V))},!0);if(!o.arrIn(R.default.Http.methods,U))throw new I.default("Unsupported method "+U,40500,405);o.arrIn(R.default.Http.methodsWithBody,U)?$[U](h,O,D):$[U](h,D)},l.prototype.batchPublish=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPublish",[a]);v=T}var h=v,O,k;o.isArray(a)?(O=a,k=!1):(O=[a],k=!0);var D=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,_=o.defaultPostHeaders(this.options,D);this.options.headers&&o.mixin(_,this.options.headers);var x=o.encodeBody(O,D);m.default.post(this,"/messages",x,_,{newBatchResponse:"true"},null,function(b,S,L,U){if(b){h(b);return}var j=U?S:o.decodeBody(S,D);k?h(null,j[0]):h(null,j)})},l.prototype.batchPresence=function(a,v){if(v===void 0){if(this.options.promises)return o.promisify(this,"batchPresence",[a]);v=T}var h=v,O=this.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,k=o.defaultPostHeaders(this.options,O);this.options.headers&&o.mixin(k,this.options.headers);var D=a.join(",");m.default.get(this,"/presence",k,{newBatchResponse:"true",channels:D},null,function(_,x,b,S){if(_){h(_);return}var L=S?x:o.decodeBody(x,O);h(null,L)})},l.prototype.setLog=function(a){f.default.setLog(a.level,a.handler)},l.Promise=function(a){return a=p.default.objectifyOptions(a),a.promises=!0,new l(a)},l.Callbacks=l,l.Platform=R.default,l.Message=P.default,l.PresenceMessage=y.default,l}(),c=function(){function l(a){this.rest=a,this.all=Object.create(null)}return l.prototype.get=function(a,v){a=String(a);var h=this.all[a];return h?v&&h.setOptions(v):this.all[a]=h=new A.default(this.rest,a,v),h},l.prototype.release=function(a){delete this.all[String(a)]},l}();t.default=d},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Utf8})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var f=s,p=f.lib,g=p.WordArray,C=p.Hasher,E=f.algo,A=[],I=[];(function(){function R(T){for(var d=o.sqrt(T),c=2;c<=d;c++)if(!(T%c))return!1;return!0}function P(T){return(T-(T|0))*4294967296|0}for(var y=2,m=0;m<64;)R(y)&&(m<8&&(A[m]=P(o.pow(y,1/2))),I[m]=P(o.pow(y,1/3)),m++),y++})();var u=[],w=E.SHA256=C.extend({_doReset:function(){this._hash=new g.init(A.slice(0))},_doProcessBlock:function(R,P){for(var y=this._hash.words,m=y[0],T=y[1],d=y[2],c=y[3],l=y[4],a=y[5],v=y[6],h=y[7],O=0;O<64;O++){if(O<16)u[O]=R[P+O]|0;else{var k=u[O-15],D=(k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3,_=u[O-2],x=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;u[O]=D+u[O-7]+x+u[O-16]}var b=l&a^~l&v,S=m&T^m&d^T&d,L=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),U=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),j=h+U+b+I[O]+u[O],$=L+S;h=v,v=a,a=l,l=c+j|0,c=d,d=T,T=m,m=j+$|0}y[0]=y[0]+m|0,y[1]=y[1]+T|0,y[2]=y[2]+d|0,y[3]=y[3]+c|0,y[4]=y[4]+l|0,y[5]=y[5]+a|0,y[6]=y[6]+v|0,y[7]=y[7]+h|0},_doFinalize:function(){var R=this._data,P=R.words,y=this._nDataBytes*8,m=R.sigBytes*8;return P[m>>>5]|=128<<24-m%32,P[(m+64>>>9<<4)+14]=o.floor(y/4294967296),P[(m+64>>>9<<4)+15]=y,R.sigBytes=P.length*4,this._process(),this._hash},clone:function(){var R=C.clone.call(this);return R._hash=this._hash.clone(),R}});f.SHA256=C._createHelper(w),f.HmacSHA256=C._createHmacHelper(w)}(Math),s.SHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(7)),p=s.__importDefault(i(2)),g=s.__importDefault(i(34)),C=s.__importDefault(i(9)),E=s.__importDefault(i(4)),A=s.__importDefault(i(20)),I=s.__importDefault(i(15)),u=s.__importDefault(i(3));function w(){}var R=9;function P(T){return o.arrEvery(T,function(d){return!d.id})}function y(T){var d=T||{};if(d.cipher){if(!u.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var c=u.default.Crypto.getCipher(d.cipher);d.cipher=c.cipherParams,d.channelCipher=c.cipher}else"cipher"in d&&(d.cipher=void 0,d.channelCipher=null);return d}var m=function(T){s.__extends(d,T);function d(c,l,a){var v=T.call(this)||this;return p.default.logAction(p.default.LOG_MINOR,"Channel()","started; name = "+l),v.rest=c,v.name=l,v.basePath="/channels/"+encodeURIComponent(l),v.presence=new g.default(v),v.channelOptions=y(a),v}return d.prototype.setOptions=function(c){this.channelOptions=y(c)},d.prototype.history=function(c,l){if(p.default.logAction(p.default.LOG_MICRO,"Channel.history()","channel = "+this.name),l===void 0)if(typeof c=="function")l=c,c=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);l=w}this._history(c,l)},d.prototype._history=function(c,l){var a=this.rest,v=a.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,h=this.rest.http.supportsLinkHeaders?void 0:v,O=o.defaultGetHeaders(a.options,v);a.options.headers&&o.mixin(O,a.options.headers);var k=this.channelOptions;new A.default(a,this.basePath+"/messages",O,h,function(D,_,x){return C.default.fromResponseBody(D,k,x?void 0:v)}).get(c,l)},d.prototype.publish=function(){var c=this,l=arguments.length,a=arguments[0],v=arguments[1],h=arguments[l-1],O,k;if(typeof h!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);h=w}if(typeof a=="string"||a===null)O=[C.default.fromValues({name:a,data:v})],k=arguments[2];else if(o.isObject(a))O=[C.default.fromValues(a)],k=arguments[1];else if(o.isArray(a))O=C.default.fromValuesArray(a),k=arguments[1];else throw new E.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof k!="object"||!k)&&(k={});var D=this.rest,_=D.options,x=_.useBinaryProtocol?o.Format.msgpack:o.Format.json,b=D.options.idempotentRestPublishing,S=o.defaultPostHeaders(D.options,x);if(_.headers&&o.mixin(S,_.headers),b&&P(O)){var L=o.randomString(R);o.arrForEach(O,function(U,j){U.id=L+":"+j.toString()})}C.default.encodeArray(O,this.channelOptions,function(U){if(U){h(U);return}var j=C.default.getMessagesSize(O),$=_.maxMessageSize;if(j>$){h(new E.default("Maximum size of messages that can be published at once exceeded ( was "+j+" bytes; limit is "+$+" bytes)",40009,400));return}c._publish(C.default.serialize(O,x),S,k,h)})},d.prototype._publish=function(c,l,a,v){I.default.post(this.rest,this.basePath+"/messages",c,l,a,null,v)},d.prototype.status=function(c){if(typeof c!="function"&&this.rest.options.promises)return o.promisify(this,"status",[]);var l=this.rest.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,a=o.defaultPostHeaders(this.rest.options,l);I.default.get(this.rest,this.basePath,a,{},l,c||w)},d}(f.default);t.default=m},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(7)),p=s.__importDefault(i(2)),g=s.__importDefault(i(20)),C=s.__importDefault(i(16));function E(){}var A=function(I){s.__extends(u,I);function u(w){var R=I.call(this)||this;return R.channel=w,R.basePath=w.basePath+"/presence",R}return u.prototype.get=function(w,R){if(p.default.logAction(p.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),R===void 0)if(typeof w=="function")R=w,w=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);R=E}var P=this.channel.rest,y=P.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:y,T=o.defaultGetHeaders(P.options,y);P.options.headers&&o.mixin(T,P.options.headers);var d=this.channel.channelOptions;new g.default(P,this.basePath,T,m,function(c,l,a){return C.default.fromResponseBody(c,d,a?void 0:y)}).get(w,R)},u.prototype.history=function(w,R){return p.default.logAction(p.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(w,R)},u.prototype._history=function(w,R){if(R===void 0)if(typeof w=="function")R=w,w=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",[w]);R=E}var P=this.channel.rest,y=P.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,m=this.channel.rest.http.supportsLinkHeaders?void 0:y,T=o.defaultGetHeaders(P.options,y);P.options.headers&&o.mixin(T,P.options.headers);var d=this.channel.channelOptions;new g.default(P,this.basePath+"/history",T,m,function(c,l,a){return C.default.fromResponseBody(c,d,a?void 0:y)}).get(w,R)},u}(f.default);t.default=A},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0}),t.TransportParams=void 0;var o=i(0),f=o.__importDefault(i(10)),p=o.__importStar(i(1)),g=o.__importStar(i(52)),C=o.__importStar(i(8)),E=o.__importDefault(i(3)),A=o.__importDefault(i(7)),I=o.__importDefault(i(36)),u=o.__importDefault(i(2)),w=o.__importDefault(i(37)),R=o.__importStar(i(21)),P=o.__importStar(i(4)),y=o.__importDefault(i(18)),m=o.__importDefault(i(9)),T=o.__importDefault(i(24)),d=o.__importDefault(i(53)),c=o.__importDefault(i(26)),l=o.__importDefault(i(14)),a=function(){var V;return typeof E.default.WebStorage<"u"&&((V=E.default.WebStorage)===null||V===void 0?void 0:V.localSupported)},v=function(){var V;return typeof E.default.WebStorage<"u"&&((V=E.default.WebStorage)===null||V===void 0?void 0:V.sessionSupported)},h=f.default.Action,O=function(){},k="ably-transport-preference",D="ably-connection-recovery";function _(){var V,H;return v()&&((H=(V=E.default.WebStorage)===null||V===void 0?void 0:V.getSession)===null||H===void 0?void 0:H.call(V,D))}function x(V){var H,M;return v()&&((M=(H=E.default.WebStorage)===null||H===void 0?void 0:H.setSession)===null||M===void 0?void 0:M.call(H,D,V))}function b(){var V,H;return v()&&((H=(V=E.default.WebStorage)===null||V===void 0?void 0:V.removeSession)===null||H===void 0?void 0:H.call(V,D))}function S(V,H){return p.arrIndexOf(E.default.Defaults.transportPreferenceOrder,V.shortName)>p.arrIndexOf(E.default.Defaults.transportPreferenceOrder,H.shortName)}function L(V,H,M){var N;if(V.channel!==H.channel||(N=V.action)!==h.PRESENCE&&N!==h.MESSAGE||N!==H.action)return!1;var F=N===h.PRESENCE?"presence":"messages",B=V[F].concat(H[F]),W=m.default.getMessagesSize(B);return W>M||!p.allSame(B,"clientId")||!p.arrEvery(B,function(J){return!J.id})?!1:(V[F]=B,!0)}function U(V){try{return JSON.parse(V)}catch{return null}}var j=function(){function V(H,M,N,F){this.options=H,this.host=M,this.mode=N,this.connectionKey=F,this.format=H.useBinaryProtocol?p.Format.msgpack:p.Format.json}return V.prototype.getConnectParams=function(H){var M=H?p.copy(H):{},N=this.options;switch(this.mode){case"upgrade":M.upgrade=this.connectionKey;break;case"resume":M.resume=this.connectionKey;break;case"recover":{var F=U(N.recover);F&&(M.recover=F.connectionKey);break}}return N.clientId!==void 0&&(M.clientId=N.clientId),N.echoMessages===!1&&(M.echo="false"),this.format!==void 0&&(M.format=this.format),this.stream!==void 0&&(M.stream=this.stream),this.heartbeats!==void 0&&(M.heartbeats=this.heartbeats),M.v=C.default.protocolVersion,M.agent=(0,C.getAgentString)(this.options),N.transportParams!==void 0&&p.mixin(M,N.transportParams),M},V.prototype.toString=function(){var H="[mode="+this.mode;return this.host&&(H+=",host="+this.host),this.connectionKey&&(H+=",connectionKey="+this.connectionKey),this.format&&(H+=",format="+this.format),H+="]",H},V}();t.TransportParams=j;var $=function(V){o.__extends(H,V);function H(M,N){var F=V.call(this)||this;F.disconnectedRetryCount=0,H.initTransports(),F.realtime=M,F.options=N;var B=N.timeouts,W=B.preferenceConnectTimeout+B.realtimeRequestTimeout;if(F.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:W,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:B.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:B.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:B.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},F.state=F.states.initialized,F.errorReason=null,F.queuedMessages=new I.default,F.msgSerial=0,F.connectionDetails=void 0,F.connectionId=void 0,F.connectionKey=void 0,F.connectionStateTtl=B.connectionStateTtl,F.maxIdleInterval=null,F.transports=p.intersect(N.transports||C.default.defaultTransports,H.supportedTransports),F.baseTransport=p.intersect(C.default.baseTransportOrder,F.transports)[0],F.upgradeTransports=p.intersect(F.transports,C.default.upgradeTransports),F.transportPreference=null,F.httpHosts=C.default.getHosts(N),F.activeProtocol=null,F.proposedTransports=[],F.pendingTransports=[],F.host=null,F.lastAutoReconnectAttempt=null,F.lastActivity=null,F.forceFallbackHost=!1,F.connectCounter=0,u.default.logAction(u.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(N.transports||C.default.defaultTransports)+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+F.transports+"]"),u.default.logAction(u.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+F.httpHosts+"]"),!F.transports.length){var J="no requested transports available";throw u.default.logAction(u.default.LOG_ERROR,"realtime.ConnectionManager()",J),new Error(J)}var Q=E.default.Config.addEventListener;return Q&&(v()&&typeof N.recover=="function"&&Q("beforeunload",F.persistConnection.bind(F)),N.closeOnUnload===!0&&Q("beforeunload",function(){u.default.logAction(u.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),F.requestState({state:"closing"})}),Q("online",function(){F.state==F.states.disconnected||F.state==F.states.suspended?(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),F.requestState({state:"connecting"})):F.state==F.states.connecting&&(F.pendingTransports.forEach(function(X){X.off()}),F.disconnectAllTransports(),F.startConnect())}),Q("offline",function(){F.state==F.states.connected&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),F.disconnectAllTransports())})),F}return H.initTransports=function(){(0,d.default)(H),p.arrForEach(E.default.Transports,function(M){M(H)})},H.prototype.createTransportParams=function(M,N){return new j(this.options,M,N,this.connectionKey)},H.prototype.getTransportParams=function(M){var N=this,F=function(B){if(N.connectionKey){B("resume");return}if(typeof N.options.recover=="string"){B("recover");return}var W=N.options.recover,J=_();if(J&&typeof W=="function"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),W(J,function(Q){Q?(N.options.recover=J.recoveryKey,B("recover")):B("clean")});return}B("clean")};F(function(B){var W=N.createTransportParams(null,B);if(B==="recover"){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+N.options.recover);var J=U(N.options.recover);J&&(N.msgSerial=J.msgSerial)}else u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+W.toString());M(W)})},H.prototype.tryATransport=function(M,N,F){var B=this;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+N),c.default.tryConnect(H.supportedTransports[N],this,this.realtime.auth,M,function(W,J){var Q=B.state;if(Q==B.states.closing||Q==B.states.closed||Q==B.states.failed){J&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+Q.state+" while we were attempting the transport; closing "+J),J.close()),F(!0);return}if(W){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+N+" "+W.event+", err: "+W.error.toString()),y.default.isTokenErr(W.error)&&!(B.errorReason&&y.default.isTokenErr(B.errorReason))?(B.errorReason=W.error,B.realtime.auth._forceNewToken(null,null,function(X){if(X){B.actOnErrorFromAuthorize(X);return}B.tryATransport(M,N,F)})):W.event==="failed"?(B.notifyState({state:"failed",error:W.error}),F(!0)):W.event==="disconnected"&&((0,R.isRetriable)(W.error)?F(!1):(B.notifyState({state:B.states.connecting.failState,error:W.error}),F(!0)));return}u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+N+"; setting pending"),B.setTransportPending(J,M),F(null,J)})},H.prototype.setTransportPending=function(M,N){var F=this,B=N.mode;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+M+"; mode = "+B),p.arrDeleteValue(this.proposedTransports,M),this.pendingTransports.push(M);var W=E.default.Defaults.transportPreferenceOrder[E.default.Defaults.transportPreferenceOrder.length-1];M.once("connected",function(Q,X,ee){B=="upgrade"&&F.activeProtocol?M.shortName!==W&&p.arrIn(F.getUpgradePossibilities(),W)&&F.activeProtocol?setTimeout(function(){F.scheduleTransportActivation(Q,M,X,ee)},F.options.timeouts.parallelUpgradeDelay):F.scheduleTransportActivation(Q,M,X,ee):(F.activateTransport(Q,M,X,ee),E.default.Config.nextTick(function(){F.connectImpl(N)})),B==="recover"&&F.options.recover&&(F.options.recover=null,F.unpersistConnection())});var J=this;M.on(["disconnected","closed","failed"],function(Q){J.deactivateTransport(M,this.event,Q)}),this.emit("transport.pending",M)},H.prototype.scheduleTransportActivation=function(M,N,F,B){var W=this,J=this.activeProtocol&&this.activeProtocol.getTransport(),Q=function(){N.disconnect(),p.arrDeleteValue(W.pendingTransports,N)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Q();return}if(J&&!S(N,J)){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+" is no better than current active transport "+J.shortName+" - abandoning upgrade"),Q();return}u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+N);var X=null;if(!N.isConnected){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+N.shortName+"is no longer connected; abandoning upgrade"),Q();return}if(this.state===this.states.connected)u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,X=this.activeProtocol;else if(this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+N.shortName),Q();return}u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+N);var ee=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+N),N.send(f.default.fromValues({action:h.ACTIVATE})),W.activateTransport(M,N,F,B),W.state===W.states.synchronizing?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+N),W.state=W.states.connected):u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+W.state.state+", so leaving unchanged"),W.state.sendEvents&&W.sendQueuedMessages()};X?X.onceIdle(ee):ee()},H.prototype.activateTransport=function(M,N,F,B){var W=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+N),M&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+M),F&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+F),B&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(B)),this.persistTransportPreference(N);var J=this.state,Q=this.states.connected.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+J.state),J.state==this.states.closing.state||J.state==this.states.closed.state||J.state==this.states.failed.state)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),N.disconnect(),!1;if(p.arrDeleteValue(this.pendingTransports,N),!N.isConnected)return u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+N+" since it appears to no longer be connected"),!1;var X=this.activeProtocol;this.activeProtocol=new g.default(N),this.host=N.params.host;var ee=B.connectionKey;if(ee&&this.connectionKey!=ee&&this.setConnection(F,B,!!M),this.onConnectionDetailsUpdate(B,N),E.default.Config.nextTick(function(){N.on("connected",function(Y,ie,fe){W.onConnectionDetailsUpdate(fe,N),W.emit("update",new w.default(Q,Q,null,Y))})}),J.state===this.states.connected.state?M&&(this.errorReason=this.realtime.connection.errorReason=M,this.emit("update",new w.default(Q,Q,null,M))):(this.notifyState({state:"connected",error:M}),this.errorReason=this.realtime.connection.errorReason=M||null),this.emit("transport.active",N),X)if(X.messageQueue.count()>0&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+X.transport.shortName+", new one is "+N.shortName+") finishing with "+X.messageQueue.count()+" messages still pending"),X.transport===N){var re="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+N.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",re)}else X.finish();return p.safeArrForEach(this.pendingTransports,function(Y){if(Y===N){var ie="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+N.shortName+"; stack = "+new Error().stack;u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()",ie),p.arrDeleteValue(W.pendingTransports,N)}else Y.disconnect()}),p.safeArrForEach(this.proposedTransports,function(Y){Y===N?(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+N.shortName+"; stack = "+new Error().stack),p.arrDeleteValue(W.proposedTransports,N)):Y.dispose()}),!0},H.prototype.deactivateTransport=function(M,N,F){var B=this.activeProtocol,W=B&&B.getTransport()===M,J=p.arrDeleteValue(this.pendingTransports,M),Q=p.arrDeleteValue(this.proposedTransports,M),X=this.noTransportsScheduledForActivation();if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+M),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+N+(W?"; was active":J?"; was pending":Q?"; was proposed":"")+(X?"":"; another transport is scheduled for activation")),F&&F.message&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+F.message),W&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(B.getPendingMessages()),E.default.Config.nextTick(function(){B.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",M),W&&X||W&&N==="failed"||N==="closed"||B===null&&J&&this.pendingTransports.length===0){if(N==="disconnected"&&F&&F.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:N,error:F,retryImmediately:!0});return}var ee=N==="failed"&&y.default.isTokenErr(F)?"disconnected":N;this.notifyState({state:ee,error:F});return}W&&N==="disconnected"&&this.state!==this.states.synchronizing&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:F}))},H.prototype.noTransportsScheduledForActivation=function(){return p.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(M){return!M.isConnected})},H.prototype.setConnection=function(M,N,F){var B=this.connectionId,W=B&&B!==M,J=!B&&F;(W||J)&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==M&&u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=M,this.realtime.connection.key=this.connectionKey=N.connectionKey},H.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},H.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},H.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var M=p.now()-this.lastActivity;M>this.connectionStateTtl+this.maxIdleInterval&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+M+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},H.prototype.persistConnection=function(){if(v()){var M=this.createRecoveryKey();M&&x({recoveryKey:M,disconnectedAt:p.now(),location:s.location,clientId:this.realtime.auth.clientId})}},H.prototype.unpersistConnection=function(){b()},H.prototype.getError=function(){return this.errorReason||this.getStateError()},H.prototype.getStateError=function(){var M,N;return(N=(M=R.default)[this.state.state])===null||N===void 0?void 0:N.call(M)},H.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},H.prototype.enactStateChange=function(M){var N=M.current==="failed"?u.default.LOG_ERROR:u.default.LOG_MAJOR;u.default.logAction(N,"Connection state",M.current+(M.reason?"; reason: "+M.reason:"")),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+M.current+"; reason = "+(M.reason&&M.reason.message));var F=this.state=this.states[M.current];M.reason&&(this.errorReason=M.reason,this.realtime.connection.errorReason=M.reason),(F.terminal||F.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",M)},H.prototype.startTransitionTimer=function(M){var N=this;u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+M.state),this.transitionTimer&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){N.transitionTimer&&(N.transitionTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager "+M.state+" timer expired","requesting new state: "+M.failState),N.notifyState({state:M.failState}))},M.retryDelay)},H.prototype.cancelTransitionTimer=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},H.prototype.startSuspendTimer=function(){var M=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){M.suspendTimer&&(M.suspendTimer=null,u.default.logAction(u.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),M.states.connecting.failState="suspended",M.notifyState({state:"suspended"}))},this.connectionStateTtl))},H.prototype.checkSuspendTimer=function(M){M!=="disconnected"&&M!=="suspended"&&M!=="connecting"&&this.cancelSuspendTimer()},H.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},H.prototype.startRetryTimer=function(M){var N=this;this.retryTimer=setTimeout(function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),N.retryTimer=null,N.requestState({state:"connecting"})},M)},H.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},H.prototype.notifyState=function(M){var N=this,F,B,W=M.state,J=W==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||M.retryImmediately||this.state===this.states.connecting&&M.error&&y.default.isTokenErr(M.error)&&!(this.errorReason&&y.default.isTokenErr(this.errorReason)));if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+W+(J?"; will retry connection immediately":"")),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(M.state),(W==="suspended"||W==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var Q=this.states[M.state],X=Q.retryDelay;Q.state==="disconnected"&&(this.disconnectedRetryCount++,X=p.getRetryTime(Q.retryDelay,this.disconnectedRetryCount));var ee=new w.default(this.state.state,Q.state,X,M.error||((B=(F=R.default)[Q.state])===null||B===void 0?void 0:B.call(F)));if(J){var re=function(){N.state===N.states.disconnected&&(N.lastAutoReconnectAttempt=p.now(),N.requestState({state:"connecting"}))},Y=this.lastAutoReconnectAttempt&&p.now()-this.lastAutoReconnectAttempt+1;Y&&Y<1e3?(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+Y+"ms ago, waiting another "+(1e3-Y)+"ms before trying again"),setTimeout(re,1e3-Y)):E.default.Config.nextTick(re)}else(W==="disconnected"||W==="suspended")&&this.startRetryTimer(X);(W==="disconnected"&&!J||W==="suspended"||Q.terminal)&&E.default.Config.nextTick(function(){N.disconnectAllTransports()}),W=="connected"&&!this.activeProtocol&&u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(ee),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(W,ee.reason),this.failQueuedMessages(ee.reason))}},H.prototype.requestState=function(M){var N=this,F,B,W=M.state;if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+W+"; current state: "+this.state.state),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(W),!(W=="connecting"&&this.state.state=="connected")&&!(W=="closing"&&this.state.state=="closed"))){var J=this.states[W],Q=new w.default(this.state.state,J.state,null,M.error||((B=(F=R.default)[J.state])===null||B===void 0?void 0:B.call(F)));this.enactStateChange(Q),W=="connecting"&&E.default.Config.nextTick(function(){N.startConnect()}),W=="closing"&&this.closeImpl()}},H.prototype.startConnect=function(){var M=this;if(this.state!==this.states.connecting){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var N=this.realtime.auth,F=++this.connectCounter,B=function(){M.checkConnectionStateFreshness(),M.getTransportParams(function(J){if(J.mode==="recover"&&J.options.recover){var Q=U(J.options.recover);Q&&M.realtime.channels.recoverChannels(Q.channelSerials)}F===M.connectCounter&&M.connectImpl(J,F)})};if(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),N.method==="basic")B();else{var W=function(J){F===M.connectCounter&&(J?M.actOnErrorFromAuthorize(J):B())};this.errorReason&&y.default.isTokenErr(this.errorReason)?N._forceNewToken(null,null,W):N._ensureValidAuthCredentials(!1,W)}},H.prototype.connectImpl=function(M,N){var F=this.state.state;F!==this.states.connecting.state&&F!==this.states.connected.state?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+F):this.pendingTransports.length?u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):F==this.states.connected.state?this.upgradeIfNeeded(M):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(M,N):this.connectBase(M,N)},H.prototype.connectPreference=function(M,N){var F=this,B=this.getTransportPreference(),W=!1;p.arrIn(this.transports,B)||(this.unpersistTransportPreference(),this.connectImpl(M,N)),u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+B);var J=setTimeout(function(){W=!0,F.state.state!==F.states.connected.state&&(u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+B+" failed; clearing preference and trying from scratch"),F.disconnectAllTransports(),F.unpersistTransportPreference()),F.connectImpl(M,N)},this.options.timeouts.preferenceConnectTimeout);M.host=this.httpHosts[0],this.tryATransport(M,B,function(Q,X){clearTimeout(J),W&&X?(X.off(),X.disconnect(),p.arrDeleteValue(F.pendingTransports,X)):!X&&!Q&&(F.unpersistTransportPreference(),F.connectImpl(M,N))})},H.prototype.connectBase=function(M,N){var F=this,B=function(ee){F.notifyState({state:F.states.connecting.failState,error:ee})},W=this.httpHosts.slice(),J=function(ee,re){N===F.connectCounter&&!re&&!ee&&X()};u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var Q=W.shift();if(!Q){B(new P.default("Unable to connect (no available host)",80003,404));return}M.host=Q;var X=function(){if(!W.length){B(new P.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!F.realtime.http.checkConnectivity){B(new P.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}F.realtime.http.checkConnectivity(function(ee,re){if(N===F.connectCounter){if(ee){B(ee);return}if(!re){B(new P.default("Unable to connect (network unreachable)",80003,404));return}M.host=p.arrPopRandomElement(W),F.tryATransport(M,F.baseTransport,J)}})};if(this.forceFallbackHost&&W.length){this.forceFallbackHost=!1,X();return}this.tryATransport(M,this.baseTransport,J)},H.prototype.getUpgradePossibilities=function(){var M=this.activeProtocol.getTransport().shortName,N=p.arrIndexOf(this.upgradeTransports,M);return this.upgradeTransports.slice(N+1)},H.prototype.upgradeIfNeeded=function(M){var N=this,F=this.getUpgradePossibilities();u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+E.default.Config.inspect(F)),F.length&&p.arrForEach(F,function(B){var W=N.createTransportParams(M.host,"upgrade");N.tryATransport(W,B,O)})},H.prototype.closeImpl=function(){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),p.safeArrForEach(this.pendingTransports,function(M){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+M),M&&M.close()}),p.safeArrForEach(this.proposedTransports,function(M){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+M),M&&M.dispose()}),this.activeProtocol&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},H.prototype.onAuthUpdated=function(M,N){var F=this,B;switch(this.state.state){case"connected":{if(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var W=this.activeProtocol.getTransport().params;E.default.Config.nextTick(function(){F.state.state==="connected"&&F.upgradeIfNeeded(W)})}var J=(B=this.activeProtocol)===null||B===void 0?void 0:B.getTransport();J&&J.onAuthUpdated&&J.onAuthUpdated(M);var Q=f.default.fromValues({action:h.AUTH,auth:{accessToken:M.token}});this.send(Q);var X=function(){F.off(ee),N(null,M)},ee=function(Y){Y.current==="failed"&&(F.off(X),F.off(ee),N(Y.reason||F.getStateError()))};this.once("connectiondetails",X),this.on("connectionstate",ee);break}case"connecting":u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var re=function(Y){switch(Y.current){case"connected":F.off(re),N(null,M);break;case"failed":case"closed":case"suspended":F.off(re),N(Y.reason||F.getStateError());break}};this.on("connectionstate",re),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},H.prototype.disconnectAllTransports=function(M){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(M?" except the active transport":"")),this.connectCounter++,p.safeArrForEach(this.pendingTransports,function(N){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+N),N&&N.disconnect()}),this.pendingTransports=[],p.safeArrForEach(this.proposedTransports,function(N){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+N),N&&N.dispose()}),this.proposedTransports=[],this.activeProtocol&&!M&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},H.prototype.send=function(M,N,F){F=F||O;var B=this.state;if(B.sendEvents){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new g.PendingMessage(M,F));return}var W=N&&B.queueEvents||B.forceQueueEvents;if(!W){var J="rejecting event, queueEvent was "+N+", state was "+B.state;u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()",J),F(this.errorReason||new P.default(J,9e4,400));return}u.default.shouldLog(u.default.LOG_MICRO)&&u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+f.default.stringify(M)),this.queue(M,F)},H.prototype.sendImpl=function(M){var N=M.message;M.ackRequired&&!M.sendAttempted&&(N.msgSerial=this.msgSerial++);try{this.activeProtocol.send(M)}catch(F){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+F.stack)}},H.prototype.queue=function(M,N){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var F=this.queuedMessages.last(),B=this.options.maxMessageSize;F&&!F.sendAttempted&&L(F.message,M,B)?(F.merged||(F.callback=T.default.create([F.callback]),F.merged=!0),F.callback.push(N)):this.queuedMessages.push(new g.PendingMessage(M,N))},H.prototype.sendQueuedMessages=function(){u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var M;M=this.queuedMessages.shift();)this.sendImpl(M)},H.prototype.queuePendingMessages=function(M){M&&M.length&&(u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+M.length+" pending messages"),this.queuedMessages.prepend(M))},H.prototype.failQueuedMessages=function(M){var N=this.queuedMessages.count();N>0&&(u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+N+" queued messages, err = "+p.inspectError(M)),this.queuedMessages.completeAllMessages(M))},H.prototype.onChannelMessage=function(M,N){var F=this.activeProtocol&&N===this.activeProtocol.getTransport(),B=p.arrIn(this.pendingTransports,N)&&this.state==this.states.synchronizing;F||B?this.realtime.channels.onChannelMessage(M):p.arrIndexOf([h.ACK,h.NACK,h.ERROR],M.action)>-1?this.realtime.channels.onChannelMessage(M):u.default.logAction(u.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(M)+"on defunct transport; discarding")},H.prototype.ping=function(M,N){var F=this;if(M){u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+M);var B=function(){M.off("heartbeat",Q),N(new P.default("Timeout waiting for heartbeat response",5e4,500))},W=p.now(),J=p.cheapRandStr(),Q=function(ie){if(ie===J){M.off("heartbeat",Q),clearTimeout(X);var fe=p.now()-W;N(null,fe)}},X=setTimeout(B,this.options.timeouts.realtimeRequestTimeout);M.on("heartbeat",Q),M.ping(J);return}if(this.state.state!=="connected"){N(new P.default("Unable to ping service; not connected",4e4,400));return}var ee=!1,re=function(ie,fe){F.off("transport.active",Y),ee||(ee=!0,N(ie,fe))},Y=function(){ee||(ee=!0,E.default.Config.nextTick(function(){F.ping(null,N)}))};this.on("transport.active",Y),this.ping(this.activeProtocol.getTransport(),re)},H.prototype.abort=function(M){this.activeProtocol.getTransport().fail(M)},H.prototype.registerProposedTransport=function(M){this.proposedTransports.push(M)},H.prototype.getTransportPreference=function(){var M,N;return this.transportPreference||a()&&((N=(M=E.default.WebStorage)===null||M===void 0?void 0:M.get)===null||N===void 0?void 0:N.call(M,k))},H.prototype.persistTransportPreference=function(M){var N,F;p.arrIn(C.default.upgradeTransports,M.shortName)&&(this.transportPreference=M.shortName,a()&&((F=(N=E.default.WebStorage)===null||N===void 0?void 0:N.set)===null||F===void 0||F.call(N,k,M.shortName)))},H.prototype.unpersistTransportPreference=function(){var M,N;this.transportPreference=null,a()&&((N=(M=E.default.WebStorage)===null||M===void 0?void 0:M.remove)===null||N===void 0||N.call(M,k))},H.prototype.actOnErrorFromAuthorize=function(M){if(M.code===40171)this.notifyState({state:"failed",error:M});else if(M.code===40102)this.notifyState({state:"failed",error:M});else if(M.statusCode===l.default.Forbidden){var N="Client configured authentication provider returned 403; failing the connection";u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",N),this.notifyState({state:"failed",error:new P.default(N,80019,403,M)})}else{var N="Client configured authentication provider request failed";u.default.logAction(u.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",N),this.notifyState({state:this.state.failState,error:new P.default(N,80019,401,M)})}},H.prototype.onConnectionDetailsUpdate=function(M,N){if(M){this.connectionDetails=M,M.maxMessageSize&&(this.options.maxMessageSize=M.maxMessageSize);var F=M.clientId;if(F){var B=this.realtime.auth._uncheckedSetClientId(F);if(B){u.default.logAction(u.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",B.message),N.fail(B);return}}var W=M.connectionStateTtl;W&&(this.connectionStateTtl=W),this.maxIdleInterval=M.maxIdleInterval,this.emit("connectiondetails",M)}},H.supportedTransports={},H}(A.default);t.default=$}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(7)),f=s.__importDefault(i(2)),p=function(g){s.__extends(C,g);function C(){var E=g.call(this)||this;return E.messages=[],E}return C.prototype.count=function(){return this.messages.length},C.prototype.push=function(E){this.messages.push(E)},C.prototype.shift=function(){return this.messages.shift()},C.prototype.last=function(){return this.messages[this.messages.length-1]},C.prototype.copyAll=function(){return this.messages.slice()},C.prototype.append=function(E){this.messages.push.apply(this.messages,E)},C.prototype.prepend=function(E){this.messages.unshift.apply(this.messages,E)},C.prototype.completeMessages=function(E,A,I){f.default.logAction(f.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+E+"; count = "+A),I=I||null;var u=this.messages;if(u.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var w=u[0];if(w){var R=w.message.msgSerial,P=E+A;if(P>R)for(var y=u.splice(0,P-R),m=0,T=y;m<T.length;m++){var d=T[m];d.callback(I)}u.length==0&&this.emit("idle")}},C.prototype.completeAllMessages=function(E){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,E)},C.prototype.resetSendAttempted=function(){for(var E=0,A=this.messages;E<A.length;E++){var I=A[E];I.sendAttempted=!1}},C.prototype.clear=function(){f.default.logAction(f.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},C}(o.default);t.default=p},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(f,p,g,C){this.previous=f,this.current=p,g&&(this.retryIn=g),C&&(this.reason=C)}return o}();t.default=s},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(10)),f=s.__importDefault(i(7)),p=s.__importStar(i(1)),g=s.__importDefault(i(33)),C=s.__importDefault(i(2)),E=s.__importDefault(i(54)),A=s.__importDefault(i(9)),I=s.__importDefault(i(39)),u=s.__importStar(i(4)),w=s.__importDefault(i(16)),R=s.__importDefault(i(21)),P=o.default.Action,y=function(){};function m(c){if(c&&"params"in c&&!p.isObject(c.params))return new u.default("options.params must be an object",4e4,400);if(c&&"modes"in c){if(!p.isArray(c.modes))return new u.default("options.modes must be an array",4e4,400);for(var l=0;l<c.modes.length;l++){var a=c.modes[l];if(!a||typeof a!="string"||!p.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(a)))return new u.default("Invalid channel mode: "+a,4e4,400)}}}var T=function(c){s.__extends(l,c);function l(a,v,h){var O=c.call(this,a,v,h)||this;return O.retryCount=0,O.history=function(k,D){if(C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),D===void 0)if(typeof k=="function")D=k,k=null;else{if(this.rest.options.promises)return p.promisify(this,"history",arguments);D=y}if(k&&k.untilAttach){if(this.state!=="attached"){D(new u.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){D(new u.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete k.untilAttach,k.from_serial=this.properties.attachSerial}g.default.prototype._history.call(this,k,D)},O.whenState=function(k,D){return f.default.prototype.whenState.call(O,k,O.state,D)},C.default.logAction(C.default.LOG_MINOR,"RealtimeChannel()","started; name = "+v),O.realtime=a,O.presence=new E.default(O),O.connectionManager=a.connection.connectionManager,O.state="initialized",O.subscriptions=new f.default,O.syncChannelSerial=void 0,O.properties={attachSerial:void 0,channelSerial:void 0},O.setOptions(h),O.errorReason=null,O._requestedFlags=null,O._mode=null,O._attachResume=!1,O._decodingContext={channelOptions:O.channelOptions,plugins:a.options.plugins||{},baseEncodedPreviousPayload:void 0},O._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},O._allChannelChanges=new f.default,O}return l.prototype.invalidStateError=function(){return new u.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},l.processListenerArgs=function(a){return a=Array.prototype.slice.call(a),typeof a[0]=="function"&&a.unshift(null),a[a.length-1]==null&&a.pop(),a},l.prototype.setOptions=function(a,v){var h=this.channelOptions;if(!v&&this.rest.options.promises)return p.promisify(this,"setOptions",arguments);var O=v||function(D){D&&C.default.logAction(C.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+D.toString())},k=m(a);if(k){O(k);return}g.default.prototype.setOptions.call(this,a),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(a,h)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(D){switch(this.event){case"update":case"attached":O==null||O(null);return;default:O==null||O(D.reason);return}})):O()},l.prototype._shouldReattachToSetOptions=function(a,v){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(a!=null&&a.params){var h=d(a.params),O=d(v.params);if(Object.keys(h).length!==Object.keys(O).length||!p.shallowEquals(O,h))return!0}return!!(a!=null&&a.modes&&(!v.modes||!p.arrEquals(a.modes,v.modes)))},l.prototype.publish=function(){for(var a=this,v=[],h=0;h<arguments.length;h++)v[h]=arguments[h];var O=v[0],k=v.length,D=v[k-1];if(typeof D!="function"){if(this.realtime.options.promises)return p.promisify(this,"publish",arguments);D=y,++k}if(!this.connectionManager.activeState()){D(this.connectionManager.getError());return}if(k==2)if(p.isObject(O))O=[A.default.fromValues(O)];else if(p.isArray(O))O=A.default.fromValuesArray(O);else throw new u.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else O=[A.default.fromValues({name:v[0],data:v[1]})];var _=this.realtime.options.maxMessageSize;A.default.encodeArray(O,this.channelOptions,function(x){if(x){D(x);return}var b=A.default.getMessagesSize(O);if(b>_){D(new u.default("Maximum size of messages that can be published at once exceeded ( was "+b+" bytes; limit is "+_+" bytes)",40009,400));return}a.__publish(O,D)})},l.prototype.__publish=function(a,v){C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+a.length);var h=this.state;switch(h){case"failed":case"suspended":v(u.default.fromValues(this.invalidStateError()));break;default:{C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+h);var O=new o.default;O.action=P.MESSAGE,O.channel=this.name,O.messages=a,this.sendMessage(O,v);break}}},l.prototype.onEvent=function(a){C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var v=this.subscriptions,h=0;h<a.length;h++){var O=a[h];v.emit(O.name,O)}},l.prototype.attach=function(a,v){var h;if(typeof a=="function"?(v=a,h=null):h=a,!v){if(this.realtime.options.promises)return p.promisify(this,"attach",arguments);v=function(O){O&&C.default.logAction(C.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+O.toString())}}if(h)C.default.deprecated("The ability to pass an array of channel mode flags as the first argument of `RealtimeChannel.attach()`","To set channel mode flags, populate the `modes` property of the channel options object that you pass to `Channels.get()` or `RealtimeChannel.setOptions()`."),this._requestedFlags=h;else if(this.state==="attached"){v(null,null);return}this._attach(!1,null,v)},l.prototype._attach=function(a,v,h){h||(h=function(k){k&&C.default.logAction(C.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+k.toString())});var O=this.connectionManager;if(!O.activeState()){h(O.getError());return}(this.state!=="attaching"||a)&&this.requestState("attaching",v),this.once(function(k){switch(this.event){case"attached":h==null||h(null,k);break;case"detached":case"suspended":case"failed":h==null||h(k.reason||O.getError()||new u.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":h==null||h(new u.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},l.prototype.attachImpl=function(){C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var a=o.default.fromValues({action:P.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?a.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&a.encodeModesToFlags(p.allToUpperCase(this.channelOptions.modes)),this._attachResume&&a.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(a.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(a,y)},l.prototype.detach=function(a){if(!a){if(this.realtime.options.promises)return p.promisify(this,"detach",arguments);a=y}var v=this.connectionManager;if(!v.activeState()){a(v.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),a();break;case"detached":a();break;case"failed":a(new u.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(h){switch(this.event){case"detached":a();break;case"attached":case"suspended":case"failed":a(h.reason||v.getError()||new u.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":a(new u.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},l.prototype.detachImpl=function(a){C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var v=o.default.fromValues({action:P.DETACH,channel:this.name});this.sendMessage(v,a||y)},l.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var h=l.processListenerArgs(a),O=h[0],k=h[1],D=h[2];if(!D&&this.realtime.options.promises)return p.promisify(this,"subscribe",[O,k]);if(this.state==="failed"){D==null||D(u.default.fromValues(this.invalidStateError()));return}return O&&typeof O=="object"&&!Array.isArray(O)?this._subscribeFilter(O,k):this.subscriptions.on(O,k),this.attach(D||y)},l.prototype._subscribeFilter=function(a,v){var h=function(O){var k,D,_,x,b,S,L={name:O.name,refTimeserial:(D=(k=O.extras)===null||k===void 0?void 0:k.ref)===null||D===void 0?void 0:D.timeserial,refType:(x=(_=O.extras)===null||_===void 0?void 0:_.ref)===null||x===void 0?void 0:x.type,isRef:!!(!((S=(b=O.extras)===null||b===void 0?void 0:b.ref)===null||S===void 0)&&S.timeserial),clientId:O.clientId};Object.entries(a).find(function(U){var j=U[0],$=U[1];return $!==void 0?L[j]!==$:!1})||v(O)};this._addFilteredSubscription(a,v,h),this.subscriptions.on(h)},l.prototype._addFilteredSubscription=function(a,v,h){var O;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(v)){var k=this.filteredSubscriptions.get(v);k.set(a,((O=k==null?void 0:k.get(a))===null||O===void 0?void 0:O.concat(h))||[h])}else this.filteredSubscriptions.set(v,new Map([[a,[h]]]))},l.prototype._getAndDeleteFilteredSubscriptions=function(a,v){var h=this;if(!this.filteredSubscriptions)return[];if(!v&&a)return Array.from(this.filteredSubscriptions.entries()).map(function(_){var x,b=_[0],S=_[1],L=S.get(a);return S.delete(a),S.size===0&&((x=h.filteredSubscriptions)===null||x===void 0||x.delete(b)),L}).reduce(function(_,x){var b;return x?(b=_).concat.apply(b,x):_},[]);if(!v||!this.filteredSubscriptions.has(v))return[];var O=this.filteredSubscriptions.get(v);if(!a){var k=Array.from(O.values()).reduce(function(_,x){return _.concat.apply(_,x)},[]);return this.filteredSubscriptions.delete(v),k}var D=O.get(a);return O.delete(a),D||[]},l.prototype.unsubscribe=function(){for(var a=this,v,h=[],O=0;O<arguments.length;O++)h[O]=arguments[O];var k=l.processListenerArgs(h),D=k[0],_=k[1];if(typeof D=="object"&&!_||!((v=this.filteredSubscriptions)===null||v===void 0)&&v.has(_)){this._getAndDeleteFilteredSubscriptions(D,_).forEach(function(x){return a.subscriptions.off(x)});return}this.subscriptions.off(D,_)},l.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new u.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var a=this.connectionManager;if(!a.activeState())throw a.getError();var v=o.default.fromValues({action:P.SYNC,channel:this.name});this.syncChannelSerial&&(v.channelSerial=this.syncChannelSerial),a.send(v)},l.prototype.sendMessage=function(a,v){this.connectionManager.send(a,this.realtime.options.queueMessages,v)},l.prototype.sendPresence=function(a,v){var h=o.default.fromValues({action:P.PRESENCE,channel:this.name,presence:p.isArray(a)?w.default.fromValuesArray(a):[w.default.fromValues(a)]});this.sendMessage(h,v)},l.prototype.onMessage=function(a){(a.action===P.ATTACHED||a.action===P.MESSAGE||a.action===P.PRESENCE)&&this.setChannelSerial(a.channelSerial);var v,h=!1;switch(a.action){case P.ATTACHED:{this.properties.attachSerial=a.channelSerial,this._mode=a.getMode(),this.params=a.params||{};var O=a.decodeModesFromFlags();this.modes=O&&p.allToLowerCase(O)||void 0;var k=a.hasFlag("RESUMED"),D=a.hasFlag("HAS_PRESENCE"),_=a.hasFlag("HAS_BACKLOG");if(this.state==="attached"){k||this.presence.onAttached(D);var x=new I.default(this.state,this.state,k,_,a.error);this._allChannelChanges.emit("update",x),(!k||this.channelOptions.updateOnAttached)&&this.emit("update",x)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",a.error,k,D,_);break}case P.DETACHED:{var b=a.error?u.default.fromValues(a.error):new u.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",b):this.state==="attaching"?this.notifyState("suspended",b):this.requestState("attaching",b);break}case P.SYNC:if(h=!0,v=this.syncChannelSerial=a.channelSerial,!a.presence)break;case P.PRESENCE:{for(var S=a.presence,L=a.id,U=a.connectionId,j=a.timestamp,$=this.channelOptions,V=void 0,H=0;H<S.length;H++)try{V=S[H],w.default.decode(V,$),V.connectionId||(V.connectionId=U),V.timestamp||(V.timestamp=j),V.id||(V.id=L+":"+H)}catch(J){C.default.logAction(C.default.LOG_ERROR,"RealtimeChannel.onMessage()",J.toString())}this.presence.setPresence(S,h,v);break}case P.MESSAGE:{if(this.state!=="attached"){C.default.logAction(C.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+a.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var M=a.messages,N=M[0],F=M[M.length-1],L=a.id,U=a.connectionId,j=a.timestamp;if(N.extras&&N.extras.delta&&N.extras.delta.from!==this._lastPayload.messageId){var B='Delta message decode failure - previous message not available for message "'+a.id+'" on this channel "'+this.name+'".';C.default.logAction(C.default.LOG_ERROR,"RealtimeChannel.onMessage()",B),this._startDecodeFailureRecovery(new u.default(B,40018,400));break}for(var H=0;H<M.length;H++){var B=M[H];try{A.default.decode(B,this._decodingContext)}catch(Y){switch(C.default.logAction(C.default.LOG_ERROR,"RealtimeChannel.onMessage()",Y.toString()),Y.code){case 40018:this._startDecodeFailureRecovery(Y);return;case 40019:case 40021:this.notifyState("failed",Y);return}}B.connectionId||(B.connectionId=U),B.timestamp||(B.timestamp=j),B.id||(B.id=L+":"+H)}this._lastPayload.messageId=F.id,this._lastPayload.protocolMessageChannelSerial=a.channelSerial,this.onEvent(M);break}case P.ERROR:{var W=a.error;W&&W.code==80016?this.checkPendingState():this.notifyState("failed",u.default.fromValues(W));break}default:C.default.logAction(C.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+a.action+")"),this.connectionManager.abort(R.default.unknownChannelErr())}},l.prototype._startDecodeFailureRecovery=function(a){var v=this;this._lastPayload.decodeFailureRecoveryInProgress||(C.default.logAction(C.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,a,function(){v._lastPayload.decodeFailureRecoveryInProgress=!1}))},l.prototype.onAttached=function(){C.default.logAction(C.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},l.prototype.notifyState=function(a,v,h,O,k){if(C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+a),this.clearStateTimer(),p.arrIn(["detached","suspended","failed"],a)&&(this.properties.channelSerial=null),a!==this.state){this.presence.actOnChannelState(a,O,v),a==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),v&&(this.errorReason=v);var D=new I.default(this.state,a,h,k,v),_=a==="failed"?C.default.LOG_ERROR:C.default.LOG_MAJOR;C.default.logAction(_,'Channel state for channel "'+this.name+'"',a+(v?"; reason: "+v:"")),a!=="attaching"&&a!=="suspended"&&(this.retryCount=0),a==="attached"&&this.onAttached(),a==="attached"?this._attachResume=!0:(a==="detaching"||a==="failed")&&(this._attachResume=!1),this.state=a,this._allChannelChanges.emit(a,D),this.emit(a,D)}},l.prototype.requestState=function(a,v){C.default.logAction(C.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+a),this.notifyState(a,v),this.checkPendingState()},l.prototype.checkPendingState=function(){var a=this.connectionManager.state;if(!(a.sendEvents||a.forceQueueEvents)){C.default.logAction(C.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(C.default.logAction(C.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},l.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var a=new u.default("Channel attach timed out",90007,408);this.notifyState("suspended",a);break}case"detaching":{var a=new u.default("Channel detach timed out",90007,408);this.notifyState("attached",a);break}default:this.checkPendingState();break}},l.prototype.startStateTimerIfNotRunning=function(){var a=this;this.stateTimer||(this.stateTimer=setTimeout(function(){C.default.logAction(C.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),a.stateTimer=null,a.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},l.prototype.clearStateTimer=function(){var a=this.stateTimer;a&&(clearTimeout(a),this.stateTimer=null)},l.prototype.startRetryTimer=function(){var a=this;if(!this.retryTimer){this.retryCount++;var v=p.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){a.state==="suspended"&&a.connectionManager.state.sendEvents&&(a.retryTimer=null,C.default.logAction(C.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),a.requestState("attaching"))},v)}},l.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},l.prototype.getReleaseErr=function(){var a=this.state;return a==="initialized"||a==="detached"||a==="failed"?null:new u.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+a,90001,400)},l.prototype.setChannelSerial=function(a){C.default.logAction(C.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+a+"; previous = "+this.properties.channelSerial),a&&(this.properties.channelSerial=a)},l}(g.default);function d(c){var l=c||{};l.agent;var a=s.__rest(l,["agent"]);return a}t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function o(f,p,g,C,E){this.previous=f,this.current=p,p==="attached"&&(this.resumed=g,this.hasBacklog=C),E&&(this.reason=E)}return o}();t.default=s},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,f=o.lib,p=f.WordArray,g=f.Hasher,C=o.algo,E=[],A=C.SHA1=g.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(I,u){for(var w=this._hash.words,R=w[0],P=w[1],y=w[2],m=w[3],T=w[4],d=0;d<80;d++){if(d<16)E[d]=I[u+d]|0;else{var c=E[d-3]^E[d-8]^E[d-14]^E[d-16];E[d]=c<<1|c>>>31}var l=(R<<5|R>>>27)+T+E[d];d<20?l+=(P&y|~P&m)+1518500249:d<40?l+=(P^y^m)+1859775393:d<60?l+=(P&y|P&m|y&m)-1894007588:l+=(P^y^m)-899497514,T=m,m=y,y=P<<30|P>>>2,P=R,R=l}w[0]=w[0]+R|0,w[1]=w[1]+P|0,w[2]=w[2]+y|0,w[3]=w[3]+m|0,w[4]=w[4]+T|0},_doFinalize:function(){var I=this._data,u=I.words,w=this._nDataBytes*8,R=I.sigBytes*8;return u[R>>>5]|=128<<24-R%32,u[(R+64>>>9<<4)+14]=Math.floor(w/4294967296),u[(R+64>>>9<<4)+15]=w,I.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var I=g.clone.call(this);return I._hash=this._hash.clone(),I}});o.SHA1=g._createHelper(A),o.HmacSHA1=g._createHmacHelper(A)}(),s.SHA1})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});function s(d){if(d===void 0)return"undefined";var c,l;if(d instanceof ArrayBuffer?(l="ArrayBuffer",c=new DataView(d)):d instanceof DataView&&(l="DataView",c=d),!c)return JSON.stringify(d);for(var a=[],v=0;v<d.byteLength;v++){if(v>20){a.push("...");break}var h=c.getUint8(v).toString(16);h.length===1&&(h="0"+h),a.push(h)}return"<"+l+" "+a.join(" ")+">"}function o(d,c,l){for(var a=0,v=l.length;a<v;a++){var h=l.charCodeAt(a);if(h<128){d.setUint8(c++,h>>>0&127|0);continue}if(h<2048){d.setUint8(c++,h>>>6&31|192),d.setUint8(c++,h>>>0&63|128);continue}if(h<65536){d.setUint8(c++,h>>>12&15|224),d.setUint8(c++,h>>>6&63|128),d.setUint8(c++,h>>>0&63|128);continue}if(h<1114112){d.setUint8(c++,h>>>18&7|240),d.setUint8(c++,h>>>12&63|128),d.setUint8(c++,h>>>6&63|128),d.setUint8(c++,h>>>0&63|128);continue}throw new Error("bad codepoint "+h)}}function f(d,c,l){for(var a="",v=c,h=c+l;v<h;v++){var O=d.getUint8(v);if(!(O&128)){a+=String.fromCharCode(O);continue}if((O&224)===192){a+=String.fromCharCode((O&15)<<6|d.getUint8(++v)&63);continue}if((O&240)===224){a+=String.fromCharCode((O&15)<<12|(d.getUint8(++v)&63)<<6|(d.getUint8(++v)&63)<<0);continue}if((O&248)===240){a+=String.fromCharCode((O&7)<<18|(d.getUint8(++v)&63)<<12|(d.getUint8(++v)&63)<<6|(d.getUint8(++v)&63)<<0);continue}throw new Error("Invalid byte "+O.toString(16))}return a}function p(d){for(var c=0,l=0,a=d.length;l<a;l++){var v=d.charCodeAt(l);if(v<128){c+=1;continue}if(v<2048){c+=2;continue}if(v<65536){c+=3;continue}if(v<1114112){c+=4;continue}throw new Error("bad codepoint "+v)}return c}function g(d,c){var l=T(d,c);if(l!==0){var a=new ArrayBuffer(l),v=new DataView(a);return m(d,v,0,c),a}}var C=65536*65536,E=1/C;function A(d,c){return c=c||0,d.getInt32(c)*C+d.getUint32(c+4)}function I(d,c){return c=c||0,d.getUint32(c)*C+d.getUint32(c+4)}function u(d,c,l){l<9223372036854776e3?(d.setInt32(c,Math.floor(l*E)),d.setInt32(c+4,l&-1)):(d.setUint32(c,2147483647),d.setUint32(c+4,2147483647))}function w(d,c,l){l<18446744073709552e3?(d.setUint32(c,Math.floor(l*E)),d.setInt32(c+4,l&-1)):(d.setUint32(c,4294967295),d.setUint32(c+4,4294967295))}var R=function(){function d(c,l){var a=this;this.map=function(v){for(var h={},O=0;O<v;O++){var k=a.parse();h[k]=a.parse()}return h},this.bin=function(v){var h=new ArrayBuffer(v);return new Uint8Array(h).set(new Uint8Array(a.view.buffer,a.offset,v),0),a.offset+=v,h},this.buf=this.bin,this.str=function(v){var h=f(a.view,a.offset,v);return a.offset+=v,h},this.array=function(v){for(var h=new Array(v),O=0;O<v;O++)h[O]=a.parse();return h},this.ext=function(v){return a.offset+=v,{type:a.view.getInt8(a.offset),data:a.buf(v)}},this.parse=function(){var v=a.view.getUint8(a.offset),h,O;if(!(v&128))return a.offset++,v;if((v&240)===128)return O=v&15,a.offset++,a.map(O);if((v&240)===144)return O=v&15,a.offset++,a.array(O);if((v&224)===160)return O=v&31,a.offset++,a.str(O);if((v&224)===224)return h=a.view.getInt8(a.offset),a.offset++,h;switch(v){case 192:return a.offset++,null;case 193:a.offset++;return;case 194:return a.offset++,!1;case 195:return a.offset++,!0;case 196:return O=a.view.getUint8(a.offset+1),a.offset+=2,a.bin(O);case 197:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.bin(O);case 198:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.bin(O);case 199:return O=a.view.getUint8(a.offset+1),a.offset+=2,a.ext(O);case 200:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.ext(O);case 201:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.ext(O);case 202:return h=a.view.getFloat32(a.offset+1),a.offset+=5,h;case 203:return h=a.view.getFloat64(a.offset+1),a.offset+=9,h;case 204:return h=a.view.getUint8(a.offset+1),a.offset+=2,h;case 205:return h=a.view.getUint16(a.offset+1),a.offset+=3,h;case 206:return h=a.view.getUint32(a.offset+1),a.offset+=5,h;case 207:return h=I(a.view,a.offset+1),a.offset+=9,h;case 208:return h=a.view.getInt8(a.offset+1),a.offset+=2,h;case 209:return h=a.view.getInt16(a.offset+1),a.offset+=3,h;case 210:return h=a.view.getInt32(a.offset+1),a.offset+=5,h;case 211:return h=A(a.view,a.offset+1),a.offset+=9,h;case 212:return O=1,a.offset++,a.ext(O);case 213:return O=2,a.offset++,a.ext(O);case 214:return O=4,a.offset++,a.ext(O);case 215:return O=8,a.offset++,a.ext(O);case 216:return O=16,a.offset++,a.ext(O);case 217:return O=a.view.getUint8(a.offset+1),a.offset+=2,a.str(O);case 218:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.str(O);case 219:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.str(O);case 220:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.array(O);case 221:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.array(O);case 222:return O=a.view.getUint16(a.offset+1),a.offset+=3,a.map(O);case 223:return O=a.view.getUint32(a.offset+1),a.offset+=5,a.map(O)}throw new Error("Unknown type 0x"+v.toString(16))},this.offset=l||0,this.view=c}return d}();function P(d){var c=new DataView(d),l=new R(c),a=l.parse();if(l.offset!==d.byteLength)throw new Error(d.byteLength-l.offset+" trailing bytes");return a}function y(d,c){return Object.keys(d).filter(function(l){var a=d[l],v=typeof a;return(!c||a!=null)&&(v!=="function"||!!a.toJSON)})}function m(d,c,l,a){var v=typeof d;if(typeof d=="string"){var h=p(d);if(h<32)return c.setUint8(l,h|160),o(c,l+1,d),1+h;if(h<256)return c.setUint8(l,217),c.setUint8(l+1,h),o(c,l+2,d),2+h;if(h<65536)return c.setUint8(l,218),c.setUint16(l+1,h),o(c,l+3,d),3+h;if(h<4294967296)return c.setUint8(l,219),c.setUint32(l+1,h),o(c,l+5,d),5+h}if(ArrayBuffer.isView&&ArrayBuffer.isView(d)&&(d=d.buffer),d instanceof ArrayBuffer){var O=d.byteLength;if(O<256)return c.setUint8(l,196),c.setUint8(l+1,O),new Uint8Array(c.buffer).set(new Uint8Array(d),l+2),2+O;if(O<65536)return c.setUint8(l,197),c.setUint16(l+1,O),new Uint8Array(c.buffer).set(new Uint8Array(d),l+3),3+O;if(O<4294967296)return c.setUint8(l,198),c.setUint32(l+1,O),new Uint8Array(c.buffer).set(new Uint8Array(d),l+5),5+O}if(typeof d=="number"){if(Math.floor(d)!==d)return c.setUint8(l,203),c.setFloat64(l+1,d),9;if(d>=0){if(d<128)return c.setUint8(l,d),1;if(d<256)return c.setUint8(l,204),c.setUint8(l+1,d),2;if(d<65536)return c.setUint8(l,205),c.setUint16(l+1,d),3;if(d<4294967296)return c.setUint8(l,206),c.setUint32(l+1,d),5;if(d<18446744073709552e3)return c.setUint8(l,207),w(c,l+1,d),9;throw new Error("Number too big 0x"+d.toString(16))}if(d>=-32)return c.setInt8(l,d),1;if(d>=-128)return c.setUint8(l,208),c.setInt8(l+1,d),2;if(d>=-32768)return c.setUint8(l,209),c.setInt16(l+1,d),3;if(d>=-2147483648)return c.setUint8(l,210),c.setInt32(l+1,d),5;if(d>=-9223372036854776e3)return c.setUint8(l,211),u(c,l+1,d),9;throw new Error("Number too small -0x"+(-d).toString(16).substr(1))}if(v==="undefined")return a?0:(c.setUint8(l,212),c.setUint8(l+1,0),c.setUint8(l+2,0),3);if(d===null)return a?0:(c.setUint8(l,192),1);if(v==="boolean")return c.setUint8(l,d?195:194),1;if(typeof d.toJSON=="function")return m(d.toJSON(),c,l,a);if(v==="object"){var k,D=0,_=void 0,x=Array.isArray(d);if(x?k=d.length:(_=y(d,a),k=_.length),k<16?(c.setUint8(l,k|(x?144:128)),D=1):k<65536?(c.setUint8(l,x?220:222),c.setUint16(l+1,k),D=3):k<4294967296&&(c.setUint8(l,x?221:223),c.setUint32(l+1,k),D=5),x)for(var b=0;b<k;b++)D+=m(d[b],c,l+D,a);else if(_)for(var b=0;b<k;b++){var S=_[b];D+=m(S,c,l+D),D+=m(d[S],c,l+D,a)}return D}if(v==="function")return 0;throw new Error("Unknown type "+v)}function T(d,c){var l=typeof d;if(l==="string"){var a=p(d);if(a<32)return 1+a;if(a<256)return 2+a;if(a<65536)return 3+a;if(a<4294967296)return 5+a}if(ArrayBuffer.isView&&ArrayBuffer.isView(d)&&(d=d.buffer),d instanceof ArrayBuffer){var v=d.byteLength;if(v<256)return 2+v;if(v<65536)return 3+v;if(v<4294967296)return 5+v}if(typeof d=="number"){if(Math.floor(d)!==d)return 9;if(d>=0){if(d<128)return 1;if(d<256)return 2;if(d<65536)return 3;if(d<4294967296)return 5;if(d<18446744073709552e3)return 9;throw new Error("Number too big 0x"+d.toString(16))}if(d>=-32)return 1;if(d>=-128)return 2;if(d>=-32768)return 3;if(d>=-2147483648)return 5;if(d>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+d.toString(16).substr(1))}if(l==="boolean")return 1;if(d===null)return c?0:1;if(d===void 0)return c?0:3;if(typeof d.toJSON=="function")return T(d.toJSON(),c);if(l==="object"){var h,O=0;if(Array.isArray(d)){h=d.length;for(var k=0;k<h;k++)O+=T(d[k],c)}else{var D=y(d,c);h=D.length;for(var k=0;k<h;k++){var _=D[k];O+=T(_)+T(d[_],c)}}if(h<16)return 1+O;if(h<65536)return 3+O;if(h<4294967296)return 5+O;throw new Error("Array or object too long 0x"+h.toString(16))}if(l==="function")return 0;throw new Error("Unknown type "+l)}t.default={encode:g,decode:P,inspect:s,utf8Write:o,utf8Read:f,utf8ByteCount:p}},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(30)),f=s.__importDefault(i(50)),p=s.__importDefault(i(3)),g=s.__importDefault(i(4)),C=s.__importDefault(i(55)),E=s.__importDefault(i(57)),A=s.__importDefault(i(62)),I=s.__importDefault(i(64)),u=s.__importDefault(i(68)),w=s.__importDefault(i(2)),R=i(8),P=s.__importDefault(i(65)),y=s.__importDefault(i(66)),m=s.__importDefault(i(41)),T=(0,E.default)(I.default,C.default);p.default.Crypto=T,p.default.BufferUtils=C.default,p.default.Http=A.default,p.default.Config=I.default,p.default.Transports=u.default,p.default.WebStorage=P.default,o.default.Crypto=T,f.default.Crypto=T,w.default.initLogHandlers(),p.default.Defaults=(0,R.getDefaults)(y.default),p.default.Config.agent&&(p.default.Defaults.agent+=" "+p.default.Config.agent),p.default.Config.noUpgrade&&(p.default.Defaults.upgradeTransports=[]),t.default={ErrorInfo:g.default,Rest:o.default,Realtime:f.default,msgpack:m.default}},function(n){n.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.50","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@arethetypeswrong/cli":"^0.13.1","@babel/preset-env":"^7.23.6","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","babel-loader":"^8.3.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","mocha-junit-reporter":"^2.2.1","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0","webpack-node-externals":"^3.0.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(n,t){},function(n,t,i){(function(s,o){n.exports=o(i(6),i(32),i(25))})(this,function(s){return s.HmacSHA256})},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(47)),p=s.__importDefault(i(15)),g=s.__importDefault(i(20)),C=s.__importDefault(i(4)),E=s.__importDefault(i(48)),A=function(){},I=function(){function P(y){this.rest=y,this.admin=new u(y)}return P}(),u=function(){function P(y){this.rest=y,this.deviceRegistrations=new w(y),this.channelSubscriptions=new R(y)}return P.prototype.publish=function(y,m,T){var d=this.rest,c=d.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,l=o.defaultPostHeaders(d.options,c),a={},v=o.mixin({recipient:y},m);if(typeof T!="function"){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);T=A}d.options.headers&&o.mixin(l,d.options.headers),d.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var h=o.encodeBody(v,c);p.default.post(d,"/push/publish",h,l,a,null,function(O){return T(O)})},P}(),w=function(){function P(y){this.rest=y}return P.prototype.save=function(y,m){var T=this.rest,d=f.default.fromValues(y),c=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,l=o.defaultPostHeaders(T.options,c),a={};if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);m=A}T.options.headers&&o.mixin(l,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(d,c);p.default.put(T,"/push/deviceRegistrations/"+encodeURIComponent(y.id),v,l,a,null,function(h,O,k,D){m(h,h?void 0:f.default.fromResponseBody(O,D?void 0:c))})},P.prototype.get=function(y,m){var T=this.rest,d=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,d),l=y.id||y;if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"get",arguments);m=A}if(typeof l!="string"||!l.length){m(new C.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(c,T.options.headers),p.default.get(T,"/push/deviceRegistrations/"+encodeURIComponent(l),c,{},null,function(a,v,h,O){m(a,a?void 0:f.default.fromResponseBody(v,O?void 0:d))})},P.prototype.list=function(y,m){var T=this.rest,d=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:d,l=o.defaultGetHeaders(T.options,d);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);m=A}T.options.headers&&o.mixin(l,T.options.headers),new g.default(T,"/push/deviceRegistrations",l,c,function(a,v,h){return f.default.fromResponseBody(a,h?void 0:d)}).get(y,m)},P.prototype.remove=function(y,m){var T=this.rest,d=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,d),l={},a=y.id||y;if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);m=A}if(typeof a!="string"||!a.length){m(new C.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(l,{fullWait:"true"}),p.default.delete(T,"/push/deviceRegistrations/"+encodeURIComponent(a),c,l,null,function(v){return m(v)})},P.prototype.removeWhere=function(y,m){var T=this.rest,d=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,d);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);m=A}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),p.default.delete(T,"/push/deviceRegistrations",c,y,null,function(l){return m(l)})},P}(),R=function(){function P(y){this.remove=P.prototype.removeWhere,this.rest=y}return P.prototype.save=function(y,m){var T=this.rest,d=E.default.fromValues(y),c=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,l=o.defaultPostHeaders(T.options,c),a={};if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"save",arguments);m=A}T.options.headers&&o.mixin(l,T.options.headers),T.options.pushFullWait&&o.mixin(a,{fullWait:"true"});var v=o.encodeBody(d,c);p.default.post(T,"/push/channelSubscriptions",v,l,a,null,function(h,O,k,D){m(h,!h&&E.default.fromResponseBody(O,D?void 0:c))})},P.prototype.list=function(y,m){var T=this.rest,d=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:d,l=o.defaultGetHeaders(T.options,d);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"list",arguments);m=A}T.options.headers&&o.mixin(l,T.options.headers),new g.default(T,"/push/channelSubscriptions",l,c,function(a,v,h){return E.default.fromResponseBody(a,h?void 0:d)}).get(y,m)},P.prototype.removeWhere=function(y,m){var T=this.rest,d=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultGetHeaders(T.options,d);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);m=A}T.options.headers&&o.mixin(c,T.options.headers),T.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),p.default.delete(T,"/push/channelSubscriptions",c,y,null,function(l){return m(l)})},P.prototype.listChannels=function(y,m){var T=this.rest,d=T.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=this.rest.http.supportsLinkHeaders?void 0:d,l=o.defaultGetHeaders(T.options,d);if(typeof m!="function"){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);m=A}T.options.headers&&o.mixin(l,T.options.headers),T.options.pushFullWait&&o.mixin(y,{fullWait:"true"}),new g.default(T,"/push/channels",l,c,function(a,v,h){for(var O=!h&&d?o.decodeBody(a,d):a,k=0;k<O.length;k++)O[k]=String(O[k]);return O}).get(y,m)},P}();t.default=I},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(4)),p;(function(E){E.Phone="phone",E.Tablet="tablet",E.Desktop="desktop",E.TV="tv",E.Watch="watch",E.Car="car",E.Embedded="embedded",E.Other="other"})(p||(p={}));var g;(function(E){E.Android="android",E.IOS="ios",E.Browser="browser"})(g||(g={}));var C=function(){function E(){}return E.prototype.toJSON=function(){var A,I,u;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(A=this.push)===null||A===void 0?void 0:A.recipient,state:(I=this.push)===null||I===void 0?void 0:I.state,error:(u=this.push)===null||u===void 0?void 0:u.error}}},E.prototype.toString=function(){var A,I,u,w,R="[DeviceDetails";return this.id&&(R+="; id="+this.id),this.platform&&(R+="; platform="+this.platform),this.formFactor&&(R+="; formFactor="+this.formFactor),this.clientId&&(R+="; clientId="+this.clientId),this.metadata&&(R+="; metadata="+this.metadata),this.deviceIdentityToken&&(R+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((A=this.push)===null||A===void 0)&&A.recipient&&(R+="; push.recipient="+JSON.stringify(this.push.recipient)),!((I=this.push)===null||I===void 0)&&I.state&&(R+="; push.state="+this.push.state),!((u=this.push)===null||u===void 0)&&u.error&&(R+="; push.error="+JSON.stringify(this.push.error)),!((w=this.push)===null||w===void 0)&&w.metadata&&(R+="; push.metadata="+this.push.metadata),R+="]",R},E.fromResponseBody=function(A,I){return I&&(A=o.decodeBody(A,I)),o.isArray(A)?E.fromValuesArray(A):E.fromValues(A)},E.fromValues=function(A){return A.error=A.error&&f.default.fromValues(A.error),Object.assign(new E,A)},E.fromValuesArray=function(A){for(var I=A.length,u=new Array(I),w=0;w<I;w++)u[w]=E.fromValues(A[w]);return u},E.toRequestBody=o.encodeBody,E}();t.default=C},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=function(){function p(){}return p.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},p.prototype.toString=function(){var g="[PushChannelSubscription";return this.channel&&(g+="; channel="+this.channel),this.deviceId&&(g+="; deviceId="+this.deviceId),this.clientId&&(g+="; clientId="+this.clientId),g+="]",g},p.fromResponseBody=function(g,C){return C&&(g=o.decodeBody(g,C)),o.isArray(g)?p.fromValuesArray(g):p.fromValues(g)},p.fromValues=function(g){return Object.assign(new p,g)},p.fromValuesArray=function(g){for(var C=g.length,E=new Array(C),A=0;A<C;A++)E[A]=p.fromValues(g[A]);return E},p.toRequestBody=o.encodeBody,p}();t.default=f},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=function(){function T(d){this.count=d&&d.count||0,this.data=d&&d.data||0,this.uncompressedData=d&&d.uncompressedData||0,this.failed=d&&d.failed||0,this.refused=d&&d.refused||0}return T}(),p=function(T){s.__extends(d,T);function d(c){var l=T.call(this,c)||this;return c&&c.category&&(l.category={},o.forInOwnNonNullProperties(c.category,function(a){l.category[a]=new f(c.category[a])})),l}return d}(f),g=function(){function T(d){this.peak=d&&d.peak||0,this.min=d&&d.min||0,this.mean=d&&d.mean||0,this.opened=d&&d.opened||0,this.refused=d&&d.refused||0}return T}(),C=function(){function T(d){this.succeeded=d&&d.succeeded||0,this.failed=d&&d.failed||0,this.refused=d&&d.refused||0}return T}(),E=function(){function T(d){this.plain=new g(d&&d.plain),this.tls=new g(d&&d.tls),this.all=new g(d&&d.all)}return T}(),A=function(){function T(d){this.messages=new p(d&&d.messages),this.presence=new p(d&&d.presence),this.all=new p(d&&d.all)}return T}(),I=function(){function T(d){this.realtime=new A(d&&d.realtime),this.rest=new A(d&&d.rest),this.webhook=new A(d&&d.webhook),this.sharedQueue=new A(d&&d.sharedQueue),this.externalQueue=new A(d&&d.externalQueue),this.httpEvent=new A(d&&d.httpEvent),this.push=new A(d&&d.push),this.all=new A(d&&d.all)}return T}(),u=function(){function T(d){this.all=new A(d&&d.all),this.inbound=new I(d&&d.inbound),this.outbound=new I(d&&d.outbound)}return T}(),w=function(){function T(d){this.all=new A(d&&d.all),this.producerPaid=new u(d&&d.producerPaid),this.consumerPaid=new u(d&&d.consumerPaid)}return T}(),R=function(){function T(d){this.messages=d&&d.messages||0;var c=d&&d.notifications;this.notifications={invalid:c&&c.invalid||0,attempted:c&&c.attempted||0,successful:c&&c.successful||0,failed:c&&c.failed||0},this.directPublishes=d&&d.directPublishes||0}return T}(),P=function(){function T(d){this.succeeded=d&&d.succeeded||0,this.skipped=d&&d.skipped||0,this.failed=d&&d.failed||0}return T}(),y=function(){function T(d){var c=this;this.delta=void 0,d&&d.delta&&(this.delta={},o.forInOwnNonNullProperties(d.delta,function(l){c.delta[l]=new P(d.delta[l])}))}return T}(),m=function(T){s.__extends(d,T);function d(c){var l=T.call(this,c)||this;return l.persisted=new A(c&&c.persisted),l.connections=new E(c&&c.connections),l.channels=new g(c&&c.channels),l.apiRequests=new C(c&&c.apiRequests),l.tokenRequests=new C(c&&c.tokenRequests),l.xchgProducer=new w(c&&c.xchgProducer),l.xchgConsumer=new w(c&&c.xchgConsumer),l.push=new R(c&&c.pushStats),l.processed=new y(c&&c.processed),l.inProgress=c&&c.inProgress||void 0,l.unit=c&&c.unit||void 0,l.intervalId=c&&c.intervalId||void 0,l}return d.fromValues=function(c){return new d(c)},d}(u);t.default=m},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(30)),p=s.__importDefault(i(7)),g=s.__importDefault(i(2)),C=s.__importDefault(i(51)),E=s.__importDefault(i(38)),A=s.__importDefault(i(8)),I=s.__importDefault(i(4)),u=s.__importDefault(i(10)),w=s.__importDefault(i(35)),R=s.__importDefault(i(3)),P=s.__importDefault(i(9)),y=function(T){s.__extends(d,T);function d(c){var l=T.call(this,c)||this;return g.default.logAction(g.default.LOG_MINOR,"Realtime()",""),l.connection=new C.default(l,l.options),l.channels=new m(l),c.autoConnect!==!1&&l.connect(),l}return d.prototype.connect=function(){g.default.logAction(g.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},d.prototype.close=function(){g.default.logAction(g.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},d.Promise=function(c){return c=A.default.objectifyOptions(c),c.promises=!0,new d(c)},d.Callbacks=d,d.Utils=o,d.ConnectionManager=w.default,d.Platform=R.default,d.ProtocolMessage=u.default,d.Message=P.default,d}(f.default),m=function(T){s.__extends(d,T);function d(c){var l=T.call(this)||this;return l.realtime=c,l.all=Object.create(null),c.connection.connectionManager.on("transport.active",function(){l.onTransportActive()}),l}return d.prototype.channelSerials=function(){for(var c={},l=0,a=o.keysArray(this.all,!0);l<a.length;l++){var v=a[l],h=this.all[v];h.properties.channelSerial&&(c[v]=h.properties.channelSerial)}return c},d.prototype.recoverChannels=function(c){for(var l=0,a=o.keysArray(c,!0);l<a.length;l++){var v=a[l],h=this.get(v);h.properties.channelSerial=c[v]}},d.prototype.onChannelMessage=function(c){var l=c.channel;if(l===void 0){g.default.logAction(g.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+c.action);return}var a=this.all[l];if(!a){g.default.logAction(g.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+l);return}a.onMessage(c)},d.prototype.onTransportActive=function(){for(var c in this.all){var l=this.all[c];l.state==="attaching"||l.state==="detaching"?l.checkPendingState():l.state==="suspended"?l._attach(!1,null):l.state==="attached"&&l.requestState("attaching")}},d.prototype.propogateConnectionInterruption=function(c,l){var a={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},v=["attaching","attached","detaching","suspended"],h=a[c];for(var O in this.all){var k=this.all[O];o.arrIn(v,k.state)&&k.notifyState(h,l)}},d.prototype.get=function(c,l){c=String(c);var a=this.all[c];if(!a)a=this.all[c]=new E.default(this.realtime,c,l);else if(l){if(a._shouldReattachToSetOptions(l,a.channelOptions))throw new I.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);a.setOptions(l)}return a},d.prototype.getDerived=function(c,l,a){if(l.filter){var v=o.toBase64(l.filter),h=o.matchDerivedChannel(c);c="[filter=".concat(v).concat(h.qualifierParam,"]").concat(h.channelName)}return this.get(c,a)},d.prototype.release=function(c){c=String(c);var l=this.all[c];if(l){var a=l.getReleaseErr();if(a)throw a;delete this.all[c]}},d}(p.default);t.default=y},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(7)),p=s.__importDefault(i(35)),g=s.__importDefault(i(2)),C=s.__importDefault(i(37)),E=s.__importDefault(i(3));function A(){}var I=function(u){s.__extends(w,u);function w(R,P){var y=u.call(this)||this;return y.whenState=function(m,T){return f.default.prototype.whenState.call(y,m,y.state,T,new C.default(void 0,m))},y.ably=R,y.connectionManager=new p.default(R,P),y.state=y.connectionManager.state.state,y.key=void 0,y.id=void 0,y.errorReason=null,y.connectionManager.on("connectionstate",function(m){var T=y.state=m.current;E.default.Config.nextTick(function(){y.emit(T,m)})}),y.connectionManager.on("update",function(m){E.default.Config.nextTick(function(){y.emit("update",m)})}),y}return w.prototype.connect=function(){g.default.logAction(g.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},w.prototype.ping=function(R){if(g.default.logAction(g.default.LOG_MINOR,"Connection.ping()",""),!R){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);R=A}this.connectionManager.ping(null,R)},w.prototype.close=function(){g.default.logAction(g.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(w.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),w.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},w}(f.default);t.default=I},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PendingMessage=void 0;var s=i(0),o=s.__importDefault(i(10)),f=s.__importStar(i(1)),p=s.__importDefault(i(7)),g=s.__importDefault(i(2)),C=s.__importDefault(i(36)),E=s.__importDefault(i(4)),A=o.default.Action,I=function(){function w(R,P){this.message=R,this.callback=P,this.merged=!1;var y=R.action;this.sendAttempted=!1,this.ackRequired=y==A.MESSAGE||y==A.PRESENCE}return w}();t.PendingMessage=I;var u=function(w){s.__extends(R,w);function R(P){var y=w.call(this)||this;return y.transport=P,y.messageQueue=new C.default,P.on("ack",function(m,T){y.onAck(m,T)}),P.on("nack",function(m,T,d){y.onNack(m,T,d)}),y}return R.prototype.onAck=function(P,y){g.default.logAction(g.default.LOG_MICRO,"Protocol.onAck()","serial = "+P+"; count = "+y),this.messageQueue.completeMessages(P,y)},R.prototype.onNack=function(P,y,m){g.default.logAction(g.default.LOG_ERROR,"Protocol.onNack()","serial = "+P+"; count = "+y+"; err = "+f.inspectError(m)),m||(m=new E.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(P,y,m)},R.prototype.onceIdle=function(P){var y=this.messageQueue;if(y.count()===0){P();return}y.once("idle",P)},R.prototype.send=function(P){P.ackRequired&&this.messageQueue.push(P),g.default.shouldLog(g.default.LOG_MICRO)&&g.default.logAction(g.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(P.message)),P.sendAttempted=!0,this.transport.send(P.message)},R.prototype.getTransport=function(){return this.transport},R.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},R.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},R.prototype.finish=function(){var P=this.transport;this.onceIdle(function(){P.disconnect()})},R}(p.default);t.default=u},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(3)),f=s.__importStar(i(1)),p=s.__importDefault(i(26)),g=s.__importDefault(i(8)),C=s.__importDefault(i(2)),E=s.__importDefault(i(10)),A=s.__importDefault(i(4)),I="web_socket";function u(P){return!!P.on}var w=function(P){s.__extends(y,P);function y(m,T,d){var c=P.call(this,m,T,d)||this;return c.shortName=I,d.heartbeats=o.default.Config.useProtocolHeartbeats,c.wsHost=g.default.getHost(d.options,d.host,!0),c}return y.isAvailable=function(){return!!o.default.Config.WebSocket},y.prototype.createWebSocket=function(m,T){return this.uri=m+f.toQueryString(T),new o.default.Config.WebSocket(this.uri)},y.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},y.prototype.connect=function(){C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),p.default.prototype.connect.call(this);var m=this,T=this.params,d=T.options,c=d.tls?"wss://":"ws://",l=c+this.wsHost+":"+g.default.getPort(d)+"/";C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+l),this.auth.getAuthParams(function(a,v){if(!m.isDisposed){var h="";for(var O in v)h+=" "+O+": "+v[O]+";";if(C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+h+" err: "+a),a){m.disconnect(a);return}var k=T.getConnectParams(v);try{var D=m.wsConnection=m.createWebSocket(l,k);D.binaryType=o.default.Config.binaryType,D.onopen=function(){m.onWsOpen()},D.onclose=function(_){m.onWsClose(_)},D.onmessage=function(_){m.onWsData(_.data)},D.onerror=function(_){m.onWsError(_)},u(D)&&D.on("ping",function(){m.onActivity()})}catch(_){C.default.logAction(C.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(_.stack||_.message)),m.disconnect(_)}}})},y.prototype.send=function(m){var T=this.wsConnection;if(!T){C.default.logAction(C.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{T.send(E.default.serialize(m,this.params.format))}catch(c){var d="Exception from ws connection when trying to send: "+f.inspectError(c);C.default.logAction(C.default.LOG_ERROR,"WebSocketTransport.send()",d),this.finish("disconnected",new A.default(d,5e4,500))}},y.prototype.onWsData=function(m){C.default.logAction(C.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+m.length+"; type = "+typeof m);try{this.onProtocolMessage(E.default.deserialize(m,this.format))}catch(T){C.default.logAction(C.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+T.stack)}},y.prototype.onWsOpen=function(){C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},y.prototype.onWsClose=function(m){var T,d;if(typeof m=="object"?(d=m.code,T=m.wasClean||d===1e3):(d=m,T=d==1e3),delete this.wsConnection,T){C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var c=new A.default("Websocket closed",80003,400);this.finish("disconnected",c)}else{var l="Unclean disconnection of WebSocket ; code = "+d,c=new A.default(l,80003,400);C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.onWsClose()",l),this.finish("disconnected",c)}this.emit("disposed")},y.prototype.onWsError=function(m){var T=this;C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+m.message),o.default.Config.nextTick(function(){T.disconnect(Error(m.message))})},y.prototype.dispose=function(){C.default.logAction(C.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var m=this.wsConnection;m&&(m.onmessage=function(){},delete this.wsConnection,o.default.Config.nextTick(function(){if(C.default.logAction(C.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!m)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");m.close()}))},y}(p.default);function R(P){return w.isAvailable()&&(P.supportedTransports[I]=w),w}t.default=R},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(1)),f=s.__importDefault(i(34)),p=s.__importDefault(i(7)),g=s.__importDefault(i(2)),C=s.__importDefault(i(16)),E=s.__importStar(i(4)),A=s.__importDefault(i(38)),I=s.__importDefault(i(24)),u=s.__importDefault(i(39)),w=function(){};function R(c){return c.channel.realtime.auth.clientId}function P(c){var l=c.channel.realtime,a=l.auth.clientId;return(!a||a==="*")&&l.connection.state==="connected"}function y(c,l,a){switch(c.state){case"attached":case"suspended":a();break;case"initialized":case"detached":case"detaching":case"attaching":c.attach(function(v){v?l(v):a()});break;default:l(E.default.fromValues(c.invalidStateError()))}}function m(c,l){if(c.isSynthesized()||l.isSynthesized())return c.timestamp>=l.timestamp;var a=c.parseId(),v=l.parseId();return a.msgSerial===v.msgSerial?a.index>v.index:a.msgSerial>v.msgSerial}var T=function(c){s.__extends(l,c);function l(a){var v=c.call(this,a)||this;return v.channel=a,v.syncComplete=!1,v.members=new d(v,function(h){return h.clientId+":"+h.connectionId}),v._myMembers=new d(v,function(h){return h.clientId}),v.subscriptions=new p.default,v.pendingPresence=[],v}return l.prototype.enter=function(a,v){if(P(this))throw new E.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"enter",v)},l.prototype.update=function(a,v){if(P(this))throw new E.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,a,"update",v)},l.prototype.enterClient=function(a,v,h){return this._enterOrUpdateClient(void 0,a,v,"enter",h)},l.prototype.updateClient=function(a,v,h){return this._enterOrUpdateClient(void 0,a,v,"update",h)},l.prototype._enterOrUpdateClient=function(a,v,h,O,k){var D=this;if(!k)if(typeof h=="function")k=h,h=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[a,v,h,O]);k=w}var _=this.channel;if(!_.connectionManager.activeState()){k(_.connectionManager.getError());return}g.default.logAction(g.default.LOG_MICRO,"RealtimePresence."+O+"Client()","channel = "+_.name+", id = "+a+", client = "+(v||"(implicit) "+R(this)));var x=C.default.fromData(h);x.action=O,a&&(x.id=a),v&&(x.clientId=v),C.default.encode(x,_.channelOptions,function(b){if(b){k(b);return}switch(_.state){case"attached":_.sendPresence(x,k);break;case"initialized":case"detached":_.attach();case"attaching":D.pendingPresence.push({presence:x,callback:k});break;default:b=new E.PartialErrorInfo("Unable to "+O+" presence channel while in "+_.state+" state",90001),b.code=90001,k(b)}})},l.prototype.leave=function(a,v){if(P(this))throw new E.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,a,v)},l.prototype.leaveClient=function(a,v,h){if(!h)if(typeof v=="function")h=v,v=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[a,v]);h=w}var O=this.channel;if(!O.connectionManager.activeState()){h==null||h(O.connectionManager.getError());return}g.default.logAction(g.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+a);var k=C.default.fromData(v);switch(k.action="leave",a&&(k.clientId=a),O.state){case"attached":O.sendPresence(k,h);break;case"attaching":this.pendingPresence.push({presence:k,callback:h});break;case"initialized":case"failed":{var D=new E.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);h==null||h(D);break}default:h==null||h(O.invalidStateError())}},l.prototype.get=function(a,v){var h=this,O=Array.prototype.slice.call(arguments);O.length==1&&typeof O[0]=="function"&&O.unshift(null),a=O[0],v=O[1];var k=!a||("waitForSync"in a?a.waitForSync:!0);if(!v){if(this.channel.realtime.options.promises)return o.promisify(this,"get",O);v=w}function D(_){v(null,a?_.list(a):_.values())}if(this.channel.state==="suspended"){k?v(E.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):D(this.members);return}y(this.channel,v,function(){var _=h.members;k?_.waitSync(function(){D(_)}):D(_)})},l.prototype.history=function(a,v){if(g.default.logAction(g.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),v===void 0)if(typeof a=="function")v=a,a=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);v=w}a&&a.untilAttach&&(this.channel.state==="attached"?(delete a.untilAttach,a.from_serial=this.channel.properties.attachSerial):v(new E.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),f.default.prototype._history.call(this,a,v)},l.prototype.setPresence=function(a,v,h){g.default.logAction(g.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+a.length+" participants; syncChannelSerial = "+h);var O,k,D=this.members,_=this._myMembers,x=[],b=this.channel.connectionManager.connectionId;v&&(this.members.startSync(),h&&(k=h.match(/^[\w-]+:(.*)$/))&&(O=k[1]));for(var S=0;S<a.length;S++){var L=C.default.fromValues(a[S]);switch(L.action){case"leave":D.remove(L)&&x.push(L),L.connectionId===b&&!L.isSynthesized()&&_.remove(L);break;case"enter":case"present":case"update":D.put(L)&&x.push(L),L.connectionId===b&&_.put(L);break}}v&&!O&&(D.endSync(),this.channel.syncChannelSerial=null);for(var S=0;S<x.length;S++){var L=x[S];this.subscriptions.emit(L.action,L)}},l.prototype.onAttached=function(a){g.default.logAction(g.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+a),a?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var v=this.pendingPresence,h=v.length;if(h){this.pendingPresence=[];var O=[],k=I.default.create();g.default.logAction(g.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+h+" queued presence messages");for(var D=0;D<h;D++){var _=v[D];O.push(_.presence),k.push(_.callback)}this.channel.sendPresence(O,k)}},l.prototype.actOnChannelState=function(a,v,h){switch(a){case"attached":this.onAttached(v);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(h);break}},l.prototype.failPendingPresence=function(a){if(this.pendingPresence.length){g.default.logAction(g.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(a));for(var v=0;v<this.pendingPresence.length;v++)try{this.pendingPresence[v].callback(a)}catch{}this.pendingPresence=[]}},l.prototype._clearMyMembers=function(){this._myMembers.clear()},l.prototype._ensureMyMembersPresent=function(){var a=this,v=this._myMembers,h=function(D){if(D){var _="Presence auto-re-enter failed: "+D.toString(),x=new E.default(_,91004,400);g.default.logAction(g.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",_);var b=new u.default(a.channel.state,a.channel.state,!0,!1,x);a.channel.emit("update",b)}};for(var O in v.map){var k=v.map[O];g.default.logAction(g.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+k.clientId+'" into the presence set'),this._enterOrUpdateClient(k.id,k.clientId,k.data,"enter",h)}},l.prototype._synthesizeLeaves=function(a){var v=this.subscriptions;o.arrForEach(a,function(h){var O=C.default.fromValues({action:"leave",connectionId:h.connectionId,clientId:h.clientId,data:h.data,encoding:h.encoding,timestamp:o.now()});v.emit("leave",O)})},l.prototype.on=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];g.default.renamedMethod("RealtimePresence","on","subscribe"),this.subscribe.apply(this,a)},l.prototype.off=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];g.default.renamedMethod("RealtimePresence","off","unsubscribe"),this.unsubscribe.apply(this,a)},l.prototype.subscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var h=A.default.processListenerArgs(a),O=h[0],k=h[1],D=h[2],_=this.channel;if(!D){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[O,k]);D=w}if(_.state==="failed"){D(E.default.fromValues(_.invalidStateError()));return}this.subscriptions.on(O,k),_.attach(D)},l.prototype.unsubscribe=function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var h=A.default.processListenerArgs(a),O=h[0],k=h[1];this.subscriptions.off(O,k)},l}(f.default),d=function(c){s.__extends(l,c);function l(a,v){var h=c.call(this)||this;return h.presence=a,h.map=Object.create(null),h.syncInProgress=!1,h.residualMembers=null,h.memberKey=v,h}return l.prototype.get=function(a){return this.map[a]},l.prototype.getClient=function(a){var v=this.map,h=[];for(var O in v){var k=v[O];k.clientId==a&&k.action!="absent"&&h.push(k)}return h},l.prototype.list=function(a){var v=this.map,h=a&&a.clientId,O=a&&a.connectionId,k=[];for(var D in v){var _=v[D];_.action!=="absent"&&(h&&h!=_.clientId||O&&O!=_.connectionId||k.push(_))}return k},l.prototype.put=function(a){(a.action==="enter"||a.action==="update")&&(a=C.default.fromValues(a),a.action="present");var v=this.map,h=this.memberKey(a);this.residualMembers&&delete this.residualMembers[h];var O=v[h];return O&&!m(a,O)?!1:(v[h]=a,!0)},l.prototype.values=function(){var a=this.map,v=[];for(var h in a){var O=a[h];O.action!="absent"&&v.push(O)}return v},l.prototype.remove=function(a){var v=this.map,h=this.memberKey(a),O=v[h];return O&&!m(a,O)?!1:(this.syncInProgress?(a=C.default.fromValues(a),a.action="absent",v[h]=a):delete v[h],!0)},l.prototype.startSync=function(){var a=this.map,v=this.syncInProgress;g.default.logAction(g.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),this.syncInProgress||(this.residualMembers=o.copy(a),this.setInProgress(!0))},l.prototype.endSync=function(){var a=this.map,v=this.syncInProgress;if(g.default.logAction(g.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),v){for(var h in a){var O=a[h];O.action==="absent"&&delete a[h]}this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers));for(var h in this.residualMembers)delete a[h];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},l.prototype.waitSync=function(a){var v=this.syncInProgress;if(g.default.logAction(g.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),!v){a();return}this.once("sync",a)},l.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},l.prototype.setInProgress=function(a){g.default.logAction(g.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+a),this.syncInProgress=a,this.presence.syncComplete=!a},l}(p.default);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=i(56),f=i(31),p=i(11),g=s.__importDefault(i(5)),C=s.__importDefault(i(3)),E=function(){function A(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return A.prototype.isWordArray=function(I){return I!=null&&I.sigBytes!==void 0},A.prototype.isArrayBuffer=function(I){return I!=null&&I.constructor===ArrayBuffer},A.prototype.isTypedArray=function(I){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(I)},A.prototype.uint8ViewToBase64=function(I){for(var u="",w=this.base64CharSet,R=I.byteLength,P=R%3,y=R-P,m,T,d,c,l,a=0;a<y;a=a+3)l=I[a]<<16|I[a+1]<<8|I[a+2],m=(l&16515072)>>18,T=(l&258048)>>12,d=(l&4032)>>6,c=l&63,u+=w[m]+w[T]+w[d]+w[c];return P==1?(l=I[y],m=(l&252)>>2,T=(l&3)<<4,u+=w[m]+w[T]+"=="):P==2&&(l=I[y]<<8|I[y+1],m=(l&64512)>>10,T=(l&1008)>>4,d=(l&15)<<2,u+=w[m]+w[T]+w[d]+"="),u},A.prototype.base64ToArrayBuffer=function(I){for(var u=atob==null?void 0:atob(I),w=u.length,R=new Uint8Array(w),P=0;P<w;P++){var y=u.charCodeAt(P);R[P]=y}return R.buffer},A.prototype.isBuffer=function(I){return this.isArrayBuffer(I)||this.isWordArray(I)||this.isTypedArray(I)},A.prototype.toBuffer=function(I){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(I))return new Uint8Array(I);if(this.isTypedArray(I))return new Uint8Array(I.buffer);if(this.isWordArray(I)){for(var u=new ArrayBuffer(I.sigBytes),w=new Uint8Array(u),R=0;R<I.sigBytes;R++)w[R]=I.words[R>>>2]>>>24-R%4*8&255;return w}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},A.prototype.toArrayBuffer=function(I){return this.isArrayBuffer(I)?I:this.toBuffer(I).buffer},A.prototype.toWordArray=function(I){return this.isTypedArray(I)&&(I=I.buffer),this.isWordArray(I)?I:g.default.create(I)},A.prototype.base64Encode=function(I){return this.isWordArray(I)?(0,p.stringify)(I):this.uint8ViewToBase64(this.toBuffer(I))},A.prototype.base64Decode=function(I){return ArrayBuffer&&C.default.Config.atob?this.base64ToArrayBuffer(I):(0,p.parse)(I)},A.prototype.hexEncode=function(I){return(0,o.stringify)(this.toWordArray(I))},A.prototype.hexDecode=function(I){var u=(0,o.parse)(I);return ArrayBuffer?this.toArrayBuffer(u):u},A.prototype.utf8Encode=function(I){return C.default.Config.TextEncoder?new C.default.Config.TextEncoder().encode(I).buffer:(0,f.parse)(I)},A.prototype.utf8Decode=function(I){if(!this.isBuffer(I))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(I)?new TextDecoder().decode(I):(I=this.toWordArray(I),(0,f.stringify)(I))},A.prototype.bufferCompare=function(I,u){if(!I)return-1;if(!u)return 1;var w=this.toWordArray(I),R=this.toWordArray(u);w.clamp(),R.clamp();var P=w.sigBytes-R.sigBytes;if(P!=0)return P;for(var y=w.words,m=R.words,T=0;T<y.length;T++)if(P=y[T]-m[T],P!=0)return P;return 0},A.prototype.byteLength=function(I){return this.isArrayBuffer(I)||this.isTypedArray(I)?I.byteLength:this.isWordArray(I)?I.sigBytes:-1},A.prototype.typedArrayToBuffer=function(I){return I.buffer},A}();t.default=new E},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return s.enc.Hex})},function(n,t,i){i.r(t);var s=i(5),o=i.n(s),f=i(11),p=i(23),g=i.n(p),C=i(2),E=i.n(C),A=i(4),I=i.n(A),u=function(w,R){var P="aes",y=256,m="cbc",T=16,d=4,c=4294967296,l=2147483648,a;if(w.getRandomWordArray)a=w.getRandomWordArray;else if(typeof Uint32Array<"u"&&w.getRandomValues){var v=new Uint32Array(d);a=function(S,L){var U=S/4,j=U==d?v:new Uint32Array(U);w.getRandomValues(j,function($){typeof L<"u"&&L($,R.toWordArray(j))})}}else a=function(S,L){E.a.logAction(E.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var U=S/4,j=new Array(U),$=0;$<U;$++)j[$]=Math.floor(Math.random()*c)-l;L(null,o.a.create(j))};function h(S){return S+T&-T}function O(S){if(S.algorithm==="aes"&&S.mode==="cbc"){if(S.keyLength===128||S.keyLength===256)return;throw new Error("Unsupported key length "+S.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function k(S){return S.replace("_","/").replace("-","+")}var D=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function _(){}function x(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}_.CipherParams=x,_.getDefaultParams=function(S){var L;if(typeof S=="function"||typeof S=="string"){if(E.a.deprecated("The ability to pass a callback to `Crypto.getDefaultParams()`","This method now directly returns its result, instead of returning it asynchronously via a callback. Please update your code so that it uses the return value of this method instead of passing a callback."),typeof S=="function")E.a.deprecated("The ability to call `Crypto.getDefaultParams()` without specifying an encryption key","Please update your code so that it instead passes an object whose `key` property contains an encryption key. That is, replace `Crypto.getDefaultParams()` with `Crypto.getDefaultParams({ key })`, where `key` is an encryption key that you have generated (for example from the `Crypto.generateRandomKey()` method)."),_.generateRandomKey(function(j){S(null,_.getDefaultParams({key:j}))});else if(typeof arguments[1]=="function")E.a.deprecated("The ability to pass the encryption key as the first argument of `Crypto.getDefaultParams()`","Please update your code so that it instead passes an object whose `key` property contains the key. That is, replace `Crypto.getDefaultParams(key)` with `Crypto.getDefaultParams({ key })`."),arguments[1](null,_.getDefaultParams({key:S}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!S.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof S.key=="string"?L=Object(f.parse)(k(S.key)):L=R.toWordArray(S.key);var U=new x;if(U.key=L,U.algorithm=S.algorithm||P,U.keyLength=L.words.length*(4*8),U.mode=S.mode||m,S.keyLength&&S.keyLength!==U.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+S.keyLength+" was specified, but the key actually has length "+U.keyLength);return O(U),U},_.generateRandomKey=function(S,L){arguments.length==1&&typeof S=="function"&&(L=S,S=void 0),a((S||y)/8,function(U,j){L!==void 0&&L(U?I.a.fromValues(U):null,j)})},_.getCipher=function(S){var L=S instanceof x?S:_.getDefaultParams(S);return{cipherParams:L,cipher:new b(L,d,S.iv)}};function b(S,L,U){this.algorithm=S.algorithm+"-"+String(S.keyLength)+"-"+S.mode,this.cjsAlgorithm=S.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=R.toWordArray(S.key),U&&(this.iv=R.toWordArray(U).clone()),this.blockLengthWords=L}return b.prototype.encrypt=function(S,L){E.a.logAction(E.a.LOG_MICRO,"CBCCipher.encrypt()",""),S=R.toWordArray(S);var U=S.sigBytes,j=h(U),$=this,V=function(){$.getIv(function(H,M){if(H){L(H);return}var N=$.encryptCipher.process(S.concat(D[j-U])),F=M.concat(N);L(null,F)})};this.encryptCipher?V():this.iv?(this.encryptCipher=g.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),V()):a(T,function(H,M){if(H){L(H);return}$.encryptCipher=g.a.algo[$.cjsAlgorithm].createEncryptor($.key,{iv:M}),$.iv=M,V()})},b.prototype.decrypt=function(S){E.a.logAction(E.a.LOG_MICRO,"CBCCipher.decrypt()",""),S=R.toWordArray(S);var L=this.blockLengthWords,U=S.words,j=o.a.create(U.slice(0,L)),$=o.a.create(U.slice(L)),V=g.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:j}),H=V.process($),M=V.finalize();return V.reset(),M&&M.sigBytes&&H.concat(M),H},b.prototype.getIv=function(S){if(this.iv){var L=this.iv;this.iv=null,S(null,L);return}var U=this;a(T,function(j,$){if(j){S(j);return}S(null,U.encryptCipher.process($))})},_};t.default=u},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(){var o=s,f=o.lib,p=f.WordArray,g=o.enc;g.Utf16=g.Utf16BE={stringify:function(E){for(var A=E.words,I=E.sigBytes,u=[],w=0;w<I;w+=2){var R=A[w>>>2]>>>16-w%4*8&65535;u.push(String.fromCharCode(R))}return u.join("")},parse:function(E){for(var A=E.length,I=[],u=0;u<A;u++)I[u>>>1]|=E.charCodeAt(u)<<16-u%2*16;return p.create(I,A*2)}},g.Utf16LE={stringify:function(E){for(var A=E.words,I=E.sigBytes,u=[],w=0;w<I;w+=2){var R=C(A[w>>>2]>>>16-w%4*8&65535);u.push(String.fromCharCode(R))}return u.join("")},parse:function(E){for(var A=E.length,I=[],u=0;u<A;u++)I[u>>>1]|=C(E.charCodeAt(u)<<16-u%2*16);return p.create(I,A*2)}};function C(E){return E<<8&4278255360|E>>>8&16711935}}(),s.enc.Utf16})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(28))})(this,function(s){return function(o){var f=s,p=f.lib,g=p.CipherParams,C=f.enc,E=C.Hex,A=f.format;A.Hex={stringify:function(I){return I.ciphertext.toString(E)},parse:function(I){var u=E.parse(I);return g.create({ciphertext:u})}}}(),s.format.Hex})},function(n,t,i){(function(s,o){n.exports=o(i(6),i(11),i(61),i(27),i(28))})(this,function(s){return function(){var o=s,f=o.lib,p=f.BlockCipher,g=o.algo,C=[],E=[],A=[],I=[],u=[],w=[],R=[],P=[],y=[],m=[];(function(){for(var c=[],l=0;l<256;l++)l<128?c[l]=l<<1:c[l]=l<<1^283;for(var a=0,v=0,l=0;l<256;l++){var h=v^v<<1^v<<2^v<<3^v<<4;h=h>>>8^h&255^99,C[a]=h,E[h]=a;var O=c[a],k=c[O],D=c[k],_=c[h]*257^h*16843008;A[a]=_<<24|_>>>8,I[a]=_<<16|_>>>16,u[a]=_<<8|_>>>24,w[a]=_;var _=D*16843009^k*65537^O*257^a*16843008;R[h]=_<<24|_>>>8,P[h]=_<<16|_>>>16,y[h]=_<<8|_>>>24,m[h]=_,a?(a=O^c[c[c[D^O]]],v^=c[c[v]]):a=v=1}})();var T=[0,1,2,4,8,16,32,64,128,27,54],d=g.AES=p.extend({_doReset:function(){var c;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var l=this._keyPriorReset=this._key,a=l.words,v=l.sigBytes/4,h=this._nRounds=v+6,O=(h+1)*4,k=this._keySchedule=[],D=0;D<O;D++)D<v?k[D]=a[D]:(c=k[D-1],D%v?v>6&&D%v==4&&(c=C[c>>>24]<<24|C[c>>>16&255]<<16|C[c>>>8&255]<<8|C[c&255]):(c=c<<8|c>>>24,c=C[c>>>24]<<24|C[c>>>16&255]<<16|C[c>>>8&255]<<8|C[c&255],c^=T[D/v|0]<<24),k[D]=k[D-v]^c);for(var _=this._invKeySchedule=[],x=0;x<O;x++){var D=O-x;if(x%4)var c=k[D];else var c=k[D-4];x<4||D<=4?_[x]=c:_[x]=R[C[c>>>24]]^P[C[c>>>16&255]]^y[C[c>>>8&255]]^m[C[c&255]]}}},encryptBlock:function(c,l){this._doCryptBlock(c,l,this._keySchedule,A,I,u,w,C)},decryptBlock:function(c,l){var a=c[l+1];c[l+1]=c[l+3],c[l+3]=a,this._doCryptBlock(c,l,this._invKeySchedule,R,P,y,m,E);var a=c[l+1];c[l+1]=c[l+3],c[l+3]=a},_doCryptBlock:function(c,l,a,v,h,O,k,D){for(var _=this._nRounds,x=c[l]^a[0],b=c[l+1]^a[1],S=c[l+2]^a[2],L=c[l+3]^a[3],U=4,j=1;j<_;j++){var $=v[x>>>24]^h[b>>>16&255]^O[S>>>8&255]^k[L&255]^a[U++],V=v[b>>>24]^h[S>>>16&255]^O[L>>>8&255]^k[x&255]^a[U++],H=v[S>>>24]^h[L>>>16&255]^O[x>>>8&255]^k[b&255]^a[U++],M=v[L>>>24]^h[x>>>16&255]^O[b>>>8&255]^k[S&255]^a[U++];x=$,b=V,S=H,L=M}var $=(D[x>>>24]<<24|D[b>>>16&255]<<16|D[S>>>8&255]<<8|D[L&255])^a[U++],V=(D[b>>>24]<<24|D[S>>>16&255]<<16|D[L>>>8&255]<<8|D[x&255])^a[U++],H=(D[S>>>24]<<24|D[L>>>16&255]<<16|D[x>>>8&255]<<8|D[b&255])^a[U++],M=(D[L>>>24]<<24|D[x>>>16&255]<<16|D[b>>>8&255]<<8|D[S&255])^a[U++];c[l]=$,c[l+1]=V,c[l+2]=H,c[l+3]=M},keySize:256/32});o.AES=p._createHelper(d)}(),s.AES})},function(n,t,i){(function(s,o){n.exports=o(i(6))})(this,function(s){return function(o){var f=s,p=f.lib,g=p.WordArray,C=p.Hasher,E=f.algo,A=[];(function(){for(var y=0;y<64;y++)A[y]=o.abs(o.sin(y+1))*4294967296|0})();var I=E.MD5=C.extend({_doReset:function(){this._hash=new g.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,m){for(var T=0;T<16;T++){var d=m+T,c=y[d];y[d]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}var l=this._hash.words,a=y[m+0],v=y[m+1],h=y[m+2],O=y[m+3],k=y[m+4],D=y[m+5],_=y[m+6],x=y[m+7],b=y[m+8],S=y[m+9],L=y[m+10],U=y[m+11],j=y[m+12],$=y[m+13],V=y[m+14],H=y[m+15],M=l[0],N=l[1],F=l[2],B=l[3];M=u(M,N,F,B,a,7,A[0]),B=u(B,M,N,F,v,12,A[1]),F=u(F,B,M,N,h,17,A[2]),N=u(N,F,B,M,O,22,A[3]),M=u(M,N,F,B,k,7,A[4]),B=u(B,M,N,F,D,12,A[5]),F=u(F,B,M,N,_,17,A[6]),N=u(N,F,B,M,x,22,A[7]),M=u(M,N,F,B,b,7,A[8]),B=u(B,M,N,F,S,12,A[9]),F=u(F,B,M,N,L,17,A[10]),N=u(N,F,B,M,U,22,A[11]),M=u(M,N,F,B,j,7,A[12]),B=u(B,M,N,F,$,12,A[13]),F=u(F,B,M,N,V,17,A[14]),N=u(N,F,B,M,H,22,A[15]),M=w(M,N,F,B,v,5,A[16]),B=w(B,M,N,F,_,9,A[17]),F=w(F,B,M,N,U,14,A[18]),N=w(N,F,B,M,a,20,A[19]),M=w(M,N,F,B,D,5,A[20]),B=w(B,M,N,F,L,9,A[21]),F=w(F,B,M,N,H,14,A[22]),N=w(N,F,B,M,k,20,A[23]),M=w(M,N,F,B,S,5,A[24]),B=w(B,M,N,F,V,9,A[25]),F=w(F,B,M,N,O,14,A[26]),N=w(N,F,B,M,b,20,A[27]),M=w(M,N,F,B,$,5,A[28]),B=w(B,M,N,F,h,9,A[29]),F=w(F,B,M,N,x,14,A[30]),N=w(N,F,B,M,j,20,A[31]),M=R(M,N,F,B,D,4,A[32]),B=R(B,M,N,F,b,11,A[33]),F=R(F,B,M,N,U,16,A[34]),N=R(N,F,B,M,V,23,A[35]),M=R(M,N,F,B,v,4,A[36]),B=R(B,M,N,F,k,11,A[37]),F=R(F,B,M,N,x,16,A[38]),N=R(N,F,B,M,L,23,A[39]),M=R(M,N,F,B,$,4,A[40]),B=R(B,M,N,F,a,11,A[41]),F=R(F,B,M,N,O,16,A[42]),N=R(N,F,B,M,_,23,A[43]),M=R(M,N,F,B,S,4,A[44]),B=R(B,M,N,F,j,11,A[45]),F=R(F,B,M,N,H,16,A[46]),N=R(N,F,B,M,h,23,A[47]),M=P(M,N,F,B,a,6,A[48]),B=P(B,M,N,F,x,10,A[49]),F=P(F,B,M,N,V,15,A[50]),N=P(N,F,B,M,D,21,A[51]),M=P(M,N,F,B,j,6,A[52]),B=P(B,M,N,F,O,10,A[53]),F=P(F,B,M,N,L,15,A[54]),N=P(N,F,B,M,v,21,A[55]),M=P(M,N,F,B,b,6,A[56]),B=P(B,M,N,F,H,10,A[57]),F=P(F,B,M,N,_,15,A[58]),N=P(N,F,B,M,$,21,A[59]),M=P(M,N,F,B,k,6,A[60]),B=P(B,M,N,F,U,10,A[61]),F=P(F,B,M,N,h,15,A[62]),N=P(N,F,B,M,S,21,A[63]),l[0]=l[0]+M|0,l[1]=l[1]+N|0,l[2]=l[2]+F|0,l[3]=l[3]+B|0},_doFinalize:function(){var y=this._data,m=y.words,T=this._nDataBytes*8,d=y.sigBytes*8;m[d>>>5]|=128<<24-d%32;var c=o.floor(T/4294967296),l=T;m[(d+64>>>9<<4)+15]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,m[(d+64>>>9<<4)+14]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360,y.sigBytes=(m.length+1)*4,this._process();for(var a=this._hash,v=a.words,h=0;h<4;h++){var O=v[h];v[h]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360}return a},clone:function(){var y=C.clone.call(this);return y._hash=this._hash.clone(),y}});function u(y,m,T,d,c,l,a){var v=y+(m&T|~m&d)+c+a;return(v<<l|v>>>32-l)+m}function w(y,m,T,d,c,l,a){var v=y+(m&d|T&~d)+c+a;return(v<<l|v>>>32-l)+m}function R(y,m,T,d,c,l,a){var v=y+(m^T^d)+c+a;return(v<<l|v>>>32-l)+m}function P(y,m,T,d,c,l,a){var v=y+(T^(m|~d))+c+a;return(v<<l|v>>>32-l)+m}f.MD5=C._createHelper(I),f.HmacMD5=C._createHmacHelper(I)}(Math),s.MD5})},function(n,t,i){var s;Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),f=o.__importDefault(i(3)),p=o.__importStar(i(1)),g=o.__importDefault(i(8)),C=i(4),E=o.__importDefault(i(19)),A=o.__importDefault(i(17)),I=o.__importDefault(i(22)),u=o.__importDefault(i(2)),w=i(29),R=o.__importDefault(i(63)),P=i(14);function y(d){var c=d.statusCode;return c===408&&!d.code||c===400&&!d.code||c>=500&&c<=504}function m(d){var c=d.connection,l=c&&c.connectionManager.host;return l?[l].concat(g.default.getFallbackHosts(d.options)):g.default.getHosts(d.options)}var T=(s=function(){function d(c){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=m,this.options=c||{};var l=this.options.connectivityCheckUrl||g.default.connectivityCheckUrl,a=this.options.connectivityCheckParams,v=!this.options.connectivityCheckUrl;f.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(h,O,k,D,_,x,b){var S=A.default.createRequest(k,D,_,x,I.default.REQ_SEND,O&&O.options.timeouts,h);return S.once("complete",b),S.exec(),S},this.options.disableConnectivityCheck?this.checkConnectivity=function(h){h(null,!0)}:this.checkConnectivity=function(h){u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+l),this.doUri(E.default.Get,null,l,null,null,a,function(O,k,D,_,x){var b=!1;v?b=!O&&(k==null?void 0:k.replace(/\n/,""))=="yes":b=!O&&(0,P.isSuccessCode)(x),u.default.logAction(u.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+b),h(null,b)})}):f.default.Config.jsonpSupported?(this.Request=function(h,O,k,D,_,x,b){var S=(0,w.createRequest)(k,D,_,x,I.default.REQ_SEND,O&&O.options.timeouts,h);return S.once("complete",b),f.default.Config.nextTick(function(){S.exec()}),S},this.options.disableConnectivityCheck?this.checkConnectivity=function(h){h(null,!0)}:this.checkConnectivity=function(h){var O=this,k=g.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(h);return}this.checksInProgress=[h],u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+k);var D=new w.Request("isTheInternetUp",k,null,null,null,I.default.REQ_SEND,g.default.TIMEOUTS);D.once("complete",function(_,x){var b=!_&&x;u.default.logAction(u.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+b);for(var S=0;S<O.checksInProgress.length;S++)O.checksInProgress[S](null,b);O.checksInProgress=null}),f.default.Config.nextTick(function(){D.exec()})}):f.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=R.default,this.checkConnectivity=function(h){u.default.logAction(u.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+l),this.doUri(E.default.Get,null,l,null,null,null,function(O,k){var D=!O&&(k==null?void 0:k.replace(/\n/,""))=="yes";u.default.logAction(u.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+D),h(null,D)})}):this.Request=function(h,O,k,D,_,x,b){b(new C.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return d.prototype.do=function(c,l,a,v,h,O,k){var D=this,_=typeof a=="function"?a:function(L){return l.baseUri(L)+a},x=l._currentFallback;if(x)if(x.validUntil>p.now()){if(!this.Request){k==null||k(new C.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,l,_(x.host),v,O,h,function(L){for(var U=[],j=1;j<arguments.length;j++)U[j-1]=arguments[j];if(L&&y(L)){l._currentFallback=null,D.do(c,l,a,v,h,O,k);return}k==null||k.apply(void 0,o.__spreadArray([L],U,!1))});return}else l._currentFallback=null;var b=m(l);if(b.length===1){this.doUri(c,l,_(b[0]),v,h,O,k);return}var S=function(L,U){var j=L.shift();D.doUri(c,l,_(j),v,h,O,function($){for(var V=[],H=1;H<arguments.length;H++)V[H-1]=arguments[H];if($&&y($)&&L.length){S(L,!0);return}U&&(l._currentFallback={host:j,validUntil:p.now()+l.options.timeouts.fallbackRetryTimeout}),k==null||k.apply(void 0,o.__spreadArray([$],V,!1))})};S(b)},d.prototype.doUri=function(c,l,a,v,h,O,k){if(!this.Request){k(new C.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(c,l,a,v,O,h,k)},d}(),s.methods=[E.default.Get,E.default.Delete,E.default.Post,E.default.Put,E.default.Patch],s.methodsWithoutBody=[E.default.Get,E.default.Delete],s.methodsWithBody=[E.default.Post,E.default.Put,E.default.Patch],s);t.default=T},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importStar(i(4)),f=s.__importDefault(i(3)),p=s.__importDefault(i(8)),g=s.__importStar(i(1)),C=i(1);function E(u,w){return!!w.get("x-ably-errorcode")}function A(u,w){if(E(u,w))return u.error&&o.default.fromValues(u.error)}function I(u,w,R,P,y,m,T){var d=new Headers(P||{}),c=u?u.toUpperCase():g.isEmptyArg(m)?"GET":"POST",l=new AbortController,a=setTimeout(function(){l.abort(),T(new o.PartialErrorInfo("Request timed out",null,408))},w?w.options.timeouts.httpRequestTimeout:p.default.TIMEOUTS.httpRequestTimeout),v={method:c,headers:d,body:m};f.default.Config.isWebworker||(v.credentials=d.has("authorization")?"include":"same-origin"),(0,C.getGlobalObject)().fetch(R+"?"+new URLSearchParams(y||{}),v).then(function(h){clearTimeout(a);var O=h.headers.get("Content-Type"),k;O&&O.indexOf("application/x-msgpack")>-1?k=h.arrayBuffer():O&&O.indexOf("application/json")>-1?k=h.json():k=h.text(),k.then(function(D){var _=!!O&&O.indexOf("application/x-msgpack")===-1;if(h.ok)T(null,D,h.headers,_,h.status);else{var x=A(D,h.headers)||new o.PartialErrorInfo("Error response received from server: "+h.status+" body was: "+f.default.Config.inspect(D),null,h.status);T(x,D,h.headers,_,h.status)}})}).catch(function(h){clearTimeout(a),T(h)})}t.default=I},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(41)),f=s.__importStar(i(1)),p=f.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function g(){var I=p.location;return!p.WebSocket||!I||!I.origin||I.origin.indexOf("http")>-1}var C=p.navigator&&p.navigator.userAgent.toString(),E=p.location&&p.location.href,A={agent:"browser",logTimestamps:!0,userAgent:C,currentUrl:E,noUpgrade:C&&!!C.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:p.WebSocket,fetchSupported:!!p.fetch,xhrSupported:p.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:g(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:o.default,supportsBinary:!!p.TextDecoder,preferBinary:!1,ArrayBuffer:p.ArrayBuffer,atob:p.atob,nextTick:typeof p.setImmediate<"u"?p.setImmediate.bind(p):function(I){setTimeout(I,0)},addEventListener:p.addEventListener,inspect:JSON.stringify,stringByteSize:function(I){return p.TextDecoder&&new p.TextEncoder().encode(I).length||I.length},TextEncoder:p.TextEncoder,TextDecoder:p.TextDecoder,Promise:p.Promise,getRandomValues:function(I){if(I!==void 0)return function(u,w){I.getRandomValues(u),w&&w(null)}}(p.crypto||msCrypto)};t.default=A},function(n,t,i){(function(s){Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),f=o.__importStar(i(1)),p="ablyjs-storage-test",g=function(){function C(){try{s.sessionStorage.setItem(p,p),s.sessionStorage.removeItem(p),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{s.localStorage.setItem(p,p),s.localStorage.removeItem(p),this.localSupported=!0}catch{this.localSupported=!1}}return C.prototype.get=function(E){return this._get(E,!1)},C.prototype.getSession=function(E){return this._get(E,!0)},C.prototype.remove=function(E){return this._remove(E,!1)},C.prototype.removeSession=function(E){return this._remove(E,!0)},C.prototype.set=function(E,A,I){return this._set(E,A,I,!1)},C.prototype.setSession=function(E,A,I){return this._set(E,A,I,!0)},C.prototype._set=function(E,A,I,u){var w={value:A};return I&&(w.expires=f.now()+I),this.storageInterface(u).setItem(E,JSON.stringify(w))},C.prototype._get=function(E,A){if(A&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!A&&!this.localSupported)throw new Error("Local Storage not supported");var I=this.storageInterface(A).getItem(E);if(!I)return null;var u=JSON.parse(I);return u.expires&&u.expires<f.now()?(this.storageInterface(A).removeItem(E),null):u.value},C.prototype._remove=function(E,A){return this.storageInterface(A).removeItem(E)},C.prototype.storageInterface=function(E){return E?s.sessionStorage:s.localStorage},C}();t.default=new g}).call(this,i(13))},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s=i(0),o=s.__importDefault(i(67)),f={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],baseTransportOrder:[o.default.XhrPolling,o.default.XhrStreaming,o.default.JsonP,o.default.WebSocket],transportPreferenceOrder:[o.default.JsonP,o.default.XhrPolling,o.default.XhrStreaming,o.default.WebSocket],upgradeTransports:[o.default.XhrStreaming,o.default.WebSocket]};t.default=f},function(n,t,i){Object.defineProperty(t,"__esModule",{value:!0});var s;(function(o){o.WebSocket="web_socket",o.Comet="comet",o.XhrStreaming="xhr_streaming",o.XhrPolling="xhr_polling",o.JsonP="jsonp"})(s||(s={})),t.default=s},function(n,t,i){i.r(t);var s=i(29),o=i.n(s),f=i(1),p=i(3),g=i.n(p),C=i(12),E=i.n(C),A=i(17),I=i.n(A),u=function(y){var m="xhr_polling";function T(d,c,l){l.stream=!1,E.a.call(this,d,c,l),this.shortName=m}return f.inherits(T,E.a),T.isAvailable=function(){return g.a.Config.xhrSupported&&g.a.Config.allowComet},T.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(d,c,l,a,v){return I.a.createRequest(d,c,l,a,v,this.timeouts)},typeof y<"u"&&T.isAvailable()&&(y.supportedTransports[m]=T),T},w=u,R=function(y){var m="xhr_streaming";function T(d,c,l){E.a.call(this,d,c,l),this.shortName=m}return f.inherits(T,E.a),T.isAvailable=function(){return g.a.Config.xhrSupported&&g.a.Config.streamingSupported&&g.a.Config.allowComet},T.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},T.prototype.createRequest=function(d,c,l,a,v){return I.a.createRequest(d,c,l,a,v,this.timeouts)},typeof y<"u"&&T.isAvailable()&&(y.supportedTransports[m]=T),T},P=R;t.default=[o.a,w,P]}]).default})})(Hr);var Gr=Hr.exports;const cs=yn(Gr),zu=si({__proto__:null,default:cs},[Gr]);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ee=function(){return Ee=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ee.apply(this,arguments)},fs=function(){function r(e){this.options=e,this.listeners={}}return r.prototype.on=function(e,n){var t=this.listeners[e]||[];this.listeners[e]=t.concat([n])},r.prototype.triggerEvent=function(e,n){var t=this,i=this.listeners[e]||[];i.forEach(function(s){return s({target:t,event:n})})},r}(),Ke;(function(r){r[r.Add=0]="Add",r[r.Remove=1]="Remove"})(Ke||(Ke={}));var ds=function(){function r(){this.notifications=[]}return r.prototype.push=function(e){this.notifications.push(e),this.updateFn(e,Ke.Add,this.notifications)},r.prototype.splice=function(e,n){var t=this.notifications.splice(e,n)[0];return this.updateFn(t,Ke.Remove,this.notifications),t},r.prototype.indexOf=function(e){return this.notifications.indexOf(e)},r.prototype.onUpdate=function(e){this.updateFn=e},r}(),ke;(function(r){r.Dismiss="dismiss",r.Click="click"})(ke||(ke={}));var Bn={types:[{type:"success",className:"notyf__toast--success",backgroundColor:"#3dc763",icon:{className:"notyf__icon--success",tagName:"i"}},{type:"error",className:"notyf__toast--error",backgroundColor:"#ed3d3d",icon:{className:"notyf__icon--error",tagName:"i"}}],duration:2e3,ripple:!0,position:{x:"right",y:"bottom"},dismissible:!1},hs=function(){function r(){this.notifications=[],this.events={},this.X_POSITION_FLEX_MAP={left:"flex-start",center:"center",right:"flex-end"},this.Y_POSITION_FLEX_MAP={top:"flex-start",center:"center",bottom:"flex-end"};var e=document.createDocumentFragment(),n=this._createHTMLElement({tagName:"div",className:"notyf"});e.appendChild(n),document.body.appendChild(e),this.container=n,this.animationEndEventName=this._getAnimationEndEventName(),this._createA11yContainer()}return r.prototype.on=function(e,n){var t;this.events=Ee(Ee({},this.events),(t={},t[e]=n,t))},r.prototype.update=function(e,n){n===Ke.Add?this.addNotification(e):n===Ke.Remove&&this.removeNotification(e)},r.prototype.removeNotification=function(e){var n=this,t=this._popRenderedNotification(e),i;if(t){i=t.node,i.classList.add("notyf__toast--disappear");var s;i.addEventListener(this.animationEndEventName,s=function(o){o.target===i&&(i.removeEventListener(n.animationEndEventName,s),n.container.removeChild(i))})}},r.prototype.addNotification=function(e){var n=this._renderNotification(e);this.notifications.push({notification:e,node:n}),this._announce(e.options.message||"Notification")},r.prototype._renderNotification=function(e){var n,t=this._buildNotificationCard(e),i=e.options.className;return i&&(n=t.classList).add.apply(n,i.split(" ")),this.container.appendChild(t),t},r.prototype._popRenderedNotification=function(e){for(var n=-1,t=0;t<this.notifications.length&&n<0;t++)this.notifications[t].notification===e&&(n=t);if(n!==-1)return this.notifications.splice(n,1)[0]},r.prototype.getXPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.x)||"right"},r.prototype.getYPosition=function(e){var n;return((n=e==null?void 0:e.position)===null||n===void 0?void 0:n.y)||"bottom"},r.prototype.adjustContainerAlignment=function(e){var n=this.X_POSITION_FLEX_MAP[this.getXPosition(e)],t=this.Y_POSITION_FLEX_MAP[this.getYPosition(e)],i=this.container.style;i.setProperty("justify-content",t),i.setProperty("align-items",n)},r.prototype._buildNotificationCard=function(e){var n=this,t=e.options,i=t.icon;this.adjustContainerAlignment(t);var s=this._createHTMLElement({tagName:"div",className:"notyf__toast"}),o=this._createHTMLElement({tagName:"div",className:"notyf__ripple"}),f=this._createHTMLElement({tagName:"div",className:"notyf__wrapper"}),p=this._createHTMLElement({tagName:"div",className:"notyf__message"});p.innerHTML=t.message||"";var g=t.background||t.backgroundColor;if(i){var C=this._createHTMLElement({tagName:"div",className:"notyf__icon"});if((typeof i=="string"||i instanceof String)&&(C.innerHTML=new String(i).valueOf()),typeof i=="object"){var E=i.tagName,A=E===void 0?"i":E,I=i.className,u=i.text,w=i.color,R=w===void 0?g:w,P=this._createHTMLElement({tagName:A,className:I,text:u});R&&(P.style.color=R),C.appendChild(P)}f.appendChild(C)}if(f.appendChild(p),s.appendChild(f),g&&(t.ripple?(o.style.background=g,s.appendChild(o)):s.style.background=g),t.dismissible){var y=this._createHTMLElement({tagName:"div",className:"notyf__dismiss"}),m=this._createHTMLElement({tagName:"button",className:"notyf__dismiss-btn"});y.appendChild(m),f.appendChild(y),s.classList.add("notyf__toast--dismissible"),m.addEventListener("click",function(d){var c,l;(l=(c=n.events)[ke.Dismiss])===null||l===void 0||l.call(c,{target:e,event:d}),d.stopPropagation()})}s.addEventListener("click",function(d){var c,l;return(l=(c=n.events)[ke.Click])===null||l===void 0?void 0:l.call(c,{target:e,event:d})});var T=this.getYPosition(t)==="top"?"upper":"lower";return s.classList.add("notyf__toast--"+T),s},r.prototype._createHTMLElement=function(e){var n=e.tagName,t=e.className,i=e.text,s=document.createElement(n);return t&&(s.className=t),s.textContent=i||null,s},r.prototype._createA11yContainer=function(){var e=this._createHTMLElement({tagName:"div",className:"notyf-announcer"});e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),e.style.border="0",e.style.clip="rect(0 0 0 0)",e.style.height="1px",e.style.margin="-1px",e.style.overflow="hidden",e.style.padding="0",e.style.position="absolute",e.style.width="1px",e.style.outline="0",document.body.appendChild(e),this.a11yContainer=e},r.prototype._announce=function(e){var n=this;this.a11yContainer.textContent="",setTimeout(function(){n.a11yContainer.textContent=e},100)},r.prototype._getAnimationEndEventName=function(){var e=document.createElement("_fake"),n={MozTransition:"animationend",OTransition:"oAnimationEnd",WebkitTransition:"webkitAnimationEnd",transition:"animationend"},t;for(t in n)if(e.style[t]!==void 0)return n[t];return"animationend"},r}(),Ku=function(){function r(e){var n=this;this.dismiss=this._removeNotification,this.notifications=new ds,this.view=new hs;var t=this.registerTypes(e);this.options=Ee(Ee({},Bn),e),this.options.types=t,this.notifications.onUpdate(function(i,s){return n.view.update(i,s)}),this.view.on(ke.Dismiss,function(i){var s=i.target,o=i.event;n._removeNotification(s),s.triggerEvent(ke.Dismiss,o)}),this.view.on(ke.Click,function(i){var s=i.target,o=i.event;return s.triggerEvent(ke.Click,o)})}return r.prototype.error=function(e){var n=this.normalizeOptions("error",e);return this.open(n)},r.prototype.success=function(e){var n=this.normalizeOptions("success",e);return this.open(n)},r.prototype.open=function(e){var n=this.options.types.find(function(s){var o=s.type;return o===e.type})||{},t=Ee(Ee({},n),e);this.assignProps(["ripple","position","dismissible"],t);var i=new fs(t);return this._pushNotification(i),i},r.prototype.dismissAll=function(){for(;this.notifications.splice(0,1););},r.prototype.assignProps=function(e,n){var t=this;e.forEach(function(i){n[i]=n[i]==null?t.options[i]:n[i]})},r.prototype._pushNotification=function(e){var n=this;this.notifications.push(e);var t=e.options.duration!==void 0?e.options.duration:this.options.duration;t&&setTimeout(function(){return n._removeNotification(e)},t)},r.prototype._removeNotification=function(e){var n=this.notifications.indexOf(e);n!==-1&&this.notifications.splice(n,1)},r.prototype.normalizeOptions=function(e,n){var t={type:e};return typeof n=="string"?t.message=n:typeof n=="object"&&(t=Ee(Ee({},t),n)),t},r.prototype.registerTypes=function(e){var n=(e&&e.types||[]).slice(),t=Bn.types.map(function(i){var s=-1;n.forEach(function(f,p){f.type===i.type&&(s=p)});var o=s!==-1?n.splice(s,1)[0]:{};return Ee(Ee({},i),o)});return t.concat(n)},r}(),zt={exports:{}},Hn;function $r(){return Hn||(Hn=1,function(r,e){(function(n,t){r.exports=t()})(it,function(){var n=1e3,t=6e4,i=36e5,s="millisecond",o="second",f="minute",p="hour",g="day",C="week",E="month",A="quarter",I="year",u="date",w="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,P=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(_){var x=["th","st","nd","rd"],b=_%100;return"["+_+(x[(b-20)%10]||x[b]||x[0])+"]"}},m=function(_,x,b){var S=String(_);return!S||S.length>=x?_:""+Array(x+1-S.length).join(b)+_},T={s:m,z:function(_){var x=-_.utcOffset(),b=Math.abs(x),S=Math.floor(b/60),L=b%60;return(x<=0?"+":"-")+m(S,2,"0")+":"+m(L,2,"0")},m:function _(x,b){if(x.date()<b.date())return-_(b,x);var S=12*(b.year()-x.year())+(b.month()-x.month()),L=x.clone().add(S,E),U=b-L<0,j=x.clone().add(S+(U?-1:1),E);return+(-(S+(b-L)/(U?L-j:j-L))||0)},a:function(_){return _<0?Math.ceil(_)||0:Math.floor(_)},p:function(_){return{M:E,y:I,w:C,d:g,D:u,h:p,m:f,s:o,ms:s,Q:A}[_]||String(_||"").toLowerCase().replace(/s$/,"")},u:function(_){return _===void 0}},d="en",c={};c[d]=y;var l="$isDayjsObject",a=function(_){return _ instanceof k||!(!_||!_[l])},v=function _(x,b,S){var L;if(!x)return d;if(typeof x=="string"){var U=x.toLowerCase();c[U]&&(L=U),b&&(c[U]=b,L=U);var j=x.split("-");if(!L&&j.length>1)return _(j[0])}else{var $=x.name;c[$]=x,L=$}return!S&&L&&(d=L),L||!S&&d},h=function(_,x){if(a(_))return _.clone();var b=typeof x=="object"?x:{};return b.date=_,b.args=arguments,new k(b)},O=T;O.l=v,O.i=a,O.w=function(_,x){return h(_,{locale:x.$L,utc:x.$u,x:x.$x,$offset:x.$offset})};var k=function(){function _(b){this.$L=v(b.locale,null,!0),this.parse(b),this.$x=this.$x||b.x||{},this[l]=!0}var x=_.prototype;return x.parse=function(b){this.$d=function(S){var L=S.date,U=S.utc;if(L===null)return new Date(NaN);if(O.u(L))return new Date;if(L instanceof Date)return new Date(L);if(typeof L=="string"&&!/Z$/i.test(L)){var j=L.match(R);if(j){var $=j[2]-1||0,V=(j[7]||"0").substring(0,3);return U?new Date(Date.UTC(j[1],$,j[3]||1,j[4]||0,j[5]||0,j[6]||0,V)):new Date(j[1],$,j[3]||1,j[4]||0,j[5]||0,j[6]||0,V)}}return new Date(L)}(b),this.init()},x.init=function(){var b=this.$d;this.$y=b.getFullYear(),this.$M=b.getMonth(),this.$D=b.getDate(),this.$W=b.getDay(),this.$H=b.getHours(),this.$m=b.getMinutes(),this.$s=b.getSeconds(),this.$ms=b.getMilliseconds()},x.$utils=function(){return O},x.isValid=function(){return this.$d.toString()!==w},x.isSame=function(b,S){var L=h(b);return this.startOf(S)<=L&&L<=this.endOf(S)},x.isAfter=function(b,S){return h(b)<this.startOf(S)},x.isBefore=function(b,S){return this.endOf(S)<h(b)},x.$g=function(b,S,L){return O.u(b)?this[S]:this.set(L,b)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(b,S){var L=this,U=!!O.u(S)||S,j=O.p(b),$=function(J,Q){var X=O.w(L.$u?Date.UTC(L.$y,Q,J):new Date(L.$y,Q,J),L);return U?X:X.endOf(g)},V=function(J,Q){return O.w(L.toDate()[J].apply(L.toDate("s"),(U?[0,0,0,0]:[23,59,59,999]).slice(Q)),L)},H=this.$W,M=this.$M,N=this.$D,F="set"+(this.$u?"UTC":"");switch(j){case I:return U?$(1,0):$(31,11);case E:return U?$(1,M):$(0,M+1);case C:var B=this.$locale().weekStart||0,W=(H<B?H+7:H)-B;return $(U?N-W:N+(6-W),M);case g:case u:return V(F+"Hours",0);case p:return V(F+"Minutes",1);case f:return V(F+"Seconds",2);case o:return V(F+"Milliseconds",3);default:return this.clone()}},x.endOf=function(b){return this.startOf(b,!1)},x.$set=function(b,S){var L,U=O.p(b),j="set"+(this.$u?"UTC":""),$=(L={},L[g]=j+"Date",L[u]=j+"Date",L[E]=j+"Month",L[I]=j+"FullYear",L[p]=j+"Hours",L[f]=j+"Minutes",L[o]=j+"Seconds",L[s]=j+"Milliseconds",L)[U],V=U===g?this.$D+(S-this.$W):S;if(U===E||U===I){var H=this.clone().set(u,1);H.$d[$](V),H.init(),this.$d=H.set(u,Math.min(this.$D,H.daysInMonth())).$d}else $&&this.$d[$](V);return this.init(),this},x.set=function(b,S){return this.clone().$set(b,S)},x.get=function(b){return this[O.p(b)]()},x.add=function(b,S){var L,U=this;b=Number(b);var j=O.p(S),$=function(M){var N=h(U);return O.w(N.date(N.date()+Math.round(M*b)),U)};if(j===E)return this.set(E,this.$M+b);if(j===I)return this.set(I,this.$y+b);if(j===g)return $(1);if(j===C)return $(7);var V=(L={},L[f]=t,L[p]=i,L[o]=n,L)[j]||1,H=this.$d.getTime()+b*V;return O.w(H,this)},x.subtract=function(b,S){return this.add(-1*b,S)},x.format=function(b){var S=this,L=this.$locale();if(!this.isValid())return L.invalidDate||w;var U=b||"YYYY-MM-DDTHH:mm:ssZ",j=O.z(this),$=this.$H,V=this.$m,H=this.$M,M=L.weekdays,N=L.months,F=L.meridiem,B=function(Q,X,ee,re){return Q&&(Q[X]||Q(S,U))||ee[X].slice(0,re)},W=function(Q){return O.s($%12||12,Q,"0")},J=F||function(Q,X,ee){var re=Q<12?"AM":"PM";return ee?re.toLowerCase():re};return U.replace(P,function(Q,X){return X||function(ee){switch(ee){case"YY":return String(S.$y).slice(-2);case"YYYY":return O.s(S.$y,4,"0");case"M":return H+1;case"MM":return O.s(H+1,2,"0");case"MMM":return B(L.monthsShort,H,N,3);case"MMMM":return B(N,H);case"D":return S.$D;case"DD":return O.s(S.$D,2,"0");case"d":return String(S.$W);case"dd":return B(L.weekdaysMin,S.$W,M,2);case"ddd":return B(L.weekdaysShort,S.$W,M,3);case"dddd":return M[S.$W];case"H":return String($);case"HH":return O.s($,2,"0");case"h":return W(1);case"hh":return W(2);case"a":return J($,V,!0);case"A":return J($,V,!1);case"m":return String(V);case"mm":return O.s(V,2,"0");case"s":return String(S.$s);case"ss":return O.s(S.$s,2,"0");case"SSS":return O.s(S.$ms,3,"0");case"Z":return j}return null}(Q)||j.replace(":","")})},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(b,S,L){var U,j=this,$=O.p(S),V=h(b),H=(V.utcOffset()-this.utcOffset())*t,M=this-V,N=function(){return O.m(j,V)};switch($){case I:U=N()/12;break;case E:U=N();break;case A:U=N()/3;break;case C:U=(M-H)/6048e5;break;case g:U=(M-H)/864e5;break;case p:U=M/i;break;case f:U=M/t;break;case o:U=M/n;break;default:U=M}return L?U:O.a(U)},x.daysInMonth=function(){return this.endOf(E).$D},x.$locale=function(){return c[this.$L]},x.locale=function(b,S){if(!b)return this.$L;var L=this.clone(),U=v(b,S,!0);return U&&(L.$L=U),L},x.clone=function(){return O.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},_}(),D=k.prototype;return h.prototype=D,[["$ms",s],["$s",o],["$m",f],["$H",p],["$W",g],["$M",E],["$y",I],["$D",u]].forEach(function(_){D[_[1]]=function(x){return this.$g(x,_[0],_[1])}}),h.extend=function(_,x){return _.$i||(_(x,k,h),_.$i=!0),h},h.locale=v,h.isDayjs=a,h.unix=function(_){return h(1e3*_)},h.en=c[d],h.Ls=c,h.p={},h})}(zt)),zt.exports}var ps=$r();const qu=yn(ps);var gs={exports:{}};(function(r,e){(function(n,t){r.exports=t($r())})(it,function(n){function t(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var i=t(n),s={name:"id",weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),weekStart:1,formats:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},ordinal:function(o){return o+"."}};return i.default.locale(s,null,!0),s})})(gs);var Vr={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(it,function(){return function(n,t,i){n=n||{};var s=t.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function f(g,C,E,A){return s.fromToBase(g,C,E,A)}i.en.relativeTime=o,s.fromToBase=function(g,C,E,A,I){for(var u,w,R,P=E.$locale().relativeTime||o,y=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],m=y.length,T=0;T<m;T+=1){var d=y[T];d.d&&(u=A?i(g).diff(E,d.d,!0):E.diff(g,d.d,!0));var c=(n.rounding||Math.round)(Math.abs(u));if(R=u>0,c<=d.r||!d.r){c<=1&&T>0&&(d=y[T-1]);var l=P[d.l];I&&(c=I(""+c)),w=typeof l=="string"?l.replace("%d",c):l(c,C,d.l,R);break}}if(C)return w;var a=R?P.future:P.past;return typeof a=="function"?a(w):a.replace("%s",w)},s.to=function(g,C){return f(g,C,this,!0)},s.from=function(g,C){return f(g,C,this)};var p=function(g){return g.$u?i.utc():i()};s.toNow=function(g){return this.to(p(this),g)},s.fromNow=function(g){return this.from(p(this),g)}}})})(Vr);var vs=Vr.exports;const Ju=yn(vs);function Kt(r,e){r.split(/\s+/).forEach(n=>{e(n)})}class ms{constructor(){this._events={}}on(e,n){Kt(e,t=>{const i=this._events[t]||[];i.push(n),this._events[t]=i})}off(e,n){var t=arguments.length;if(t===0){this._events={};return}Kt(e,i=>{if(t===1){delete this._events[i];return}const s=this._events[i];s!==void 0&&(s.splice(s.indexOf(n),1),this._events[i]=s)})}trigger(e,...n){var t=this;Kt(e,i=>{const s=t._events[i];s!==void 0&&s.forEach(o=>{o.apply(t,n)})})}}function ys(r){return r.plugins={},class extends r{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,n){r.plugins[e]={name:e,fn:n}}initializePlugins(e){var n,t;const i=this,s=[];if(Array.isArray(e))e.forEach(o=>{typeof o=="string"?s.push(o):(i.plugins.settings[o.name]=o.options,s.push(o.name))});else if(e)for(n in e)e.hasOwnProperty(n)&&(i.plugins.settings[n]=e[n],s.push(n));for(;t=s.shift();)i.require(t)}loadPlugin(e){var n=this,t=n.plugins,i=r.plugins[e];if(!r.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(n,[n.plugins.settings[e]||{}]),t.names.push(e)}require(e){var n=this,t=n.plugins;if(!n.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');n.loadPlugin(e)}return t.loaded[e]}}}const Ft=r=>(r=r.filter(Boolean),r.length<2?r[0]||"":Os(r)==1?"["+r.join("")+"]":"(?:"+r.join("|")+")"),Wr=r=>{if(!bs(r))return r.join("");let e="",n=0;const t=()=>{n>1&&(e+="{"+n+"}")};return r.forEach((i,s)=>{if(i===r[s-1]){n++;return}t(),e+=i,n=1}),t(),e},zr=r=>{let e=Array.from(r);return Ft(e)},bs=r=>new Set(r).size!==r.length,tt=r=>(r+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Os=r=>r.reduce((e,n)=>Math.max(e,Cs(n)),0),Cs=r=>Array.from(r).length,Kr=r=>{if(r.length===1)return[[r]];let e=[];const n=r.substring(1);return Kr(n).forEach(function(i){let s=i.slice(0);s[0]=r.charAt(0)+s[0],e.push(s),s=i.slice(0),s.unshift(r.charAt(0)),e.push(s)}),e},Ss=[[0,65535]],As="[-]";let Et,qr;const Es=3,bn={},Gn={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let r in Gn){let e=Gn[r]||"";for(let n=0;n<e.length;n++){let t=e.substring(n,n+1);bn[t]=r}}const ws=new RegExp(Object.keys(bn).join("|")+"|"+As,"gu"),Rs=r=>{Et===void 0&&(Et=Ps(Ss))},$n=(r,e="NFKD")=>r.normalize(e),wt=r=>Array.from(r).reduce((e,n)=>e+Ts(n),""),Ts=r=>(r=$n(r).toLowerCase().replace(ws,e=>bn[e]||""),$n(r,"NFC"));function*Is(r){for(const[e,n]of r)for(let t=e;t<=n;t++){let i=String.fromCharCode(t),s=wt(i);s!=i.toLowerCase()&&(s.length>Es||s.length!=0&&(yield{folded:s,composed:i,code_point:t}))}}const xs=r=>{const e={},n=(t,i)=>{const s=e[t]||new Set,o=new RegExp("^"+zr(s)+"$","iu");i.match(o)||(s.add(tt(i)),e[t]=s)};for(let t of Is(r))n(t.folded,t.folded),n(t.folded,t.composed);return e},Ps=r=>{const e=xs(r),n={};let t=[];for(let s in e){let o=e[s];o&&(n[s]=zr(o)),s.length>1&&t.push(tt(s))}t.sort((s,o)=>o.length-s.length);const i=Ft(t);return qr=new RegExp("^"+i,"u"),n},Ms=(r,e=1)=>{let n=0;return r=r.map(t=>(Et[t]&&(n+=t.length),Et[t]||t)),n>=e?Wr(r):""},_s=(r,e=1)=>(e=Math.max(e,r.length-1),Ft(Kr(r).map(n=>Ms(n,e)))),Vn=(r,e=!0)=>{let n=r.length>1?1:0;return Ft(r.map(t=>{let i=[];const s=e?t.length():t.length()-1;for(let o=0;o<s;o++)i.push(_s(t.substrs[o]||"",n));return Wr(i)}))},Ls=(r,e)=>{for(const n of e){if(n.start!=r.start||n.end!=r.end||n.substrs.join("")!==r.substrs.join(""))continue;let t=r.parts;const i=o=>{for(const f of t){if(f.start===o.start&&f.substr===o.substr)return!1;if(!(o.length==1||f.length==1)&&(o.start<f.start&&o.end>f.start||f.start<o.start&&f.end>o.start))return!0}return!1};if(!(n.parts.filter(i).length>0))return!0}return!1};class Rt{constructor(){Fe(this,"parts");Fe(this,"substrs");Fe(this,"start");Fe(this,"end");this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,n){let t=new Rt,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const p of i)t.add(p);let o=n.substr.substring(0,e-s.start),f=o.length;return t.add({start:s.start,end:s.start+f,length:f,substr:o}),t}}const Ds=r=>{Rs(),r=wt(r);let e="",n=[new Rt];for(let t=0;t<r.length;t++){let s=r.substring(t).match(qr);const o=r.substring(t,t+1),f=s?s[0]:null;let p=[],g=new Set;for(const C of n){const E=C.last();if(!E||E.length==1||E.end<=t)if(f){const A=f.length;C.add({start:t,end:t+A,length:A,substr:f}),g.add("1")}else C.add({start:t,end:t+1,length:1,substr:o}),g.add("2");else if(f){let A=C.clone(t,E);const I=f.length;A.add({start:t,end:t+I,length:I,substr:f}),p.push(A)}else g.add("3")}if(p.length>0){p=p.sort((C,E)=>C.length()-E.length());for(let C of p)Ls(C,n)||n.push(C);continue}if(t>0&&g.size==1&&!g.has("3")){e+=Vn(n,!1);let C=new Rt;const E=n[0];E&&C.add(E.last()),n=[C]}}return e+=Vn(n,!0),e},ks=(r,e)=>{if(r)return r[e]},Ns=(r,e)=>{if(r){for(var n,t=e.split(".");(n=t.shift())&&(r=r[n]););return r}},qt=(r,e,n)=>{var t,i;return!r||(r=r+"",e.regex==null)||(i=r.search(e.regex),i===-1)?0:(t=e.string.length/r.length,i===0&&(t+=.5),t*n)},Jt=(r,e)=>{var n=r[e];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(r[e]=[n])},ut=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Us=(r,e)=>typeof r=="number"&&typeof e=="number"?r>e?1:r<e?-1:0:(r=wt(r+"").toLowerCase(),e=wt(e+"").toLowerCase(),r>e?1:e>r?-1:0);class Fs{constructor(e,n){Fe(this,"items");Fe(this,"settings");this.items=e,this.settings=n||{diacritics:!0}}tokenize(e,n,t){if(!e||!e.length)return[];const i=[],s=e.split(/\s+/);var o;return t&&(o=new RegExp("^("+Object.keys(t).map(tt).join("|")+"):(.*)$")),s.forEach(f=>{let p,g=null,C=null;o&&(p=f.match(o))&&(g=p[1],f=p[2]),f.length>0&&(this.settings.diacritics?C=Ds(f)||null:C=tt(f),C&&n&&(C="\\b"+C)),i.push({string:f,regex:C?new RegExp(C,"iu"):null,field:g})}),i}getScoreFunction(e,n){var t=this.prepareSearch(e,n);return this._getScoreFunction(t)}_getScoreFunction(e){const n=e.tokens,t=n.length;if(!t)return function(){return 0};const i=e.options.fields,s=e.weights,o=i.length,f=e.getAttrFn;if(!o)return function(){return 1};const p=function(){return o===1?function(g,C){const E=i[0].field;return qt(f(C,E),g,s[E]||1)}:function(g,C){var E=0;if(g.field){const A=f(C,g.field);!g.regex&&A?E+=1/o:E+=qt(A,g,1)}else ut(s,(A,I)=>{E+=qt(f(C,I),g,A)});return E/o}}();return t===1?function(g){return p(n[0],g)}:e.options.conjunction==="and"?function(g){var C,E=0;for(let A of n){if(C=p(A,g),C<=0)return 0;E+=C}return E/t}:function(g){var C=0;return ut(n,E=>{C+=p(E,g)}),C/t}}getSortFunction(e,n){var t=this.prepareSearch(e,n);return this._getSortFunction(t)}_getSortFunction(e){var n,t=[];const i=this,s=e.options,o=!e.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof o=="function")return o.bind(this);const f=function(g,C){return g==="$score"?C.score:e.getAttrFn(i.items[C.id],g)};if(o)for(let g of o)(e.query||g.field!=="$score")&&t.push(g);if(e.query){n=!0;for(let g of t)if(g.field==="$score"){n=!1;break}n&&t.unshift({field:"$score",direction:"desc"})}else t=t.filter(g=>g.field!=="$score");return t.length?function(g,C){var E,A;for(let I of t)if(A=I.field,E=(I.direction==="desc"?-1:1)*Us(f(A,g),f(A,C)),E)return E;return 0}:null}prepareSearch(e,n){const t={};var i=Object.assign({},n);if(Jt(i,"sort"),Jt(i,"sort_empty"),i.fields){Jt(i,"fields");const s=[];i.fields.forEach(o=>{typeof o=="string"&&(o={field:o,weight:1}),s.push(o),t[o.field]="weight"in o?o.weight:1}),i.fields=s}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,t),total:0,items:[],weights:t,getAttrFn:i.nesting?Ns:ks}}search(e,n){var t=this,i,s;s=this.prepareSearch(e,n),n=s.options,e=s.query;const o=n.score||t._getScoreFunction(s);e.length?ut(t.items,(p,g)=>{i=o(p),(n.filter===!1||i>0)&&s.items.push({score:i,id:g})}):ut(t.items,(p,g)=>{s.items.push({score:1,id:g})});const f=t._getSortFunction(s);return f&&s.items.sort(f),s.total=s.items.length,typeof n.limit=="number"&&(s.items=s.items.slice(0,n.limit)),s}}const Te=r=>typeof r>"u"||r===null?null:yt(r),yt=r=>typeof r=="boolean"?r?"1":"0":r+"",Qt=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),js=(r,e)=>e>0?window.setTimeout(r,e):(r.call(null),null),Bs=(r,e)=>{var n;return function(t,i){var s=this;n&&(s.loading=Math.max(s.loading-1,0),clearTimeout(n)),n=setTimeout(function(){n=null,s.loadedSearches[t]=!0,r.call(s,t,i)},e)}},Wn=(r,e,n)=>{var t,i=r.trigger,s={};r.trigger=function(){var o=arguments[0];if(e.indexOf(o)!==-1)s[o]=arguments;else return i.apply(r,arguments)},n.apply(r,[]),r.trigger=i;for(t of e)t in s&&i.apply(r,s[t])},Hs=r=>({start:r.selectionStart||0,length:(r.selectionEnd||0)-(r.selectionStart||0)}),ue=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},me=(r,e,n,t)=>{r.addEventListener(e,n,t)},je=(r,e)=>{if(!e||!e[r])return!1;var n=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return n===1},Yt=(r,e)=>{const n=r.getAttribute("id");return n||(r.setAttribute("id",e),e)},zn=r=>r.replace(/[\\"']/g,"\\$&"),Be=(r,e)=>{e&&r.append(e)},de=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Pe=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Jr(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Jr=r=>typeof r=="string"&&r.indexOf("<")>-1,Gs=r=>r.replace(/['"\\]/g,"\\$&"),Xt=(r,e)=>{var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!1),r.dispatchEvent(n)},lt=(r,e)=>{Object.assign(r.style,e)},Se=(r,...e)=>{var n=Qr(e);r=Yr(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},De=(r,...e)=>{var n=Qr(e);r=Yr(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},Qr=r=>{var e=[];return de(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Yr=r=>(Array.isArray(r)||(r=[r]),r),Zt=(r,e,n)=>{if(!(n&&!n.contains(r)))for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},Kn=(r,e=0)=>e>0?r[r.length-1]:r[0],$s=r=>Object.keys(r).length===0,qn=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n},oe=(r,e)=>{de(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},cn=(r,e)=>{r.parentNode&&r.parentNode.replaceChild(e,r)},Vs=(r,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const n=s=>{var o=s.data.match(e);if(o&&s.data.length>0){var f=document.createElement("span");f.className="highlight";var p=s.splitText(o.index);p.splitText(o[0].length);var g=p.cloneNode(!0);return f.appendChild(g),cn(p,f),1}return 0},t=s=>{s.nodeType===1&&s.childNodes&&!/(script|style)/i.test(s.tagName)&&(s.className!=="highlight"||s.tagName!=="SPAN")&&Array.from(s.childNodes).forEach(o=>{i(o)})},i=s=>s.nodeType===3?n(s):(t(s),0);i(r)},Ws=r=>{var e=r.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(n){var t=n.parentNode;t.replaceChild(n.firstChild,n),t.normalize()})},zs=65,Ks=13,qs=27,Js=37,Qs=38,Ys=39,Xs=40,Jn=8,Zs=46,Qn=9,ea=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),ct=ea?"metaKey":"ctrlKey",Yn={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(r){return r.length>0},render:{}};function Xn(r,e){var n=Object.assign({},Yn,e),t=n.dataAttr,i=n.labelField,s=n.valueField,o=n.disabledField,f=n.optgroupField,p=n.optgroupLabelField,g=n.optgroupValueField,C=r.tagName.toLowerCase(),E=r.getAttribute("placeholder")||r.getAttribute("data-placeholder");if(!E&&!n.allowEmptyOption){let w=r.querySelector('option[value=""]');w&&(E=w.textContent)}var A={placeholder:E,options:[],optgroups:[],items:[],maxItems:null},I=()=>{var w,R=A.options,P={},y=1;let m=0;var T=l=>{var a=Object.assign({},l.dataset),v=t&&a[t];return typeof v=="string"&&v.length&&(a=Object.assign(a,JSON.parse(v))),a},d=(l,a)=>{var v=Te(l.value);if(v!=null&&!(!v&&!n.allowEmptyOption)){if(P.hasOwnProperty(v)){if(a){var h=P[v][f];h?Array.isArray(h)?h.push(a):P[v][f]=[h,a]:P[v][f]=a}}else{var O=T(l);O[i]=O[i]||l.textContent,O[s]=O[s]||v,O[o]=O[o]||l.disabled,O[f]=O[f]||a,O.$option=l,O.$order=O.$order||++m,P[v]=O,R.push(O)}l.selected&&A.items.push(v)}},c=l=>{var a,v;v=T(l),v[p]=v[p]||l.getAttribute("label")||"",v[g]=v[g]||y++,v[o]=v[o]||l.disabled,v.$order=v.$order||++m,A.optgroups.push(v),a=v[g],de(l.children,h=>{d(h,a)})};A.maxItems=r.hasAttribute("multiple")?null:1,de(r.children,l=>{w=l.tagName.toLowerCase(),w==="optgroup"?c(l):w==="option"&&d(l)})},u=()=>{const w=r.getAttribute(t);if(w)A.options=JSON.parse(w),de(A.options,P=>{A.items.push(P[s])});else{var R=r.value.trim()||"";if(!n.allowEmptyOption&&!R.length)return;const P=R.split(n.delimiter);de(P,y=>{const m={};m[i]=y,m[s]=y,A.options.push(m)}),A.items=P}};return C==="select"?I():u(),Object.assign({},Yn,A,e)}var Zn=0;class Ce extends ys(ms){constructor(e,n){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Zn++;var t,i=Pe(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s=window.getComputedStyle&&window.getComputedStyle(i,null);t=s.getPropertyValue("direction");const o=Xn(i,n);this.settings=o,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(t),this.inputId=Yt(i,"tomselect-"+Zn),this.isRequired=i.required,this.sifter=new Fs(this.options,{diacritics:o.diacritics}),o.mode=o.mode||(o.maxItems===1?"single":"multi"),typeof o.hideSelected!="boolean"&&(o.hideSelected=o.mode==="multi"),typeof o.hidePlaceholder!="boolean"&&(o.hidePlaceholder=o.mode!=="multi");var f=o.createFilter;typeof f!="function"&&(typeof f=="string"&&(f=new RegExp(f)),f instanceof RegExp?o.createFilter=R=>f.test(R):o.createFilter=R=>this.settings.duplicates||!this.options[R]),this.initializePlugins(o.plugins),this.setupCallbacks(),this.setupTemplates();const p=Pe("<div>"),g=Pe("<div>"),C=this._render("dropdown"),E=Pe('<div role="listbox" tabindex="-1">'),A=this.input.getAttribute("class")||"",I=o.mode;var u;if(Se(p,o.wrapperClass,A,I),Se(g,o.controlClass),Be(p,g),Se(C,o.dropdownClass,I),o.copyClassesToDropdown&&Se(C,A),Se(E,o.dropdownContentClass),Be(C,E),Pe(o.dropdownParent||p).appendChild(C),Jr(o.controlInput)){u=Pe(o.controlInput);var w=["autocorrect","autocapitalize","autocomplete","spellcheck"];de(w,R=>{i.getAttribute(R)&&oe(u,{[R]:i.getAttribute(R)})}),u.tabIndex=-1,g.appendChild(u),this.focus_node=u}else o.controlInput?(u=Pe(o.controlInput),this.focus_node=u):(u=Pe("<input/>"),this.focus_node=g);this.wrapper=p,this.dropdown=C,this.dropdown_content=E,this.control=g,this.control_input=u,this.setup()}setup(){const e=this,n=e.settings,t=e.control_input,i=e.dropdown,s=e.dropdown_content,o=e.wrapper,f=e.control,p=e.input,g=e.focus_node,C={passive:!0},E=e.inputId+"-ts-dropdown";oe(s,{id:E}),oe(g,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":E});const A=Yt(g,e.inputId+"-ts-control"),I="label[for='"+Gs(e.inputId)+"']",u=document.querySelector(I),w=e.focus.bind(e);if(u){me(u,"click",w),oe(u,{for:A});const y=Yt(u,e.inputId+"-ts-label");oe(g,{"aria-labelledby":y}),oe(s,{"aria-labelledby":y})}if(o.style.width=p.style.width,e.plugins.names.length){const y="plugin-"+e.plugins.names.join(" plugin-");Se([o,i],y)}(n.maxItems===null||n.maxItems>1)&&e.is_select_tag&&oe(p,{multiple:"multiple"}),n.placeholder&&oe(t,{placeholder:n.placeholder}),!n.splitOn&&n.delimiter&&(n.splitOn=new RegExp("\\s*"+tt(n.delimiter)+"+\\s*")),n.load&&n.loadThrottle&&(n.load=Bs(n.load,n.loadThrottle)),me(i,"mousemove",()=>{e.ignoreHover=!1}),me(i,"mouseenter",y=>{var m=Zt(y.target,"[data-selectable]",i);m&&e.onOptionHover(y,m)},{capture:!0}),me(i,"click",y=>{const m=Zt(y.target,"[data-selectable]");m&&(e.onOptionSelect(y,m),ue(y,!0))}),me(f,"click",y=>{var m=Zt(y.target,"[data-ts-item]",f);if(m&&e.onItemSelect(y,m)){ue(y,!0);return}t.value==""&&(e.onClick(),ue(y,!0))}),me(g,"keydown",y=>e.onKeyDown(y)),me(t,"keypress",y=>e.onKeyPress(y)),me(t,"input",y=>e.onInput(y)),me(g,"blur",y=>e.onBlur(y)),me(g,"focus",y=>e.onFocus(y)),me(t,"paste",y=>e.onPaste(y));const R=y=>{const m=y.composedPath()[0];if(!o.contains(m)&&!i.contains(m)){e.isFocused&&e.blur(),e.inputState();return}m==t&&e.isOpen?y.stopPropagation():ue(y,!0)},P=()=>{e.isOpen&&e.positionDropdown()};me(document,"mousedown",R),me(window,"scroll",P,C),me(window,"resize",P,C),this._destroy=()=>{document.removeEventListener("mousedown",R),window.removeEventListener("scroll",P),window.removeEventListener("resize",P),u&&u.removeEventListener("click",w)},this.revertSettings={innerHTML:p.innerHTML,tabIndex:p.tabIndex},p.tabIndex=-1,p.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),n.items=[],delete n.optgroups,delete n.options,me(p,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,p.disabled?e.disable():p.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Se(p,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),n.preload===!0&&e.preload()}setupOptions(e=[],n=[]){this.addOptions(e),de(n,t=>{this.registerOptionGroup(t)})}setupTemplates(){var e=this,n=e.settings.labelField,t=e.settings.optgroupLabelField,i={optgroup:s=>{let o=document.createElement("div");return o.className="optgroup",o.appendChild(s.options),o},optgroup_header:(s,o)=>'<div class="optgroup-header">'+o(s[t])+"</div>",option:(s,o)=>"<div>"+o(s[n])+"</div>",item:(s,o)=>"<div>"+o(s[n])+"</div>",option_create:(s,o)=>'<div class="create">Add <strong>'+o(s.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,n,t={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in t)n=this.settings[t[e]],n&&this.on(e,n)}sync(e=!0){const n=this,t=e?Xn(n.input,{delimiter:n.settings.delimiter}):n.settings;n.setupOptions(t.options,t.optgroups),n.setValue(t.items||[],!0),n.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Xt(this.input,"input"),Xt(this.input,"change")}onPaste(e){var n=this;if(n.isInputHidden||n.isLocked){ue(e);return}n.settings.splitOn&&setTimeout(()=>{var t=n.inputValue();if(t.match(n.settings.splitOn)){var i=t.trim().split(n.settings.splitOn);de(i,s=>{Te(s)&&(this.options[s]?n.addItem(s):n.createItem(s))})}},0)}onKeyPress(e){var n=this;if(n.isLocked){ue(e);return}var t=String.fromCharCode(e.keyCode||e.which);if(n.settings.create&&n.settings.mode==="multi"&&t===n.settings.delimiter){n.createItem(),ue(e);return}}onKeyDown(e){var n=this;if(n.ignoreHover=!0,n.isLocked){e.keyCode!==Qn&&ue(e);return}switch(e.keyCode){case zs:if(je(ct,e)&&n.control_input.value==""){ue(e),n.selectAll();return}break;case qs:n.isOpen&&(ue(e,!0),n.close()),n.clearActiveItems();return;case Xs:if(!n.isOpen&&n.hasOptions)n.open();else if(n.activeOption){let t=n.getAdjacent(n.activeOption,1);t&&n.setActiveOption(t)}ue(e);return;case Qs:if(n.activeOption){let t=n.getAdjacent(n.activeOption,-1);t&&n.setActiveOption(t)}ue(e);return;case Ks:n.canSelect(n.activeOption)?(n.onOptionSelect(e,n.activeOption),ue(e)):(n.settings.create&&n.createItem()||document.activeElement==n.control_input&&n.isOpen)&&ue(e);return;case Js:n.advanceSelection(-1,e);return;case Ys:n.advanceSelection(1,e);return;case Qn:n.settings.selectOnTab&&(n.canSelect(n.activeOption)&&(n.onOptionSelect(e,n.activeOption),ue(e)),n.settings.create&&n.createItem()&&ue(e));return;case Jn:case Zs:n.deleteSelection(e);return}n.isInputHidden&&!je(ct,e)&&ue(e)}onInput(e){if(this.isLocked)return;const n=this.inputValue();if(this.lastValue!==n){if(this.lastValue=n,n==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=js(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,n){this.ignoreHover||this.setActiveOption(n,!1)}onFocus(e){var n=this,t=n.isFocused;if(n.isDisabled||n.isReadOnly){n.blur(),ue(e);return}n.ignoreFocus||(n.isFocused=!0,n.settings.preload==="focus"&&n.preload(),t||n.trigger("focus"),n.activeItems.length||(n.inputState(),n.refreshOptions(!!n.settings.openOnFocus)),n.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var n=this;if(n.isFocused){n.isFocused=!1,n.ignoreFocus=!1;var t=()=>{n.close(),n.setActiveItem(),n.setCaret(n.items.length),n.trigger("blur")};n.settings.create&&n.settings.createOnBlur?n.createItem(null,t):t()}}}onOptionSelect(e,n){var t,i=this;n.parentElement&&n.parentElement.matches("[data-disabled]")||(n.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(t=n.dataset.value,typeof t<"u"&&(i.lastQuery=null,i.addItem(t),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(n))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,n){var t=this;return!t.isLocked&&t.settings.mode==="multi"?(ue(e),t.setActiveItem(n,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const n=this;if(!n.canLoad(e))return;Se(n.wrapper,n.settings.loadingClass),n.loading++;const t=n.loadCallback.bind(n);n.settings.load.call(n,e,t)}loadCallback(e,n){const t=this;t.loading=Math.max(t.loading-1,0),t.lastQuery=null,t.clearActiveOption(),t.setupOptions(e,n),t.refreshOptions(t.isFocused&&!t.isInputHidden),t.loading||De(t.wrapper,t.settings.loadingClass),t.trigger("load",e,n)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var n=this.control_input,t=n.value!==e;t&&(n.value=e,Xt(n,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,n){var t=n?[]:["change"];Wn(this,t,()=>{this.clear(n),this.addItems(e,n)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,n){var t=this,i,s,o,f,p,g;if(t.settings.mode!=="single"){if(!e){t.clearActiveItems(),t.isFocused&&t.inputState();return}if(i=n&&n.type.toLowerCase(),i==="click"&&je("shiftKey",n)&&t.activeItems.length){for(g=t.getLastActive(),o=Array.prototype.indexOf.call(t.control.children,g),f=Array.prototype.indexOf.call(t.control.children,e),o>f&&(p=o,o=f,f=p),s=o;s<=f;s++)e=t.control.children[s],t.activeItems.indexOf(e)===-1&&t.setActiveItemClass(e);ue(n)}else i==="click"&&je(ct,n)||i==="keydown"&&je("shiftKey",n)?e.classList.contains("active")?t.removeActiveItem(e):t.setActiveItemClass(e):(t.clearActiveItems(),t.setActiveItemClass(e));t.inputState(),t.isFocused||t.focus()}}setActiveItemClass(e){const n=this,t=n.control.querySelector(".last-active");t&&De(t,"last-active"),Se(e,"active last-active"),n.trigger("item_select",e),n.activeItems.indexOf(e)==-1&&n.activeItems.push(e)}removeActiveItem(e){var n=this.activeItems.indexOf(e);this.activeItems.splice(n,1),De(e,"active")}clearActiveItems(){De(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,n=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,oe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),oe(e,{"aria-selected":"true"}),Se(e,"active"),n&&this.scrollToOption(e)))}scrollToOption(e,n){if(!e)return;const t=this.dropdown_content,i=t.clientHeight,s=t.scrollTop||0,o=e.offsetHeight,f=e.getBoundingClientRect().top-t.getBoundingClientRect().top+s;f+o>i+s?this.scroll(f-i+o,n):f<s&&this.scroll(f,n)}scroll(e,n){const t=this.dropdown_content;n&&(t.style.scrollBehavior=n),t.scrollTop=e,t.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(De(this.activeOption,"active"),oe(this.activeOption,{"aria-selected":null})),this.activeOption=null,oe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const n=e.controlChildren();n.length&&(e.inputState(),e.close(),e.activeItems=n,de(n,t=>{e.setActiveItemClass(t)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(oe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&oe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,n=e.sortField;return typeof e.sortField=="string"&&(n=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:n,nesting:e.nesting}}search(e){var n,t,i=this,s=this.getSearchOptions();if(i.settings.score&&(t=i.settings.score.call(i,e),typeof t!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,n=i.sifter.search(e,Object.assign(s,{score:t})),i.currentResults=n):n=Object.assign({},i.currentResults),i.settings.hideSelected&&(n.items=n.items.filter(o=>{let f=Te(o.id);return!(f&&i.items.indexOf(f)!==-1)})),n}refreshOptions(e=!0){var n,t,i,s,o,f,p,g,C,E;const A={},I=[];var u=this,w=u.inputValue();const R=w===u.lastQuery||w==""&&u.lastQuery==null;var P=u.search(w),y=null,m=u.settings.shouldOpen||!1,T=u.dropdown_content;R&&(y=u.activeOption,y&&(C=y.closest("[data-group]"))),s=P.items.length,typeof u.settings.maxOptions=="number"&&(s=Math.min(s,u.settings.maxOptions)),s>0&&(m=!0);const d=(l,a)=>{let v=A[l];if(v!==void 0){let O=I[v];if(O!==void 0)return[v,O.fragment]}let h=document.createDocumentFragment();return v=I.length,I.push({fragment:h,order:a,optgroup:l}),[v,h]};for(n=0;n<s;n++){let l=P.items[n];if(!l)continue;let a=l.id,v=u.options[a];if(v===void 0)continue;let h=yt(a),O=u.getOption(h,!0);for(u.settings.hideSelected||O.classList.toggle("selected",u.items.includes(h)),o=v[u.settings.optgroupField]||"",f=Array.isArray(o)?o:[o],t=0,i=f&&f.length;t<i;t++){o=f[t];let k=v.$order,D=u.optgroups[o];D===void 0?o="":k=D.$order;const[_,x]=d(o,k);t>0&&(O=O.cloneNode(!0),oe(O,{id:v.$id+"-clone-"+t,"aria-selected":null}),O.classList.add("ts-cloned"),De(O,"active"),u.activeOption&&u.activeOption.dataset.value==a&&C&&C.dataset.group===o.toString()&&(y=O)),x.appendChild(O),o!=""&&(A[o]=_)}}u.settings.lockOptgroupOrder&&I.sort((l,a)=>l.order-a.order),p=document.createDocumentFragment(),de(I,l=>{let a=l.fragment,v=l.optgroup;if(!a||!a.children.length)return;let h=u.optgroups[v];if(h!==void 0){let O=document.createDocumentFragment(),k=u.render("optgroup_header",h);Be(O,k),Be(O,a);let D=u.render("optgroup",{group:h,options:O});Be(p,D)}else Be(p,a)}),T.innerHTML="",Be(T,p),u.settings.highlight&&(Ws(T),P.query.length&&P.tokens.length&&de(P.tokens,l=>{Vs(T,l.regex)}));var c=l=>{let a=u.render(l,{input:w});return a&&(m=!0,T.insertBefore(a,T.firstChild)),a};if(u.loading?c("loading"):u.settings.shouldLoad.call(u,w)?P.items.length===0&&c("no_results"):c("not_loading"),g=u.canCreate(w),g&&(E=c("option_create")),u.hasOptions=P.items.length>0||g,m){if(P.items.length>0){if(!y&&u.settings.mode==="single"&&u.items[0]!=null&&(y=u.getOption(u.items[0])),!T.contains(y)){let l=0;E&&!u.settings.addPrecedence&&(l=1),y=u.selectable()[l]}}else E&&(y=E);e&&!u.isOpen&&(u.open(),u.scrollToOption(y,"auto")),u.setActiveOption(y)}else u.clearActiveOption(),e&&u.isOpen&&u.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,n=!1){const t=this;if(Array.isArray(e))return t.addOptions(e,n),!1;const i=Te(e[t.settings.valueField]);return i===null||t.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++t.order,e.$id=t.inputId+"-opt-"+e.$order,t.options[i]=e,t.lastQuery=null,n&&(t.userOptions[i]=n,t.trigger("option_add",i,e)),i)}addOptions(e,n=!1){de(e,t=>{this.addOption(t,n)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var n=Te(e[this.settings.optgroupValueField]);return n===null?!1:(e.$order=e.$order||++this.order,this.optgroups[n]=e,n)}addOptionGroup(e,n){var t;n[this.settings.optgroupValueField]=e,(t=this.registerOptionGroup(n))&&this.trigger("optgroup_add",t,n)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,n){const t=this;var i,s;const o=Te(e),f=Te(n[t.settings.valueField]);if(o===null)return;const p=t.options[o];if(p==null)return;if(typeof f!="string")throw new Error("Value must be set in option data");const g=t.getOption(o),C=t.getItem(o);if(n.$order=n.$order||p.$order,delete t.options[o],t.uncacheValue(f),t.options[f]=n,g){if(t.dropdown_content.contains(g)){const E=t._render("option",n);cn(g,E),t.activeOption===g&&t.setActiveOption(E)}g.remove()}C&&(s=t.items.indexOf(o),s!==-1&&t.items.splice(s,1,f),i=t._render("item",n),C.classList.contains("active")&&Se(i,"active"),cn(C,i)),t.lastQuery=null}removeOption(e,n){const t=this;e=yt(e),t.uncacheValue(e),delete t.userOptions[e],delete t.options[e],t.lastQuery=null,t.trigger("option_remove",e),t.removeItem(e,n)}clearOptions(e){const n=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const t={};de(this.options,(i,s)=>{n(i,s)&&(t[s]=i)}),this.options=this.sifter.items=t,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,n){return this.items.indexOf(n)>=0}getOption(e,n=!1){const t=Te(e);if(t===null)return null;const i=this.options[t];if(i!=null){if(i.$div)return i.$div;if(n)return this._render("option",i)}return null}getAdjacent(e,n,t="option"){var i=this,s;if(!e)return null;t=="item"?s=i.controlChildren():s=i.dropdown_content.querySelectorAll("[data-selectable]");for(let o=0;o<s.length;o++)if(s[o]==e)return n>0?s[o+1]:s[o-1];return null}getItem(e){if(typeof e=="object")return e;var n=Te(e);return n!==null?this.control.querySelector(`[data-value="${zn(n)}"]`):null}addItems(e,n){var t=this,i=Array.isArray(e)?e:[e];i=i.filter(o=>t.items.indexOf(o)===-1);const s=i[i.length-1];i.forEach(o=>{t.isPending=o!==s,t.addItem(o,n)})}addItem(e,n){var t=n?[]:["change","dropdown_close"];Wn(this,t,()=>{var i,s;const o=this,f=o.settings.mode,p=Te(e);if(!(p&&o.items.indexOf(p)!==-1&&(f==="single"&&o.close(),f==="single"||!o.settings.duplicates))&&!(p===null||!o.options.hasOwnProperty(p))&&(f==="single"&&o.clear(n),!(f==="multi"&&o.isFull()))){if(i=o._render("item",o.options[p]),o.control.contains(i)&&(i=i.cloneNode(!0)),s=o.isFull(),o.items.splice(o.caretPos,0,p),o.insertAtCaret(i),o.isSetup){if(!o.isPending&&o.settings.hideSelected){let g=o.getOption(p),C=o.getAdjacent(g,1);C&&o.setActiveOption(C)}!o.isPending&&!o.settings.closeAfterSelect&&o.refreshOptions(o.isFocused&&f!=="single"),o.settings.closeAfterSelect!=!1&&o.isFull()?o.close():o.isPending||o.positionDropdown(),o.trigger("item_add",p,i),o.isPending||o.updateOriginalInput({silent:n})}(!o.isPending||!s&&o.isFull())&&(o.inputState(),o.refreshState())}})}removeItem(e=null,n){const t=this;if(e=t.getItem(e),!e)return;var i,s;const o=e.dataset.value;i=qn(e),e.remove(),e.classList.contains("active")&&(s=t.activeItems.indexOf(e),t.activeItems.splice(s,1),De(e,"active")),t.items.splice(i,1),t.lastQuery=null,!t.settings.persist&&t.userOptions.hasOwnProperty(o)&&t.removeOption(o,n),i<t.caretPos&&t.setCaret(t.caretPos-1),t.updateOriginalInput({silent:n}),t.refreshState(),t.positionDropdown(),t.trigger("item_remove",o,e)}createItem(e=null,n=()=>{}){arguments.length===3&&(n=arguments[2]),typeof n!="function"&&(n=()=>{});var t=this,i=t.caretPos,s;if(e=e||t.inputValue(),!t.canCreate(e))return n(),!1;t.lock();var o=!1,f=p=>{if(t.unlock(),!p||typeof p!="object")return n();var g=Te(p[t.settings.valueField]);if(typeof g!="string")return n();t.setTextboxValue(),t.addOption(p,!0),t.setCaret(i),t.addItem(g),n(p),o=!0};return typeof t.settings.create=="function"?s=t.settings.create.call(this,e,f):s={[t.settings.labelField]:e,[t.settings.valueField]:e},o||f(s),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const n=e.isFull(),t=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",t),i.toggle("full",n),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",$s(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const n=this;var t,i;const s=n.input.querySelector('option[value=""]');if(n.is_select_tag){let p=function(g,C,E){return g||(g=Pe('<option value="'+Qt(C)+'">'+Qt(E)+"</option>")),g!=s&&n.input.append(g),o.push(g),(g!=s||f>0)&&(g.selected=!0),g};const o=[],f=n.input.querySelectorAll("option:checked").length;n.input.querySelectorAll("option:checked").forEach(g=>{g.selected=!1}),n.items.length==0&&n.settings.mode=="single"?p(s,"",""):n.items.forEach(g=>{if(t=n.options[g],i=t[n.settings.labelField]||"",o.includes(t.$option)){const C=n.input.querySelector(`option[value="${zn(g)}"]:not(:checked)`);p(C,g,i)}else t.$option=p(t.$option,g,i)})}else n.input.value=n.getValue();n.isSetup&&(e.silent||n.trigger("change",n.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,oe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),lt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),lt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var n=this,t=n.isOpen;e&&(n.setTextboxValue(),n.settings.mode==="single"&&n.items.length&&n.inputState()),n.isOpen=!1,oe(n.focus_node,{"aria-expanded":"false"}),lt(n.dropdown,{display:"none"}),n.settings.hideSelected&&n.clearActiveOption(),n.refreshState(),t&&n.trigger("dropdown_close",n.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,n=e.getBoundingClientRect(),t=e.offsetHeight+n.top+window.scrollY,i=n.left+window.scrollX;lt(this.dropdown,{width:n.width+"px",top:t+"px",left:i+"px"})}}clear(e){var n=this;if(n.items.length){var t=n.controlChildren();de(t,i=>{n.removeItem(i,!0)}),n.inputState(),e||n.updateOriginalInput(),n.trigger("clear")}}insertAtCaret(e){const n=this,t=n.caretPos,i=n.control;i.insertBefore(e,i.children[t]||null),n.setCaret(t+1)}deleteSelection(e){var n,t,i,s,o=this;n=e&&e.keyCode===Jn?-1:1,t=Hs(o.control_input);const f=[];if(o.activeItems.length)s=Kn(o.activeItems,n),i=qn(s),n>0&&i++,de(o.activeItems,p=>f.push(p));else if((o.isFocused||o.settings.mode==="single")&&o.items.length){const p=o.controlChildren();let g;n<0&&t.start===0&&t.length===0?g=p[o.caretPos-1]:n>0&&t.start===o.inputValue().length&&(g=p[o.caretPos]),g!==void 0&&f.push(g)}if(!o.shouldDelete(f,e))return!1;for(ue(e,!0),typeof i<"u"&&o.setCaret(i);f.length;)o.removeItem(f.pop());return o.inputState(),o.positionDropdown(),o.refreshOptions(!1),!0}shouldDelete(e,n){const t=e.map(i=>i.dataset.value);return!(!t.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(t,n)===!1)}advanceSelection(e,n){var t,i,s=this;s.rtl&&(e*=-1),!s.inputValue().length&&(je(ct,n)||je("shiftKey",n)?(t=s.getLastActive(e),t?t.classList.contains("active")?i=s.getAdjacent(t,e,"item"):i=t:e>0?i=s.control_input.nextElementSibling:i=s.control_input.previousElementSibling,i&&(i.classList.contains("active")&&s.removeActiveItem(t),s.setActiveItemClass(i))):s.moveCaret(e))}moveCaret(e){}getLastActive(e){let n=this.control.querySelector(".last-active");if(n)return n;var t=this.control.querySelectorAll(".active");if(t)return Kn(t,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,n=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=n.innerHTML,e.input.tabIndex=n.tabIndex,De(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,n){var t,i;const s=this;if(typeof this.settings.render[e]!="function"||(i=s.settings.render[e].call(this,n,Qt),!i))return null;if(i=Pe(i),e==="option"||e==="option_create"?n[s.settings.disabledField]?oe(i,{"aria-disabled":"true"}):oe(i,{"data-selectable":""}):e==="optgroup"&&(t=n.group[s.settings.optgroupValueField],oe(i,{"data-group":t}),n.group[s.settings.disabledField]&&oe(i,{"data-disabled":""})),e==="option"||e==="item"){const o=yt(n[s.settings.valueField]);oe(i,{"data-value":o}),e==="item"?(Se(i,s.settings.itemClass),oe(i,{"data-ts-item":""})):(Se(i,s.settings.optionClass),oe(i,{role:"option",id:n.$id}),n.$div=i,s.options[o]=n)}return i}_render(e,n){const t=this.render(e,n);if(t==null)throw"HTMLElement expected";return t}clearCache(){de(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const n=this.getOption(e);n&&n.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,n,t){var i=this,s=i[n];i[n]=function(){var o,f;return e==="after"&&(o=s.apply(i,arguments)),f=t.apply(i,arguments),e==="instead"?f:(e==="before"&&(o=s.apply(i,arguments)),o)}}}const ta=(r,e,n,t)=>{r.addEventListener(e,n,t)};function na(){ta(this.input,"change",()=>{this.sync()})}const ra=r=>typeof r>"u"||r===null?null:ia(r),ia=r=>typeof r=="boolean"?r?"1":"0":r+"",er=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},oa=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(sa(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},sa=r=>typeof r=="string"&&r.indexOf("<")>-1;function aa(r){var e=this,n=e.onOptionSelect;e.settings.hideSelected=!1;const t=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},r);var i=function(f,p){p?(f.checked=!0,t.uncheckedClassNames&&f.classList.remove(...t.uncheckedClassNames),t.checkedClassNames&&f.classList.add(...t.checkedClassNames)):(f.checked=!1,t.checkedClassNames&&f.classList.remove(...t.checkedClassNames),t.uncheckedClassNames&&f.classList.add(...t.uncheckedClassNames))},s=function(f){setTimeout(()=>{var p=f.querySelector("input."+t.className);p instanceof HTMLInputElement&&i(p,f.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var o=e.settings.render.option;e.settings.render.option=(f,p)=>{var g=oa(o.call(e,f,p)),C=document.createElement("input");t.className&&C.classList.add(t.className),C.addEventListener("click",function(A){er(A)}),C.type="checkbox";const E=ra(f[e.settings.valueField]);return i(C,!!(E&&e.items.indexOf(E)>-1)),g.prepend(C),g}}),e.on("item_remove",o=>{var f=e.getOption(o);f&&(f.classList.remove("selected"),s(f))}),e.on("item_add",o=>{var f=e.getOption(o);f&&s(f)}),e.hook("instead","onOptionSelect",(o,f)=>{if(f.classList.contains("selected")){f.classList.remove("selected"),e.removeItem(f.dataset.value),e.refreshOptions(),er(o,!0);return}n.call(e,o,f),s(f)})}const ua=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(la(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},la=r=>typeof r=="string"&&r.indexOf("<")>-1;function ca(r){const e=this,n=Object.assign({className:"clear-button",title:"Clear All",html:t=>`<div class="${t.className}" title="${t.title}">&#10799;</div>`},r);e.on("initialize",()=>{var t=ua(n.html(n));t.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(t)})}const fa=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ve=(r,e,n,t)=>{r.addEventListener(e,n,t)},da=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},ha=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(pa(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},pa=r=>typeof r=="string"&&r.indexOf("<")>-1,ga=(r,e)=>{da(e,(n,t)=>{n==null?r.removeAttribute(t):r.setAttribute(t,""+n)})},va=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r.nextSibling)},ma=(r,e)=>{var n;(n=r.parentNode)==null||n.insertBefore(e,r)},ya=(r,e)=>{do{var n;if(e=(n=e)==null?void 0:n.previousElementSibling,r==e)return!0}while(e&&e.previousElementSibling);return!1};function ba(){var r=this;if(r.settings.mode!=="multi")return;var e=r.lock,n=r.unlock;let t=!0,i;r.hook("after","setupTemplates",()=>{var s=r.settings.render.item;r.settings.render.item=(o,f)=>{const p=ha(s.call(r,o,f));ga(p,{draggable:"true"});const g=w=>{t||fa(w),w.stopPropagation()},C=w=>{i=p,setTimeout(()=>{p.classList.add("ts-dragging")},0)},E=w=>{w.preventDefault(),p.classList.add("ts-drag-over"),I(p,i)},A=()=>{p.classList.remove("ts-drag-over")},I=(w,R)=>{R!==void 0&&(ya(R,p)?va(w,R):ma(w,R))},u=()=>{var w;document.querySelectorAll(".ts-drag-over").forEach(P=>P.classList.remove("ts-drag-over")),(w=i)==null||w.classList.remove("ts-dragging"),i=void 0;var R=[];r.control.querySelectorAll("[data-value]").forEach(P=>{if(P.dataset.value){let y=P.dataset.value;y&&R.push(y)}}),r.setValue(R)};return Ve(p,"mousedown",g),Ve(p,"dragstart",C),Ve(p,"dragenter",E),Ve(p,"dragover",E),Ve(p,"dragleave",A),Ve(p,"dragend",u),p}}),r.hook("instead","lock",()=>(t=!1,e.call(r))),r.hook("instead","unlock",()=>(t=!0,n.call(r)))}const Oa=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},Ca=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(Sa(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},Sa=r=>typeof r=="string"&&r.indexOf("<")>-1;function Aa(r){const e=this,n=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:t=>'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a class="'+t.closeClass+'">&times;</a></div></div>'},r);e.on("initialize",()=>{var t=Ca(n.html(n)),i=t.querySelector("."+n.closeClass);i&&i.addEventListener("click",s=>{Oa(s,!0),e.close()}),e.dropdown.insertBefore(t,e.dropdown.firstChild)})}const Ea=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},wa=(r,...e)=>{var n=Ra(e);r=Ta(r),r.map(t=>{n.map(i=>{t.classList.remove(i)})})},Ra=r=>{var e=[];return Ea(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Ta=r=>(Array.isArray(r)||(r=[r]),r),Ia=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function xa(){var r=this;r.hook("instead","setCaret",e=>{r.settings.mode==="single"||!r.control.contains(r.control_input)?e=r.items.length:(e=Math.max(0,Math.min(r.items.length,e)),e!=r.caretPos&&!r.isPending&&r.controlChildren().forEach((n,t)=>{t<e?r.control_input.insertAdjacentElement("beforebegin",n):r.control.appendChild(n)})),r.caretPos=e}),r.hook("instead","moveCaret",e=>{if(!r.isFocused)return;const n=r.getLastActive(e);if(n){const t=Ia(n);r.setCaret(e>0?t+1:t),r.setActiveItem(),wa(n,"last-active")}else r.setCaret(r.caretPos+e)})}const Pa=27,Ma=9,_a=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},La=(r,e,n,t)=>{r.addEventListener(e,n,t)},Da=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},tr=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(ka(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},ka=r=>typeof r=="string"&&r.indexOf("<")>-1,Na=(r,...e)=>{var n=Ua(e);r=Fa(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Ua=r=>{var e=[];return Da(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},Fa=r=>(Array.isArray(r)||(r=[r]),r);function ja(){const r=this;r.settings.shouldOpen=!0,r.hook("before","setup",()=>{r.focus_node=r.control,Na(r.control_input,"dropdown-input");const e=tr('<div class="dropdown-input-wrap">');e.append(r.control_input),r.dropdown.insertBefore(e,r.dropdown.firstChild);const n=tr('<input class="items-placeholder" tabindex="-1" />');n.placeholder=r.settings.placeholder||"",r.control.append(n)}),r.on("initialize",()=>{r.control_input.addEventListener("keydown",n=>{switch(n.keyCode){case Pa:r.isOpen&&(_a(n,!0),r.close()),r.clearActiveItems();return;case Ma:r.focus_node.tabIndex=-1;break}return r.onKeyDown.call(r,n)}),r.on("blur",()=>{r.focus_node.tabIndex=r.isDisabled?-1:r.tabIndex}),r.on("dropdown_open",()=>{r.control_input.focus()});const e=r.onBlur;r.hook("instead","onBlur",n=>{if(!(n&&n.relatedTarget==r.control_input))return e.call(r)}),La(r.control_input,"blur",()=>r.onBlur()),r.hook("before","close",()=>{r.isOpen&&r.focus_node.focus({preventScroll:!0})})})}const ft=(r,e,n,t)=>{r.addEventListener(e,n,t)};function Ba(){var r=this;r.on("initialize",()=>{var e=document.createElement("span"),n=r.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",r.wrapper.appendChild(e);var t=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const s of t)e.style[s]=n.style[s];var i=()=>{e.textContent=n.value,n.style.width=e.clientWidth+"px"};i(),r.on("update item_add item_remove",i),ft(n,"input",i),ft(n,"keyup",i),ft(n,"blur",i),ft(n,"update",i)})}function Ha(){var r=this,e=r.deleteSelection;this.hook("instead","deleteSelection",n=>r.activeItems.length?e.call(r,n):!1)}function Ga(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const nr=37,$a=39,Va=(r,e,n)=>{for(;r&&r.matches;){if(r.matches(e))return r;r=r.parentNode}},Wa=(r,e)=>{if(!r)return-1;e=e||r.nodeName;for(var n=0;r=r.previousElementSibling;)r.matches(e)&&n++;return n};function za(){var r=this,e=r.onKeyDown;r.hook("instead","onKeyDown",n=>{var t,i,s,o;if(!r.isOpen||!(n.keyCode===nr||n.keyCode===$a))return e.call(r,n);r.ignoreHover=!0,o=Va(r.activeOption,"[data-group]"),t=Wa(r.activeOption,"[data-selectable]"),o&&(n.keyCode===nr?o=o.previousSibling:o=o.nextSibling,o&&(s=o.querySelectorAll("[data-selectable]"),i=s[Math.min(s.length-1,t)],i&&r.setActiveOption(i)))})}const Ka=r=>(r+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),rr=(r,e=!1)=>{r&&(r.preventDefault(),e&&r.stopPropagation())},ir=(r,e,n,t)=>{r.addEventListener(e,n,t)},or=r=>{if(r.jquery)return r[0];if(r instanceof HTMLElement)return r;if(qa(r)){var e=document.createElement("template");return e.innerHTML=r.trim(),e.content.firstChild}return document.querySelector(r)},qa=r=>typeof r=="string"&&r.indexOf("<")>-1;function Ja(r){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},r);var n=this;if(e.append){var t='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Ka(e.title)+'">'+e.label+"</a>";n.hook("after","setupTemplates",()=>{var i=n.settings.render.item;n.settings.render.item=(s,o)=>{var f=or(i.call(n,s,o)),p=or(t);return f.appendChild(p),ir(p,"mousedown",g=>{rr(g,!0)}),ir(p,"click",g=>{n.isLocked||(rr(g,!0),!n.isLocked&&n.shouldDelete([f],g)&&(n.removeItem(f),n.refreshOptions(!1),n.inputState()))}),f}})}}function Qa(r){const e=this,n=Object.assign({text:t=>t[e.settings.labelField]},r);e.on("item_remove",function(t){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[t];i&&e.setTextboxValue(n.text.call(e,i))}})}const Ya=(r,e)=>{if(Array.isArray(r))r.forEach(e);else for(var n in r)r.hasOwnProperty(n)&&e(r[n],n)},Xa=(r,...e)=>{var n=Za(e);r=eu(r),r.map(t=>{n.map(i=>{t.classList.add(i)})})},Za=r=>{var e=[];return Ya(r,n=>{typeof n=="string"&&(n=n.trim().split(/[\t\n\f\r\s]/)),Array.isArray(n)&&(e=e.concat(n))}),e.filter(Boolean)},eu=r=>(Array.isArray(r)||(r=[r]),r);function tu(){const r=this,e=r.canLoad,n=r.clearActiveOption,t=r.loadCallback;var i={},s,o=!1,f,p=[];if(r.settings.shouldLoadMore||(r.settings.shouldLoadMore=()=>{if(s.clientHeight/(s.scrollHeight-s.scrollTop)>.9)return!0;if(r.activeOption){var A=r.selectable(),I=Array.from(A).indexOf(r.activeOption);if(I>=A.length-2)return!0}return!1}),!r.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";r.settings.sortField=[{field:"$order"},{field:"$score"}];const g=E=>typeof r.settings.maxOptions=="number"&&s.children.length>=r.settings.maxOptions?!1:!!(E in i&&i[E]),C=(E,A)=>r.items.indexOf(A)>=0||p.indexOf(A)>=0;r.setNextUrl=(E,A)=>{i[E]=A},r.getUrl=E=>{if(E in i){const A=i[E];return i[E]=!1,A}return r.clearPagination(),r.settings.firstUrl.call(r,E)},r.clearPagination=()=>{i={}},r.hook("instead","clearActiveOption",()=>{if(!o)return n.call(r)}),r.hook("instead","canLoad",E=>E in i?g(E):e.call(r,E)),r.hook("instead","loadCallback",(E,A)=>{if(!o)r.clearOptions(C);else if(f){const I=E[0];I!==void 0&&(f.dataset.value=I[r.settings.valueField])}t.call(r,E,A),o=!1}),r.hook("after","refreshOptions",()=>{const E=r.lastValue;var A;g(E)?(A=r.render("loading_more",{query:E}),A&&(A.setAttribute("data-selectable",""),f=A)):E in i&&!s.querySelector(".no-results")&&(A=r.render("no_more_results",{query:E})),A&&(Xa(A,r.settings.optionClass),s.append(A))}),r.on("initialize",()=>{p=Object.keys(r.options),s=r.dropdown_content,r.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},r.settings.render),s.addEventListener("scroll",()=>{r.settings.shouldLoadMore.call(r)&&g(r.lastValue)&&(o||(o=!0,r.load.call(r,r.lastValue)))})})}Ce.define("change_listener",na);Ce.define("checkbox_options",aa);Ce.define("clear_button",ca);Ce.define("drag_drop",ba);Ce.define("dropdown_header",Aa);Ce.define("caret_position",xa);Ce.define("dropdown_input",ja);Ce.define("input_autogrow",Ba);Ce.define("no_backspace_delete",Ha);Ce.define("no_active_items",Ga);Ce.define("optgroup_columns",za);Ce.define("remove_button",Ja);Ce.define("restore_on_backspace",Qa);Ce.define("virtual_scroll",tu);var nu={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(it,function(){const n=(f,p)=>{if(Array.isArray(f))f.forEach(p);else for(var g in f)f.hasOwnProperty(g)&&p(f[g],g)},t=(f,...p)=>{var g=i(p);f=s(f),f.map(C=>{g.map(E=>{C.classList.add(E)})})},i=f=>{var p=[];return n(f,g=>{typeof g=="string"&&(g=g.trim().split(/[\t\n\f\r\s]/)),Array.isArray(g)&&(p=p.concat(g))}),p.filter(Boolean)},s=f=>(Array.isArray(f)||(f=[f]),f);function o(){const f=this,p=f.canLoad,g=f.clearActiveOption,C=f.loadCallback;var E={},A,I=!1,u,w=[];if(f.settings.shouldLoadMore||(f.settings.shouldLoadMore=()=>{if(A.clientHeight/(A.scrollHeight-A.scrollTop)>.9)return!0;if(f.activeOption){var m=f.selectable(),T=Array.from(m).indexOf(f.activeOption);if(T>=m.length-2)return!0}return!1}),!f.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";f.settings.sortField=[{field:"$order"},{field:"$score"}];const R=y=>typeof f.settings.maxOptions=="number"&&A.children.length>=f.settings.maxOptions?!1:!!(y in E&&E[y]),P=(y,m)=>f.items.indexOf(m)>=0||w.indexOf(m)>=0;f.setNextUrl=(y,m)=>{E[y]=m},f.getUrl=y=>{if(y in E){const m=E[y];return E[y]=!1,m}return f.clearPagination(),f.settings.firstUrl.call(f,y)},f.clearPagination=()=>{E={}},f.hook("instead","clearActiveOption",()=>{if(!I)return g.call(f)}),f.hook("instead","canLoad",y=>y in E?R(y):p.call(f,y)),f.hook("instead","loadCallback",(y,m)=>{if(!I)f.clearOptions(P);else if(u){const T=y[0];T!==void 0&&(u.dataset.value=T[f.settings.valueField])}C.call(f,y,m),I=!1}),f.hook("after","refreshOptions",()=>{const y=f.lastValue;var m;R(y)?(m=f.render("loading_more",{query:y}),m&&(m.setAttribute("data-selectable",""),u=m)):y in E&&!A.querySelector(".no-results")&&(m=f.render("no_more_results",{query:y})),m&&(t(m,f.settings.optionClass),A.append(m))}),f.on("initialize",()=>{w=Object.keys(f.options),A=f.dropdown_content,f.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},f.settings.render),A.addEventListener("scroll",()=>{f.settings.shouldLoadMore.call(f)&&R(f.lastValue)&&(I||(I=!0,f.load.call(f,f.lastValue)))})})}return o})})(nu);var ru={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(it,function(){const i=(f,p,g)=>{for(;f&&f.matches;){if(f.matches(p))return f;f=f.parentNode}},s=(f,p)=>{if(!f)return-1;p=p||f.nodeName;for(var g=0;f=f.previousElementSibling;)f.matches(p)&&g++;return g};function o(){var f=this,p=f.onKeyDown;f.hook("instead","onKeyDown",g=>{var C,E,A,I;if(!f.isOpen||!(g.keyCode===37||g.keyCode===39))return p.call(f,g);f.ignoreHover=!0,I=i(f.activeOption,"[data-group]"),C=s(f.activeOption,"[data-selectable]"),I&&(g.keyCode===37?I=I.previousSibling:I=I.nextSibling,I&&(A=I.querySelectorAll("[data-selectable]"),E=A[Math.min(A.length-1,C)],E&&f.setActiveOption(E)))})}return o})})(ru);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function ot(r){return r+.5|0}const Ne=(r,e,n)=>Math.max(Math.min(r,n),e);function Xe(r){return Ne(ot(r*2.55),0,255)}function Ue(r){return Ne(ot(r*255),0,255)}function _e(r){return Ne(ot(r/2.55)/100,0,1)}function sr(r){return Ne(ot(r*100),0,100)}const Ae={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},fn=[..."0123456789ABCDEF"],iu=r=>fn[r&15],ou=r=>fn[(r&240)>>4]+fn[r&15],dt=r=>(r&240)>>4===(r&15),su=r=>dt(r.r)&&dt(r.g)&&dt(r.b)&&dt(r.a);function au(r){var e=r.length,n;return r[0]==="#"&&(e===4||e===5?n={r:255&Ae[r[1]]*17,g:255&Ae[r[2]]*17,b:255&Ae[r[3]]*17,a:e===5?Ae[r[4]]*17:255}:(e===7||e===9)&&(n={r:Ae[r[1]]<<4|Ae[r[2]],g:Ae[r[3]]<<4|Ae[r[4]],b:Ae[r[5]]<<4|Ae[r[6]],a:e===9?Ae[r[7]]<<4|Ae[r[8]]:255})),n}const uu=(r,e)=>r<255?e(r):"";function lu(r){var e=su(r)?iu:ou;return r?"#"+e(r.r)+e(r.g)+e(r.b)+uu(r.a,e):void 0}const cu=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Xr(r,e,n){const t=e*Math.min(n,1-n),i=(s,o=(s+r/30)%12)=>n-t*Math.max(Math.min(o-3,9-o,1),-1);return[i(0),i(8),i(4)]}function fu(r,e,n){const t=(i,s=(i+r/60)%6)=>n-n*e*Math.max(Math.min(s,4-s,1),0);return[t(5),t(3),t(1)]}function du(r,e,n){const t=Xr(r,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)t[i]*=1-e-n,t[i]+=e;return t}function hu(r,e,n,t,i){return r===i?(e-n)/t+(e<n?6:0):e===i?(n-r)/t+2:(r-e)/t+4}function On(r){const n=r.r/255,t=r.g/255,i=r.b/255,s=Math.max(n,t,i),o=Math.min(n,t,i),f=(s+o)/2;let p,g,C;return s!==o&&(C=s-o,g=f>.5?C/(2-s-o):C/(s+o),p=hu(n,t,i,C,s),p=p*60+.5),[p|0,g||0,f]}function Cn(r,e,n,t){return(Array.isArray(e)?r(e[0],e[1],e[2]):r(e,n,t)).map(Ue)}function Sn(r,e,n){return Cn(Xr,r,e,n)}function pu(r,e,n){return Cn(du,r,e,n)}function gu(r,e,n){return Cn(fu,r,e,n)}function Zr(r){return(r%360+360)%360}function vu(r){const e=cu.exec(r);let n=255,t;if(!e)return;e[5]!==t&&(n=e[6]?Xe(+e[5]):Ue(+e[5]));const i=Zr(+e[2]),s=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?t=pu(i,s,o):e[1]==="hsv"?t=gu(i,s,o):t=Sn(i,s,o),{r:t[0],g:t[1],b:t[2],a:n}}function mu(r,e){var n=On(r);n[0]=Zr(n[0]+e),n=Sn(n),r.r=n[0],r.g=n[1],r.b=n[2]}function yu(r){if(!r)return;const e=On(r),n=e[0],t=sr(e[1]),i=sr(e[2]);return r.a<255?`hsla(${n}, ${t}%, ${i}%, ${_e(r.a)})`:`hsl(${n}, ${t}%, ${i}%)`}const ar={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},ur={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function bu(){const r={},e=Object.keys(ur),n=Object.keys(ar);let t,i,s,o,f;for(t=0;t<e.length;t++){for(o=f=e[t],i=0;i<n.length;i++)s=n[i],f=f.replace(s,ar[s]);s=parseInt(ur[o],16),r[f]=[s>>16&255,s>>8&255,s&255]}return r}let ht;function Ou(r){ht||(ht=bu(),ht.transparent=[0,0,0,0]);const e=ht[r.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const Cu=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Su(r){const e=Cu.exec(r);let n=255,t,i,s;if(e){if(e[7]!==t){const o=+e[7];n=e[8]?Xe(o):Ne(o*255,0,255)}return t=+e[1],i=+e[3],s=+e[5],t=255&(e[2]?Xe(t):Ne(t,0,255)),i=255&(e[4]?Xe(i):Ne(i,0,255)),s=255&(e[6]?Xe(s):Ne(s,0,255)),{r:t,g:i,b:s,a:n}}}function Au(r){return r&&(r.a<255?`rgba(${r.r}, ${r.g}, ${r.b}, ${_e(r.a)})`:`rgb(${r.r}, ${r.g}, ${r.b})`)}const en=r=>r<=.0031308?r*12.92:Math.pow(r,1/2.4)*1.055-.055,We=r=>r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);function Eu(r,e,n){const t=We(_e(r.r)),i=We(_e(r.g)),s=We(_e(r.b));return{r:Ue(en(t+n*(We(_e(e.r))-t))),g:Ue(en(i+n*(We(_e(e.g))-i))),b:Ue(en(s+n*(We(_e(e.b))-s))),a:r.a+n*(e.a-r.a)}}function pt(r,e,n){if(r){let t=On(r);t[e]=Math.max(0,Math.min(t[e]+t[e]*n,e===0?360:1)),t=Sn(t),r.r=t[0],r.g=t[1],r.b=t[2]}}function ei(r,e){return r&&Object.assign(e||{},r)}function lr(r){var e={r:0,g:0,b:0,a:255};return Array.isArray(r)?r.length>=3&&(e={r:r[0],g:r[1],b:r[2],a:255},r.length>3&&(e.a=Ue(r[3]))):(e=ei(r,{r:0,g:0,b:0,a:1}),e.a=Ue(e.a)),e}function wu(r){return r.charAt(0)==="r"?Su(r):vu(r)}class dn{constructor(e){if(e instanceof dn)return e;const n=typeof e;let t;n==="object"?t=lr(e):n==="string"&&(t=au(e)||Ou(e)||wu(e)),this._rgb=t,this._valid=!!t}get valid(){return this._valid}get rgb(){var e=ei(this._rgb);return e&&(e.a=_e(e.a)),e}set rgb(e){this._rgb=lr(e)}rgbString(){return this._valid?Au(this._rgb):void 0}hexString(){return this._valid?lu(this._rgb):void 0}hslString(){return this._valid?yu(this._rgb):void 0}mix(e,n){if(e){const t=this.rgb,i=e.rgb;let s;const o=n===s?.5:n,f=2*o-1,p=t.a-i.a,g=((f*p===-1?f:(f+p)/(1+f*p))+1)/2;s=1-g,t.r=255&g*t.r+s*i.r+.5,t.g=255&g*t.g+s*i.g+.5,t.b=255&g*t.b+s*i.b+.5,t.a=o*t.a+(1-o)*i.a,this.rgb=t}return this}interpolate(e,n){return e&&(this._rgb=Eu(this._rgb,e._rgb,n)),this}clone(){return new dn(this.rgb)}alpha(e){return this._rgb.a=Ue(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=ot(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return pt(this._rgb,2,e),this}darken(e){return pt(this._rgb,2,-e),this}saturate(e){return pt(this._rgb,1,e),this}desaturate(e){return pt(this._rgb,1,-e),this}rotate(e){return mu(this._rgb,e),this}}export{zu as A,dn as C,Wu as E,Ku as N,Ce as T,le as a,qu as d,Ju as r};
